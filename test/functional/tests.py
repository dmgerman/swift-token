begin_unit
comment|'#!/usr/bin/python -u'
nl|'\n'
comment|'# Copyright (c) 2010-2012 OpenStack Foundation'
nl|'\n'
comment|'#'
nl|'\n'
comment|'# Licensed under the Apache License, Version 2.0 (the "License");'
nl|'\n'
comment|'# you may not use this file except in compliance with the License.'
nl|'\n'
comment|'# You may obtain a copy of the License at'
nl|'\n'
comment|'#'
nl|'\n'
comment|'#    http://www.apache.org/licenses/LICENSE-2.0'
nl|'\n'
comment|'#'
nl|'\n'
comment|'# Unless required by applicable law or agreed to in writing, software'
nl|'\n'
comment|'# distributed under the License is distributed on an "AS IS" BASIS,'
nl|'\n'
comment|'# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or'
nl|'\n'
comment|'# implied.'
nl|'\n'
comment|'# See the License for the specific language governing permissions and'
nl|'\n'
comment|'# limitations under the License.'
nl|'\n'
nl|'\n'
name|'from'
name|'datetime'
name|'import'
name|'datetime'
newline|'\n'
name|'import'
name|'email'
op|'.'
name|'parser'
newline|'\n'
name|'import'
name|'hashlib'
newline|'\n'
name|'import'
name|'hmac'
newline|'\n'
name|'import'
name|'itertools'
newline|'\n'
name|'import'
name|'json'
newline|'\n'
name|'import'
name|'locale'
newline|'\n'
name|'import'
name|'random'
newline|'\n'
name|'import'
name|'six'
newline|'\n'
name|'from'
name|'six'
op|'.'
name|'moves'
name|'import'
name|'urllib'
newline|'\n'
name|'import'
name|'time'
newline|'\n'
name|'import'
name|'unittest2'
newline|'\n'
name|'import'
name|'uuid'
newline|'\n'
name|'from'
name|'copy'
name|'import'
name|'deepcopy'
newline|'\n'
name|'import'
name|'eventlet'
newline|'\n'
name|'from'
name|'unittest2'
name|'import'
name|'SkipTest'
newline|'\n'
name|'from'
name|'swift'
op|'.'
name|'common'
op|'.'
name|'http'
name|'import'
name|'is_success'
op|','
name|'is_client_error'
newline|'\n'
nl|'\n'
name|'from'
name|'test'
op|'.'
name|'functional'
name|'import'
name|'normalized_urls'
op|','
name|'load_constraint'
op|','
name|'cluster_info'
newline|'\n'
name|'from'
name|'test'
op|'.'
name|'functional'
name|'import'
name|'check_response'
op|','
name|'retry'
op|','
name|'requires_acls'
newline|'\n'
name|'import'
name|'test'
op|'.'
name|'functional'
name|'as'
name|'tf'
newline|'\n'
name|'from'
name|'test'
op|'.'
name|'functional'
op|'.'
name|'swift_test_client'
name|'import'
name|'Account'
op|','
name|'Connection'
op|','
name|'File'
op|','
name|'ResponseError'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|function|setUpModule
name|'def'
name|'setUpModule'
op|'('
op|')'
op|':'
newline|'\n'
indent|'    '
name|'tf'
op|'.'
name|'setup_package'
op|'('
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|function|tearDownModule
dedent|''
name|'def'
name|'tearDownModule'
op|'('
op|')'
op|':'
newline|'\n'
indent|'    '
name|'tf'
op|'.'
name|'teardown_package'
op|'('
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|Utils
dedent|''
name|'class'
name|'Utils'
op|'('
name|'object'
op|')'
op|':'
newline|'\n'
indent|'    '
op|'@'
name|'classmethod'
newline|'\n'
DECL|member|create_ascii_name
name|'def'
name|'create_ascii_name'
op|'('
name|'cls'
op|','
name|'length'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'uuid'
op|'.'
name|'uuid4'
op|'('
op|')'
op|'.'
name|'hex'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'classmethod'
newline|'\n'
DECL|member|create_utf8_name
name|'def'
name|'create_utf8_name'
op|'('
name|'cls'
op|','
name|'length'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'length'
name|'is'
name|'None'
op|':'
newline|'\n'
indent|'            '
name|'length'
op|'='
number|'15'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'length'
op|'='
name|'int'
op|'('
name|'length'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'utf8_chars'
op|'='
string|"u'\\uF10F\\uD20D\\uB30B\\u9409\\u8508\\u5605\\u3703\\u1801'"
string|"u'\\u0900\\uF110\\uD20E\\uB30C\\u940A\\u8509\\u5606\\u3704'"
string|"u'\\u1802\\u0901\\uF111\\uD20F\\uB30D\\u940B\\u850A\\u5607'"
string|"u'\\u3705\\u1803\\u0902\\uF112\\uD210\\uB30E\\u940C\\u850B'"
string|"u'\\u5608\\u3706\\u1804\\u0903\\u03A9\\u2603'"
newline|'\n'
name|'return'
string|"''"
op|'.'
name|'join'
op|'('
op|'['
name|'random'
op|'.'
name|'choice'
op|'('
name|'utf8_chars'
op|')'
nl|'\n'
name|'for'
name|'x'
name|'in'
name|'range'
op|'('
name|'length'
op|')'
op|']'
op|')'
op|'.'
name|'encode'
op|'('
string|"'utf-8'"
op|')'
newline|'\n'
nl|'\n'
DECL|variable|create_name
dedent|''
name|'create_name'
op|'='
name|'create_ascii_name'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|Base
dedent|''
name|'class'
name|'Base'
op|'('
name|'unittest2'
op|'.'
name|'TestCase'
op|')'
op|':'
newline|'\n'
DECL|member|setUp
indent|'    '
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'cls'
op|'='
name|'type'
op|'('
name|'self'
op|')'
newline|'\n'
name|'if'
name|'not'
name|'cls'
op|'.'
name|'set_up'
op|':'
newline|'\n'
indent|'            '
name|'cls'
op|'.'
name|'env'
op|'.'
name|'setUp'
op|'('
op|')'
newline|'\n'
name|'cls'
op|'.'
name|'set_up'
op|'='
name|'True'
newline|'\n'
nl|'\n'
DECL|member|assert_body
dedent|''
dedent|''
name|'def'
name|'assert_body'
op|'('
name|'self'
op|','
name|'body'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'response_body'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'conn'
op|'.'
name|'response'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'response_body'
op|'=='
name|'body'
op|','
nl|'\n'
string|"'Body returned: %s'"
op|'%'
op|'('
name|'response_body'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|assert_status
dedent|''
name|'def'
name|'assert_status'
op|'('
name|'self'
op|','
name|'status_or_statuses'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'assertTrue'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'env'
op|'.'
name|'conn'
op|'.'
name|'response'
op|'.'
name|'status'
op|'=='
name|'status_or_statuses'
name|'or'
nl|'\n'
op|'('
name|'hasattr'
op|'('
name|'status_or_statuses'
op|','
string|"'__iter__'"
op|')'
name|'and'
nl|'\n'
name|'self'
op|'.'
name|'env'
op|'.'
name|'conn'
op|'.'
name|'response'
op|'.'
name|'status'
name|'in'
name|'status_or_statuses'
op|')'
op|','
nl|'\n'
string|"'Status returned: %d Expected: %s'"
op|'%'
nl|'\n'
op|'('
name|'self'
op|'.'
name|'env'
op|'.'
name|'conn'
op|'.'
name|'response'
op|'.'
name|'status'
op|','
name|'status_or_statuses'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|assert_header
dedent|''
name|'def'
name|'assert_header'
op|'('
name|'self'
op|','
name|'header_name'
op|','
name|'expected_value'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'actual_value'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'conn'
op|'.'
name|'response'
op|'.'
name|'getheader'
op|'('
name|'header_name'
op|')'
newline|'\n'
dedent|''
name|'except'
name|'KeyError'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'fail'
op|'('
nl|'\n'
string|"'Expected header name %r not found in response.'"
op|'%'
name|'header_name'
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'expected_value'
op|','
name|'actual_value'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|Base2
dedent|''
dedent|''
name|'class'
name|'Base2'
op|'('
name|'object'
op|')'
op|':'
newline|'\n'
DECL|member|setUp
indent|'    '
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'Utils'
op|'.'
name|'create_name'
op|'='
name|'Utils'
op|'.'
name|'create_utf8_name'
newline|'\n'
name|'super'
op|'('
name|'Base2'
op|','
name|'self'
op|')'
op|'.'
name|'setUp'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|tearDown
dedent|''
name|'def'
name|'tearDown'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'Utils'
op|'.'
name|'create_name'
op|'='
name|'Utils'
op|'.'
name|'create_ascii_name'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|TestAccountEnv
dedent|''
dedent|''
name|'class'
name|'TestAccountEnv'
op|'('
name|'object'
op|')'
op|':'
newline|'\n'
indent|'    '
op|'@'
name|'classmethod'
newline|'\n'
DECL|member|setUp
name|'def'
name|'setUp'
op|'('
name|'cls'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'cls'
op|'.'
name|'conn'
op|'='
name|'Connection'
op|'('
name|'tf'
op|'.'
name|'config'
op|')'
newline|'\n'
name|'cls'
op|'.'
name|'conn'
op|'.'
name|'authenticate'
op|'('
op|')'
newline|'\n'
name|'cls'
op|'.'
name|'account'
op|'='
name|'Account'
op|'('
name|'cls'
op|'.'
name|'conn'
op|','
name|'tf'
op|'.'
name|'config'
op|'.'
name|'get'
op|'('
string|"'account'"
op|','
nl|'\n'
name|'tf'
op|'.'
name|'config'
op|'['
string|"'username'"
op|']'
op|')'
op|')'
newline|'\n'
name|'cls'
op|'.'
name|'account'
op|'.'
name|'delete_containers'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'cls'
op|'.'
name|'containers'
op|'='
op|'['
op|']'
newline|'\n'
name|'for'
name|'i'
name|'in'
name|'range'
op|'('
number|'10'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'cont'
op|'='
name|'cls'
op|'.'
name|'account'
op|'.'
name|'container'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
name|'if'
name|'not'
name|'cont'
op|'.'
name|'create'
op|'('
op|')'
op|':'
newline|'\n'
indent|'                '
name|'raise'
name|'ResponseError'
op|'('
name|'cls'
op|'.'
name|'conn'
op|'.'
name|'response'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'cls'
op|'.'
name|'containers'
op|'.'
name|'append'
op|'('
name|'cont'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|TestAccountDev
dedent|''
dedent|''
dedent|''
name|'class'
name|'TestAccountDev'
op|'('
name|'Base'
op|')'
op|':'
newline|'\n'
DECL|variable|env
indent|'    '
name|'env'
op|'='
name|'TestAccountEnv'
newline|'\n'
DECL|variable|set_up
name|'set_up'
op|'='
name|'False'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|TestAccountDevUTF8
dedent|''
name|'class'
name|'TestAccountDevUTF8'
op|'('
name|'Base2'
op|','
name|'TestAccountDev'
op|')'
op|':'
newline|'\n'
DECL|variable|set_up
indent|'    '
name|'set_up'
op|'='
name|'False'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|TestAccount
dedent|''
name|'class'
name|'TestAccount'
op|'('
name|'Base'
op|')'
op|':'
newline|'\n'
DECL|variable|env
indent|'    '
name|'env'
op|'='
name|'TestAccountEnv'
newline|'\n'
DECL|variable|set_up
name|'set_up'
op|'='
name|'False'
newline|'\n'
nl|'\n'
DECL|member|testNoAuthToken
name|'def'
name|'testNoAuthToken'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ResponseError'
op|','
name|'self'
op|'.'
name|'env'
op|'.'
name|'account'
op|'.'
name|'info'
op|','
nl|'\n'
name|'cfg'
op|'='
op|'{'
string|"'no_auth_token'"
op|':'
name|'True'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
op|'['
number|'401'
op|','
number|'412'
op|']'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ResponseError'
op|','
name|'self'
op|'.'
name|'env'
op|'.'
name|'account'
op|'.'
name|'containers'
op|','
nl|'\n'
name|'cfg'
op|'='
op|'{'
string|"'no_auth_token'"
op|':'
name|'True'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
op|'['
number|'401'
op|','
number|'412'
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|testInvalidUTF8Path
dedent|''
name|'def'
name|'testInvalidUTF8Path'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'invalid_utf8'
op|'='
name|'Utils'
op|'.'
name|'create_utf8_name'
op|'('
op|')'
op|'['
op|':'
op|':'
op|'-'
number|'1'
op|']'
newline|'\n'
name|'container'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'account'
op|'.'
name|'container'
op|'('
name|'invalid_utf8'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'container'
op|'.'
name|'create'
op|'('
name|'cfg'
op|'='
op|'{'
string|"'no_path_quote'"
op|':'
name|'True'
op|'}'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'412'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_body'
op|'('
string|"'Invalid UTF8 or contains NULL'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|testVersionOnlyPath
dedent|''
name|'def'
name|'testVersionOnlyPath'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'env'
op|'.'
name|'account'
op|'.'
name|'conn'
op|'.'
name|'make_request'
op|'('
string|"'PUT'"
op|','
nl|'\n'
name|'cfg'
op|'='
op|'{'
string|"'version_only_path'"
op|':'
name|'True'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'412'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_body'
op|'('
string|"'Bad URL'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|testInvalidPath
dedent|''
name|'def'
name|'testInvalidPath'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'was_url'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'account'
op|'.'
name|'conn'
op|'.'
name|'storage_url'
newline|'\n'
name|'if'
op|'('
name|'normalized_urls'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'env'
op|'.'
name|'account'
op|'.'
name|'conn'
op|'.'
name|'storage_url'
op|'='
string|"'/'"
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'env'
op|'.'
name|'account'
op|'.'
name|'conn'
op|'.'
name|'storage_url'
op|'='
string|'"/%s"'
op|'%'
name|'was_url'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'env'
op|'.'
name|'account'
op|'.'
name|'conn'
op|'.'
name|'make_request'
op|'('
string|"'GET'"
op|')'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'404'
op|')'
newline|'\n'
dedent|''
name|'finally'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'env'
op|'.'
name|'account'
op|'.'
name|'conn'
op|'.'
name|'storage_url'
op|'='
name|'was_url'
newline|'\n'
nl|'\n'
DECL|member|testPUT
dedent|''
dedent|''
name|'def'
name|'testPUT'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'env'
op|'.'
name|'account'
op|'.'
name|'conn'
op|'.'
name|'make_request'
op|'('
string|"'PUT'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
op|'['
number|'403'
op|','
number|'405'
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|testAccountHead
dedent|''
name|'def'
name|'testAccountHead'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'try_count'
op|'='
number|'0'
newline|'\n'
name|'while'
name|'try_count'
op|'<'
number|'5'
op|':'
newline|'\n'
indent|'            '
name|'try_count'
op|'+='
number|'1'
newline|'\n'
nl|'\n'
name|'info'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'account'
op|'.'
name|'info'
op|'('
op|')'
newline|'\n'
name|'for'
name|'field'
name|'in'
op|'['
string|"'object_count'"
op|','
string|"'container_count'"
op|','
string|"'bytes_used'"
op|']'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'info'
op|'['
name|'field'
op|']'
op|'>='
number|'0'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'if'
name|'info'
op|'['
string|"'container_count'"
op|']'
op|'=='
name|'len'
op|'('
name|'self'
op|'.'
name|'env'
op|'.'
name|'containers'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'break'
newline|'\n'
nl|'\n'
dedent|''
name|'if'
name|'try_count'
op|'<'
number|'5'
op|':'
newline|'\n'
indent|'                '
name|'time'
op|'.'
name|'sleep'
op|'('
number|'1'
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'info'
op|'['
string|"'container_count'"
op|']'
op|','
name|'len'
op|'('
name|'self'
op|'.'
name|'env'
op|'.'
name|'containers'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'204'
op|')'
newline|'\n'
nl|'\n'
DECL|member|testContainerSerializedInfo
dedent|''
name|'def'
name|'testContainerSerializedInfo'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'container_info'
op|'='
op|'{'
op|'}'
newline|'\n'
name|'for'
name|'container'
name|'in'
name|'self'
op|'.'
name|'env'
op|'.'
name|'containers'
op|':'
newline|'\n'
indent|'            '
name|'info'
op|'='
op|'{'
string|"'bytes'"
op|':'
number|'0'
op|'}'
newline|'\n'
name|'info'
op|'['
string|"'count'"
op|']'
op|'='
name|'random'
op|'.'
name|'randint'
op|'('
number|'10'
op|','
number|'30'
op|')'
newline|'\n'
name|'for'
name|'i'
name|'in'
name|'range'
op|'('
name|'info'
op|'['
string|"'count'"
op|']'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'file_item'
op|'='
name|'container'
op|'.'
name|'file'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
name|'bytes'
op|'='
name|'random'
op|'.'
name|'randint'
op|'('
number|'1'
op|','
number|'32768'
op|')'
newline|'\n'
name|'file_item'
op|'.'
name|'write_random'
op|'('
name|'bytes'
op|')'
newline|'\n'
name|'info'
op|'['
string|"'bytes'"
op|']'
op|'+='
name|'bytes'
newline|'\n'
nl|'\n'
dedent|''
name|'container_info'
op|'['
name|'container'
op|'.'
name|'name'
op|']'
op|'='
name|'info'
newline|'\n'
nl|'\n'
dedent|''
name|'for'
name|'format_type'
name|'in'
op|'['
string|"'json'"
op|','
string|"'xml'"
op|']'
op|':'
newline|'\n'
indent|'            '
name|'for'
name|'a'
name|'in'
name|'self'
op|'.'
name|'env'
op|'.'
name|'account'
op|'.'
name|'containers'
op|'('
nl|'\n'
name|'parms'
op|'='
op|'{'
string|"'format'"
op|':'
name|'format_type'
op|'}'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'a'
op|'['
string|"'count'"
op|']'
op|'>='
number|'0'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'a'
op|'['
string|"'bytes'"
op|']'
op|'>='
number|'0'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'headers'
op|'='
name|'dict'
op|'('
name|'self'
op|'.'
name|'env'
op|'.'
name|'conn'
op|'.'
name|'response'
op|'.'
name|'getheaders'
op|'('
op|')'
op|')'
newline|'\n'
name|'if'
name|'format_type'
op|'=='
string|"'json'"
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'headers'
op|'['
string|"'content-type'"
op|']'
op|','
nl|'\n'
string|"'application/json; charset=utf-8'"
op|')'
newline|'\n'
dedent|''
name|'elif'
name|'format_type'
op|'=='
string|"'xml'"
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'headers'
op|'['
string|"'content-type'"
op|']'
op|','
nl|'\n'
string|"'application/xml; charset=utf-8'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|testListingLimit
dedent|''
dedent|''
dedent|''
name|'def'
name|'testListingLimit'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'limit'
op|'='
name|'load_constraint'
op|'('
string|"'account_listing_limit'"
op|')'
newline|'\n'
name|'for'
name|'l'
name|'in'
op|'('
number|'1'
op|','
number|'100'
op|','
name|'limit'
op|'/'
number|'2'
op|','
name|'limit'
op|'-'
number|'1'
op|','
name|'limit'
op|','
name|'limit'
op|'+'
number|'1'
op|','
name|'limit'
op|'*'
number|'2'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'p'
op|'='
op|'{'
string|"'limit'"
op|':'
name|'l'
op|'}'
newline|'\n'
nl|'\n'
name|'if'
name|'l'
op|'<='
name|'limit'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'len'
op|'('
name|'self'
op|'.'
name|'env'
op|'.'
name|'account'
op|'.'
name|'containers'
op|'('
name|'parms'
op|'='
name|'p'
op|')'
op|')'
op|'<='
name|'l'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'200'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ResponseError'
op|','
nl|'\n'
name|'self'
op|'.'
name|'env'
op|'.'
name|'account'
op|'.'
name|'containers'
op|','
name|'parms'
op|'='
name|'p'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'412'
op|')'
newline|'\n'
nl|'\n'
DECL|member|testContainerListing
dedent|''
dedent|''
dedent|''
name|'def'
name|'testContainerListing'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'a'
op|'='
name|'sorted'
op|'('
op|'['
name|'c'
op|'.'
name|'name'
name|'for'
name|'c'
name|'in'
name|'self'
op|'.'
name|'env'
op|'.'
name|'containers'
op|']'
op|')'
newline|'\n'
nl|'\n'
name|'for'
name|'format_type'
name|'in'
op|'['
name|'None'
op|','
string|"'json'"
op|','
string|"'xml'"
op|']'
op|':'
newline|'\n'
indent|'            '
name|'b'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'account'
op|'.'
name|'containers'
op|'('
name|'parms'
op|'='
op|'{'
string|"'format'"
op|':'
name|'format_type'
op|'}'
op|')'
newline|'\n'
nl|'\n'
name|'if'
name|'isinstance'
op|'('
name|'b'
op|'['
number|'0'
op|']'
op|','
name|'dict'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'b'
op|'='
op|'['
name|'x'
op|'['
string|"'name'"
op|']'
name|'for'
name|'x'
name|'in'
name|'b'
op|']'
newline|'\n'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'a'
op|','
name|'b'
op|')'
newline|'\n'
nl|'\n'
DECL|member|testListDelimiter
dedent|''
dedent|''
name|'def'
name|'testListDelimiter'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'delimiter'
op|'='
string|"'-'"
newline|'\n'
name|'containers'
op|'='
op|'['
string|"'test'"
op|','
name|'delimiter'
op|'.'
name|'join'
op|'('
op|'['
string|"'test'"
op|','
string|"'bar'"
op|']'
op|')'
op|','
nl|'\n'
name|'delimiter'
op|'.'
name|'join'
op|'('
op|'['
string|"'test'"
op|','
string|"'foo'"
op|']'
op|')'
op|']'
newline|'\n'
name|'for'
name|'c'
name|'in'
name|'containers'
op|':'
newline|'\n'
indent|'            '
name|'cont'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'account'
op|'.'
name|'container'
op|'('
name|'c'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'cont'
op|'.'
name|'create'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'results'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'account'
op|'.'
name|'containers'
op|'('
name|'parms'
op|'='
op|'{'
string|"'delimiter'"
op|':'
name|'delimiter'
op|'}'
op|')'
newline|'\n'
name|'expected'
op|'='
op|'['
string|"'test'"
op|','
string|"'test-'"
op|']'
newline|'\n'
name|'results'
op|'='
op|'['
name|'r'
name|'for'
name|'r'
name|'in'
name|'results'
name|'if'
name|'r'
name|'in'
name|'expected'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'expected'
op|','
name|'results'
op|')'
newline|'\n'
nl|'\n'
name|'results'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'account'
op|'.'
name|'containers'
op|'('
name|'parms'
op|'='
op|'{'
string|"'delimiter'"
op|':'
name|'delimiter'
op|','
nl|'\n'
string|"'reverse'"
op|':'
string|"'yes'"
op|'}'
op|')'
newline|'\n'
name|'expected'
op|'.'
name|'reverse'
op|'('
op|')'
newline|'\n'
name|'results'
op|'='
op|'['
name|'r'
name|'for'
name|'r'
name|'in'
name|'results'
name|'if'
name|'r'
name|'in'
name|'expected'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'expected'
op|','
name|'results'
op|')'
newline|'\n'
nl|'\n'
DECL|member|testListDelimiterAndPrefix
dedent|''
name|'def'
name|'testListDelimiterAndPrefix'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'delimiter'
op|'='
string|"'a'"
newline|'\n'
name|'containers'
op|'='
op|'['
string|"'bar'"
op|','
string|"'bazar'"
op|']'
newline|'\n'
name|'for'
name|'c'
name|'in'
name|'containers'
op|':'
newline|'\n'
indent|'            '
name|'cont'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'account'
op|'.'
name|'container'
op|'('
name|'c'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'cont'
op|'.'
name|'create'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'results'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'account'
op|'.'
name|'containers'
op|'('
name|'parms'
op|'='
op|'{'
string|"'delimiter'"
op|':'
name|'delimiter'
op|','
nl|'\n'
string|"'prefix'"
op|':'
string|"'ba'"
op|'}'
op|')'
newline|'\n'
name|'expected'
op|'='
op|'['
string|"'bar'"
op|','
string|"'baza'"
op|']'
newline|'\n'
name|'results'
op|'='
op|'['
name|'r'
name|'for'
name|'r'
name|'in'
name|'results'
name|'if'
name|'r'
name|'in'
name|'expected'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'expected'
op|','
name|'results'
op|')'
newline|'\n'
nl|'\n'
name|'results'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'account'
op|'.'
name|'containers'
op|'('
name|'parms'
op|'='
op|'{'
string|"'delimiter'"
op|':'
name|'delimiter'
op|','
nl|'\n'
string|"'prefix'"
op|':'
string|"'ba'"
op|','
nl|'\n'
string|"'reverse'"
op|':'
string|"'yes'"
op|'}'
op|')'
newline|'\n'
name|'expected'
op|'.'
name|'reverse'
op|'('
op|')'
newline|'\n'
name|'results'
op|'='
op|'['
name|'r'
name|'for'
name|'r'
name|'in'
name|'results'
name|'if'
name|'r'
name|'in'
name|'expected'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'expected'
op|','
name|'results'
op|')'
newline|'\n'
nl|'\n'
DECL|member|testInvalidAuthToken
dedent|''
name|'def'
name|'testInvalidAuthToken'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'hdrs'
op|'='
op|'{'
string|"'X-Auth-Token'"
op|':'
string|"'bogus_auth_token'"
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ResponseError'
op|','
name|'self'
op|'.'
name|'env'
op|'.'
name|'account'
op|'.'
name|'info'
op|','
name|'hdrs'
op|'='
name|'hdrs'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'401'
op|')'
newline|'\n'
nl|'\n'
DECL|member|testLastContainerMarker
dedent|''
name|'def'
name|'testLastContainerMarker'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'for'
name|'format_type'
name|'in'
op|'['
name|'None'
op|','
string|"'json'"
op|','
string|"'xml'"
op|']'
op|':'
newline|'\n'
indent|'            '
name|'containers'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'account'
op|'.'
name|'containers'
op|'('
op|'{'
string|"'format'"
op|':'
name|'format_type'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'len'
op|'('
name|'containers'
op|')'
op|','
name|'len'
op|'('
name|'self'
op|'.'
name|'env'
op|'.'
name|'containers'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'200'
op|')'
newline|'\n'
nl|'\n'
name|'containers'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'account'
op|'.'
name|'containers'
op|'('
nl|'\n'
name|'parms'
op|'='
op|'{'
string|"'format'"
op|':'
name|'format_type'
op|','
string|"'marker'"
op|':'
name|'containers'
op|'['
op|'-'
number|'1'
op|']'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'len'
op|'('
name|'containers'
op|')'
op|','
number|'0'
op|')'
newline|'\n'
name|'if'
name|'format_type'
name|'is'
name|'None'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'204'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'200'
op|')'
newline|'\n'
nl|'\n'
DECL|member|testMarkerLimitContainerList
dedent|''
dedent|''
dedent|''
name|'def'
name|'testMarkerLimitContainerList'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'for'
name|'format_type'
name|'in'
op|'['
name|'None'
op|','
string|"'json'"
op|','
string|"'xml'"
op|']'
op|':'
newline|'\n'
indent|'            '
name|'for'
name|'marker'
name|'in'
op|'['
string|"'0'"
op|','
string|"'A'"
op|','
string|"'I'"
op|','
string|"'R'"
op|','
string|"'Z'"
op|','
string|"'a'"
op|','
string|"'i'"
op|','
string|"'r'"
op|','
string|"'z'"
op|','
nl|'\n'
string|"'abc123'"
op|','
string|"'mnop'"
op|','
string|"'xyz'"
op|']'
op|':'
newline|'\n'
nl|'\n'
indent|'                '
name|'limit'
op|'='
name|'random'
op|'.'
name|'randint'
op|'('
number|'2'
op|','
number|'9'
op|')'
newline|'\n'
name|'containers'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'account'
op|'.'
name|'containers'
op|'('
nl|'\n'
name|'parms'
op|'='
op|'{'
string|"'format'"
op|':'
name|'format_type'
op|','
nl|'\n'
string|"'marker'"
op|':'
name|'marker'
op|','
nl|'\n'
string|"'limit'"
op|':'
name|'limit'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'len'
op|'('
name|'containers'
op|')'
op|'<='
name|'limit'
op|')'
newline|'\n'
name|'if'
name|'containers'
op|':'
newline|'\n'
indent|'                    '
name|'if'
name|'isinstance'
op|'('
name|'containers'
op|'['
number|'0'
op|']'
op|','
name|'dict'
op|')'
op|':'
newline|'\n'
indent|'                        '
name|'containers'
op|'='
op|'['
name|'x'
op|'['
string|"'name'"
op|']'
name|'for'
name|'x'
name|'in'
name|'containers'
op|']'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'locale'
op|'.'
name|'strcoll'
op|'('
name|'containers'
op|'['
number|'0'
op|']'
op|','
name|'marker'
op|')'
op|'>'
number|'0'
op|')'
newline|'\n'
nl|'\n'
DECL|member|testContainersOrderedByName
dedent|''
dedent|''
dedent|''
dedent|''
name|'def'
name|'testContainersOrderedByName'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'for'
name|'format_type'
name|'in'
op|'['
name|'None'
op|','
string|"'json'"
op|','
string|"'xml'"
op|']'
op|':'
newline|'\n'
indent|'            '
name|'containers'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'account'
op|'.'
name|'containers'
op|'('
nl|'\n'
name|'parms'
op|'='
op|'{'
string|"'format'"
op|':'
name|'format_type'
op|'}'
op|')'
newline|'\n'
name|'if'
name|'isinstance'
op|'('
name|'containers'
op|'['
number|'0'
op|']'
op|','
name|'dict'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'containers'
op|'='
op|'['
name|'x'
op|'['
string|"'name'"
op|']'
name|'for'
name|'x'
name|'in'
name|'containers'
op|']'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'sorted'
op|'('
name|'containers'
op|','
name|'cmp'
op|'='
name|'locale'
op|'.'
name|'strcoll'
op|')'
op|','
nl|'\n'
name|'containers'
op|')'
newline|'\n'
nl|'\n'
DECL|member|testQuotedWWWAuthenticateHeader
dedent|''
dedent|''
name|'def'
name|'testQuotedWWWAuthenticateHeader'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# check that the www-authenticate header value with the swift realm'
nl|'\n'
comment|'# is correctly quoted.'
nl|'\n'
indent|'        '
name|'conn'
op|'='
name|'Connection'
op|'('
name|'tf'
op|'.'
name|'config'
op|')'
newline|'\n'
name|'conn'
op|'.'
name|'authenticate'
op|'('
op|')'
newline|'\n'
name|'inserted_html'
op|'='
string|"'<b>Hello World'"
newline|'\n'
name|'hax'
op|'='
string|'\'AUTH_haxx"\\nContent-Length: %d\\n\\n%s\''
op|'%'
op|'('
name|'len'
op|'('
name|'inserted_html'
op|')'
op|','
nl|'\n'
name|'inserted_html'
op|')'
newline|'\n'
name|'quoted_hax'
op|'='
name|'urllib'
op|'.'
name|'parse'
op|'.'
name|'quote'
op|'('
name|'hax'
op|')'
newline|'\n'
name|'conn'
op|'.'
name|'connection'
op|'.'
name|'request'
op|'('
string|"'GET'"
op|','
string|"'/v1/'"
op|'+'
name|'quoted_hax'
op|','
name|'None'
op|','
op|'{'
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'conn'
op|'.'
name|'connection'
op|'.'
name|'getresponse'
op|'('
op|')'
newline|'\n'
name|'resp_headers'
op|'='
name|'dict'
op|'('
name|'resp'
op|'.'
name|'getheaders'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertIn'
op|'('
string|"'www-authenticate'"
op|','
name|'resp_headers'
op|')'
newline|'\n'
name|'actual'
op|'='
name|'resp_headers'
op|'['
string|"'www-authenticate'"
op|']'
newline|'\n'
name|'expected'
op|'='
string|'\'Swift realm="%s"\''
op|'%'
name|'quoted_hax'
newline|'\n'
comment|'# other middleware e.g. auth_token may also set www-authenticate'
nl|'\n'
comment|'# headers in which case actual values will be a comma separated list.'
nl|'\n'
comment|'# check that expected value is among the actual values'
nl|'\n'
name|'self'
op|'.'
name|'assertIn'
op|'('
name|'expected'
op|','
name|'actual'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|TestAccountUTF8
dedent|''
dedent|''
name|'class'
name|'TestAccountUTF8'
op|'('
name|'Base2'
op|','
name|'TestAccount'
op|')'
op|':'
newline|'\n'
DECL|variable|set_up
indent|'    '
name|'set_up'
op|'='
name|'False'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|TestAccountNoContainersEnv
dedent|''
name|'class'
name|'TestAccountNoContainersEnv'
op|'('
name|'object'
op|')'
op|':'
newline|'\n'
indent|'    '
op|'@'
name|'classmethod'
newline|'\n'
DECL|member|setUp
name|'def'
name|'setUp'
op|'('
name|'cls'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'cls'
op|'.'
name|'conn'
op|'='
name|'Connection'
op|'('
name|'tf'
op|'.'
name|'config'
op|')'
newline|'\n'
name|'cls'
op|'.'
name|'conn'
op|'.'
name|'authenticate'
op|'('
op|')'
newline|'\n'
name|'cls'
op|'.'
name|'account'
op|'='
name|'Account'
op|'('
name|'cls'
op|'.'
name|'conn'
op|','
name|'tf'
op|'.'
name|'config'
op|'.'
name|'get'
op|'('
string|"'account'"
op|','
nl|'\n'
name|'tf'
op|'.'
name|'config'
op|'['
string|"'username'"
op|']'
op|')'
op|')'
newline|'\n'
name|'cls'
op|'.'
name|'account'
op|'.'
name|'delete_containers'
op|'('
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|TestAccountNoContainers
dedent|''
dedent|''
name|'class'
name|'TestAccountNoContainers'
op|'('
name|'Base'
op|')'
op|':'
newline|'\n'
DECL|variable|env
indent|'    '
name|'env'
op|'='
name|'TestAccountNoContainersEnv'
newline|'\n'
DECL|variable|set_up
name|'set_up'
op|'='
name|'False'
newline|'\n'
nl|'\n'
DECL|member|testGetRequest
name|'def'
name|'testGetRequest'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'for'
name|'format_type'
name|'in'
op|'['
name|'None'
op|','
string|"'json'"
op|','
string|"'xml'"
op|']'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'self'
op|'.'
name|'env'
op|'.'
name|'account'
op|'.'
name|'containers'
op|'('
nl|'\n'
name|'parms'
op|'='
op|'{'
string|"'format'"
op|':'
name|'format_type'
op|'}'
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'if'
name|'format_type'
name|'is'
name|'None'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'204'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'200'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|TestAccountNoContainersUTF8
dedent|''
dedent|''
dedent|''
dedent|''
name|'class'
name|'TestAccountNoContainersUTF8'
op|'('
name|'Base2'
op|','
name|'TestAccountNoContainers'
op|')'
op|':'
newline|'\n'
DECL|variable|set_up
indent|'    '
name|'set_up'
op|'='
name|'False'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|TestAccountSortingEnv
dedent|''
name|'class'
name|'TestAccountSortingEnv'
op|'('
name|'object'
op|')'
op|':'
newline|'\n'
indent|'    '
op|'@'
name|'classmethod'
newline|'\n'
DECL|member|setUp
name|'def'
name|'setUp'
op|'('
name|'cls'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'cls'
op|'.'
name|'conn'
op|'='
name|'Connection'
op|'('
name|'tf'
op|'.'
name|'config'
op|')'
newline|'\n'
name|'cls'
op|'.'
name|'conn'
op|'.'
name|'authenticate'
op|'('
op|')'
newline|'\n'
name|'cls'
op|'.'
name|'account'
op|'='
name|'Account'
op|'('
name|'cls'
op|'.'
name|'conn'
op|','
name|'tf'
op|'.'
name|'config'
op|'.'
name|'get'
op|'('
string|"'account'"
op|','
nl|'\n'
name|'tf'
op|'.'
name|'config'
op|'['
string|"'username'"
op|']'
op|')'
op|')'
newline|'\n'
name|'cls'
op|'.'
name|'account'
op|'.'
name|'delete_containers'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'postfix'
op|'='
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
newline|'\n'
name|'cls'
op|'.'
name|'cont_items'
op|'='
op|'('
string|"'a1'"
op|','
string|"'a2'"
op|','
string|"'A3'"
op|','
string|"'b1'"
op|','
string|"'B2'"
op|','
string|"'a10'"
op|','
string|"'b10'"
op|','
string|"'zz'"
op|')'
newline|'\n'
name|'cls'
op|'.'
name|'cont_items'
op|'='
op|'['
string|"'%s%s'"
op|'%'
op|'('
name|'x'
op|','
name|'postfix'
op|')'
name|'for'
name|'x'
name|'in'
name|'cls'
op|'.'
name|'cont_items'
op|']'
newline|'\n'
nl|'\n'
name|'for'
name|'container'
name|'in'
name|'cls'
op|'.'
name|'cont_items'
op|':'
newline|'\n'
indent|'            '
name|'c'
op|'='
name|'cls'
op|'.'
name|'account'
op|'.'
name|'container'
op|'('
name|'container'
op|')'
newline|'\n'
name|'if'
name|'not'
name|'c'
op|'.'
name|'create'
op|'('
op|')'
op|':'
newline|'\n'
indent|'                '
name|'raise'
name|'ResponseError'
op|'('
name|'cls'
op|'.'
name|'conn'
op|'.'
name|'response'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|TestAccountSorting
dedent|''
dedent|''
dedent|''
dedent|''
name|'class'
name|'TestAccountSorting'
op|'('
name|'Base'
op|')'
op|':'
newline|'\n'
DECL|variable|env
indent|'    '
name|'env'
op|'='
name|'TestAccountSortingEnv'
newline|'\n'
DECL|variable|set_up
name|'set_up'
op|'='
name|'False'
newline|'\n'
nl|'\n'
DECL|member|testAccountContainerListSorting
name|'def'
name|'testAccountContainerListSorting'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# name (byte order) sorting.'
nl|'\n'
indent|'        '
name|'cont_list'
op|'='
name|'sorted'
op|'('
name|'self'
op|'.'
name|'env'
op|'.'
name|'cont_items'
op|')'
newline|'\n'
name|'for'
name|'reverse'
name|'in'
op|'('
string|"'false'"
op|','
string|"'no'"
op|','
string|"'off'"
op|','
string|"''"
op|','
string|"'garbage'"
op|')'
op|':'
newline|'\n'
indent|'            '
name|'cont_listing'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'account'
op|'.'
name|'containers'
op|'('
nl|'\n'
name|'parms'
op|'='
op|'{'
string|"'reverse'"
op|':'
name|'reverse'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'200'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'cont_list'
op|','
name|'cont_listing'
op|','
nl|'\n'
string|"'Expected %s but got %s with reverse param %r'"
nl|'\n'
op|'%'
op|'('
name|'cont_list'
op|','
name|'cont_listing'
op|','
name|'reverse'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|testAccountContainerListSortingReverse
dedent|''
dedent|''
name|'def'
name|'testAccountContainerListSortingReverse'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# name (byte order) sorting.'
nl|'\n'
indent|'        '
name|'cont_list'
op|'='
name|'sorted'
op|'('
name|'self'
op|'.'
name|'env'
op|'.'
name|'cont_items'
op|')'
newline|'\n'
name|'cont_list'
op|'.'
name|'reverse'
op|'('
op|')'
newline|'\n'
name|'for'
name|'reverse'
name|'in'
op|'('
string|"'true'"
op|','
string|"'1'"
op|','
string|"'yes'"
op|','
string|"'on'"
op|','
string|"'t'"
op|','
string|"'y'"
op|')'
op|':'
newline|'\n'
indent|'            '
name|'cont_listing'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'account'
op|'.'
name|'containers'
op|'('
nl|'\n'
name|'parms'
op|'='
op|'{'
string|"'reverse'"
op|':'
name|'reverse'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'200'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'cont_list'
op|','
name|'cont_listing'
op|','
nl|'\n'
string|"'Expected %s but got %s with reverse param %r'"
nl|'\n'
op|'%'
op|'('
name|'cont_list'
op|','
name|'cont_listing'
op|','
name|'reverse'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|testAccountContainerListSortingByPrefix
dedent|''
dedent|''
name|'def'
name|'testAccountContainerListSortingByPrefix'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'cont_list'
op|'='
name|'sorted'
op|'('
name|'c'
name|'for'
name|'c'
name|'in'
name|'self'
op|'.'
name|'env'
op|'.'
name|'cont_items'
name|'if'
name|'c'
op|'.'
name|'startswith'
op|'('
string|"'a'"
op|')'
op|')'
newline|'\n'
name|'cont_list'
op|'.'
name|'reverse'
op|'('
op|')'
newline|'\n'
name|'cont_listing'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'account'
op|'.'
name|'containers'
op|'('
name|'parms'
op|'='
op|'{'
nl|'\n'
string|"'reverse'"
op|':'
string|"'on'"
op|','
string|"'prefix'"
op|':'
string|"'a'"
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'200'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'cont_list'
op|','
name|'cont_listing'
op|')'
newline|'\n'
nl|'\n'
DECL|member|testAccountContainerListSortingByMarkersExclusive
dedent|''
name|'def'
name|'testAccountContainerListSortingByMarkersExclusive'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'first_item'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'cont_items'
op|'['
number|'3'
op|']'
comment|"# 'b1' + postfix"
newline|'\n'
name|'last_item'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'cont_items'
op|'['
number|'4'
op|']'
comment|"# 'B2' + postfix"
newline|'\n'
nl|'\n'
name|'cont_list'
op|'='
name|'sorted'
op|'('
name|'c'
name|'for'
name|'c'
name|'in'
name|'self'
op|'.'
name|'env'
op|'.'
name|'cont_items'
nl|'\n'
name|'if'
name|'last_item'
op|'<'
name|'c'
op|'<'
name|'first_item'
op|')'
newline|'\n'
name|'cont_list'
op|'.'
name|'reverse'
op|'('
op|')'
newline|'\n'
name|'cont_listing'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'account'
op|'.'
name|'containers'
op|'('
name|'parms'
op|'='
op|'{'
nl|'\n'
string|"'reverse'"
op|':'
string|"'on'"
op|','
string|"'marker'"
op|':'
name|'first_item'
op|','
string|"'end_marker'"
op|':'
name|'last_item'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'200'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'cont_list'
op|','
name|'cont_listing'
op|')'
newline|'\n'
nl|'\n'
DECL|member|testAccountContainerListSortingByMarkersInclusive
dedent|''
name|'def'
name|'testAccountContainerListSortingByMarkersInclusive'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'first_item'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'cont_items'
op|'['
number|'3'
op|']'
comment|"# 'b1' + postfix"
newline|'\n'
name|'last_item'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'cont_items'
op|'['
number|'4'
op|']'
comment|"# 'B2' + postfix"
newline|'\n'
nl|'\n'
name|'cont_list'
op|'='
name|'sorted'
op|'('
name|'c'
name|'for'
name|'c'
name|'in'
name|'self'
op|'.'
name|'env'
op|'.'
name|'cont_items'
nl|'\n'
name|'if'
name|'last_item'
op|'<='
name|'c'
op|'<='
name|'first_item'
op|')'
newline|'\n'
name|'cont_list'
op|'.'
name|'reverse'
op|'('
op|')'
newline|'\n'
name|'cont_listing'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'account'
op|'.'
name|'containers'
op|'('
name|'parms'
op|'='
op|'{'
nl|'\n'
string|"'reverse'"
op|':'
string|"'on'"
op|','
string|"'marker'"
op|':'
name|'first_item'
op|'+'
string|"'\\x00'"
op|','
nl|'\n'
string|"'end_marker'"
op|':'
name|'last_item'
op|'['
op|':'
op|'-'
number|'1'
op|']'
op|'+'
name|'chr'
op|'('
name|'ord'
op|'('
name|'last_item'
op|'['
op|'-'
number|'1'
op|']'
op|')'
op|'-'
number|'1'
op|')'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'200'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'cont_list'
op|','
name|'cont_listing'
op|')'
newline|'\n'
nl|'\n'
DECL|member|testAccountContainerListSortingByReversedMarkers
dedent|''
name|'def'
name|'testAccountContainerListSortingByReversedMarkers'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'cont_listing'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'account'
op|'.'
name|'containers'
op|'('
name|'parms'
op|'='
op|'{'
nl|'\n'
string|"'reverse'"
op|':'
string|"'on'"
op|','
string|"'marker'"
op|':'
string|"'B'"
op|','
string|"'end_marker'"
op|':'
string|"'b1'"
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'204'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
op|'['
op|']'
op|','
name|'cont_listing'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|TestContainerEnv
dedent|''
dedent|''
name|'class'
name|'TestContainerEnv'
op|'('
name|'object'
op|')'
op|':'
newline|'\n'
indent|'    '
op|'@'
name|'classmethod'
newline|'\n'
DECL|member|setUp
name|'def'
name|'setUp'
op|'('
name|'cls'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'cls'
op|'.'
name|'conn'
op|'='
name|'Connection'
op|'('
name|'tf'
op|'.'
name|'config'
op|')'
newline|'\n'
name|'cls'
op|'.'
name|'conn'
op|'.'
name|'authenticate'
op|'('
op|')'
newline|'\n'
name|'cls'
op|'.'
name|'account'
op|'='
name|'Account'
op|'('
name|'cls'
op|'.'
name|'conn'
op|','
name|'tf'
op|'.'
name|'config'
op|'.'
name|'get'
op|'('
string|"'account'"
op|','
nl|'\n'
name|'tf'
op|'.'
name|'config'
op|'['
string|"'username'"
op|']'
op|')'
op|')'
newline|'\n'
name|'cls'
op|'.'
name|'account'
op|'.'
name|'delete_containers'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'cls'
op|'.'
name|'container'
op|'='
name|'cls'
op|'.'
name|'account'
op|'.'
name|'container'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
name|'if'
name|'not'
name|'cls'
op|'.'
name|'container'
op|'.'
name|'create'
op|'('
op|')'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'ResponseError'
op|'('
name|'cls'
op|'.'
name|'conn'
op|'.'
name|'response'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'cls'
op|'.'
name|'file_count'
op|'='
number|'10'
newline|'\n'
name|'cls'
op|'.'
name|'file_size'
op|'='
number|'128'
newline|'\n'
name|'cls'
op|'.'
name|'files'
op|'='
name|'list'
op|'('
op|')'
newline|'\n'
name|'for'
name|'x'
name|'in'
name|'range'
op|'('
name|'cls'
op|'.'
name|'file_count'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'file_item'
op|'='
name|'cls'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
name|'file_item'
op|'.'
name|'write_random'
op|'('
name|'cls'
op|'.'
name|'file_size'
op|')'
newline|'\n'
name|'cls'
op|'.'
name|'files'
op|'.'
name|'append'
op|'('
name|'file_item'
op|'.'
name|'name'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|TestContainerDev
dedent|''
dedent|''
dedent|''
name|'class'
name|'TestContainerDev'
op|'('
name|'Base'
op|')'
op|':'
newline|'\n'
DECL|variable|env
indent|'    '
name|'env'
op|'='
name|'TestContainerEnv'
newline|'\n'
DECL|variable|set_up
name|'set_up'
op|'='
name|'False'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|TestContainerDevUTF8
dedent|''
name|'class'
name|'TestContainerDevUTF8'
op|'('
name|'Base2'
op|','
name|'TestContainerDev'
op|')'
op|':'
newline|'\n'
DECL|variable|set_up
indent|'    '
name|'set_up'
op|'='
name|'False'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|TestContainer
dedent|''
name|'class'
name|'TestContainer'
op|'('
name|'Base'
op|')'
op|':'
newline|'\n'
DECL|variable|env
indent|'    '
name|'env'
op|'='
name|'TestContainerEnv'
newline|'\n'
DECL|variable|set_up
name|'set_up'
op|'='
name|'False'
newline|'\n'
nl|'\n'
DECL|member|testContainerNameLimit
name|'def'
name|'testContainerNameLimit'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'limit'
op|'='
name|'load_constraint'
op|'('
string|"'max_container_name_length'"
op|')'
newline|'\n'
nl|'\n'
name|'for'
name|'l'
name|'in'
op|'('
name|'limit'
op|'-'
number|'100'
op|','
name|'limit'
op|'-'
number|'10'
op|','
name|'limit'
op|'-'
number|'1'
op|','
name|'limit'
op|','
nl|'\n'
name|'limit'
op|'+'
number|'1'
op|','
name|'limit'
op|'+'
number|'10'
op|','
name|'limit'
op|'+'
number|'100'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'cont'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'account'
op|'.'
name|'container'
op|'('
string|"'a'"
op|'*'
name|'l'
op|')'
newline|'\n'
name|'if'
name|'l'
op|'<='
name|'limit'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'cont'
op|'.'
name|'create'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'201'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'cont'
op|'.'
name|'create'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'400'
op|')'
newline|'\n'
nl|'\n'
DECL|member|testFileThenContainerDelete
dedent|''
dedent|''
dedent|''
name|'def'
name|'testFileThenContainerDelete'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'cont'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'account'
op|'.'
name|'container'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'cont'
op|'.'
name|'create'
op|'('
op|')'
op|')'
newline|'\n'
name|'file_item'
op|'='
name|'cont'
op|'.'
name|'file'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'file_item'
op|'.'
name|'write_random'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'file_item'
op|'.'
name|'delete'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'204'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertNotIn'
op|'('
name|'file_item'
op|'.'
name|'name'
op|','
name|'cont'
op|'.'
name|'files'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'cont'
op|'.'
name|'delete'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'204'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertNotIn'
op|'('
name|'cont'
op|'.'
name|'name'
op|','
name|'self'
op|'.'
name|'env'
op|'.'
name|'account'
op|'.'
name|'containers'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|testFileListingLimitMarkerPrefix
dedent|''
name|'def'
name|'testFileListingLimitMarkerPrefix'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'cont'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'account'
op|'.'
name|'container'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'cont'
op|'.'
name|'create'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'files'
op|'='
name|'sorted'
op|'('
op|'['
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
name|'for'
name|'x'
name|'in'
name|'range'
op|'('
number|'10'
op|')'
op|']'
op|')'
newline|'\n'
name|'for'
name|'f'
name|'in'
name|'files'
op|':'
newline|'\n'
indent|'            '
name|'file_item'
op|'='
name|'cont'
op|'.'
name|'file'
op|'('
name|'f'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'file_item'
op|'.'
name|'write_random'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'for'
name|'i'
name|'in'
name|'range'
op|'('
name|'len'
op|'('
name|'files'
op|')'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'f'
op|'='
name|'files'
op|'['
name|'i'
op|']'
newline|'\n'
name|'for'
name|'j'
name|'in'
name|'range'
op|'('
number|'1'
op|','
name|'len'
op|'('
name|'files'
op|')'
op|'-'
name|'i'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'assertTrue'
op|'('
nl|'\n'
name|'cont'
op|'.'
name|'files'
op|'('
name|'parms'
op|'='
op|'{'
string|"'limit'"
op|':'
name|'j'
op|','
string|"'marker'"
op|':'
name|'f'
op|'}'
op|')'
op|'=='
nl|'\n'
name|'files'
op|'['
name|'i'
op|'+'
number|'1'
op|':'
name|'i'
op|'+'
name|'j'
op|'+'
number|'1'
op|']'
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'cont'
op|'.'
name|'files'
op|'('
name|'parms'
op|'='
op|'{'
string|"'marker'"
op|':'
name|'f'
op|'}'
op|')'
op|'=='
name|'files'
op|'['
name|'i'
op|'+'
number|'1'
op|':'
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'cont'
op|'.'
name|'files'
op|'('
name|'parms'
op|'='
op|'{'
string|"'marker'"
op|':'
name|'f'
op|','
string|"'prefix'"
op|':'
name|'f'
op|'}'
op|')'
op|'=='
op|'['
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'cont'
op|'.'
name|'files'
op|'('
name|'parms'
op|'='
op|'{'
string|"'prefix'"
op|':'
name|'f'
op|'}'
op|')'
op|'=='
op|'['
name|'f'
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|testPrefixAndLimit
dedent|''
dedent|''
name|'def'
name|'testPrefixAndLimit'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'load_constraint'
op|'('
string|"'container_listing_limit'"
op|')'
newline|'\n'
name|'cont'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'account'
op|'.'
name|'container'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'cont'
op|'.'
name|'create'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'prefix_file_count'
op|'='
number|'10'
newline|'\n'
name|'limit_count'
op|'='
number|'2'
newline|'\n'
name|'prefixs'
op|'='
op|'['
string|"'alpha/'"
op|','
string|"'beta/'"
op|','
string|"'kappa/'"
op|']'
newline|'\n'
name|'prefix_files'
op|'='
op|'{'
op|'}'
newline|'\n'
nl|'\n'
name|'for'
name|'prefix'
name|'in'
name|'prefixs'
op|':'
newline|'\n'
indent|'            '
name|'prefix_files'
op|'['
name|'prefix'
op|']'
op|'='
op|'['
op|']'
newline|'\n'
nl|'\n'
name|'for'
name|'i'
name|'in'
name|'range'
op|'('
name|'prefix_file_count'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'file_item'
op|'='
name|'cont'
op|'.'
name|'file'
op|'('
name|'prefix'
op|'+'
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
name|'file_item'
op|'.'
name|'write'
op|'('
op|')'
newline|'\n'
name|'prefix_files'
op|'['
name|'prefix'
op|']'
op|'.'
name|'append'
op|'('
name|'file_item'
op|'.'
name|'name'
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'for'
name|'format_type'
name|'in'
op|'['
name|'None'
op|','
string|"'json'"
op|','
string|"'xml'"
op|']'
op|':'
newline|'\n'
indent|'            '
name|'for'
name|'prefix'
name|'in'
name|'prefixs'
op|':'
newline|'\n'
indent|'                '
name|'files'
op|'='
name|'cont'
op|'.'
name|'files'
op|'('
name|'parms'
op|'='
op|'{'
string|"'prefix'"
op|':'
name|'prefix'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'files'
op|','
name|'sorted'
op|'('
name|'prefix_files'
op|'['
name|'prefix'
op|']'
op|')'
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'for'
name|'format_type'
name|'in'
op|'['
name|'None'
op|','
string|"'json'"
op|','
string|"'xml'"
op|']'
op|':'
newline|'\n'
indent|'            '
name|'for'
name|'prefix'
name|'in'
name|'prefixs'
op|':'
newline|'\n'
indent|'                '
name|'files'
op|'='
name|'cont'
op|'.'
name|'files'
op|'('
name|'parms'
op|'='
op|'{'
string|"'limit'"
op|':'
name|'limit_count'
op|','
nl|'\n'
string|"'prefix'"
op|':'
name|'prefix'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'len'
op|'('
name|'files'
op|')'
op|','
name|'limit_count'
op|')'
newline|'\n'
nl|'\n'
name|'for'
name|'file_item'
name|'in'
name|'files'
op|':'
newline|'\n'
indent|'                    '
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'file_item'
op|'.'
name|'startswith'
op|'('
name|'prefix'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|testListDelimiter
dedent|''
dedent|''
dedent|''
dedent|''
name|'def'
name|'testListDelimiter'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'cont'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'account'
op|'.'
name|'container'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'cont'
op|'.'
name|'create'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'delimiter'
op|'='
string|"'-'"
newline|'\n'
name|'files'
op|'='
op|'['
string|"'test'"
op|','
name|'delimiter'
op|'.'
name|'join'
op|'('
op|'['
string|"'test'"
op|','
string|"'bar'"
op|']'
op|')'
op|','
nl|'\n'
name|'delimiter'
op|'.'
name|'join'
op|'('
op|'['
string|"'test'"
op|','
string|"'foo'"
op|']'
op|')'
op|']'
newline|'\n'
name|'for'
name|'f'
name|'in'
name|'files'
op|':'
newline|'\n'
indent|'            '
name|'file_item'
op|'='
name|'cont'
op|'.'
name|'file'
op|'('
name|'f'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'file_item'
op|'.'
name|'write_random'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'results'
op|'='
name|'cont'
op|'.'
name|'files'
op|'('
op|')'
newline|'\n'
name|'results'
op|'='
name|'cont'
op|'.'
name|'files'
op|'('
name|'parms'
op|'='
op|'{'
string|"'delimiter'"
op|':'
name|'delimiter'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'results'
op|','
op|'['
string|"'test'"
op|','
string|"'test-'"
op|']'
op|')'
newline|'\n'
nl|'\n'
name|'results'
op|'='
name|'cont'
op|'.'
name|'files'
op|'('
name|'parms'
op|'='
op|'{'
string|"'delimiter'"
op|':'
name|'delimiter'
op|','
string|"'reverse'"
op|':'
string|"'yes'"
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'results'
op|','
op|'['
string|"'test-'"
op|','
string|"'test'"
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|testListDelimiterAndPrefix
dedent|''
name|'def'
name|'testListDelimiterAndPrefix'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'cont'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'account'
op|'.'
name|'container'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'cont'
op|'.'
name|'create'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'delimiter'
op|'='
string|"'a'"
newline|'\n'
name|'files'
op|'='
op|'['
string|"'bar'"
op|','
string|"'bazar'"
op|']'
newline|'\n'
name|'for'
name|'f'
name|'in'
name|'files'
op|':'
newline|'\n'
indent|'            '
name|'file_item'
op|'='
name|'cont'
op|'.'
name|'file'
op|'('
name|'f'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'file_item'
op|'.'
name|'write_random'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'results'
op|'='
name|'cont'
op|'.'
name|'files'
op|'('
name|'parms'
op|'='
op|'{'
string|"'delimiter'"
op|':'
name|'delimiter'
op|','
string|"'prefix'"
op|':'
string|"'ba'"
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'results'
op|','
op|'['
string|"'bar'"
op|','
string|"'baza'"
op|']'
op|')'
newline|'\n'
nl|'\n'
name|'results'
op|'='
name|'cont'
op|'.'
name|'files'
op|'('
name|'parms'
op|'='
op|'{'
string|"'delimiter'"
op|':'
name|'delimiter'
op|','
nl|'\n'
string|"'prefix'"
op|':'
string|"'ba'"
op|','
nl|'\n'
string|"'reverse'"
op|':'
string|"'yes'"
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'results'
op|','
op|'['
string|"'baza'"
op|','
string|"'bar'"
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|testLeadingDelimiter
dedent|''
name|'def'
name|'testLeadingDelimiter'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'cont'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'account'
op|'.'
name|'container'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'cont'
op|'.'
name|'create'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'delimiter'
op|'='
string|"'/'"
newline|'\n'
name|'files'
op|'='
op|'['
string|"'test'"
op|','
name|'delimiter'
op|'.'
name|'join'
op|'('
op|'['
string|"''"
op|','
string|"'test'"
op|','
string|"'bar'"
op|']'
op|')'
op|','
nl|'\n'
name|'delimiter'
op|'.'
name|'join'
op|'('
op|'['
string|"''"
op|','
string|"'test'"
op|','
string|"'bar'"
op|','
string|"'foo'"
op|']'
op|')'
op|']'
newline|'\n'
name|'for'
name|'f'
name|'in'
name|'files'
op|':'
newline|'\n'
indent|'            '
name|'file_item'
op|'='
name|'cont'
op|'.'
name|'file'
op|'('
name|'f'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'file_item'
op|'.'
name|'write_random'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'results'
op|'='
name|'cont'
op|'.'
name|'files'
op|'('
name|'parms'
op|'='
op|'{'
string|"'delimiter'"
op|':'
name|'delimiter'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'results'
op|','
op|'['
name|'delimiter'
op|','
string|"'test'"
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|testCreate
dedent|''
name|'def'
name|'testCreate'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'cont'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'account'
op|'.'
name|'container'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'cont'
op|'.'
name|'create'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'201'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertIn'
op|'('
name|'cont'
op|'.'
name|'name'
op|','
name|'self'
op|'.'
name|'env'
op|'.'
name|'account'
op|'.'
name|'containers'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|testContainerFileListOnContainerThatDoesNotExist
dedent|''
name|'def'
name|'testContainerFileListOnContainerThatDoesNotExist'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'for'
name|'format_type'
name|'in'
op|'['
name|'None'
op|','
string|"'json'"
op|','
string|"'xml'"
op|']'
op|':'
newline|'\n'
indent|'            '
name|'container'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'account'
op|'.'
name|'container'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ResponseError'
op|','
name|'container'
op|'.'
name|'files'
op|','
nl|'\n'
name|'parms'
op|'='
op|'{'
string|"'format'"
op|':'
name|'format_type'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'404'
op|')'
newline|'\n'
nl|'\n'
DECL|member|testUtf8Container
dedent|''
dedent|''
name|'def'
name|'testUtf8Container'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'valid_utf8'
op|'='
name|'Utils'
op|'.'
name|'create_utf8_name'
op|'('
op|')'
newline|'\n'
name|'invalid_utf8'
op|'='
name|'valid_utf8'
op|'['
op|':'
op|':'
op|'-'
number|'1'
op|']'
newline|'\n'
name|'container'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'account'
op|'.'
name|'container'
op|'('
name|'valid_utf8'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'container'
op|'.'
name|'create'
op|'('
name|'cfg'
op|'='
op|'{'
string|"'no_path_quote'"
op|':'
name|'True'
op|'}'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertIn'
op|'('
name|'container'
op|'.'
name|'name'
op|','
name|'self'
op|'.'
name|'env'
op|'.'
name|'account'
op|'.'
name|'containers'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'container'
op|'.'
name|'files'
op|'('
op|')'
op|','
op|'['
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'container'
op|'.'
name|'delete'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'container'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'account'
op|'.'
name|'container'
op|'('
name|'invalid_utf8'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'container'
op|'.'
name|'create'
op|'('
name|'cfg'
op|'='
op|'{'
string|"'no_path_quote'"
op|':'
name|'True'
op|'}'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'412'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ResponseError'
op|','
name|'container'
op|'.'
name|'files'
op|','
nl|'\n'
name|'cfg'
op|'='
op|'{'
string|"'no_path_quote'"
op|':'
name|'True'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'412'
op|')'
newline|'\n'
nl|'\n'
DECL|member|testCreateOnExisting
dedent|''
name|'def'
name|'testCreateOnExisting'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'cont'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'account'
op|'.'
name|'container'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'cont'
op|'.'
name|'create'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'201'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'cont'
op|'.'
name|'create'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'202'
op|')'
newline|'\n'
nl|'\n'
DECL|member|testSlashInName
dedent|''
name|'def'
name|'testSlashInName'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'Utils'
op|'.'
name|'create_name'
op|'=='
name|'Utils'
op|'.'
name|'create_utf8_name'
op|':'
newline|'\n'
indent|'            '
name|'cont_name'
op|'='
name|'list'
op|'('
name|'six'
op|'.'
name|'text_type'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|','
string|"'utf-8'"
op|')'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'cont_name'
op|'='
name|'list'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'cont_name'
op|'['
name|'random'
op|'.'
name|'randint'
op|'('
number|'2'
op|','
name|'len'
op|'('
name|'cont_name'
op|')'
op|'-'
number|'2'
op|')'
op|']'
op|'='
string|"'/'"
newline|'\n'
name|'cont_name'
op|'='
string|"''"
op|'.'
name|'join'
op|'('
name|'cont_name'
op|')'
newline|'\n'
nl|'\n'
name|'if'
name|'Utils'
op|'.'
name|'create_name'
op|'=='
name|'Utils'
op|'.'
name|'create_utf8_name'
op|':'
newline|'\n'
indent|'            '
name|'cont_name'
op|'='
name|'cont_name'
op|'.'
name|'encode'
op|'('
string|"'utf-8'"
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'cont'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'account'
op|'.'
name|'container'
op|'('
name|'cont_name'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'cont'
op|'.'
name|'create'
op|'('
name|'cfg'
op|'='
op|'{'
string|"'no_path_quote'"
op|':'
name|'True'
op|'}'
op|')'
op|','
nl|'\n'
string|"'created container with name %s'"
op|'%'
op|'('
name|'cont_name'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'404'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertNotIn'
op|'('
name|'cont'
op|'.'
name|'name'
op|','
name|'self'
op|'.'
name|'env'
op|'.'
name|'account'
op|'.'
name|'containers'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|testDelete
dedent|''
name|'def'
name|'testDelete'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'cont'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'account'
op|'.'
name|'container'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'cont'
op|'.'
name|'create'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'201'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'cont'
op|'.'
name|'delete'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'204'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertNotIn'
op|'('
name|'cont'
op|'.'
name|'name'
op|','
name|'self'
op|'.'
name|'env'
op|'.'
name|'account'
op|'.'
name|'containers'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|testDeleteOnContainerThatDoesNotExist
dedent|''
name|'def'
name|'testDeleteOnContainerThatDoesNotExist'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'cont'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'account'
op|'.'
name|'container'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'cont'
op|'.'
name|'delete'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'404'
op|')'
newline|'\n'
nl|'\n'
DECL|member|testDeleteOnContainerWithFiles
dedent|''
name|'def'
name|'testDeleteOnContainerWithFiles'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'cont'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'account'
op|'.'
name|'container'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'cont'
op|'.'
name|'create'
op|'('
op|')'
op|')'
newline|'\n'
name|'file_item'
op|'='
name|'cont'
op|'.'
name|'file'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
name|'file_item'
op|'.'
name|'write_random'
op|'('
name|'self'
op|'.'
name|'env'
op|'.'
name|'file_size'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertIn'
op|'('
name|'file_item'
op|'.'
name|'name'
op|','
name|'cont'
op|'.'
name|'files'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'cont'
op|'.'
name|'delete'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'409'
op|')'
newline|'\n'
nl|'\n'
DECL|member|testFileCreateInContainerThatDoesNotExist
dedent|''
name|'def'
name|'testFileCreateInContainerThatDoesNotExist'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'file_item'
op|'='
name|'File'
op|'('
name|'self'
op|'.'
name|'env'
op|'.'
name|'conn'
op|','
name|'self'
op|'.'
name|'env'
op|'.'
name|'account'
op|','
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|','
nl|'\n'
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ResponseError'
op|','
name|'file_item'
op|'.'
name|'write'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'404'
op|')'
newline|'\n'
nl|'\n'
DECL|member|testLastFileMarker
dedent|''
name|'def'
name|'testLastFileMarker'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'for'
name|'format_type'
name|'in'
op|'['
name|'None'
op|','
string|"'json'"
op|','
string|"'xml'"
op|']'
op|':'
newline|'\n'
indent|'            '
name|'files'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'files'
op|'('
op|'{'
string|"'format'"
op|':'
name|'format_type'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'len'
op|'('
name|'files'
op|')'
op|','
name|'len'
op|'('
name|'self'
op|'.'
name|'env'
op|'.'
name|'files'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'200'
op|')'
newline|'\n'
nl|'\n'
name|'files'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'files'
op|'('
nl|'\n'
name|'parms'
op|'='
op|'{'
string|"'format'"
op|':'
name|'format_type'
op|','
string|"'marker'"
op|':'
name|'files'
op|'['
op|'-'
number|'1'
op|']'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'len'
op|'('
name|'files'
op|')'
op|','
number|'0'
op|')'
newline|'\n'
nl|'\n'
name|'if'
name|'format_type'
name|'is'
name|'None'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'204'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'200'
op|')'
newline|'\n'
nl|'\n'
DECL|member|testContainerFileList
dedent|''
dedent|''
dedent|''
name|'def'
name|'testContainerFileList'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'for'
name|'format_type'
name|'in'
op|'['
name|'None'
op|','
string|"'json'"
op|','
string|"'xml'"
op|']'
op|':'
newline|'\n'
indent|'            '
name|'files'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'files'
op|'('
name|'parms'
op|'='
op|'{'
string|"'format'"
op|':'
name|'format_type'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'200'
op|')'
newline|'\n'
name|'if'
name|'isinstance'
op|'('
name|'files'
op|'['
number|'0'
op|']'
op|','
name|'dict'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'files'
op|'='
op|'['
name|'x'
op|'['
string|"'name'"
op|']'
name|'for'
name|'x'
name|'in'
name|'files'
op|']'
newline|'\n'
nl|'\n'
dedent|''
name|'for'
name|'file_item'
name|'in'
name|'self'
op|'.'
name|'env'
op|'.'
name|'files'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'assertIn'
op|'('
name|'file_item'
op|','
name|'files'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'for'
name|'file_item'
name|'in'
name|'files'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'assertIn'
op|'('
name|'file_item'
op|','
name|'self'
op|'.'
name|'env'
op|'.'
name|'files'
op|')'
newline|'\n'
nl|'\n'
DECL|member|testMarkerLimitFileList
dedent|''
dedent|''
dedent|''
name|'def'
name|'testMarkerLimitFileList'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'for'
name|'format_type'
name|'in'
op|'['
name|'None'
op|','
string|"'json'"
op|','
string|"'xml'"
op|']'
op|':'
newline|'\n'
indent|'            '
name|'for'
name|'marker'
name|'in'
op|'['
string|"'0'"
op|','
string|"'A'"
op|','
string|"'I'"
op|','
string|"'R'"
op|','
string|"'Z'"
op|','
string|"'a'"
op|','
string|"'i'"
op|','
string|"'r'"
op|','
string|"'z'"
op|','
nl|'\n'
string|"'abc123'"
op|','
string|"'mnop'"
op|','
string|"'xyz'"
op|']'
op|':'
newline|'\n'
indent|'                '
name|'limit'
op|'='
name|'random'
op|'.'
name|'randint'
op|'('
number|'2'
op|','
name|'self'
op|'.'
name|'env'
op|'.'
name|'file_count'
op|'-'
number|'1'
op|')'
newline|'\n'
name|'files'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'files'
op|'('
name|'parms'
op|'='
op|'{'
string|"'format'"
op|':'
name|'format_type'
op|','
nl|'\n'
string|"'marker'"
op|':'
name|'marker'
op|','
nl|'\n'
string|"'limit'"
op|':'
name|'limit'
op|'}'
op|')'
newline|'\n'
nl|'\n'
name|'if'
name|'not'
name|'files'
op|':'
newline|'\n'
indent|'                    '
name|'continue'
newline|'\n'
nl|'\n'
dedent|''
name|'if'
name|'isinstance'
op|'('
name|'files'
op|'['
number|'0'
op|']'
op|','
name|'dict'
op|')'
op|':'
newline|'\n'
indent|'                    '
name|'files'
op|'='
op|'['
name|'x'
op|'['
string|"'name'"
op|']'
name|'for'
name|'x'
name|'in'
name|'files'
op|']'
newline|'\n'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'len'
op|'('
name|'files'
op|')'
op|'<='
name|'limit'
op|')'
newline|'\n'
name|'if'
name|'files'
op|':'
newline|'\n'
indent|'                    '
name|'if'
name|'isinstance'
op|'('
name|'files'
op|'['
number|'0'
op|']'
op|','
name|'dict'
op|')'
op|':'
newline|'\n'
indent|'                        '
name|'files'
op|'='
op|'['
name|'x'
op|'['
string|"'name'"
op|']'
name|'for'
name|'x'
name|'in'
name|'files'
op|']'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'locale'
op|'.'
name|'strcoll'
op|'('
name|'files'
op|'['
number|'0'
op|']'
op|','
name|'marker'
op|')'
op|'>'
number|'0'
op|')'
newline|'\n'
nl|'\n'
DECL|member|testFileOrder
dedent|''
dedent|''
dedent|''
dedent|''
name|'def'
name|'testFileOrder'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'for'
name|'format_type'
name|'in'
op|'['
name|'None'
op|','
string|"'json'"
op|','
string|"'xml'"
op|']'
op|':'
newline|'\n'
indent|'            '
name|'files'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'files'
op|'('
name|'parms'
op|'='
op|'{'
string|"'format'"
op|':'
name|'format_type'
op|'}'
op|')'
newline|'\n'
name|'if'
name|'isinstance'
op|'('
name|'files'
op|'['
number|'0'
op|']'
op|','
name|'dict'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'files'
op|'='
op|'['
name|'x'
op|'['
string|"'name'"
op|']'
name|'for'
name|'x'
name|'in'
name|'files'
op|']'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'sorted'
op|'('
name|'files'
op|','
name|'cmp'
op|'='
name|'locale'
op|'.'
name|'strcoll'
op|')'
op|','
name|'files'
op|')'
newline|'\n'
nl|'\n'
DECL|member|testContainerInfo
dedent|''
dedent|''
name|'def'
name|'testContainerInfo'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'info'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'info'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'204'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'info'
op|'['
string|"'object_count'"
op|']'
op|','
name|'self'
op|'.'
name|'env'
op|'.'
name|'file_count'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'info'
op|'['
string|"'bytes_used'"
op|']'
op|','
nl|'\n'
name|'self'
op|'.'
name|'env'
op|'.'
name|'file_count'
op|'*'
name|'self'
op|'.'
name|'env'
op|'.'
name|'file_size'
op|')'
newline|'\n'
nl|'\n'
DECL|member|testContainerInfoOnContainerThatDoesNotExist
dedent|''
name|'def'
name|'testContainerInfoOnContainerThatDoesNotExist'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'container'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'account'
op|'.'
name|'container'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ResponseError'
op|','
name|'container'
op|'.'
name|'info'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'404'
op|')'
newline|'\n'
nl|'\n'
DECL|member|testContainerFileListWithLimit
dedent|''
name|'def'
name|'testContainerFileListWithLimit'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'for'
name|'format_type'
name|'in'
op|'['
name|'None'
op|','
string|"'json'"
op|','
string|"'xml'"
op|']'
op|':'
newline|'\n'
indent|'            '
name|'files'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'files'
op|'('
name|'parms'
op|'='
op|'{'
string|"'format'"
op|':'
name|'format_type'
op|','
nl|'\n'
string|"'limit'"
op|':'
number|'2'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'len'
op|'('
name|'files'
op|')'
op|','
number|'2'
op|')'
newline|'\n'
nl|'\n'
DECL|member|testTooLongName
dedent|''
dedent|''
name|'def'
name|'testTooLongName'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'cont'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'account'
op|'.'
name|'container'
op|'('
string|"'x'"
op|'*'
number|'257'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'cont'
op|'.'
name|'create'
op|'('
op|')'
op|','
nl|'\n'
string|"'created container with name %s'"
op|'%'
op|'('
name|'cont'
op|'.'
name|'name'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'400'
op|')'
newline|'\n'
nl|'\n'
DECL|member|testContainerExistenceCachingProblem
dedent|''
name|'def'
name|'testContainerExistenceCachingProblem'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'cont'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'account'
op|'.'
name|'container'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ResponseError'
op|','
name|'cont'
op|'.'
name|'files'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'cont'
op|'.'
name|'create'
op|'('
op|')'
op|')'
newline|'\n'
name|'cont'
op|'.'
name|'files'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'cont'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'account'
op|'.'
name|'container'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ResponseError'
op|','
name|'cont'
op|'.'
name|'files'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'cont'
op|'.'
name|'create'
op|'('
op|')'
op|')'
newline|'\n'
name|'file_item'
op|'='
name|'cont'
op|'.'
name|'file'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
name|'file_item'
op|'.'
name|'write_random'
op|'('
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|TestContainerUTF8
dedent|''
dedent|''
name|'class'
name|'TestContainerUTF8'
op|'('
name|'Base2'
op|','
name|'TestContainer'
op|')'
op|':'
newline|'\n'
DECL|variable|set_up
indent|'    '
name|'set_up'
op|'='
name|'False'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|TestContainerSortingEnv
dedent|''
name|'class'
name|'TestContainerSortingEnv'
op|'('
name|'object'
op|')'
op|':'
newline|'\n'
indent|'    '
op|'@'
name|'classmethod'
newline|'\n'
DECL|member|setUp
name|'def'
name|'setUp'
op|'('
name|'cls'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'cls'
op|'.'
name|'conn'
op|'='
name|'Connection'
op|'('
name|'tf'
op|'.'
name|'config'
op|')'
newline|'\n'
name|'cls'
op|'.'
name|'conn'
op|'.'
name|'authenticate'
op|'('
op|')'
newline|'\n'
name|'cls'
op|'.'
name|'account'
op|'='
name|'Account'
op|'('
name|'cls'
op|'.'
name|'conn'
op|','
name|'tf'
op|'.'
name|'config'
op|'.'
name|'get'
op|'('
string|"'account'"
op|','
nl|'\n'
name|'tf'
op|'.'
name|'config'
op|'['
string|"'username'"
op|']'
op|')'
op|')'
newline|'\n'
name|'cls'
op|'.'
name|'account'
op|'.'
name|'delete_containers'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'cls'
op|'.'
name|'container'
op|'='
name|'cls'
op|'.'
name|'account'
op|'.'
name|'container'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
name|'if'
name|'not'
name|'cls'
op|'.'
name|'container'
op|'.'
name|'create'
op|'('
op|')'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'ResponseError'
op|'('
name|'cls'
op|'.'
name|'conn'
op|'.'
name|'response'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'cls'
op|'.'
name|'file_items'
op|'='
op|'('
string|"'a1'"
op|','
string|"'a2'"
op|','
string|"'A3'"
op|','
string|"'b1'"
op|','
string|"'B2'"
op|','
string|"'a10'"
op|','
string|"'b10'"
op|','
string|"'zz'"
op|')'
newline|'\n'
name|'cls'
op|'.'
name|'files'
op|'='
name|'list'
op|'('
op|')'
newline|'\n'
name|'cls'
op|'.'
name|'file_size'
op|'='
number|'128'
newline|'\n'
name|'for'
name|'name'
name|'in'
name|'cls'
op|'.'
name|'file_items'
op|':'
newline|'\n'
indent|'            '
name|'file_item'
op|'='
name|'cls'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
name|'name'
op|')'
newline|'\n'
name|'file_item'
op|'.'
name|'write_random'
op|'('
name|'cls'
op|'.'
name|'file_size'
op|')'
newline|'\n'
name|'cls'
op|'.'
name|'files'
op|'.'
name|'append'
op|'('
name|'file_item'
op|'.'
name|'name'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|TestContainerSorting
dedent|''
dedent|''
dedent|''
name|'class'
name|'TestContainerSorting'
op|'('
name|'Base'
op|')'
op|':'
newline|'\n'
DECL|variable|env
indent|'    '
name|'env'
op|'='
name|'TestContainerSortingEnv'
newline|'\n'
DECL|variable|set_up
name|'set_up'
op|'='
name|'False'
newline|'\n'
nl|'\n'
DECL|member|testContainerFileListSortingReversed
name|'def'
name|'testContainerFileListSortingReversed'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'file_list'
op|'='
name|'list'
op|'('
name|'sorted'
op|'('
name|'self'
op|'.'
name|'env'
op|'.'
name|'file_items'
op|')'
op|')'
newline|'\n'
name|'file_list'
op|'.'
name|'reverse'
op|'('
op|')'
newline|'\n'
name|'for'
name|'reverse'
name|'in'
op|'('
string|"'true'"
op|','
string|"'1'"
op|','
string|"'yes'"
op|','
string|"'on'"
op|','
string|"'t'"
op|','
string|"'y'"
op|')'
op|':'
newline|'\n'
indent|'            '
name|'cont_files'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'files'
op|'('
name|'parms'
op|'='
op|'{'
string|"'reverse'"
op|':'
name|'reverse'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'200'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'file_list'
op|','
name|'cont_files'
op|','
nl|'\n'
string|"'Expected %s but got %s with reverse param %r'"
nl|'\n'
op|'%'
op|'('
name|'file_list'
op|','
name|'cont_files'
op|','
name|'reverse'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|testContainerFileSortingByPrefixReversed
dedent|''
dedent|''
name|'def'
name|'testContainerFileSortingByPrefixReversed'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'cont_list'
op|'='
name|'sorted'
op|'('
name|'c'
name|'for'
name|'c'
name|'in'
name|'self'
op|'.'
name|'env'
op|'.'
name|'file_items'
name|'if'
name|'c'
op|'.'
name|'startswith'
op|'('
string|"'a'"
op|')'
op|')'
newline|'\n'
name|'cont_list'
op|'.'
name|'reverse'
op|'('
op|')'
newline|'\n'
name|'cont_listing'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'files'
op|'('
name|'parms'
op|'='
op|'{'
nl|'\n'
string|"'reverse'"
op|':'
string|"'on'"
op|','
string|"'prefix'"
op|':'
string|"'a'"
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'200'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'cont_list'
op|','
name|'cont_listing'
op|')'
newline|'\n'
nl|'\n'
DECL|member|testContainerFileSortingByMarkersExclusiveReversed
dedent|''
name|'def'
name|'testContainerFileSortingByMarkersExclusiveReversed'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'first_item'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'file_items'
op|'['
number|'3'
op|']'
comment|"# 'b1' + postfix"
newline|'\n'
name|'last_item'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'file_items'
op|'['
number|'4'
op|']'
comment|"# 'B2' + postfix"
newline|'\n'
nl|'\n'
name|'cont_list'
op|'='
name|'sorted'
op|'('
name|'c'
name|'for'
name|'c'
name|'in'
name|'self'
op|'.'
name|'env'
op|'.'
name|'file_items'
nl|'\n'
name|'if'
name|'last_item'
op|'<'
name|'c'
op|'<'
name|'first_item'
op|')'
newline|'\n'
name|'cont_list'
op|'.'
name|'reverse'
op|'('
op|')'
newline|'\n'
name|'cont_listing'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'files'
op|'('
name|'parms'
op|'='
op|'{'
nl|'\n'
string|"'reverse'"
op|':'
string|"'on'"
op|','
string|"'marker'"
op|':'
name|'first_item'
op|','
string|"'end_marker'"
op|':'
name|'last_item'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'200'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'cont_list'
op|','
name|'cont_listing'
op|')'
newline|'\n'
nl|'\n'
DECL|member|testContainerFileSortingByMarkersInclusiveReversed
dedent|''
name|'def'
name|'testContainerFileSortingByMarkersInclusiveReversed'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'first_item'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'file_items'
op|'['
number|'3'
op|']'
comment|"# 'b1' + postfix"
newline|'\n'
name|'last_item'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'file_items'
op|'['
number|'4'
op|']'
comment|"# 'B2' + postfix"
newline|'\n'
nl|'\n'
name|'cont_list'
op|'='
name|'sorted'
op|'('
name|'c'
name|'for'
name|'c'
name|'in'
name|'self'
op|'.'
name|'env'
op|'.'
name|'file_items'
nl|'\n'
name|'if'
name|'last_item'
op|'<='
name|'c'
op|'<='
name|'first_item'
op|')'
newline|'\n'
name|'cont_list'
op|'.'
name|'reverse'
op|'('
op|')'
newline|'\n'
name|'cont_listing'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'files'
op|'('
name|'parms'
op|'='
op|'{'
nl|'\n'
string|"'reverse'"
op|':'
string|"'on'"
op|','
string|"'marker'"
op|':'
name|'first_item'
op|'+'
string|"'\\x00'"
op|','
nl|'\n'
string|"'end_marker'"
op|':'
name|'last_item'
op|'['
op|':'
op|'-'
number|'1'
op|']'
op|'+'
name|'chr'
op|'('
name|'ord'
op|'('
name|'last_item'
op|'['
op|'-'
number|'1'
op|']'
op|')'
op|'-'
number|'1'
op|')'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'200'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'cont_list'
op|','
name|'cont_listing'
op|')'
newline|'\n'
nl|'\n'
DECL|member|testContainerFileSortingByReversedMarkersReversed
dedent|''
name|'def'
name|'testContainerFileSortingByReversedMarkersReversed'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'cont_listing'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'files'
op|'('
name|'parms'
op|'='
op|'{'
nl|'\n'
string|"'reverse'"
op|':'
string|"'on'"
op|','
string|"'marker'"
op|':'
string|"'B'"
op|','
string|"'end_marker'"
op|':'
string|"'b1'"
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'204'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
op|'['
op|']'
op|','
name|'cont_listing'
op|')'
newline|'\n'
nl|'\n'
DECL|member|testContainerFileListSorting
dedent|''
name|'def'
name|'testContainerFileListSorting'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'file_list'
op|'='
name|'list'
op|'('
name|'sorted'
op|'('
name|'self'
op|'.'
name|'env'
op|'.'
name|'file_items'
op|')'
op|')'
newline|'\n'
name|'cont_files'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'files'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'200'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'file_list'
op|','
name|'cont_files'
op|')'
newline|'\n'
nl|'\n'
comment|'# Lets try again but with reverse is specifically turned off'
nl|'\n'
name|'cont_files'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'files'
op|'('
name|'parms'
op|'='
op|'{'
string|"'reverse'"
op|':'
string|"'off'"
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'200'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'file_list'
op|','
name|'cont_files'
op|')'
newline|'\n'
nl|'\n'
name|'cont_files'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'files'
op|'('
name|'parms'
op|'='
op|'{'
string|"'reverse'"
op|':'
string|"'false'"
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'200'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'file_list'
op|','
name|'cont_files'
op|')'
newline|'\n'
nl|'\n'
name|'cont_files'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'files'
op|'('
name|'parms'
op|'='
op|'{'
string|"'reverse'"
op|':'
string|"'no'"
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'200'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'file_list'
op|','
name|'cont_files'
op|')'
newline|'\n'
nl|'\n'
name|'cont_files'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'files'
op|'('
name|'parms'
op|'='
op|'{'
string|"'reverse'"
op|':'
string|"''"
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'200'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'file_list'
op|','
name|'cont_files'
op|')'
newline|'\n'
nl|'\n'
comment|'# Lets try again but with a incorrect reverse values'
nl|'\n'
name|'cont_files'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'files'
op|'('
name|'parms'
op|'='
op|'{'
string|"'reverse'"
op|':'
string|"'foo'"
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'200'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'file_list'
op|','
name|'cont_files'
op|')'
newline|'\n'
nl|'\n'
name|'cont_files'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'files'
op|'('
name|'parms'
op|'='
op|'{'
string|"'reverse'"
op|':'
string|"'hai'"
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'200'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'file_list'
op|','
name|'cont_files'
op|')'
newline|'\n'
nl|'\n'
name|'cont_files'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'files'
op|'('
name|'parms'
op|'='
op|'{'
string|"'reverse'"
op|':'
string|"'o=[]::::>'"
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'200'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'file_list'
op|','
name|'cont_files'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|TestContainerPathsEnv
dedent|''
dedent|''
name|'class'
name|'TestContainerPathsEnv'
op|'('
name|'object'
op|')'
op|':'
newline|'\n'
indent|'    '
op|'@'
name|'classmethod'
newline|'\n'
DECL|member|setUp
name|'def'
name|'setUp'
op|'('
name|'cls'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'cls'
op|'.'
name|'conn'
op|'='
name|'Connection'
op|'('
name|'tf'
op|'.'
name|'config'
op|')'
newline|'\n'
name|'cls'
op|'.'
name|'conn'
op|'.'
name|'authenticate'
op|'('
op|')'
newline|'\n'
name|'cls'
op|'.'
name|'account'
op|'='
name|'Account'
op|'('
name|'cls'
op|'.'
name|'conn'
op|','
name|'tf'
op|'.'
name|'config'
op|'.'
name|'get'
op|'('
string|"'account'"
op|','
nl|'\n'
name|'tf'
op|'.'
name|'config'
op|'['
string|"'username'"
op|']'
op|')'
op|')'
newline|'\n'
name|'cls'
op|'.'
name|'account'
op|'.'
name|'delete_containers'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'cls'
op|'.'
name|'file_size'
op|'='
number|'8'
newline|'\n'
nl|'\n'
name|'cls'
op|'.'
name|'container'
op|'='
name|'cls'
op|'.'
name|'account'
op|'.'
name|'container'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
name|'if'
name|'not'
name|'cls'
op|'.'
name|'container'
op|'.'
name|'create'
op|'('
op|')'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'ResponseError'
op|'('
name|'cls'
op|'.'
name|'conn'
op|'.'
name|'response'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'cls'
op|'.'
name|'files'
op|'='
op|'['
nl|'\n'
string|"'/file1'"
op|','
nl|'\n'
string|"'/file A'"
op|','
nl|'\n'
string|"'/dir1/'"
op|','
nl|'\n'
string|"'/dir2/'"
op|','
nl|'\n'
string|"'/dir1/file2'"
op|','
nl|'\n'
string|"'/dir1/subdir1/'"
op|','
nl|'\n'
string|"'/dir1/subdir2/'"
op|','
nl|'\n'
string|"'/dir1/subdir1/file2'"
op|','
nl|'\n'
string|"'/dir1/subdir1/file3'"
op|','
nl|'\n'
string|"'/dir1/subdir1/file4'"
op|','
nl|'\n'
string|"'/dir1/subdir1/subsubdir1/'"
op|','
nl|'\n'
string|"'/dir1/subdir1/subsubdir1/file5'"
op|','
nl|'\n'
string|"'/dir1/subdir1/subsubdir1/file6'"
op|','
nl|'\n'
string|"'/dir1/subdir1/subsubdir1/file7'"
op|','
nl|'\n'
string|"'/dir1/subdir1/subsubdir1/file8'"
op|','
nl|'\n'
string|"'/dir1/subdir1/subsubdir2/'"
op|','
nl|'\n'
string|"'/dir1/subdir1/subsubdir2/file9'"
op|','
nl|'\n'
string|"'/dir1/subdir1/subsubdir2/file0'"
op|','
nl|'\n'
string|"'file1'"
op|','
nl|'\n'
string|"'dir1/'"
op|','
nl|'\n'
string|"'dir2/'"
op|','
nl|'\n'
string|"'dir1/file2'"
op|','
nl|'\n'
string|"'dir1/subdir1/'"
op|','
nl|'\n'
string|"'dir1/subdir2/'"
op|','
nl|'\n'
string|"'dir1/subdir1/file2'"
op|','
nl|'\n'
string|"'dir1/subdir1/file3'"
op|','
nl|'\n'
string|"'dir1/subdir1/file4'"
op|','
nl|'\n'
string|"'dir1/subdir1/subsubdir1/'"
op|','
nl|'\n'
string|"'dir1/subdir1/subsubdir1/file5'"
op|','
nl|'\n'
string|"'dir1/subdir1/subsubdir1/file6'"
op|','
nl|'\n'
string|"'dir1/subdir1/subsubdir1/file7'"
op|','
nl|'\n'
string|"'dir1/subdir1/subsubdir1/file8'"
op|','
nl|'\n'
string|"'dir1/subdir1/subsubdir2/'"
op|','
nl|'\n'
string|"'dir1/subdir1/subsubdir2/file9'"
op|','
nl|'\n'
string|"'dir1/subdir1/subsubdir2/file0'"
op|','
nl|'\n'
string|"'dir1/subdir with spaces/'"
op|','
nl|'\n'
string|"'dir1/subdir with spaces/file B'"
op|','
nl|'\n'
string|"'dir1/subdir+with{whatever/'"
op|','
nl|'\n'
string|"'dir1/subdir+with{whatever/file D'"
op|','
nl|'\n'
op|']'
newline|'\n'
nl|'\n'
name|'stored_files'
op|'='
name|'set'
op|'('
op|')'
newline|'\n'
name|'for'
name|'f'
name|'in'
name|'cls'
op|'.'
name|'files'
op|':'
newline|'\n'
indent|'            '
name|'file_item'
op|'='
name|'cls'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
name|'f'
op|')'
newline|'\n'
name|'if'
name|'f'
op|'.'
name|'endswith'
op|'('
string|"'/'"
op|')'
op|':'
newline|'\n'
indent|'                '
name|'file_item'
op|'.'
name|'write'
op|'('
name|'hdrs'
op|'='
op|'{'
string|"'Content-Type'"
op|':'
string|"'application/directory'"
op|'}'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                '
name|'file_item'
op|'.'
name|'write_random'
op|'('
name|'cls'
op|'.'
name|'file_size'
op|','
nl|'\n'
name|'hdrs'
op|'='
op|'{'
string|"'Content-Type'"
op|':'
nl|'\n'
string|"'application/directory'"
op|'}'
op|')'
newline|'\n'
dedent|''
name|'if'
op|'('
name|'normalized_urls'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'nfile'
op|'='
string|"'/'"
op|'.'
name|'join'
op|'('
name|'filter'
op|'('
name|'None'
op|','
name|'f'
op|'.'
name|'split'
op|'('
string|"'/'"
op|')'
op|')'
op|')'
newline|'\n'
name|'if'
op|'('
name|'f'
op|'['
op|'-'
number|'1'
op|']'
op|'=='
string|"'/'"
op|')'
op|':'
newline|'\n'
indent|'                    '
name|'nfile'
op|'+='
string|"'/'"
newline|'\n'
dedent|''
name|'stored_files'
op|'.'
name|'add'
op|'('
name|'nfile'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                '
name|'stored_files'
op|'.'
name|'add'
op|'('
name|'f'
op|')'
newline|'\n'
dedent|''
dedent|''
name|'cls'
op|'.'
name|'stored_files'
op|'='
name|'sorted'
op|'('
name|'stored_files'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|TestContainerPaths
dedent|''
dedent|''
name|'class'
name|'TestContainerPaths'
op|'('
name|'Base'
op|')'
op|':'
newline|'\n'
DECL|variable|env
indent|'    '
name|'env'
op|'='
name|'TestContainerPathsEnv'
newline|'\n'
DECL|variable|set_up
name|'set_up'
op|'='
name|'False'
newline|'\n'
nl|'\n'
DECL|member|testTraverseContainer
name|'def'
name|'testTraverseContainer'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'found_files'
op|'='
op|'['
op|']'
newline|'\n'
name|'found_dirs'
op|'='
op|'['
op|']'
newline|'\n'
nl|'\n'
DECL|function|recurse_path
name|'def'
name|'recurse_path'
op|'('
name|'path'
op|','
name|'count'
op|'='
number|'0'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'count'
op|'>'
number|'10'
op|':'
newline|'\n'
indent|'                '
name|'raise'
name|'ValueError'
op|'('
string|"'too deep recursion'"
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'for'
name|'file_item'
name|'in'
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'files'
op|'('
name|'parms'
op|'='
op|'{'
string|"'path'"
op|':'
name|'path'
op|'}'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'file_item'
op|'.'
name|'startswith'
op|'('
name|'path'
op|')'
op|')'
newline|'\n'
name|'if'
name|'file_item'
op|'.'
name|'endswith'
op|'('
string|"'/'"
op|')'
op|':'
newline|'\n'
indent|'                    '
name|'recurse_path'
op|'('
name|'file_item'
op|','
name|'count'
op|'+'
number|'1'
op|')'
newline|'\n'
name|'found_dirs'
op|'.'
name|'append'
op|'('
name|'file_item'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                    '
name|'found_files'
op|'.'
name|'append'
op|'('
name|'file_item'
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
dedent|''
name|'recurse_path'
op|'('
string|"''"
op|')'
newline|'\n'
name|'for'
name|'file_item'
name|'in'
name|'self'
op|'.'
name|'env'
op|'.'
name|'stored_files'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'file_item'
op|'.'
name|'startswith'
op|'('
string|"'/'"
op|')'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'assertNotIn'
op|'('
name|'file_item'
op|','
name|'found_dirs'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertNotIn'
op|'('
name|'file_item'
op|','
name|'found_files'
op|')'
newline|'\n'
dedent|''
name|'elif'
name|'file_item'
op|'.'
name|'endswith'
op|'('
string|"'/'"
op|')'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'assertIn'
op|'('
name|'file_item'
op|','
name|'found_dirs'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertNotIn'
op|'('
name|'file_item'
op|','
name|'found_files'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'assertIn'
op|'('
name|'file_item'
op|','
name|'found_files'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertNotIn'
op|'('
name|'file_item'
op|','
name|'found_dirs'
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'found_files'
op|'='
op|'['
op|']'
newline|'\n'
name|'found_dirs'
op|'='
op|'['
op|']'
newline|'\n'
name|'recurse_path'
op|'('
string|"'/'"
op|')'
newline|'\n'
name|'for'
name|'file_item'
name|'in'
name|'self'
op|'.'
name|'env'
op|'.'
name|'stored_files'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'not'
name|'file_item'
op|'.'
name|'startswith'
op|'('
string|"'/'"
op|')'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'assertNotIn'
op|'('
name|'file_item'
op|','
name|'found_dirs'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertNotIn'
op|'('
name|'file_item'
op|','
name|'found_files'
op|')'
newline|'\n'
dedent|''
name|'elif'
name|'file_item'
op|'.'
name|'endswith'
op|'('
string|"'/'"
op|')'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'assertIn'
op|'('
name|'file_item'
op|','
name|'found_dirs'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertNotIn'
op|'('
name|'file_item'
op|','
name|'found_files'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'assertIn'
op|'('
name|'file_item'
op|','
name|'found_files'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertNotIn'
op|'('
name|'file_item'
op|','
name|'found_dirs'
op|')'
newline|'\n'
nl|'\n'
DECL|member|testContainerListing
dedent|''
dedent|''
dedent|''
name|'def'
name|'testContainerListing'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'for'
name|'format_type'
name|'in'
op|'('
name|'None'
op|','
string|"'json'"
op|','
string|"'xml'"
op|')'
op|':'
newline|'\n'
indent|'            '
name|'files'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'files'
op|'('
name|'parms'
op|'='
op|'{'
string|"'format'"
op|':'
name|'format_type'
op|'}'
op|')'
newline|'\n'
nl|'\n'
name|'if'
name|'isinstance'
op|'('
name|'files'
op|'['
number|'0'
op|']'
op|','
name|'dict'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'files'
op|'='
op|'['
name|'str'
op|'('
name|'x'
op|'['
string|"'name'"
op|']'
op|')'
name|'for'
name|'x'
name|'in'
name|'files'
op|']'
newline|'\n'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'files'
op|','
name|'self'
op|'.'
name|'env'
op|'.'
name|'stored_files'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'for'
name|'format_type'
name|'in'
op|'('
string|"'json'"
op|','
string|"'xml'"
op|')'
op|':'
newline|'\n'
indent|'            '
name|'for'
name|'file_item'
name|'in'
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'files'
op|'('
name|'parms'
op|'='
op|'{'
string|"'format'"
op|':'
nl|'\n'
name|'format_type'
op|'}'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'int'
op|'('
name|'file_item'
op|'['
string|"'bytes'"
op|']'
op|')'
op|'>='
number|'0'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertIn'
op|'('
string|"'last_modified'"
op|','
name|'file_item'
op|')'
newline|'\n'
name|'if'
name|'file_item'
op|'['
string|"'name'"
op|']'
op|'.'
name|'endswith'
op|'('
string|"'/'"
op|')'
op|':'
newline|'\n'
indent|'                    '
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'file_item'
op|'['
string|"'content_type'"
op|']'
op|','
nl|'\n'
string|"'application/directory'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|testStructure
dedent|''
dedent|''
dedent|''
dedent|''
name|'def'
name|'testStructure'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
DECL|function|assert_listing
indent|'        '
name|'def'
name|'assert_listing'
op|'('
name|'path'
op|','
name|'file_list'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'files'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'files'
op|'('
name|'parms'
op|'='
op|'{'
string|"'path'"
op|':'
name|'path'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'sorted'
op|'('
name|'file_list'
op|','
name|'cmp'
op|'='
name|'locale'
op|'.'
name|'strcoll'
op|')'
op|','
name|'files'
op|')'
newline|'\n'
dedent|''
name|'if'
name|'not'
name|'normalized_urls'
op|':'
newline|'\n'
indent|'            '
name|'assert_listing'
op|'('
string|"'/'"
op|','
op|'['
string|"'/dir1/'"
op|','
string|"'/dir2/'"
op|','
string|"'/file1'"
op|','
string|"'/file A'"
op|']'
op|')'
newline|'\n'
name|'assert_listing'
op|'('
string|"'/dir1'"
op|','
nl|'\n'
op|'['
string|"'/dir1/file2'"
op|','
string|"'/dir1/subdir1/'"
op|','
string|"'/dir1/subdir2/'"
op|']'
op|')'
newline|'\n'
name|'assert_listing'
op|'('
string|"'/dir1/'"
op|','
nl|'\n'
op|'['
string|"'/dir1/file2'"
op|','
string|"'/dir1/subdir1/'"
op|','
string|"'/dir1/subdir2/'"
op|']'
op|')'
newline|'\n'
name|'assert_listing'
op|'('
string|"'/dir1/subdir1'"
op|','
nl|'\n'
op|'['
string|"'/dir1/subdir1/subsubdir2/'"
op|','
string|"'/dir1/subdir1/file2'"
op|','
nl|'\n'
string|"'/dir1/subdir1/file3'"
op|','
string|"'/dir1/subdir1/file4'"
op|','
nl|'\n'
string|"'/dir1/subdir1/subsubdir1/'"
op|']'
op|')'
newline|'\n'
name|'assert_listing'
op|'('
string|"'/dir1/subdir2'"
op|','
op|'['
op|']'
op|')'
newline|'\n'
name|'assert_listing'
op|'('
string|"''"
op|','
op|'['
string|"'file1'"
op|','
string|"'dir1/'"
op|','
string|"'dir2/'"
op|']'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'assert_listing'
op|'('
string|"''"
op|','
op|'['
string|"'file1'"
op|','
string|"'dir1/'"
op|','
string|"'dir2/'"
op|','
string|"'file A'"
op|']'
op|')'
newline|'\n'
dedent|''
name|'assert_listing'
op|'('
string|"'dir1'"
op|','
op|'['
string|"'dir1/file2'"
op|','
string|"'dir1/subdir1/'"
op|','
nl|'\n'
string|"'dir1/subdir2/'"
op|','
string|"'dir1/subdir with spaces/'"
op|','
nl|'\n'
string|"'dir1/subdir+with{whatever/'"
op|']'
op|')'
newline|'\n'
name|'assert_listing'
op|'('
string|"'dir1/subdir1'"
op|','
nl|'\n'
op|'['
string|"'dir1/subdir1/file4'"
op|','
string|"'dir1/subdir1/subsubdir2/'"
op|','
nl|'\n'
string|"'dir1/subdir1/file2'"
op|','
string|"'dir1/subdir1/file3'"
op|','
nl|'\n'
string|"'dir1/subdir1/subsubdir1/'"
op|']'
op|')'
newline|'\n'
name|'assert_listing'
op|'('
string|"'dir1/subdir1/subsubdir1'"
op|','
nl|'\n'
op|'['
string|"'dir1/subdir1/subsubdir1/file7'"
op|','
nl|'\n'
string|"'dir1/subdir1/subsubdir1/file5'"
op|','
nl|'\n'
string|"'dir1/subdir1/subsubdir1/file8'"
op|','
nl|'\n'
string|"'dir1/subdir1/subsubdir1/file6'"
op|']'
op|')'
newline|'\n'
name|'assert_listing'
op|'('
string|"'dir1/subdir1/subsubdir1/'"
op|','
nl|'\n'
op|'['
string|"'dir1/subdir1/subsubdir1/file7'"
op|','
nl|'\n'
string|"'dir1/subdir1/subsubdir1/file5'"
op|','
nl|'\n'
string|"'dir1/subdir1/subsubdir1/file8'"
op|','
nl|'\n'
string|"'dir1/subdir1/subsubdir1/file6'"
op|']'
op|')'
newline|'\n'
name|'assert_listing'
op|'('
string|"'dir1/subdir with spaces/'"
op|','
nl|'\n'
op|'['
string|"'dir1/subdir with spaces/file B'"
op|']'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|TestFileEnv
dedent|''
dedent|''
name|'class'
name|'TestFileEnv'
op|'('
name|'object'
op|')'
op|':'
newline|'\n'
indent|'    '
op|'@'
name|'classmethod'
newline|'\n'
DECL|member|setUp
name|'def'
name|'setUp'
op|'('
name|'cls'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'cls'
op|'.'
name|'conn'
op|'='
name|'Connection'
op|'('
name|'tf'
op|'.'
name|'config'
op|')'
newline|'\n'
name|'cls'
op|'.'
name|'conn'
op|'.'
name|'authenticate'
op|'('
op|')'
newline|'\n'
name|'cls'
op|'.'
name|'account'
op|'='
name|'Account'
op|'('
name|'cls'
op|'.'
name|'conn'
op|','
name|'tf'
op|'.'
name|'config'
op|'.'
name|'get'
op|'('
string|"'account'"
op|','
nl|'\n'
name|'tf'
op|'.'
name|'config'
op|'['
string|"'username'"
op|']'
op|')'
op|')'
newline|'\n'
comment|'# creating another account and connection'
nl|'\n'
comment|'# for account to account copy tests'
nl|'\n'
name|'config2'
op|'='
name|'deepcopy'
op|'('
name|'tf'
op|'.'
name|'config'
op|')'
newline|'\n'
name|'config2'
op|'['
string|"'account'"
op|']'
op|'='
name|'tf'
op|'.'
name|'config'
op|'['
string|"'account2'"
op|']'
newline|'\n'
name|'config2'
op|'['
string|"'username'"
op|']'
op|'='
name|'tf'
op|'.'
name|'config'
op|'['
string|"'username2'"
op|']'
newline|'\n'
name|'config2'
op|'['
string|"'password'"
op|']'
op|'='
name|'tf'
op|'.'
name|'config'
op|'['
string|"'password2'"
op|']'
newline|'\n'
name|'cls'
op|'.'
name|'conn2'
op|'='
name|'Connection'
op|'('
name|'config2'
op|')'
newline|'\n'
name|'cls'
op|'.'
name|'conn2'
op|'.'
name|'authenticate'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'cls'
op|'.'
name|'account'
op|'='
name|'Account'
op|'('
name|'cls'
op|'.'
name|'conn'
op|','
name|'tf'
op|'.'
name|'config'
op|'.'
name|'get'
op|'('
string|"'account'"
op|','
nl|'\n'
name|'tf'
op|'.'
name|'config'
op|'['
string|"'username'"
op|']'
op|')'
op|')'
newline|'\n'
name|'cls'
op|'.'
name|'account'
op|'.'
name|'delete_containers'
op|'('
op|')'
newline|'\n'
name|'cls'
op|'.'
name|'account2'
op|'='
name|'cls'
op|'.'
name|'conn2'
op|'.'
name|'get_account'
op|'('
op|')'
newline|'\n'
name|'cls'
op|'.'
name|'account2'
op|'.'
name|'delete_containers'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'cls'
op|'.'
name|'container'
op|'='
name|'cls'
op|'.'
name|'account'
op|'.'
name|'container'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
name|'if'
name|'not'
name|'cls'
op|'.'
name|'container'
op|'.'
name|'create'
op|'('
op|')'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'ResponseError'
op|'('
name|'cls'
op|'.'
name|'conn'
op|'.'
name|'response'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'cls'
op|'.'
name|'file_size'
op|'='
number|'128'
newline|'\n'
nl|'\n'
comment|'# With keystoneauth we need the accounts to have had the project'
nl|'\n'
comment|'# domain id persisted as sysmeta prior to testing ACLs. This may'
nl|'\n'
comment|'# not be the case if, for example, the account was created using'
nl|'\n'
comment|'# a request with reseller_admin role, when project domain id may'
nl|'\n'
comment|'# not have been known. So we ensure that the project domain id is'
nl|'\n'
comment|'# in sysmeta by making a POST to the accounts using an admin role.'
nl|'\n'
name|'cls'
op|'.'
name|'account'
op|'.'
name|'update_metadata'
op|'('
op|')'
newline|'\n'
name|'cls'
op|'.'
name|'account2'
op|'.'
name|'update_metadata'
op|'('
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|TestFileDev
dedent|''
dedent|''
name|'class'
name|'TestFileDev'
op|'('
name|'Base'
op|')'
op|':'
newline|'\n'
DECL|variable|env
indent|'    '
name|'env'
op|'='
name|'TestFileEnv'
newline|'\n'
DECL|variable|set_up
name|'set_up'
op|'='
name|'False'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|TestFileDevUTF8
dedent|''
name|'class'
name|'TestFileDevUTF8'
op|'('
name|'Base2'
op|','
name|'TestFileDev'
op|')'
op|':'
newline|'\n'
DECL|variable|set_up
indent|'    '
name|'set_up'
op|'='
name|'False'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|TestFile
dedent|''
name|'class'
name|'TestFile'
op|'('
name|'Base'
op|')'
op|':'
newline|'\n'
DECL|variable|env
indent|'    '
name|'env'
op|'='
name|'TestFileEnv'
newline|'\n'
DECL|variable|set_up
name|'set_up'
op|'='
name|'False'
newline|'\n'
nl|'\n'
DECL|member|testCopy
name|'def'
name|'testCopy'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# makes sure to test encoded characters'
nl|'\n'
indent|'        '
name|'source_filename'
op|'='
string|"'dealde%2Fl04 011e%204c8df/flash.png'"
newline|'\n'
name|'file_item'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
name|'source_filename'
op|')'
newline|'\n'
nl|'\n'
name|'metadata'
op|'='
op|'{'
op|'}'
newline|'\n'
name|'for'
name|'i'
name|'in'
name|'range'
op|'('
number|'1'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'metadata'
op|'['
name|'Utils'
op|'.'
name|'create_ascii_name'
op|'('
op|')'
op|']'
op|'='
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'data'
op|'='
name|'file_item'
op|'.'
name|'write_random'
op|'('
op|')'
newline|'\n'
name|'file_item'
op|'.'
name|'sync_metadata'
op|'('
name|'metadata'
op|')'
newline|'\n'
nl|'\n'
name|'dest_cont'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'account'
op|'.'
name|'container'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'dest_cont'
op|'.'
name|'create'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
comment|'# copy both from within and across containers'
nl|'\n'
name|'for'
name|'cont'
name|'in'
op|'('
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|','
name|'dest_cont'
op|')'
op|':'
newline|'\n'
comment|'# copy both with and without initial slash'
nl|'\n'
indent|'            '
name|'for'
name|'prefix'
name|'in'
op|'('
string|"''"
op|','
string|"'/'"
op|')'
op|':'
newline|'\n'
indent|'                '
name|'dest_filename'
op|'='
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'file_item'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
name|'source_filename'
op|')'
newline|'\n'
name|'file_item'
op|'.'
name|'copy'
op|'('
string|"'%s%s'"
op|'%'
op|'('
name|'prefix'
op|','
name|'cont'
op|')'
op|','
name|'dest_filename'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertIn'
op|'('
name|'dest_filename'
op|','
name|'cont'
op|'.'
name|'files'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'file_item'
op|'='
name|'cont'
op|'.'
name|'file'
op|'('
name|'dest_filename'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'data'
op|'=='
name|'file_item'
op|'.'
name|'read'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'file_item'
op|'.'
name|'initialize'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'metadata'
op|'=='
name|'file_item'
op|'.'
name|'metadata'
op|')'
newline|'\n'
nl|'\n'
DECL|member|testCopyAccount
dedent|''
dedent|''
dedent|''
name|'def'
name|'testCopyAccount'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# makes sure to test encoded characters'
nl|'\n'
indent|'        '
name|'source_filename'
op|'='
string|"'dealde%2Fl04 011e%204c8df/flash.png'"
newline|'\n'
name|'file_item'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
name|'source_filename'
op|')'
newline|'\n'
nl|'\n'
name|'metadata'
op|'='
op|'{'
name|'Utils'
op|'.'
name|'create_ascii_name'
op|'('
op|')'
op|':'
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|'}'
newline|'\n'
nl|'\n'
name|'data'
op|'='
name|'file_item'
op|'.'
name|'write_random'
op|'('
op|')'
newline|'\n'
name|'file_item'
op|'.'
name|'sync_metadata'
op|'('
name|'metadata'
op|')'
newline|'\n'
nl|'\n'
name|'dest_cont'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'account'
op|'.'
name|'container'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'dest_cont'
op|'.'
name|'create'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'acct'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'conn'
op|'.'
name|'account_name'
newline|'\n'
comment|'# copy both from within and across containers'
nl|'\n'
name|'for'
name|'cont'
name|'in'
op|'('
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|','
name|'dest_cont'
op|')'
op|':'
newline|'\n'
comment|'# copy both with and without initial slash'
nl|'\n'
indent|'            '
name|'for'
name|'prefix'
name|'in'
op|'('
string|"''"
op|','
string|"'/'"
op|')'
op|':'
newline|'\n'
indent|'                '
name|'dest_filename'
op|'='
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'file_item'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
name|'source_filename'
op|')'
newline|'\n'
name|'file_item'
op|'.'
name|'copy_account'
op|'('
name|'acct'
op|','
nl|'\n'
string|"'%s%s'"
op|'%'
op|'('
name|'prefix'
op|','
name|'cont'
op|')'
op|','
nl|'\n'
name|'dest_filename'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertIn'
op|'('
name|'dest_filename'
op|','
name|'cont'
op|'.'
name|'files'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'file_item'
op|'='
name|'cont'
op|'.'
name|'file'
op|'('
name|'dest_filename'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'data'
op|'=='
name|'file_item'
op|'.'
name|'read'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'file_item'
op|'.'
name|'initialize'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'metadata'
op|'=='
name|'file_item'
op|'.'
name|'metadata'
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'dest_cont'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'account2'
op|'.'
name|'container'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'dest_cont'
op|'.'
name|'create'
op|'('
name|'hdrs'
op|'='
op|'{'
nl|'\n'
string|"'X-Container-Write'"
op|':'
name|'self'
op|'.'
name|'env'
op|'.'
name|'conn'
op|'.'
name|'user_acl'
nl|'\n'
op|'}'
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'acct'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'conn2'
op|'.'
name|'account_name'
newline|'\n'
comment|'# copy both with and without initial slash'
nl|'\n'
name|'for'
name|'prefix'
name|'in'
op|'('
string|"''"
op|','
string|"'/'"
op|')'
op|':'
newline|'\n'
indent|'            '
name|'dest_filename'
op|'='
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'file_item'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
name|'source_filename'
op|')'
newline|'\n'
name|'file_item'
op|'.'
name|'copy_account'
op|'('
name|'acct'
op|','
nl|'\n'
string|"'%s%s'"
op|'%'
op|'('
name|'prefix'
op|','
name|'dest_cont'
op|')'
op|','
nl|'\n'
name|'dest_filename'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertIn'
op|'('
name|'dest_filename'
op|','
name|'dest_cont'
op|'.'
name|'files'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'file_item'
op|'='
name|'dest_cont'
op|'.'
name|'file'
op|'('
name|'dest_filename'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'data'
op|'=='
name|'file_item'
op|'.'
name|'read'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'file_item'
op|'.'
name|'initialize'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'metadata'
op|'=='
name|'file_item'
op|'.'
name|'metadata'
op|')'
newline|'\n'
nl|'\n'
DECL|member|testCopy404s
dedent|''
dedent|''
name|'def'
name|'testCopy404s'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'source_filename'
op|'='
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
newline|'\n'
name|'file_item'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
name|'source_filename'
op|')'
newline|'\n'
name|'file_item'
op|'.'
name|'write_random'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'dest_cont'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'account'
op|'.'
name|'container'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'dest_cont'
op|'.'
name|'create'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'for'
name|'prefix'
name|'in'
op|'('
string|"''"
op|','
string|"'/'"
op|')'
op|':'
newline|'\n'
comment|'# invalid source container'
nl|'\n'
indent|'            '
name|'source_cont'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'account'
op|'.'
name|'container'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
name|'file_item'
op|'='
name|'source_cont'
op|'.'
name|'file'
op|'('
name|'source_filename'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'file_item'
op|'.'
name|'copy'
op|'('
nl|'\n'
string|"'%s%s'"
op|'%'
op|'('
name|'prefix'
op|','
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|')'
op|','
nl|'\n'
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'404'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'file_item'
op|'.'
name|'copy'
op|'('
string|"'%s%s'"
op|'%'
op|'('
name|'prefix'
op|','
name|'dest_cont'
op|')'
op|','
nl|'\n'
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'404'
op|')'
newline|'\n'
nl|'\n'
comment|'# invalid source object'
nl|'\n'
name|'file_item'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'file_item'
op|'.'
name|'copy'
op|'('
nl|'\n'
string|"'%s%s'"
op|'%'
op|'('
name|'prefix'
op|','
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|')'
op|','
nl|'\n'
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'404'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'file_item'
op|'.'
name|'copy'
op|'('
string|"'%s%s'"
op|'%'
op|'('
name|'prefix'
op|','
name|'dest_cont'
op|')'
op|','
nl|'\n'
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'404'
op|')'
newline|'\n'
nl|'\n'
comment|'# invalid destination container'
nl|'\n'
name|'file_item'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
name|'source_filename'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
nl|'\n'
name|'not'
name|'file_item'
op|'.'
name|'copy'
op|'('
nl|'\n'
string|"'%s%s'"
op|'%'
op|'('
name|'prefix'
op|','
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
op|','
nl|'\n'
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|testCopyAccount404s
dedent|''
dedent|''
name|'def'
name|'testCopyAccount404s'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'acct'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'conn'
op|'.'
name|'account_name'
newline|'\n'
name|'acct2'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'conn2'
op|'.'
name|'account_name'
newline|'\n'
name|'source_filename'
op|'='
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
newline|'\n'
name|'file_item'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
name|'source_filename'
op|')'
newline|'\n'
name|'file_item'
op|'.'
name|'write_random'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'dest_cont'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'account'
op|'.'
name|'container'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'dest_cont'
op|'.'
name|'create'
op|'('
name|'hdrs'
op|'='
op|'{'
nl|'\n'
string|"'X-Container-Read'"
op|':'
name|'self'
op|'.'
name|'env'
op|'.'
name|'conn2'
op|'.'
name|'user_acl'
nl|'\n'
op|'}'
op|')'
op|')'
newline|'\n'
name|'dest_cont2'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'account2'
op|'.'
name|'container'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'dest_cont2'
op|'.'
name|'create'
op|'('
name|'hdrs'
op|'='
op|'{'
nl|'\n'
string|"'X-Container-Write'"
op|':'
name|'self'
op|'.'
name|'env'
op|'.'
name|'conn'
op|'.'
name|'user_acl'
op|','
nl|'\n'
string|"'X-Container-Read'"
op|':'
name|'self'
op|'.'
name|'env'
op|'.'
name|'conn'
op|'.'
name|'user_acl'
nl|'\n'
op|'}'
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'for'
name|'acct'
op|','
name|'cont'
name|'in'
op|'('
op|'('
name|'acct'
op|','
name|'dest_cont'
op|')'
op|','
op|'('
name|'acct2'
op|','
name|'dest_cont2'
op|')'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'for'
name|'prefix'
name|'in'
op|'('
string|"''"
op|','
string|"'/'"
op|')'
op|':'
newline|'\n'
comment|'# invalid source container'
nl|'\n'
indent|'                '
name|'source_cont'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'account'
op|'.'
name|'container'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
name|'file_item'
op|'='
name|'source_cont'
op|'.'
name|'file'
op|'('
name|'source_filename'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'file_item'
op|'.'
name|'copy_account'
op|'('
nl|'\n'
name|'acct'
op|','
nl|'\n'
string|"'%s%s'"
op|'%'
op|'('
name|'prefix'
op|','
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|')'
op|','
nl|'\n'
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
op|')'
newline|'\n'
comment|'# there is no such source container but user has'
nl|'\n'
comment|'# permissions to do a GET (done internally via COPY) for'
nl|'\n'
comment|'# objects in his own account.'
nl|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'404'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'file_item'
op|'.'
name|'copy_account'
op|'('
nl|'\n'
name|'acct'
op|','
nl|'\n'
string|"'%s%s'"
op|'%'
op|'('
name|'prefix'
op|','
name|'cont'
op|')'
op|','
nl|'\n'
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'404'
op|')'
newline|'\n'
nl|'\n'
comment|'# invalid source object'
nl|'\n'
name|'file_item'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'file_item'
op|'.'
name|'copy_account'
op|'('
nl|'\n'
name|'acct'
op|','
nl|'\n'
string|"'%s%s'"
op|'%'
op|'('
name|'prefix'
op|','
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|')'
op|','
nl|'\n'
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
op|')'
newline|'\n'
comment|'# there is no such source container but user has'
nl|'\n'
comment|'# permissions to do a GET (done internally via COPY) for'
nl|'\n'
comment|'# objects in his own account.'
nl|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'404'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'file_item'
op|'.'
name|'copy_account'
op|'('
nl|'\n'
name|'acct'
op|','
nl|'\n'
string|"'%s%s'"
op|'%'
op|'('
name|'prefix'
op|','
name|'cont'
op|')'
op|','
nl|'\n'
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'404'
op|')'
newline|'\n'
nl|'\n'
comment|'# invalid destination container'
nl|'\n'
name|'file_item'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
name|'source_filename'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'file_item'
op|'.'
name|'copy_account'
op|'('
nl|'\n'
name|'acct'
op|','
nl|'\n'
string|"'%s%s'"
op|'%'
op|'('
name|'prefix'
op|','
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
op|','
nl|'\n'
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
op|')'
newline|'\n'
name|'if'
name|'acct'
op|'=='
name|'acct2'
op|':'
newline|'\n'
comment|'# there is no such destination container'
nl|'\n'
comment|'# and foreign user can have no permission to write there'
nl|'\n'
indent|'                    '
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'403'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                    '
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'404'
op|')'
newline|'\n'
nl|'\n'
DECL|member|testCopyNoDestinationHeader
dedent|''
dedent|''
dedent|''
dedent|''
name|'def'
name|'testCopyNoDestinationHeader'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'source_filename'
op|'='
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
newline|'\n'
name|'file_item'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
name|'source_filename'
op|')'
newline|'\n'
name|'file_item'
op|'.'
name|'write_random'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'file_item'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
name|'source_filename'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'file_item'
op|'.'
name|'copy'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|','
nl|'\n'
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|','
nl|'\n'
name|'cfg'
op|'='
op|'{'
string|"'no_destination'"
op|':'
name|'True'
op|'}'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'412'
op|')'
newline|'\n'
nl|'\n'
DECL|member|testCopyDestinationSlashProblems
dedent|''
name|'def'
name|'testCopyDestinationSlashProblems'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'source_filename'
op|'='
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
newline|'\n'
name|'file_item'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
name|'source_filename'
op|')'
newline|'\n'
name|'file_item'
op|'.'
name|'write_random'
op|'('
op|')'
newline|'\n'
nl|'\n'
comment|'# no slash'
nl|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'file_item'
op|'.'
name|'copy'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|','
nl|'\n'
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|','
nl|'\n'
name|'cfg'
op|'='
op|'{'
string|"'destination'"
op|':'
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|'}'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'412'
op|')'
newline|'\n'
nl|'\n'
DECL|member|testCopyFromHeader
dedent|''
name|'def'
name|'testCopyFromHeader'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'source_filename'
op|'='
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
newline|'\n'
name|'file_item'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
name|'source_filename'
op|')'
newline|'\n'
nl|'\n'
name|'metadata'
op|'='
op|'{'
op|'}'
newline|'\n'
name|'for'
name|'i'
name|'in'
name|'range'
op|'('
number|'1'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'metadata'
op|'['
name|'Utils'
op|'.'
name|'create_ascii_name'
op|'('
op|')'
op|']'
op|'='
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
newline|'\n'
dedent|''
name|'file_item'
op|'.'
name|'metadata'
op|'='
name|'metadata'
newline|'\n'
nl|'\n'
name|'data'
op|'='
name|'file_item'
op|'.'
name|'write_random'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'dest_cont'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'account'
op|'.'
name|'container'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'dest_cont'
op|'.'
name|'create'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
comment|'# copy both from within and across containers'
nl|'\n'
name|'for'
name|'cont'
name|'in'
op|'('
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|','
name|'dest_cont'
op|')'
op|':'
newline|'\n'
comment|'# copy both with and without initial slash'
nl|'\n'
indent|'            '
name|'for'
name|'prefix'
name|'in'
op|'('
string|"''"
op|','
string|"'/'"
op|')'
op|':'
newline|'\n'
indent|'                '
name|'dest_filename'
op|'='
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'file_item'
op|'='
name|'cont'
op|'.'
name|'file'
op|'('
name|'dest_filename'
op|')'
newline|'\n'
name|'file_item'
op|'.'
name|'write'
op|'('
name|'hdrs'
op|'='
op|'{'
string|"'X-Copy-From'"
op|':'
string|"'%s%s/%s'"
op|'%'
op|'('
nl|'\n'
name|'prefix'
op|','
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'name'
op|','
name|'source_filename'
op|')'
op|'}'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertIn'
op|'('
name|'dest_filename'
op|','
name|'cont'
op|'.'
name|'files'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'file_item'
op|'='
name|'cont'
op|'.'
name|'file'
op|'('
name|'dest_filename'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'data'
op|'=='
name|'file_item'
op|'.'
name|'read'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'file_item'
op|'.'
name|'initialize'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'metadata'
op|'=='
name|'file_item'
op|'.'
name|'metadata'
op|')'
newline|'\n'
nl|'\n'
DECL|member|testCopyFromAccountHeader
dedent|''
dedent|''
dedent|''
name|'def'
name|'testCopyFromAccountHeader'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'acct'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'conn'
op|'.'
name|'account_name'
newline|'\n'
name|'src_cont'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'account'
op|'.'
name|'container'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'src_cont'
op|'.'
name|'create'
op|'('
name|'hdrs'
op|'='
op|'{'
nl|'\n'
string|"'X-Container-Read'"
op|':'
name|'self'
op|'.'
name|'env'
op|'.'
name|'conn2'
op|'.'
name|'user_acl'
nl|'\n'
op|'}'
op|')'
op|')'
newline|'\n'
name|'source_filename'
op|'='
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
newline|'\n'
name|'file_item'
op|'='
name|'src_cont'
op|'.'
name|'file'
op|'('
name|'source_filename'
op|')'
newline|'\n'
nl|'\n'
name|'metadata'
op|'='
op|'{'
op|'}'
newline|'\n'
name|'for'
name|'i'
name|'in'
name|'range'
op|'('
number|'1'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'metadata'
op|'['
name|'Utils'
op|'.'
name|'create_ascii_name'
op|'('
op|')'
op|']'
op|'='
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
newline|'\n'
dedent|''
name|'file_item'
op|'.'
name|'metadata'
op|'='
name|'metadata'
newline|'\n'
nl|'\n'
name|'data'
op|'='
name|'file_item'
op|'.'
name|'write_random'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'dest_cont'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'account'
op|'.'
name|'container'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'dest_cont'
op|'.'
name|'create'
op|'('
op|')'
op|')'
newline|'\n'
name|'dest_cont2'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'account2'
op|'.'
name|'container'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'dest_cont2'
op|'.'
name|'create'
op|'('
name|'hdrs'
op|'='
op|'{'
nl|'\n'
string|"'X-Container-Write'"
op|':'
name|'self'
op|'.'
name|'env'
op|'.'
name|'conn'
op|'.'
name|'user_acl'
nl|'\n'
op|'}'
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'for'
name|'cont'
name|'in'
op|'('
name|'src_cont'
op|','
name|'dest_cont'
op|','
name|'dest_cont2'
op|')'
op|':'
newline|'\n'
comment|'# copy both with and without initial slash'
nl|'\n'
indent|'            '
name|'for'
name|'prefix'
name|'in'
op|'('
string|"''"
op|','
string|"'/'"
op|')'
op|':'
newline|'\n'
indent|'                '
name|'dest_filename'
op|'='
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'file_item'
op|'='
name|'cont'
op|'.'
name|'file'
op|'('
name|'dest_filename'
op|')'
newline|'\n'
name|'file_item'
op|'.'
name|'write'
op|'('
name|'hdrs'
op|'='
op|'{'
string|"'X-Copy-From-Account'"
op|':'
name|'acct'
op|','
nl|'\n'
string|"'X-Copy-From'"
op|':'
string|"'%s%s/%s'"
op|'%'
op|'('
nl|'\n'
name|'prefix'
op|','
nl|'\n'
name|'src_cont'
op|'.'
name|'name'
op|','
nl|'\n'
name|'source_filename'
op|')'
op|'}'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertIn'
op|'('
name|'dest_filename'
op|','
name|'cont'
op|'.'
name|'files'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'file_item'
op|'='
name|'cont'
op|'.'
name|'file'
op|'('
name|'dest_filename'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'data'
op|'=='
name|'file_item'
op|'.'
name|'read'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'file_item'
op|'.'
name|'initialize'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'metadata'
op|'=='
name|'file_item'
op|'.'
name|'metadata'
op|')'
newline|'\n'
nl|'\n'
DECL|member|testCopyFromHeader404s
dedent|''
dedent|''
dedent|''
name|'def'
name|'testCopyFromHeader404s'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'source_filename'
op|'='
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
newline|'\n'
name|'file_item'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
name|'source_filename'
op|')'
newline|'\n'
name|'file_item'
op|'.'
name|'write_random'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'for'
name|'prefix'
name|'in'
op|'('
string|"''"
op|','
string|"'/'"
op|')'
op|':'
newline|'\n'
comment|'# invalid source container'
nl|'\n'
indent|'            '
name|'file_item'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
name|'copy_from'
op|'='
op|'('
string|"'%s%s/%s'"
nl|'\n'
op|'%'
op|'('
name|'prefix'
op|','
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|','
name|'source_filename'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ResponseError'
op|','
name|'file_item'
op|'.'
name|'write'
op|','
nl|'\n'
name|'hdrs'
op|'='
op|'{'
string|"'X-Copy-From'"
op|':'
name|'copy_from'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'404'
op|')'
newline|'\n'
nl|'\n'
comment|'# invalid source object'
nl|'\n'
name|'copy_from'
op|'='
op|'('
string|"'%s%s/%s'"
nl|'\n'
op|'%'
op|'('
name|'prefix'
op|','
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'name'
op|','
nl|'\n'
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
op|')'
newline|'\n'
name|'file_item'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ResponseError'
op|','
name|'file_item'
op|'.'
name|'write'
op|','
nl|'\n'
name|'hdrs'
op|'='
op|'{'
string|"'X-Copy-From'"
op|':'
name|'copy_from'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'404'
op|')'
newline|'\n'
nl|'\n'
comment|'# invalid destination container'
nl|'\n'
name|'dest_cont'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'account'
op|'.'
name|'container'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
name|'file_item'
op|'='
name|'dest_cont'
op|'.'
name|'file'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
name|'copy_from'
op|'='
op|'('
string|"'%s%s/%s'"
nl|'\n'
op|'%'
op|'('
name|'prefix'
op|','
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'name'
op|','
name|'source_filename'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ResponseError'
op|','
name|'file_item'
op|'.'
name|'write'
op|','
nl|'\n'
name|'hdrs'
op|'='
op|'{'
string|"'X-Copy-From'"
op|':'
name|'copy_from'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'404'
op|')'
newline|'\n'
nl|'\n'
DECL|member|testCopyFromAccountHeader404s
dedent|''
dedent|''
name|'def'
name|'testCopyFromAccountHeader404s'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'acct'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'conn2'
op|'.'
name|'account_name'
newline|'\n'
name|'src_cont'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'account2'
op|'.'
name|'container'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'src_cont'
op|'.'
name|'create'
op|'('
name|'hdrs'
op|'='
op|'{'
nl|'\n'
string|"'X-Container-Read'"
op|':'
name|'self'
op|'.'
name|'env'
op|'.'
name|'conn'
op|'.'
name|'user_acl'
nl|'\n'
op|'}'
op|')'
op|')'
newline|'\n'
name|'source_filename'
op|'='
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
newline|'\n'
name|'file_item'
op|'='
name|'src_cont'
op|'.'
name|'file'
op|'('
name|'source_filename'
op|')'
newline|'\n'
name|'file_item'
op|'.'
name|'write_random'
op|'('
op|')'
newline|'\n'
name|'dest_cont'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'account'
op|'.'
name|'container'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'dest_cont'
op|'.'
name|'create'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'for'
name|'prefix'
name|'in'
op|'('
string|"''"
op|','
string|"'/'"
op|')'
op|':'
newline|'\n'
comment|'# invalid source container'
nl|'\n'
indent|'            '
name|'file_item'
op|'='
name|'dest_cont'
op|'.'
name|'file'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ResponseError'
op|','
name|'file_item'
op|'.'
name|'write'
op|','
nl|'\n'
name|'hdrs'
op|'='
op|'{'
string|"'X-Copy-From-Account'"
op|':'
name|'acct'
op|','
nl|'\n'
string|"'X-Copy-From'"
op|':'
string|"'%s%s/%s'"
op|'%'
nl|'\n'
op|'('
name|'prefix'
op|','
nl|'\n'
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|','
nl|'\n'
name|'source_filename'
op|')'
op|'}'
op|')'
newline|'\n'
comment|'# looks like cached responses leak "not found"'
nl|'\n'
comment|'# to un-authorized users, not going to fix it now, but...'
nl|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
op|'['
number|'403'
op|','
number|'404'
op|']'
op|')'
newline|'\n'
nl|'\n'
comment|'# invalid source object'
nl|'\n'
name|'file_item'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ResponseError'
op|','
name|'file_item'
op|'.'
name|'write'
op|','
nl|'\n'
name|'hdrs'
op|'='
op|'{'
string|"'X-Copy-From-Account'"
op|':'
name|'acct'
op|','
nl|'\n'
string|"'X-Copy-From'"
op|':'
string|"'%s%s/%s'"
op|'%'
nl|'\n'
op|'('
name|'prefix'
op|','
nl|'\n'
name|'src_cont'
op|','
nl|'\n'
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'404'
op|')'
newline|'\n'
nl|'\n'
comment|'# invalid destination container'
nl|'\n'
name|'dest_cont'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'account'
op|'.'
name|'container'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
name|'file_item'
op|'='
name|'dest_cont'
op|'.'
name|'file'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ResponseError'
op|','
name|'file_item'
op|'.'
name|'write'
op|','
nl|'\n'
name|'hdrs'
op|'='
op|'{'
string|"'X-Copy-From-Account'"
op|':'
name|'acct'
op|','
nl|'\n'
string|"'X-Copy-From'"
op|':'
string|"'%s%s/%s'"
op|'%'
nl|'\n'
op|'('
name|'prefix'
op|','
nl|'\n'
name|'src_cont'
op|','
nl|'\n'
name|'source_filename'
op|')'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'404'
op|')'
newline|'\n'
nl|'\n'
DECL|member|testNameLimit
dedent|''
dedent|''
name|'def'
name|'testNameLimit'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'limit'
op|'='
name|'load_constraint'
op|'('
string|"'max_object_name_length'"
op|')'
newline|'\n'
nl|'\n'
name|'for'
name|'l'
name|'in'
op|'('
number|'1'
op|','
number|'10'
op|','
name|'limit'
op|'/'
number|'2'
op|','
name|'limit'
op|'-'
number|'1'
op|','
name|'limit'
op|','
name|'limit'
op|'+'
number|'1'
op|','
name|'limit'
op|'*'
number|'2'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'file_item'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
string|"'a'"
op|'*'
name|'l'
op|')'
newline|'\n'
nl|'\n'
name|'if'
name|'l'
op|'<='
name|'limit'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'file_item'
op|'.'
name|'write'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'201'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ResponseError'
op|','
name|'file_item'
op|'.'
name|'write'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'400'
op|')'
newline|'\n'
nl|'\n'
DECL|member|testQuestionMarkInName
dedent|''
dedent|''
dedent|''
name|'def'
name|'testQuestionMarkInName'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'Utils'
op|'.'
name|'create_name'
op|'=='
name|'Utils'
op|'.'
name|'create_ascii_name'
op|':'
newline|'\n'
indent|'            '
name|'file_name'
op|'='
name|'list'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
name|'file_name'
op|'['
name|'random'
op|'.'
name|'randint'
op|'('
number|'2'
op|','
name|'len'
op|'('
name|'file_name'
op|')'
op|'-'
number|'2'
op|')'
op|']'
op|'='
string|"'?'"
newline|'\n'
name|'file_name'
op|'='
string|'""'
op|'.'
name|'join'
op|'('
name|'file_name'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'file_name'
op|'='
name|'Utils'
op|'.'
name|'create_name'
op|'('
number|'6'
op|')'
op|'+'
string|"'?'"
op|'+'
name|'Utils'
op|'.'
name|'create_name'
op|'('
number|'6'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'file_item'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
name|'file_name'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'file_item'
op|'.'
name|'write'
op|'('
name|'cfg'
op|'='
op|'{'
string|"'no_path_quote'"
op|':'
name|'True'
op|'}'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertNotIn'
op|'('
name|'file_name'
op|','
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'files'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertIn'
op|'('
name|'file_name'
op|'.'
name|'split'
op|'('
string|"'?'"
op|')'
op|'['
number|'0'
op|']'
op|','
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'files'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|testDeleteThen404s
dedent|''
name|'def'
name|'testDeleteThen404s'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'file_item'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'file_item'
op|'.'
name|'write_random'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'201'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'file_item'
op|'.'
name|'delete'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'204'
op|')'
newline|'\n'
nl|'\n'
name|'file_item'
op|'.'
name|'metadata'
op|'='
op|'{'
name|'Utils'
op|'.'
name|'create_ascii_name'
op|'('
op|')'
op|':'
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|'}'
newline|'\n'
nl|'\n'
name|'for'
name|'method'
name|'in'
op|'('
name|'file_item'
op|'.'
name|'info'
op|','
nl|'\n'
name|'file_item'
op|'.'
name|'read'
op|','
nl|'\n'
name|'file_item'
op|'.'
name|'sync_metadata'
op|','
nl|'\n'
name|'file_item'
op|'.'
name|'delete'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ResponseError'
op|','
name|'method'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'404'
op|')'
newline|'\n'
nl|'\n'
DECL|member|testBlankMetadataName
dedent|''
dedent|''
name|'def'
name|'testBlankMetadataName'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'file_item'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
name|'file_item'
op|'.'
name|'metadata'
op|'='
op|'{'
string|"''"
op|':'
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ResponseError'
op|','
name|'file_item'
op|'.'
name|'write_random'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'400'
op|')'
newline|'\n'
nl|'\n'
DECL|member|testMetadataNumberLimit
dedent|''
name|'def'
name|'testMetadataNumberLimit'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'number_limit'
op|'='
name|'load_constraint'
op|'('
string|"'max_meta_count'"
op|')'
newline|'\n'
name|'size_limit'
op|'='
name|'load_constraint'
op|'('
string|"'max_meta_overall_size'"
op|')'
newline|'\n'
nl|'\n'
name|'for'
name|'i'
name|'in'
op|'('
name|'number_limit'
op|'-'
number|'10'
op|','
name|'number_limit'
op|'-'
number|'1'
op|','
name|'number_limit'
op|','
nl|'\n'
name|'number_limit'
op|'+'
number|'1'
op|','
name|'number_limit'
op|'+'
number|'10'
op|','
name|'number_limit'
op|'+'
number|'100'
op|')'
op|':'
newline|'\n'
nl|'\n'
indent|'            '
name|'j'
op|'='
name|'size_limit'
op|'/'
op|'('
name|'i'
op|'*'
number|'2'
op|')'
newline|'\n'
nl|'\n'
name|'size'
op|'='
number|'0'
newline|'\n'
name|'metadata'
op|'='
op|'{'
op|'}'
newline|'\n'
name|'while'
name|'len'
op|'('
name|'metadata'
op|'.'
name|'keys'
op|'('
op|')'
op|')'
op|'<'
name|'i'
op|':'
newline|'\n'
indent|'                '
name|'key'
op|'='
name|'Utils'
op|'.'
name|'create_ascii_name'
op|'('
op|')'
newline|'\n'
name|'val'
op|'='
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'if'
name|'len'
op|'('
name|'key'
op|')'
op|'>'
name|'j'
op|':'
newline|'\n'
indent|'                    '
name|'key'
op|'='
name|'key'
op|'['
op|':'
name|'j'
op|']'
newline|'\n'
name|'val'
op|'='
name|'val'
op|'['
op|':'
name|'j'
op|']'
newline|'\n'
nl|'\n'
dedent|''
name|'size'
op|'+='
name|'len'
op|'('
name|'key'
op|')'
op|'+'
name|'len'
op|'('
name|'val'
op|')'
newline|'\n'
name|'metadata'
op|'['
name|'key'
op|']'
op|'='
name|'val'
newline|'\n'
nl|'\n'
dedent|''
name|'file_item'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
name|'file_item'
op|'.'
name|'metadata'
op|'='
name|'metadata'
newline|'\n'
nl|'\n'
name|'if'
name|'i'
op|'<='
name|'number_limit'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'file_item'
op|'.'
name|'write'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'201'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'file_item'
op|'.'
name|'sync_metadata'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
op|'('
number|'201'
op|','
number|'202'
op|')'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ResponseError'
op|','
name|'file_item'
op|'.'
name|'write'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'400'
op|')'
newline|'\n'
name|'file_item'
op|'.'
name|'metadata'
op|'='
op|'{'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'file_item'
op|'.'
name|'write'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'201'
op|')'
newline|'\n'
name|'file_item'
op|'.'
name|'metadata'
op|'='
name|'metadata'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ResponseError'
op|','
name|'file_item'
op|'.'
name|'sync_metadata'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'400'
op|')'
newline|'\n'
nl|'\n'
DECL|member|testContentTypeGuessing
dedent|''
dedent|''
dedent|''
name|'def'
name|'testContentTypeGuessing'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'file_types'
op|'='
op|'{'
string|"'wav'"
op|':'
string|"'audio/x-wav'"
op|','
string|"'txt'"
op|':'
string|"'text/plain'"
op|','
nl|'\n'
string|"'zip'"
op|':'
string|"'application/zip'"
op|'}'
newline|'\n'
nl|'\n'
name|'container'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'account'
op|'.'
name|'container'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'container'
op|'.'
name|'create'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'for'
name|'i'
name|'in'
name|'file_types'
op|'.'
name|'keys'
op|'('
op|')'
op|':'
newline|'\n'
indent|'            '
name|'file_item'
op|'='
name|'container'
op|'.'
name|'file'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|'+'
string|"'.'"
op|'+'
name|'i'
op|')'
newline|'\n'
name|'file_item'
op|'.'
name|'write'
op|'('
string|"''"
op|','
name|'cfg'
op|'='
op|'{'
string|"'no_content_type'"
op|':'
name|'True'
op|'}'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'file_types_read'
op|'='
op|'{'
op|'}'
newline|'\n'
name|'for'
name|'i'
name|'in'
name|'container'
op|'.'
name|'files'
op|'('
name|'parms'
op|'='
op|'{'
string|"'format'"
op|':'
string|"'json'"
op|'}'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'file_types_read'
op|'['
name|'i'
op|'['
string|"'name'"
op|']'
op|'.'
name|'split'
op|'('
string|"'.'"
op|')'
op|'['
number|'1'
op|']'
op|']'
op|'='
name|'i'
op|'['
string|"'content_type'"
op|']'
newline|'\n'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'file_types'
op|','
name|'file_types_read'
op|')'
newline|'\n'
nl|'\n'
DECL|member|testRangedGets
dedent|''
name|'def'
name|'testRangedGets'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# We set the file_length to a strange multiple here. This is to check'
nl|'\n'
comment|'# that ranges still work in the EC case when the requested range'
nl|'\n'
comment|'# spans EC segment boundaries. The 1 MiB base value is chosen because'
nl|'\n'
comment|"# that's a common EC segment size. The 1.33 multiple is to ensure we"
nl|'\n'
comment|"# aren't aligned on segment boundaries"
nl|'\n'
indent|'        '
name|'file_length'
op|'='
name|'int'
op|'('
number|'1048576'
op|'*'
number|'1.33'
op|')'
newline|'\n'
name|'range_size'
op|'='
name|'file_length'
op|'/'
number|'10'
newline|'\n'
name|'file_item'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
name|'data'
op|'='
name|'file_item'
op|'.'
name|'write_random'
op|'('
name|'file_length'
op|')'
newline|'\n'
nl|'\n'
name|'for'
name|'i'
name|'in'
name|'range'
op|'('
number|'0'
op|','
name|'file_length'
op|','
name|'range_size'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'range_string'
op|'='
string|"'bytes=%d-%d'"
op|'%'
op|'('
name|'i'
op|','
name|'i'
op|'+'
name|'range_size'
op|'-'
number|'1'
op|')'
newline|'\n'
name|'hdrs'
op|'='
op|'{'
string|"'Range'"
op|':'
name|'range_string'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
nl|'\n'
name|'data'
op|'['
name|'i'
op|':'
name|'i'
op|'+'
name|'range_size'
op|']'
op|'=='
name|'file_item'
op|'.'
name|'read'
op|'('
name|'hdrs'
op|'='
name|'hdrs'
op|')'
op|','
nl|'\n'
name|'range_string'
op|')'
newline|'\n'
nl|'\n'
name|'range_string'
op|'='
string|"'bytes=-%d'"
op|'%'
op|'('
name|'i'
op|')'
newline|'\n'
name|'hdrs'
op|'='
op|'{'
string|"'Range'"
op|':'
name|'range_string'
op|'}'
newline|'\n'
name|'if'
name|'i'
op|'=='
number|'0'
op|':'
newline|'\n'
comment|'# RFC 2616 14.35.1'
nl|'\n'
comment|'# "If a syntactically valid byte-range-set includes ... at'
nl|'\n'
comment|'# least one suffix-byte-range-spec with a NON-ZERO'
nl|'\n'
comment|'# suffix-length, then the byte-range-set is satisfiable.'
nl|'\n'
comment|'# Otherwise, the byte-range-set is unsatisfiable.'
nl|'\n'
indent|'                '
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ResponseError'
op|','
name|'file_item'
op|'.'
name|'read'
op|','
name|'hdrs'
op|'='
name|'hdrs'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'416'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'file_item'
op|'.'
name|'read'
op|'('
name|'hdrs'
op|'='
name|'hdrs'
op|')'
op|','
name|'data'
op|'['
op|'-'
name|'i'
op|':'
op|']'
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assert_header'
op|'('
string|"'etag'"
op|','
name|'file_item'
op|'.'
name|'md5'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_header'
op|'('
string|"'accept-ranges'"
op|','
string|"'bytes'"
op|')'
newline|'\n'
nl|'\n'
name|'range_string'
op|'='
string|"'bytes=%d-'"
op|'%'
op|'('
name|'i'
op|')'
newline|'\n'
name|'hdrs'
op|'='
op|'{'
string|"'Range'"
op|':'
name|'range_string'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
nl|'\n'
name|'file_item'
op|'.'
name|'read'
op|'('
name|'hdrs'
op|'='
name|'hdrs'
op|')'
op|','
name|'data'
op|'['
name|'i'
op|'-'
name|'file_length'
op|':'
op|']'
op|','
nl|'\n'
name|'range_string'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'range_string'
op|'='
string|"'bytes=%d-%d'"
op|'%'
op|'('
name|'file_length'
op|'+'
number|'1000'
op|','
name|'file_length'
op|'+'
number|'2000'
op|')'
newline|'\n'
name|'hdrs'
op|'='
op|'{'
string|"'Range'"
op|':'
name|'range_string'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ResponseError'
op|','
name|'file_item'
op|'.'
name|'read'
op|','
name|'hdrs'
op|'='
name|'hdrs'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'416'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_header'
op|'('
string|"'etag'"
op|','
name|'file_item'
op|'.'
name|'md5'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_header'
op|'('
string|"'accept-ranges'"
op|','
string|"'bytes'"
op|')'
newline|'\n'
nl|'\n'
name|'range_string'
op|'='
string|"'bytes=%d-%d'"
op|'%'
op|'('
name|'file_length'
op|'-'
number|'1000'
op|','
name|'file_length'
op|'+'
number|'2000'
op|')'
newline|'\n'
name|'hdrs'
op|'='
op|'{'
string|"'Range'"
op|':'
name|'range_string'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'file_item'
op|'.'
name|'read'
op|'('
name|'hdrs'
op|'='
name|'hdrs'
op|')'
op|','
name|'data'
op|'['
op|'-'
number|'1000'
op|':'
op|']'
op|','
name|'range_string'
op|')'
newline|'\n'
nl|'\n'
name|'hdrs'
op|'='
op|'{'
string|"'Range'"
op|':'
string|"'0-4'"
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'file_item'
op|'.'
name|'read'
op|'('
name|'hdrs'
op|'='
name|'hdrs'
op|')'
op|','
name|'data'
op|','
string|"'0-4'"
op|')'
newline|'\n'
nl|'\n'
comment|'# RFC 2616 14.35.1'
nl|'\n'
comment|'# "If the entity is shorter than the specified suffix-length, the'
nl|'\n'
comment|'# entire entity-body is used."'
nl|'\n'
name|'range_string'
op|'='
string|"'bytes=-%d'"
op|'%'
op|'('
name|'file_length'
op|'+'
number|'10'
op|')'
newline|'\n'
name|'hdrs'
op|'='
op|'{'
string|"'Range'"
op|':'
name|'range_string'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'file_item'
op|'.'
name|'read'
op|'('
name|'hdrs'
op|'='
name|'hdrs'
op|')'
op|','
name|'data'
op|','
name|'range_string'
op|')'
newline|'\n'
nl|'\n'
DECL|member|testMultiRangeGets
dedent|''
name|'def'
name|'testMultiRangeGets'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'file_length'
op|'='
number|'10000'
newline|'\n'
name|'range_size'
op|'='
name|'file_length'
op|'/'
number|'10'
newline|'\n'
name|'subrange_size'
op|'='
name|'range_size'
op|'/'
number|'10'
newline|'\n'
name|'file_item'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
name|'data'
op|'='
name|'file_item'
op|'.'
name|'write_random'
op|'('
nl|'\n'
name|'file_length'
op|','
name|'hdrs'
op|'='
op|'{'
string|'"Content-Type"'
op|':'
nl|'\n'
string|'"lovecraft/rugose; squamous=true"'
op|'}'
op|')'
newline|'\n'
nl|'\n'
name|'for'
name|'i'
name|'in'
name|'range'
op|'('
number|'0'
op|','
name|'file_length'
op|','
name|'range_size'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'range_string'
op|'='
string|"'bytes=%d-%d,%d-%d,%d-%d'"
op|'%'
op|'('
nl|'\n'
name|'i'
op|','
name|'i'
op|'+'
name|'subrange_size'
op|'-'
number|'1'
op|','
nl|'\n'
name|'i'
op|'+'
number|'2'
op|'*'
name|'subrange_size'
op|','
name|'i'
op|'+'
number|'3'
op|'*'
name|'subrange_size'
op|'-'
number|'1'
op|','
nl|'\n'
name|'i'
op|'+'
number|'4'
op|'*'
name|'subrange_size'
op|','
name|'i'
op|'+'
number|'5'
op|'*'
name|'subrange_size'
op|'-'
number|'1'
op|')'
newline|'\n'
name|'hdrs'
op|'='
op|'{'
string|"'Range'"
op|':'
name|'range_string'
op|'}'
newline|'\n'
nl|'\n'
name|'fetched'
op|'='
name|'file_item'
op|'.'
name|'read'
op|'('
name|'hdrs'
op|'='
name|'hdrs'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'206'
op|')'
newline|'\n'
name|'content_type'
op|'='
name|'file_item'
op|'.'
name|'content_type'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'content_type'
op|'.'
name|'startswith'
op|'('
string|'"multipart/byteranges"'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertIsNone'
op|'('
name|'file_item'
op|'.'
name|'content_range'
op|')'
newline|'\n'
nl|'\n'
comment|'# email.parser.FeedParser wants a message with headers on the'
nl|'\n'
comment|'# front, then two CRLFs, and then a body (like emails have but'
nl|'\n'
comment|"# HTTP response bodies don't). We fake it out by constructing a"
nl|'\n'
comment|'# one-header preamble containing just the Content-Type, then'
nl|'\n'
comment|'# feeding in the response body.'
nl|'\n'
name|'parser'
op|'='
name|'email'
op|'.'
name|'parser'
op|'.'
name|'FeedParser'
op|'('
op|')'
newline|'\n'
name|'parser'
op|'.'
name|'feed'
op|'('
string|'"Content-Type: %s\\r\\n\\r\\n"'
op|'%'
name|'content_type'
op|')'
newline|'\n'
name|'parser'
op|'.'
name|'feed'
op|'('
name|'fetched'
op|')'
newline|'\n'
name|'root_message'
op|'='
name|'parser'
op|'.'
name|'close'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'root_message'
op|'.'
name|'is_multipart'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'byteranges'
op|'='
name|'root_message'
op|'.'
name|'get_payload'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'len'
op|'('
name|'byteranges'
op|')'
op|','
number|'3'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'byteranges'
op|'['
number|'0'
op|']'
op|'['
string|"'Content-Type'"
op|']'
op|','
nl|'\n'
string|'"lovecraft/rugose; squamous=true"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
nl|'\n'
name|'byteranges'
op|'['
number|'0'
op|']'
op|'['
string|"'Content-Range'"
op|']'
op|','
nl|'\n'
string|'"bytes %d-%d/%d"'
op|'%'
op|'('
name|'i'
op|','
name|'i'
op|'+'
name|'subrange_size'
op|'-'
number|'1'
op|','
name|'file_length'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
nl|'\n'
name|'byteranges'
op|'['
number|'0'
op|']'
op|'.'
name|'get_payload'
op|'('
op|')'
op|','
nl|'\n'
name|'data'
op|'['
name|'i'
op|':'
op|'('
name|'i'
op|'+'
name|'subrange_size'
op|')'
op|']'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'byteranges'
op|'['
number|'1'
op|']'
op|'['
string|"'Content-Type'"
op|']'
op|','
nl|'\n'
string|'"lovecraft/rugose; squamous=true"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
nl|'\n'
name|'byteranges'
op|'['
number|'1'
op|']'
op|'['
string|"'Content-Range'"
op|']'
op|','
nl|'\n'
string|'"bytes %d-%d/%d"'
op|'%'
op|'('
name|'i'
op|'+'
number|'2'
op|'*'
name|'subrange_size'
op|','
nl|'\n'
name|'i'
op|'+'
number|'3'
op|'*'
name|'subrange_size'
op|'-'
number|'1'
op|','
name|'file_length'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
nl|'\n'
name|'byteranges'
op|'['
number|'1'
op|']'
op|'.'
name|'get_payload'
op|'('
op|')'
op|','
nl|'\n'
name|'data'
op|'['
op|'('
name|'i'
op|'+'
number|'2'
op|'*'
name|'subrange_size'
op|')'
op|':'
op|'('
name|'i'
op|'+'
number|'3'
op|'*'
name|'subrange_size'
op|')'
op|']'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'byteranges'
op|'['
number|'2'
op|']'
op|'['
string|"'Content-Type'"
op|']'
op|','
nl|'\n'
string|'"lovecraft/rugose; squamous=true"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
nl|'\n'
name|'byteranges'
op|'['
number|'2'
op|']'
op|'['
string|"'Content-Range'"
op|']'
op|','
nl|'\n'
string|'"bytes %d-%d/%d"'
op|'%'
op|'('
name|'i'
op|'+'
number|'4'
op|'*'
name|'subrange_size'
op|','
nl|'\n'
name|'i'
op|'+'
number|'5'
op|'*'
name|'subrange_size'
op|'-'
number|'1'
op|','
name|'file_length'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
nl|'\n'
name|'byteranges'
op|'['
number|'2'
op|']'
op|'.'
name|'get_payload'
op|'('
op|')'
op|','
nl|'\n'
name|'data'
op|'['
op|'('
name|'i'
op|'+'
number|'4'
op|'*'
name|'subrange_size'
op|')'
op|':'
op|'('
name|'i'
op|'+'
number|'5'
op|'*'
name|'subrange_size'
op|')'
op|']'
op|')'
newline|'\n'
nl|'\n'
comment|'# The first two ranges are satisfiable but the third is not; the'
nl|'\n'
comment|'# result is a multipart/byteranges response containing only the two'
nl|'\n'
comment|'# satisfiable byteranges.'
nl|'\n'
dedent|''
name|'range_string'
op|'='
string|"'bytes=%d-%d,%d-%d,%d-%d'"
op|'%'
op|'('
nl|'\n'
number|'0'
op|','
name|'subrange_size'
op|'-'
number|'1'
op|','
nl|'\n'
number|'2'
op|'*'
name|'subrange_size'
op|','
number|'3'
op|'*'
name|'subrange_size'
op|'-'
number|'1'
op|','
nl|'\n'
name|'file_length'
op|','
name|'file_length'
op|'+'
name|'subrange_size'
op|'-'
number|'1'
op|')'
newline|'\n'
name|'hdrs'
op|'='
op|'{'
string|"'Range'"
op|':'
name|'range_string'
op|'}'
newline|'\n'
name|'fetched'
op|'='
name|'file_item'
op|'.'
name|'read'
op|'('
name|'hdrs'
op|'='
name|'hdrs'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'206'
op|')'
newline|'\n'
name|'content_type'
op|'='
name|'file_item'
op|'.'
name|'content_type'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'content_type'
op|'.'
name|'startswith'
op|'('
string|'"multipart/byteranges"'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertIsNone'
op|'('
name|'file_item'
op|'.'
name|'content_range'
op|')'
newline|'\n'
nl|'\n'
name|'parser'
op|'='
name|'email'
op|'.'
name|'parser'
op|'.'
name|'FeedParser'
op|'('
op|')'
newline|'\n'
name|'parser'
op|'.'
name|'feed'
op|'('
string|'"Content-Type: %s\\r\\n\\r\\n"'
op|'%'
name|'content_type'
op|')'
newline|'\n'
name|'parser'
op|'.'
name|'feed'
op|'('
name|'fetched'
op|')'
newline|'\n'
name|'root_message'
op|'='
name|'parser'
op|'.'
name|'close'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'root_message'
op|'.'
name|'is_multipart'
op|'('
op|')'
op|')'
newline|'\n'
name|'byteranges'
op|'='
name|'root_message'
op|'.'
name|'get_payload'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'len'
op|'('
name|'byteranges'
op|')'
op|','
number|'2'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'byteranges'
op|'['
number|'0'
op|']'
op|'['
string|"'Content-Type'"
op|']'
op|','
nl|'\n'
string|'"lovecraft/rugose; squamous=true"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
nl|'\n'
name|'byteranges'
op|'['
number|'0'
op|']'
op|'['
string|"'Content-Range'"
op|']'
op|','
nl|'\n'
string|'"bytes %d-%d/%d"'
op|'%'
op|'('
number|'0'
op|','
name|'subrange_size'
op|'-'
number|'1'
op|','
name|'file_length'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'byteranges'
op|'['
number|'0'
op|']'
op|'.'
name|'get_payload'
op|'('
op|')'
op|','
name|'data'
op|'['
op|':'
name|'subrange_size'
op|']'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'byteranges'
op|'['
number|'1'
op|']'
op|'['
string|"'Content-Type'"
op|']'
op|','
nl|'\n'
string|'"lovecraft/rugose; squamous=true"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
nl|'\n'
name|'byteranges'
op|'['
number|'1'
op|']'
op|'['
string|"'Content-Range'"
op|']'
op|','
nl|'\n'
string|'"bytes %d-%d/%d"'
op|'%'
op|'('
number|'2'
op|'*'
name|'subrange_size'
op|','
number|'3'
op|'*'
name|'subrange_size'
op|'-'
number|'1'
op|','
nl|'\n'
name|'file_length'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
nl|'\n'
name|'byteranges'
op|'['
number|'1'
op|']'
op|'.'
name|'get_payload'
op|'('
op|')'
op|','
nl|'\n'
name|'data'
op|'['
op|'('
number|'2'
op|'*'
name|'subrange_size'
op|')'
op|':'
op|'('
number|'3'
op|'*'
name|'subrange_size'
op|')'
op|']'
op|')'
newline|'\n'
nl|'\n'
comment|'# The first range is satisfiable but the second is not; the'
nl|'\n'
comment|'# result is either a multipart/byteranges response containing one'
nl|'\n'
comment|'# byterange or a normal, non-MIME 206 response.'
nl|'\n'
name|'range_string'
op|'='
string|"'bytes=%d-%d,%d-%d'"
op|'%'
op|'('
nl|'\n'
number|'0'
op|','
name|'subrange_size'
op|'-'
number|'1'
op|','
nl|'\n'
name|'file_length'
op|','
name|'file_length'
op|'+'
name|'subrange_size'
op|'-'
number|'1'
op|')'
newline|'\n'
name|'hdrs'
op|'='
op|'{'
string|"'Range'"
op|':'
name|'range_string'
op|'}'
newline|'\n'
name|'fetched'
op|'='
name|'file_item'
op|'.'
name|'read'
op|'('
name|'hdrs'
op|'='
name|'hdrs'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'206'
op|')'
newline|'\n'
name|'content_type'
op|'='
name|'file_item'
op|'.'
name|'content_type'
newline|'\n'
name|'if'
name|'content_type'
op|'.'
name|'startswith'
op|'('
string|'"multipart/byteranges"'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertIsNone'
op|'('
name|'file_item'
op|'.'
name|'content_range'
op|')'
newline|'\n'
name|'parser'
op|'='
name|'email'
op|'.'
name|'parser'
op|'.'
name|'FeedParser'
op|'('
op|')'
newline|'\n'
name|'parser'
op|'.'
name|'feed'
op|'('
string|'"Content-Type: %s\\r\\n\\r\\n"'
op|'%'
name|'content_type'
op|')'
newline|'\n'
name|'parser'
op|'.'
name|'feed'
op|'('
name|'fetched'
op|')'
newline|'\n'
name|'root_message'
op|'='
name|'parser'
op|'.'
name|'close'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'root_message'
op|'.'
name|'is_multipart'
op|'('
op|')'
op|')'
newline|'\n'
name|'byteranges'
op|'='
name|'root_message'
op|'.'
name|'get_payload'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'len'
op|'('
name|'byteranges'
op|')'
op|','
number|'1'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'byteranges'
op|'['
number|'0'
op|']'
op|'['
string|"'Content-Type'"
op|']'
op|','
nl|'\n'
string|'"lovecraft/rugose; squamous=true"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
nl|'\n'
name|'byteranges'
op|'['
number|'0'
op|']'
op|'['
string|"'Content-Range'"
op|']'
op|','
nl|'\n'
string|'"bytes %d-%d/%d"'
op|'%'
op|'('
number|'0'
op|','
name|'subrange_size'
op|'-'
number|'1'
op|','
name|'file_length'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'byteranges'
op|'['
number|'0'
op|']'
op|'.'
name|'get_payload'
op|'('
op|')'
op|','
name|'data'
op|'['
op|':'
name|'subrange_size'
op|']'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertEqual'
op|'('
nl|'\n'
name|'file_item'
op|'.'
name|'content_range'
op|','
nl|'\n'
string|'"bytes %d-%d/%d"'
op|'%'
op|'('
number|'0'
op|','
name|'subrange_size'
op|'-'
number|'1'
op|','
name|'file_length'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'content_type'
op|','
string|'"lovecraft/rugose; squamous=true"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'fetched'
op|','
name|'data'
op|'['
op|':'
name|'subrange_size'
op|']'
op|')'
newline|'\n'
nl|'\n'
comment|'# No byterange is satisfiable, so we get a 416 response.'
nl|'\n'
dedent|''
name|'range_string'
op|'='
string|"'bytes=%d-%d,%d-%d'"
op|'%'
op|'('
nl|'\n'
name|'file_length'
op|','
name|'file_length'
op|'+'
number|'2'
op|','
nl|'\n'
name|'file_length'
op|'+'
number|'100'
op|','
name|'file_length'
op|'+'
number|'102'
op|')'
newline|'\n'
name|'hdrs'
op|'='
op|'{'
string|"'Range'"
op|':'
name|'range_string'
op|'}'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ResponseError'
op|','
name|'file_item'
op|'.'
name|'read'
op|','
name|'hdrs'
op|'='
name|'hdrs'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'416'
op|')'
newline|'\n'
nl|'\n'
DECL|member|testRangedGetsWithLWSinHeader
dedent|''
name|'def'
name|'testRangedGetsWithLWSinHeader'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'file_length'
op|'='
number|'10000'
newline|'\n'
name|'file_item'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
name|'data'
op|'='
name|'file_item'
op|'.'
name|'write_random'
op|'('
name|'file_length'
op|')'
newline|'\n'
nl|'\n'
name|'for'
name|'r'
name|'in'
op|'('
string|"'BYTES=0-999'"
op|','
string|"'bytes = 0-999'"
op|','
string|"'BYTES = 0 - 999'"
op|','
nl|'\n'
string|"'bytes = 0 - 999'"
op|','
string|"'bytes=0 - 999'"
op|','
string|"'bytes=0-999 '"
op|')'
op|':'
newline|'\n'
nl|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'file_item'
op|'.'
name|'read'
op|'('
name|'hdrs'
op|'='
op|'{'
string|"'Range'"
op|':'
name|'r'
op|'}'
op|')'
op|'=='
name|'data'
op|'['
number|'0'
op|':'
number|'1000'
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|testFileSizeLimit
dedent|''
dedent|''
name|'def'
name|'testFileSizeLimit'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'limit'
op|'='
name|'load_constraint'
op|'('
string|"'max_file_size'"
op|')'
newline|'\n'
name|'tsecs'
op|'='
number|'3'
newline|'\n'
nl|'\n'
DECL|function|timeout
name|'def'
name|'timeout'
op|'('
name|'seconds'
op|','
name|'method'
op|','
op|'*'
name|'args'
op|','
op|'**'
name|'kwargs'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'try'
op|':'
newline|'\n'
indent|'                '
name|'with'
name|'eventlet'
op|'.'
name|'Timeout'
op|'('
name|'seconds'
op|')'
op|':'
newline|'\n'
indent|'                    '
name|'method'
op|'('
op|'*'
name|'args'
op|','
op|'**'
name|'kwargs'
op|')'
newline|'\n'
dedent|''
dedent|''
name|'except'
name|'eventlet'
op|'.'
name|'Timeout'
op|':'
newline|'\n'
indent|'                '
name|'return'
name|'True'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                '
name|'return'
name|'False'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'for'
name|'i'
name|'in'
op|'('
name|'limit'
op|'-'
number|'100'
op|','
name|'limit'
op|'-'
number|'10'
op|','
name|'limit'
op|'-'
number|'1'
op|','
name|'limit'
op|','
name|'limit'
op|'+'
number|'1'
op|','
nl|'\n'
name|'limit'
op|'+'
number|'10'
op|','
name|'limit'
op|'+'
number|'100'
op|')'
op|':'
newline|'\n'
nl|'\n'
indent|'            '
name|'file_item'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'if'
name|'i'
op|'<='
name|'limit'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'timeout'
op|'('
name|'tsecs'
op|','
name|'file_item'
op|'.'
name|'write'
op|','
nl|'\n'
name|'cfg'
op|'='
op|'{'
string|"'set_content_length'"
op|':'
name|'i'
op|'}'
op|')'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ResponseError'
op|','
name|'timeout'
op|','
name|'tsecs'
op|','
nl|'\n'
name|'file_item'
op|'.'
name|'write'
op|','
nl|'\n'
name|'cfg'
op|'='
op|'{'
string|"'set_content_length'"
op|':'
name|'i'
op|'}'
op|')'
newline|'\n'
nl|'\n'
DECL|member|testNoContentLengthForPut
dedent|''
dedent|''
dedent|''
name|'def'
name|'testNoContentLengthForPut'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'file_item'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ResponseError'
op|','
name|'file_item'
op|'.'
name|'write'
op|','
string|"'testing'"
op|','
nl|'\n'
name|'cfg'
op|'='
op|'{'
string|"'no_content_length'"
op|':'
name|'True'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'411'
op|')'
newline|'\n'
nl|'\n'
DECL|member|testDelete
dedent|''
name|'def'
name|'testDelete'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'file_item'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
name|'file_item'
op|'.'
name|'write_random'
op|'('
name|'self'
op|'.'
name|'env'
op|'.'
name|'file_size'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertIn'
op|'('
name|'file_item'
op|'.'
name|'name'
op|','
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'files'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'file_item'
op|'.'
name|'delete'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertNotIn'
op|'('
name|'file_item'
op|'.'
name|'name'
op|','
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'files'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|testBadHeaders
dedent|''
name|'def'
name|'testBadHeaders'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'file_length'
op|'='
number|'100'
newline|'\n'
nl|'\n'
comment|'# no content type on puts should be ok'
nl|'\n'
name|'file_item'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
name|'file_item'
op|'.'
name|'write_random'
op|'('
name|'file_length'
op|','
name|'cfg'
op|'='
op|'{'
string|"'no_content_type'"
op|':'
name|'True'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'201'
op|')'
newline|'\n'
nl|'\n'
comment|'# content length x'
nl|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ResponseError'
op|','
name|'file_item'
op|'.'
name|'write_random'
op|','
name|'file_length'
op|','
nl|'\n'
name|'hdrs'
op|'='
op|'{'
string|"'Content-Length'"
op|':'
string|"'X'"
op|'}'
op|','
nl|'\n'
name|'cfg'
op|'='
op|'{'
string|"'no_content_length'"
op|':'
name|'True'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'400'
op|')'
newline|'\n'
nl|'\n'
comment|'# no content-length'
nl|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ResponseError'
op|','
name|'file_item'
op|'.'
name|'write_random'
op|','
name|'file_length'
op|','
nl|'\n'
name|'cfg'
op|'='
op|'{'
string|"'no_content_length'"
op|':'
name|'True'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'411'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ResponseError'
op|','
name|'file_item'
op|'.'
name|'write_random'
op|','
name|'file_length'
op|','
nl|'\n'
name|'hdrs'
op|'='
op|'{'
string|"'transfer-encoding'"
op|':'
string|"'gzip,chunked'"
op|'}'
op|','
nl|'\n'
name|'cfg'
op|'='
op|'{'
string|"'no_content_length'"
op|':'
name|'True'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'501'
op|')'
newline|'\n'
nl|'\n'
comment|'# bad request types'
nl|'\n'
comment|"# for req in ('LICK', 'GETorHEAD_base', 'container_info',"
nl|'\n'
comment|"#             'best_response'):"
nl|'\n'
name|'for'
name|'req'
name|'in'
op|'('
string|"'LICK'"
op|','
string|"'GETorHEAD_base'"
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'env'
op|'.'
name|'account'
op|'.'
name|'conn'
op|'.'
name|'make_request'
op|'('
name|'req'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'405'
op|')'
newline|'\n'
nl|'\n'
comment|'# bad range headers'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'assertTrue'
op|'('
nl|'\n'
name|'len'
op|'('
name|'file_item'
op|'.'
name|'read'
op|'('
name|'hdrs'
op|'='
op|'{'
string|"'Range'"
op|':'
string|"'parsecs=8-12'"
op|'}'
op|')'
op|')'
op|'=='
nl|'\n'
name|'file_length'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'200'
op|')'
newline|'\n'
nl|'\n'
DECL|member|testMetadataLengthLimits
dedent|''
name|'def'
name|'testMetadataLengthLimits'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'key_limit'
op|'='
name|'load_constraint'
op|'('
string|"'max_meta_name_length'"
op|')'
newline|'\n'
name|'value_limit'
op|'='
name|'load_constraint'
op|'('
string|"'max_meta_value_length'"
op|')'
newline|'\n'
name|'lengths'
op|'='
op|'['
op|'['
name|'key_limit'
op|','
name|'value_limit'
op|']'
op|','
op|'['
name|'key_limit'
op|','
name|'value_limit'
op|'+'
number|'1'
op|']'
op|','
nl|'\n'
op|'['
name|'key_limit'
op|'+'
number|'1'
op|','
name|'value_limit'
op|']'
op|','
op|'['
name|'key_limit'
op|','
number|'0'
op|']'
op|','
nl|'\n'
op|'['
name|'key_limit'
op|','
name|'value_limit'
op|'*'
number|'10'
op|']'
op|','
nl|'\n'
op|'['
name|'key_limit'
op|'*'
number|'10'
op|','
name|'value_limit'
op|']'
op|']'
newline|'\n'
nl|'\n'
name|'for'
name|'l'
name|'in'
name|'lengths'
op|':'
newline|'\n'
indent|'            '
name|'metadata'
op|'='
op|'{'
string|"'a'"
op|'*'
name|'l'
op|'['
number|'0'
op|']'
op|':'
string|"'b'"
op|'*'
name|'l'
op|'['
number|'1'
op|']'
op|'}'
newline|'\n'
name|'file_item'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
name|'file_item'
op|'.'
name|'metadata'
op|'='
name|'metadata'
newline|'\n'
nl|'\n'
name|'if'
name|'l'
op|'['
number|'0'
op|']'
op|'<='
name|'key_limit'
name|'and'
name|'l'
op|'['
number|'1'
op|']'
op|'<='
name|'value_limit'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'file_item'
op|'.'
name|'write'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'201'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'file_item'
op|'.'
name|'sync_metadata'
op|'('
op|')'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ResponseError'
op|','
name|'file_item'
op|'.'
name|'write'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'400'
op|')'
newline|'\n'
name|'file_item'
op|'.'
name|'metadata'
op|'='
op|'{'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'file_item'
op|'.'
name|'write'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'201'
op|')'
newline|'\n'
name|'file_item'
op|'.'
name|'metadata'
op|'='
name|'metadata'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ResponseError'
op|','
name|'file_item'
op|'.'
name|'sync_metadata'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'400'
op|')'
newline|'\n'
nl|'\n'
DECL|member|testEtagWayoff
dedent|''
dedent|''
dedent|''
name|'def'
name|'testEtagWayoff'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'file_item'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
name|'hdrs'
op|'='
op|'{'
string|"'etag'"
op|':'
string|"'reallylonganddefinitelynotavalidetagvalue'"
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ResponseError'
op|','
name|'file_item'
op|'.'
name|'write_random'
op|','
name|'hdrs'
op|'='
name|'hdrs'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'422'
op|')'
newline|'\n'
nl|'\n'
DECL|member|testFileCreate
dedent|''
name|'def'
name|'testFileCreate'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'for'
name|'i'
name|'in'
name|'range'
op|'('
number|'10'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'file_item'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
name|'data'
op|'='
name|'file_item'
op|'.'
name|'write_random'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'201'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'data'
op|'=='
name|'file_item'
op|'.'
name|'read'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'200'
op|')'
newline|'\n'
nl|'\n'
DECL|member|testHead
dedent|''
dedent|''
name|'def'
name|'testHead'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'file_name'
op|'='
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
newline|'\n'
name|'content_type'
op|'='
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'file_item'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
name|'file_name'
op|')'
newline|'\n'
name|'file_item'
op|'.'
name|'content_type'
op|'='
name|'content_type'
newline|'\n'
name|'file_item'
op|'.'
name|'write_random'
op|'('
name|'self'
op|'.'
name|'env'
op|'.'
name|'file_size'
op|')'
newline|'\n'
nl|'\n'
name|'md5'
op|'='
name|'file_item'
op|'.'
name|'md5'
newline|'\n'
nl|'\n'
name|'file_item'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
name|'file_name'
op|')'
newline|'\n'
name|'info'
op|'='
name|'file_item'
op|'.'
name|'info'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'200'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'info'
op|'['
string|"'content_length'"
op|']'
op|','
name|'self'
op|'.'
name|'env'
op|'.'
name|'file_size'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'info'
op|'['
string|"'etag'"
op|']'
op|','
name|'md5'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'info'
op|'['
string|"'content_type'"
op|']'
op|','
name|'content_type'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertIn'
op|'('
string|"'last_modified'"
op|','
name|'info'
op|')'
newline|'\n'
nl|'\n'
DECL|member|testDeleteOfFileThatDoesNotExist
dedent|''
name|'def'
name|'testDeleteOfFileThatDoesNotExist'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# in container that exists'
nl|'\n'
indent|'        '
name|'file_item'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ResponseError'
op|','
name|'file_item'
op|'.'
name|'delete'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'404'
op|')'
newline|'\n'
nl|'\n'
comment|'# in container that does not exist'
nl|'\n'
name|'container'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'account'
op|'.'
name|'container'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
name|'file_item'
op|'='
name|'container'
op|'.'
name|'file'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ResponseError'
op|','
name|'file_item'
op|'.'
name|'delete'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'404'
op|')'
newline|'\n'
nl|'\n'
DECL|member|testHeadOnFileThatDoesNotExist
dedent|''
name|'def'
name|'testHeadOnFileThatDoesNotExist'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# in container that exists'
nl|'\n'
indent|'        '
name|'file_item'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ResponseError'
op|','
name|'file_item'
op|'.'
name|'info'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'404'
op|')'
newline|'\n'
nl|'\n'
comment|'# in container that does not exist'
nl|'\n'
name|'container'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'account'
op|'.'
name|'container'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
name|'file_item'
op|'='
name|'container'
op|'.'
name|'file'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ResponseError'
op|','
name|'file_item'
op|'.'
name|'info'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'404'
op|')'
newline|'\n'
nl|'\n'
DECL|member|testMetadataOnPost
dedent|''
name|'def'
name|'testMetadataOnPost'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'file_item'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
name|'file_item'
op|'.'
name|'write_random'
op|'('
name|'self'
op|'.'
name|'env'
op|'.'
name|'file_size'
op|')'
newline|'\n'
nl|'\n'
name|'for'
name|'i'
name|'in'
name|'range'
op|'('
number|'10'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'metadata'
op|'='
op|'{'
op|'}'
newline|'\n'
name|'for'
name|'j'
name|'in'
name|'range'
op|'('
number|'10'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'metadata'
op|'['
name|'Utils'
op|'.'
name|'create_ascii_name'
op|'('
op|')'
op|']'
op|'='
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'file_item'
op|'.'
name|'metadata'
op|'='
name|'metadata'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'file_item'
op|'.'
name|'sync_metadata'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
op|'('
number|'201'
op|','
number|'202'
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'file_item'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
name|'file_item'
op|'.'
name|'name'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'file_item'
op|'.'
name|'initialize'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'200'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'file_item'
op|'.'
name|'metadata'
op|','
name|'metadata'
op|')'
newline|'\n'
nl|'\n'
DECL|member|testGetContentType
dedent|''
dedent|''
name|'def'
name|'testGetContentType'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'file_name'
op|'='
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
newline|'\n'
name|'content_type'
op|'='
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'file_item'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
name|'file_name'
op|')'
newline|'\n'
name|'file_item'
op|'.'
name|'content_type'
op|'='
name|'content_type'
newline|'\n'
name|'file_item'
op|'.'
name|'write_random'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'file_item'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
name|'file_name'
op|')'
newline|'\n'
name|'file_item'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'content_type'
op|','
name|'file_item'
op|'.'
name|'content_type'
op|')'
newline|'\n'
nl|'\n'
DECL|member|testGetOnFileThatDoesNotExist
dedent|''
name|'def'
name|'testGetOnFileThatDoesNotExist'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# in container that exists'
nl|'\n'
indent|'        '
name|'file_item'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ResponseError'
op|','
name|'file_item'
op|'.'
name|'read'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'404'
op|')'
newline|'\n'
nl|'\n'
comment|'# in container that does not exist'
nl|'\n'
name|'container'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'account'
op|'.'
name|'container'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
name|'file_item'
op|'='
name|'container'
op|'.'
name|'file'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ResponseError'
op|','
name|'file_item'
op|'.'
name|'read'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'404'
op|')'
newline|'\n'
nl|'\n'
DECL|member|testPostOnFileThatDoesNotExist
dedent|''
name|'def'
name|'testPostOnFileThatDoesNotExist'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# in container that exists'
nl|'\n'
indent|'        '
name|'file_item'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
name|'file_item'
op|'.'
name|'metadata'
op|'['
string|"'Field'"
op|']'
op|'='
string|"'Value'"
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ResponseError'
op|','
name|'file_item'
op|'.'
name|'sync_metadata'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'404'
op|')'
newline|'\n'
nl|'\n'
comment|'# in container that does not exist'
nl|'\n'
name|'container'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'account'
op|'.'
name|'container'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
name|'file_item'
op|'='
name|'container'
op|'.'
name|'file'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
name|'file_item'
op|'.'
name|'metadata'
op|'['
string|"'Field'"
op|']'
op|'='
string|"'Value'"
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ResponseError'
op|','
name|'file_item'
op|'.'
name|'sync_metadata'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'404'
op|')'
newline|'\n'
nl|'\n'
DECL|member|testMetadataOnPut
dedent|''
name|'def'
name|'testMetadataOnPut'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'for'
name|'i'
name|'in'
name|'range'
op|'('
number|'10'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'metadata'
op|'='
op|'{'
op|'}'
newline|'\n'
name|'for'
name|'j'
name|'in'
name|'range'
op|'('
number|'10'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'metadata'
op|'['
name|'Utils'
op|'.'
name|'create_ascii_name'
op|'('
op|')'
op|']'
op|'='
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'file_item'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
name|'file_item'
op|'.'
name|'metadata'
op|'='
name|'metadata'
newline|'\n'
name|'file_item'
op|'.'
name|'write_random'
op|'('
name|'self'
op|'.'
name|'env'
op|'.'
name|'file_size'
op|')'
newline|'\n'
nl|'\n'
name|'file_item'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
name|'file_item'
op|'.'
name|'name'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'file_item'
op|'.'
name|'initialize'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'200'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'file_item'
op|'.'
name|'metadata'
op|','
name|'metadata'
op|')'
newline|'\n'
nl|'\n'
DECL|member|testSerialization
dedent|''
dedent|''
name|'def'
name|'testSerialization'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'container'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'account'
op|'.'
name|'container'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'container'
op|'.'
name|'create'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'files'
op|'='
op|'['
op|']'
newline|'\n'
name|'for'
name|'i'
name|'in'
op|'('
number|'0'
op|','
number|'1'
op|','
number|'10'
op|','
number|'100'
op|','
number|'1000'
op|','
number|'10000'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'files'
op|'.'
name|'append'
op|'('
op|'{'
string|"'name'"
op|':'
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|','
nl|'\n'
string|"'content_type'"
op|':'
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|','
string|"'bytes'"
op|':'
name|'i'
op|'}'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'write_time'
op|'='
name|'time'
op|'.'
name|'time'
op|'('
op|')'
newline|'\n'
name|'for'
name|'f'
name|'in'
name|'files'
op|':'
newline|'\n'
indent|'            '
name|'file_item'
op|'='
name|'container'
op|'.'
name|'file'
op|'('
name|'f'
op|'['
string|"'name'"
op|']'
op|')'
newline|'\n'
name|'file_item'
op|'.'
name|'content_type'
op|'='
name|'f'
op|'['
string|"'content_type'"
op|']'
newline|'\n'
name|'file_item'
op|'.'
name|'write_random'
op|'('
name|'f'
op|'['
string|"'bytes'"
op|']'
op|')'
newline|'\n'
nl|'\n'
name|'f'
op|'['
string|"'hash'"
op|']'
op|'='
name|'file_item'
op|'.'
name|'md5'
newline|'\n'
name|'f'
op|'['
string|"'json'"
op|']'
op|'='
name|'False'
newline|'\n'
name|'f'
op|'['
string|"'xml'"
op|']'
op|'='
name|'False'
newline|'\n'
dedent|''
name|'write_time'
op|'='
name|'time'
op|'.'
name|'time'
op|'('
op|')'
op|'-'
name|'write_time'
newline|'\n'
nl|'\n'
name|'for'
name|'format_type'
name|'in'
op|'['
string|"'json'"
op|','
string|"'xml'"
op|']'
op|':'
newline|'\n'
indent|'            '
name|'for'
name|'file_item'
name|'in'
name|'container'
op|'.'
name|'files'
op|'('
name|'parms'
op|'='
op|'{'
string|"'format'"
op|':'
name|'format_type'
op|'}'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'found'
op|'='
name|'False'
newline|'\n'
name|'for'
name|'f'
name|'in'
name|'files'
op|':'
newline|'\n'
indent|'                    '
name|'if'
name|'f'
op|'['
string|"'name'"
op|']'
op|'!='
name|'file_item'
op|'['
string|"'name'"
op|']'
op|':'
newline|'\n'
indent|'                        '
name|'continue'
newline|'\n'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'file_item'
op|'['
string|"'content_type'"
op|']'
op|','
nl|'\n'
name|'f'
op|'['
string|"'content_type'"
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'int'
op|'('
name|'file_item'
op|'['
string|"'bytes'"
op|']'
op|')'
op|','
name|'f'
op|'['
string|"'bytes'"
op|']'
op|')'
newline|'\n'
nl|'\n'
name|'d'
op|'='
name|'datetime'
op|'.'
name|'strptime'
op|'('
nl|'\n'
name|'file_item'
op|'['
string|"'last_modified'"
op|']'
op|'.'
name|'split'
op|'('
string|"'.'"
op|')'
op|'['
number|'0'
op|']'
op|','
nl|'\n'
string|'"%Y-%m-%dT%H:%M:%S"'
op|')'
newline|'\n'
name|'lm'
op|'='
name|'time'
op|'.'
name|'mktime'
op|'('
name|'d'
op|'.'
name|'timetuple'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'if'
string|"'last_modified'"
name|'in'
name|'f'
op|':'
newline|'\n'
indent|'                        '
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'f'
op|'['
string|"'last_modified'"
op|']'
op|','
name|'lm'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                        '
name|'f'
op|'['
string|"'last_modified'"
op|']'
op|'='
name|'lm'
newline|'\n'
nl|'\n'
dedent|''
name|'f'
op|'['
name|'format_type'
op|']'
op|'='
name|'True'
newline|'\n'
name|'found'
op|'='
name|'True'
newline|'\n'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'assertTrue'
op|'('
nl|'\n'
name|'found'
op|','
string|"'Unexpected file %s found in '"
nl|'\n'
string|"'%s listing'"
op|'%'
op|'('
name|'file_item'
op|'['
string|"'name'"
op|']'
op|','
name|'format_type'
op|')'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'headers'
op|'='
name|'dict'
op|'('
name|'self'
op|'.'
name|'env'
op|'.'
name|'conn'
op|'.'
name|'response'
op|'.'
name|'getheaders'
op|'('
op|')'
op|')'
newline|'\n'
name|'if'
name|'format_type'
op|'=='
string|"'json'"
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'headers'
op|'['
string|"'content-type'"
op|']'
op|','
nl|'\n'
string|"'application/json; charset=utf-8'"
op|')'
newline|'\n'
dedent|''
name|'elif'
name|'format_type'
op|'=='
string|"'xml'"
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'headers'
op|'['
string|"'content-type'"
op|']'
op|','
nl|'\n'
string|"'application/xml; charset=utf-8'"
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'lm_diff'
op|'='
name|'max'
op|'('
op|'['
name|'f'
op|'['
string|"'last_modified'"
op|']'
name|'for'
name|'f'
name|'in'
name|'files'
op|']'
op|')'
op|'-'
name|'min'
op|'('
op|'['
name|'f'
op|'['
string|"'last_modified'"
op|']'
name|'for'
name|'f'
name|'in'
name|'files'
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
nl|'\n'
name|'lm_diff'
op|'<'
name|'write_time'
op|'+'
number|'1'
op|','
string|"'Diff in last '"
nl|'\n'
string|"'modified times should be less than time to write files'"
op|')'
newline|'\n'
nl|'\n'
name|'for'
name|'f'
name|'in'
name|'files'
op|':'
newline|'\n'
indent|'            '
name|'for'
name|'format_type'
name|'in'
op|'['
string|"'json'"
op|','
string|"'xml'"
op|']'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'assertTrue'
op|'('
nl|'\n'
name|'f'
op|'['
name|'format_type'
op|']'
op|','
string|"'File %s not found in %s listing'"
nl|'\n'
op|'%'
op|'('
name|'f'
op|'['
string|"'name'"
op|']'
op|','
name|'format_type'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|testStackedOverwrite
dedent|''
dedent|''
dedent|''
name|'def'
name|'testStackedOverwrite'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'file_item'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'for'
name|'i'
name|'in'
name|'range'
op|'('
number|'1'
op|','
number|'11'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'data'
op|'='
name|'file_item'
op|'.'
name|'write_random'
op|'('
number|'512'
op|')'
newline|'\n'
name|'file_item'
op|'.'
name|'write'
op|'('
name|'data'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'file_item'
op|'.'
name|'read'
op|'('
op|')'
op|'=='
name|'data'
op|')'
newline|'\n'
nl|'\n'
DECL|member|testTooLongName
dedent|''
name|'def'
name|'testTooLongName'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'file_item'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
string|"'x'"
op|'*'
number|'1025'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ResponseError'
op|','
name|'file_item'
op|'.'
name|'write'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'400'
op|')'
newline|'\n'
nl|'\n'
DECL|member|testZeroByteFile
dedent|''
name|'def'
name|'testZeroByteFile'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'file_item'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'file_item'
op|'.'
name|'write'
op|'('
string|"''"
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertIn'
op|'('
name|'file_item'
op|'.'
name|'name'
op|','
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'files'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'file_item'
op|'.'
name|'read'
op|'('
op|')'
op|'=='
string|"''"
op|')'
newline|'\n'
nl|'\n'
DECL|member|testEtagResponse
dedent|''
name|'def'
name|'testEtagResponse'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'file_item'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'data'
op|'='
name|'six'
op|'.'
name|'StringIO'
op|'('
name|'file_item'
op|'.'
name|'write_random'
op|'('
number|'512'
op|')'
op|')'
newline|'\n'
name|'etag'
op|'='
name|'File'
op|'.'
name|'compute_md5sum'
op|'('
name|'data'
op|')'
newline|'\n'
nl|'\n'
name|'headers'
op|'='
name|'dict'
op|'('
name|'self'
op|'.'
name|'env'
op|'.'
name|'conn'
op|'.'
name|'response'
op|'.'
name|'getheaders'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertIn'
op|'('
string|"'etag'"
op|','
name|'headers'
op|'.'
name|'keys'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'header_etag'
op|'='
name|'headers'
op|'['
string|"'etag'"
op|']'
op|'.'
name|'strip'
op|'('
string|'\'"\''
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'etag'
op|','
name|'header_etag'
op|')'
newline|'\n'
nl|'\n'
DECL|member|testChunkedPut
dedent|''
name|'def'
name|'testChunkedPut'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
op|'('
name|'tf'
op|'.'
name|'web_front_end'
op|'=='
string|"'apache2'"
op|')'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'SkipTest'
op|'('
string|'"Chunked PUT can only be tested with apache2 web"'
nl|'\n'
string|'" front end"'
op|')'
newline|'\n'
nl|'\n'
DECL|function|chunks
dedent|''
name|'def'
name|'chunks'
op|'('
name|'s'
op|','
name|'length'
op|'='
number|'3'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'i'
op|','
name|'j'
op|'='
number|'0'
op|','
name|'length'
newline|'\n'
name|'while'
name|'i'
op|'<'
name|'len'
op|'('
name|'s'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'yield'
name|'s'
op|'['
name|'i'
op|':'
name|'j'
op|']'
newline|'\n'
name|'i'
op|','
name|'j'
op|'='
name|'j'
op|','
name|'j'
op|'+'
name|'length'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'data'
op|'='
name|'File'
op|'.'
name|'random_data'
op|'('
number|'10000'
op|')'
newline|'\n'
name|'etag'
op|'='
name|'File'
op|'.'
name|'compute_md5sum'
op|'('
name|'data'
op|')'
newline|'\n'
nl|'\n'
name|'for'
name|'i'
name|'in'
op|'('
number|'1'
op|','
number|'10'
op|','
number|'100'
op|','
number|'1000'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'file_item'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'for'
name|'j'
name|'in'
name|'chunks'
op|'('
name|'data'
op|','
name|'i'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'file_item'
op|'.'
name|'chunked_write'
op|'('
name|'j'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'file_item'
op|'.'
name|'chunked_write'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'data'
op|'=='
name|'file_item'
op|'.'
name|'read'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'info'
op|'='
name|'file_item'
op|'.'
name|'info'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'etag'
op|','
name|'info'
op|'['
string|"'etag'"
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_POST
dedent|''
dedent|''
name|'def'
name|'test_POST'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# verify consistency between object and container listing metadata'
nl|'\n'
indent|'        '
name|'file_name'
op|'='
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
newline|'\n'
name|'file_item'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
name|'file_name'
op|')'
newline|'\n'
name|'file_item'
op|'.'
name|'content_type'
op|'='
string|"'text/foobar'"
newline|'\n'
name|'file_item'
op|'.'
name|'write_random'
op|'('
number|'1024'
op|')'
newline|'\n'
nl|'\n'
comment|'# sanity check'
nl|'\n'
name|'file_item'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
name|'file_name'
op|')'
newline|'\n'
name|'file_item'
op|'.'
name|'initialize'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'text/foobar'"
op|','
name|'file_item'
op|'.'
name|'content_type'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'1024'
op|','
name|'file_item'
op|'.'
name|'size'
op|')'
newline|'\n'
name|'etag'
op|'='
name|'file_item'
op|'.'
name|'etag'
newline|'\n'
nl|'\n'
comment|'# check container listing is consistent'
nl|'\n'
name|'listing'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'files'
op|'('
name|'parms'
op|'='
op|'{'
string|"'format'"
op|':'
string|"'json'"
op|'}'
op|')'
newline|'\n'
name|'for'
name|'f_dict'
name|'in'
name|'listing'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'f_dict'
op|'['
string|"'name'"
op|']'
op|'=='
name|'file_name'
op|':'
newline|'\n'
indent|'                '
name|'break'
newline|'\n'
dedent|''
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'fail'
op|'('
string|"'Failed to find file %r in listing'"
op|'%'
name|'file_name'
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'1024'
op|','
name|'f_dict'
op|'['
string|"'bytes'"
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'text/foobar'"
op|','
name|'f_dict'
op|'['
string|"'content_type'"
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'etag'
op|','
name|'f_dict'
op|'['
string|"'hash'"
op|']'
op|')'
newline|'\n'
nl|'\n'
comment|'# now POST updated content-type to each file'
nl|'\n'
name|'file_item'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
name|'file_name'
op|')'
newline|'\n'
name|'file_item'
op|'.'
name|'content_type'
op|'='
string|"'image/foobarbaz'"
newline|'\n'
name|'file_item'
op|'.'
name|'sync_metadata'
op|'('
op|'{'
string|"'Test'"
op|':'
string|"'blah'"
op|'}'
op|')'
newline|'\n'
nl|'\n'
comment|'# sanity check object metadata'
nl|'\n'
name|'file_item'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
name|'file_name'
op|')'
newline|'\n'
name|'file_item'
op|'.'
name|'initialize'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'1024'
op|','
name|'file_item'
op|'.'
name|'size'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'image/foobarbaz'"
op|','
name|'file_item'
op|'.'
name|'content_type'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'etag'
op|','
name|'file_item'
op|'.'
name|'etag'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertIn'
op|'('
string|"'test'"
op|','
name|'file_item'
op|'.'
name|'metadata'
op|')'
newline|'\n'
nl|'\n'
comment|'# check for consistency between object and container listing'
nl|'\n'
name|'listing'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'files'
op|'('
name|'parms'
op|'='
op|'{'
string|"'format'"
op|':'
string|"'json'"
op|'}'
op|')'
newline|'\n'
name|'for'
name|'f_dict'
name|'in'
name|'listing'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'f_dict'
op|'['
string|"'name'"
op|']'
op|'=='
name|'file_name'
op|':'
newline|'\n'
indent|'                '
name|'break'
newline|'\n'
dedent|''
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'fail'
op|'('
string|"'Failed to find file %r in listing'"
op|'%'
name|'file_name'
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'1024'
op|','
name|'f_dict'
op|'['
string|"'bytes'"
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'image/foobarbaz'"
op|','
name|'f_dict'
op|'['
string|"'content_type'"
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'etag'
op|','
name|'f_dict'
op|'['
string|"'hash'"
op|']'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|TestFileUTF8
dedent|''
dedent|''
name|'class'
name|'TestFileUTF8'
op|'('
name|'Base2'
op|','
name|'TestFile'
op|')'
op|':'
newline|'\n'
DECL|variable|set_up
indent|'    '
name|'set_up'
op|'='
name|'False'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|TestDloEnv
dedent|''
name|'class'
name|'TestDloEnv'
op|'('
name|'object'
op|')'
op|':'
newline|'\n'
indent|'    '
op|'@'
name|'classmethod'
newline|'\n'
DECL|member|setUp
name|'def'
name|'setUp'
op|'('
name|'cls'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'cls'
op|'.'
name|'conn'
op|'='
name|'Connection'
op|'('
name|'tf'
op|'.'
name|'config'
op|')'
newline|'\n'
name|'cls'
op|'.'
name|'conn'
op|'.'
name|'authenticate'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'config2'
op|'='
name|'tf'
op|'.'
name|'config'
op|'.'
name|'copy'
op|'('
op|')'
newline|'\n'
name|'config2'
op|'['
string|"'username'"
op|']'
op|'='
name|'tf'
op|'.'
name|'config'
op|'['
string|"'username3'"
op|']'
newline|'\n'
name|'config2'
op|'['
string|"'password'"
op|']'
op|'='
name|'tf'
op|'.'
name|'config'
op|'['
string|"'password3'"
op|']'
newline|'\n'
name|'cls'
op|'.'
name|'conn2'
op|'='
name|'Connection'
op|'('
name|'config2'
op|')'
newline|'\n'
name|'cls'
op|'.'
name|'conn2'
op|'.'
name|'authenticate'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'cls'
op|'.'
name|'account'
op|'='
name|'Account'
op|'('
name|'cls'
op|'.'
name|'conn'
op|','
name|'tf'
op|'.'
name|'config'
op|'.'
name|'get'
op|'('
string|"'account'"
op|','
nl|'\n'
name|'tf'
op|'.'
name|'config'
op|'['
string|"'username'"
op|']'
op|')'
op|')'
newline|'\n'
name|'cls'
op|'.'
name|'account'
op|'.'
name|'delete_containers'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'cls'
op|'.'
name|'container'
op|'='
name|'cls'
op|'.'
name|'account'
op|'.'
name|'container'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
name|'cls'
op|'.'
name|'container2'
op|'='
name|'cls'
op|'.'
name|'account'
op|'.'
name|'container'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'for'
name|'cont'
name|'in'
op|'('
name|'cls'
op|'.'
name|'container'
op|','
name|'cls'
op|'.'
name|'container2'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'not'
name|'cont'
op|'.'
name|'create'
op|'('
op|')'
op|':'
newline|'\n'
indent|'                '
name|'raise'
name|'ResponseError'
op|'('
name|'cls'
op|'.'
name|'conn'
op|'.'
name|'response'
op|')'
newline|'\n'
nl|'\n'
comment|'# avoid getting a prefix that stops halfway through an encoded'
nl|'\n'
comment|'# character'
nl|'\n'
dedent|''
dedent|''
name|'prefix'
op|'='
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|'.'
name|'decode'
op|'('
string|'"utf-8"'
op|')'
op|'['
op|':'
number|'10'
op|']'
op|'.'
name|'encode'
op|'('
string|'"utf-8"'
op|')'
newline|'\n'
name|'cls'
op|'.'
name|'segment_prefix'
op|'='
name|'prefix'
newline|'\n'
nl|'\n'
name|'for'
name|'letter'
name|'in'
op|'('
string|"'a'"
op|','
string|"'b'"
op|','
string|"'c'"
op|','
string|"'d'"
op|','
string|"'e'"
op|')'
op|':'
newline|'\n'
indent|'            '
name|'file_item'
op|'='
name|'cls'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
string|'"%s/seg_lower%s"'
op|'%'
op|'('
name|'prefix'
op|','
name|'letter'
op|')'
op|')'
newline|'\n'
name|'file_item'
op|'.'
name|'write'
op|'('
name|'letter'
op|'*'
number|'10'
op|')'
newline|'\n'
nl|'\n'
name|'file_item'
op|'='
name|'cls'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
string|'"%s/seg_upper%s"'
op|'%'
op|'('
name|'prefix'
op|','
name|'letter'
op|')'
op|')'
newline|'\n'
name|'file_item'
op|'.'
name|'write'
op|'('
name|'letter'
op|'.'
name|'upper'
op|'('
op|')'
op|'*'
number|'10'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'for'
name|'letter'
name|'in'
op|'('
string|"'f'"
op|','
string|"'g'"
op|','
string|"'h'"
op|','
string|"'i'"
op|','
string|"'j'"
op|')'
op|':'
newline|'\n'
indent|'            '
name|'file_item'
op|'='
name|'cls'
op|'.'
name|'container2'
op|'.'
name|'file'
op|'('
string|'"%s/seg_lower%s"'
op|'%'
nl|'\n'
op|'('
name|'prefix'
op|','
name|'letter'
op|')'
op|')'
newline|'\n'
name|'file_item'
op|'.'
name|'write'
op|'('
name|'letter'
op|'*'
number|'10'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'man1'
op|'='
name|'cls'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
string|'"man1"'
op|')'
newline|'\n'
name|'man1'
op|'.'
name|'write'
op|'('
string|"'man1-contents'"
op|','
nl|'\n'
name|'hdrs'
op|'='
op|'{'
string|'"X-Object-Manifest"'
op|':'
string|'"%s/%s/seg_lower"'
op|'%'
nl|'\n'
op|'('
name|'cls'
op|'.'
name|'container'
op|'.'
name|'name'
op|','
name|'prefix'
op|')'
op|'}'
op|')'
newline|'\n'
nl|'\n'
name|'man2'
op|'='
name|'cls'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
string|'"man2"'
op|')'
newline|'\n'
name|'man2'
op|'.'
name|'write'
op|'('
string|"'man2-contents'"
op|','
nl|'\n'
name|'hdrs'
op|'='
op|'{'
string|'"X-Object-Manifest"'
op|':'
string|'"%s/%s/seg_upper"'
op|'%'
nl|'\n'
op|'('
name|'cls'
op|'.'
name|'container'
op|'.'
name|'name'
op|','
name|'prefix'
op|')'
op|'}'
op|')'
newline|'\n'
nl|'\n'
name|'manall'
op|'='
name|'cls'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
string|'"manall"'
op|')'
newline|'\n'
name|'manall'
op|'.'
name|'write'
op|'('
string|"'manall-contents'"
op|','
nl|'\n'
name|'hdrs'
op|'='
op|'{'
string|'"X-Object-Manifest"'
op|':'
string|'"%s/%s/seg"'
op|'%'
nl|'\n'
op|'('
name|'cls'
op|'.'
name|'container'
op|'.'
name|'name'
op|','
name|'prefix'
op|')'
op|'}'
op|')'
newline|'\n'
nl|'\n'
name|'mancont2'
op|'='
name|'cls'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
string|'"mancont2"'
op|')'
newline|'\n'
name|'mancont2'
op|'.'
name|'write'
op|'('
nl|'\n'
string|"'mancont2-contents'"
op|','
nl|'\n'
name|'hdrs'
op|'='
op|'{'
string|'"X-Object-Manifest"'
op|':'
string|'"%s/%s/seg_lower"'
op|'%'
nl|'\n'
op|'('
name|'cls'
op|'.'
name|'container2'
op|'.'
name|'name'
op|','
name|'prefix'
op|')'
op|'}'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|TestDlo
dedent|''
dedent|''
name|'class'
name|'TestDlo'
op|'('
name|'Base'
op|')'
op|':'
newline|'\n'
DECL|variable|env
indent|'    '
name|'env'
op|'='
name|'TestDloEnv'
newline|'\n'
DECL|variable|set_up
name|'set_up'
op|'='
name|'False'
newline|'\n'
nl|'\n'
DECL|member|test_get_manifest
name|'def'
name|'test_get_manifest'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'file_item'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
string|"'man1'"
op|')'
newline|'\n'
name|'file_contents'
op|'='
name|'file_item'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
nl|'\n'
name|'file_contents'
op|','
nl|'\n'
string|'"aaaaaaaaaabbbbbbbbbbccccccccccddddddddddeeeeeeeeee"'
op|')'
newline|'\n'
nl|'\n'
name|'file_item'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
string|"'man2'"
op|')'
newline|'\n'
name|'file_contents'
op|'='
name|'file_item'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
nl|'\n'
name|'file_contents'
op|','
nl|'\n'
string|'"AAAAAAAAAABBBBBBBBBBCCCCCCCCCCDDDDDDDDDDEEEEEEEEEE"'
op|')'
newline|'\n'
nl|'\n'
name|'file_item'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
string|"'manall'"
op|')'
newline|'\n'
name|'file_contents'
op|'='
name|'file_item'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
nl|'\n'
name|'file_contents'
op|','
nl|'\n'
op|'('
string|'"aaaaaaaaaabbbbbbbbbbccccccccccddddddddddeeeeeeeeee"'
op|'+'
nl|'\n'
string|'"AAAAAAAAAABBBBBBBBBBCCCCCCCCCCDDDDDDDDDDEEEEEEEEEE"'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_manifest_document_itself
dedent|''
name|'def'
name|'test_get_manifest_document_itself'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'file_item'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
string|"'man1'"
op|')'
newline|'\n'
name|'file_contents'
op|'='
name|'file_item'
op|'.'
name|'read'
op|'('
name|'parms'
op|'='
op|'{'
string|"'multipart-manifest'"
op|':'
string|"'get'"
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'file_contents'
op|','
string|'"man1-contents"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'file_item'
op|'.'
name|'info'
op|'('
op|')'
op|'['
string|"'x_object_manifest'"
op|']'
op|','
nl|'\n'
string|'"%s/%s/seg_lower"'
op|'%'
nl|'\n'
op|'('
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'name'
op|','
name|'self'
op|'.'
name|'env'
op|'.'
name|'segment_prefix'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_range
dedent|''
name|'def'
name|'test_get_range'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'file_item'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
string|"'man1'"
op|')'
newline|'\n'
name|'file_contents'
op|'='
name|'file_item'
op|'.'
name|'read'
op|'('
name|'size'
op|'='
number|'25'
op|','
name|'offset'
op|'='
number|'8'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'file_contents'
op|','
string|'"aabbbbbbbbbbccccccccccddd"'
op|')'
newline|'\n'
nl|'\n'
name|'file_contents'
op|'='
name|'file_item'
op|'.'
name|'read'
op|'('
name|'size'
op|'='
number|'1'
op|','
name|'offset'
op|'='
number|'47'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'file_contents'
op|','
string|'"e"'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_range_out_of_range
dedent|''
name|'def'
name|'test_get_range_out_of_range'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'file_item'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
string|"'man1'"
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ResponseError'
op|','
name|'file_item'
op|'.'
name|'read'
op|','
name|'size'
op|'='
number|'7'
op|','
name|'offset'
op|'='
number|'50'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'416'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_copy
dedent|''
name|'def'
name|'test_copy'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# Adding a new segment, copying the manifest, and then deleting the'
nl|'\n'
comment|'# segment proves that the new object is really the concatenated'
nl|'\n'
comment|'# segments and not just a manifest.'
nl|'\n'
indent|'        '
name|'f_segment'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
string|'"%s/seg_lowerf"'
op|'%'
nl|'\n'
op|'('
name|'self'
op|'.'
name|'env'
op|'.'
name|'segment_prefix'
op|')'
op|')'
newline|'\n'
name|'f_segment'
op|'.'
name|'write'
op|'('
string|"'ffffffffff'"
op|')'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'man1_item'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
string|"'man1'"
op|')'
newline|'\n'
name|'man1_item'
op|'.'
name|'copy'
op|'('
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'name'
op|','
string|'"copied-man1"'
op|')'
newline|'\n'
dedent|''
name|'finally'
op|':'
newline|'\n'
comment|'# try not to leave this around for other tests to stumble over'
nl|'\n'
indent|'            '
name|'f_segment'
op|'.'
name|'delete'
op|'('
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'file_item'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
string|"'copied-man1'"
op|')'
newline|'\n'
name|'file_contents'
op|'='
name|'file_item'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
nl|'\n'
name|'file_contents'
op|','
nl|'\n'
string|'"aaaaaaaaaabbbbbbbbbbccccccccccddddddddddeeeeeeeeeeffffffffff"'
op|')'
newline|'\n'
comment|'# The copied object must not have X-Object-Manifest'
nl|'\n'
name|'self'
op|'.'
name|'assertNotIn'
op|'('
string|'"x_object_manifest"'
op|','
name|'file_item'
op|'.'
name|'info'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_copy_account
dedent|''
name|'def'
name|'test_copy_account'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# dlo use same account and same container only'
nl|'\n'
indent|'        '
name|'acct'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'conn'
op|'.'
name|'account_name'
newline|'\n'
comment|'# Adding a new segment, copying the manifest, and then deleting the'
nl|'\n'
comment|'# segment proves that the new object is really the concatenated'
nl|'\n'
comment|'# segments and not just a manifest.'
nl|'\n'
name|'f_segment'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
string|'"%s/seg_lowerf"'
op|'%'
nl|'\n'
op|'('
name|'self'
op|'.'
name|'env'
op|'.'
name|'segment_prefix'
op|')'
op|')'
newline|'\n'
name|'f_segment'
op|'.'
name|'write'
op|'('
string|"'ffffffffff'"
op|')'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'man1_item'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
string|"'man1'"
op|')'
newline|'\n'
name|'man1_item'
op|'.'
name|'copy_account'
op|'('
name|'acct'
op|','
nl|'\n'
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'name'
op|','
nl|'\n'
string|'"copied-man1"'
op|')'
newline|'\n'
dedent|''
name|'finally'
op|':'
newline|'\n'
comment|'# try not to leave this around for other tests to stumble over'
nl|'\n'
indent|'            '
name|'f_segment'
op|'.'
name|'delete'
op|'('
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'file_item'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
string|"'copied-man1'"
op|')'
newline|'\n'
name|'file_contents'
op|'='
name|'file_item'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
nl|'\n'
name|'file_contents'
op|','
nl|'\n'
string|'"aaaaaaaaaabbbbbbbbbbccccccccccddddddddddeeeeeeeeeeffffffffff"'
op|')'
newline|'\n'
comment|'# The copied object must not have X-Object-Manifest'
nl|'\n'
name|'self'
op|'.'
name|'assertNotIn'
op|'('
string|'"x_object_manifest"'
op|','
name|'file_item'
op|'.'
name|'info'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_copy_manifest
dedent|''
name|'def'
name|'test_copy_manifest'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# Copying the manifest with multipart-manifest=get query string'
nl|'\n'
comment|'# should result in another manifest'
nl|'\n'
indent|'        '
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'man1_item'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
string|"'man1'"
op|')'
newline|'\n'
name|'man1_item'
op|'.'
name|'copy'
op|'('
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'name'
op|','
string|'"copied-man1"'
op|','
nl|'\n'
name|'parms'
op|'='
op|'{'
string|"'multipart-manifest'"
op|':'
string|"'get'"
op|'}'
op|')'
newline|'\n'
nl|'\n'
name|'copied'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
string|'"copied-man1"'
op|')'
newline|'\n'
name|'copied_contents'
op|'='
name|'copied'
op|'.'
name|'read'
op|'('
name|'parms'
op|'='
op|'{'
string|"'multipart-manifest'"
op|':'
string|"'get'"
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'copied_contents'
op|','
string|'"man1-contents"'
op|')'
newline|'\n'
nl|'\n'
name|'copied_contents'
op|'='
name|'copied'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
nl|'\n'
name|'copied_contents'
op|','
nl|'\n'
string|'"aaaaaaaaaabbbbbbbbbbccccccccccddddddddddeeeeeeeeee"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'man1_item'
op|'.'
name|'info'
op|'('
op|')'
op|'['
string|"'x_object_manifest'"
op|']'
op|','
nl|'\n'
name|'copied'
op|'.'
name|'info'
op|'('
op|')'
op|'['
string|"'x_object_manifest'"
op|']'
op|')'
newline|'\n'
dedent|''
name|'finally'
op|':'
newline|'\n'
comment|'# try not to leave this around for other tests to stumble over'
nl|'\n'
indent|'            '
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
string|'"copied-man1"'
op|')'
op|'.'
name|'delete'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_dlo_if_match_get
dedent|''
dedent|''
name|'def'
name|'test_dlo_if_match_get'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'manifest'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
string|'"man1"'
op|')'
newline|'\n'
name|'etag'
op|'='
name|'manifest'
op|'.'
name|'info'
op|'('
op|')'
op|'['
string|"'etag'"
op|']'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ResponseError'
op|','
name|'manifest'
op|'.'
name|'read'
op|','
nl|'\n'
name|'hdrs'
op|'='
op|'{'
string|"'If-Match'"
op|':'
string|"'not-%s'"
op|'%'
name|'etag'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'412'
op|')'
newline|'\n'
nl|'\n'
name|'manifest'
op|'.'
name|'read'
op|'('
name|'hdrs'
op|'='
op|'{'
string|"'If-Match'"
op|':'
name|'etag'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'200'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_dlo_if_none_match_get
dedent|''
name|'def'
name|'test_dlo_if_none_match_get'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'manifest'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
string|'"man1"'
op|')'
newline|'\n'
name|'etag'
op|'='
name|'manifest'
op|'.'
name|'info'
op|'('
op|')'
op|'['
string|"'etag'"
op|']'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ResponseError'
op|','
name|'manifest'
op|'.'
name|'read'
op|','
nl|'\n'
name|'hdrs'
op|'='
op|'{'
string|"'If-None-Match'"
op|':'
name|'etag'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'304'
op|')'
newline|'\n'
nl|'\n'
name|'manifest'
op|'.'
name|'read'
op|'('
name|'hdrs'
op|'='
op|'{'
string|"'If-None-Match'"
op|':'
string|'"not-%s"'
op|'%'
name|'etag'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'200'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_dlo_if_match_head
dedent|''
name|'def'
name|'test_dlo_if_match_head'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'manifest'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
string|'"man1"'
op|')'
newline|'\n'
name|'etag'
op|'='
name|'manifest'
op|'.'
name|'info'
op|'('
op|')'
op|'['
string|"'etag'"
op|']'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ResponseError'
op|','
name|'manifest'
op|'.'
name|'info'
op|','
nl|'\n'
name|'hdrs'
op|'='
op|'{'
string|"'If-Match'"
op|':'
string|"'not-%s'"
op|'%'
name|'etag'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'412'
op|')'
newline|'\n'
nl|'\n'
name|'manifest'
op|'.'
name|'info'
op|'('
name|'hdrs'
op|'='
op|'{'
string|"'If-Match'"
op|':'
name|'etag'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'200'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_dlo_if_none_match_head
dedent|''
name|'def'
name|'test_dlo_if_none_match_head'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'manifest'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
string|'"man1"'
op|')'
newline|'\n'
name|'etag'
op|'='
name|'manifest'
op|'.'
name|'info'
op|'('
op|')'
op|'['
string|"'etag'"
op|']'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ResponseError'
op|','
name|'manifest'
op|'.'
name|'info'
op|','
nl|'\n'
name|'hdrs'
op|'='
op|'{'
string|"'If-None-Match'"
op|':'
name|'etag'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'304'
op|')'
newline|'\n'
nl|'\n'
name|'manifest'
op|'.'
name|'info'
op|'('
name|'hdrs'
op|'='
op|'{'
string|"'If-None-Match'"
op|':'
string|'"not-%s"'
op|'%'
name|'etag'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'200'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_dlo_referer_on_segment_container
dedent|''
name|'def'
name|'test_dlo_referer_on_segment_container'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# First the account2 (test3) should fail'
nl|'\n'
indent|'        '
name|'headers'
op|'='
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'self'
op|'.'
name|'env'
op|'.'
name|'conn2'
op|'.'
name|'storage_token'
op|','
nl|'\n'
string|"'Referer'"
op|':'
string|"'http://blah.example.com'"
op|'}'
newline|'\n'
name|'dlo_file'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
string|'"mancont2"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ResponseError'
op|','
name|'dlo_file'
op|'.'
name|'read'
op|','
nl|'\n'
name|'hdrs'
op|'='
name|'headers'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'403'
op|')'
newline|'\n'
nl|'\n'
comment|'# Now set the referer on the dlo container only'
nl|'\n'
name|'referer_metadata'
op|'='
op|'{'
string|"'X-Container-Read'"
op|':'
string|"'.r:*.example.com,.rlistings'"
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'update_metadata'
op|'('
name|'referer_metadata'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ResponseError'
op|','
name|'dlo_file'
op|'.'
name|'read'
op|','
nl|'\n'
name|'hdrs'
op|'='
name|'headers'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'403'
op|')'
newline|'\n'
nl|'\n'
comment|'# Finally set the referer on the segment container'
nl|'\n'
name|'self'
op|'.'
name|'env'
op|'.'
name|'container2'
op|'.'
name|'update_metadata'
op|'('
name|'referer_metadata'
op|')'
newline|'\n'
nl|'\n'
name|'contents'
op|'='
name|'dlo_file'
op|'.'
name|'read'
op|'('
name|'hdrs'
op|'='
name|'headers'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
nl|'\n'
name|'contents'
op|','
nl|'\n'
string|'"ffffffffffgggggggggghhhhhhhhhhiiiiiiiiiijjjjjjjjjj"'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|TestDloUTF8
dedent|''
dedent|''
name|'class'
name|'TestDloUTF8'
op|'('
name|'Base2'
op|','
name|'TestDlo'
op|')'
op|':'
newline|'\n'
DECL|variable|set_up
indent|'    '
name|'set_up'
op|'='
name|'False'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|TestFileComparisonEnv
dedent|''
name|'class'
name|'TestFileComparisonEnv'
op|'('
name|'object'
op|')'
op|':'
newline|'\n'
indent|'    '
op|'@'
name|'classmethod'
newline|'\n'
DECL|member|setUp
name|'def'
name|'setUp'
op|'('
name|'cls'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'cls'
op|'.'
name|'conn'
op|'='
name|'Connection'
op|'('
name|'tf'
op|'.'
name|'config'
op|')'
newline|'\n'
name|'cls'
op|'.'
name|'conn'
op|'.'
name|'authenticate'
op|'('
op|')'
newline|'\n'
name|'cls'
op|'.'
name|'account'
op|'='
name|'Account'
op|'('
name|'cls'
op|'.'
name|'conn'
op|','
name|'tf'
op|'.'
name|'config'
op|'.'
name|'get'
op|'('
string|"'account'"
op|','
nl|'\n'
name|'tf'
op|'.'
name|'config'
op|'['
string|"'username'"
op|']'
op|')'
op|')'
newline|'\n'
name|'cls'
op|'.'
name|'account'
op|'.'
name|'delete_containers'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'cls'
op|'.'
name|'container'
op|'='
name|'cls'
op|'.'
name|'account'
op|'.'
name|'container'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'if'
name|'not'
name|'cls'
op|'.'
name|'container'
op|'.'
name|'create'
op|'('
op|')'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'ResponseError'
op|'('
name|'cls'
op|'.'
name|'conn'
op|'.'
name|'response'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'cls'
op|'.'
name|'file_count'
op|'='
number|'20'
newline|'\n'
name|'cls'
op|'.'
name|'file_size'
op|'='
number|'128'
newline|'\n'
name|'cls'
op|'.'
name|'files'
op|'='
name|'list'
op|'('
op|')'
newline|'\n'
name|'for'
name|'x'
name|'in'
name|'range'
op|'('
name|'cls'
op|'.'
name|'file_count'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'file_item'
op|'='
name|'cls'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
name|'file_item'
op|'.'
name|'write_random'
op|'('
name|'cls'
op|'.'
name|'file_size'
op|')'
newline|'\n'
name|'cls'
op|'.'
name|'files'
op|'.'
name|'append'
op|'('
name|'file_item'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'cls'
op|'.'
name|'time_old_f1'
op|'='
name|'time'
op|'.'
name|'strftime'
op|'('
string|'"%a, %d %b %Y %H:%M:%S GMT"'
op|','
nl|'\n'
name|'time'
op|'.'
name|'gmtime'
op|'('
name|'time'
op|'.'
name|'time'
op|'('
op|')'
op|'-'
number|'86400'
op|')'
op|')'
newline|'\n'
name|'cls'
op|'.'
name|'time_old_f2'
op|'='
name|'time'
op|'.'
name|'strftime'
op|'('
string|'"%A, %d-%b-%y %H:%M:%S GMT"'
op|','
nl|'\n'
name|'time'
op|'.'
name|'gmtime'
op|'('
name|'time'
op|'.'
name|'time'
op|'('
op|')'
op|'-'
number|'86400'
op|')'
op|')'
newline|'\n'
name|'cls'
op|'.'
name|'time_old_f3'
op|'='
name|'time'
op|'.'
name|'strftime'
op|'('
string|'"%a %b %d %H:%M:%S %Y"'
op|','
nl|'\n'
name|'time'
op|'.'
name|'gmtime'
op|'('
name|'time'
op|'.'
name|'time'
op|'('
op|')'
op|'-'
number|'86400'
op|')'
op|')'
newline|'\n'
name|'cls'
op|'.'
name|'time_new'
op|'='
name|'time'
op|'.'
name|'strftime'
op|'('
string|'"%a, %d %b %Y %H:%M:%S GMT"'
op|','
nl|'\n'
name|'time'
op|'.'
name|'gmtime'
op|'('
name|'time'
op|'.'
name|'time'
op|'('
op|')'
op|'+'
number|'86400'
op|')'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|TestFileComparison
dedent|''
dedent|''
name|'class'
name|'TestFileComparison'
op|'('
name|'Base'
op|')'
op|':'
newline|'\n'
DECL|variable|env
indent|'    '
name|'env'
op|'='
name|'TestFileComparisonEnv'
newline|'\n'
DECL|variable|set_up
name|'set_up'
op|'='
name|'False'
newline|'\n'
nl|'\n'
DECL|member|testIfMatch
name|'def'
name|'testIfMatch'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'for'
name|'file_item'
name|'in'
name|'self'
op|'.'
name|'env'
op|'.'
name|'files'
op|':'
newline|'\n'
indent|'            '
name|'hdrs'
op|'='
op|'{'
string|"'If-Match'"
op|':'
name|'file_item'
op|'.'
name|'md5'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'file_item'
op|'.'
name|'read'
op|'('
name|'hdrs'
op|'='
name|'hdrs'
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'hdrs'
op|'='
op|'{'
string|"'If-Match'"
op|':'
string|"'bogus'"
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ResponseError'
op|','
name|'file_item'
op|'.'
name|'read'
op|','
name|'hdrs'
op|'='
name|'hdrs'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'412'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_header'
op|'('
string|"'etag'"
op|','
name|'file_item'
op|'.'
name|'md5'
op|')'
newline|'\n'
nl|'\n'
DECL|member|testIfMatchMultipleEtags
dedent|''
dedent|''
name|'def'
name|'testIfMatchMultipleEtags'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'for'
name|'file_item'
name|'in'
name|'self'
op|'.'
name|'env'
op|'.'
name|'files'
op|':'
newline|'\n'
indent|'            '
name|'hdrs'
op|'='
op|'{'
string|"'If-Match'"
op|':'
string|'\'"bogus1", "%s", "bogus2"\''
op|'%'
name|'file_item'
op|'.'
name|'md5'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'file_item'
op|'.'
name|'read'
op|'('
name|'hdrs'
op|'='
name|'hdrs'
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'hdrs'
op|'='
op|'{'
string|"'If-Match'"
op|':'
string|'\'"bogus1", "bogus2", "bogus3"\''
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ResponseError'
op|','
name|'file_item'
op|'.'
name|'read'
op|','
name|'hdrs'
op|'='
name|'hdrs'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'412'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_header'
op|'('
string|"'etag'"
op|','
name|'file_item'
op|'.'
name|'md5'
op|')'
newline|'\n'
nl|'\n'
DECL|member|testIfNoneMatch
dedent|''
dedent|''
name|'def'
name|'testIfNoneMatch'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'for'
name|'file_item'
name|'in'
name|'self'
op|'.'
name|'env'
op|'.'
name|'files'
op|':'
newline|'\n'
indent|'            '
name|'hdrs'
op|'='
op|'{'
string|"'If-None-Match'"
op|':'
string|"'bogus'"
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'file_item'
op|'.'
name|'read'
op|'('
name|'hdrs'
op|'='
name|'hdrs'
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'hdrs'
op|'='
op|'{'
string|"'If-None-Match'"
op|':'
name|'file_item'
op|'.'
name|'md5'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ResponseError'
op|','
name|'file_item'
op|'.'
name|'read'
op|','
name|'hdrs'
op|'='
name|'hdrs'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'304'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_header'
op|'('
string|"'etag'"
op|','
name|'file_item'
op|'.'
name|'md5'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_header'
op|'('
string|"'accept-ranges'"
op|','
string|"'bytes'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|testIfNoneMatchMultipleEtags
dedent|''
dedent|''
name|'def'
name|'testIfNoneMatchMultipleEtags'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'for'
name|'file_item'
name|'in'
name|'self'
op|'.'
name|'env'
op|'.'
name|'files'
op|':'
newline|'\n'
indent|'            '
name|'hdrs'
op|'='
op|'{'
string|"'If-None-Match'"
op|':'
string|'\'"bogus1", "bogus2", "bogus3"\''
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'file_item'
op|'.'
name|'read'
op|'('
name|'hdrs'
op|'='
name|'hdrs'
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'hdrs'
op|'='
op|'{'
string|"'If-None-Match'"
op|':'
nl|'\n'
string|'\'"bogus1", "bogus2", "%s"\''
op|'%'
name|'file_item'
op|'.'
name|'md5'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ResponseError'
op|','
name|'file_item'
op|'.'
name|'read'
op|','
name|'hdrs'
op|'='
name|'hdrs'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'304'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_header'
op|'('
string|"'etag'"
op|','
name|'file_item'
op|'.'
name|'md5'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_header'
op|'('
string|"'accept-ranges'"
op|','
string|"'bytes'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|testIfModifiedSince
dedent|''
dedent|''
name|'def'
name|'testIfModifiedSince'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'for'
name|'file_item'
name|'in'
name|'self'
op|'.'
name|'env'
op|'.'
name|'files'
op|':'
newline|'\n'
indent|'            '
name|'hdrs'
op|'='
op|'{'
string|"'If-Modified-Since'"
op|':'
name|'self'
op|'.'
name|'env'
op|'.'
name|'time_old_f1'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'file_item'
op|'.'
name|'read'
op|'('
name|'hdrs'
op|'='
name|'hdrs'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'file_item'
op|'.'
name|'info'
op|'('
name|'hdrs'
op|'='
name|'hdrs'
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'hdrs'
op|'='
op|'{'
string|"'If-Modified-Since'"
op|':'
name|'self'
op|'.'
name|'env'
op|'.'
name|'time_new'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ResponseError'
op|','
name|'file_item'
op|'.'
name|'read'
op|','
name|'hdrs'
op|'='
name|'hdrs'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'304'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_header'
op|'('
string|"'etag'"
op|','
name|'file_item'
op|'.'
name|'md5'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_header'
op|'('
string|"'accept-ranges'"
op|','
string|"'bytes'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ResponseError'
op|','
name|'file_item'
op|'.'
name|'info'
op|','
name|'hdrs'
op|'='
name|'hdrs'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'304'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_header'
op|'('
string|"'etag'"
op|','
name|'file_item'
op|'.'
name|'md5'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_header'
op|'('
string|"'accept-ranges'"
op|','
string|"'bytes'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|testIfUnmodifiedSince
dedent|''
dedent|''
name|'def'
name|'testIfUnmodifiedSince'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'for'
name|'file_item'
name|'in'
name|'self'
op|'.'
name|'env'
op|'.'
name|'files'
op|':'
newline|'\n'
indent|'            '
name|'hdrs'
op|'='
op|'{'
string|"'If-Unmodified-Since'"
op|':'
name|'self'
op|'.'
name|'env'
op|'.'
name|'time_new'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'file_item'
op|'.'
name|'read'
op|'('
name|'hdrs'
op|'='
name|'hdrs'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'file_item'
op|'.'
name|'info'
op|'('
name|'hdrs'
op|'='
name|'hdrs'
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'hdrs'
op|'='
op|'{'
string|"'If-Unmodified-Since'"
op|':'
name|'self'
op|'.'
name|'env'
op|'.'
name|'time_old_f2'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ResponseError'
op|','
name|'file_item'
op|'.'
name|'read'
op|','
name|'hdrs'
op|'='
name|'hdrs'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'412'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_header'
op|'('
string|"'etag'"
op|','
name|'file_item'
op|'.'
name|'md5'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ResponseError'
op|','
name|'file_item'
op|'.'
name|'info'
op|','
name|'hdrs'
op|'='
name|'hdrs'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'412'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_header'
op|'('
string|"'etag'"
op|','
name|'file_item'
op|'.'
name|'md5'
op|')'
newline|'\n'
nl|'\n'
DECL|member|testIfMatchAndUnmodified
dedent|''
dedent|''
name|'def'
name|'testIfMatchAndUnmodified'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'for'
name|'file_item'
name|'in'
name|'self'
op|'.'
name|'env'
op|'.'
name|'files'
op|':'
newline|'\n'
indent|'            '
name|'hdrs'
op|'='
op|'{'
string|"'If-Match'"
op|':'
name|'file_item'
op|'.'
name|'md5'
op|','
nl|'\n'
string|"'If-Unmodified-Since'"
op|':'
name|'self'
op|'.'
name|'env'
op|'.'
name|'time_new'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'file_item'
op|'.'
name|'read'
op|'('
name|'hdrs'
op|'='
name|'hdrs'
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'hdrs'
op|'='
op|'{'
string|"'If-Match'"
op|':'
string|"'bogus'"
op|','
nl|'\n'
string|"'If-Unmodified-Since'"
op|':'
name|'self'
op|'.'
name|'env'
op|'.'
name|'time_new'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ResponseError'
op|','
name|'file_item'
op|'.'
name|'read'
op|','
name|'hdrs'
op|'='
name|'hdrs'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'412'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_header'
op|'('
string|"'etag'"
op|','
name|'file_item'
op|'.'
name|'md5'
op|')'
newline|'\n'
nl|'\n'
name|'hdrs'
op|'='
op|'{'
string|"'If-Match'"
op|':'
name|'file_item'
op|'.'
name|'md5'
op|','
nl|'\n'
string|"'If-Unmodified-Since'"
op|':'
name|'self'
op|'.'
name|'env'
op|'.'
name|'time_old_f3'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ResponseError'
op|','
name|'file_item'
op|'.'
name|'read'
op|','
name|'hdrs'
op|'='
name|'hdrs'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'412'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_header'
op|'('
string|"'etag'"
op|','
name|'file_item'
op|'.'
name|'md5'
op|')'
newline|'\n'
nl|'\n'
DECL|member|testLastModified
dedent|''
dedent|''
name|'def'
name|'testLastModified'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'file_name'
op|'='
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
newline|'\n'
name|'content_type'
op|'='
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'file_item'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
name|'file_name'
op|')'
newline|'\n'
name|'file_item'
op|'.'
name|'content_type'
op|'='
name|'content_type'
newline|'\n'
name|'resp'
op|'='
name|'file_item'
op|'.'
name|'write_random_return_resp'
op|'('
name|'self'
op|'.'
name|'env'
op|'.'
name|'file_size'
op|')'
newline|'\n'
name|'put_last_modified'
op|'='
name|'resp'
op|'.'
name|'getheader'
op|'('
string|"'last-modified'"
op|')'
newline|'\n'
name|'etag'
op|'='
name|'file_item'
op|'.'
name|'md5'
newline|'\n'
nl|'\n'
name|'file_item'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
name|'file_name'
op|')'
newline|'\n'
name|'info'
op|'='
name|'file_item'
op|'.'
name|'info'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertIn'
op|'('
string|"'last_modified'"
op|','
name|'info'
op|')'
newline|'\n'
name|'last_modified'
op|'='
name|'info'
op|'['
string|"'last_modified'"
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'put_last_modified'
op|','
name|'info'
op|'['
string|"'last_modified'"
op|']'
op|')'
newline|'\n'
nl|'\n'
name|'hdrs'
op|'='
op|'{'
string|"'If-Modified-Since'"
op|':'
name|'last_modified'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ResponseError'
op|','
name|'file_item'
op|'.'
name|'read'
op|','
name|'hdrs'
op|'='
name|'hdrs'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'304'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_header'
op|'('
string|"'etag'"
op|','
name|'etag'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_header'
op|'('
string|"'accept-ranges'"
op|','
string|"'bytes'"
op|')'
newline|'\n'
nl|'\n'
name|'hdrs'
op|'='
op|'{'
string|"'If-Unmodified-Since'"
op|':'
name|'last_modified'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'file_item'
op|'.'
name|'read'
op|'('
name|'hdrs'
op|'='
name|'hdrs'
op|')'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|TestFileComparisonUTF8
dedent|''
dedent|''
name|'class'
name|'TestFileComparisonUTF8'
op|'('
name|'Base2'
op|','
name|'TestFileComparison'
op|')'
op|':'
newline|'\n'
DECL|variable|set_up
indent|'    '
name|'set_up'
op|'='
name|'False'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|TestSloEnv
dedent|''
name|'class'
name|'TestSloEnv'
op|'('
name|'object'
op|')'
op|':'
newline|'\n'
DECL|variable|slo_enabled
indent|'    '
name|'slo_enabled'
op|'='
name|'None'
comment|'# tri-state: None initially, then True/False'
newline|'\n'
nl|'\n'
op|'@'
name|'classmethod'
newline|'\n'
DECL|member|create_segments
name|'def'
name|'create_segments'
op|'('
name|'cls'
op|','
name|'container'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'seg_info'
op|'='
op|'{'
op|'}'
newline|'\n'
name|'for'
name|'letter'
op|','
name|'size'
name|'in'
op|'('
op|'('
string|"'a'"
op|','
number|'1024'
op|'*'
number|'1024'
op|')'
op|','
nl|'\n'
op|'('
string|"'b'"
op|','
number|'1024'
op|'*'
number|'1024'
op|')'
op|','
nl|'\n'
op|'('
string|"'c'"
op|','
number|'1024'
op|'*'
number|'1024'
op|')'
op|','
nl|'\n'
op|'('
string|"'d'"
op|','
number|'1024'
op|'*'
number|'1024'
op|')'
op|','
nl|'\n'
op|'('
string|"'e'"
op|','
number|'1'
op|')'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'seg_name'
op|'='
string|'"seg_%s"'
op|'%'
name|'letter'
newline|'\n'
name|'file_item'
op|'='
name|'container'
op|'.'
name|'file'
op|'('
name|'seg_name'
op|')'
newline|'\n'
name|'file_item'
op|'.'
name|'write'
op|'('
name|'letter'
op|'*'
name|'size'
op|')'
newline|'\n'
name|'seg_info'
op|'['
name|'seg_name'
op|']'
op|'='
op|'{'
nl|'\n'
string|"'size_bytes'"
op|':'
name|'size'
op|','
nl|'\n'
string|"'etag'"
op|':'
name|'file_item'
op|'.'
name|'md5'
op|','
nl|'\n'
string|"'path'"
op|':'
string|"'/%s/%s'"
op|'%'
op|'('
name|'container'
op|'.'
name|'name'
op|','
name|'seg_name'
op|')'
op|'}'
newline|'\n'
dedent|''
name|'return'
name|'seg_info'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'classmethod'
newline|'\n'
DECL|member|setUp
name|'def'
name|'setUp'
op|'('
name|'cls'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'cls'
op|'.'
name|'conn'
op|'='
name|'Connection'
op|'('
name|'tf'
op|'.'
name|'config'
op|')'
newline|'\n'
name|'cls'
op|'.'
name|'conn'
op|'.'
name|'authenticate'
op|'('
op|')'
newline|'\n'
name|'config2'
op|'='
name|'deepcopy'
op|'('
name|'tf'
op|'.'
name|'config'
op|')'
newline|'\n'
name|'config2'
op|'['
string|"'account'"
op|']'
op|'='
name|'tf'
op|'.'
name|'config'
op|'['
string|"'account2'"
op|']'
newline|'\n'
name|'config2'
op|'['
string|"'username'"
op|']'
op|'='
name|'tf'
op|'.'
name|'config'
op|'['
string|"'username2'"
op|']'
newline|'\n'
name|'config2'
op|'['
string|"'password'"
op|']'
op|'='
name|'tf'
op|'.'
name|'config'
op|'['
string|"'password2'"
op|']'
newline|'\n'
name|'cls'
op|'.'
name|'conn2'
op|'='
name|'Connection'
op|'('
name|'config2'
op|')'
newline|'\n'
name|'cls'
op|'.'
name|'conn2'
op|'.'
name|'authenticate'
op|'('
op|')'
newline|'\n'
name|'cls'
op|'.'
name|'account2'
op|'='
name|'cls'
op|'.'
name|'conn2'
op|'.'
name|'get_account'
op|'('
op|')'
newline|'\n'
name|'cls'
op|'.'
name|'account2'
op|'.'
name|'delete_containers'
op|'('
op|')'
newline|'\n'
name|'config3'
op|'='
name|'tf'
op|'.'
name|'config'
op|'.'
name|'copy'
op|'('
op|')'
newline|'\n'
name|'config3'
op|'['
string|"'username'"
op|']'
op|'='
name|'tf'
op|'.'
name|'config'
op|'['
string|"'username3'"
op|']'
newline|'\n'
name|'config3'
op|'['
string|"'password'"
op|']'
op|'='
name|'tf'
op|'.'
name|'config'
op|'['
string|"'password3'"
op|']'
newline|'\n'
name|'cls'
op|'.'
name|'conn3'
op|'='
name|'Connection'
op|'('
name|'config3'
op|')'
newline|'\n'
name|'cls'
op|'.'
name|'conn3'
op|'.'
name|'authenticate'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'if'
name|'cls'
op|'.'
name|'slo_enabled'
name|'is'
name|'None'
op|':'
newline|'\n'
indent|'            '
name|'cls'
op|'.'
name|'slo_enabled'
op|'='
string|"'slo'"
name|'in'
name|'cluster_info'
newline|'\n'
name|'if'
name|'not'
name|'cls'
op|'.'
name|'slo_enabled'
op|':'
newline|'\n'
indent|'                '
name|'return'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'cls'
op|'.'
name|'account'
op|'='
name|'Account'
op|'('
name|'cls'
op|'.'
name|'conn'
op|','
name|'tf'
op|'.'
name|'config'
op|'.'
name|'get'
op|'('
string|"'account'"
op|','
nl|'\n'
name|'tf'
op|'.'
name|'config'
op|'['
string|"'username'"
op|']'
op|')'
op|')'
newline|'\n'
name|'cls'
op|'.'
name|'account'
op|'.'
name|'delete_containers'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'cls'
op|'.'
name|'container'
op|'='
name|'cls'
op|'.'
name|'account'
op|'.'
name|'container'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
name|'cls'
op|'.'
name|'container2'
op|'='
name|'cls'
op|'.'
name|'account'
op|'.'
name|'container'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'for'
name|'cont'
name|'in'
op|'('
name|'cls'
op|'.'
name|'container'
op|','
name|'cls'
op|'.'
name|'container2'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'not'
name|'cont'
op|'.'
name|'create'
op|'('
op|')'
op|':'
newline|'\n'
indent|'                '
name|'raise'
name|'ResponseError'
op|'('
name|'cls'
op|'.'
name|'conn'
op|'.'
name|'response'
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'cls'
op|'.'
name|'seg_info'
op|'='
name|'seg_info'
op|'='
name|'cls'
op|'.'
name|'create_segments'
op|'('
name|'cls'
op|'.'
name|'container'
op|')'
newline|'\n'
nl|'\n'
name|'file_item'
op|'='
name|'cls'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
string|'"manifest-abcde"'
op|')'
newline|'\n'
name|'file_item'
op|'.'
name|'write'
op|'('
nl|'\n'
name|'json'
op|'.'
name|'dumps'
op|'('
op|'['
name|'seg_info'
op|'['
string|"'seg_a'"
op|']'
op|','
name|'seg_info'
op|'['
string|"'seg_b'"
op|']'
op|','
nl|'\n'
name|'seg_info'
op|'['
string|"'seg_c'"
op|']'
op|','
name|'seg_info'
op|'['
string|"'seg_d'"
op|']'
op|','
nl|'\n'
name|'seg_info'
op|'['
string|"'seg_e'"
op|']'
op|']'
op|')'
op|','
nl|'\n'
name|'parms'
op|'='
op|'{'
string|"'multipart-manifest'"
op|':'
string|"'put'"
op|'}'
op|')'
newline|'\n'
nl|'\n'
comment|'# Put the same manifest in the container2'
nl|'\n'
name|'file_item'
op|'='
name|'cls'
op|'.'
name|'container2'
op|'.'
name|'file'
op|'('
string|'"manifest-abcde"'
op|')'
newline|'\n'
name|'file_item'
op|'.'
name|'write'
op|'('
nl|'\n'
name|'json'
op|'.'
name|'dumps'
op|'('
op|'['
name|'seg_info'
op|'['
string|"'seg_a'"
op|']'
op|','
name|'seg_info'
op|'['
string|"'seg_b'"
op|']'
op|','
nl|'\n'
name|'seg_info'
op|'['
string|"'seg_c'"
op|']'
op|','
name|'seg_info'
op|'['
string|"'seg_d'"
op|']'
op|','
nl|'\n'
name|'seg_info'
op|'['
string|"'seg_e'"
op|']'
op|']'
op|')'
op|','
nl|'\n'
name|'parms'
op|'='
op|'{'
string|"'multipart-manifest'"
op|':'
string|"'put'"
op|'}'
op|')'
newline|'\n'
nl|'\n'
name|'file_item'
op|'='
name|'cls'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
string|"'manifest-cd'"
op|')'
newline|'\n'
name|'cd_json'
op|'='
name|'json'
op|'.'
name|'dumps'
op|'('
op|'['
name|'seg_info'
op|'['
string|"'seg_c'"
op|']'
op|','
name|'seg_info'
op|'['
string|"'seg_d'"
op|']'
op|']'
op|')'
newline|'\n'
name|'file_item'
op|'.'
name|'write'
op|'('
name|'cd_json'
op|','
name|'parms'
op|'='
op|'{'
string|"'multipart-manifest'"
op|':'
string|"'put'"
op|'}'
op|')'
newline|'\n'
name|'cd_etag'
op|'='
name|'hashlib'
op|'.'
name|'md5'
op|'('
name|'seg_info'
op|'['
string|"'seg_c'"
op|']'
op|'['
string|"'etag'"
op|']'
op|'+'
nl|'\n'
name|'seg_info'
op|'['
string|"'seg_d'"
op|']'
op|'['
string|"'etag'"
op|']'
op|')'
op|'.'
name|'hexdigest'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'file_item'
op|'='
name|'cls'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
string|'"manifest-bcd-submanifest"'
op|')'
newline|'\n'
name|'file_item'
op|'.'
name|'write'
op|'('
nl|'\n'
name|'json'
op|'.'
name|'dumps'
op|'('
op|'['
name|'seg_info'
op|'['
string|"'seg_b'"
op|']'
op|','
nl|'\n'
op|'{'
string|"'etag'"
op|':'
name|'cd_etag'
op|','
nl|'\n'
string|"'size_bytes'"
op|':'
op|'('
name|'seg_info'
op|'['
string|"'seg_c'"
op|']'
op|'['
string|"'size_bytes'"
op|']'
op|'+'
nl|'\n'
name|'seg_info'
op|'['
string|"'seg_d'"
op|']'
op|'['
string|"'size_bytes'"
op|']'
op|')'
op|','
nl|'\n'
string|"'path'"
op|':'
string|"'/%s/%s'"
op|'%'
op|'('
name|'cls'
op|'.'
name|'container'
op|'.'
name|'name'
op|','
nl|'\n'
string|"'manifest-cd'"
op|')'
op|'}'
op|']'
op|')'
op|','
nl|'\n'
name|'parms'
op|'='
op|'{'
string|"'multipart-manifest'"
op|':'
string|"'put'"
op|'}'
op|')'
newline|'\n'
name|'bcd_submanifest_etag'
op|'='
name|'hashlib'
op|'.'
name|'md5'
op|'('
nl|'\n'
name|'seg_info'
op|'['
string|"'seg_b'"
op|']'
op|'['
string|"'etag'"
op|']'
op|'+'
name|'cd_etag'
op|')'
op|'.'
name|'hexdigest'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'file_item'
op|'='
name|'cls'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
string|'"manifest-abcde-submanifest"'
op|')'
newline|'\n'
name|'file_item'
op|'.'
name|'write'
op|'('
nl|'\n'
name|'json'
op|'.'
name|'dumps'
op|'('
op|'['
nl|'\n'
name|'seg_info'
op|'['
string|"'seg_a'"
op|']'
op|','
nl|'\n'
op|'{'
string|"'etag'"
op|':'
name|'bcd_submanifest_etag'
op|','
nl|'\n'
string|"'size_bytes'"
op|':'
op|'('
name|'seg_info'
op|'['
string|"'seg_b'"
op|']'
op|'['
string|"'size_bytes'"
op|']'
op|'+'
nl|'\n'
name|'seg_info'
op|'['
string|"'seg_c'"
op|']'
op|'['
string|"'size_bytes'"
op|']'
op|'+'
nl|'\n'
name|'seg_info'
op|'['
string|"'seg_d'"
op|']'
op|'['
string|"'size_bytes'"
op|']'
op|')'
op|','
nl|'\n'
string|"'path'"
op|':'
string|"'/%s/%s'"
op|'%'
op|'('
name|'cls'
op|'.'
name|'container'
op|'.'
name|'name'
op|','
nl|'\n'
string|"'manifest-bcd-submanifest'"
op|')'
op|'}'
op|','
nl|'\n'
name|'seg_info'
op|'['
string|"'seg_e'"
op|']'
op|']'
op|')'
op|','
nl|'\n'
name|'parms'
op|'='
op|'{'
string|"'multipart-manifest'"
op|':'
string|"'put'"
op|'}'
op|')'
newline|'\n'
name|'abcde_submanifest_etag'
op|'='
name|'hashlib'
op|'.'
name|'md5'
op|'('
nl|'\n'
name|'seg_info'
op|'['
string|"'seg_a'"
op|']'
op|'['
string|"'etag'"
op|']'
op|'+'
name|'bcd_submanifest_etag'
op|'+'
nl|'\n'
name|'seg_info'
op|'['
string|"'seg_e'"
op|']'
op|'['
string|"'etag'"
op|']'
op|')'
op|'.'
name|'hexdigest'
op|'('
op|')'
newline|'\n'
name|'abcde_submanifest_size'
op|'='
op|'('
name|'seg_info'
op|'['
string|"'seg_a'"
op|']'
op|'['
string|"'size_bytes'"
op|']'
op|'+'
nl|'\n'
name|'seg_info'
op|'['
string|"'seg_b'"
op|']'
op|'['
string|"'size_bytes'"
op|']'
op|'+'
nl|'\n'
name|'seg_info'
op|'['
string|"'seg_c'"
op|']'
op|'['
string|"'size_bytes'"
op|']'
op|'+'
nl|'\n'
name|'seg_info'
op|'['
string|"'seg_d'"
op|']'
op|'['
string|"'size_bytes'"
op|']'
op|'+'
nl|'\n'
name|'seg_info'
op|'['
string|"'seg_e'"
op|']'
op|'['
string|"'size_bytes'"
op|']'
op|')'
newline|'\n'
nl|'\n'
name|'file_item'
op|'='
name|'cls'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
string|'"ranged-manifest"'
op|')'
newline|'\n'
name|'file_item'
op|'.'
name|'write'
op|'('
nl|'\n'
name|'json'
op|'.'
name|'dumps'
op|'('
op|'['
nl|'\n'
op|'{'
string|"'etag'"
op|':'
name|'abcde_submanifest_etag'
op|','
nl|'\n'
string|"'size_bytes'"
op|':'
name|'abcde_submanifest_size'
op|','
nl|'\n'
string|"'path'"
op|':'
string|"'/%s/%s'"
op|'%'
op|'('
name|'cls'
op|'.'
name|'container'
op|'.'
name|'name'
op|','
nl|'\n'
string|"'manifest-abcde-submanifest'"
op|')'
op|','
nl|'\n'
string|"'range'"
op|':'
string|"'-1048578'"
op|'}'
op|','
comment|"# 'c' + ('d' * 2**20) + 'e'"
nl|'\n'
op|'{'
string|"'etag'"
op|':'
name|'abcde_submanifest_etag'
op|','
nl|'\n'
string|"'size_bytes'"
op|':'
name|'abcde_submanifest_size'
op|','
nl|'\n'
string|"'path'"
op|':'
string|"'/%s/%s'"
op|'%'
op|'('
name|'cls'
op|'.'
name|'container'
op|'.'
name|'name'
op|','
nl|'\n'
string|"'manifest-abcde-submanifest'"
op|')'
op|','
nl|'\n'
string|"'range'"
op|':'
string|"'524288-1572863'"
op|'}'
op|','
comment|"# 'a' * 2**19 + 'b' * 2**19"
nl|'\n'
op|'{'
string|"'etag'"
op|':'
name|'abcde_submanifest_etag'
op|','
nl|'\n'
string|"'size_bytes'"
op|':'
name|'abcde_submanifest_size'
op|','
nl|'\n'
string|"'path'"
op|':'
string|"'/%s/%s'"
op|'%'
op|'('
name|'cls'
op|'.'
name|'container'
op|'.'
name|'name'
op|','
nl|'\n'
string|"'manifest-abcde-submanifest'"
op|')'
op|','
nl|'\n'
string|"'range'"
op|':'
string|"'3145727-3145728'"
op|'}'
op|']'
op|')'
op|','
comment|"# 'cd'"
nl|'\n'
name|'parms'
op|'='
op|'{'
string|"'multipart-manifest'"
op|':'
string|"'put'"
op|'}'
op|')'
newline|'\n'
name|'ranged_manifest_etag'
op|'='
name|'hashlib'
op|'.'
name|'md5'
op|'('
nl|'\n'
name|'abcde_submanifest_etag'
op|'+'
string|"':3145727-4194304;'"
op|'+'
nl|'\n'
name|'abcde_submanifest_etag'
op|'+'
string|"':524288-1572863;'"
op|'+'
nl|'\n'
name|'abcde_submanifest_etag'
op|'+'
string|"':3145727-3145728;'"
op|')'
op|'.'
name|'hexdigest'
op|'('
op|')'
newline|'\n'
name|'ranged_manifest_size'
op|'='
number|'2'
op|'*'
number|'1024'
op|'*'
number|'1024'
op|'+'
number|'4'
newline|'\n'
nl|'\n'
name|'file_item'
op|'='
name|'cls'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
string|'"ranged-submanifest"'
op|')'
newline|'\n'
name|'file_item'
op|'.'
name|'write'
op|'('
nl|'\n'
name|'json'
op|'.'
name|'dumps'
op|'('
op|'['
nl|'\n'
name|'seg_info'
op|'['
string|"'seg_c'"
op|']'
op|','
nl|'\n'
op|'{'
string|"'etag'"
op|':'
name|'ranged_manifest_etag'
op|','
nl|'\n'
string|"'size_bytes'"
op|':'
name|'ranged_manifest_size'
op|','
nl|'\n'
string|"'path'"
op|':'
string|"'/%s/%s'"
op|'%'
op|'('
name|'cls'
op|'.'
name|'container'
op|'.'
name|'name'
op|','
nl|'\n'
string|"'ranged-manifest'"
op|')'
op|'}'
op|','
nl|'\n'
op|'{'
string|"'etag'"
op|':'
name|'ranged_manifest_etag'
op|','
nl|'\n'
string|"'size_bytes'"
op|':'
name|'ranged_manifest_size'
op|','
nl|'\n'
string|"'path'"
op|':'
string|"'/%s/%s'"
op|'%'
op|'('
name|'cls'
op|'.'
name|'container'
op|'.'
name|'name'
op|','
nl|'\n'
string|"'ranged-manifest'"
op|')'
op|','
nl|'\n'
string|"'range'"
op|':'
string|"'524289-1572865'"
op|'}'
op|','
nl|'\n'
op|'{'
string|"'etag'"
op|':'
name|'ranged_manifest_etag'
op|','
nl|'\n'
string|"'size_bytes'"
op|':'
name|'ranged_manifest_size'
op|','
nl|'\n'
string|"'path'"
op|':'
string|"'/%s/%s'"
op|'%'
op|'('
name|'cls'
op|'.'
name|'container'
op|'.'
name|'name'
op|','
nl|'\n'
string|"'ranged-manifest'"
op|')'
op|','
nl|'\n'
string|"'range'"
op|':'
string|"'-3'"
op|'}'
op|']'
op|')'
op|','
nl|'\n'
name|'parms'
op|'='
op|'{'
string|"'multipart-manifest'"
op|':'
string|"'put'"
op|'}'
op|')'
newline|'\n'
nl|'\n'
name|'file_item'
op|'='
name|'cls'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
string|'"manifest-db"'
op|')'
newline|'\n'
name|'file_item'
op|'.'
name|'write'
op|'('
nl|'\n'
name|'json'
op|'.'
name|'dumps'
op|'('
op|'['
nl|'\n'
op|'{'
string|"'path'"
op|':'
name|'seg_info'
op|'['
string|"'seg_d'"
op|']'
op|'['
string|"'path'"
op|']'
op|','
string|"'etag'"
op|':'
name|'None'
op|','
nl|'\n'
string|"'size_bytes'"
op|':'
name|'None'
op|'}'
op|','
nl|'\n'
op|'{'
string|"'path'"
op|':'
name|'seg_info'
op|'['
string|"'seg_b'"
op|']'
op|'['
string|"'path'"
op|']'
op|','
string|"'etag'"
op|':'
name|'None'
op|','
nl|'\n'
string|"'size_bytes'"
op|':'
name|'None'
op|'}'
op|','
nl|'\n'
op|']'
op|')'
op|','
name|'parms'
op|'='
op|'{'
string|"'multipart-manifest'"
op|':'
string|"'put'"
op|'}'
op|')'
newline|'\n'
nl|'\n'
name|'file_item'
op|'='
name|'cls'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
string|'"ranged-manifest-repeated-segment"'
op|')'
newline|'\n'
name|'file_item'
op|'.'
name|'write'
op|'('
nl|'\n'
name|'json'
op|'.'
name|'dumps'
op|'('
op|'['
nl|'\n'
op|'{'
string|"'path'"
op|':'
name|'seg_info'
op|'['
string|"'seg_a'"
op|']'
op|'['
string|"'path'"
op|']'
op|','
string|"'etag'"
op|':'
name|'None'
op|','
nl|'\n'
string|"'size_bytes'"
op|':'
name|'None'
op|','
string|"'range'"
op|':'
string|"'-1048578'"
op|'}'
op|','
nl|'\n'
op|'{'
string|"'path'"
op|':'
name|'seg_info'
op|'['
string|"'seg_a'"
op|']'
op|'['
string|"'path'"
op|']'
op|','
string|"'etag'"
op|':'
name|'None'
op|','
nl|'\n'
string|"'size_bytes'"
op|':'
name|'None'
op|'}'
op|','
nl|'\n'
op|'{'
string|"'path'"
op|':'
name|'seg_info'
op|'['
string|"'seg_b'"
op|']'
op|'['
string|"'path'"
op|']'
op|','
string|"'etag'"
op|':'
name|'None'
op|','
nl|'\n'
string|"'size_bytes'"
op|':'
name|'None'
op|','
string|"'range'"
op|':'
string|"'-1048578'"
op|'}'
op|','
nl|'\n'
op|']'
op|')'
op|','
name|'parms'
op|'='
op|'{'
string|"'multipart-manifest'"
op|':'
string|"'put'"
op|'}'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|TestSlo
dedent|''
dedent|''
name|'class'
name|'TestSlo'
op|'('
name|'Base'
op|')'
op|':'
newline|'\n'
DECL|variable|env
indent|'    '
name|'env'
op|'='
name|'TestSloEnv'
newline|'\n'
DECL|variable|set_up
name|'set_up'
op|'='
name|'False'
newline|'\n'
nl|'\n'
DECL|member|setUp
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'super'
op|'('
name|'TestSlo'
op|','
name|'self'
op|')'
op|'.'
name|'setUp'
op|'('
op|')'
newline|'\n'
name|'if'
name|'self'
op|'.'
name|'env'
op|'.'
name|'slo_enabled'
name|'is'
name|'False'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'SkipTest'
op|'('
string|'"SLO not enabled"'
op|')'
newline|'\n'
dedent|''
name|'elif'
name|'self'
op|'.'
name|'env'
op|'.'
name|'slo_enabled'
name|'is'
name|'not'
name|'True'
op|':'
newline|'\n'
comment|'# just some sanity checking'
nl|'\n'
indent|'            '
name|'raise'
name|'Exception'
op|'('
nl|'\n'
string|'"Expected slo_enabled to be True/False, got %r"'
op|'%'
nl|'\n'
op|'('
name|'self'
op|'.'
name|'env'
op|'.'
name|'slo_enabled'
op|','
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_slo_get_simple_manifest
dedent|''
dedent|''
name|'def'
name|'test_slo_get_simple_manifest'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'file_item'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
string|"'manifest-abcde'"
op|')'
newline|'\n'
name|'file_contents'
op|'='
name|'file_item'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'4'
op|'*'
number|'1024'
op|'*'
number|'1024'
op|'+'
number|'1'
op|','
name|'len'
op|'('
name|'file_contents'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'a'"
op|','
name|'file_contents'
op|'['
number|'0'
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'a'"
op|','
name|'file_contents'
op|'['
number|'1024'
op|'*'
number|'1024'
op|'-'
number|'1'
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'b'"
op|','
name|'file_contents'
op|'['
number|'1024'
op|'*'
number|'1024'
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'d'"
op|','
name|'file_contents'
op|'['
op|'-'
number|'2'
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'e'"
op|','
name|'file_contents'
op|'['
op|'-'
number|'1'
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_slo_container_listing
dedent|''
name|'def'
name|'test_slo_container_listing'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# the listing object size should equal the sum of the size of the'
nl|'\n'
comment|'# segments, not the size of the manifest body'
nl|'\n'
indent|'        '
name|'raise'
name|'SkipTest'
op|'('
string|"'Only passes with object_post_as_copy=False'"
op|')'
newline|'\n'
name|'file_item'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|')'
newline|'\n'
name|'file_item'
op|'.'
name|'write'
op|'('
nl|'\n'
name|'json'
op|'.'
name|'dumps'
op|'('
op|'['
name|'self'
op|'.'
name|'env'
op|'.'
name|'seg_info'
op|'['
string|"'seg_a'"
op|']'
op|']'
op|')'
op|','
nl|'\n'
name|'parms'
op|'='
op|'{'
string|"'multipart-manifest'"
op|':'
string|"'put'"
op|'}'
op|')'
newline|'\n'
nl|'\n'
name|'files'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'files'
op|'('
name|'parms'
op|'='
op|'{'
string|"'format'"
op|':'
string|"'json'"
op|'}'
op|')'
newline|'\n'
name|'for'
name|'f_dict'
name|'in'
name|'files'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'f_dict'
op|'['
string|"'name'"
op|']'
op|'=='
name|'file_item'
op|'.'
name|'name'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'1024'
op|'*'
number|'1024'
op|','
name|'f_dict'
op|'['
string|"'bytes'"
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'application/octet-stream'"
op|','
nl|'\n'
name|'f_dict'
op|'['
string|"'content_type'"
op|']'
op|')'
newline|'\n'
name|'break'
newline|'\n'
dedent|''
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'fail'
op|'('
string|"'Failed to find manifest file in container listing'"
op|')'
newline|'\n'
nl|'\n'
comment|'# now POST updated content-type file'
nl|'\n'
dedent|''
name|'file_item'
op|'.'
name|'content_type'
op|'='
string|"'image/jpeg'"
newline|'\n'
name|'file_item'
op|'.'
name|'sync_metadata'
op|'('
op|'{'
string|"'X-Object-Meta-Test'"
op|':'
string|"'blah'"
op|'}'
op|')'
newline|'\n'
name|'file_item'
op|'.'
name|'initialize'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'image/jpeg'"
op|','
name|'file_item'
op|'.'
name|'content_type'
op|')'
comment|'# sanity'
newline|'\n'
nl|'\n'
comment|'# verify that the container listing is consistent with the file'
nl|'\n'
name|'files'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'files'
op|'('
name|'parms'
op|'='
op|'{'
string|"'format'"
op|':'
string|"'json'"
op|'}'
op|')'
newline|'\n'
name|'for'
name|'f_dict'
name|'in'
name|'files'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'f_dict'
op|'['
string|"'name'"
op|']'
op|'=='
name|'file_item'
op|'.'
name|'name'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'1024'
op|'*'
number|'1024'
op|','
name|'f_dict'
op|'['
string|"'bytes'"
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'file_item'
op|'.'
name|'content_type'
op|','
nl|'\n'
name|'f_dict'
op|'['
string|"'content_type'"
op|']'
op|')'
newline|'\n'
name|'break'
newline|'\n'
dedent|''
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'fail'
op|'('
string|"'Failed to find manifest file in container listing'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_slo_get_nested_manifest
dedent|''
dedent|''
name|'def'
name|'test_slo_get_nested_manifest'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'file_item'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
string|"'manifest-abcde-submanifest'"
op|')'
newline|'\n'
name|'file_contents'
op|'='
name|'file_item'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'4'
op|'*'
number|'1024'
op|'*'
number|'1024'
op|'+'
number|'1'
op|','
name|'len'
op|'('
name|'file_contents'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'a'"
op|','
name|'file_contents'
op|'['
number|'0'
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'a'"
op|','
name|'file_contents'
op|'['
number|'1024'
op|'*'
number|'1024'
op|'-'
number|'1'
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'b'"
op|','
name|'file_contents'
op|'['
number|'1024'
op|'*'
number|'1024'
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'d'"
op|','
name|'file_contents'
op|'['
op|'-'
number|'2'
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'e'"
op|','
name|'file_contents'
op|'['
op|'-'
number|'1'
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_slo_get_ranged_manifest
dedent|''
name|'def'
name|'test_slo_get_ranged_manifest'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'file_item'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
string|"'ranged-manifest'"
op|')'
newline|'\n'
name|'grouped_file_contents'
op|'='
op|'['
nl|'\n'
op|'('
name|'char'
op|','
name|'sum'
op|'('
number|'1'
name|'for'
name|'_char'
name|'in'
name|'grp'
op|')'
op|')'
nl|'\n'
name|'for'
name|'char'
op|','
name|'grp'
name|'in'
name|'itertools'
op|'.'
name|'groupby'
op|'('
name|'file_item'
op|'.'
name|'read'
op|'('
op|')'
op|')'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
op|'['
nl|'\n'
op|'('
string|"'c'"
op|','
number|'1'
op|')'
op|','
nl|'\n'
op|'('
string|"'d'"
op|','
number|'1024'
op|'*'
number|'1024'
op|')'
op|','
nl|'\n'
op|'('
string|"'e'"
op|','
number|'1'
op|')'
op|','
nl|'\n'
op|'('
string|"'a'"
op|','
number|'512'
op|'*'
number|'1024'
op|')'
op|','
nl|'\n'
op|'('
string|"'b'"
op|','
number|'512'
op|'*'
number|'1024'
op|')'
op|','
nl|'\n'
op|'('
string|"'c'"
op|','
number|'1'
op|')'
op|','
nl|'\n'
op|'('
string|"'d'"
op|','
number|'1'
op|')'
op|']'
op|','
name|'grouped_file_contents'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_slo_get_ranged_manifest_repeated_segment
dedent|''
name|'def'
name|'test_slo_get_ranged_manifest_repeated_segment'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'file_item'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
string|"'ranged-manifest-repeated-segment'"
op|')'
newline|'\n'
name|'grouped_file_contents'
op|'='
op|'['
nl|'\n'
op|'('
name|'char'
op|','
name|'sum'
op|'('
number|'1'
name|'for'
name|'_char'
name|'in'
name|'grp'
op|')'
op|')'
nl|'\n'
name|'for'
name|'char'
op|','
name|'grp'
name|'in'
name|'itertools'
op|'.'
name|'groupby'
op|'('
name|'file_item'
op|'.'
name|'read'
op|'('
op|')'
op|')'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
nl|'\n'
op|'['
op|'('
string|"'a'"
op|','
number|'2097152'
op|')'
op|','
op|'('
string|"'b'"
op|','
number|'1048576'
op|')'
op|']'
op|','
nl|'\n'
name|'grouped_file_contents'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_slo_get_ranged_submanifest
dedent|''
name|'def'
name|'test_slo_get_ranged_submanifest'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'file_item'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
string|"'ranged-submanifest'"
op|')'
newline|'\n'
name|'grouped_file_contents'
op|'='
op|'['
nl|'\n'
op|'('
name|'char'
op|','
name|'sum'
op|'('
number|'1'
name|'for'
name|'_char'
name|'in'
name|'grp'
op|')'
op|')'
nl|'\n'
name|'for'
name|'char'
op|','
name|'grp'
name|'in'
name|'itertools'
op|'.'
name|'groupby'
op|'('
name|'file_item'
op|'.'
name|'read'
op|'('
op|')'
op|')'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
op|'['
nl|'\n'
op|'('
string|"'c'"
op|','
number|'1024'
op|'*'
number|'1024'
op|'+'
number|'1'
op|')'
op|','
nl|'\n'
op|'('
string|"'d'"
op|','
number|'1024'
op|'*'
number|'1024'
op|')'
op|','
nl|'\n'
op|'('
string|"'e'"
op|','
number|'1'
op|')'
op|','
nl|'\n'
op|'('
string|"'a'"
op|','
number|'512'
op|'*'
number|'1024'
op|')'
op|','
nl|'\n'
op|'('
string|"'b'"
op|','
number|'512'
op|'*'
number|'1024'
op|')'
op|','
nl|'\n'
op|'('
string|"'c'"
op|','
number|'1'
op|')'
op|','
nl|'\n'
op|'('
string|"'d'"
op|','
number|'512'
op|'*'
number|'1024'
op|'+'
number|'1'
op|')'
op|','
nl|'\n'
op|'('
string|"'e'"
op|','
number|'1'
op|')'
op|','
nl|'\n'
op|'('
string|"'a'"
op|','
number|'512'
op|'*'
number|'1024'
op|')'
op|','
nl|'\n'
op|'('
string|"'b'"
op|','
number|'1'
op|')'
op|','
nl|'\n'
op|'('
string|"'c'"
op|','
number|'1'
op|')'
op|','
nl|'\n'
op|'('
string|"'d'"
op|','
number|'1'
op|')'
op|']'
op|','
name|'grouped_file_contents'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_slo_ranged_get
dedent|''
name|'def'
name|'test_slo_ranged_get'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'file_item'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
string|"'manifest-abcde'"
op|')'
newline|'\n'
name|'file_contents'
op|'='
name|'file_item'
op|'.'
name|'read'
op|'('
name|'size'
op|'='
number|'1024'
op|'*'
number|'1024'
op|'+'
number|'2'
op|','
nl|'\n'
name|'offset'
op|'='
number|'1024'
op|'*'
number|'1024'
op|'-'
number|'1'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'a'"
op|','
name|'file_contents'
op|'['
number|'0'
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'b'"
op|','
name|'file_contents'
op|'['
number|'1'
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'b'"
op|','
name|'file_contents'
op|'['
op|'-'
number|'2'
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'c'"
op|','
name|'file_contents'
op|'['
op|'-'
number|'1'
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_slo_ranged_submanifest
dedent|''
name|'def'
name|'test_slo_ranged_submanifest'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'file_item'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
string|"'manifest-abcde-submanifest'"
op|')'
newline|'\n'
name|'file_contents'
op|'='
name|'file_item'
op|'.'
name|'read'
op|'('
name|'size'
op|'='
number|'1024'
op|'*'
number|'1024'
op|'+'
number|'2'
op|','
nl|'\n'
name|'offset'
op|'='
number|'1024'
op|'*'
number|'1024'
op|'*'
number|'2'
op|'-'
number|'1'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'b'"
op|','
name|'file_contents'
op|'['
number|'0'
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'c'"
op|','
name|'file_contents'
op|'['
number|'1'
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'c'"
op|','
name|'file_contents'
op|'['
op|'-'
number|'2'
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'d'"
op|','
name|'file_contents'
op|'['
op|'-'
number|'1'
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_slo_etag_is_hash_of_etags
dedent|''
name|'def'
name|'test_slo_etag_is_hash_of_etags'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'expected_hash'
op|'='
name|'hashlib'
op|'.'
name|'md5'
op|'('
op|')'
newline|'\n'
name|'expected_hash'
op|'.'
name|'update'
op|'('
name|'hashlib'
op|'.'
name|'md5'
op|'('
string|"'a'"
op|'*'
number|'1024'
op|'*'
number|'1024'
op|')'
op|'.'
name|'hexdigest'
op|'('
op|')'
op|')'
newline|'\n'
name|'expected_hash'
op|'.'
name|'update'
op|'('
name|'hashlib'
op|'.'
name|'md5'
op|'('
string|"'b'"
op|'*'
number|'1024'
op|'*'
number|'1024'
op|')'
op|'.'
name|'hexdigest'
op|'('
op|')'
op|')'
newline|'\n'
name|'expected_hash'
op|'.'
name|'update'
op|'('
name|'hashlib'
op|'.'
name|'md5'
op|'('
string|"'c'"
op|'*'
number|'1024'
op|'*'
number|'1024'
op|')'
op|'.'
name|'hexdigest'
op|'('
op|')'
op|')'
newline|'\n'
name|'expected_hash'
op|'.'
name|'update'
op|'('
name|'hashlib'
op|'.'
name|'md5'
op|'('
string|"'d'"
op|'*'
number|'1024'
op|'*'
number|'1024'
op|')'
op|'.'
name|'hexdigest'
op|'('
op|')'
op|')'
newline|'\n'
name|'expected_hash'
op|'.'
name|'update'
op|'('
name|'hashlib'
op|'.'
name|'md5'
op|'('
string|"'e'"
op|')'
op|'.'
name|'hexdigest'
op|'('
op|')'
op|')'
newline|'\n'
name|'expected_etag'
op|'='
name|'expected_hash'
op|'.'
name|'hexdigest'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'file_item'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
string|"'manifest-abcde'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'expected_etag'
op|','
name|'file_item'
op|'.'
name|'info'
op|'('
op|')'
op|'['
string|"'etag'"
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_slo_etag_is_hash_of_etags_submanifests
dedent|''
name|'def'
name|'test_slo_etag_is_hash_of_etags_submanifests'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|function|hd
indent|'        '
name|'def'
name|'hd'
op|'('
name|'x'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'return'
name|'hashlib'
op|'.'
name|'md5'
op|'('
name|'x'
op|')'
op|'.'
name|'hexdigest'
op|'('
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'expected_etag'
op|'='
name|'hd'
op|'('
name|'hd'
op|'('
string|"'a'"
op|'*'
number|'1024'
op|'*'
number|'1024'
op|')'
op|'+'
nl|'\n'
name|'hd'
op|'('
name|'hd'
op|'('
string|"'b'"
op|'*'
number|'1024'
op|'*'
number|'1024'
op|')'
op|'+'
nl|'\n'
name|'hd'
op|'('
name|'hd'
op|'('
string|"'c'"
op|'*'
number|'1024'
op|'*'
number|'1024'
op|')'
op|'+'
nl|'\n'
name|'hd'
op|'('
string|"'d'"
op|'*'
number|'1024'
op|'*'
number|'1024'
op|')'
op|')'
op|')'
op|'+'
nl|'\n'
name|'hd'
op|'('
string|"'e'"
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'file_item'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
string|"'manifest-abcde-submanifest'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'expected_etag'
op|','
name|'file_item'
op|'.'
name|'info'
op|'('
op|')'
op|'['
string|"'etag'"
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_slo_etag_mismatch
dedent|''
name|'def'
name|'test_slo_etag_mismatch'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'file_item'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
string|'"manifest-a-bad-etag"'
op|')'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'file_item'
op|'.'
name|'write'
op|'('
nl|'\n'
name|'json'
op|'.'
name|'dumps'
op|'('
op|'['
op|'{'
nl|'\n'
string|"'size_bytes'"
op|':'
number|'1024'
op|'*'
number|'1024'
op|','
nl|'\n'
string|"'etag'"
op|':'
string|"'not it'"
op|','
nl|'\n'
string|"'path'"
op|':'
string|"'/%s/%s'"
op|'%'
op|'('
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'name'
op|','
string|"'seg_a'"
op|')'
op|'}'
op|']'
op|')'
op|','
nl|'\n'
name|'parms'
op|'='
op|'{'
string|"'multipart-manifest'"
op|':'
string|"'put'"
op|'}'
op|')'
newline|'\n'
dedent|''
name|'except'
name|'ResponseError'
name|'as'
name|'err'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'400'
op|','
name|'err'
op|'.'
name|'status'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'fail'
op|'('
string|'"Expected ResponseError but didn\'t get it"'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_slo_size_mismatch
dedent|''
dedent|''
name|'def'
name|'test_slo_size_mismatch'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'file_item'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
string|'"manifest-a-bad-size"'
op|')'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'file_item'
op|'.'
name|'write'
op|'('
nl|'\n'
name|'json'
op|'.'
name|'dumps'
op|'('
op|'['
op|'{'
nl|'\n'
string|"'size_bytes'"
op|':'
number|'1024'
op|'*'
number|'1024'
op|'-'
number|'1'
op|','
nl|'\n'
string|"'etag'"
op|':'
name|'hashlib'
op|'.'
name|'md5'
op|'('
string|"'a'"
op|'*'
number|'1024'
op|'*'
number|'1024'
op|')'
op|'.'
name|'hexdigest'
op|'('
op|')'
op|','
nl|'\n'
string|"'path'"
op|':'
string|"'/%s/%s'"
op|'%'
op|'('
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'name'
op|','
string|"'seg_a'"
op|')'
op|'}'
op|']'
op|')'
op|','
nl|'\n'
name|'parms'
op|'='
op|'{'
string|"'multipart-manifest'"
op|':'
string|"'put'"
op|'}'
op|')'
newline|'\n'
dedent|''
name|'except'
name|'ResponseError'
name|'as'
name|'err'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'400'
op|','
name|'err'
op|'.'
name|'status'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'fail'
op|'('
string|'"Expected ResponseError but didn\'t get it"'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_slo_unspecified_etag
dedent|''
dedent|''
name|'def'
name|'test_slo_unspecified_etag'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'file_item'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
string|'"manifest-a-unspecified-etag"'
op|')'
newline|'\n'
name|'file_item'
op|'.'
name|'write'
op|'('
nl|'\n'
name|'json'
op|'.'
name|'dumps'
op|'('
op|'['
op|'{'
nl|'\n'
string|"'size_bytes'"
op|':'
number|'1024'
op|'*'
number|'1024'
op|','
nl|'\n'
string|"'etag'"
op|':'
name|'None'
op|','
nl|'\n'
string|"'path'"
op|':'
string|"'/%s/%s'"
op|'%'
op|'('
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'name'
op|','
string|"'seg_a'"
op|')'
op|'}'
op|']'
op|')'
op|','
nl|'\n'
name|'parms'
op|'='
op|'{'
string|"'multipart-manifest'"
op|':'
string|"'put'"
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'201'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_slo_unspecified_size
dedent|''
name|'def'
name|'test_slo_unspecified_size'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'file_item'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
string|'"manifest-a-unspecified-size"'
op|')'
newline|'\n'
name|'file_item'
op|'.'
name|'write'
op|'('
nl|'\n'
name|'json'
op|'.'
name|'dumps'
op|'('
op|'['
op|'{'
nl|'\n'
string|"'size_bytes'"
op|':'
name|'None'
op|','
nl|'\n'
string|"'etag'"
op|':'
name|'hashlib'
op|'.'
name|'md5'
op|'('
string|"'a'"
op|'*'
number|'1024'
op|'*'
number|'1024'
op|')'
op|'.'
name|'hexdigest'
op|'('
op|')'
op|','
nl|'\n'
string|"'path'"
op|':'
string|"'/%s/%s'"
op|'%'
op|'('
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'name'
op|','
string|"'seg_a'"
op|')'
op|'}'
op|']'
op|')'
op|','
nl|'\n'
name|'parms'
op|'='
op|'{'
string|"'multipart-manifest'"
op|':'
string|"'put'"
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'201'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_slo_missing_etag
dedent|''
name|'def'
name|'test_slo_missing_etag'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'file_item'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
string|'"manifest-a-missing-etag"'
op|')'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'file_item'
op|'.'
name|'write'
op|'('
nl|'\n'
name|'json'
op|'.'
name|'dumps'
op|'('
op|'['
op|'{'
nl|'\n'
string|"'size_bytes'"
op|':'
number|'1024'
op|'*'
number|'1024'
op|','
nl|'\n'
string|"'path'"
op|':'
string|"'/%s/%s'"
op|'%'
op|'('
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'name'
op|','
string|"'seg_a'"
op|')'
op|'}'
op|']'
op|')'
op|','
nl|'\n'
name|'parms'
op|'='
op|'{'
string|"'multipart-manifest'"
op|':'
string|"'put'"
op|'}'
op|')'
newline|'\n'
dedent|''
name|'except'
name|'ResponseError'
name|'as'
name|'err'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'400'
op|','
name|'err'
op|'.'
name|'status'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'fail'
op|'('
string|'"Expected ResponseError but didn\'t get it"'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_slo_missing_size
dedent|''
dedent|''
name|'def'
name|'test_slo_missing_size'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'file_item'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
string|'"manifest-a-missing-size"'
op|')'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'file_item'
op|'.'
name|'write'
op|'('
nl|'\n'
name|'json'
op|'.'
name|'dumps'
op|'('
op|'['
op|'{'
nl|'\n'
string|"'etag'"
op|':'
name|'hashlib'
op|'.'
name|'md5'
op|'('
string|"'a'"
op|'*'
number|'1024'
op|'*'
number|'1024'
op|')'
op|'.'
name|'hexdigest'
op|'('
op|')'
op|','
nl|'\n'
string|"'path'"
op|':'
string|"'/%s/%s'"
op|'%'
op|'('
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'name'
op|','
string|"'seg_a'"
op|')'
op|'}'
op|']'
op|')'
op|','
nl|'\n'
name|'parms'
op|'='
op|'{'
string|"'multipart-manifest'"
op|':'
string|"'put'"
op|'}'
op|')'
newline|'\n'
dedent|''
name|'except'
name|'ResponseError'
name|'as'
name|'err'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'400'
op|','
name|'err'
op|'.'
name|'status'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'fail'
op|'('
string|'"Expected ResponseError but didn\'t get it"'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_slo_overwrite_segment_with_manifest
dedent|''
dedent|''
name|'def'
name|'test_slo_overwrite_segment_with_manifest'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'file_item'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
string|'"seg_b"'
op|')'
newline|'\n'
name|'with'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ResponseError'
op|')'
name|'as'
name|'catcher'
op|':'
newline|'\n'
indent|'            '
name|'file_item'
op|'.'
name|'write'
op|'('
nl|'\n'
name|'json'
op|'.'
name|'dumps'
op|'('
op|'['
nl|'\n'
op|'{'
string|"'size_bytes'"
op|':'
number|'1024'
op|'*'
number|'1024'
op|','
nl|'\n'
string|"'etag'"
op|':'
name|'hashlib'
op|'.'
name|'md5'
op|'('
string|"'a'"
op|'*'
number|'1024'
op|'*'
number|'1024'
op|')'
op|'.'
name|'hexdigest'
op|'('
op|')'
op|','
nl|'\n'
string|"'path'"
op|':'
string|"'/%s/%s'"
op|'%'
op|'('
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'name'
op|','
string|"'seg_a'"
op|')'
op|'}'
op|','
nl|'\n'
op|'{'
string|"'size_bytes'"
op|':'
number|'1024'
op|'*'
number|'1024'
op|','
nl|'\n'
string|"'etag'"
op|':'
name|'hashlib'
op|'.'
name|'md5'
op|'('
string|"'b'"
op|'*'
number|'1024'
op|'*'
number|'1024'
op|')'
op|'.'
name|'hexdigest'
op|'('
op|')'
op|','
nl|'\n'
string|"'path'"
op|':'
string|"'/%s/%s'"
op|'%'
op|'('
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'name'
op|','
string|"'seg_b'"
op|')'
op|'}'
op|','
nl|'\n'
op|'{'
string|"'size_bytes'"
op|':'
number|'1024'
op|'*'
number|'1024'
op|','
nl|'\n'
string|"'etag'"
op|':'
name|'hashlib'
op|'.'
name|'md5'
op|'('
string|"'c'"
op|'*'
number|'1024'
op|'*'
number|'1024'
op|')'
op|'.'
name|'hexdigest'
op|'('
op|')'
op|','
nl|'\n'
string|"'path'"
op|':'
string|"'/%s/%s'"
op|'%'
op|'('
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'name'
op|','
string|"'seg_c'"
op|')'
op|'}'
op|']'
op|')'
op|','
nl|'\n'
name|'parms'
op|'='
op|'{'
string|"'multipart-manifest'"
op|':'
string|"'put'"
op|'}'
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'400'
op|','
name|'catcher'
op|'.'
name|'exception'
op|'.'
name|'status'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_slo_copy
dedent|''
name|'def'
name|'test_slo_copy'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'file_item'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
string|'"manifest-abcde"'
op|')'
newline|'\n'
name|'file_item'
op|'.'
name|'copy'
op|'('
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'name'
op|','
string|'"copied-abcde"'
op|')'
newline|'\n'
nl|'\n'
name|'copied'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
string|'"copied-abcde"'
op|')'
newline|'\n'
name|'copied_contents'
op|'='
name|'copied'
op|'.'
name|'read'
op|'('
name|'parms'
op|'='
op|'{'
string|"'multipart-manifest'"
op|':'
string|"'get'"
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'4'
op|'*'
number|'1024'
op|'*'
number|'1024'
op|'+'
number|'1'
op|','
name|'len'
op|'('
name|'copied_contents'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_slo_copy_account
dedent|''
name|'def'
name|'test_slo_copy_account'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'acct'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'conn'
op|'.'
name|'account_name'
newline|'\n'
comment|'# same account copy'
nl|'\n'
name|'file_item'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
string|'"manifest-abcde"'
op|')'
newline|'\n'
name|'file_item'
op|'.'
name|'copy_account'
op|'('
name|'acct'
op|','
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'name'
op|','
string|'"copied-abcde"'
op|')'
newline|'\n'
nl|'\n'
name|'copied'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
string|'"copied-abcde"'
op|')'
newline|'\n'
name|'copied_contents'
op|'='
name|'copied'
op|'.'
name|'read'
op|'('
name|'parms'
op|'='
op|'{'
string|"'multipart-manifest'"
op|':'
string|"'get'"
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'4'
op|'*'
number|'1024'
op|'*'
number|'1024'
op|'+'
number|'1'
op|','
name|'len'
op|'('
name|'copied_contents'
op|')'
op|')'
newline|'\n'
nl|'\n'
comment|'# copy to different account'
nl|'\n'
name|'acct'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'conn2'
op|'.'
name|'account_name'
newline|'\n'
name|'dest_cont'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'account2'
op|'.'
name|'container'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'dest_cont'
op|'.'
name|'create'
op|'('
name|'hdrs'
op|'='
op|'{'
nl|'\n'
string|"'X-Container-Write'"
op|':'
name|'self'
op|'.'
name|'env'
op|'.'
name|'conn'
op|'.'
name|'user_acl'
nl|'\n'
op|'}'
op|')'
op|')'
newline|'\n'
name|'file_item'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
string|'"manifest-abcde"'
op|')'
newline|'\n'
name|'file_item'
op|'.'
name|'copy_account'
op|'('
name|'acct'
op|','
name|'dest_cont'
op|','
string|'"copied-abcde"'
op|')'
newline|'\n'
nl|'\n'
name|'copied'
op|'='
name|'dest_cont'
op|'.'
name|'file'
op|'('
string|'"copied-abcde"'
op|')'
newline|'\n'
name|'copied_contents'
op|'='
name|'copied'
op|'.'
name|'read'
op|'('
name|'parms'
op|'='
op|'{'
string|"'multipart-manifest'"
op|':'
string|"'get'"
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'4'
op|'*'
number|'1024'
op|'*'
number|'1024'
op|'+'
number|'1'
op|','
name|'len'
op|'('
name|'copied_contents'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_slo_copy_the_manifest
dedent|''
name|'def'
name|'test_slo_copy_the_manifest'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'file_item'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
string|'"manifest-abcde"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'file_item'
op|'.'
name|'copy'
op|'('
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'name'
op|','
nl|'\n'
string|'"copied-abcde-manifest-only"'
op|','
nl|'\n'
name|'parms'
op|'='
op|'{'
string|"'multipart-manifest'"
op|':'
string|"'get'"
op|'}'
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'copied'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
string|'"copied-abcde-manifest-only"'
op|')'
newline|'\n'
name|'copied_contents'
op|'='
name|'copied'
op|'.'
name|'read'
op|'('
name|'parms'
op|'='
op|'{'
string|"'multipart-manifest'"
op|':'
string|"'get'"
op|'}'
op|')'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'json'
op|'.'
name|'loads'
op|'('
name|'copied_contents'
op|')'
newline|'\n'
dedent|''
name|'except'
name|'ValueError'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'fail'
op|'('
string|'"COPY didn\'t copy the manifest (invalid json on GET)"'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_slo_copy_the_manifest_account
dedent|''
dedent|''
name|'def'
name|'test_slo_copy_the_manifest_account'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'acct'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'conn'
op|'.'
name|'account_name'
newline|'\n'
comment|'# same account'
nl|'\n'
name|'file_item'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
string|'"manifest-abcde"'
op|')'
newline|'\n'
name|'file_item'
op|'.'
name|'copy_account'
op|'('
name|'acct'
op|','
nl|'\n'
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'name'
op|','
nl|'\n'
string|'"copied-abcde-manifest-only"'
op|','
nl|'\n'
name|'parms'
op|'='
op|'{'
string|"'multipart-manifest'"
op|':'
string|"'get'"
op|'}'
op|')'
newline|'\n'
nl|'\n'
name|'copied'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
string|'"copied-abcde-manifest-only"'
op|')'
newline|'\n'
name|'copied_contents'
op|'='
name|'copied'
op|'.'
name|'read'
op|'('
name|'parms'
op|'='
op|'{'
string|"'multipart-manifest'"
op|':'
string|"'get'"
op|'}'
op|')'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'json'
op|'.'
name|'loads'
op|'('
name|'copied_contents'
op|')'
newline|'\n'
dedent|''
name|'except'
name|'ValueError'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'fail'
op|'('
string|'"COPY didn\'t copy the manifest (invalid json on GET)"'
op|')'
newline|'\n'
nl|'\n'
comment|'# different account'
nl|'\n'
dedent|''
name|'acct'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'conn2'
op|'.'
name|'account_name'
newline|'\n'
name|'dest_cont'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'account2'
op|'.'
name|'container'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'dest_cont'
op|'.'
name|'create'
op|'('
name|'hdrs'
op|'='
op|'{'
nl|'\n'
string|"'X-Container-Write'"
op|':'
name|'self'
op|'.'
name|'env'
op|'.'
name|'conn'
op|'.'
name|'user_acl'
nl|'\n'
op|'}'
op|')'
op|')'
newline|'\n'
nl|'\n'
comment|'# manifest copy will fail because there is no read access to segments'
nl|'\n'
comment|'# in destination account'
nl|'\n'
name|'file_item'
op|'.'
name|'copy_account'
op|'('
nl|'\n'
name|'acct'
op|','
name|'dest_cont'
op|','
string|'"copied-abcde-manifest-only"'
op|','
nl|'\n'
name|'parms'
op|'='
op|'{'
string|"'multipart-manifest'"
op|':'
string|"'get'"
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'400'
op|','
name|'file_item'
op|'.'
name|'conn'
op|'.'
name|'response'
op|'.'
name|'status'
op|')'
newline|'\n'
name|'resp_body'
op|'='
name|'file_item'
op|'.'
name|'conn'
op|'.'
name|'response'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'5'
op|','
name|'resp_body'
op|'.'
name|'count'
op|'('
string|"'403 Forbidden'"
op|')'
op|','
nl|'\n'
string|"'Unexpected response body %r'"
op|'%'
name|'resp_body'
op|')'
newline|'\n'
nl|'\n'
comment|'# create segments container in account2 with read access for account1'
nl|'\n'
name|'segs_container'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'account2'
op|'.'
name|'container'
op|'('
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'name'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'segs_container'
op|'.'
name|'create'
op|'('
name|'hdrs'
op|'='
op|'{'
nl|'\n'
string|"'X-Container-Read'"
op|':'
name|'self'
op|'.'
name|'env'
op|'.'
name|'conn'
op|'.'
name|'user_acl'
nl|'\n'
op|'}'
op|')'
op|')'
newline|'\n'
nl|'\n'
comment|'# manifest copy will still fail because there are no segments in'
nl|'\n'
comment|'# destination account'
nl|'\n'
name|'file_item'
op|'.'
name|'copy_account'
op|'('
nl|'\n'
name|'acct'
op|','
name|'dest_cont'
op|','
string|'"copied-abcde-manifest-only"'
op|','
nl|'\n'
name|'parms'
op|'='
op|'{'
string|"'multipart-manifest'"
op|':'
string|"'get'"
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'400'
op|','
name|'file_item'
op|'.'
name|'conn'
op|'.'
name|'response'
op|'.'
name|'status'
op|')'
newline|'\n'
name|'resp_body'
op|'='
name|'file_item'
op|'.'
name|'conn'
op|'.'
name|'response'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'5'
op|','
name|'resp_body'
op|'.'
name|'count'
op|'('
string|"'404 Not Found'"
op|')'
op|','
nl|'\n'
string|"'Unexpected response body %r'"
op|'%'
name|'resp_body'
op|')'
newline|'\n'
nl|'\n'
comment|'# create segments in account2 container with same name as in account1,'
nl|'\n'
comment|'# manifest copy now succeeds'
nl|'\n'
name|'self'
op|'.'
name|'env'
op|'.'
name|'create_segments'
op|'('
name|'segs_container'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'file_item'
op|'.'
name|'copy_account'
op|'('
nl|'\n'
name|'acct'
op|','
name|'dest_cont'
op|','
string|'"copied-abcde-manifest-only"'
op|','
nl|'\n'
name|'parms'
op|'='
op|'{'
string|"'multipart-manifest'"
op|':'
string|"'get'"
op|'}'
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'copied'
op|'='
name|'dest_cont'
op|'.'
name|'file'
op|'('
string|'"copied-abcde-manifest-only"'
op|')'
newline|'\n'
name|'copied_contents'
op|'='
name|'copied'
op|'.'
name|'read'
op|'('
name|'parms'
op|'='
op|'{'
string|"'multipart-manifest'"
op|':'
string|"'get'"
op|'}'
op|')'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'json'
op|'.'
name|'loads'
op|'('
name|'copied_contents'
op|')'
newline|'\n'
dedent|''
name|'except'
name|'ValueError'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'fail'
op|'('
string|'"COPY didn\'t copy the manifest (invalid json on GET)"'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_make_manifest
dedent|''
dedent|''
name|'def'
name|'_make_manifest'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'file_item'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
string|'"manifest-post"'
op|')'
newline|'\n'
name|'seg_info'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'seg_info'
newline|'\n'
name|'file_item'
op|'.'
name|'write'
op|'('
nl|'\n'
name|'json'
op|'.'
name|'dumps'
op|'('
op|'['
name|'seg_info'
op|'['
string|"'seg_a'"
op|']'
op|','
name|'seg_info'
op|'['
string|"'seg_b'"
op|']'
op|','
nl|'\n'
name|'seg_info'
op|'['
string|"'seg_c'"
op|']'
op|','
name|'seg_info'
op|'['
string|"'seg_d'"
op|']'
op|','
nl|'\n'
name|'seg_info'
op|'['
string|"'seg_e'"
op|']'
op|']'
op|')'
op|','
nl|'\n'
name|'parms'
op|'='
op|'{'
string|"'multipart-manifest'"
op|':'
string|"'put'"
op|'}'
op|')'
newline|'\n'
name|'return'
name|'file_item'
newline|'\n'
nl|'\n'
DECL|member|test_slo_post_the_manifest_metadata_update
dedent|''
name|'def'
name|'test_slo_post_the_manifest_metadata_update'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'file_item'
op|'='
name|'self'
op|'.'
name|'_make_manifest'
op|'('
op|')'
newline|'\n'
comment|'# sanity check, check the object is an SLO manifest'
nl|'\n'
name|'file_item'
op|'.'
name|'info'
op|'('
op|')'
newline|'\n'
name|'file_item'
op|'.'
name|'header_fields'
op|'('
op|'['
op|'('
string|"'slo'"
op|','
string|"'x-static-large-object'"
op|')'
op|']'
op|')'
newline|'\n'
nl|'\n'
comment|'# POST a user metadata (i.e. x-object-meta-post)'
nl|'\n'
name|'file_item'
op|'.'
name|'sync_metadata'
op|'('
op|'{'
string|"'post'"
op|':'
string|"'update'"
op|'}'
op|')'
newline|'\n'
nl|'\n'
name|'updated'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
string|'"manifest-post"'
op|')'
newline|'\n'
name|'updated'
op|'.'
name|'info'
op|'('
op|')'
newline|'\n'
name|'updated'
op|'.'
name|'header_fields'
op|'('
op|'['
op|'('
string|"'user-meta'"
op|','
string|"'x-object-meta-post'"
op|')'
op|']'
op|')'
comment|'# sanity'
newline|'\n'
name|'updated'
op|'.'
name|'header_fields'
op|'('
op|'['
op|'('
string|"'slo'"
op|','
string|"'x-static-large-object'"
op|')'
op|']'
op|')'
newline|'\n'
name|'updated_contents'
op|'='
name|'updated'
op|'.'
name|'read'
op|'('
name|'parms'
op|'='
op|'{'
string|"'multipart-manifest'"
op|':'
string|"'get'"
op|'}'
op|')'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'json'
op|'.'
name|'loads'
op|'('
name|'updated_contents'
op|')'
newline|'\n'
dedent|''
name|'except'
name|'ValueError'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'fail'
op|'('
string|'"Unexpected content on GET, expected a json body"'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_slo_post_the_manifest_metadata_update_with_qs
dedent|''
dedent|''
name|'def'
name|'test_slo_post_the_manifest_metadata_update_with_qs'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# multipart-manifest query should be ignored on post'
nl|'\n'
indent|'        '
name|'for'
name|'verb'
name|'in'
op|'('
string|"'put'"
op|','
string|"'get'"
op|','
string|"'delete'"
op|')'
op|':'
newline|'\n'
indent|'            '
name|'file_item'
op|'='
name|'self'
op|'.'
name|'_make_manifest'
op|'('
op|')'
newline|'\n'
comment|'# sanity check, check the object is an SLO manifest'
nl|'\n'
name|'file_item'
op|'.'
name|'info'
op|'('
op|')'
newline|'\n'
name|'file_item'
op|'.'
name|'header_fields'
op|'('
op|'['
op|'('
string|"'slo'"
op|','
string|"'x-static-large-object'"
op|')'
op|']'
op|')'
newline|'\n'
comment|'# POST a user metadata (i.e. x-object-meta-post)'
nl|'\n'
name|'file_item'
op|'.'
name|'sync_metadata'
op|'('
name|'metadata'
op|'='
op|'{'
string|"'post'"
op|':'
string|"'update'"
op|'}'
op|','
nl|'\n'
name|'parms'
op|'='
op|'{'
string|"'multipart-manifest'"
op|':'
name|'verb'
op|'}'
op|')'
newline|'\n'
name|'updated'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
string|'"manifest-post"'
op|')'
newline|'\n'
name|'updated'
op|'.'
name|'info'
op|'('
op|')'
newline|'\n'
name|'updated'
op|'.'
name|'header_fields'
op|'('
nl|'\n'
op|'['
op|'('
string|"'user-meta'"
op|','
string|"'x-object-meta-post'"
op|')'
op|']'
op|')'
comment|'# sanity'
newline|'\n'
name|'updated'
op|'.'
name|'header_fields'
op|'('
op|'['
op|'('
string|"'slo'"
op|','
string|"'x-static-large-object'"
op|')'
op|']'
op|')'
newline|'\n'
name|'updated_contents'
op|'='
name|'updated'
op|'.'
name|'read'
op|'('
nl|'\n'
name|'parms'
op|'='
op|'{'
string|"'multipart-manifest'"
op|':'
string|"'get'"
op|'}'
op|')'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'                '
name|'json'
op|'.'
name|'loads'
op|'('
name|'updated_contents'
op|')'
newline|'\n'
dedent|''
name|'except'
name|'ValueError'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'fail'
op|'('
nl|'\n'
string|'"Unexpected content on GET, expected a json body"'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_slo_get_the_manifest
dedent|''
dedent|''
dedent|''
name|'def'
name|'test_slo_get_the_manifest'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'manifest'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
string|'"manifest-abcde"'
op|')'
newline|'\n'
name|'got_body'
op|'='
name|'manifest'
op|'.'
name|'read'
op|'('
name|'parms'
op|'='
op|'{'
string|"'multipart-manifest'"
op|':'
string|"'get'"
op|'}'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'application/json; charset=utf-8'"
op|','
nl|'\n'
name|'manifest'
op|'.'
name|'content_type'
op|')'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'json'
op|'.'
name|'loads'
op|'('
name|'got_body'
op|')'
newline|'\n'
dedent|''
name|'except'
name|'ValueError'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'fail'
op|'('
string|'"GET with multipart-manifest=get got invalid json"'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_slo_get_the_manifest_with_details_from_server
dedent|''
dedent|''
name|'def'
name|'test_slo_get_the_manifest_with_details_from_server'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'manifest'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
string|'"manifest-db"'
op|')'
newline|'\n'
name|'got_body'
op|'='
name|'manifest'
op|'.'
name|'read'
op|'('
name|'parms'
op|'='
op|'{'
string|"'multipart-manifest'"
op|':'
string|"'get'"
op|'}'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'application/json; charset=utf-8'"
op|','
nl|'\n'
name|'manifest'
op|'.'
name|'content_type'
op|')'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'value'
op|'='
name|'json'
op|'.'
name|'loads'
op|'('
name|'got_body'
op|')'
newline|'\n'
dedent|''
name|'except'
name|'ValueError'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'fail'
op|'('
string|'"GET with multipart-manifest=get got invalid json"'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'len'
op|'('
name|'value'
op|')'
op|','
number|'2'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'value'
op|'['
number|'0'
op|']'
op|'['
string|"'bytes'"
op|']'
op|','
number|'1024'
op|'*'
number|'1024'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'value'
op|'['
number|'0'
op|']'
op|'['
string|"'hash'"
op|']'
op|','
nl|'\n'
name|'hashlib'
op|'.'
name|'md5'
op|'('
string|"'d'"
op|'*'
number|'1024'
op|'*'
number|'1024'
op|')'
op|'.'
name|'hexdigest'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'value'
op|'['
number|'0'
op|']'
op|'['
string|"'name'"
op|']'
op|','
nl|'\n'
string|"'/%s/seg_d'"
op|'%'
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'name'
op|'.'
name|'decode'
op|'('
string|'"utf-8"'
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'value'
op|'['
number|'1'
op|']'
op|'['
string|"'bytes'"
op|']'
op|','
number|'1024'
op|'*'
number|'1024'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'value'
op|'['
number|'1'
op|']'
op|'['
string|"'hash'"
op|']'
op|','
nl|'\n'
name|'hashlib'
op|'.'
name|'md5'
op|'('
string|"'b'"
op|'*'
number|'1024'
op|'*'
number|'1024'
op|')'
op|'.'
name|'hexdigest'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'value'
op|'['
number|'1'
op|']'
op|'['
string|"'name'"
op|']'
op|','
nl|'\n'
string|"'/%s/seg_b'"
op|'%'
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'name'
op|'.'
name|'decode'
op|'('
string|'"utf-8"'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_slo_get_raw_the_manifest_with_details_from_server
dedent|''
name|'def'
name|'test_slo_get_raw_the_manifest_with_details_from_server'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'manifest'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
string|'"manifest-db"'
op|')'
newline|'\n'
name|'got_body'
op|'='
name|'manifest'
op|'.'
name|'read'
op|'('
name|'parms'
op|'='
op|'{'
string|"'multipart-manifest'"
op|':'
string|"'get'"
op|','
nl|'\n'
string|"'format'"
op|':'
string|"'raw'"
op|'}'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'application/json; charset=utf-8'"
op|','
nl|'\n'
name|'manifest'
op|'.'
name|'content_type'
op|')'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'value'
op|'='
name|'json'
op|'.'
name|'loads'
op|'('
name|'got_body'
op|')'
newline|'\n'
dedent|''
name|'except'
name|'ValueError'
op|':'
newline|'\n'
indent|'            '
name|'msg'
op|'='
string|'"GET with multipart-manifest=get&format=raw got invalid json"'
newline|'\n'
name|'self'
op|'.'
name|'fail'
op|'('
name|'msg'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
nl|'\n'
name|'set'
op|'('
name|'value'
op|'['
number|'0'
op|']'
op|'.'
name|'keys'
op|'('
op|')'
op|')'
op|','
name|'set'
op|'('
op|'('
string|"'size_bytes'"
op|','
string|"'etag'"
op|','
string|"'path'"
op|')'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'len'
op|'('
name|'value'
op|')'
op|','
number|'2'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'value'
op|'['
number|'0'
op|']'
op|'['
string|"'size_bytes'"
op|']'
op|','
number|'1024'
op|'*'
number|'1024'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'value'
op|'['
number|'0'
op|']'
op|'['
string|"'etag'"
op|']'
op|','
nl|'\n'
name|'hashlib'
op|'.'
name|'md5'
op|'('
string|"'d'"
op|'*'
number|'1024'
op|'*'
number|'1024'
op|')'
op|'.'
name|'hexdigest'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'value'
op|'['
number|'0'
op|']'
op|'['
string|"'path'"
op|']'
op|','
nl|'\n'
string|"'/%s/seg_d'"
op|'%'
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'name'
op|'.'
name|'decode'
op|'('
string|'"utf-8"'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'value'
op|'['
number|'1'
op|']'
op|'['
string|"'size_bytes'"
op|']'
op|','
number|'1024'
op|'*'
number|'1024'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'value'
op|'['
number|'1'
op|']'
op|'['
string|"'etag'"
op|']'
op|','
nl|'\n'
name|'hashlib'
op|'.'
name|'md5'
op|'('
string|"'b'"
op|'*'
number|'1024'
op|'*'
number|'1024'
op|')'
op|'.'
name|'hexdigest'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'value'
op|'['
number|'1'
op|']'
op|'['
string|"'path'"
op|']'
op|','
nl|'\n'
string|"'/%s/seg_b'"
op|'%'
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'name'
op|'.'
name|'decode'
op|'('
string|'"utf-8"'
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'file_item'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
string|'"manifest-from-get-raw"'
op|')'
newline|'\n'
name|'file_item'
op|'.'
name|'write'
op|'('
name|'got_body'
op|','
name|'parms'
op|'='
op|'{'
string|"'multipart-manifest'"
op|':'
string|"'put'"
op|'}'
op|')'
newline|'\n'
nl|'\n'
name|'file_contents'
op|'='
name|'file_item'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'2'
op|'*'
number|'1024'
op|'*'
number|'1024'
op|','
name|'len'
op|'('
name|'file_contents'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_slo_head_the_manifest
dedent|''
name|'def'
name|'test_slo_head_the_manifest'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'manifest'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
string|'"manifest-abcde"'
op|')'
newline|'\n'
name|'got_info'
op|'='
name|'manifest'
op|'.'
name|'info'
op|'('
name|'parms'
op|'='
op|'{'
string|"'multipart-manifest'"
op|':'
string|"'get'"
op|'}'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'application/json; charset=utf-8'"
op|','
nl|'\n'
name|'got_info'
op|'['
string|"'content_type'"
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_slo_if_match_get
dedent|''
name|'def'
name|'test_slo_if_match_get'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'manifest'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
string|'"manifest-abcde"'
op|')'
newline|'\n'
name|'etag'
op|'='
name|'manifest'
op|'.'
name|'info'
op|'('
op|')'
op|'['
string|"'etag'"
op|']'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ResponseError'
op|','
name|'manifest'
op|'.'
name|'read'
op|','
nl|'\n'
name|'hdrs'
op|'='
op|'{'
string|"'If-Match'"
op|':'
string|"'not-%s'"
op|'%'
name|'etag'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'412'
op|')'
newline|'\n'
nl|'\n'
name|'manifest'
op|'.'
name|'read'
op|'('
name|'hdrs'
op|'='
op|'{'
string|"'If-Match'"
op|':'
name|'etag'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'200'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_slo_if_none_match_put
dedent|''
name|'def'
name|'test_slo_if_none_match_put'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'file_item'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
string|'"manifest-if-none-match"'
op|')'
newline|'\n'
name|'manifest'
op|'='
name|'json'
op|'.'
name|'dumps'
op|'('
op|'['
op|'{'
nl|'\n'
string|"'size_bytes'"
op|':'
number|'1024'
op|'*'
number|'1024'
op|','
nl|'\n'
string|"'etag'"
op|':'
name|'None'
op|','
nl|'\n'
string|"'path'"
op|':'
string|"'/%s/%s'"
op|'%'
op|'('
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'name'
op|','
string|"'seg_a'"
op|')'
op|'}'
op|']'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ResponseError'
op|','
name|'file_item'
op|'.'
name|'write'
op|','
name|'manifest'
op|','
nl|'\n'
name|'parms'
op|'='
op|'{'
string|"'multipart-manifest'"
op|':'
string|"'put'"
op|'}'
op|','
nl|'\n'
name|'hdrs'
op|'='
op|'{'
string|"'If-None-Match'"
op|':'
string|'\'"not-star"\''
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'400'
op|')'
newline|'\n'
nl|'\n'
name|'file_item'
op|'.'
name|'write'
op|'('
name|'manifest'
op|','
name|'parms'
op|'='
op|'{'
string|"'multipart-manifest'"
op|':'
string|"'put'"
op|'}'
op|','
nl|'\n'
name|'hdrs'
op|'='
op|'{'
string|"'If-None-Match'"
op|':'
string|"'*'"
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'201'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ResponseError'
op|','
name|'file_item'
op|'.'
name|'write'
op|','
name|'manifest'
op|','
nl|'\n'
name|'parms'
op|'='
op|'{'
string|"'multipart-manifest'"
op|':'
string|"'put'"
op|'}'
op|','
nl|'\n'
name|'hdrs'
op|'='
op|'{'
string|"'If-None-Match'"
op|':'
string|"'*'"
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'412'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_slo_if_none_match_get
dedent|''
name|'def'
name|'test_slo_if_none_match_get'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'manifest'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
string|'"manifest-abcde"'
op|')'
newline|'\n'
name|'etag'
op|'='
name|'manifest'
op|'.'
name|'info'
op|'('
op|')'
op|'['
string|"'etag'"
op|']'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ResponseError'
op|','
name|'manifest'
op|'.'
name|'read'
op|','
nl|'\n'
name|'hdrs'
op|'='
op|'{'
string|"'If-None-Match'"
op|':'
name|'etag'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'304'
op|')'
newline|'\n'
nl|'\n'
name|'manifest'
op|'.'
name|'read'
op|'('
name|'hdrs'
op|'='
op|'{'
string|"'If-None-Match'"
op|':'
string|'"not-%s"'
op|'%'
name|'etag'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'200'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_slo_if_match_head
dedent|''
name|'def'
name|'test_slo_if_match_head'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'manifest'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
string|'"manifest-abcde"'
op|')'
newline|'\n'
name|'etag'
op|'='
name|'manifest'
op|'.'
name|'info'
op|'('
op|')'
op|'['
string|"'etag'"
op|']'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ResponseError'
op|','
name|'manifest'
op|'.'
name|'info'
op|','
nl|'\n'
name|'hdrs'
op|'='
op|'{'
string|"'If-Match'"
op|':'
string|"'not-%s'"
op|'%'
name|'etag'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'412'
op|')'
newline|'\n'
nl|'\n'
name|'manifest'
op|'.'
name|'info'
op|'('
name|'hdrs'
op|'='
op|'{'
string|"'If-Match'"
op|':'
name|'etag'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'200'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_slo_if_none_match_head
dedent|''
name|'def'
name|'test_slo_if_none_match_head'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'manifest'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
string|'"manifest-abcde"'
op|')'
newline|'\n'
name|'etag'
op|'='
name|'manifest'
op|'.'
name|'info'
op|'('
op|')'
op|'['
string|"'etag'"
op|']'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ResponseError'
op|','
name|'manifest'
op|'.'
name|'info'
op|','
nl|'\n'
name|'hdrs'
op|'='
op|'{'
string|"'If-None-Match'"
op|':'
name|'etag'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'304'
op|')'
newline|'\n'
nl|'\n'
name|'manifest'
op|'.'
name|'info'
op|'('
name|'hdrs'
op|'='
op|'{'
string|"'If-None-Match'"
op|':'
string|'"not-%s"'
op|'%'
name|'etag'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'200'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_slo_referer_on_segment_container
dedent|''
name|'def'
name|'test_slo_referer_on_segment_container'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# First the account2 (test3) should fail'
nl|'\n'
indent|'        '
name|'headers'
op|'='
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'self'
op|'.'
name|'env'
op|'.'
name|'conn3'
op|'.'
name|'storage_token'
op|','
nl|'\n'
string|"'Referer'"
op|':'
string|"'http://blah.example.com'"
op|'}'
newline|'\n'
name|'slo_file'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container2'
op|'.'
name|'file'
op|'('
string|"'manifest-abcde'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ResponseError'
op|','
name|'slo_file'
op|'.'
name|'read'
op|','
nl|'\n'
name|'hdrs'
op|'='
name|'headers'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'403'
op|')'
newline|'\n'
nl|'\n'
comment|'# Now set the referer on the slo container only'
nl|'\n'
name|'referer_metadata'
op|'='
op|'{'
string|"'X-Container-Read'"
op|':'
string|"'.r:*.example.com,.rlistings'"
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'env'
op|'.'
name|'container2'
op|'.'
name|'update_metadata'
op|'('
name|'referer_metadata'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ResponseError'
op|','
name|'slo_file'
op|'.'
name|'read'
op|','
nl|'\n'
name|'hdrs'
op|'='
name|'headers'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
number|'409'
op|')'
newline|'\n'
nl|'\n'
comment|'# Finally set the referer on the segment container'
nl|'\n'
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'update_metadata'
op|'('
name|'referer_metadata'
op|')'
newline|'\n'
name|'contents'
op|'='
name|'slo_file'
op|'.'
name|'read'
op|'('
name|'hdrs'
op|'='
name|'headers'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'4'
op|'*'
number|'1024'
op|'*'
number|'1024'
op|'+'
number|'1'
op|','
name|'len'
op|'('
name|'contents'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'a'"
op|','
name|'contents'
op|'['
number|'0'
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'a'"
op|','
name|'contents'
op|'['
number|'1024'
op|'*'
number|'1024'
op|'-'
number|'1'
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'b'"
op|','
name|'contents'
op|'['
number|'1024'
op|'*'
number|'1024'
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'d'"
op|','
name|'contents'
op|'['
op|'-'
number|'2'
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'e'"
op|','
name|'contents'
op|'['
op|'-'
number|'1'
op|']'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|TestSloUTF8
dedent|''
dedent|''
name|'class'
name|'TestSloUTF8'
op|'('
name|'Base2'
op|','
name|'TestSlo'
op|')'
op|':'
newline|'\n'
DECL|variable|set_up
indent|'    '
name|'set_up'
op|'='
name|'False'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|TestObjectVersioningEnv
dedent|''
name|'class'
name|'TestObjectVersioningEnv'
op|'('
name|'object'
op|')'
op|':'
newline|'\n'
DECL|variable|versioning_enabled
indent|'    '
name|'versioning_enabled'
op|'='
name|'None'
comment|'# tri-state: None initially, then True/False'
newline|'\n'
nl|'\n'
op|'@'
name|'classmethod'
newline|'\n'
DECL|member|setUp
name|'def'
name|'setUp'
op|'('
name|'cls'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'cls'
op|'.'
name|'conn'
op|'='
name|'Connection'
op|'('
name|'tf'
op|'.'
name|'config'
op|')'
newline|'\n'
name|'cls'
op|'.'
name|'storage_url'
op|','
name|'cls'
op|'.'
name|'storage_token'
op|'='
name|'cls'
op|'.'
name|'conn'
op|'.'
name|'authenticate'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'cls'
op|'.'
name|'account'
op|'='
name|'Account'
op|'('
name|'cls'
op|'.'
name|'conn'
op|','
name|'tf'
op|'.'
name|'config'
op|'.'
name|'get'
op|'('
string|"'account'"
op|','
nl|'\n'
name|'tf'
op|'.'
name|'config'
op|'['
string|"'username'"
op|']'
op|')'
op|')'
newline|'\n'
nl|'\n'
comment|'# Second connection for ACL tests'
nl|'\n'
name|'config2'
op|'='
name|'deepcopy'
op|'('
name|'tf'
op|'.'
name|'config'
op|')'
newline|'\n'
name|'config2'
op|'['
string|"'account'"
op|']'
op|'='
name|'tf'
op|'.'
name|'config'
op|'['
string|"'account2'"
op|']'
newline|'\n'
name|'config2'
op|'['
string|"'username'"
op|']'
op|'='
name|'tf'
op|'.'
name|'config'
op|'['
string|"'username2'"
op|']'
newline|'\n'
name|'config2'
op|'['
string|"'password'"
op|']'
op|'='
name|'tf'
op|'.'
name|'config'
op|'['
string|"'password2'"
op|']'
newline|'\n'
name|'cls'
op|'.'
name|'conn2'
op|'='
name|'Connection'
op|'('
name|'config2'
op|')'
newline|'\n'
name|'cls'
op|'.'
name|'conn2'
op|'.'
name|'authenticate'
op|'('
op|')'
newline|'\n'
nl|'\n'
comment|'# avoid getting a prefix that stops halfway through an encoded'
nl|'\n'
comment|'# character'
nl|'\n'
name|'prefix'
op|'='
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|'.'
name|'decode'
op|'('
string|'"utf-8"'
op|')'
op|'['
op|':'
number|'10'
op|']'
op|'.'
name|'encode'
op|'('
string|'"utf-8"'
op|')'
newline|'\n'
nl|'\n'
name|'cls'
op|'.'
name|'versions_container'
op|'='
name|'cls'
op|'.'
name|'account'
op|'.'
name|'container'
op|'('
name|'prefix'
op|'+'
string|'"-versions"'
op|')'
newline|'\n'
name|'if'
name|'not'
name|'cls'
op|'.'
name|'versions_container'
op|'.'
name|'create'
op|'('
op|')'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'ResponseError'
op|'('
name|'cls'
op|'.'
name|'conn'
op|'.'
name|'response'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'cls'
op|'.'
name|'container'
op|'='
name|'cls'
op|'.'
name|'account'
op|'.'
name|'container'
op|'('
name|'prefix'
op|'+'
string|'"-objs"'
op|')'
newline|'\n'
name|'if'
name|'not'
name|'cls'
op|'.'
name|'container'
op|'.'
name|'create'
op|'('
nl|'\n'
name|'hdrs'
op|'='
op|'{'
string|"'X-Versions-Location'"
op|':'
name|'cls'
op|'.'
name|'versions_container'
op|'.'
name|'name'
op|'}'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'cls'
op|'.'
name|'conn'
op|'.'
name|'response'
op|'.'
name|'status'
op|'=='
number|'412'
op|':'
newline|'\n'
indent|'                '
name|'cls'
op|'.'
name|'versioning_enabled'
op|'='
name|'False'
newline|'\n'
name|'return'
newline|'\n'
dedent|''
name|'raise'
name|'ResponseError'
op|'('
name|'cls'
op|'.'
name|'conn'
op|'.'
name|'response'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'container_info'
op|'='
name|'cls'
op|'.'
name|'container'
op|'.'
name|'info'
op|'('
op|')'
newline|'\n'
comment|"# if versioning is off, then X-Versions-Location won't persist"
nl|'\n'
name|'cls'
op|'.'
name|'versioning_enabled'
op|'='
string|"'versions'"
name|'in'
name|'container_info'
newline|'\n'
nl|'\n'
comment|'# setup another account to test ACLs'
nl|'\n'
name|'config2'
op|'='
name|'deepcopy'
op|'('
name|'tf'
op|'.'
name|'config'
op|')'
newline|'\n'
name|'config2'
op|'['
string|"'account'"
op|']'
op|'='
name|'tf'
op|'.'
name|'config'
op|'['
string|"'account2'"
op|']'
newline|'\n'
name|'config2'
op|'['
string|"'username'"
op|']'
op|'='
name|'tf'
op|'.'
name|'config'
op|'['
string|"'username2'"
op|']'
newline|'\n'
name|'config2'
op|'['
string|"'password'"
op|']'
op|'='
name|'tf'
op|'.'
name|'config'
op|'['
string|"'password2'"
op|']'
newline|'\n'
name|'cls'
op|'.'
name|'conn2'
op|'='
name|'Connection'
op|'('
name|'config2'
op|')'
newline|'\n'
name|'cls'
op|'.'
name|'storage_url2'
op|','
name|'cls'
op|'.'
name|'storage_token2'
op|'='
name|'cls'
op|'.'
name|'conn2'
op|'.'
name|'authenticate'
op|'('
op|')'
newline|'\n'
name|'cls'
op|'.'
name|'account2'
op|'='
name|'cls'
op|'.'
name|'conn2'
op|'.'
name|'get_account'
op|'('
op|')'
newline|'\n'
name|'cls'
op|'.'
name|'account2'
op|'.'
name|'delete_containers'
op|'('
op|')'
newline|'\n'
nl|'\n'
comment|'# setup another account with no access to anything to test ACLs'
nl|'\n'
name|'config3'
op|'='
name|'deepcopy'
op|'('
name|'tf'
op|'.'
name|'config'
op|')'
newline|'\n'
name|'config3'
op|'['
string|"'account'"
op|']'
op|'='
name|'tf'
op|'.'
name|'config'
op|'['
string|"'account'"
op|']'
newline|'\n'
name|'config3'
op|'['
string|"'username'"
op|']'
op|'='
name|'tf'
op|'.'
name|'config'
op|'['
string|"'username3'"
op|']'
newline|'\n'
name|'config3'
op|'['
string|"'password'"
op|']'
op|'='
name|'tf'
op|'.'
name|'config'
op|'['
string|"'password3'"
op|']'
newline|'\n'
name|'cls'
op|'.'
name|'conn3'
op|'='
name|'Connection'
op|'('
name|'config3'
op|')'
newline|'\n'
name|'cls'
op|'.'
name|'storage_url3'
op|','
name|'cls'
op|'.'
name|'storage_token3'
op|'='
name|'cls'
op|'.'
name|'conn3'
op|'.'
name|'authenticate'
op|'('
op|')'
newline|'\n'
name|'cls'
op|'.'
name|'account3'
op|'='
name|'cls'
op|'.'
name|'conn3'
op|'.'
name|'get_account'
op|'('
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'classmethod'
newline|'\n'
DECL|member|tearDown
name|'def'
name|'tearDown'
op|'('
name|'cls'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'cls'
op|'.'
name|'account'
op|'.'
name|'delete_containers'
op|'('
op|')'
newline|'\n'
name|'cls'
op|'.'
name|'account2'
op|'.'
name|'delete_containers'
op|'('
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|TestCrossPolicyObjectVersioningEnv
dedent|''
dedent|''
name|'class'
name|'TestCrossPolicyObjectVersioningEnv'
op|'('
name|'object'
op|')'
op|':'
newline|'\n'
comment|'# tri-state: None initially, then True/False'
nl|'\n'
DECL|variable|versioning_enabled
indent|'    '
name|'versioning_enabled'
op|'='
name|'None'
newline|'\n'
DECL|variable|multiple_policies_enabled
name|'multiple_policies_enabled'
op|'='
name|'None'
newline|'\n'
DECL|variable|policies
name|'policies'
op|'='
name|'None'
newline|'\n'
nl|'\n'
op|'@'
name|'classmethod'
newline|'\n'
DECL|member|setUp
name|'def'
name|'setUp'
op|'('
name|'cls'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'cls'
op|'.'
name|'conn'
op|'='
name|'Connection'
op|'('
name|'tf'
op|'.'
name|'config'
op|')'
newline|'\n'
name|'cls'
op|'.'
name|'conn'
op|'.'
name|'authenticate'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'if'
name|'cls'
op|'.'
name|'multiple_policies_enabled'
name|'is'
name|'None'
op|':'
newline|'\n'
indent|'            '
name|'try'
op|':'
newline|'\n'
indent|'                '
name|'cls'
op|'.'
name|'policies'
op|'='
name|'tf'
op|'.'
name|'FunctionalStoragePolicyCollection'
op|'.'
name|'from_info'
op|'('
op|')'
newline|'\n'
dedent|''
name|'except'
name|'AssertionError'
op|':'
newline|'\n'
indent|'                '
name|'pass'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'if'
name|'cls'
op|'.'
name|'policies'
name|'and'
name|'len'
op|'('
name|'cls'
op|'.'
name|'policies'
op|')'
op|'>'
number|'1'
op|':'
newline|'\n'
indent|'            '
name|'cls'
op|'.'
name|'multiple_policies_enabled'
op|'='
name|'True'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'cls'
op|'.'
name|'multiple_policies_enabled'
op|'='
name|'False'
newline|'\n'
name|'cls'
op|'.'
name|'versioning_enabled'
op|'='
name|'True'
newline|'\n'
comment|"# We don't actually know the state of versioning, but without"
nl|'\n'
comment|'# multiple policies the tests should be skipped anyway. Claiming'
nl|'\n'
comment|'# versioning support lets us report the right reason for skipping.'
nl|'\n'
name|'return'
newline|'\n'
nl|'\n'
dedent|''
name|'policy'
op|'='
name|'cls'
op|'.'
name|'policies'
op|'.'
name|'select'
op|'('
op|')'
newline|'\n'
name|'version_policy'
op|'='
name|'cls'
op|'.'
name|'policies'
op|'.'
name|'exclude'
op|'('
name|'name'
op|'='
name|'policy'
op|'['
string|"'name'"
op|']'
op|')'
op|'.'
name|'select'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'cls'
op|'.'
name|'account'
op|'='
name|'Account'
op|'('
name|'cls'
op|'.'
name|'conn'
op|','
name|'tf'
op|'.'
name|'config'
op|'.'
name|'get'
op|'('
string|"'account'"
op|','
nl|'\n'
name|'tf'
op|'.'
name|'config'
op|'['
string|"'username'"
op|']'
op|')'
op|')'
newline|'\n'
nl|'\n'
comment|'# Second connection for ACL tests'
nl|'\n'
name|'config2'
op|'='
name|'deepcopy'
op|'('
name|'tf'
op|'.'
name|'config'
op|')'
newline|'\n'
name|'config2'
op|'['
string|"'account'"
op|']'
op|'='
name|'tf'
op|'.'
name|'config'
op|'['
string|"'account2'"
op|']'
newline|'\n'
name|'config2'
op|'['
string|"'username'"
op|']'
op|'='
name|'tf'
op|'.'
name|'config'
op|'['
string|"'username2'"
op|']'
newline|'\n'
name|'config2'
op|'['
string|"'password'"
op|']'
op|'='
name|'tf'
op|'.'
name|'config'
op|'['
string|"'password2'"
op|']'
newline|'\n'
name|'cls'
op|'.'
name|'conn2'
op|'='
name|'Connection'
op|'('
name|'config2'
op|')'
newline|'\n'
name|'cls'
op|'.'
name|'conn2'
op|'.'
name|'authenticate'
op|'('
op|')'
newline|'\n'
nl|'\n'
comment|'# avoid getting a prefix that stops halfway through an encoded'
nl|'\n'
comment|'# character'
nl|'\n'
name|'prefix'
op|'='
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|'.'
name|'decode'
op|'('
string|'"utf-8"'
op|')'
op|'['
op|':'
number|'10'
op|']'
op|'.'
name|'encode'
op|'('
string|'"utf-8"'
op|')'
newline|'\n'
nl|'\n'
name|'cls'
op|'.'
name|'versions_container'
op|'='
name|'cls'
op|'.'
name|'account'
op|'.'
name|'container'
op|'('
name|'prefix'
op|'+'
string|'"-versions"'
op|')'
newline|'\n'
name|'if'
name|'not'
name|'cls'
op|'.'
name|'versions_container'
op|'.'
name|'create'
op|'('
nl|'\n'
op|'{'
string|"'X-Storage-Policy'"
op|':'
name|'policy'
op|'['
string|"'name'"
op|']'
op|'}'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'ResponseError'
op|'('
name|'cls'
op|'.'
name|'conn'
op|'.'
name|'response'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'cls'
op|'.'
name|'container'
op|'='
name|'cls'
op|'.'
name|'account'
op|'.'
name|'container'
op|'('
name|'prefix'
op|'+'
string|'"-objs"'
op|')'
newline|'\n'
name|'if'
name|'not'
name|'cls'
op|'.'
name|'container'
op|'.'
name|'create'
op|'('
nl|'\n'
name|'hdrs'
op|'='
op|'{'
string|"'X-Versions-Location'"
op|':'
name|'cls'
op|'.'
name|'versions_container'
op|'.'
name|'name'
op|','
nl|'\n'
string|"'X-Storage-Policy'"
op|':'
name|'version_policy'
op|'['
string|"'name'"
op|']'
op|'}'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'cls'
op|'.'
name|'conn'
op|'.'
name|'response'
op|'.'
name|'status'
op|'=='
number|'412'
op|':'
newline|'\n'
indent|'                '
name|'cls'
op|'.'
name|'versioning_enabled'
op|'='
name|'False'
newline|'\n'
name|'return'
newline|'\n'
dedent|''
name|'raise'
name|'ResponseError'
op|'('
name|'cls'
op|'.'
name|'conn'
op|'.'
name|'response'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'container_info'
op|'='
name|'cls'
op|'.'
name|'container'
op|'.'
name|'info'
op|'('
op|')'
newline|'\n'
comment|"# if versioning is off, then X-Versions-Location won't persist"
nl|'\n'
name|'cls'
op|'.'
name|'versioning_enabled'
op|'='
string|"'versions'"
name|'in'
name|'container_info'
newline|'\n'
nl|'\n'
comment|'# setup another account to test ACLs'
nl|'\n'
name|'config2'
op|'='
name|'deepcopy'
op|'('
name|'tf'
op|'.'
name|'config'
op|')'
newline|'\n'
name|'config2'
op|'['
string|"'account'"
op|']'
op|'='
name|'tf'
op|'.'
name|'config'
op|'['
string|"'account2'"
op|']'
newline|'\n'
name|'config2'
op|'['
string|"'username'"
op|']'
op|'='
name|'tf'
op|'.'
name|'config'
op|'['
string|"'username2'"
op|']'
newline|'\n'
name|'config2'
op|'['
string|"'password'"
op|']'
op|'='
name|'tf'
op|'.'
name|'config'
op|'['
string|"'password2'"
op|']'
newline|'\n'
name|'cls'
op|'.'
name|'conn2'
op|'='
name|'Connection'
op|'('
name|'config2'
op|')'
newline|'\n'
name|'cls'
op|'.'
name|'storage_url2'
op|','
name|'cls'
op|'.'
name|'storage_token2'
op|'='
name|'cls'
op|'.'
name|'conn2'
op|'.'
name|'authenticate'
op|'('
op|')'
newline|'\n'
name|'cls'
op|'.'
name|'account2'
op|'='
name|'cls'
op|'.'
name|'conn2'
op|'.'
name|'get_account'
op|'('
op|')'
newline|'\n'
name|'cls'
op|'.'
name|'account2'
op|'.'
name|'delete_containers'
op|'('
op|')'
newline|'\n'
nl|'\n'
comment|'# setup another account with no access to anything to test ACLs'
nl|'\n'
name|'config3'
op|'='
name|'deepcopy'
op|'('
name|'tf'
op|'.'
name|'config'
op|')'
newline|'\n'
name|'config3'
op|'['
string|"'account'"
op|']'
op|'='
name|'tf'
op|'.'
name|'config'
op|'['
string|"'account'"
op|']'
newline|'\n'
name|'config3'
op|'['
string|"'username'"
op|']'
op|'='
name|'tf'
op|'.'
name|'config'
op|'['
string|"'username3'"
op|']'
newline|'\n'
name|'config3'
op|'['
string|"'password'"
op|']'
op|'='
name|'tf'
op|'.'
name|'config'
op|'['
string|"'password3'"
op|']'
newline|'\n'
name|'cls'
op|'.'
name|'conn3'
op|'='
name|'Connection'
op|'('
name|'config3'
op|')'
newline|'\n'
name|'cls'
op|'.'
name|'storage_url3'
op|','
name|'cls'
op|'.'
name|'storage_token3'
op|'='
name|'cls'
op|'.'
name|'conn3'
op|'.'
name|'authenticate'
op|'('
op|')'
newline|'\n'
name|'cls'
op|'.'
name|'account3'
op|'='
name|'cls'
op|'.'
name|'conn3'
op|'.'
name|'get_account'
op|'('
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'classmethod'
newline|'\n'
DECL|member|tearDown
name|'def'
name|'tearDown'
op|'('
name|'cls'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'cls'
op|'.'
name|'account'
op|'.'
name|'delete_containers'
op|'('
op|')'
newline|'\n'
name|'cls'
op|'.'
name|'account2'
op|'.'
name|'delete_containers'
op|'('
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|TestObjectVersioning
dedent|''
dedent|''
name|'class'
name|'TestObjectVersioning'
op|'('
name|'Base'
op|')'
op|':'
newline|'\n'
DECL|variable|env
indent|'    '
name|'env'
op|'='
name|'TestObjectVersioningEnv'
newline|'\n'
DECL|variable|set_up
name|'set_up'
op|'='
name|'False'
newline|'\n'
nl|'\n'
DECL|member|setUp
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'super'
op|'('
name|'TestObjectVersioning'
op|','
name|'self'
op|')'
op|'.'
name|'setUp'
op|'('
op|')'
newline|'\n'
name|'if'
name|'self'
op|'.'
name|'env'
op|'.'
name|'versioning_enabled'
name|'is'
name|'False'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'SkipTest'
op|'('
string|'"Object versioning not enabled"'
op|')'
newline|'\n'
dedent|''
name|'elif'
name|'self'
op|'.'
name|'env'
op|'.'
name|'versioning_enabled'
name|'is'
name|'not'
name|'True'
op|':'
newline|'\n'
comment|'# just some sanity checking'
nl|'\n'
indent|'            '
name|'raise'
name|'Exception'
op|'('
nl|'\n'
string|'"Expected versioning_enabled to be True/False, got %r"'
op|'%'
nl|'\n'
op|'('
name|'self'
op|'.'
name|'env'
op|'.'
name|'versioning_enabled'
op|','
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_tear_down_files
dedent|''
dedent|''
name|'def'
name|'_tear_down_files'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'try'
op|':'
newline|'\n'
comment|'# only delete files and not containers'
nl|'\n'
comment|'# as they were configured in self.env'
nl|'\n'
indent|'            '
name|'self'
op|'.'
name|'env'
op|'.'
name|'versions_container'
op|'.'
name|'delete_files'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'delete_files'
op|'('
op|')'
newline|'\n'
dedent|''
name|'except'
name|'ResponseError'
op|':'
newline|'\n'
indent|'            '
name|'pass'
newline|'\n'
nl|'\n'
DECL|member|tearDown
dedent|''
dedent|''
name|'def'
name|'tearDown'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'super'
op|'('
name|'TestObjectVersioning'
op|','
name|'self'
op|')'
op|'.'
name|'tearDown'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_tear_down_files'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_clear_version_option
dedent|''
name|'def'
name|'test_clear_version_option'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# sanity'
nl|'\n'
indent|'        '
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'info'
op|'('
op|')'
op|'['
string|"'versions'"
op|']'
op|','
nl|'\n'
name|'self'
op|'.'
name|'env'
op|'.'
name|'versions_container'
op|'.'
name|'name'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'update_metadata'
op|'('
nl|'\n'
name|'hdrs'
op|'='
op|'{'
string|"'X-Versions-Location'"
op|':'
string|"''"
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'info'
op|'('
op|')'
op|'.'
name|'get'
op|'('
string|"'versions'"
op|')'
op|','
name|'None'
op|')'
newline|'\n'
nl|'\n'
comment|'# set location back to the way it was'
nl|'\n'
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'update_metadata'
op|'('
nl|'\n'
name|'hdrs'
op|'='
op|'{'
string|"'X-Versions-Location'"
op|':'
name|'self'
op|'.'
name|'env'
op|'.'
name|'versions_container'
op|'.'
name|'name'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'info'
op|'('
op|')'
op|'['
string|"'versions'"
op|']'
op|','
nl|'\n'
name|'self'
op|'.'
name|'env'
op|'.'
name|'versions_container'
op|'.'
name|'name'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_overwriting
dedent|''
name|'def'
name|'test_overwriting'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'container'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
newline|'\n'
name|'versions_container'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'versions_container'
newline|'\n'
name|'cont_info'
op|'='
name|'container'
op|'.'
name|'info'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'cont_info'
op|'['
string|"'versions'"
op|']'
op|','
name|'versions_container'
op|'.'
name|'name'
op|')'
newline|'\n'
nl|'\n'
name|'obj_name'
op|'='
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'versioned_obj'
op|'='
name|'container'
op|'.'
name|'file'
op|'('
name|'obj_name'
op|')'
newline|'\n'
name|'put_headers'
op|'='
op|'{'
string|"'Content-Type'"
op|':'
string|"'text/jibberish01'"
op|','
nl|'\n'
string|"'Content-Encoding'"
op|':'
string|"'gzip'"
op|','
nl|'\n'
string|"'Content-Disposition'"
op|':'
string|"'attachment; filename=myfile'"
op|'}'
newline|'\n'
name|'versioned_obj'
op|'.'
name|'write'
op|'('
string|'"aaaaa"'
op|','
name|'hdrs'
op|'='
name|'put_headers'
op|')'
newline|'\n'
name|'obj_info'
op|'='
name|'versioned_obj'
op|'.'
name|'info'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'text/jibberish01'"
op|','
name|'obj_info'
op|'['
string|"'content_type'"
op|']'
op|')'
newline|'\n'
nl|'\n'
comment|'# the allowed headers are configurable in object server, so we cannot'
nl|'\n'
comment|'# assert that content-encoding or content-disposition get *copied* to'
nl|'\n'
comment|'# the object version unless they were set on the original PUT, so'
nl|'\n'
comment|'# populate expected_headers by making a HEAD on the original object'
nl|'\n'
name|'resp_headers'
op|'='
name|'dict'
op|'('
name|'versioned_obj'
op|'.'
name|'conn'
op|'.'
name|'response'
op|'.'
name|'getheaders'
op|'('
op|')'
op|')'
newline|'\n'
name|'expected_headers'
op|'='
op|'{'
op|'}'
newline|'\n'
name|'for'
name|'k'
op|','
name|'v'
name|'in'
name|'put_headers'
op|'.'
name|'items'
op|'('
op|')'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'k'
op|'.'
name|'lower'
op|'('
op|')'
name|'in'
name|'resp_headers'
op|':'
newline|'\n'
indent|'                '
name|'expected_headers'
op|'['
name|'k'
op|']'
op|'='
name|'v'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'0'
op|','
name|'versions_container'
op|'.'
name|'info'
op|'('
op|')'
op|'['
string|"'object_count'"
op|']'
op|')'
newline|'\n'
name|'versioned_obj'
op|'.'
name|'write'
op|'('
string|'"bbbbb"'
op|','
name|'hdrs'
op|'='
op|'{'
string|"'Content-Type'"
op|':'
string|"'text/jibberish02'"
op|','
nl|'\n'
string|"'X-Object-Meta-Foo'"
op|':'
string|"'Bar'"
op|'}'
op|')'
newline|'\n'
name|'versioned_obj'
op|'.'
name|'initialize'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'versioned_obj'
op|'.'
name|'content_type'
op|','
string|"'text/jibberish02'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'versioned_obj'
op|'.'
name|'metadata'
op|'['
string|"'foo'"
op|']'
op|','
string|"'Bar'"
op|')'
newline|'\n'
nl|'\n'
comment|'# the old version got saved off'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'1'
op|','
name|'versions_container'
op|'.'
name|'info'
op|'('
op|')'
op|'['
string|"'object_count'"
op|']'
op|')'
newline|'\n'
name|'versioned_obj_name'
op|'='
name|'versions_container'
op|'.'
name|'files'
op|'('
op|')'
op|'['
number|'0'
op|']'
newline|'\n'
name|'prev_version'
op|'='
name|'versions_container'
op|'.'
name|'file'
op|'('
name|'versioned_obj_name'
op|')'
newline|'\n'
name|'prev_version'
op|'.'
name|'initialize'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|'"aaaaa"'
op|','
name|'prev_version'
op|'.'
name|'read'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'prev_version'
op|'.'
name|'content_type'
op|','
string|"'text/jibberish01'"
op|')'
newline|'\n'
nl|'\n'
name|'resp_headers'
op|'='
name|'dict'
op|'('
name|'prev_version'
op|'.'
name|'conn'
op|'.'
name|'response'
op|'.'
name|'getheaders'
op|'('
op|')'
op|')'
newline|'\n'
name|'for'
name|'k'
op|','
name|'v'
name|'in'
name|'expected_headers'
op|'.'
name|'items'
op|'('
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertIn'
op|'('
name|'k'
op|'.'
name|'lower'
op|'('
op|')'
op|','
name|'resp_headers'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'v'
op|','
name|'resp_headers'
op|'['
name|'k'
op|'.'
name|'lower'
op|'('
op|')'
op|']'
op|')'
newline|'\n'
nl|'\n'
comment|'# make sure the new obj metadata did not leak to the prev. version'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'assertTrue'
op|'('
string|"'foo'"
name|'not'
name|'in'
name|'prev_version'
op|'.'
name|'metadata'
op|')'
newline|'\n'
nl|'\n'
comment|'# check that POST does not create a new version'
nl|'\n'
name|'versioned_obj'
op|'.'
name|'sync_metadata'
op|'('
name|'metadata'
op|'='
op|'{'
string|"'fu'"
op|':'
string|"'baz'"
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'1'
op|','
name|'versions_container'
op|'.'
name|'info'
op|'('
op|')'
op|'['
string|"'object_count'"
op|']'
op|')'
newline|'\n'
nl|'\n'
comment|'# if we overwrite it again, there are two versions'
nl|'\n'
name|'versioned_obj'
op|'.'
name|'write'
op|'('
string|'"ccccc"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'2'
op|','
name|'versions_container'
op|'.'
name|'info'
op|'('
op|')'
op|'['
string|"'object_count'"
op|']'
op|')'
newline|'\n'
name|'versioned_obj_name'
op|'='
name|'versions_container'
op|'.'
name|'files'
op|'('
op|')'
op|'['
number|'1'
op|']'
newline|'\n'
name|'prev_version'
op|'='
name|'versions_container'
op|'.'
name|'file'
op|'('
name|'versioned_obj_name'
op|')'
newline|'\n'
name|'prev_version'
op|'.'
name|'initialize'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|'"bbbbb"'
op|','
name|'prev_version'
op|'.'
name|'read'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'prev_version'
op|'.'
name|'content_type'
op|','
string|"'text/jibberish02'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
string|"'foo'"
name|'in'
name|'prev_version'
op|'.'
name|'metadata'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
string|"'fu'"
name|'in'
name|'prev_version'
op|'.'
name|'metadata'
op|')'
newline|'\n'
nl|'\n'
comment|'# as we delete things, the old contents return'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|'"ccccc"'
op|','
name|'versioned_obj'
op|'.'
name|'read'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
comment|'# test copy from a different container'
nl|'\n'
name|'src_container'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'account'
op|'.'
name|'container'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'src_container'
op|'.'
name|'create'
op|'('
op|')'
op|')'
newline|'\n'
name|'src_name'
op|'='
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
newline|'\n'
name|'src_obj'
op|'='
name|'src_container'
op|'.'
name|'file'
op|'('
name|'src_name'
op|')'
newline|'\n'
name|'src_obj'
op|'.'
name|'write'
op|'('
string|'"ddddd"'
op|','
name|'hdrs'
op|'='
op|'{'
string|"'Content-Type'"
op|':'
string|"'text/jibberish04'"
op|'}'
op|')'
newline|'\n'
name|'src_obj'
op|'.'
name|'copy'
op|'('
name|'container'
op|'.'
name|'name'
op|','
name|'obj_name'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|'"ddddd"'
op|','
name|'versioned_obj'
op|'.'
name|'read'
op|'('
op|')'
op|')'
newline|'\n'
name|'versioned_obj'
op|'.'
name|'initialize'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'versioned_obj'
op|'.'
name|'content_type'
op|','
string|"'text/jibberish04'"
op|')'
newline|'\n'
nl|'\n'
comment|'# make sure versions container has the previous version'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'3'
op|','
name|'versions_container'
op|'.'
name|'info'
op|'('
op|')'
op|'['
string|"'object_count'"
op|']'
op|')'
newline|'\n'
name|'versioned_obj_name'
op|'='
name|'versions_container'
op|'.'
name|'files'
op|'('
op|')'
op|'['
number|'2'
op|']'
newline|'\n'
name|'prev_version'
op|'='
name|'versions_container'
op|'.'
name|'file'
op|'('
name|'versioned_obj_name'
op|')'
newline|'\n'
name|'prev_version'
op|'.'
name|'initialize'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|'"ccccc"'
op|','
name|'prev_version'
op|'.'
name|'read'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
comment|'# test delete'
nl|'\n'
name|'versioned_obj'
op|'.'
name|'delete'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|'"ccccc"'
op|','
name|'versioned_obj'
op|'.'
name|'read'
op|'('
op|')'
op|')'
newline|'\n'
name|'versioned_obj'
op|'.'
name|'delete'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|'"bbbbb"'
op|','
name|'versioned_obj'
op|'.'
name|'read'
op|'('
op|')'
op|')'
newline|'\n'
name|'versioned_obj'
op|'.'
name|'delete'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|'"aaaaa"'
op|','
name|'versioned_obj'
op|'.'
name|'read'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'0'
op|','
name|'versions_container'
op|'.'
name|'info'
op|'('
op|')'
op|'['
string|"'object_count'"
op|']'
op|')'
newline|'\n'
nl|'\n'
comment|'# verify that all the original object headers have been copied back'
nl|'\n'
name|'obj_info'
op|'='
name|'versioned_obj'
op|'.'
name|'info'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'text/jibberish01'"
op|','
name|'obj_info'
op|'['
string|"'content_type'"
op|']'
op|')'
newline|'\n'
name|'resp_headers'
op|'='
name|'dict'
op|'('
name|'versioned_obj'
op|'.'
name|'conn'
op|'.'
name|'response'
op|'.'
name|'getheaders'
op|'('
op|')'
op|')'
newline|'\n'
name|'for'
name|'k'
op|','
name|'v'
name|'in'
name|'expected_headers'
op|'.'
name|'items'
op|'('
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertIn'
op|'('
name|'k'
op|'.'
name|'lower'
op|'('
op|')'
op|','
name|'resp_headers'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'v'
op|','
name|'resp_headers'
op|'['
name|'k'
op|'.'
name|'lower'
op|'('
op|')'
op|']'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'versioned_obj'
op|'.'
name|'delete'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ResponseError'
op|','
name|'versioned_obj'
op|'.'
name|'read'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_versioning_dlo
dedent|''
name|'def'
name|'test_versioning_dlo'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'container'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
newline|'\n'
name|'versions_container'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'versions_container'
newline|'\n'
name|'obj_name'
op|'='
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'for'
name|'i'
name|'in'
op|'('
string|"'1'"
op|','
string|"'2'"
op|','
string|"'3'"
op|')'
op|':'
newline|'\n'
indent|'            '
name|'time'
op|'.'
name|'sleep'
op|'('
number|'.01'
op|')'
comment|'# guarantee that the timestamp changes'
newline|'\n'
name|'obj_name_seg'
op|'='
name|'obj_name'
op|'+'
string|"'/'"
op|'+'
name|'i'
newline|'\n'
name|'versioned_obj'
op|'='
name|'container'
op|'.'
name|'file'
op|'('
name|'obj_name_seg'
op|')'
newline|'\n'
name|'versioned_obj'
op|'.'
name|'write'
op|'('
name|'i'
op|')'
newline|'\n'
name|'versioned_obj'
op|'.'
name|'write'
op|'('
name|'i'
op|'+'
name|'i'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'3'
op|','
name|'versions_container'
op|'.'
name|'info'
op|'('
op|')'
op|'['
string|"'object_count'"
op|']'
op|')'
newline|'\n'
nl|'\n'
name|'man_file'
op|'='
name|'container'
op|'.'
name|'file'
op|'('
name|'obj_name'
op|')'
newline|'\n'
name|'man_file'
op|'.'
name|'write'
op|'('
string|"''"
op|','
name|'hdrs'
op|'='
op|'{'
string|'"X-Object-Manifest"'
op|':'
string|'"%s/%s/"'
op|'%'
nl|'\n'
op|'('
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'name'
op|','
name|'obj_name'
op|')'
op|'}'
op|')'
newline|'\n'
nl|'\n'
comment|'# guarantee that the timestamp changes'
nl|'\n'
name|'time'
op|'.'
name|'sleep'
op|'('
number|'.01'
op|')'
newline|'\n'
nl|'\n'
comment|'# write manifest file again'
nl|'\n'
name|'man_file'
op|'.'
name|'write'
op|'('
string|"''"
op|','
name|'hdrs'
op|'='
op|'{'
string|'"X-Object-Manifest"'
op|':'
string|'"%s/%s/"'
op|'%'
nl|'\n'
op|'('
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'name'
op|','
name|'obj_name'
op|')'
op|'}'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'3'
op|','
name|'versions_container'
op|'.'
name|'info'
op|'('
op|')'
op|'['
string|"'object_count'"
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|'"112233"'
op|','
name|'man_file'
op|'.'
name|'read'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_versioning_container_acl
dedent|''
name|'def'
name|'test_versioning_container_acl'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# create versions container and DO NOT give write access to account2'
nl|'\n'
indent|'        '
name|'versions_container'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'account'
op|'.'
name|'container'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'versions_container'
op|'.'
name|'create'
op|'('
name|'hdrs'
op|'='
op|'{'
nl|'\n'
string|"'X-Container-Write'"
op|':'
string|"''"
nl|'\n'
op|'}'
op|')'
op|')'
newline|'\n'
nl|'\n'
comment|'# check account2 cannot write to versions container'
nl|'\n'
name|'fail_obj_name'
op|'='
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
newline|'\n'
name|'fail_obj'
op|'='
name|'versions_container'
op|'.'
name|'file'
op|'('
name|'fail_obj_name'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ResponseError'
op|','
name|'fail_obj'
op|'.'
name|'write'
op|','
string|'"should fail"'
op|','
nl|'\n'
name|'cfg'
op|'='
op|'{'
string|"'use_token'"
op|':'
name|'self'
op|'.'
name|'env'
op|'.'
name|'storage_token2'
op|'}'
op|')'
newline|'\n'
nl|'\n'
comment|'# create container and give write access to account2'
nl|'\n'
comment|"# don't set X-Versions-Location just yet"
nl|'\n'
name|'container'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'account'
op|'.'
name|'container'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'container'
op|'.'
name|'create'
op|'('
name|'hdrs'
op|'='
op|'{'
nl|'\n'
string|"'X-Container-Write'"
op|':'
name|'self'
op|'.'
name|'env'
op|'.'
name|'conn2'
op|'.'
name|'user_acl'
op|'}'
op|')'
op|')'
newline|'\n'
nl|'\n'
comment|'# check account2 cannot set X-Versions-Location on container'
nl|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ResponseError'
op|','
name|'container'
op|'.'
name|'update_metadata'
op|','
name|'hdrs'
op|'='
op|'{'
nl|'\n'
string|"'X-Versions-Location'"
op|':'
name|'versions_container'
op|'}'
op|','
nl|'\n'
name|'cfg'
op|'='
op|'{'
string|"'use_token'"
op|':'
name|'self'
op|'.'
name|'env'
op|'.'
name|'storage_token2'
op|'}'
op|')'
newline|'\n'
nl|'\n'
comment|'# good! now let admin set the X-Versions-Location'
nl|'\n'
comment|"# p.s.: sticking a 'x-remove' header here to test precedence"
nl|'\n'
comment|'# of both headers. Setting the location should succeed.'
nl|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'container'
op|'.'
name|'update_metadata'
op|'('
name|'hdrs'
op|'='
op|'{'
nl|'\n'
string|"'X-Remove-Versions-Location'"
op|':'
name|'versions_container'
op|','
nl|'\n'
string|"'X-Versions-Location'"
op|':'
name|'versions_container'
op|'}'
op|')'
op|')'
newline|'\n'
nl|'\n'
comment|'# write object twice to container and check version'
nl|'\n'
name|'obj_name'
op|'='
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
newline|'\n'
name|'versioned_obj'
op|'='
name|'container'
op|'.'
name|'file'
op|'('
name|'obj_name'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'versioned_obj'
op|'.'
name|'write'
op|'('
string|'"never argue with the data"'
op|','
nl|'\n'
name|'cfg'
op|'='
op|'{'
string|"'use_token'"
op|':'
name|'self'
op|'.'
name|'env'
op|'.'
name|'storage_token2'
op|'}'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'versioned_obj'
op|'.'
name|'read'
op|'('
op|')'
op|','
string|'"never argue with the data"'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
nl|'\n'
name|'versioned_obj'
op|'.'
name|'write'
op|'('
string|'"we don\'t have no beer, just tequila"'
op|','
nl|'\n'
name|'cfg'
op|'='
op|'{'
string|"'use_token'"
op|':'
name|'self'
op|'.'
name|'env'
op|'.'
name|'storage_token2'
op|'}'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'versioned_obj'
op|'.'
name|'read'
op|'('
op|')'
op|','
nl|'\n'
string|'"we don\'t have no beer, just tequila"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'1'
op|','
name|'versions_container'
op|'.'
name|'info'
op|'('
op|')'
op|'['
string|"'object_count'"
op|']'
op|')'
newline|'\n'
nl|'\n'
comment|'# read the original uploaded object'
nl|'\n'
name|'for'
name|'filename'
name|'in'
name|'versions_container'
op|'.'
name|'files'
op|'('
op|')'
op|':'
newline|'\n'
indent|'            '
name|'backup_file'
op|'='
name|'versions_container'
op|'.'
name|'file'
op|'('
name|'filename'
op|')'
newline|'\n'
name|'break'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'backup_file'
op|'.'
name|'read'
op|'('
op|')'
op|','
string|'"never argue with the data"'
op|')'
newline|'\n'
nl|'\n'
comment|'# user3 (some random user with no access to anything)'
nl|'\n'
comment|'# tries to read from versioned container'
nl|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ResponseError'
op|','
name|'backup_file'
op|'.'
name|'read'
op|','
nl|'\n'
name|'cfg'
op|'='
op|'{'
string|"'use_token'"
op|':'
name|'self'
op|'.'
name|'env'
op|'.'
name|'storage_token3'
op|'}'
op|')'
newline|'\n'
nl|'\n'
comment|'# user3 cannot write or delete from source container either'
nl|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ResponseError'
op|','
name|'versioned_obj'
op|'.'
name|'write'
op|','
nl|'\n'
string|'"some random user trying to write data"'
op|','
nl|'\n'
name|'cfg'
op|'='
op|'{'
string|"'use_token'"
op|':'
name|'self'
op|'.'
name|'env'
op|'.'
name|'storage_token3'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ResponseError'
op|','
name|'versioned_obj'
op|'.'
name|'delete'
op|','
nl|'\n'
name|'cfg'
op|'='
op|'{'
string|"'use_token'"
op|':'
name|'self'
op|'.'
name|'env'
op|'.'
name|'storage_token3'
op|'}'
op|')'
newline|'\n'
nl|'\n'
comment|"# user2 can't read or delete from versions-location"
nl|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ResponseError'
op|','
name|'backup_file'
op|'.'
name|'read'
op|','
nl|'\n'
name|'cfg'
op|'='
op|'{'
string|"'use_token'"
op|':'
name|'self'
op|'.'
name|'env'
op|'.'
name|'storage_token2'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ResponseError'
op|','
name|'backup_file'
op|'.'
name|'delete'
op|','
nl|'\n'
name|'cfg'
op|'='
op|'{'
string|"'use_token'"
op|':'
name|'self'
op|'.'
name|'env'
op|'.'
name|'storage_token2'
op|'}'
op|')'
newline|'\n'
nl|'\n'
comment|'# but is able to delete from the source container'
nl|'\n'
comment|'# this could be a helpful scenario for dev ops that want to setup'
nl|'\n'
comment|'# just one container to hold object versions of multiple containers'
nl|'\n'
comment|'# and each one of those containers are owned by different users'
nl|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'versioned_obj'
op|'.'
name|'delete'
op|'('
nl|'\n'
name|'cfg'
op|'='
op|'{'
string|"'use_token'"
op|':'
name|'self'
op|'.'
name|'env'
op|'.'
name|'storage_token2'
op|'}'
op|')'
op|')'
newline|'\n'
nl|'\n'
comment|'# tear-down since we create these containers here'
nl|'\n'
comment|'# and not in self.env'
nl|'\n'
name|'versions_container'
op|'.'
name|'delete_recursive'
op|'('
op|')'
newline|'\n'
name|'container'
op|'.'
name|'delete_recursive'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_versioning_check_acl
dedent|''
name|'def'
name|'test_versioning_check_acl'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'container'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
newline|'\n'
name|'versions_container'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'versions_container'
newline|'\n'
name|'versions_container'
op|'.'
name|'create'
op|'('
name|'hdrs'
op|'='
op|'{'
string|"'X-Container-Read'"
op|':'
string|"'.r:*,.rlistings'"
op|'}'
op|')'
newline|'\n'
nl|'\n'
name|'obj_name'
op|'='
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
newline|'\n'
name|'versioned_obj'
op|'='
name|'container'
op|'.'
name|'file'
op|'('
name|'obj_name'
op|')'
newline|'\n'
name|'versioned_obj'
op|'.'
name|'write'
op|'('
string|'"aaaaa"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|'"aaaaa"'
op|','
name|'versioned_obj'
op|'.'
name|'read'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'versioned_obj'
op|'.'
name|'write'
op|'('
string|'"bbbbb"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|'"bbbbb"'
op|','
name|'versioned_obj'
op|'.'
name|'read'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
comment|'# Use token from second account and try to delete the object'
nl|'\n'
name|'org_token'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'account'
op|'.'
name|'conn'
op|'.'
name|'storage_token'
newline|'\n'
name|'self'
op|'.'
name|'env'
op|'.'
name|'account'
op|'.'
name|'conn'
op|'.'
name|'storage_token'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'conn2'
op|'.'
name|'storage_token'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ResponseError'
op|','
name|'versioned_obj'
op|'.'
name|'delete'
op|')'
newline|'\n'
dedent|''
name|'finally'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'env'
op|'.'
name|'account'
op|'.'
name|'conn'
op|'.'
name|'storage_token'
op|'='
name|'org_token'
newline|'\n'
nl|'\n'
comment|'# Verify with token from first account'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|'"bbbbb"'
op|','
name|'versioned_obj'
op|'.'
name|'read'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'versioned_obj'
op|'.'
name|'delete'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|'"aaaaa"'
op|','
name|'versioned_obj'
op|'.'
name|'read'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|TestObjectVersioningUTF8
dedent|''
dedent|''
name|'class'
name|'TestObjectVersioningUTF8'
op|'('
name|'Base2'
op|','
name|'TestObjectVersioning'
op|')'
op|':'
newline|'\n'
DECL|variable|set_up
indent|'    '
name|'set_up'
op|'='
name|'False'
newline|'\n'
nl|'\n'
DECL|member|tearDown
name|'def'
name|'tearDown'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_tear_down_files'
op|'('
op|')'
newline|'\n'
name|'super'
op|'('
name|'TestObjectVersioningUTF8'
op|','
name|'self'
op|')'
op|'.'
name|'tearDown'
op|'('
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|TestCrossPolicyObjectVersioning
dedent|''
dedent|''
name|'class'
name|'TestCrossPolicyObjectVersioning'
op|'('
name|'TestObjectVersioning'
op|')'
op|':'
newline|'\n'
DECL|variable|env
indent|'    '
name|'env'
op|'='
name|'TestCrossPolicyObjectVersioningEnv'
newline|'\n'
DECL|variable|set_up
name|'set_up'
op|'='
name|'False'
newline|'\n'
nl|'\n'
DECL|member|setUp
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'super'
op|'('
name|'TestCrossPolicyObjectVersioning'
op|','
name|'self'
op|')'
op|'.'
name|'setUp'
op|'('
op|')'
newline|'\n'
name|'if'
name|'self'
op|'.'
name|'env'
op|'.'
name|'multiple_policies_enabled'
name|'is'
name|'False'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'SkipTest'
op|'('
string|"'Cross policy test requires multiple policies'"
op|')'
newline|'\n'
dedent|''
name|'elif'
name|'self'
op|'.'
name|'env'
op|'.'
name|'multiple_policies_enabled'
name|'is'
name|'not'
name|'True'
op|':'
newline|'\n'
comment|'# just some sanity checking'
nl|'\n'
indent|'            '
name|'raise'
name|'Exception'
op|'('
string|'"Expected multiple_policies_enabled "'
nl|'\n'
string|'"to be True/False, got %r"'
op|'%'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'env'
op|'.'
name|'versioning_enabled'
op|','
op|')'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|TestSloWithVersioning
dedent|''
dedent|''
dedent|''
name|'class'
name|'TestSloWithVersioning'
op|'('
name|'Base'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|member|setUp
indent|'    '
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
string|"'slo'"
name|'not'
name|'in'
name|'cluster_info'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'SkipTest'
op|'('
string|'"SLO not enabled"'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'conn'
op|'='
name|'Connection'
op|'('
name|'tf'
op|'.'
name|'config'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'conn'
op|'.'
name|'authenticate'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'account'
op|'='
name|'Account'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'conn'
op|','
name|'tf'
op|'.'
name|'config'
op|'.'
name|'get'
op|'('
string|"'account'"
op|','
name|'tf'
op|'.'
name|'config'
op|'['
string|"'username'"
op|']'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'account'
op|'.'
name|'delete_containers'
op|'('
op|')'
newline|'\n'
nl|'\n'
comment|'# create a container with versioning'
nl|'\n'
name|'self'
op|'.'
name|'versions_container'
op|'='
name|'self'
op|'.'
name|'account'
op|'.'
name|'container'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'container'
op|'='
name|'self'
op|'.'
name|'account'
op|'.'
name|'container'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'segments_container'
op|'='
name|'self'
op|'.'
name|'account'
op|'.'
name|'container'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
name|'if'
name|'not'
name|'self'
op|'.'
name|'container'
op|'.'
name|'create'
op|'('
nl|'\n'
name|'hdrs'
op|'='
op|'{'
string|"'X-Versions-Location'"
op|':'
name|'self'
op|'.'
name|'versions_container'
op|'.'
name|'name'
op|'}'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'ResponseError'
op|'('
name|'self'
op|'.'
name|'conn'
op|'.'
name|'response'
op|')'
newline|'\n'
dedent|''
name|'if'
string|"'versions'"
name|'not'
name|'in'
name|'self'
op|'.'
name|'container'
op|'.'
name|'info'
op|'('
op|')'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'SkipTest'
op|'('
string|'"Object versioning not enabled"'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'for'
name|'cont'
name|'in'
op|'('
name|'self'
op|'.'
name|'versions_container'
op|','
name|'self'
op|'.'
name|'segments_container'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'not'
name|'cont'
op|'.'
name|'create'
op|'('
op|')'
op|':'
newline|'\n'
indent|'                '
name|'raise'
name|'ResponseError'
op|'('
name|'self'
op|'.'
name|'conn'
op|'.'
name|'response'
op|')'
newline|'\n'
nl|'\n'
comment|'# create some segments'
nl|'\n'
dedent|''
dedent|''
name|'self'
op|'.'
name|'seg_info'
op|'='
op|'{'
op|'}'
newline|'\n'
name|'for'
name|'letter'
op|','
name|'size'
name|'in'
op|'('
op|'('
string|"'a'"
op|','
number|'1024'
op|'*'
number|'1024'
op|')'
op|','
nl|'\n'
op|'('
string|"'b'"
op|','
number|'1024'
op|'*'
number|'1024'
op|')'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'seg_name'
op|'='
name|'letter'
newline|'\n'
name|'file_item'
op|'='
name|'self'
op|'.'
name|'segments_container'
op|'.'
name|'file'
op|'('
name|'seg_name'
op|')'
newline|'\n'
name|'file_item'
op|'.'
name|'write'
op|'('
name|'letter'
op|'*'
name|'size'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'seg_info'
op|'['
name|'seg_name'
op|']'
op|'='
op|'{'
nl|'\n'
string|"'size_bytes'"
op|':'
name|'size'
op|','
nl|'\n'
string|"'etag'"
op|':'
name|'file_item'
op|'.'
name|'md5'
op|','
nl|'\n'
string|"'path'"
op|':'
string|"'/%s/%s'"
op|'%'
op|'('
name|'self'
op|'.'
name|'segments_container'
op|'.'
name|'name'
op|','
name|'seg_name'
op|')'
op|'}'
newline|'\n'
nl|'\n'
DECL|member|_create_manifest
dedent|''
dedent|''
name|'def'
name|'_create_manifest'
op|'('
name|'self'
op|','
name|'seg_name'
op|')'
op|':'
newline|'\n'
comment|'# create a manifest in the versioning container'
nl|'\n'
indent|'        '
name|'file_item'
op|'='
name|'self'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
string|'"my-slo-manifest"'
op|')'
newline|'\n'
name|'file_item'
op|'.'
name|'write'
op|'('
nl|'\n'
name|'json'
op|'.'
name|'dumps'
op|'('
op|'['
name|'self'
op|'.'
name|'seg_info'
op|'['
name|'seg_name'
op|']'
op|']'
op|')'
op|','
nl|'\n'
name|'parms'
op|'='
op|'{'
string|"'multipart-manifest'"
op|':'
string|"'put'"
op|'}'
op|')'
newline|'\n'
name|'return'
name|'file_item'
newline|'\n'
nl|'\n'
DECL|member|_assert_is_manifest
dedent|''
name|'def'
name|'_assert_is_manifest'
op|'('
name|'self'
op|','
name|'file_item'
op|','
name|'seg_name'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'manifest_body'
op|'='
name|'file_item'
op|'.'
name|'read'
op|'('
name|'parms'
op|'='
op|'{'
string|"'multipart-manifest'"
op|':'
string|"'get'"
op|'}'
op|')'
newline|'\n'
name|'resp_headers'
op|'='
name|'dict'
op|'('
name|'file_item'
op|'.'
name|'conn'
op|'.'
name|'response'
op|'.'
name|'getheaders'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertIn'
op|'('
string|"'x-static-large-object'"
op|','
name|'resp_headers'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'application/json; charset=utf-8'"
op|','
nl|'\n'
name|'file_item'
op|'.'
name|'content_type'
op|')'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'manifest'
op|'='
name|'json'
op|'.'
name|'loads'
op|'('
name|'manifest_body'
op|')'
newline|'\n'
dedent|''
name|'except'
name|'ValueError'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'fail'
op|'('
string|'"GET with multipart-manifest=get got invalid json"'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'1'
op|','
name|'len'
op|'('
name|'manifest'
op|')'
op|')'
newline|'\n'
name|'key_map'
op|'='
op|'{'
string|"'etag'"
op|':'
string|"'hash'"
op|','
string|"'size_bytes'"
op|':'
string|"'bytes'"
op|','
string|"'path'"
op|':'
string|"'name'"
op|'}'
newline|'\n'
name|'for'
name|'k_client'
op|','
name|'k_slo'
name|'in'
name|'key_map'
op|'.'
name|'items'
op|'('
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'self'
op|'.'
name|'seg_info'
op|'['
name|'seg_name'
op|']'
op|'['
name|'k_client'
op|']'
op|','
nl|'\n'
name|'manifest'
op|'['
number|'0'
op|']'
op|'['
name|'k_slo'
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_assert_is_object
dedent|''
dedent|''
name|'def'
name|'_assert_is_object'
op|'('
name|'self'
op|','
name|'file_item'
op|','
name|'seg_name'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'file_contents'
op|'='
name|'file_item'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'1024'
op|'*'
number|'1024'
op|','
name|'len'
op|'('
name|'file_contents'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'seg_name'
op|','
name|'file_contents'
op|'['
number|'0'
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'seg_name'
op|','
name|'file_contents'
op|'['
op|'-'
number|'1'
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|tearDown
dedent|''
name|'def'
name|'tearDown'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# remove versioning to allow simple container delete'
nl|'\n'
indent|'        '
name|'self'
op|'.'
name|'container'
op|'.'
name|'update_metadata'
op|'('
name|'hdrs'
op|'='
op|'{'
string|"'X-Versions-Location'"
op|':'
string|"''"
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'account'
op|'.'
name|'delete_containers'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_slo_manifest_version
dedent|''
name|'def'
name|'test_slo_manifest_version'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'file_item'
op|'='
name|'self'
op|'.'
name|'_create_manifest'
op|'('
string|"'a'"
op|')'
newline|'\n'
comment|'# sanity check: read the manifest, then the large object'
nl|'\n'
name|'self'
op|'.'
name|'_assert_is_manifest'
op|'('
name|'file_item'
op|','
string|"'a'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_assert_is_object'
op|'('
name|'file_item'
op|','
string|"'a'"
op|')'
newline|'\n'
nl|'\n'
comment|'# upload new manifest'
nl|'\n'
name|'file_item'
op|'='
name|'self'
op|'.'
name|'_create_manifest'
op|'('
string|"'b'"
op|')'
newline|'\n'
comment|'# sanity check: read the manifest, then the large object'
nl|'\n'
name|'self'
op|'.'
name|'_assert_is_manifest'
op|'('
name|'file_item'
op|','
string|"'b'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_assert_is_object'
op|'('
name|'file_item'
op|','
string|"'b'"
op|')'
newline|'\n'
nl|'\n'
name|'versions_list'
op|'='
name|'self'
op|'.'
name|'versions_container'
op|'.'
name|'files'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'1'
op|','
name|'len'
op|'('
name|'versions_list'
op|')'
op|')'
newline|'\n'
name|'version_file'
op|'='
name|'self'
op|'.'
name|'versions_container'
op|'.'
name|'file'
op|'('
name|'versions_list'
op|'['
number|'0'
op|']'
op|')'
newline|'\n'
comment|'# check the version is still a manifest'
nl|'\n'
name|'self'
op|'.'
name|'_assert_is_manifest'
op|'('
name|'version_file'
op|','
string|"'a'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_assert_is_object'
op|'('
name|'version_file'
op|','
string|"'a'"
op|')'
newline|'\n'
nl|'\n'
comment|'# delete the newest manifest'
nl|'\n'
name|'file_item'
op|'.'
name|'delete'
op|'('
op|')'
newline|'\n'
nl|'\n'
comment|'# expect the original manifest file to be restored'
nl|'\n'
name|'self'
op|'.'
name|'_assert_is_manifest'
op|'('
name|'file_item'
op|','
string|"'a'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_assert_is_object'
op|'('
name|'file_item'
op|','
string|"'a'"
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|TestTempurlEnv
dedent|''
dedent|''
name|'class'
name|'TestTempurlEnv'
op|'('
name|'object'
op|')'
op|':'
newline|'\n'
DECL|variable|tempurl_enabled
indent|'    '
name|'tempurl_enabled'
op|'='
name|'None'
comment|'# tri-state: None initially, then True/False'
newline|'\n'
nl|'\n'
op|'@'
name|'classmethod'
newline|'\n'
DECL|member|setUp
name|'def'
name|'setUp'
op|'('
name|'cls'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'cls'
op|'.'
name|'conn'
op|'='
name|'Connection'
op|'('
name|'tf'
op|'.'
name|'config'
op|')'
newline|'\n'
name|'cls'
op|'.'
name|'conn'
op|'.'
name|'authenticate'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'if'
name|'cls'
op|'.'
name|'tempurl_enabled'
name|'is'
name|'None'
op|':'
newline|'\n'
indent|'            '
name|'cls'
op|'.'
name|'tempurl_enabled'
op|'='
string|"'tempurl'"
name|'in'
name|'cluster_info'
newline|'\n'
name|'if'
name|'not'
name|'cls'
op|'.'
name|'tempurl_enabled'
op|':'
newline|'\n'
indent|'                '
name|'return'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'cls'
op|'.'
name|'tempurl_key'
op|'='
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
newline|'\n'
name|'cls'
op|'.'
name|'tempurl_key2'
op|'='
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'cls'
op|'.'
name|'account'
op|'='
name|'Account'
op|'('
nl|'\n'
name|'cls'
op|'.'
name|'conn'
op|','
name|'tf'
op|'.'
name|'config'
op|'.'
name|'get'
op|'('
string|"'account'"
op|','
name|'tf'
op|'.'
name|'config'
op|'['
string|"'username'"
op|']'
op|')'
op|')'
newline|'\n'
name|'cls'
op|'.'
name|'account'
op|'.'
name|'delete_containers'
op|'('
op|')'
newline|'\n'
name|'cls'
op|'.'
name|'account'
op|'.'
name|'update_metadata'
op|'('
op|'{'
nl|'\n'
string|"'temp-url-key'"
op|':'
name|'cls'
op|'.'
name|'tempurl_key'
op|','
nl|'\n'
string|"'temp-url-key-2'"
op|':'
name|'cls'
op|'.'
name|'tempurl_key2'
nl|'\n'
op|'}'
op|')'
newline|'\n'
nl|'\n'
name|'cls'
op|'.'
name|'container'
op|'='
name|'cls'
op|'.'
name|'account'
op|'.'
name|'container'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
name|'if'
name|'not'
name|'cls'
op|'.'
name|'container'
op|'.'
name|'create'
op|'('
op|')'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'ResponseError'
op|'('
name|'cls'
op|'.'
name|'conn'
op|'.'
name|'response'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'cls'
op|'.'
name|'obj'
op|'='
name|'cls'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
name|'cls'
op|'.'
name|'obj'
op|'.'
name|'write'
op|'('
string|'"obj contents"'
op|')'
newline|'\n'
name|'cls'
op|'.'
name|'other_obj'
op|'='
name|'cls'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
name|'cls'
op|'.'
name|'other_obj'
op|'.'
name|'write'
op|'('
string|'"other obj contents"'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|TestTempurl
dedent|''
dedent|''
name|'class'
name|'TestTempurl'
op|'('
name|'Base'
op|')'
op|':'
newline|'\n'
DECL|variable|env
indent|'    '
name|'env'
op|'='
name|'TestTempurlEnv'
newline|'\n'
DECL|variable|set_up
name|'set_up'
op|'='
name|'False'
newline|'\n'
nl|'\n'
DECL|member|setUp
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'super'
op|'('
name|'TestTempurl'
op|','
name|'self'
op|')'
op|'.'
name|'setUp'
op|'('
op|')'
newline|'\n'
name|'if'
name|'self'
op|'.'
name|'env'
op|'.'
name|'tempurl_enabled'
name|'is'
name|'False'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'SkipTest'
op|'('
string|'"TempURL not enabled"'
op|')'
newline|'\n'
dedent|''
name|'elif'
name|'self'
op|'.'
name|'env'
op|'.'
name|'tempurl_enabled'
name|'is'
name|'not'
name|'True'
op|':'
newline|'\n'
comment|'# just some sanity checking'
nl|'\n'
indent|'            '
name|'raise'
name|'Exception'
op|'('
nl|'\n'
string|'"Expected tempurl_enabled to be True/False, got %r"'
op|'%'
nl|'\n'
op|'('
name|'self'
op|'.'
name|'env'
op|'.'
name|'tempurl_enabled'
op|','
op|')'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'expires'
op|'='
name|'int'
op|'('
name|'time'
op|'.'
name|'time'
op|'('
op|')'
op|')'
op|'+'
number|'86400'
newline|'\n'
name|'sig'
op|'='
name|'self'
op|'.'
name|'tempurl_sig'
op|'('
nl|'\n'
string|"'GET'"
op|','
name|'expires'
op|','
name|'self'
op|'.'
name|'env'
op|'.'
name|'conn'
op|'.'
name|'make_path'
op|'('
name|'self'
op|'.'
name|'env'
op|'.'
name|'obj'
op|'.'
name|'path'
op|')'
op|','
nl|'\n'
name|'self'
op|'.'
name|'env'
op|'.'
name|'tempurl_key'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'obj_tempurl_parms'
op|'='
op|'{'
string|"'temp_url_sig'"
op|':'
name|'sig'
op|','
nl|'\n'
string|"'temp_url_expires'"
op|':'
name|'str'
op|'('
name|'expires'
op|')'
op|'}'
newline|'\n'
nl|'\n'
DECL|member|tempurl_sig
dedent|''
name|'def'
name|'tempurl_sig'
op|'('
name|'self'
op|','
name|'method'
op|','
name|'expires'
op|','
name|'path'
op|','
name|'key'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'hmac'
op|'.'
name|'new'
op|'('
nl|'\n'
name|'key'
op|','
nl|'\n'
string|"'%s\\n%s\\n%s'"
op|'%'
op|'('
name|'method'
op|','
name|'expires'
op|','
name|'urllib'
op|'.'
name|'parse'
op|'.'
name|'unquote'
op|'('
name|'path'
op|')'
op|')'
op|','
nl|'\n'
name|'hashlib'
op|'.'
name|'sha1'
op|')'
op|'.'
name|'hexdigest'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_GET
dedent|''
name|'def'
name|'test_GET'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'contents'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'obj'
op|'.'
name|'read'
op|'('
nl|'\n'
name|'parms'
op|'='
name|'self'
op|'.'
name|'obj_tempurl_parms'
op|','
nl|'\n'
name|'cfg'
op|'='
op|'{'
string|"'no_auth_token'"
op|':'
name|'True'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'contents'
op|','
string|'"obj contents"'
op|')'
newline|'\n'
nl|'\n'
comment|'# GET tempurls also allow HEAD requests'
nl|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'self'
op|'.'
name|'env'
op|'.'
name|'obj'
op|'.'
name|'info'
op|'('
name|'parms'
op|'='
name|'self'
op|'.'
name|'obj_tempurl_parms'
op|','
nl|'\n'
name|'cfg'
op|'='
op|'{'
string|"'no_auth_token'"
op|':'
name|'True'
op|'}'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_GET_with_key_2
dedent|''
name|'def'
name|'test_GET_with_key_2'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'expires'
op|'='
name|'int'
op|'('
name|'time'
op|'.'
name|'time'
op|'('
op|')'
op|')'
op|'+'
number|'86400'
newline|'\n'
name|'sig'
op|'='
name|'self'
op|'.'
name|'tempurl_sig'
op|'('
nl|'\n'
string|"'GET'"
op|','
name|'expires'
op|','
name|'self'
op|'.'
name|'env'
op|'.'
name|'conn'
op|'.'
name|'make_path'
op|'('
name|'self'
op|'.'
name|'env'
op|'.'
name|'obj'
op|'.'
name|'path'
op|')'
op|','
nl|'\n'
name|'self'
op|'.'
name|'env'
op|'.'
name|'tempurl_key2'
op|')'
newline|'\n'
name|'parms'
op|'='
op|'{'
string|"'temp_url_sig'"
op|':'
name|'sig'
op|','
nl|'\n'
string|"'temp_url_expires'"
op|':'
name|'str'
op|'('
name|'expires'
op|')'
op|'}'
newline|'\n'
nl|'\n'
name|'contents'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'obj'
op|'.'
name|'read'
op|'('
name|'parms'
op|'='
name|'parms'
op|','
name|'cfg'
op|'='
op|'{'
string|"'no_auth_token'"
op|':'
name|'True'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'contents'
op|','
string|'"obj contents"'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_GET_DLO_inside_container
dedent|''
name|'def'
name|'test_GET_DLO_inside_container'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'seg1'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
nl|'\n'
string|'"get-dlo-inside-seg1"'
op|'+'
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
name|'seg2'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
nl|'\n'
string|'"get-dlo-inside-seg2"'
op|'+'
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
name|'seg1'
op|'.'
name|'write'
op|'('
string|'"one fish two fish "'
op|')'
newline|'\n'
name|'seg2'
op|'.'
name|'write'
op|'('
string|'"red fish blue fish"'
op|')'
newline|'\n'
nl|'\n'
name|'manifest'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
string|'"manifest"'
op|'+'
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
name|'manifest'
op|'.'
name|'write'
op|'('
nl|'\n'
string|"''"
op|','
nl|'\n'
name|'hdrs'
op|'='
op|'{'
string|'"X-Object-Manifest"'
op|':'
string|'"%s/get-dlo-inside-seg"'
op|'%'
nl|'\n'
op|'('
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'name'
op|','
op|')'
op|'}'
op|')'
newline|'\n'
nl|'\n'
name|'expires'
op|'='
name|'int'
op|'('
name|'time'
op|'.'
name|'time'
op|'('
op|')'
op|')'
op|'+'
number|'86400'
newline|'\n'
name|'sig'
op|'='
name|'self'
op|'.'
name|'tempurl_sig'
op|'('
nl|'\n'
string|"'GET'"
op|','
name|'expires'
op|','
name|'self'
op|'.'
name|'env'
op|'.'
name|'conn'
op|'.'
name|'make_path'
op|'('
name|'manifest'
op|'.'
name|'path'
op|')'
op|','
nl|'\n'
name|'self'
op|'.'
name|'env'
op|'.'
name|'tempurl_key'
op|')'
newline|'\n'
name|'parms'
op|'='
op|'{'
string|"'temp_url_sig'"
op|':'
name|'sig'
op|','
nl|'\n'
string|"'temp_url_expires'"
op|':'
name|'str'
op|'('
name|'expires'
op|')'
op|'}'
newline|'\n'
nl|'\n'
name|'contents'
op|'='
name|'manifest'
op|'.'
name|'read'
op|'('
name|'parms'
op|'='
name|'parms'
op|','
name|'cfg'
op|'='
op|'{'
string|"'no_auth_token'"
op|':'
name|'True'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'contents'
op|','
string|'"one fish two fish red fish blue fish"'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_GET_DLO_outside_container
dedent|''
name|'def'
name|'test_GET_DLO_outside_container'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'seg1'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
nl|'\n'
string|'"get-dlo-outside-seg1"'
op|'+'
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
name|'seg2'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
nl|'\n'
string|'"get-dlo-outside-seg2"'
op|'+'
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
name|'seg1'
op|'.'
name|'write'
op|'('
string|'"one fish two fish "'
op|')'
newline|'\n'
name|'seg2'
op|'.'
name|'write'
op|'('
string|'"red fish blue fish"'
op|')'
newline|'\n'
nl|'\n'
name|'container2'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'account'
op|'.'
name|'container'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
name|'container2'
op|'.'
name|'create'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'manifest'
op|'='
name|'container2'
op|'.'
name|'file'
op|'('
string|'"manifest"'
op|'+'
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
name|'manifest'
op|'.'
name|'write'
op|'('
nl|'\n'
string|"''"
op|','
nl|'\n'
name|'hdrs'
op|'='
op|'{'
string|'"X-Object-Manifest"'
op|':'
string|'"%s/get-dlo-outside-seg"'
op|'%'
nl|'\n'
op|'('
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'name'
op|','
op|')'
op|'}'
op|')'
newline|'\n'
nl|'\n'
name|'expires'
op|'='
name|'int'
op|'('
name|'time'
op|'.'
name|'time'
op|'('
op|')'
op|')'
op|'+'
number|'86400'
newline|'\n'
name|'sig'
op|'='
name|'self'
op|'.'
name|'tempurl_sig'
op|'('
nl|'\n'
string|"'GET'"
op|','
name|'expires'
op|','
name|'self'
op|'.'
name|'env'
op|'.'
name|'conn'
op|'.'
name|'make_path'
op|'('
name|'manifest'
op|'.'
name|'path'
op|')'
op|','
nl|'\n'
name|'self'
op|'.'
name|'env'
op|'.'
name|'tempurl_key'
op|')'
newline|'\n'
name|'parms'
op|'='
op|'{'
string|"'temp_url_sig'"
op|':'
name|'sig'
op|','
nl|'\n'
string|"'temp_url_expires'"
op|':'
name|'str'
op|'('
name|'expires'
op|')'
op|'}'
newline|'\n'
nl|'\n'
comment|'# cross container tempurl works fine for account tempurl key'
nl|'\n'
name|'contents'
op|'='
name|'manifest'
op|'.'
name|'read'
op|'('
name|'parms'
op|'='
name|'parms'
op|','
name|'cfg'
op|'='
op|'{'
string|"'no_auth_token'"
op|':'
name|'True'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'contents'
op|','
string|'"one fish two fish red fish blue fish"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
op|'['
number|'200'
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_PUT
dedent|''
name|'def'
name|'test_PUT'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'new_obj'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'expires'
op|'='
name|'int'
op|'('
name|'time'
op|'.'
name|'time'
op|'('
op|')'
op|')'
op|'+'
number|'86400'
newline|'\n'
name|'sig'
op|'='
name|'self'
op|'.'
name|'tempurl_sig'
op|'('
nl|'\n'
string|"'PUT'"
op|','
name|'expires'
op|','
name|'self'
op|'.'
name|'env'
op|'.'
name|'conn'
op|'.'
name|'make_path'
op|'('
name|'new_obj'
op|'.'
name|'path'
op|')'
op|','
nl|'\n'
name|'self'
op|'.'
name|'env'
op|'.'
name|'tempurl_key'
op|')'
newline|'\n'
name|'put_parms'
op|'='
op|'{'
string|"'temp_url_sig'"
op|':'
name|'sig'
op|','
nl|'\n'
string|"'temp_url_expires'"
op|':'
name|'str'
op|'('
name|'expires'
op|')'
op|'}'
newline|'\n'
nl|'\n'
name|'new_obj'
op|'.'
name|'write'
op|'('
string|"'new obj contents'"
op|','
nl|'\n'
name|'parms'
op|'='
name|'put_parms'
op|','
name|'cfg'
op|'='
op|'{'
string|"'no_auth_token'"
op|':'
name|'True'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'new_obj'
op|'.'
name|'read'
op|'('
op|')'
op|','
string|'"new obj contents"'
op|')'
newline|'\n'
nl|'\n'
comment|'# PUT tempurls also allow HEAD requests'
nl|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'new_obj'
op|'.'
name|'info'
op|'('
name|'parms'
op|'='
name|'put_parms'
op|','
nl|'\n'
name|'cfg'
op|'='
op|'{'
string|"'no_auth_token'"
op|':'
name|'True'
op|'}'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_PUT_manifest_access
dedent|''
name|'def'
name|'test_PUT_manifest_access'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'new_obj'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
comment|'# give out a signature which allows a PUT to new_obj'
nl|'\n'
name|'expires'
op|'='
name|'int'
op|'('
name|'time'
op|'.'
name|'time'
op|'('
op|')'
op|')'
op|'+'
number|'86400'
newline|'\n'
name|'sig'
op|'='
name|'self'
op|'.'
name|'tempurl_sig'
op|'('
nl|'\n'
string|"'PUT'"
op|','
name|'expires'
op|','
name|'self'
op|'.'
name|'env'
op|'.'
name|'conn'
op|'.'
name|'make_path'
op|'('
name|'new_obj'
op|'.'
name|'path'
op|')'
op|','
nl|'\n'
name|'self'
op|'.'
name|'env'
op|'.'
name|'tempurl_key'
op|')'
newline|'\n'
name|'put_parms'
op|'='
op|'{'
string|"'temp_url_sig'"
op|':'
name|'sig'
op|','
nl|'\n'
string|"'temp_url_expires'"
op|':'
name|'str'
op|'('
name|'expires'
op|')'
op|'}'
newline|'\n'
nl|'\n'
comment|'# try to create manifest pointing to some random container'
nl|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'new_obj'
op|'.'
name|'write'
op|'('
string|"''"
op|','
op|'{'
nl|'\n'
string|"'x-object-manifest'"
op|':'
string|"'%s/foo'"
op|'%'
string|"'some_random_container'"
nl|'\n'
op|'}'
op|','
name|'parms'
op|'='
name|'put_parms'
op|','
name|'cfg'
op|'='
op|'{'
string|"'no_auth_token'"
op|':'
name|'True'
op|'}'
op|')'
newline|'\n'
dedent|''
name|'except'
name|'ResponseError'
name|'as'
name|'e'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'e'
op|'.'
name|'status'
op|','
number|'400'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'fail'
op|'('
string|"'request did not error'"
op|')'
newline|'\n'
nl|'\n'
comment|'# create some other container'
nl|'\n'
dedent|''
name|'other_container'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'account'
op|'.'
name|'container'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
name|'if'
name|'not'
name|'other_container'
op|'.'
name|'create'
op|'('
op|')'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'ResponseError'
op|'('
name|'self'
op|'.'
name|'conn'
op|'.'
name|'response'
op|')'
newline|'\n'
nl|'\n'
comment|'# try to create manifest pointing to new container'
nl|'\n'
dedent|''
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'new_obj'
op|'.'
name|'write'
op|'('
string|"''"
op|','
op|'{'
nl|'\n'
string|"'x-object-manifest'"
op|':'
string|"'%s/foo'"
op|'%'
name|'other_container'
nl|'\n'
op|'}'
op|','
name|'parms'
op|'='
name|'put_parms'
op|','
name|'cfg'
op|'='
op|'{'
string|"'no_auth_token'"
op|':'
name|'True'
op|'}'
op|')'
newline|'\n'
dedent|''
name|'except'
name|'ResponseError'
name|'as'
name|'e'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'e'
op|'.'
name|'status'
op|','
number|'400'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'fail'
op|'('
string|"'request did not error'"
op|')'
newline|'\n'
nl|'\n'
comment|'# try again using a tempurl POST to an already created object'
nl|'\n'
dedent|''
name|'new_obj'
op|'.'
name|'write'
op|'('
string|"''"
op|','
op|'{'
op|'}'
op|','
name|'parms'
op|'='
name|'put_parms'
op|','
name|'cfg'
op|'='
op|'{'
string|"'no_auth_token'"
op|':'
name|'True'
op|'}'
op|')'
newline|'\n'
name|'expires'
op|'='
name|'int'
op|'('
name|'time'
op|'.'
name|'time'
op|'('
op|')'
op|')'
op|'+'
number|'86400'
newline|'\n'
name|'sig'
op|'='
name|'self'
op|'.'
name|'tempurl_sig'
op|'('
nl|'\n'
string|"'POST'"
op|','
name|'expires'
op|','
name|'self'
op|'.'
name|'env'
op|'.'
name|'conn'
op|'.'
name|'make_path'
op|'('
name|'new_obj'
op|'.'
name|'path'
op|')'
op|','
nl|'\n'
name|'self'
op|'.'
name|'env'
op|'.'
name|'tempurl_key'
op|')'
newline|'\n'
name|'post_parms'
op|'='
op|'{'
string|"'temp_url_sig'"
op|':'
name|'sig'
op|','
nl|'\n'
string|"'temp_url_expires'"
op|':'
name|'str'
op|'('
name|'expires'
op|')'
op|'}'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'new_obj'
op|'.'
name|'post'
op|'('
op|'{'
string|"'x-object-manifest'"
op|':'
string|"'%s/foo'"
op|'%'
name|'other_container'
op|'}'
op|','
nl|'\n'
name|'parms'
op|'='
name|'post_parms'
op|','
name|'cfg'
op|'='
op|'{'
string|"'no_auth_token'"
op|':'
name|'True'
op|'}'
op|')'
newline|'\n'
dedent|''
name|'except'
name|'ResponseError'
name|'as'
name|'e'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'e'
op|'.'
name|'status'
op|','
number|'400'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'fail'
op|'('
string|"'request did not error'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_HEAD
dedent|''
dedent|''
name|'def'
name|'test_HEAD'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'expires'
op|'='
name|'int'
op|'('
name|'time'
op|'.'
name|'time'
op|'('
op|')'
op|')'
op|'+'
number|'86400'
newline|'\n'
name|'sig'
op|'='
name|'self'
op|'.'
name|'tempurl_sig'
op|'('
nl|'\n'
string|"'HEAD'"
op|','
name|'expires'
op|','
name|'self'
op|'.'
name|'env'
op|'.'
name|'conn'
op|'.'
name|'make_path'
op|'('
name|'self'
op|'.'
name|'env'
op|'.'
name|'obj'
op|'.'
name|'path'
op|')'
op|','
nl|'\n'
name|'self'
op|'.'
name|'env'
op|'.'
name|'tempurl_key'
op|')'
newline|'\n'
name|'head_parms'
op|'='
op|'{'
string|"'temp_url_sig'"
op|':'
name|'sig'
op|','
nl|'\n'
string|"'temp_url_expires'"
op|':'
name|'str'
op|'('
name|'expires'
op|')'
op|'}'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'self'
op|'.'
name|'env'
op|'.'
name|'obj'
op|'.'
name|'info'
op|'('
name|'parms'
op|'='
name|'head_parms'
op|','
nl|'\n'
name|'cfg'
op|'='
op|'{'
string|"'no_auth_token'"
op|':'
name|'True'
op|'}'
op|')'
op|')'
newline|'\n'
comment|"# HEAD tempurls don't allow PUT or GET requests, despite the fact that"
nl|'\n'
comment|'# PUT and GET tempurls both allow HEAD requests'
nl|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ResponseError'
op|','
name|'self'
op|'.'
name|'env'
op|'.'
name|'other_obj'
op|'.'
name|'read'
op|','
nl|'\n'
name|'cfg'
op|'='
op|'{'
string|"'no_auth_token'"
op|':'
name|'True'
op|'}'
op|','
nl|'\n'
name|'parms'
op|'='
name|'self'
op|'.'
name|'obj_tempurl_parms'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
op|'['
number|'401'
op|']'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ResponseError'
op|','
name|'self'
op|'.'
name|'env'
op|'.'
name|'other_obj'
op|'.'
name|'write'
op|','
nl|'\n'
string|"'new contents'"
op|','
nl|'\n'
name|'cfg'
op|'='
op|'{'
string|"'no_auth_token'"
op|':'
name|'True'
op|'}'
op|','
nl|'\n'
name|'parms'
op|'='
name|'self'
op|'.'
name|'obj_tempurl_parms'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
op|'['
number|'401'
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_different_object
dedent|''
name|'def'
name|'test_different_object'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'contents'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'obj'
op|'.'
name|'read'
op|'('
nl|'\n'
name|'parms'
op|'='
name|'self'
op|'.'
name|'obj_tempurl_parms'
op|','
nl|'\n'
name|'cfg'
op|'='
op|'{'
string|"'no_auth_token'"
op|':'
name|'True'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'contents'
op|','
string|'"obj contents"'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ResponseError'
op|','
name|'self'
op|'.'
name|'env'
op|'.'
name|'other_obj'
op|'.'
name|'read'
op|','
nl|'\n'
name|'cfg'
op|'='
op|'{'
string|"'no_auth_token'"
op|':'
name|'True'
op|'}'
op|','
nl|'\n'
name|'parms'
op|'='
name|'self'
op|'.'
name|'obj_tempurl_parms'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
op|'['
number|'401'
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_changing_sig
dedent|''
name|'def'
name|'test_changing_sig'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'contents'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'obj'
op|'.'
name|'read'
op|'('
nl|'\n'
name|'parms'
op|'='
name|'self'
op|'.'
name|'obj_tempurl_parms'
op|','
nl|'\n'
name|'cfg'
op|'='
op|'{'
string|"'no_auth_token'"
op|':'
name|'True'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'contents'
op|','
string|'"obj contents"'
op|')'
newline|'\n'
nl|'\n'
name|'parms'
op|'='
name|'self'
op|'.'
name|'obj_tempurl_parms'
op|'.'
name|'copy'
op|'('
op|')'
newline|'\n'
name|'if'
name|'parms'
op|'['
string|"'temp_url_sig'"
op|']'
op|'['
number|'0'
op|']'
op|'=='
string|"'a'"
op|':'
newline|'\n'
indent|'            '
name|'parms'
op|'['
string|"'temp_url_sig'"
op|']'
op|'='
string|"'b'"
op|'+'
name|'parms'
op|'['
string|"'temp_url_sig'"
op|']'
op|'['
number|'1'
op|':'
op|']'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'parms'
op|'['
string|"'temp_url_sig'"
op|']'
op|'='
string|"'a'"
op|'+'
name|'parms'
op|'['
string|"'temp_url_sig'"
op|']'
op|'['
number|'1'
op|':'
op|']'
newline|'\n'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ResponseError'
op|','
name|'self'
op|'.'
name|'env'
op|'.'
name|'obj'
op|'.'
name|'read'
op|','
nl|'\n'
name|'cfg'
op|'='
op|'{'
string|"'no_auth_token'"
op|':'
name|'True'
op|'}'
op|','
nl|'\n'
name|'parms'
op|'='
name|'parms'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
op|'['
number|'401'
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_changing_expires
dedent|''
name|'def'
name|'test_changing_expires'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'contents'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'obj'
op|'.'
name|'read'
op|'('
nl|'\n'
name|'parms'
op|'='
name|'self'
op|'.'
name|'obj_tempurl_parms'
op|','
nl|'\n'
name|'cfg'
op|'='
op|'{'
string|"'no_auth_token'"
op|':'
name|'True'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'contents'
op|','
string|'"obj contents"'
op|')'
newline|'\n'
nl|'\n'
name|'parms'
op|'='
name|'self'
op|'.'
name|'obj_tempurl_parms'
op|'.'
name|'copy'
op|'('
op|')'
newline|'\n'
name|'if'
name|'parms'
op|'['
string|"'temp_url_expires'"
op|']'
op|'['
op|'-'
number|'1'
op|']'
op|'=='
string|"'0'"
op|':'
newline|'\n'
indent|'            '
name|'parms'
op|'['
string|"'temp_url_expires'"
op|']'
op|'='
name|'parms'
op|'['
string|"'temp_url_expires'"
op|']'
op|'['
op|':'
op|'-'
number|'1'
op|']'
op|'+'
string|"'1'"
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'parms'
op|'['
string|"'temp_url_expires'"
op|']'
op|'='
name|'parms'
op|'['
string|"'temp_url_expires'"
op|']'
op|'['
op|':'
op|'-'
number|'1'
op|']'
op|'+'
string|"'0'"
newline|'\n'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ResponseError'
op|','
name|'self'
op|'.'
name|'env'
op|'.'
name|'obj'
op|'.'
name|'read'
op|','
nl|'\n'
name|'cfg'
op|'='
op|'{'
string|"'no_auth_token'"
op|':'
name|'True'
op|'}'
op|','
nl|'\n'
name|'parms'
op|'='
name|'parms'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
op|'['
number|'401'
op|']'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|TestTempurlUTF8
dedent|''
dedent|''
name|'class'
name|'TestTempurlUTF8'
op|'('
name|'Base2'
op|','
name|'TestTempurl'
op|')'
op|':'
newline|'\n'
DECL|variable|set_up
indent|'    '
name|'set_up'
op|'='
name|'False'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|TestContainerTempurlEnv
dedent|''
name|'class'
name|'TestContainerTempurlEnv'
op|'('
name|'object'
op|')'
op|':'
newline|'\n'
DECL|variable|tempurl_enabled
indent|'    '
name|'tempurl_enabled'
op|'='
name|'None'
comment|'# tri-state: None initially, then True/False'
newline|'\n'
nl|'\n'
op|'@'
name|'classmethod'
newline|'\n'
DECL|member|setUp
name|'def'
name|'setUp'
op|'('
name|'cls'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'cls'
op|'.'
name|'conn'
op|'='
name|'Connection'
op|'('
name|'tf'
op|'.'
name|'config'
op|')'
newline|'\n'
name|'cls'
op|'.'
name|'conn'
op|'.'
name|'authenticate'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'if'
name|'cls'
op|'.'
name|'tempurl_enabled'
name|'is'
name|'None'
op|':'
newline|'\n'
indent|'            '
name|'cls'
op|'.'
name|'tempurl_enabled'
op|'='
string|"'tempurl'"
name|'in'
name|'cluster_info'
newline|'\n'
name|'if'
name|'not'
name|'cls'
op|'.'
name|'tempurl_enabled'
op|':'
newline|'\n'
indent|'                '
name|'return'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'cls'
op|'.'
name|'tempurl_key'
op|'='
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
newline|'\n'
name|'cls'
op|'.'
name|'tempurl_key2'
op|'='
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'cls'
op|'.'
name|'account'
op|'='
name|'Account'
op|'('
nl|'\n'
name|'cls'
op|'.'
name|'conn'
op|','
name|'tf'
op|'.'
name|'config'
op|'.'
name|'get'
op|'('
string|"'account'"
op|','
name|'tf'
op|'.'
name|'config'
op|'['
string|"'username'"
op|']'
op|')'
op|')'
newline|'\n'
name|'cls'
op|'.'
name|'account'
op|'.'
name|'delete_containers'
op|'('
op|')'
newline|'\n'
nl|'\n'
comment|'# creating another account and connection'
nl|'\n'
comment|'# for ACL tests'
nl|'\n'
name|'config2'
op|'='
name|'deepcopy'
op|'('
name|'tf'
op|'.'
name|'config'
op|')'
newline|'\n'
name|'config2'
op|'['
string|"'account'"
op|']'
op|'='
name|'tf'
op|'.'
name|'config'
op|'['
string|"'account2'"
op|']'
newline|'\n'
name|'config2'
op|'['
string|"'username'"
op|']'
op|'='
name|'tf'
op|'.'
name|'config'
op|'['
string|"'username2'"
op|']'
newline|'\n'
name|'config2'
op|'['
string|"'password'"
op|']'
op|'='
name|'tf'
op|'.'
name|'config'
op|'['
string|"'password2'"
op|']'
newline|'\n'
name|'cls'
op|'.'
name|'conn2'
op|'='
name|'Connection'
op|'('
name|'config2'
op|')'
newline|'\n'
name|'cls'
op|'.'
name|'conn2'
op|'.'
name|'authenticate'
op|'('
op|')'
newline|'\n'
name|'cls'
op|'.'
name|'account2'
op|'='
name|'Account'
op|'('
nl|'\n'
name|'cls'
op|'.'
name|'conn2'
op|','
name|'config2'
op|'.'
name|'get'
op|'('
string|"'account'"
op|','
name|'config2'
op|'['
string|"'username'"
op|']'
op|')'
op|')'
newline|'\n'
name|'cls'
op|'.'
name|'account2'
op|'='
name|'cls'
op|'.'
name|'conn2'
op|'.'
name|'get_account'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'cls'
op|'.'
name|'container'
op|'='
name|'cls'
op|'.'
name|'account'
op|'.'
name|'container'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
name|'if'
name|'not'
name|'cls'
op|'.'
name|'container'
op|'.'
name|'create'
op|'('
op|'{'
nl|'\n'
string|"'x-container-meta-temp-url-key'"
op|':'
name|'cls'
op|'.'
name|'tempurl_key'
op|','
nl|'\n'
string|"'x-container-meta-temp-url-key-2'"
op|':'
name|'cls'
op|'.'
name|'tempurl_key2'
op|','
nl|'\n'
string|"'x-container-read'"
op|':'
name|'cls'
op|'.'
name|'account2'
op|'.'
name|'name'
op|'}'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'ResponseError'
op|'('
name|'cls'
op|'.'
name|'conn'
op|'.'
name|'response'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'cls'
op|'.'
name|'obj'
op|'='
name|'cls'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
name|'cls'
op|'.'
name|'obj'
op|'.'
name|'write'
op|'('
string|'"obj contents"'
op|')'
newline|'\n'
name|'cls'
op|'.'
name|'other_obj'
op|'='
name|'cls'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
name|'cls'
op|'.'
name|'other_obj'
op|'.'
name|'write'
op|'('
string|'"other obj contents"'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|TestContainerTempurl
dedent|''
dedent|''
name|'class'
name|'TestContainerTempurl'
op|'('
name|'Base'
op|')'
op|':'
newline|'\n'
DECL|variable|env
indent|'    '
name|'env'
op|'='
name|'TestContainerTempurlEnv'
newline|'\n'
DECL|variable|set_up
name|'set_up'
op|'='
name|'False'
newline|'\n'
nl|'\n'
DECL|member|setUp
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'super'
op|'('
name|'TestContainerTempurl'
op|','
name|'self'
op|')'
op|'.'
name|'setUp'
op|'('
op|')'
newline|'\n'
name|'if'
name|'self'
op|'.'
name|'env'
op|'.'
name|'tempurl_enabled'
name|'is'
name|'False'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'SkipTest'
op|'('
string|'"TempURL not enabled"'
op|')'
newline|'\n'
dedent|''
name|'elif'
name|'self'
op|'.'
name|'env'
op|'.'
name|'tempurl_enabled'
name|'is'
name|'not'
name|'True'
op|':'
newline|'\n'
comment|'# just some sanity checking'
nl|'\n'
indent|'            '
name|'raise'
name|'Exception'
op|'('
nl|'\n'
string|'"Expected tempurl_enabled to be True/False, got %r"'
op|'%'
nl|'\n'
op|'('
name|'self'
op|'.'
name|'env'
op|'.'
name|'tempurl_enabled'
op|','
op|')'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'expires'
op|'='
name|'int'
op|'('
name|'time'
op|'.'
name|'time'
op|'('
op|')'
op|')'
op|'+'
number|'86400'
newline|'\n'
name|'sig'
op|'='
name|'self'
op|'.'
name|'tempurl_sig'
op|'('
nl|'\n'
string|"'GET'"
op|','
name|'expires'
op|','
name|'self'
op|'.'
name|'env'
op|'.'
name|'conn'
op|'.'
name|'make_path'
op|'('
name|'self'
op|'.'
name|'env'
op|'.'
name|'obj'
op|'.'
name|'path'
op|')'
op|','
nl|'\n'
name|'self'
op|'.'
name|'env'
op|'.'
name|'tempurl_key'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'obj_tempurl_parms'
op|'='
op|'{'
string|"'temp_url_sig'"
op|':'
name|'sig'
op|','
nl|'\n'
string|"'temp_url_expires'"
op|':'
name|'str'
op|'('
name|'expires'
op|')'
op|'}'
newline|'\n'
nl|'\n'
DECL|member|tempurl_sig
dedent|''
name|'def'
name|'tempurl_sig'
op|'('
name|'self'
op|','
name|'method'
op|','
name|'expires'
op|','
name|'path'
op|','
name|'key'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'hmac'
op|'.'
name|'new'
op|'('
nl|'\n'
name|'key'
op|','
nl|'\n'
string|"'%s\\n%s\\n%s'"
op|'%'
op|'('
name|'method'
op|','
name|'expires'
op|','
name|'urllib'
op|'.'
name|'parse'
op|'.'
name|'unquote'
op|'('
name|'path'
op|')'
op|')'
op|','
nl|'\n'
name|'hashlib'
op|'.'
name|'sha1'
op|')'
op|'.'
name|'hexdigest'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_GET
dedent|''
name|'def'
name|'test_GET'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'contents'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'obj'
op|'.'
name|'read'
op|'('
nl|'\n'
name|'parms'
op|'='
name|'self'
op|'.'
name|'obj_tempurl_parms'
op|','
nl|'\n'
name|'cfg'
op|'='
op|'{'
string|"'no_auth_token'"
op|':'
name|'True'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'contents'
op|','
string|'"obj contents"'
op|')'
newline|'\n'
nl|'\n'
comment|'# GET tempurls also allow HEAD requests'
nl|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'self'
op|'.'
name|'env'
op|'.'
name|'obj'
op|'.'
name|'info'
op|'('
name|'parms'
op|'='
name|'self'
op|'.'
name|'obj_tempurl_parms'
op|','
nl|'\n'
name|'cfg'
op|'='
op|'{'
string|"'no_auth_token'"
op|':'
name|'True'
op|'}'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_GET_with_key_2
dedent|''
name|'def'
name|'test_GET_with_key_2'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'expires'
op|'='
name|'int'
op|'('
name|'time'
op|'.'
name|'time'
op|'('
op|')'
op|')'
op|'+'
number|'86400'
newline|'\n'
name|'sig'
op|'='
name|'self'
op|'.'
name|'tempurl_sig'
op|'('
nl|'\n'
string|"'GET'"
op|','
name|'expires'
op|','
name|'self'
op|'.'
name|'env'
op|'.'
name|'conn'
op|'.'
name|'make_path'
op|'('
name|'self'
op|'.'
name|'env'
op|'.'
name|'obj'
op|'.'
name|'path'
op|')'
op|','
nl|'\n'
name|'self'
op|'.'
name|'env'
op|'.'
name|'tempurl_key2'
op|')'
newline|'\n'
name|'parms'
op|'='
op|'{'
string|"'temp_url_sig'"
op|':'
name|'sig'
op|','
nl|'\n'
string|"'temp_url_expires'"
op|':'
name|'str'
op|'('
name|'expires'
op|')'
op|'}'
newline|'\n'
nl|'\n'
name|'contents'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'obj'
op|'.'
name|'read'
op|'('
name|'parms'
op|'='
name|'parms'
op|','
name|'cfg'
op|'='
op|'{'
string|"'no_auth_token'"
op|':'
name|'True'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'contents'
op|','
string|'"obj contents"'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_PUT
dedent|''
name|'def'
name|'test_PUT'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'new_obj'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'expires'
op|'='
name|'int'
op|'('
name|'time'
op|'.'
name|'time'
op|'('
op|')'
op|')'
op|'+'
number|'86400'
newline|'\n'
name|'sig'
op|'='
name|'self'
op|'.'
name|'tempurl_sig'
op|'('
nl|'\n'
string|"'PUT'"
op|','
name|'expires'
op|','
name|'self'
op|'.'
name|'env'
op|'.'
name|'conn'
op|'.'
name|'make_path'
op|'('
name|'new_obj'
op|'.'
name|'path'
op|')'
op|','
nl|'\n'
name|'self'
op|'.'
name|'env'
op|'.'
name|'tempurl_key'
op|')'
newline|'\n'
name|'put_parms'
op|'='
op|'{'
string|"'temp_url_sig'"
op|':'
name|'sig'
op|','
nl|'\n'
string|"'temp_url_expires'"
op|':'
name|'str'
op|'('
name|'expires'
op|')'
op|'}'
newline|'\n'
nl|'\n'
name|'new_obj'
op|'.'
name|'write'
op|'('
string|"'new obj contents'"
op|','
nl|'\n'
name|'parms'
op|'='
name|'put_parms'
op|','
name|'cfg'
op|'='
op|'{'
string|"'no_auth_token'"
op|':'
name|'True'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'new_obj'
op|'.'
name|'read'
op|'('
op|')'
op|','
string|'"new obj contents"'
op|')'
newline|'\n'
nl|'\n'
comment|'# PUT tempurls also allow HEAD requests'
nl|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'new_obj'
op|'.'
name|'info'
op|'('
name|'parms'
op|'='
name|'put_parms'
op|','
nl|'\n'
name|'cfg'
op|'='
op|'{'
string|"'no_auth_token'"
op|':'
name|'True'
op|'}'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_HEAD
dedent|''
name|'def'
name|'test_HEAD'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'expires'
op|'='
name|'int'
op|'('
name|'time'
op|'.'
name|'time'
op|'('
op|')'
op|')'
op|'+'
number|'86400'
newline|'\n'
name|'sig'
op|'='
name|'self'
op|'.'
name|'tempurl_sig'
op|'('
nl|'\n'
string|"'HEAD'"
op|','
name|'expires'
op|','
name|'self'
op|'.'
name|'env'
op|'.'
name|'conn'
op|'.'
name|'make_path'
op|'('
name|'self'
op|'.'
name|'env'
op|'.'
name|'obj'
op|'.'
name|'path'
op|')'
op|','
nl|'\n'
name|'self'
op|'.'
name|'env'
op|'.'
name|'tempurl_key'
op|')'
newline|'\n'
name|'head_parms'
op|'='
op|'{'
string|"'temp_url_sig'"
op|':'
name|'sig'
op|','
nl|'\n'
string|"'temp_url_expires'"
op|':'
name|'str'
op|'('
name|'expires'
op|')'
op|'}'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'self'
op|'.'
name|'env'
op|'.'
name|'obj'
op|'.'
name|'info'
op|'('
name|'parms'
op|'='
name|'head_parms'
op|','
nl|'\n'
name|'cfg'
op|'='
op|'{'
string|"'no_auth_token'"
op|':'
name|'True'
op|'}'
op|')'
op|')'
newline|'\n'
comment|"# HEAD tempurls don't allow PUT or GET requests, despite the fact that"
nl|'\n'
comment|'# PUT and GET tempurls both allow HEAD requests'
nl|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ResponseError'
op|','
name|'self'
op|'.'
name|'env'
op|'.'
name|'other_obj'
op|'.'
name|'read'
op|','
nl|'\n'
name|'cfg'
op|'='
op|'{'
string|"'no_auth_token'"
op|':'
name|'True'
op|'}'
op|','
nl|'\n'
name|'parms'
op|'='
name|'self'
op|'.'
name|'obj_tempurl_parms'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
op|'['
number|'401'
op|']'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ResponseError'
op|','
name|'self'
op|'.'
name|'env'
op|'.'
name|'other_obj'
op|'.'
name|'write'
op|','
nl|'\n'
string|"'new contents'"
op|','
nl|'\n'
name|'cfg'
op|'='
op|'{'
string|"'no_auth_token'"
op|':'
name|'True'
op|'}'
op|','
nl|'\n'
name|'parms'
op|'='
name|'self'
op|'.'
name|'obj_tempurl_parms'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
op|'['
number|'401'
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_different_object
dedent|''
name|'def'
name|'test_different_object'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'contents'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'obj'
op|'.'
name|'read'
op|'('
nl|'\n'
name|'parms'
op|'='
name|'self'
op|'.'
name|'obj_tempurl_parms'
op|','
nl|'\n'
name|'cfg'
op|'='
op|'{'
string|"'no_auth_token'"
op|':'
name|'True'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'contents'
op|','
string|'"obj contents"'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ResponseError'
op|','
name|'self'
op|'.'
name|'env'
op|'.'
name|'other_obj'
op|'.'
name|'read'
op|','
nl|'\n'
name|'cfg'
op|'='
op|'{'
string|"'no_auth_token'"
op|':'
name|'True'
op|'}'
op|','
nl|'\n'
name|'parms'
op|'='
name|'self'
op|'.'
name|'obj_tempurl_parms'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
op|'['
number|'401'
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_changing_sig
dedent|''
name|'def'
name|'test_changing_sig'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'contents'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'obj'
op|'.'
name|'read'
op|'('
nl|'\n'
name|'parms'
op|'='
name|'self'
op|'.'
name|'obj_tempurl_parms'
op|','
nl|'\n'
name|'cfg'
op|'='
op|'{'
string|"'no_auth_token'"
op|':'
name|'True'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'contents'
op|','
string|'"obj contents"'
op|')'
newline|'\n'
nl|'\n'
name|'parms'
op|'='
name|'self'
op|'.'
name|'obj_tempurl_parms'
op|'.'
name|'copy'
op|'('
op|')'
newline|'\n'
name|'if'
name|'parms'
op|'['
string|"'temp_url_sig'"
op|']'
op|'['
number|'0'
op|']'
op|'=='
string|"'a'"
op|':'
newline|'\n'
indent|'            '
name|'parms'
op|'['
string|"'temp_url_sig'"
op|']'
op|'='
string|"'b'"
op|'+'
name|'parms'
op|'['
string|"'temp_url_sig'"
op|']'
op|'['
number|'1'
op|':'
op|']'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'parms'
op|'['
string|"'temp_url_sig'"
op|']'
op|'='
string|"'a'"
op|'+'
name|'parms'
op|'['
string|"'temp_url_sig'"
op|']'
op|'['
number|'1'
op|':'
op|']'
newline|'\n'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ResponseError'
op|','
name|'self'
op|'.'
name|'env'
op|'.'
name|'obj'
op|'.'
name|'read'
op|','
nl|'\n'
name|'cfg'
op|'='
op|'{'
string|"'no_auth_token'"
op|':'
name|'True'
op|'}'
op|','
nl|'\n'
name|'parms'
op|'='
name|'parms'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
op|'['
number|'401'
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_changing_expires
dedent|''
name|'def'
name|'test_changing_expires'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'contents'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'obj'
op|'.'
name|'read'
op|'('
nl|'\n'
name|'parms'
op|'='
name|'self'
op|'.'
name|'obj_tempurl_parms'
op|','
nl|'\n'
name|'cfg'
op|'='
op|'{'
string|"'no_auth_token'"
op|':'
name|'True'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'contents'
op|','
string|'"obj contents"'
op|')'
newline|'\n'
nl|'\n'
name|'parms'
op|'='
name|'self'
op|'.'
name|'obj_tempurl_parms'
op|'.'
name|'copy'
op|'('
op|')'
newline|'\n'
name|'if'
name|'parms'
op|'['
string|"'temp_url_expires'"
op|']'
op|'['
op|'-'
number|'1'
op|']'
op|'=='
string|"'0'"
op|':'
newline|'\n'
indent|'            '
name|'parms'
op|'['
string|"'temp_url_expires'"
op|']'
op|'='
name|'parms'
op|'['
string|"'temp_url_expires'"
op|']'
op|'['
op|':'
op|'-'
number|'1'
op|']'
op|'+'
string|"'1'"
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'parms'
op|'['
string|"'temp_url_expires'"
op|']'
op|'='
name|'parms'
op|'['
string|"'temp_url_expires'"
op|']'
op|'['
op|':'
op|'-'
number|'1'
op|']'
op|'+'
string|"'0'"
newline|'\n'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ResponseError'
op|','
name|'self'
op|'.'
name|'env'
op|'.'
name|'obj'
op|'.'
name|'read'
op|','
nl|'\n'
name|'cfg'
op|'='
op|'{'
string|"'no_auth_token'"
op|':'
name|'True'
op|'}'
op|','
nl|'\n'
name|'parms'
op|'='
name|'parms'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_status'
op|'('
op|'['
number|'401'
op|']'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'requires_acls'
newline|'\n'
DECL|member|test_tempurl_keys_visible_to_account_owner
name|'def'
name|'test_tempurl_keys_visible_to_account_owner'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'not'
name|'tf'
op|'.'
name|'cluster_info'
op|'.'
name|'get'
op|'('
string|"'tempauth'"
op|')'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'SkipTest'
op|'('
string|"'TEMP AUTH SPECIFIC TEST'"
op|')'
newline|'\n'
dedent|''
name|'metadata'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'info'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'metadata'
op|'.'
name|'get'
op|'('
string|"'tempurl_key'"
op|')'
op|','
name|'self'
op|'.'
name|'env'
op|'.'
name|'tempurl_key'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'metadata'
op|'.'
name|'get'
op|'('
string|"'tempurl_key2'"
op|')'
op|','
name|'self'
op|'.'
name|'env'
op|'.'
name|'tempurl_key2'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'requires_acls'
newline|'\n'
DECL|member|test_tempurl_keys_hidden_from_acl_readonly
name|'def'
name|'test_tempurl_keys_hidden_from_acl_readonly'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'not'
name|'tf'
op|'.'
name|'cluster_info'
op|'.'
name|'get'
op|'('
string|"'tempauth'"
op|')'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'SkipTest'
op|'('
string|"'TEMP AUTH SPECIFIC TEST'"
op|')'
newline|'\n'
dedent|''
name|'original_token'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'conn'
op|'.'
name|'storage_token'
newline|'\n'
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'conn'
op|'.'
name|'storage_token'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'conn2'
op|'.'
name|'storage_token'
newline|'\n'
name|'metadata'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'info'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'conn'
op|'.'
name|'storage_token'
op|'='
name|'original_token'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertNotIn'
op|'('
nl|'\n'
string|"'tempurl_key'"
op|','
name|'metadata'
op|','
nl|'\n'
string|"'Container TempURL key found, should not be visible '"
nl|'\n'
string|"'to readonly ACLs'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertNotIn'
op|'('
nl|'\n'
string|"'tempurl_key2'"
op|','
name|'metadata'
op|','
nl|'\n'
string|"'Container TempURL key-2 found, should not be visible '"
nl|'\n'
string|"'to readonly ACLs'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_GET_DLO_inside_container
dedent|''
name|'def'
name|'test_GET_DLO_inside_container'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'seg1'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
nl|'\n'
string|'"get-dlo-inside-seg1"'
op|'+'
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
name|'seg2'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
nl|'\n'
string|'"get-dlo-inside-seg2"'
op|'+'
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
name|'seg1'
op|'.'
name|'write'
op|'('
string|'"one fish two fish "'
op|')'
newline|'\n'
name|'seg2'
op|'.'
name|'write'
op|'('
string|'"red fish blue fish"'
op|')'
newline|'\n'
nl|'\n'
name|'manifest'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
string|'"manifest"'
op|'+'
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
name|'manifest'
op|'.'
name|'write'
op|'('
nl|'\n'
string|"''"
op|','
nl|'\n'
name|'hdrs'
op|'='
op|'{'
string|'"X-Object-Manifest"'
op|':'
string|'"%s/get-dlo-inside-seg"'
op|'%'
nl|'\n'
op|'('
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'name'
op|','
op|')'
op|'}'
op|')'
newline|'\n'
nl|'\n'
name|'expires'
op|'='
name|'int'
op|'('
name|'time'
op|'.'
name|'time'
op|'('
op|')'
op|')'
op|'+'
number|'86400'
newline|'\n'
name|'sig'
op|'='
name|'self'
op|'.'
name|'tempurl_sig'
op|'('
nl|'\n'
string|"'GET'"
op|','
name|'expires'
op|','
name|'self'
op|'.'
name|'env'
op|'.'
name|'conn'
op|'.'
name|'make_path'
op|'('
name|'manifest'
op|'.'
name|'path'
op|')'
op|','
nl|'\n'
name|'self'
op|'.'
name|'env'
op|'.'
name|'tempurl_key'
op|')'
newline|'\n'
name|'parms'
op|'='
op|'{'
string|"'temp_url_sig'"
op|':'
name|'sig'
op|','
nl|'\n'
string|"'temp_url_expires'"
op|':'
name|'str'
op|'('
name|'expires'
op|')'
op|'}'
newline|'\n'
nl|'\n'
name|'contents'
op|'='
name|'manifest'
op|'.'
name|'read'
op|'('
name|'parms'
op|'='
name|'parms'
op|','
name|'cfg'
op|'='
op|'{'
string|"'no_auth_token'"
op|':'
name|'True'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'contents'
op|','
string|'"one fish two fish red fish blue fish"'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_GET_DLO_outside_container
dedent|''
name|'def'
name|'test_GET_DLO_outside_container'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'container2'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'account'
op|'.'
name|'container'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
name|'container2'
op|'.'
name|'create'
op|'('
op|')'
newline|'\n'
name|'seg1'
op|'='
name|'container2'
op|'.'
name|'file'
op|'('
nl|'\n'
string|'"get-dlo-outside-seg1"'
op|'+'
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
name|'seg2'
op|'='
name|'container2'
op|'.'
name|'file'
op|'('
nl|'\n'
string|'"get-dlo-outside-seg2"'
op|'+'
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
name|'seg1'
op|'.'
name|'write'
op|'('
string|'"one fish two fish "'
op|')'
newline|'\n'
name|'seg2'
op|'.'
name|'write'
op|'('
string|'"red fish blue fish"'
op|')'
newline|'\n'
nl|'\n'
name|'manifest'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'container'
op|'.'
name|'file'
op|'('
string|'"manifest"'
op|'+'
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
name|'manifest'
op|'.'
name|'write'
op|'('
nl|'\n'
string|"''"
op|','
nl|'\n'
name|'hdrs'
op|'='
op|'{'
string|'"X-Object-Manifest"'
op|':'
string|'"%s/get-dlo-outside-seg"'
op|'%'
nl|'\n'
op|'('
name|'container2'
op|'.'
name|'name'
op|','
op|')'
op|'}'
op|')'
newline|'\n'
nl|'\n'
name|'expires'
op|'='
name|'int'
op|'('
name|'time'
op|'.'
name|'time'
op|'('
op|')'
op|')'
op|'+'
number|'86400'
newline|'\n'
name|'sig'
op|'='
name|'self'
op|'.'
name|'tempurl_sig'
op|'('
nl|'\n'
string|"'GET'"
op|','
name|'expires'
op|','
name|'self'
op|'.'
name|'env'
op|'.'
name|'conn'
op|'.'
name|'make_path'
op|'('
name|'manifest'
op|'.'
name|'path'
op|')'
op|','
nl|'\n'
name|'self'
op|'.'
name|'env'
op|'.'
name|'tempurl_key'
op|')'
newline|'\n'
name|'parms'
op|'='
op|'{'
string|"'temp_url_sig'"
op|':'
name|'sig'
op|','
nl|'\n'
string|"'temp_url_expires'"
op|':'
name|'str'
op|'('
name|'expires'
op|')'
op|'}'
newline|'\n'
nl|'\n'
comment|'# cross container tempurl does not work for container tempurl key'
nl|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'manifest'
op|'.'
name|'read'
op|'('
name|'parms'
op|'='
name|'parms'
op|','
name|'cfg'
op|'='
op|'{'
string|"'no_auth_token'"
op|':'
name|'True'
op|'}'
op|')'
newline|'\n'
dedent|''
name|'except'
name|'ResponseError'
name|'as'
name|'e'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'e'
op|'.'
name|'status'
op|','
number|'401'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'fail'
op|'('
string|"'request did not error'"
op|')'
newline|'\n'
dedent|''
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'manifest'
op|'.'
name|'info'
op|'('
name|'parms'
op|'='
name|'parms'
op|','
name|'cfg'
op|'='
op|'{'
string|"'no_auth_token'"
op|':'
name|'True'
op|'}'
op|')'
newline|'\n'
dedent|''
name|'except'
name|'ResponseError'
name|'as'
name|'e'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'e'
op|'.'
name|'status'
op|','
number|'401'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'fail'
op|'('
string|"'request did not error'"
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|TestContainerTempurlUTF8
dedent|''
dedent|''
dedent|''
name|'class'
name|'TestContainerTempurlUTF8'
op|'('
name|'Base2'
op|','
name|'TestContainerTempurl'
op|')'
op|':'
newline|'\n'
DECL|variable|set_up
indent|'    '
name|'set_up'
op|'='
name|'False'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|TestSloTempurlEnv
dedent|''
name|'class'
name|'TestSloTempurlEnv'
op|'('
name|'object'
op|')'
op|':'
newline|'\n'
DECL|variable|enabled
indent|'    '
name|'enabled'
op|'='
name|'None'
comment|'# tri-state: None initially, then True/False'
newline|'\n'
nl|'\n'
op|'@'
name|'classmethod'
newline|'\n'
DECL|member|setUp
name|'def'
name|'setUp'
op|'('
name|'cls'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'cls'
op|'.'
name|'conn'
op|'='
name|'Connection'
op|'('
name|'tf'
op|'.'
name|'config'
op|')'
newline|'\n'
name|'cls'
op|'.'
name|'conn'
op|'.'
name|'authenticate'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'if'
name|'cls'
op|'.'
name|'enabled'
name|'is'
name|'None'
op|':'
newline|'\n'
indent|'            '
name|'cls'
op|'.'
name|'enabled'
op|'='
string|"'tempurl'"
name|'in'
name|'cluster_info'
name|'and'
string|"'slo'"
name|'in'
name|'cluster_info'
newline|'\n'
nl|'\n'
dedent|''
name|'cls'
op|'.'
name|'tempurl_key'
op|'='
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'cls'
op|'.'
name|'account'
op|'='
name|'Account'
op|'('
nl|'\n'
name|'cls'
op|'.'
name|'conn'
op|','
name|'tf'
op|'.'
name|'config'
op|'.'
name|'get'
op|'('
string|"'account'"
op|','
name|'tf'
op|'.'
name|'config'
op|'['
string|"'username'"
op|']'
op|')'
op|')'
newline|'\n'
name|'cls'
op|'.'
name|'account'
op|'.'
name|'delete_containers'
op|'('
op|')'
newline|'\n'
name|'cls'
op|'.'
name|'account'
op|'.'
name|'update_metadata'
op|'('
op|'{'
string|"'temp-url-key'"
op|':'
name|'cls'
op|'.'
name|'tempurl_key'
op|'}'
op|')'
newline|'\n'
nl|'\n'
name|'cls'
op|'.'
name|'manifest_container'
op|'='
name|'cls'
op|'.'
name|'account'
op|'.'
name|'container'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
name|'cls'
op|'.'
name|'segments_container'
op|'='
name|'cls'
op|'.'
name|'account'
op|'.'
name|'container'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
name|'if'
name|'not'
name|'cls'
op|'.'
name|'manifest_container'
op|'.'
name|'create'
op|'('
op|')'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'ResponseError'
op|'('
name|'cls'
op|'.'
name|'conn'
op|'.'
name|'response'
op|')'
newline|'\n'
dedent|''
name|'if'
name|'not'
name|'cls'
op|'.'
name|'segments_container'
op|'.'
name|'create'
op|'('
op|')'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'ResponseError'
op|'('
name|'cls'
op|'.'
name|'conn'
op|'.'
name|'response'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'seg1'
op|'='
name|'cls'
op|'.'
name|'segments_container'
op|'.'
name|'file'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
name|'seg1'
op|'.'
name|'write'
op|'('
string|"'1'"
op|'*'
number|'1024'
op|'*'
number|'1024'
op|')'
newline|'\n'
nl|'\n'
name|'seg2'
op|'='
name|'cls'
op|'.'
name|'segments_container'
op|'.'
name|'file'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
name|'seg2'
op|'.'
name|'write'
op|'('
string|"'2'"
op|'*'
number|'1024'
op|'*'
number|'1024'
op|')'
newline|'\n'
nl|'\n'
name|'cls'
op|'.'
name|'manifest_data'
op|'='
op|'['
op|'{'
string|"'size_bytes'"
op|':'
number|'1024'
op|'*'
number|'1024'
op|','
nl|'\n'
string|"'etag'"
op|':'
name|'seg1'
op|'.'
name|'md5'
op|','
nl|'\n'
string|"'path'"
op|':'
string|"'/%s/%s'"
op|'%'
op|'('
name|'cls'
op|'.'
name|'segments_container'
op|'.'
name|'name'
op|','
nl|'\n'
name|'seg1'
op|'.'
name|'name'
op|')'
op|'}'
op|','
nl|'\n'
op|'{'
string|"'size_bytes'"
op|':'
number|'1024'
op|'*'
number|'1024'
op|','
nl|'\n'
string|"'etag'"
op|':'
name|'seg2'
op|'.'
name|'md5'
op|','
nl|'\n'
string|"'path'"
op|':'
string|"'/%s/%s'"
op|'%'
op|'('
name|'cls'
op|'.'
name|'segments_container'
op|'.'
name|'name'
op|','
nl|'\n'
name|'seg2'
op|'.'
name|'name'
op|')'
op|'}'
op|']'
newline|'\n'
nl|'\n'
name|'cls'
op|'.'
name|'manifest'
op|'='
name|'cls'
op|'.'
name|'manifest_container'
op|'.'
name|'file'
op|'('
name|'Utils'
op|'.'
name|'create_name'
op|'('
op|')'
op|')'
newline|'\n'
name|'cls'
op|'.'
name|'manifest'
op|'.'
name|'write'
op|'('
nl|'\n'
name|'json'
op|'.'
name|'dumps'
op|'('
name|'cls'
op|'.'
name|'manifest_data'
op|')'
op|','
nl|'\n'
name|'parms'
op|'='
op|'{'
string|"'multipart-manifest'"
op|':'
string|"'put'"
op|'}'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|TestSloTempurl
dedent|''
dedent|''
name|'class'
name|'TestSloTempurl'
op|'('
name|'Base'
op|')'
op|':'
newline|'\n'
DECL|variable|env
indent|'    '
name|'env'
op|'='
name|'TestSloTempurlEnv'
newline|'\n'
DECL|variable|set_up
name|'set_up'
op|'='
name|'False'
newline|'\n'
nl|'\n'
DECL|member|setUp
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'super'
op|'('
name|'TestSloTempurl'
op|','
name|'self'
op|')'
op|'.'
name|'setUp'
op|'('
op|')'
newline|'\n'
name|'if'
name|'self'
op|'.'
name|'env'
op|'.'
name|'enabled'
name|'is'
name|'False'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'SkipTest'
op|'('
string|'"TempURL and SLO not both enabled"'
op|')'
newline|'\n'
dedent|''
name|'elif'
name|'self'
op|'.'
name|'env'
op|'.'
name|'enabled'
name|'is'
name|'not'
name|'True'
op|':'
newline|'\n'
comment|'# just some sanity checking'
nl|'\n'
indent|'            '
name|'raise'
name|'Exception'
op|'('
nl|'\n'
string|'"Expected enabled to be True/False, got %r"'
op|'%'
nl|'\n'
op|'('
name|'self'
op|'.'
name|'env'
op|'.'
name|'enabled'
op|','
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|tempurl_sig
dedent|''
dedent|''
name|'def'
name|'tempurl_sig'
op|'('
name|'self'
op|','
name|'method'
op|','
name|'expires'
op|','
name|'path'
op|','
name|'key'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'hmac'
op|'.'
name|'new'
op|'('
nl|'\n'
name|'key'
op|','
nl|'\n'
string|"'%s\\n%s\\n%s'"
op|'%'
op|'('
name|'method'
op|','
name|'expires'
op|','
name|'urllib'
op|'.'
name|'parse'
op|'.'
name|'unquote'
op|'('
name|'path'
op|')'
op|')'
op|','
nl|'\n'
name|'hashlib'
op|'.'
name|'sha1'
op|')'
op|'.'
name|'hexdigest'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_GET
dedent|''
name|'def'
name|'test_GET'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'expires'
op|'='
name|'int'
op|'('
name|'time'
op|'.'
name|'time'
op|'('
op|')'
op|')'
op|'+'
number|'86400'
newline|'\n'
name|'sig'
op|'='
name|'self'
op|'.'
name|'tempurl_sig'
op|'('
nl|'\n'
string|"'GET'"
op|','
name|'expires'
op|','
name|'self'
op|'.'
name|'env'
op|'.'
name|'conn'
op|'.'
name|'make_path'
op|'('
name|'self'
op|'.'
name|'env'
op|'.'
name|'manifest'
op|'.'
name|'path'
op|')'
op|','
nl|'\n'
name|'self'
op|'.'
name|'env'
op|'.'
name|'tempurl_key'
op|')'
newline|'\n'
name|'parms'
op|'='
op|'{'
string|"'temp_url_sig'"
op|':'
name|'sig'
op|','
string|"'temp_url_expires'"
op|':'
name|'str'
op|'('
name|'expires'
op|')'
op|'}'
newline|'\n'
nl|'\n'
name|'contents'
op|'='
name|'self'
op|'.'
name|'env'
op|'.'
name|'manifest'
op|'.'
name|'read'
op|'('
nl|'\n'
name|'parms'
op|'='
name|'parms'
op|','
nl|'\n'
name|'cfg'
op|'='
op|'{'
string|"'no_auth_token'"
op|':'
name|'True'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'len'
op|'('
name|'contents'
op|')'
op|','
number|'2'
op|'*'
number|'1024'
op|'*'
number|'1024'
op|')'
newline|'\n'
nl|'\n'
comment|'# GET tempurls also allow HEAD requests'
nl|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'self'
op|'.'
name|'env'
op|'.'
name|'manifest'
op|'.'
name|'info'
op|'('
nl|'\n'
name|'parms'
op|'='
name|'parms'
op|','
name|'cfg'
op|'='
op|'{'
string|"'no_auth_token'"
op|':'
name|'True'
op|'}'
op|')'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|TestSloTempurlUTF8
dedent|''
dedent|''
name|'class'
name|'TestSloTempurlUTF8'
op|'('
name|'Base2'
op|','
name|'TestSloTempurl'
op|')'
op|':'
newline|'\n'
DECL|variable|set_up
indent|'    '
name|'set_up'
op|'='
name|'False'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|TestServiceToken
dedent|''
name|'class'
name|'TestServiceToken'
op|'('
name|'unittest2'
op|'.'
name|'TestCase'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|member|setUp
indent|'    '
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'tf'
op|'.'
name|'skip_service_tokens'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'SkipTest'
newline|'\n'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'SET_TO_USERS_TOKEN'
op|'='
number|'1'
newline|'\n'
name|'self'
op|'.'
name|'SET_TO_SERVICE_TOKEN'
op|'='
number|'2'
newline|'\n'
nl|'\n'
comment|'# keystoneauth and tempauth differ in allowing PUT account'
nl|'\n'
comment|'# Even if keystoneauth allows it, the proxy-server uses'
nl|'\n'
comment|'# allow_account_management to decide if accounts can be created'
nl|'\n'
name|'self'
op|'.'
name|'put_account_expect'
op|'='
name|'is_client_error'
newline|'\n'
name|'if'
name|'tf'
op|'.'
name|'swift_test_auth_version'
op|'!='
string|"'1'"
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'cluster_info'
op|'.'
name|'get'
op|'('
string|"'swift'"
op|')'
op|'.'
name|'get'
op|'('
string|"'allow_account_management'"
op|')'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'put_account_expect'
op|'='
name|'is_success'
newline|'\n'
nl|'\n'
DECL|member|_scenario_generator
dedent|''
dedent|''
dedent|''
name|'def'
name|'_scenario_generator'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'paths'
op|'='
op|'('
op|'('
name|'None'
op|','
name|'None'
op|')'
op|','
op|'('
string|"'c'"
op|','
name|'None'
op|')'
op|','
op|'('
string|"'c'"
op|','
string|"'o'"
op|')'
op|')'
newline|'\n'
name|'for'
name|'path'
name|'in'
name|'paths'
op|':'
newline|'\n'
indent|'            '
name|'for'
name|'method'
name|'in'
op|'('
string|"'PUT'"
op|','
string|"'POST'"
op|','
string|"'HEAD'"
op|','
string|"'GET'"
op|','
string|"'OPTIONS'"
op|')'
op|':'
newline|'\n'
indent|'                '
name|'yield'
name|'method'
op|','
name|'path'
op|'['
number|'0'
op|']'
op|','
name|'path'
op|'['
number|'1'
op|']'
newline|'\n'
dedent|''
dedent|''
name|'for'
name|'path'
name|'in'
name|'reversed'
op|'('
name|'paths'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'yield'
string|"'DELETE'"
op|','
name|'path'
op|'['
number|'0'
op|']'
op|','
name|'path'
op|'['
number|'1'
op|']'
newline|'\n'
nl|'\n'
DECL|member|_assert_is_authed_response
dedent|''
dedent|''
name|'def'
name|'_assert_is_authed_response'
op|'('
name|'self'
op|','
name|'method'
op|','
name|'container'
op|','
name|'object'
op|','
name|'resp'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'expect'
op|'='
name|'is_success'
newline|'\n'
name|'if'
name|'method'
op|'=='
string|"'DELETE'"
name|'and'
name|'not'
name|'container'
op|':'
newline|'\n'
indent|'            '
name|'expect'
op|'='
name|'is_client_error'
newline|'\n'
dedent|''
name|'if'
name|'method'
op|'=='
string|"'PUT'"
name|'and'
name|'not'
name|'container'
op|':'
newline|'\n'
indent|'            '
name|'expect'
op|'='
name|'self'
op|'.'
name|'put_account_expect'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'expect'
op|'('
name|'resp'
op|'.'
name|'status'
op|')'
op|','
string|"'Unexpected %s for %s %s %s'"
nl|'\n'
op|'%'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
name|'method'
op|','
name|'container'
op|','
name|'object'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_assert_not_authed_response
dedent|''
name|'def'
name|'_assert_not_authed_response'
op|'('
name|'self'
op|','
name|'method'
op|','
name|'container'
op|','
name|'object'
op|','
name|'resp'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'expect'
op|'='
name|'is_client_error'
newline|'\n'
name|'if'
name|'method'
op|'=='
string|"'OPTIONS'"
op|':'
newline|'\n'
indent|'            '
name|'expect'
op|'='
name|'is_success'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'expect'
op|'('
name|'resp'
op|'.'
name|'status'
op|')'
op|','
string|"'Unexpected %s for %s %s %s'"
nl|'\n'
op|'%'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
name|'method'
op|','
name|'container'
op|','
name|'object'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|prepare_request
dedent|''
name|'def'
name|'prepare_request'
op|'('
name|'self'
op|','
name|'method'
op|','
name|'use_service_account'
op|'='
name|'False'
op|','
nl|'\n'
name|'container'
op|'='
name|'None'
op|','
name|'obj'
op|'='
name|'None'
op|','
name|'body'
op|'='
name|'None'
op|','
name|'headers'
op|'='
name|'None'
op|','
nl|'\n'
name|'x_auth_token'
op|'='
name|'None'
op|','
nl|'\n'
name|'x_service_token'
op|'='
name|'None'
op|','
name|'dbg'
op|'='
name|'False'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        Setup for making the request\n\n        When retry() calls the do_request() function, it calls it the\n        test user\'s token, the parsed path, a connection and (optionally)\n        a token from the test service user. We save options here so that\n        do_request() can make the appropriate request.\n\n        :param method: The operation (e.g. \'HEAD\')\n        :param use_service_account: Optional. Set True to change the path to\n               be the service account\n        :param container: Optional. Adds a container name to the path\n        :param obj: Optional. Adds an object name to the path\n        :param body: Optional. Adds a body (string) in the request\n        :param headers: Optional. Adds additional headers.\n        :param x_auth_token: Optional. Default is SET_TO_USERS_TOKEN. One of:\n                   SET_TO_USERS_TOKEN     Put the test user\'s token in\n                                          X-Auth-Token\n                   SET_TO_SERVICE_TOKEN   Put the service token in X-Auth-Token\n        :param x_service_token: Optional. Default is to not set X-Service-Token\n                   to any value. If specified, is one of following:\n                   SET_TO_USERS_TOKEN     Put the test user\'s token in\n                                          X-Service-Token\n                   SET_TO_SERVICE_TOKEN   Put the service token in\n                                          X-Service-Token\n        :param dbg: Optional. Set true to check request arguments\n        """'
newline|'\n'
name|'self'
op|'.'
name|'method'
op|'='
name|'method'
newline|'\n'
name|'self'
op|'.'
name|'use_service_account'
op|'='
name|'use_service_account'
newline|'\n'
name|'self'
op|'.'
name|'container'
op|'='
name|'container'
newline|'\n'
name|'self'
op|'.'
name|'obj'
op|'='
name|'obj'
newline|'\n'
name|'self'
op|'.'
name|'body'
op|'='
name|'body'
newline|'\n'
name|'self'
op|'.'
name|'headers'
op|'='
name|'headers'
newline|'\n'
name|'if'
name|'x_auth_token'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'x_auth_token'
op|'='
name|'x_auth_token'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'x_auth_token'
op|'='
name|'self'
op|'.'
name|'SET_TO_USERS_TOKEN'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'x_service_token'
op|'='
name|'x_service_token'
newline|'\n'
name|'self'
op|'.'
name|'dbg'
op|'='
name|'dbg'
newline|'\n'
nl|'\n'
DECL|member|do_request
dedent|''
name|'def'
name|'do_request'
op|'('
name|'self'
op|','
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|','
name|'service_token'
op|'='
string|"''"
op|')'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'self'
op|'.'
name|'use_service_account'
op|':'
newline|'\n'
indent|'                '
name|'path'
op|'='
name|'self'
op|'.'
name|'_service_account'
op|'('
name|'parsed'
op|'.'
name|'path'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                '
name|'path'
op|'='
name|'parsed'
op|'.'
name|'path'
newline|'\n'
dedent|''
name|'if'
name|'self'
op|'.'
name|'container'
op|':'
newline|'\n'
indent|'                '
name|'path'
op|'+='
string|"'/%s'"
op|'%'
name|'self'
op|'.'
name|'container'
newline|'\n'
dedent|''
name|'if'
name|'self'
op|'.'
name|'obj'
op|':'
newline|'\n'
indent|'                '
name|'path'
op|'+='
string|"'/%s'"
op|'%'
name|'self'
op|'.'
name|'obj'
newline|'\n'
dedent|''
name|'headers'
op|'='
op|'{'
op|'}'
newline|'\n'
name|'if'
name|'self'
op|'.'
name|'body'
op|':'
newline|'\n'
indent|'                '
name|'headers'
op|'.'
name|'update'
op|'('
op|'{'
string|"'Content-Length'"
op|':'
name|'len'
op|'('
name|'self'
op|'.'
name|'body'
op|')'
op|'}'
op|')'
newline|'\n'
dedent|''
name|'if'
name|'self'
op|'.'
name|'x_auth_token'
op|'=='
name|'self'
op|'.'
name|'SET_TO_USERS_TOKEN'
op|':'
newline|'\n'
indent|'                '
name|'headers'
op|'.'
name|'update'
op|'('
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|'}'
op|')'
newline|'\n'
dedent|''
name|'elif'
name|'self'
op|'.'
name|'x_auth_token'
op|'=='
name|'self'
op|'.'
name|'SET_TO_SERVICE_TOKEN'
op|':'
newline|'\n'
indent|'                '
name|'headers'
op|'.'
name|'update'
op|'('
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'service_token'
op|'}'
op|')'
newline|'\n'
dedent|''
name|'if'
name|'self'
op|'.'
name|'x_service_token'
op|'=='
name|'self'
op|'.'
name|'SET_TO_USERS_TOKEN'
op|':'
newline|'\n'
indent|'                '
name|'headers'
op|'.'
name|'update'
op|'('
op|'{'
string|"'X-Service-Token'"
op|':'
name|'token'
op|'}'
op|')'
newline|'\n'
dedent|''
name|'elif'
name|'self'
op|'.'
name|'x_service_token'
op|'=='
name|'self'
op|'.'
name|'SET_TO_SERVICE_TOKEN'
op|':'
newline|'\n'
indent|'                '
name|'headers'
op|'.'
name|'update'
op|'('
op|'{'
string|"'X-Service-Token'"
op|':'
name|'service_token'
op|'}'
op|')'
newline|'\n'
dedent|''
name|'if'
name|'self'
op|'.'
name|'dbg'
op|':'
newline|'\n'
indent|'                '
name|'print'
op|'('
string|"'DEBUG: conn.request: method:%s path:%s'"
nl|'\n'
string|"' body:%s headers:%s'"
op|'%'
op|'('
name|'self'
op|'.'
name|'method'
op|','
name|'path'
op|','
name|'self'
op|'.'
name|'body'
op|','
nl|'\n'
name|'headers'
op|')'
op|')'
newline|'\n'
dedent|''
name|'conn'
op|'.'
name|'request'
op|'('
name|'self'
op|'.'
name|'method'
op|','
name|'path'
op|','
name|'self'
op|'.'
name|'body'
op|','
name|'headers'
op|'='
name|'headers'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_service_account
dedent|''
name|'def'
name|'_service_account'
op|'('
name|'self'
op|','
name|'path'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'parts'
op|'='
name|'path'
op|'.'
name|'split'
op|'('
string|"'/'"
op|','
number|'3'
op|')'
newline|'\n'
name|'account'
op|'='
name|'parts'
op|'['
number|'2'
op|']'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'project_id'
op|'='
name|'account'
op|'['
name|'account'
op|'.'
name|'index'
op|'('
string|"'_'"
op|')'
op|'+'
number|'1'
op|':'
op|']'
newline|'\n'
dedent|''
name|'except'
name|'ValueError'
op|':'
newline|'\n'
indent|'            '
name|'project_id'
op|'='
name|'account'
newline|'\n'
dedent|''
name|'parts'
op|'['
number|'2'
op|']'
op|'='
string|"'%s%s'"
op|'%'
op|'('
name|'tf'
op|'.'
name|'swift_test_service_prefix'
op|','
name|'project_id'
op|')'
newline|'\n'
name|'return'
string|"'/'"
op|'.'
name|'join'
op|'('
name|'parts'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_user_access_own_auth_account
dedent|''
name|'def'
name|'test_user_access_own_auth_account'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# This covers ground tested elsewhere (tests a user doing HEAD'
nl|'\n'
comment|'# on own account). However, if this fails, none of the remaining'
nl|'\n'
comment|'# tests will work'
nl|'\n'
indent|'        '
name|'self'
op|'.'
name|'prepare_request'
op|'('
string|"'HEAD'"
op|')'
newline|'\n'
name|'resp'
op|'='
name|'retry'
op|'('
name|'self'
op|'.'
name|'do_request'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertIn'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
op|'('
number|'200'
op|','
number|'204'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_user_cannot_access_service_account
dedent|''
name|'def'
name|'test_user_cannot_access_service_account'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'for'
name|'method'
op|','
name|'container'
op|','
name|'obj'
name|'in'
name|'self'
op|'.'
name|'_scenario_generator'
op|'('
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'prepare_request'
op|'('
name|'method'
op|','
name|'use_service_account'
op|'='
name|'True'
op|','
nl|'\n'
name|'container'
op|'='
name|'container'
op|','
name|'obj'
op|'='
name|'obj'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'retry'
op|'('
name|'self'
op|'.'
name|'do_request'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_assert_not_authed_response'
op|'('
name|'method'
op|','
name|'container'
op|','
name|'obj'
op|','
name|'resp'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_service_user_denied_with_x_auth_token
dedent|''
dedent|''
name|'def'
name|'test_service_user_denied_with_x_auth_token'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'for'
name|'method'
op|','
name|'container'
op|','
name|'obj'
name|'in'
name|'self'
op|'.'
name|'_scenario_generator'
op|'('
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'prepare_request'
op|'('
name|'method'
op|','
name|'use_service_account'
op|'='
name|'True'
op|','
nl|'\n'
name|'container'
op|'='
name|'container'
op|','
name|'obj'
op|'='
name|'obj'
op|','
nl|'\n'
name|'x_auth_token'
op|'='
name|'self'
op|'.'
name|'SET_TO_SERVICE_TOKEN'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'retry'
op|'('
name|'self'
op|'.'
name|'do_request'
op|','
name|'service_user'
op|'='
number|'5'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_assert_not_authed_response'
op|'('
name|'method'
op|','
name|'container'
op|','
name|'obj'
op|','
name|'resp'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_service_user_denied_with_x_service_token
dedent|''
dedent|''
name|'def'
name|'test_service_user_denied_with_x_service_token'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'for'
name|'method'
op|','
name|'container'
op|','
name|'obj'
name|'in'
name|'self'
op|'.'
name|'_scenario_generator'
op|'('
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'prepare_request'
op|'('
name|'method'
op|','
name|'use_service_account'
op|'='
name|'True'
op|','
nl|'\n'
name|'container'
op|'='
name|'container'
op|','
name|'obj'
op|'='
name|'obj'
op|','
nl|'\n'
name|'x_auth_token'
op|'='
name|'self'
op|'.'
name|'SET_TO_SERVICE_TOKEN'
op|','
nl|'\n'
name|'x_service_token'
op|'='
name|'self'
op|'.'
name|'SET_TO_SERVICE_TOKEN'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'retry'
op|'('
name|'self'
op|'.'
name|'do_request'
op|','
name|'service_user'
op|'='
number|'5'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_assert_not_authed_response'
op|'('
name|'method'
op|','
name|'container'
op|','
name|'obj'
op|','
name|'resp'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_user_plus_service_can_access_service_account
dedent|''
dedent|''
name|'def'
name|'test_user_plus_service_can_access_service_account'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'for'
name|'method'
op|','
name|'container'
op|','
name|'obj'
name|'in'
name|'self'
op|'.'
name|'_scenario_generator'
op|'('
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'prepare_request'
op|'('
name|'method'
op|','
name|'use_service_account'
op|'='
name|'True'
op|','
nl|'\n'
name|'container'
op|'='
name|'container'
op|','
name|'obj'
op|'='
name|'obj'
op|','
nl|'\n'
name|'x_auth_token'
op|'='
name|'self'
op|'.'
name|'SET_TO_USERS_TOKEN'
op|','
nl|'\n'
name|'x_service_token'
op|'='
name|'self'
op|'.'
name|'SET_TO_SERVICE_TOKEN'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'retry'
op|'('
name|'self'
op|'.'
name|'do_request'
op|','
name|'service_user'
op|'='
number|'5'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_assert_is_authed_response'
op|'('
name|'method'
op|','
name|'container'
op|','
name|'obj'
op|','
name|'resp'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
dedent|''
dedent|''
dedent|''
name|'if'
name|'__name__'
op|'=='
string|"'__main__'"
op|':'
newline|'\n'
indent|'    '
name|'unittest2'
op|'.'
name|'main'
op|'('
op|')'
newline|'\n'
dedent|''
endmarker|''
end_unit
