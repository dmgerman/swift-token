begin_unit
comment|'# Copyright (c) 2012 OpenStack Foundation'
nl|'\n'
comment|'#'
nl|'\n'
comment|'# Licensed under the Apache License, Version 2.0 (the "License");'
nl|'\n'
comment|'# you may not use this file except in compliance with the License.'
nl|'\n'
comment|'# You may obtain a copy of the License at'
nl|'\n'
comment|'#'
nl|'\n'
comment|'#    http://www.apache.org/licenses/LICENSE-2.0'
nl|'\n'
comment|'#'
nl|'\n'
comment|'# Unless required by applicable law or agreed to in writing, software'
nl|'\n'
comment|'# distributed under the License is distributed on an "AS IS" BASIS,'
nl|'\n'
comment|'# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or'
nl|'\n'
comment|'# implied.'
nl|'\n'
comment|'# See the License for the specific language governing permissions and'
nl|'\n'
comment|'# limitations under the License.'
nl|'\n'
nl|'\n'
name|'import'
name|'unittest'
newline|'\n'
nl|'\n'
name|'from'
name|'swift'
op|'.'
name|'common'
op|'.'
name|'middleware'
name|'import'
name|'keystoneauth'
newline|'\n'
name|'from'
name|'swift'
op|'.'
name|'common'
op|'.'
name|'swob'
name|'import'
name|'Request'
op|','
name|'Response'
newline|'\n'
name|'from'
name|'swift'
op|'.'
name|'common'
op|'.'
name|'http'
name|'import'
name|'HTTP_FORBIDDEN'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|FakeApp
name|'class'
name|'FakeApp'
op|'('
name|'object'
op|')'
op|':'
newline|'\n'
DECL|member|__init__
indent|'    '
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'status_headers_body_iter'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'calls'
op|'='
number|'0'
newline|'\n'
name|'self'
op|'.'
name|'status_headers_body_iter'
op|'='
name|'status_headers_body_iter'
newline|'\n'
name|'if'
name|'not'
name|'self'
op|'.'
name|'status_headers_body_iter'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'status_headers_body_iter'
op|'='
name|'iter'
op|'('
op|'['
op|'('
string|"'404 Not Found'"
op|','
op|'{'
op|'}'
op|','
string|"''"
op|')'
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|__call__
dedent|''
dedent|''
name|'def'
name|'__call__'
op|'('
name|'self'
op|','
name|'env'
op|','
name|'start_response'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'calls'
op|'+='
number|'1'
newline|'\n'
name|'self'
op|'.'
name|'request'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"''"
op|','
name|'environ'
op|'='
name|'env'
op|')'
newline|'\n'
name|'if'
string|"'swift.authorize'"
name|'in'
name|'env'
op|':'
newline|'\n'
indent|'            '
name|'resp'
op|'='
name|'env'
op|'['
string|"'swift.authorize'"
op|']'
op|'('
name|'self'
op|'.'
name|'request'
op|')'
newline|'\n'
name|'if'
name|'resp'
op|':'
newline|'\n'
indent|'                '
name|'return'
name|'resp'
op|'('
name|'env'
op|','
name|'start_response'
op|')'
newline|'\n'
dedent|''
dedent|''
name|'status'
op|','
name|'headers'
op|','
name|'body'
op|'='
name|'self'
op|'.'
name|'status_headers_body_iter'
op|'.'
name|'next'
op|'('
op|')'
newline|'\n'
name|'return'
name|'Response'
op|'('
name|'status'
op|'='
name|'status'
op|','
name|'headers'
op|'='
name|'headers'
op|','
nl|'\n'
name|'body'
op|'='
name|'body'
op|')'
op|'('
name|'env'
op|','
name|'start_response'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|SwiftAuth
dedent|''
dedent|''
name|'class'
name|'SwiftAuth'
op|'('
name|'unittest'
op|'.'
name|'TestCase'
op|')'
op|':'
newline|'\n'
DECL|member|setUp
indent|'    '
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'test_auth'
op|'='
name|'keystoneauth'
op|'.'
name|'filter_factory'
op|'('
op|'{'
op|'}'
op|')'
op|'('
name|'FakeApp'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_make_request
dedent|''
name|'def'
name|'_make_request'
op|'('
name|'self'
op|','
name|'path'
op|'='
name|'None'
op|','
name|'headers'
op|'='
name|'None'
op|','
op|'**'
name|'kwargs'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'not'
name|'path'
op|':'
newline|'\n'
indent|'            '
name|'path'
op|'='
string|"'/v1/%s/c/o'"
op|'%'
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'_get_account_for_tenant'
op|'('
string|"'foo'"
op|')'
newline|'\n'
dedent|''
name|'return'
name|'Request'
op|'.'
name|'blank'
op|'('
name|'path'
op|','
name|'headers'
op|'='
name|'headers'
op|','
op|'**'
name|'kwargs'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_get_identity_headers
dedent|''
name|'def'
name|'_get_identity_headers'
op|'('
name|'self'
op|','
name|'status'
op|'='
string|"'Confirmed'"
op|','
name|'tenant_id'
op|'='
string|"'1'"
op|','
nl|'\n'
name|'tenant_name'
op|'='
string|"'acct'"
op|','
name|'user'
op|'='
string|"'usr'"
op|','
name|'role'
op|'='
string|"''"
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'dict'
op|'('
name|'X_IDENTITY_STATUS'
op|'='
name|'status'
op|','
nl|'\n'
name|'X_TENANT_ID'
op|'='
name|'tenant_id'
op|','
nl|'\n'
name|'X_TENANT_NAME'
op|'='
name|'tenant_name'
op|','
nl|'\n'
name|'X_ROLES'
op|'='
name|'role'
op|','
nl|'\n'
name|'X_USER_NAME'
op|'='
name|'user'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_get_successful_middleware
dedent|''
name|'def'
name|'_get_successful_middleware'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'response_iter'
op|'='
name|'iter'
op|'('
op|'['
op|'('
string|"'200 OK'"
op|','
op|'{'
op|'}'
op|','
string|"''"
op|')'
op|']'
op|')'
newline|'\n'
name|'return'
name|'keystoneauth'
op|'.'
name|'filter_factory'
op|'('
op|'{'
op|'}'
op|')'
op|'('
name|'FakeApp'
op|'('
name|'response_iter'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_invalid_request_authorized
dedent|''
name|'def'
name|'test_invalid_request_authorized'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'role'
op|'='
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'reseller_admin_role'
newline|'\n'
name|'headers'
op|'='
name|'self'
op|'.'
name|'_get_identity_headers'
op|'('
name|'role'
op|'='
name|'role'
op|')'
newline|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/'"
op|','
name|'headers'
op|'='
name|'headers'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'_get_successful_middleware'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'404'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_invalid_request_non_authorized
dedent|''
name|'def'
name|'test_invalid_request_non_authorized'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/'"
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'_get_successful_middleware'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'404'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_confirmed_identity_is_authorized
dedent|''
name|'def'
name|'test_confirmed_identity_is_authorized'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'role'
op|'='
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'reseller_admin_role'
newline|'\n'
name|'headers'
op|'='
name|'self'
op|'.'
name|'_get_identity_headers'
op|'('
name|'role'
op|'='
name|'role'
op|')'
newline|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/v1/AUTH_acct/c'"
op|','
name|'headers'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'_get_successful_middleware'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'200'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_detect_reseller_request
dedent|''
name|'def'
name|'test_detect_reseller_request'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'role'
op|'='
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'reseller_admin_role'
newline|'\n'
name|'headers'
op|'='
name|'self'
op|'.'
name|'_get_identity_headers'
op|'('
name|'role'
op|'='
name|'role'
op|')'
newline|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/v1/AUTH_acct/c'"
op|','
name|'headers'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'_get_successful_middleware'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'req'
op|'.'
name|'environ'
op|'.'
name|'get'
op|'('
string|"'reseller_request'"
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_confirmed_identity_is_not_authorized
dedent|''
name|'def'
name|'test_confirmed_identity_is_not_authorized'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'headers'
op|'='
name|'self'
op|'.'
name|'_get_identity_headers'
op|'('
op|')'
newline|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/v1/AUTH_acct/c'"
op|','
name|'headers'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'403'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_anonymous_is_authorized_for_permitted_referrer
dedent|''
name|'def'
name|'test_anonymous_is_authorized_for_permitted_referrer'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
name|'headers'
op|'='
op|'{'
string|"'X_IDENTITY_STATUS'"
op|':'
string|"'Invalid'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'acl'
op|'='
string|"'.r:*'"
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'_get_successful_middleware'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'200'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_anonymous_with_validtoken_authorized_for_permitted_referrer
dedent|''
name|'def'
name|'test_anonymous_with_validtoken_authorized_for_permitted_referrer'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
name|'headers'
op|'='
op|'{'
string|"'X_IDENTITY_STATUS'"
op|':'
string|"'Confirmed'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'acl'
op|'='
string|"'.r:*'"
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'_get_successful_middleware'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'200'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_anonymous_is_not_authorized_for_unknown_reseller_prefix
dedent|''
name|'def'
name|'test_anonymous_is_not_authorized_for_unknown_reseller_prefix'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
name|'path'
op|'='
string|"'/v1/BLAH_foo/c/o'"
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X_IDENTITY_STATUS'"
op|':'
string|"'Invalid'"
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'401'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_blank_reseller_prefix
dedent|''
name|'def'
name|'test_blank_reseller_prefix'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'conf'
op|'='
op|'{'
string|"'reseller_prefix'"
op|':'
string|"''"
op|'}'
newline|'\n'
name|'test_auth'
op|'='
name|'keystoneauth'
op|'.'
name|'filter_factory'
op|'('
name|'conf'
op|')'
op|'('
name|'FakeApp'
op|'('
op|')'
op|')'
newline|'\n'
name|'account'
op|'='
name|'tenant_id'
op|'='
string|"'foo'"
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'test_auth'
op|'.'
name|'_reseller_check'
op|'('
name|'account'
op|','
name|'tenant_id'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_reseller_prefix_added_underscore
dedent|''
name|'def'
name|'test_reseller_prefix_added_underscore'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'conf'
op|'='
op|'{'
string|"'reseller_prefix'"
op|':'
string|"'AUTH'"
op|'}'
newline|'\n'
name|'test_auth'
op|'='
name|'keystoneauth'
op|'.'
name|'filter_factory'
op|'('
name|'conf'
op|')'
op|'('
name|'FakeApp'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'test_auth'
op|'.'
name|'reseller_prefix'
op|','
string|'"AUTH_"'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_reseller_prefix_not_added_double_underscores
dedent|''
name|'def'
name|'test_reseller_prefix_not_added_double_underscores'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'conf'
op|'='
op|'{'
string|"'reseller_prefix'"
op|':'
string|"'AUTH_'"
op|'}'
newline|'\n'
name|'test_auth'
op|'='
name|'keystoneauth'
op|'.'
name|'filter_factory'
op|'('
name|'conf'
op|')'
op|'('
name|'FakeApp'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'test_auth'
op|'.'
name|'reseller_prefix'
op|','
string|'"AUTH_"'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_override_asked_for_but_not_allowed
dedent|''
name|'def'
name|'test_override_asked_for_but_not_allowed'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'conf'
op|'='
op|'{'
string|"'allow_overrides'"
op|':'
string|"'false'"
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'test_auth'
op|'='
name|'keystoneauth'
op|'.'
name|'filter_factory'
op|'('
name|'conf'
op|')'
op|'('
name|'FakeApp'
op|'('
op|')'
op|')'
newline|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/v1/AUTH_account'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'swift.authorize_override'"
op|':'
name|'True'
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'401'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_override_asked_for_and_allowed
dedent|''
name|'def'
name|'test_override_asked_for_and_allowed'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'conf'
op|'='
op|'{'
string|"'allow_overrides'"
op|':'
string|"'true'"
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'test_auth'
op|'='
name|'keystoneauth'
op|'.'
name|'filter_factory'
op|'('
name|'conf'
op|')'
op|'('
name|'FakeApp'
op|'('
op|')'
op|')'
newline|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/v1/AUTH_account'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'swift.authorize_override'"
op|':'
name|'True'
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'404'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_override_default_allowed
dedent|''
name|'def'
name|'test_override_default_allowed'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/v1/AUTH_account'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'swift.authorize_override'"
op|':'
name|'True'
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'404'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_anonymous_options_allowed
dedent|''
name|'def'
name|'test_anonymous_options_allowed'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/v1/AUTH_account'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'OPTIONS'"
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'_get_successful_middleware'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'200'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_identified_options_allowed
dedent|''
name|'def'
name|'test_identified_options_allowed'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'headers'
op|'='
name|'self'
op|'.'
name|'_get_identity_headers'
op|'('
op|')'
newline|'\n'
name|'headers'
op|'['
string|"'REQUEST_METHOD'"
op|']'
op|'='
string|"'OPTIONS'"
newline|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/v1/AUTH_account'"
op|','
nl|'\n'
name|'headers'
op|'='
name|'self'
op|'.'
name|'_get_identity_headers'
op|'('
op|')'
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'OPTIONS'"
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'_get_successful_middleware'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'200'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_auth_scheme
dedent|''
name|'def'
name|'test_auth_scheme'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
name|'path'
op|'='
string|"'/v1/BLAH_foo/c/o'"
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X_IDENTITY_STATUS'"
op|':'
string|"'Invalid'"
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'401'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
string|"'Www-Authenticate'"
name|'in'
name|'resp'
op|'.'
name|'headers'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|TestAuthorize
dedent|''
dedent|''
name|'class'
name|'TestAuthorize'
op|'('
name|'unittest'
op|'.'
name|'TestCase'
op|')'
op|':'
newline|'\n'
DECL|member|setUp
indent|'    '
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'test_auth'
op|'='
name|'keystoneauth'
op|'.'
name|'filter_factory'
op|'('
op|'{'
op|'}'
op|')'
op|'('
name|'FakeApp'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_make_request
dedent|''
name|'def'
name|'_make_request'
op|'('
name|'self'
op|','
name|'path'
op|','
op|'**'
name|'kwargs'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'Request'
op|'.'
name|'blank'
op|'('
name|'path'
op|','
op|'**'
name|'kwargs'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_get_account
dedent|''
name|'def'
name|'_get_account'
op|'('
name|'self'
op|','
name|'identity'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'not'
name|'identity'
op|':'
newline|'\n'
indent|'            '
name|'identity'
op|'='
name|'self'
op|'.'
name|'_get_identity'
op|'('
op|')'
newline|'\n'
dedent|''
name|'return'
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'_get_account_for_tenant'
op|'('
nl|'\n'
name|'identity'
op|'['
string|"'HTTP_X_TENANT_ID'"
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_get_identity
dedent|''
name|'def'
name|'_get_identity'
op|'('
name|'self'
op|','
name|'tenant_id'
op|'='
string|"'tenant_id'"
op|','
name|'tenant_name'
op|'='
string|"'tenant_name'"
op|','
nl|'\n'
name|'user_id'
op|'='
string|"'user_id'"
op|','
name|'user_name'
op|'='
string|"'user_name'"
op|','
name|'roles'
op|'='
op|'['
op|']'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'isinstance'
op|'('
name|'roles'
op|','
name|'list'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'roles'
op|'='
string|"','"
op|'.'
name|'join'
op|'('
name|'roles'
op|')'
newline|'\n'
dedent|''
name|'return'
op|'{'
string|"'HTTP_X_USER_ID'"
op|':'
name|'user_id'
op|','
nl|'\n'
string|"'HTTP_X_USER_NAME'"
op|':'
name|'user_name'
op|','
nl|'\n'
string|"'HTTP_X_TENANT_ID'"
op|':'
name|'tenant_id'
op|','
nl|'\n'
string|"'HTTP_X_TENANT_NAME'"
op|':'
name|'tenant_name'
op|','
nl|'\n'
string|"'HTTP_X_ROLES'"
op|':'
name|'roles'
op|','
nl|'\n'
string|"'HTTP_X_IDENTITY_STATUS'"
op|':'
string|"'Confirmed'"
op|'}'
newline|'\n'
nl|'\n'
DECL|member|_check_authenticate
dedent|''
name|'def'
name|'_check_authenticate'
op|'('
name|'self'
op|','
name|'account'
op|'='
name|'None'
op|','
name|'identity'
op|'='
name|'None'
op|','
name|'headers'
op|'='
name|'None'
op|','
nl|'\n'
name|'exception'
op|'='
name|'None'
op|','
name|'acl'
op|'='
name|'None'
op|','
name|'env'
op|'='
name|'None'
op|','
name|'path'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'not'
name|'identity'
op|':'
newline|'\n'
indent|'            '
name|'identity'
op|'='
name|'self'
op|'.'
name|'_get_identity'
op|'('
op|')'
newline|'\n'
dedent|''
name|'if'
name|'not'
name|'account'
op|':'
newline|'\n'
indent|'            '
name|'account'
op|'='
name|'self'
op|'.'
name|'_get_account'
op|'('
name|'identity'
op|')'
newline|'\n'
dedent|''
name|'if'
name|'not'
name|'path'
op|':'
newline|'\n'
indent|'            '
name|'path'
op|'='
string|"'/v1/%s/c'"
op|'%'
name|'account'
newline|'\n'
dedent|''
name|'default_env'
op|'='
op|'{'
string|"'REMOTE_USER'"
op|':'
name|'identity'
op|'['
string|"'HTTP_X_TENANT_ID'"
op|']'
op|'}'
newline|'\n'
name|'default_env'
op|'.'
name|'update'
op|'('
name|'identity'
op|')'
newline|'\n'
name|'if'
name|'env'
op|':'
newline|'\n'
indent|'            '
name|'default_env'
op|'.'
name|'update'
op|'('
name|'env'
op|')'
newline|'\n'
dedent|''
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
name|'path'
op|','
name|'headers'
op|'='
name|'headers'
op|','
name|'environ'
op|'='
name|'default_env'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'acl'
op|'='
name|'acl'
newline|'\n'
name|'result'
op|'='
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'authorize'
op|'('
name|'req'
op|')'
newline|'\n'
nl|'\n'
comment|'# if we have requested an exception but nothing came back then'
nl|'\n'
name|'if'
name|'exception'
name|'and'
name|'not'
name|'result'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'fail'
op|'('
string|'"error %s was not returned"'
op|'%'
op|'('
name|'str'
op|'('
name|'exception'
op|')'
op|')'
op|')'
newline|'\n'
dedent|''
name|'elif'
name|'exception'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'result'
op|'.'
name|'status_int'
op|','
name|'exception'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'result'
name|'is'
name|'None'
op|')'
newline|'\n'
dedent|''
name|'return'
name|'req'
newline|'\n'
nl|'\n'
DECL|member|test_authorize_fails_for_unauthorized_user
dedent|''
name|'def'
name|'test_authorize_fails_for_unauthorized_user'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_check_authenticate'
op|'('
name|'exception'
op|'='
name|'HTTP_FORBIDDEN'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_authorize_fails_for_invalid_reseller_prefix
dedent|''
name|'def'
name|'test_authorize_fails_for_invalid_reseller_prefix'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_check_authenticate'
op|'('
name|'account'
op|'='
string|"'BLAN_a'"
op|','
nl|'\n'
name|'exception'
op|'='
name|'HTTP_FORBIDDEN'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_authorize_succeeds_for_reseller_admin
dedent|''
name|'def'
name|'test_authorize_succeeds_for_reseller_admin'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'roles'
op|'='
op|'['
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'reseller_admin_role'
op|']'
newline|'\n'
name|'identity'
op|'='
name|'self'
op|'.'
name|'_get_identity'
op|'('
name|'roles'
op|'='
name|'roles'
op|')'
newline|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_check_authenticate'
op|'('
name|'identity'
op|'='
name|'identity'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'req'
op|'.'
name|'environ'
op|'.'
name|'get'
op|'('
string|"'swift_owner'"
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_authorize_succeeds_for_insensitive_reseller_admin
dedent|''
name|'def'
name|'test_authorize_succeeds_for_insensitive_reseller_admin'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'roles'
op|'='
op|'['
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'reseller_admin_role'
op|'.'
name|'upper'
op|'('
op|')'
op|']'
newline|'\n'
name|'identity'
op|'='
name|'self'
op|'.'
name|'_get_identity'
op|'('
name|'roles'
op|'='
name|'roles'
op|')'
newline|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_check_authenticate'
op|'('
name|'identity'
op|'='
name|'identity'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'req'
op|'.'
name|'environ'
op|'.'
name|'get'
op|'('
string|"'swift_owner'"
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_authorize_succeeds_as_owner_for_operator_role
dedent|''
name|'def'
name|'test_authorize_succeeds_as_owner_for_operator_role'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'roles'
op|'='
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'operator_roles'
op|'.'
name|'split'
op|'('
string|"','"
op|')'
newline|'\n'
name|'identity'
op|'='
name|'self'
op|'.'
name|'_get_identity'
op|'('
name|'roles'
op|'='
name|'roles'
op|')'
newline|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_check_authenticate'
op|'('
name|'identity'
op|'='
name|'identity'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'req'
op|'.'
name|'environ'
op|'.'
name|'get'
op|'('
string|"'swift_owner'"
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_authorize_succeeds_as_owner_for_insensitive_operator_role
dedent|''
name|'def'
name|'test_authorize_succeeds_as_owner_for_insensitive_operator_role'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'roles'
op|'='
op|'['
name|'r'
op|'.'
name|'upper'
op|'('
op|')'
name|'for'
name|'r'
name|'in'
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'operator_roles'
op|'.'
name|'split'
op|'('
string|"','"
op|')'
op|']'
newline|'\n'
name|'identity'
op|'='
name|'self'
op|'.'
name|'_get_identity'
op|'('
name|'roles'
op|'='
name|'roles'
op|')'
newline|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_check_authenticate'
op|'('
name|'identity'
op|'='
name|'identity'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'req'
op|'.'
name|'environ'
op|'.'
name|'get'
op|'('
string|"'swift_owner'"
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_check_authorize_for_tenant_owner_match
dedent|''
name|'def'
name|'_check_authorize_for_tenant_owner_match'
op|'('
name|'self'
op|','
name|'exception'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'identity'
op|'='
name|'self'
op|'.'
name|'_get_identity'
op|'('
name|'user_name'
op|'='
string|"'same_name'"
op|','
nl|'\n'
name|'tenant_name'
op|'='
string|"'same_name'"
op|')'
newline|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_check_authenticate'
op|'('
name|'identity'
op|'='
name|'identity'
op|','
name|'exception'
op|'='
name|'exception'
op|')'
newline|'\n'
name|'expected'
op|'='
name|'bool'
op|'('
name|'exception'
name|'is'
name|'None'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'bool'
op|'('
name|'req'
op|'.'
name|'environ'
op|'.'
name|'get'
op|'('
string|"'swift_owner'"
op|')'
op|')'
op|','
name|'expected'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_authorize_succeeds_as_owner_for_tenant_owner_match
dedent|''
name|'def'
name|'test_authorize_succeeds_as_owner_for_tenant_owner_match'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'is_admin'
op|'='
name|'True'
newline|'\n'
name|'self'
op|'.'
name|'_check_authorize_for_tenant_owner_match'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_authorize_fails_as_owner_for_tenant_owner_match
dedent|''
name|'def'
name|'test_authorize_fails_as_owner_for_tenant_owner_match'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'is_admin'
op|'='
name|'False'
newline|'\n'
name|'self'
op|'.'
name|'_check_authorize_for_tenant_owner_match'
op|'('
nl|'\n'
name|'exception'
op|'='
name|'HTTP_FORBIDDEN'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_authorize_succeeds_for_container_sync
dedent|''
name|'def'
name|'test_authorize_succeeds_for_container_sync'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'env'
op|'='
op|'{'
string|"'swift_sync_key'"
op|':'
string|"'foo'"
op|','
string|"'REMOTE_ADDR'"
op|':'
string|"'127.0.0.1'"
op|'}'
newline|'\n'
name|'headers'
op|'='
op|'{'
string|"'x-container-sync-key'"
op|':'
string|"'foo'"
op|','
string|"'x-timestamp'"
op|':'
string|"'1'"
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'_check_authenticate'
op|'('
name|'env'
op|'='
name|'env'
op|','
name|'headers'
op|'='
name|'headers'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_authorize_fails_for_invalid_referrer
dedent|''
name|'def'
name|'test_authorize_fails_for_invalid_referrer'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'env'
op|'='
op|'{'
string|"'HTTP_REFERER'"
op|':'
string|"'http://invalid.com/index.html'"
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'_check_authenticate'
op|'('
name|'acl'
op|'='
string|"'.r:example.com'"
op|','
name|'env'
op|'='
name|'env'
op|','
nl|'\n'
name|'exception'
op|'='
name|'HTTP_FORBIDDEN'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_authorize_fails_for_referrer_without_rlistings
dedent|''
name|'def'
name|'test_authorize_fails_for_referrer_without_rlistings'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'env'
op|'='
op|'{'
string|"'HTTP_REFERER'"
op|':'
string|"'http://example.com/index.html'"
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'_check_authenticate'
op|'('
name|'acl'
op|'='
string|"'.r:example.com'"
op|','
name|'env'
op|'='
name|'env'
op|','
nl|'\n'
name|'exception'
op|'='
name|'HTTP_FORBIDDEN'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_authorize_succeeds_for_referrer_with_rlistings
dedent|''
name|'def'
name|'test_authorize_succeeds_for_referrer_with_rlistings'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'env'
op|'='
op|'{'
string|"'HTTP_REFERER'"
op|':'
string|"'http://example.com/index.html'"
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'_check_authenticate'
op|'('
name|'acl'
op|'='
string|"'.r:example.com,.rlistings'"
op|','
name|'env'
op|'='
name|'env'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_authorize_succeeds_for_referrer_with_obj
dedent|''
name|'def'
name|'test_authorize_succeeds_for_referrer_with_obj'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'path'
op|'='
string|"'/v1/%s/c/o'"
op|'%'
name|'self'
op|'.'
name|'_get_account'
op|'('
op|')'
newline|'\n'
name|'env'
op|'='
op|'{'
string|"'HTTP_REFERER'"
op|':'
string|"'http://example.com/index.html'"
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'_check_authenticate'
op|'('
name|'acl'
op|'='
string|"'.r:example.com'"
op|','
name|'env'
op|'='
name|'env'
op|','
name|'path'
op|'='
name|'path'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_authorize_succeeds_for_user_role_in_roles
dedent|''
name|'def'
name|'test_authorize_succeeds_for_user_role_in_roles'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'acl'
op|'='
string|"'allowme'"
newline|'\n'
name|'identity'
op|'='
name|'self'
op|'.'
name|'_get_identity'
op|'('
name|'roles'
op|'='
op|'['
name|'acl'
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_check_authenticate'
op|'('
name|'identity'
op|'='
name|'identity'
op|','
name|'acl'
op|'='
name|'acl'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_authorize_succeeds_for_tenant_name_user_in_roles
dedent|''
name|'def'
name|'test_authorize_succeeds_for_tenant_name_user_in_roles'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'identity'
op|'='
name|'self'
op|'.'
name|'_get_identity'
op|'('
op|')'
newline|'\n'
name|'user_name'
op|'='
name|'identity'
op|'['
string|"'HTTP_X_USER_NAME'"
op|']'
newline|'\n'
name|'user_id'
op|'='
name|'identity'
op|'['
string|"'HTTP_X_USER_ID'"
op|']'
newline|'\n'
name|'tenant_id'
op|'='
name|'identity'
op|'['
string|"'HTTP_X_TENANT_ID'"
op|']'
newline|'\n'
name|'for'
name|'user'
name|'in'
op|'['
name|'user_id'
op|','
name|'user_name'
op|','
string|"'*'"
op|']'
op|':'
newline|'\n'
indent|'            '
name|'acl'
op|'='
string|"'%s:%s'"
op|'%'
op|'('
name|'tenant_id'
op|','
name|'user'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_check_authenticate'
op|'('
name|'identity'
op|'='
name|'identity'
op|','
name|'acl'
op|'='
name|'acl'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_authorize_succeeds_for_tenant_id_user_in_roles
dedent|''
dedent|''
name|'def'
name|'test_authorize_succeeds_for_tenant_id_user_in_roles'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'identity'
op|'='
name|'self'
op|'.'
name|'_get_identity'
op|'('
op|')'
newline|'\n'
name|'user_name'
op|'='
name|'identity'
op|'['
string|"'HTTP_X_USER_NAME'"
op|']'
newline|'\n'
name|'user_id'
op|'='
name|'identity'
op|'['
string|"'HTTP_X_USER_ID'"
op|']'
newline|'\n'
name|'tenant_name'
op|'='
name|'identity'
op|'['
string|"'HTTP_X_TENANT_NAME'"
op|']'
newline|'\n'
name|'for'
name|'user'
name|'in'
op|'['
name|'user_id'
op|','
name|'user_name'
op|','
string|"'*'"
op|']'
op|':'
newline|'\n'
indent|'            '
name|'acl'
op|'='
string|"'%s:%s'"
op|'%'
op|'('
name|'tenant_name'
op|','
name|'user'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_check_authenticate'
op|'('
name|'identity'
op|'='
name|'identity'
op|','
name|'acl'
op|'='
name|'acl'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_authorize_succeeds_for_wildcard_tenant_user_in_roles
dedent|''
dedent|''
name|'def'
name|'test_authorize_succeeds_for_wildcard_tenant_user_in_roles'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'identity'
op|'='
name|'self'
op|'.'
name|'_get_identity'
op|'('
op|')'
newline|'\n'
name|'user_name'
op|'='
name|'identity'
op|'['
string|"'HTTP_X_USER_NAME'"
op|']'
newline|'\n'
name|'user_id'
op|'='
name|'identity'
op|'['
string|"'HTTP_X_USER_ID'"
op|']'
newline|'\n'
name|'for'
name|'user'
name|'in'
op|'['
name|'user_id'
op|','
name|'user_name'
op|','
string|"'*'"
op|']'
op|':'
newline|'\n'
indent|'            '
name|'acl'
op|'='
string|"'*:%s'"
op|'%'
name|'user'
newline|'\n'
name|'self'
op|'.'
name|'_check_authenticate'
op|'('
name|'identity'
op|'='
name|'identity'
op|','
name|'acl'
op|'='
name|'acl'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_cross_tenant_authorization_success
dedent|''
dedent|''
name|'def'
name|'test_cross_tenant_authorization_success'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'assertEqual'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'_authorize_cross_tenant'
op|'('
nl|'\n'
string|"'userID'"
op|','
string|"'userA'"
op|','
string|"'tenantID'"
op|','
string|"'tenantNAME'"
op|','
nl|'\n'
op|'['
string|"'tenantID:userA'"
op|']'
op|')'
op|','
nl|'\n'
string|"'tenantID:userA'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'_authorize_cross_tenant'
op|'('
nl|'\n'
string|"'userID'"
op|','
string|"'userA'"
op|','
string|"'tenantID'"
op|','
string|"'tenantNAME'"
op|','
nl|'\n'
op|'['
string|"'tenantNAME:userA'"
op|']'
op|')'
op|','
nl|'\n'
string|"'tenantNAME:userA'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'_authorize_cross_tenant'
op|'('
nl|'\n'
string|"'userID'"
op|','
string|"'userA'"
op|','
string|"'tenantID'"
op|','
string|"'tenantNAME'"
op|','
op|'['
string|"'*:userA'"
op|']'
op|')'
op|','
nl|'\n'
string|"'*:userA'"
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'_authorize_cross_tenant'
op|'('
nl|'\n'
string|"'userID'"
op|','
string|"'userA'"
op|','
string|"'tenantID'"
op|','
string|"'tenantNAME'"
op|','
nl|'\n'
op|'['
string|"'tenantID:userID'"
op|']'
op|')'
op|','
nl|'\n'
string|"'tenantID:userID'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'_authorize_cross_tenant'
op|'('
nl|'\n'
string|"'userID'"
op|','
string|"'userA'"
op|','
string|"'tenantID'"
op|','
string|"'tenantNAME'"
op|','
nl|'\n'
op|'['
string|"'tenantNAME:userID'"
op|']'
op|')'
op|','
nl|'\n'
string|"'tenantNAME:userID'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'_authorize_cross_tenant'
op|'('
nl|'\n'
string|"'userID'"
op|','
string|"'userA'"
op|','
string|"'tenantID'"
op|','
string|"'tenantNAME'"
op|','
op|'['
string|"'*:userID'"
op|']'
op|')'
op|','
nl|'\n'
string|"'*:userID'"
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'_authorize_cross_tenant'
op|'('
nl|'\n'
string|"'userID'"
op|','
string|"'userA'"
op|','
string|"'tenantID'"
op|','
string|"'tenantNAME'"
op|','
op|'['
string|"'tenantID:*'"
op|']'
op|')'
op|','
nl|'\n'
string|"'tenantID:*'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'_authorize_cross_tenant'
op|'('
nl|'\n'
string|"'userID'"
op|','
string|"'userA'"
op|','
string|"'tenantID'"
op|','
string|"'tenantNAME'"
op|','
op|'['
string|"'tenantNAME:*'"
op|']'
op|')'
op|','
nl|'\n'
string|"'tenantNAME:*'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'_authorize_cross_tenant'
op|'('
nl|'\n'
string|"'userID'"
op|','
string|"'userA'"
op|','
string|"'tenantID'"
op|','
string|"'tenantNAME'"
op|','
op|'['
string|"'*:*'"
op|']'
op|')'
op|','
nl|'\n'
string|"'*:*'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_cross_tenant_authorization_failure
dedent|''
name|'def'
name|'test_cross_tenant_authorization_failure'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'assertEqual'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'_authorize_cross_tenant'
op|'('
nl|'\n'
string|"'userID'"
op|','
string|"'userA'"
op|','
string|"'tenantID'"
op|','
string|"'tenantNAME'"
op|','
nl|'\n'
op|'['
string|"'tenantXYZ:userA'"
op|']'
op|')'
op|','
nl|'\n'
name|'None'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_delete_own_account_not_allowed
dedent|''
name|'def'
name|'test_delete_own_account_not_allowed'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'roles'
op|'='
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'operator_roles'
op|'.'
name|'split'
op|'('
string|"','"
op|')'
newline|'\n'
name|'identity'
op|'='
name|'self'
op|'.'
name|'_get_identity'
op|'('
name|'roles'
op|'='
name|'roles'
op|')'
newline|'\n'
name|'account'
op|'='
name|'self'
op|'.'
name|'_get_account'
op|'('
name|'identity'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_check_authenticate'
op|'('
name|'account'
op|'='
name|'account'
op|','
nl|'\n'
name|'identity'
op|'='
name|'identity'
op|','
nl|'\n'
name|'exception'
op|'='
name|'HTTP_FORBIDDEN'
op|','
nl|'\n'
name|'path'
op|'='
string|"'/v1/'"
op|'+'
name|'account'
op|','
nl|'\n'
name|'env'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'DELETE'"
op|'}'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_delete_own_account_when_reseller_allowed
dedent|''
name|'def'
name|'test_delete_own_account_when_reseller_allowed'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'roles'
op|'='
op|'['
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'reseller_admin_role'
op|']'
newline|'\n'
name|'identity'
op|'='
name|'self'
op|'.'
name|'_get_identity'
op|'('
name|'roles'
op|'='
name|'roles'
op|')'
newline|'\n'
name|'account'
op|'='
name|'self'
op|'.'
name|'_get_account'
op|'('
name|'identity'
op|')'
newline|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_check_authenticate'
op|'('
name|'account'
op|'='
name|'account'
op|','
nl|'\n'
name|'identity'
op|'='
name|'identity'
op|','
nl|'\n'
name|'path'
op|'='
string|"'/v1/'"
op|'+'
name|'account'
op|','
nl|'\n'
name|'env'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'DELETE'"
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'bool'
op|'('
name|'req'
op|'.'
name|'environ'
op|'.'
name|'get'
op|'('
string|"'swift_owner'"
op|')'
op|')'
op|','
name|'True'
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'if'
name|'__name__'
op|'=='
string|"'__main__'"
op|':'
newline|'\n'
indent|'    '
name|'unittest'
op|'.'
name|'main'
op|'('
op|')'
newline|'\n'
dedent|''
endmarker|''
end_unit
