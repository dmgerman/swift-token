begin_unit
comment|'# Copyright (c) 2010-2015 OpenStack Foundation'
nl|'\n'
comment|'#'
nl|'\n'
comment|'# Licensed under the Apache License, Version 2.0 (the "License");'
nl|'\n'
comment|'# you may not use this file except in compliance with the License.'
nl|'\n'
comment|'# You may obtain a copy of the License at'
nl|'\n'
comment|'#'
nl|'\n'
comment|'#    http://www.apache.org/licenses/LICENSE-2.0'
nl|'\n'
comment|'#'
nl|'\n'
comment|'# Unless required by applicable law or agreed to in writing, software'
nl|'\n'
comment|'# distributed under the License is distributed on an "AS IS" BASIS,'
nl|'\n'
comment|'# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or'
nl|'\n'
comment|'# implied.'
nl|'\n'
comment|'# See the License for the specific language governing permissions and'
nl|'\n'
comment|'# limitations under the License.'
nl|'\n'
nl|'\n'
name|'import'
name|'unittest'
newline|'\n'
name|'import'
name|'os'
newline|'\n'
nl|'\n'
name|'from'
name|'swift'
op|'.'
name|'common'
op|'.'
name|'base_storage_server'
name|'import'
name|'BaseStorageServer'
newline|'\n'
name|'from'
name|'tempfile'
name|'import'
name|'mkdtemp'
newline|'\n'
name|'from'
name|'swift'
name|'import'
name|'__version__'
name|'as'
name|'swift_version'
newline|'\n'
name|'from'
name|'swift'
op|'.'
name|'common'
op|'.'
name|'swob'
name|'import'
name|'Request'
newline|'\n'
name|'from'
name|'swift'
op|'.'
name|'common'
op|'.'
name|'utils'
name|'import'
name|'get_logger'
op|','
name|'public'
newline|'\n'
name|'from'
name|'shutil'
name|'import'
name|'rmtree'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|FakeOPTIONS
name|'class'
name|'FakeOPTIONS'
op|'('
name|'BaseStorageServer'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|variable|server_type
indent|'    '
name|'server_type'
op|'='
string|"'test-server'"
newline|'\n'
nl|'\n'
DECL|member|__init__
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'conf'
op|','
name|'logger'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'super'
op|'('
name|'FakeOPTIONS'
op|','
name|'self'
op|')'
op|'.'
name|'__init__'
op|'('
name|'conf'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'logger'
op|'='
name|'logger'
name|'or'
name|'get_logger'
op|'('
name|'conf'
op|','
name|'log_route'
op|'='
string|"'test-server'"
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|FakeANOTHER
dedent|''
dedent|''
name|'class'
name|'FakeANOTHER'
op|'('
name|'FakeOPTIONS'
op|')'
op|':'
newline|'\n'
nl|'\n'
indent|'    '
op|'@'
name|'public'
newline|'\n'
DECL|member|ANOTHER
name|'def'
name|'ANOTHER'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""this is to test adding to allowed_methods"""'
newline|'\n'
name|'pass'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|TestBaseStorageServer
dedent|''
dedent|''
name|'class'
name|'TestBaseStorageServer'
op|'('
name|'unittest'
op|'.'
name|'TestCase'
op|')'
op|':'
newline|'\n'
indent|'    '
string|'"""Test swift.common.base_storage_server"""'
newline|'\n'
nl|'\n'
DECL|member|setUp
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'tmpdir'
op|'='
name|'mkdtemp'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'testdir'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'self'
op|'.'
name|'tmpdir'
op|','
nl|'\n'
string|"'tmp_test_base_storage_server'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|tearDown
dedent|''
name|'def'
name|'tearDown'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Tear down for testing swift.common.base_storage_server"""'
newline|'\n'
name|'rmtree'
op|'('
name|'self'
op|'.'
name|'tmpdir'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_server_type
dedent|''
name|'def'
name|'test_server_type'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'conf'
op|'='
op|'{'
string|"'devices'"
op|':'
name|'self'
op|'.'
name|'testdir'
op|','
string|"'mount_check'"
op|':'
string|"'false'"
op|'}'
newline|'\n'
name|'baseserver'
op|'='
name|'BaseStorageServer'
op|'('
name|'conf'
op|')'
newline|'\n'
name|'msg'
op|'='
string|"'Storage nodes have not implemented the Server type.'"
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'baseserver'
op|'.'
name|'server_type'
newline|'\n'
dedent|''
name|'except'
name|'NotImplementedError'
name|'as'
name|'e'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'str'
op|'('
name|'e'
op|')'
op|','
name|'msg'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_allowed_methods
dedent|''
dedent|''
name|'def'
name|'test_allowed_methods'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'conf'
op|'='
op|'{'
string|"'devices'"
op|':'
name|'self'
op|'.'
name|'testdir'
op|','
string|"'mount_check'"
op|':'
string|"'false'"
op|','
nl|'\n'
string|"'replication_server'"
op|':'
string|"'false'"
op|'}'
newline|'\n'
nl|'\n'
comment|"# test what's available in the base class"
nl|'\n'
name|'allowed_methods_test'
op|'='
name|'FakeOPTIONS'
op|'('
name|'conf'
op|')'
op|'.'
name|'allowed_methods'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'allowed_methods_test'
op|','
op|'['
string|"'OPTIONS'"
op|']'
op|')'
newline|'\n'
nl|'\n'
comment|'# test that a subclass can add allowed methods'
nl|'\n'
name|'allowed_methods_test'
op|'='
name|'FakeANOTHER'
op|'('
name|'conf'
op|')'
op|'.'
name|'allowed_methods'
newline|'\n'
name|'allowed_methods_test'
op|'.'
name|'sort'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'allowed_methods_test'
op|','
op|'['
string|"'ANOTHER'"
op|','
string|"'OPTIONS'"
op|']'
op|')'
newline|'\n'
nl|'\n'
name|'conf'
op|'='
op|'{'
string|"'devices'"
op|':'
name|'self'
op|'.'
name|'testdir'
op|','
string|"'mount_check'"
op|':'
string|"'false'"
op|','
nl|'\n'
string|"'replication_server'"
op|':'
string|"'true'"
op|'}'
newline|'\n'
nl|'\n'
comment|"# test what's available in the base class"
nl|'\n'
name|'allowed_methods_test'
op|'='
name|'FakeOPTIONS'
op|'('
name|'conf'
op|')'
op|'.'
name|'allowed_methods'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'allowed_methods_test'
op|','
op|'['
op|']'
op|')'
newline|'\n'
nl|'\n'
comment|'# test that a subclass can add allowed methods'
nl|'\n'
name|'allowed_methods_test'
op|'='
name|'FakeANOTHER'
op|'('
name|'conf'
op|')'
op|'.'
name|'allowed_methods'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'allowed_methods_test'
op|','
op|'['
op|']'
op|')'
newline|'\n'
nl|'\n'
name|'conf'
op|'='
op|'{'
string|"'devices'"
op|':'
name|'self'
op|'.'
name|'testdir'
op|','
string|"'mount_check'"
op|':'
string|"'false'"
op|'}'
newline|'\n'
nl|'\n'
comment|"# test what's available in the base class"
nl|'\n'
name|'allowed_methods_test'
op|'='
name|'FakeOPTIONS'
op|'('
name|'conf'
op|')'
op|'.'
name|'allowed_methods'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'allowed_methods_test'
op|','
op|'['
string|"'OPTIONS'"
op|']'
op|')'
newline|'\n'
nl|'\n'
comment|'# test that a subclass can add allowed methods'
nl|'\n'
name|'allowed_methods_test'
op|'='
name|'FakeANOTHER'
op|'('
name|'conf'
op|')'
op|'.'
name|'allowed_methods'
newline|'\n'
name|'allowed_methods_test'
op|'.'
name|'sort'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'allowed_methods_test'
op|','
op|'['
string|"'ANOTHER'"
op|','
string|"'OPTIONS'"
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_OPTIONS_error
dedent|''
name|'def'
name|'test_OPTIONS_error'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'msg'
op|'='
string|"'Storage nodes have not implemented the Server type.'"
newline|'\n'
name|'conf'
op|'='
op|'{'
string|"'devices'"
op|':'
name|'self'
op|'.'
name|'testdir'
op|','
string|"'mount_check'"
op|':'
string|"'false'"
op|','
nl|'\n'
string|"'replication_server'"
op|':'
string|"'false'"
op|'}'
newline|'\n'
nl|'\n'
name|'baseserver'
op|'='
name|'BaseStorageServer'
op|'('
name|'conf'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'OPTIONS'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'content_length'
op|'='
number|'0'
newline|'\n'
nl|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'baseserver'
op|'.'
name|'OPTIONS'
op|'('
name|'req'
op|')'
newline|'\n'
dedent|''
name|'except'
name|'NotImplementedError'
name|'as'
name|'e'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'str'
op|'('
name|'e'
op|')'
op|','
name|'msg'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_OPTIONS
dedent|''
dedent|''
name|'def'
name|'test_OPTIONS'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'conf'
op|'='
op|'{'
string|"'devices'"
op|':'
name|'self'
op|'.'
name|'testdir'
op|','
string|"'mount_check'"
op|':'
string|"'false'"
op|','
nl|'\n'
string|"'replication_server'"
op|':'
string|"'false'"
op|'}'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'OPTIONS'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'content_length'
op|'='
number|'0'
newline|'\n'
name|'resp'
op|'='
name|'FakeOPTIONS'
op|'('
name|'conf'
op|')'
op|'.'
name|'OPTIONS'
op|'('
name|'req'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'['
string|"'Allow'"
op|']'
op|','
string|"'OPTIONS'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'['
string|"'Server'"
op|']'
op|','
nl|'\n'
string|"'test-server/'"
op|'+'
name|'swift_version'
op|')'
newline|'\n'
dedent|''
dedent|''
endmarker|''
end_unit
