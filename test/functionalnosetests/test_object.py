begin_unit
comment|'#!/usr/bin/python'
nl|'\n'
nl|'\n'
comment|'# Copyright (c) 2010-2012 OpenStack, LLC.'
nl|'\n'
comment|'#'
nl|'\n'
comment|'# Licensed under the Apache License, Version 2.0 (the "License");'
nl|'\n'
comment|'# you may not use this file except in compliance with the License.'
nl|'\n'
comment|'# You may obtain a copy of the License at'
nl|'\n'
comment|'#'
nl|'\n'
comment|'#    http://www.apache.org/licenses/LICENSE-2.0'
nl|'\n'
comment|'#'
nl|'\n'
comment|'# Unless required by applicable law or agreed to in writing, software'
nl|'\n'
comment|'# distributed under the License is distributed on an "AS IS" BASIS,'
nl|'\n'
comment|'# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or'
nl|'\n'
comment|'# implied.'
nl|'\n'
comment|'# See the License for the specific language governing permissions and'
nl|'\n'
comment|'# limitations under the License.'
nl|'\n'
nl|'\n'
name|'import'
name|'unittest'
newline|'\n'
name|'from'
name|'nose'
name|'import'
name|'SkipTest'
newline|'\n'
name|'from'
name|'uuid'
name|'import'
name|'uuid4'
newline|'\n'
nl|'\n'
name|'from'
name|'swift'
op|'.'
name|'common'
op|'.'
name|'constraints'
name|'import'
name|'MAX_META_COUNT'
op|','
name|'MAX_META_NAME_LENGTH'
op|','
name|'MAX_META_OVERALL_SIZE'
op|','
name|'MAX_META_VALUE_LENGTH'
newline|'\n'
nl|'\n'
name|'from'
name|'swift_testing'
name|'import'
name|'check_response'
op|','
name|'retry'
op|','
name|'skip'
op|','
name|'skip3'
op|','
name|'swift_test_perm'
op|','
name|'web_front_end'
newline|'\n'
name|'from'
name|'test'
name|'import'
name|'get_config'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|TestObject
name|'class'
name|'TestObject'
op|'('
name|'unittest'
op|'.'
name|'TestCase'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|member|setUp
indent|'    '
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'skip'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'SkipTest'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'container'
op|'='
name|'uuid4'
op|'('
op|')'
op|'.'
name|'hex'
newline|'\n'
nl|'\n'
DECL|function|put
name|'def'
name|'put'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'PUT'"
op|','
name|'parsed'
op|'.'
name|'path'
op|'+'
string|"'/'"
op|'+'
name|'self'
op|'.'
name|'container'
op|','
string|"''"
op|','
nl|'\n'
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
dedent|''
name|'resp'
op|'='
name|'retry'
op|'('
name|'put'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'201'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'obj'
op|'='
name|'uuid4'
op|'('
op|')'
op|'.'
name|'hex'
newline|'\n'
nl|'\n'
DECL|function|put
name|'def'
name|'put'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'PUT'"
op|','
string|"'%s/%s/%s'"
op|'%'
op|'('
name|'parsed'
op|'.'
name|'path'
op|','
name|'self'
op|'.'
name|'container'
op|','
nl|'\n'
name|'self'
op|'.'
name|'obj'
op|')'
op|','
string|"'test'"
op|','
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
dedent|''
name|'resp'
op|'='
name|'retry'
op|'('
name|'put'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'201'
op|')'
newline|'\n'
nl|'\n'
DECL|member|tearDown
dedent|''
name|'def'
name|'tearDown'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'skip'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'SkipTest'
newline|'\n'
nl|'\n'
DECL|function|delete
dedent|''
name|'def'
name|'delete'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|','
name|'obj'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'DELETE'"
op|','
nl|'\n'
string|"'%s/%s/%s'"
op|'%'
op|'('
name|'parsed'
op|'.'
name|'path'
op|','
name|'self'
op|'.'
name|'container'
op|','
name|'obj'
op|')'
op|','
nl|'\n'
string|"''"
op|','
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
nl|'\n'
comment|'# get list of objects in container'
nl|'\n'
DECL|function|list
dedent|''
name|'def'
name|'list'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'GET'"
op|','
nl|'\n'
string|"'%s/%s'"
op|'%'
op|'('
name|'parsed'
op|'.'
name|'path'
op|','
name|'self'
op|'.'
name|'container'
op|')'
op|','
nl|'\n'
string|"''"
op|','
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
dedent|''
name|'resp'
op|'='
name|'retry'
op|'('
name|'list'
op|')'
newline|'\n'
name|'object_listing'
op|'='
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'200'
op|')'
newline|'\n'
nl|'\n'
comment|'# iterate over object listing and delete all objects'
nl|'\n'
name|'for'
name|'obj'
name|'in'
name|'object_listing'
op|'.'
name|'splitlines'
op|'('
op|')'
op|':'
newline|'\n'
indent|'            '
name|'resp'
op|'='
name|'retry'
op|'('
name|'delete'
op|','
name|'obj'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'204'
op|')'
newline|'\n'
nl|'\n'
comment|'# delete the container'
nl|'\n'
DECL|function|delete
dedent|''
name|'def'
name|'delete'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'DELETE'"
op|','
name|'parsed'
op|'.'
name|'path'
op|'+'
string|"'/'"
op|'+'
name|'self'
op|'.'
name|'container'
op|','
string|"''"
op|','
nl|'\n'
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
dedent|''
name|'resp'
op|'='
name|'retry'
op|'('
name|'delete'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'204'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_copy_object
dedent|''
name|'def'
name|'test_copy_object'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'skip'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'SkipTest'
newline|'\n'
nl|'\n'
dedent|''
name|'source'
op|'='
string|"'%s/%s'"
op|'%'
op|'('
name|'self'
op|'.'
name|'container'
op|','
name|'self'
op|'.'
name|'obj'
op|')'
newline|'\n'
name|'dest'
op|'='
string|"'%s/%s'"
op|'%'
op|'('
name|'self'
op|'.'
name|'container'
op|','
string|"'test_copy'"
op|')'
newline|'\n'
nl|'\n'
comment|'# get contents of source'
nl|'\n'
DECL|function|get_source
name|'def'
name|'get_source'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'GET'"
op|','
nl|'\n'
string|"'%s/%s'"
op|'%'
op|'('
name|'parsed'
op|'.'
name|'path'
op|','
name|'source'
op|')'
op|','
nl|'\n'
string|"''"
op|','
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
dedent|''
name|'resp'
op|'='
name|'retry'
op|'('
name|'get_source'
op|')'
newline|'\n'
name|'source_contents'
op|'='
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'200'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'source_contents'
op|','
string|"'test'"
op|')'
newline|'\n'
nl|'\n'
comment|'# copy source to dest with X-Copy-From'
nl|'\n'
DECL|function|put
name|'def'
name|'put'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'PUT'"
op|','
string|"'%s/%s'"
op|'%'
op|'('
name|'parsed'
op|'.'
name|'path'
op|','
name|'dest'
op|')'
op|','
string|"''"
op|','
nl|'\n'
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|','
nl|'\n'
string|"'Content-Length'"
op|':'
string|"'0'"
op|','
nl|'\n'
string|"'X-Copy-From'"
op|':'
name|'source'
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
dedent|''
name|'resp'
op|'='
name|'retry'
op|'('
name|'put'
op|')'
newline|'\n'
name|'contents'
op|'='
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'201'
op|')'
newline|'\n'
nl|'\n'
comment|'# contents of dest should be the same as source'
nl|'\n'
DECL|function|get_dest
name|'def'
name|'get_dest'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'GET'"
op|','
nl|'\n'
string|"'%s/%s'"
op|'%'
op|'('
name|'parsed'
op|'.'
name|'path'
op|','
name|'dest'
op|')'
op|','
nl|'\n'
string|"''"
op|','
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
dedent|''
name|'resp'
op|'='
name|'retry'
op|'('
name|'get_dest'
op|')'
newline|'\n'
name|'dest_contents'
op|'='
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'200'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'dest_contents'
op|','
name|'source_contents'
op|')'
newline|'\n'
nl|'\n'
comment|'# delete the copy'
nl|'\n'
DECL|function|delete
name|'def'
name|'delete'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'DELETE'"
op|','
string|"'%s/%s'"
op|'%'
op|'('
name|'parsed'
op|'.'
name|'path'
op|','
name|'dest'
op|')'
op|','
string|"''"
op|','
nl|'\n'
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
dedent|''
name|'resp'
op|'='
name|'retry'
op|'('
name|'delete'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'204'
op|')'
newline|'\n'
comment|'# verify dest does not exist'
nl|'\n'
name|'resp'
op|'='
name|'retry'
op|'('
name|'get_dest'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'404'
op|')'
newline|'\n'
nl|'\n'
comment|'# copy source to dest with COPY'
nl|'\n'
DECL|function|copy
name|'def'
name|'copy'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'COPY'"
op|','
string|"'%s/%s'"
op|'%'
op|'('
name|'parsed'
op|'.'
name|'path'
op|','
name|'source'
op|')'
op|','
string|"''"
op|','
nl|'\n'
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|','
nl|'\n'
string|"'Destination'"
op|':'
name|'dest'
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
dedent|''
name|'resp'
op|'='
name|'retry'
op|'('
name|'copy'
op|')'
newline|'\n'
name|'contents'
op|'='
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'201'
op|')'
newline|'\n'
nl|'\n'
comment|'# contents of dest should be the same as source'
nl|'\n'
name|'resp'
op|'='
name|'retry'
op|'('
name|'get_dest'
op|')'
newline|'\n'
name|'dest_contents'
op|'='
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'200'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'dest_contents'
op|','
name|'source_contents'
op|')'
newline|'\n'
nl|'\n'
comment|'# delete the copy'
nl|'\n'
name|'resp'
op|'='
name|'retry'
op|'('
name|'delete'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'204'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_public_object
dedent|''
name|'def'
name|'test_public_object'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'skip'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'SkipTest'
newline|'\n'
nl|'\n'
DECL|function|get
dedent|''
name|'def'
name|'get'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'GET'"
op|','
nl|'\n'
string|"'%s/%s/%s'"
op|'%'
op|'('
name|'parsed'
op|'.'
name|'path'
op|','
name|'self'
op|'.'
name|'container'
op|','
name|'self'
op|'.'
name|'obj'
op|')'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
dedent|''
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'resp'
op|'='
name|'retry'
op|'('
name|'get'
op|')'
newline|'\n'
name|'raise'
name|'Exception'
op|'('
string|"'Should not have been able to GET'"
op|')'
newline|'\n'
dedent|''
name|'except'
name|'Exception'
op|','
name|'err'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assert_'
op|'('
name|'str'
op|'('
name|'err'
op|')'
op|'.'
name|'startswith'
op|'('
string|"'No result after '"
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|function|post
dedent|''
name|'def'
name|'post'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'POST'"
op|','
name|'parsed'
op|'.'
name|'path'
op|'+'
string|"'/'"
op|'+'
name|'self'
op|'.'
name|'container'
op|','
string|"''"
op|','
nl|'\n'
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|','
nl|'\n'
string|"'X-Container-Read'"
op|':'
string|"'.r:*'"
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
dedent|''
name|'resp'
op|'='
name|'retry'
op|'('
name|'post'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'204'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'retry'
op|'('
name|'get'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'200'
op|')'
newline|'\n'
nl|'\n'
DECL|function|post
name|'def'
name|'post'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'POST'"
op|','
name|'parsed'
op|'.'
name|'path'
op|'+'
string|"'/'"
op|'+'
name|'self'
op|'.'
name|'container'
op|','
string|"''"
op|','
nl|'\n'
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|','
string|"'X-Container-Read'"
op|':'
string|"''"
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
dedent|''
name|'resp'
op|'='
name|'retry'
op|'('
name|'post'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'204'
op|')'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'resp'
op|'='
name|'retry'
op|'('
name|'get'
op|')'
newline|'\n'
name|'raise'
name|'Exception'
op|'('
string|"'Should not have been able to GET'"
op|')'
newline|'\n'
dedent|''
name|'except'
name|'Exception'
op|','
name|'err'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assert_'
op|'('
name|'str'
op|'('
name|'err'
op|')'
op|'.'
name|'startswith'
op|'('
string|"'No result after '"
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_private_object
dedent|''
dedent|''
name|'def'
name|'test_private_object'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'skip'
name|'or'
name|'skip3'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'SkipTest'
newline|'\n'
nl|'\n'
comment|"# Ensure we can't access the object with the third account"
nl|'\n'
DECL|function|get
dedent|''
name|'def'
name|'get'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'GET'"
op|','
string|"'%s/%s/%s'"
op|'%'
op|'('
name|'parsed'
op|'.'
name|'path'
op|','
name|'self'
op|'.'
name|'container'
op|','
nl|'\n'
name|'self'
op|'.'
name|'obj'
op|')'
op|','
string|"''"
op|','
nl|'\n'
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
dedent|''
name|'resp'
op|'='
name|'retry'
op|'('
name|'get'
op|','
name|'use_account'
op|'='
number|'3'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'403'
op|')'
newline|'\n'
nl|'\n'
comment|'# create a shared container writable by account3'
nl|'\n'
name|'shared_container'
op|'='
name|'uuid4'
op|'('
op|')'
op|'.'
name|'hex'
newline|'\n'
nl|'\n'
DECL|function|put
name|'def'
name|'put'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'PUT'"
op|','
string|"'%s/%s'"
op|'%'
op|'('
name|'parsed'
op|'.'
name|'path'
op|','
nl|'\n'
name|'shared_container'
op|')'
op|','
string|"''"
op|','
nl|'\n'
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|','
nl|'\n'
string|"'X-Container-Read'"
op|':'
name|'swift_test_perm'
op|'['
number|'2'
op|']'
op|','
nl|'\n'
string|"'X-Container-Write'"
op|':'
name|'swift_test_perm'
op|'['
number|'2'
op|']'
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
dedent|''
name|'resp'
op|'='
name|'retry'
op|'('
name|'put'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'201'
op|')'
newline|'\n'
nl|'\n'
comment|'# verify third account can not copy from private container'
nl|'\n'
DECL|function|copy
name|'def'
name|'copy'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'PUT'"
op|','
string|"'%s/%s/%s'"
op|'%'
op|'('
name|'parsed'
op|'.'
name|'path'
op|','
nl|'\n'
name|'shared_container'
op|','
nl|'\n'
string|"'private_object'"
op|')'
op|','
nl|'\n'
string|"''"
op|','
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|','
nl|'\n'
string|"'Content-Length'"
op|':'
string|"'0'"
op|','
nl|'\n'
string|"'X-Copy-From'"
op|':'
string|"'%s/%s'"
op|'%'
op|'('
name|'self'
op|'.'
name|'container'
op|','
nl|'\n'
name|'self'
op|'.'
name|'obj'
op|')'
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
dedent|''
name|'resp'
op|'='
name|'retry'
op|'('
name|'copy'
op|','
name|'use_account'
op|'='
number|'3'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'403'
op|')'
newline|'\n'
nl|'\n'
comment|'# verify third account can write "obj1" to shared container'
nl|'\n'
DECL|function|put
name|'def'
name|'put'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'PUT'"
op|','
string|"'%s/%s/%s'"
op|'%'
op|'('
name|'parsed'
op|'.'
name|'path'
op|','
name|'shared_container'
op|','
nl|'\n'
string|"'obj1'"
op|')'
op|','
string|"'test'"
op|','
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
dedent|''
name|'resp'
op|'='
name|'retry'
op|'('
name|'put'
op|','
name|'use_account'
op|'='
number|'3'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'201'
op|')'
newline|'\n'
nl|'\n'
comment|'# verify third account can copy "obj1" to shared container'
nl|'\n'
DECL|function|copy2
name|'def'
name|'copy2'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'COPY'"
op|','
string|"'%s/%s/%s'"
op|'%'
op|'('
name|'parsed'
op|'.'
name|'path'
op|','
nl|'\n'
name|'shared_container'
op|','
nl|'\n'
string|"'obj1'"
op|')'
op|','
nl|'\n'
string|"''"
op|','
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|','
nl|'\n'
string|"'Destination'"
op|':'
string|"'%s/%s'"
op|'%'
op|'('
name|'shared_container'
op|','
nl|'\n'
string|"'obj1'"
op|')'
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
dedent|''
name|'resp'
op|'='
name|'retry'
op|'('
name|'copy2'
op|','
name|'use_account'
op|'='
number|'3'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'201'
op|')'
newline|'\n'
nl|'\n'
comment|'# verify third account STILL can not copy from private container'
nl|'\n'
DECL|function|copy3
name|'def'
name|'copy3'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'COPY'"
op|','
string|"'%s/%s/%s'"
op|'%'
op|'('
name|'parsed'
op|'.'
name|'path'
op|','
nl|'\n'
name|'self'
op|'.'
name|'container'
op|','
nl|'\n'
name|'self'
op|'.'
name|'obj'
op|')'
op|','
nl|'\n'
string|"''"
op|','
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|','
nl|'\n'
string|"'Destination'"
op|':'
string|"'%s/%s'"
op|'%'
op|'('
name|'shared_container'
op|','
nl|'\n'
string|"'private_object'"
op|')'
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
dedent|''
name|'resp'
op|'='
name|'retry'
op|'('
name|'copy3'
op|','
name|'use_account'
op|'='
number|'3'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'403'
op|')'
newline|'\n'
nl|'\n'
comment|'# clean up "obj1"'
nl|'\n'
DECL|function|delete
name|'def'
name|'delete'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'DELETE'"
op|','
string|"'%s/%s/%s'"
op|'%'
op|'('
name|'parsed'
op|'.'
name|'path'
op|','
name|'shared_container'
op|','
nl|'\n'
string|"'obj1'"
op|')'
op|','
string|"''"
op|','
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
dedent|''
name|'resp'
op|'='
name|'retry'
op|'('
name|'delete'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'204'
op|')'
newline|'\n'
nl|'\n'
comment|'# clean up shared_container'
nl|'\n'
DECL|function|delete
name|'def'
name|'delete'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'DELETE'"
op|','
nl|'\n'
name|'parsed'
op|'.'
name|'path'
op|'+'
string|"'/'"
op|'+'
name|'shared_container'
op|','
string|"''"
op|','
nl|'\n'
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
dedent|''
name|'resp'
op|'='
name|'retry'
op|'('
name|'delete'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'204'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_manifest
dedent|''
name|'def'
name|'test_manifest'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'skip'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'SkipTest'
newline|'\n'
comment|'# Data for the object segments'
nl|'\n'
dedent|''
name|'segments1'
op|'='
op|'['
string|"'one'"
op|','
string|"'two'"
op|','
string|"'three'"
op|','
string|"'four'"
op|','
string|"'five'"
op|']'
newline|'\n'
name|'segments2'
op|'='
op|'['
string|"'six'"
op|','
string|"'seven'"
op|','
string|"'eight'"
op|']'
newline|'\n'
name|'segments3'
op|'='
op|'['
string|"'nine'"
op|','
string|"'ten'"
op|','
string|"'eleven'"
op|']'
newline|'\n'
nl|'\n'
comment|'# Upload the first set of segments'
nl|'\n'
DECL|function|put
name|'def'
name|'put'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|','
name|'objnum'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'PUT'"
op|','
string|"'%s/%s/segments1/%s'"
op|'%'
op|'('
name|'parsed'
op|'.'
name|'path'
op|','
nl|'\n'
name|'self'
op|'.'
name|'container'
op|','
name|'str'
op|'('
name|'objnum'
op|')'
op|')'
op|','
name|'segments1'
op|'['
name|'objnum'
op|']'
op|','
nl|'\n'
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
dedent|''
name|'for'
name|'objnum'
name|'in'
name|'xrange'
op|'('
name|'len'
op|'('
name|'segments1'
op|')'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'resp'
op|'='
name|'retry'
op|'('
name|'put'
op|','
name|'objnum'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'201'
op|')'
newline|'\n'
nl|'\n'
comment|'# Upload the manifest'
nl|'\n'
DECL|function|put
dedent|''
name|'def'
name|'put'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'PUT'"
op|','
string|"'%s/%s/manifest'"
op|'%'
op|'('
name|'parsed'
op|'.'
name|'path'
op|','
nl|'\n'
name|'self'
op|'.'
name|'container'
op|')'
op|','
string|"''"
op|','
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|','
nl|'\n'
string|"'X-Object-Manifest'"
op|':'
string|"'%s/segments1/'"
op|'%'
name|'self'
op|'.'
name|'container'
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'text/jibberish'"
op|','
string|"'Content-Length'"
op|':'
string|"'0'"
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
dedent|''
name|'resp'
op|'='
name|'retry'
op|'('
name|'put'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'201'
op|')'
newline|'\n'
nl|'\n'
comment|'# Get the manifest (should get all the segments as the body)'
nl|'\n'
DECL|function|get
name|'def'
name|'get'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'GET'"
op|','
string|"'%s/%s/manifest'"
op|'%'
op|'('
name|'parsed'
op|'.'
name|'path'
op|','
nl|'\n'
name|'self'
op|'.'
name|'container'
op|')'
op|','
string|"''"
op|','
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
dedent|''
name|'resp'
op|'='
name|'retry'
op|'('
name|'get'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
op|','
string|"''"
op|'.'
name|'join'
op|'('
name|'segments1'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'200'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'getheader'
op|'('
string|"'content-type'"
op|')'
op|','
string|"'text/jibberish'"
op|')'
newline|'\n'
nl|'\n'
comment|'# Get with a range at the start of the second segment'
nl|'\n'
DECL|function|get
name|'def'
name|'get'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'GET'"
op|','
string|"'%s/%s/manifest'"
op|'%'
op|'('
name|'parsed'
op|'.'
name|'path'
op|','
nl|'\n'
name|'self'
op|'.'
name|'container'
op|')'
op|','
string|"''"
op|','
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|','
string|"'Range'"
op|':'
nl|'\n'
string|"'bytes=3-'"
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
dedent|''
name|'resp'
op|'='
name|'retry'
op|'('
name|'get'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
op|','
string|"''"
op|'.'
name|'join'
op|'('
name|'segments1'
op|'['
number|'1'
op|':'
op|']'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'206'
op|')'
newline|'\n'
nl|'\n'
comment|'# Get with a range in the middle of the second segment'
nl|'\n'
DECL|function|get
name|'def'
name|'get'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'GET'"
op|','
string|"'%s/%s/manifest'"
op|'%'
op|'('
name|'parsed'
op|'.'
name|'path'
op|','
nl|'\n'
name|'self'
op|'.'
name|'container'
op|')'
op|','
string|"''"
op|','
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|','
string|"'Range'"
op|':'
nl|'\n'
string|"'bytes=5-'"
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
dedent|''
name|'resp'
op|'='
name|'retry'
op|'('
name|'get'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
op|','
string|"''"
op|'.'
name|'join'
op|'('
name|'segments1'
op|')'
op|'['
number|'5'
op|':'
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'206'
op|')'
newline|'\n'
nl|'\n'
comment|'# Get with a full start and stop range'
nl|'\n'
DECL|function|get
name|'def'
name|'get'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'GET'"
op|','
string|"'%s/%s/manifest'"
op|'%'
op|'('
name|'parsed'
op|'.'
name|'path'
op|','
nl|'\n'
name|'self'
op|'.'
name|'container'
op|')'
op|','
string|"''"
op|','
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|','
string|"'Range'"
op|':'
nl|'\n'
string|"'bytes=5-10'"
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
dedent|''
name|'resp'
op|'='
name|'retry'
op|'('
name|'get'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
op|','
string|"''"
op|'.'
name|'join'
op|'('
name|'segments1'
op|')'
op|'['
number|'5'
op|':'
number|'11'
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'206'
op|')'
newline|'\n'
nl|'\n'
comment|'# Upload the second set of segments'
nl|'\n'
DECL|function|put
name|'def'
name|'put'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|','
name|'objnum'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'PUT'"
op|','
string|"'%s/%s/segments2/%s'"
op|'%'
op|'('
name|'parsed'
op|'.'
name|'path'
op|','
nl|'\n'
name|'self'
op|'.'
name|'container'
op|','
name|'str'
op|'('
name|'objnum'
op|')'
op|')'
op|','
name|'segments2'
op|'['
name|'objnum'
op|']'
op|','
nl|'\n'
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
dedent|''
name|'for'
name|'objnum'
name|'in'
name|'xrange'
op|'('
name|'len'
op|'('
name|'segments2'
op|')'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'resp'
op|'='
name|'retry'
op|'('
name|'put'
op|','
name|'objnum'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'201'
op|')'
newline|'\n'
nl|'\n'
comment|'# Get the manifest (should still be the first segments of course)'
nl|'\n'
DECL|function|get
dedent|''
name|'def'
name|'get'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'GET'"
op|','
string|"'%s/%s/manifest'"
op|'%'
op|'('
name|'parsed'
op|'.'
name|'path'
op|','
nl|'\n'
name|'self'
op|'.'
name|'container'
op|')'
op|','
string|"''"
op|','
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
dedent|''
name|'resp'
op|'='
name|'retry'
op|'('
name|'get'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
op|','
string|"''"
op|'.'
name|'join'
op|'('
name|'segments1'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'200'
op|')'
newline|'\n'
nl|'\n'
comment|'# Update the manifest'
nl|'\n'
DECL|function|put
name|'def'
name|'put'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'PUT'"
op|','
string|"'%s/%s/manifest'"
op|'%'
op|'('
name|'parsed'
op|'.'
name|'path'
op|','
nl|'\n'
name|'self'
op|'.'
name|'container'
op|')'
op|','
string|"''"
op|','
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|','
nl|'\n'
string|"'X-Object-Manifest'"
op|':'
string|"'%s/segments2/'"
op|'%'
name|'self'
op|'.'
name|'container'
op|','
nl|'\n'
string|"'Content-Length'"
op|':'
string|"'0'"
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
dedent|''
name|'resp'
op|'='
name|'retry'
op|'('
name|'put'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'201'
op|')'
newline|'\n'
nl|'\n'
comment|'# Get the manifest (should be the second set of segments now)'
nl|'\n'
DECL|function|get
name|'def'
name|'get'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'GET'"
op|','
string|"'%s/%s/manifest'"
op|'%'
op|'('
name|'parsed'
op|'.'
name|'path'
op|','
nl|'\n'
name|'self'
op|'.'
name|'container'
op|')'
op|','
string|"''"
op|','
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
dedent|''
name|'resp'
op|'='
name|'retry'
op|'('
name|'get'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
op|','
string|"''"
op|'.'
name|'join'
op|'('
name|'segments2'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'200'
op|')'
newline|'\n'
nl|'\n'
name|'if'
name|'not'
name|'skip3'
op|':'
newline|'\n'
nl|'\n'
comment|"# Ensure we can't access the manifest with the third account"
nl|'\n'
DECL|function|get
indent|'            '
name|'def'
name|'get'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'GET'"
op|','
string|"'%s/%s/manifest'"
op|'%'
op|'('
name|'parsed'
op|'.'
name|'path'
op|','
nl|'\n'
name|'self'
op|'.'
name|'container'
op|')'
op|','
string|"''"
op|','
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
dedent|''
name|'resp'
op|'='
name|'retry'
op|'('
name|'get'
op|','
name|'use_account'
op|'='
number|'3'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'403'
op|')'
newline|'\n'
nl|'\n'
comment|'# Grant access to the third account'
nl|'\n'
DECL|function|post
name|'def'
name|'post'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'POST'"
op|','
string|"'%s/%s'"
op|'%'
op|'('
name|'parsed'
op|'.'
name|'path'
op|','
name|'self'
op|'.'
name|'container'
op|')'
op|','
nl|'\n'
string|"''"
op|','
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|','
nl|'\n'
string|"'X-Container-Read'"
op|':'
name|'swift_test_perm'
op|'['
number|'2'
op|']'
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
dedent|''
name|'resp'
op|'='
name|'retry'
op|'('
name|'post'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'204'
op|')'
newline|'\n'
nl|'\n'
comment|'# The third account should be able to get the manifest now'
nl|'\n'
DECL|function|get
name|'def'
name|'get'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'GET'"
op|','
string|"'%s/%s/manifest'"
op|'%'
op|'('
name|'parsed'
op|'.'
name|'path'
op|','
nl|'\n'
name|'self'
op|'.'
name|'container'
op|')'
op|','
string|"''"
op|','
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
dedent|''
name|'resp'
op|'='
name|'retry'
op|'('
name|'get'
op|','
name|'use_account'
op|'='
number|'3'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
op|','
string|"''"
op|'.'
name|'join'
op|'('
name|'segments2'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'200'
op|')'
newline|'\n'
nl|'\n'
comment|'# Create another container for the third set of segments'
nl|'\n'
dedent|''
name|'acontainer'
op|'='
name|'uuid4'
op|'('
op|')'
op|'.'
name|'hex'
newline|'\n'
nl|'\n'
DECL|function|put
name|'def'
name|'put'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'PUT'"
op|','
name|'parsed'
op|'.'
name|'path'
op|'+'
string|"'/'"
op|'+'
name|'acontainer'
op|','
string|"''"
op|','
nl|'\n'
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
dedent|''
name|'resp'
op|'='
name|'retry'
op|'('
name|'put'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'201'
op|')'
newline|'\n'
nl|'\n'
comment|'# Upload the third set of segments in the other container'
nl|'\n'
DECL|function|put
name|'def'
name|'put'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|','
name|'objnum'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'PUT'"
op|','
string|"'%s/%s/segments3/%s'"
op|'%'
op|'('
name|'parsed'
op|'.'
name|'path'
op|','
nl|'\n'
name|'acontainer'
op|','
name|'str'
op|'('
name|'objnum'
op|')'
op|')'
op|','
name|'segments3'
op|'['
name|'objnum'
op|']'
op|','
nl|'\n'
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
dedent|''
name|'for'
name|'objnum'
name|'in'
name|'xrange'
op|'('
name|'len'
op|'('
name|'segments3'
op|')'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'resp'
op|'='
name|'retry'
op|'('
name|'put'
op|','
name|'objnum'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'201'
op|')'
newline|'\n'
nl|'\n'
comment|'# Update the manifest'
nl|'\n'
DECL|function|put
dedent|''
name|'def'
name|'put'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'PUT'"
op|','
string|"'%s/%s/manifest'"
op|'%'
op|'('
name|'parsed'
op|'.'
name|'path'
op|','
nl|'\n'
name|'self'
op|'.'
name|'container'
op|')'
op|','
string|"''"
op|','
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|','
nl|'\n'
string|"'X-Object-Manifest'"
op|':'
string|"'%s/segments3/'"
op|'%'
name|'acontainer'
op|','
nl|'\n'
string|"'Content-Length'"
op|':'
string|"'0'"
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
dedent|''
name|'resp'
op|'='
name|'retry'
op|'('
name|'put'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'201'
op|')'
newline|'\n'
nl|'\n'
comment|"# Get the manifest to ensure it's the third set of segments"
nl|'\n'
DECL|function|get
name|'def'
name|'get'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'GET'"
op|','
string|"'%s/%s/manifest'"
op|'%'
op|'('
name|'parsed'
op|'.'
name|'path'
op|','
nl|'\n'
name|'self'
op|'.'
name|'container'
op|')'
op|','
string|"''"
op|','
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
dedent|''
name|'resp'
op|'='
name|'retry'
op|'('
name|'get'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
op|','
string|"''"
op|'.'
name|'join'
op|'('
name|'segments3'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'200'
op|')'
newline|'\n'
nl|'\n'
name|'if'
name|'not'
name|'skip3'
op|':'
newline|'\n'
nl|'\n'
comment|"# Ensure we can't access the manifest with the third account"
nl|'\n'
comment|'# (because the segments are in a protected container even if the'
nl|'\n'
comment|'# manifest itself is not).'
nl|'\n'
nl|'\n'
DECL|function|get
indent|'            '
name|'def'
name|'get'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'GET'"
op|','
string|"'%s/%s/manifest'"
op|'%'
op|'('
name|'parsed'
op|'.'
name|'path'
op|','
nl|'\n'
name|'self'
op|'.'
name|'container'
op|')'
op|','
string|"''"
op|','
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
dedent|''
name|'resp'
op|'='
name|'retry'
op|'('
name|'get'
op|','
name|'use_account'
op|'='
number|'3'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'403'
op|')'
newline|'\n'
nl|'\n'
comment|'# Grant access to the third account'
nl|'\n'
DECL|function|post
name|'def'
name|'post'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'POST'"
op|','
string|"'%s/%s'"
op|'%'
op|'('
name|'parsed'
op|'.'
name|'path'
op|','
name|'acontainer'
op|')'
op|','
nl|'\n'
string|"''"
op|','
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|','
nl|'\n'
string|"'X-Container-Read'"
op|':'
name|'swift_test_perm'
op|'['
number|'2'
op|']'
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
dedent|''
name|'resp'
op|'='
name|'retry'
op|'('
name|'post'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'204'
op|')'
newline|'\n'
nl|'\n'
comment|'# The third account should be able to get the manifest now'
nl|'\n'
DECL|function|get
name|'def'
name|'get'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'GET'"
op|','
string|"'%s/%s/manifest'"
op|'%'
op|'('
name|'parsed'
op|'.'
name|'path'
op|','
nl|'\n'
name|'self'
op|'.'
name|'container'
op|')'
op|','
string|"''"
op|','
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
dedent|''
name|'resp'
op|'='
name|'retry'
op|'('
name|'get'
op|','
name|'use_account'
op|'='
number|'3'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
op|','
string|"''"
op|'.'
name|'join'
op|'('
name|'segments3'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'200'
op|')'
newline|'\n'
nl|'\n'
comment|'# Delete the manifest'
nl|'\n'
DECL|function|delete
dedent|''
name|'def'
name|'delete'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|','
name|'objnum'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'DELETE'"
op|','
string|"'%s/%s/manifest'"
op|'%'
op|'('
name|'parsed'
op|'.'
name|'path'
op|','
nl|'\n'
name|'self'
op|'.'
name|'container'
op|')'
op|','
string|"''"
op|','
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
dedent|''
name|'resp'
op|'='
name|'retry'
op|'('
name|'delete'
op|','
name|'objnum'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'204'
op|')'
newline|'\n'
nl|'\n'
comment|'# Delete the third set of segments'
nl|'\n'
DECL|function|delete
name|'def'
name|'delete'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|','
name|'objnum'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'DELETE'"
op|','
string|"'%s/%s/segments3/%s'"
op|'%'
op|'('
name|'parsed'
op|'.'
name|'path'
op|','
nl|'\n'
name|'acontainer'
op|','
name|'str'
op|'('
name|'objnum'
op|')'
op|')'
op|','
string|"''"
op|','
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
dedent|''
name|'for'
name|'objnum'
name|'in'
name|'xrange'
op|'('
name|'len'
op|'('
name|'segments3'
op|')'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'resp'
op|'='
name|'retry'
op|'('
name|'delete'
op|','
name|'objnum'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'204'
op|')'
newline|'\n'
nl|'\n'
comment|'# Delete the second set of segments'
nl|'\n'
DECL|function|delete
dedent|''
name|'def'
name|'delete'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|','
name|'objnum'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'DELETE'"
op|','
string|"'%s/%s/segments2/%s'"
op|'%'
op|'('
name|'parsed'
op|'.'
name|'path'
op|','
nl|'\n'
name|'self'
op|'.'
name|'container'
op|','
name|'str'
op|'('
name|'objnum'
op|')'
op|')'
op|','
string|"''"
op|','
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
dedent|''
name|'for'
name|'objnum'
name|'in'
name|'xrange'
op|'('
name|'len'
op|'('
name|'segments2'
op|')'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'resp'
op|'='
name|'retry'
op|'('
name|'delete'
op|','
name|'objnum'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'204'
op|')'
newline|'\n'
nl|'\n'
comment|'# Delete the first set of segments'
nl|'\n'
DECL|function|delete
dedent|''
name|'def'
name|'delete'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|','
name|'objnum'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'DELETE'"
op|','
string|"'%s/%s/segments1/%s'"
op|'%'
op|'('
name|'parsed'
op|'.'
name|'path'
op|','
nl|'\n'
name|'self'
op|'.'
name|'container'
op|','
name|'str'
op|'('
name|'objnum'
op|')'
op|')'
op|','
string|"''"
op|','
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
dedent|''
name|'for'
name|'objnum'
name|'in'
name|'xrange'
op|'('
name|'len'
op|'('
name|'segments1'
op|')'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'resp'
op|'='
name|'retry'
op|'('
name|'delete'
op|','
name|'objnum'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'204'
op|')'
newline|'\n'
nl|'\n'
comment|'# Delete the extra container'
nl|'\n'
DECL|function|delete
dedent|''
name|'def'
name|'delete'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'DELETE'"
op|','
string|"'%s/%s'"
op|'%'
op|'('
name|'parsed'
op|'.'
name|'path'
op|','
name|'acontainer'
op|')'
op|','
string|"''"
op|','
nl|'\n'
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
dedent|''
name|'resp'
op|'='
name|'retry'
op|'('
name|'delete'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'204'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_delete_content_type
dedent|''
name|'def'
name|'test_delete_content_type'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'skip'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'SkipTest'
newline|'\n'
nl|'\n'
DECL|function|put
dedent|''
name|'def'
name|'put'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'PUT'"
op|','
string|"'%s/%s/hi'"
op|'%'
op|'('
name|'parsed'
op|'.'
name|'path'
op|','
nl|'\n'
name|'self'
op|'.'
name|'container'
op|')'
op|','
string|"'there'"
op|','
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
dedent|''
name|'resp'
op|'='
name|'retry'
op|'('
name|'put'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'201'
op|')'
newline|'\n'
nl|'\n'
DECL|function|delete
name|'def'
name|'delete'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'DELETE'"
op|','
string|"'%s/%s/hi'"
op|'%'
op|'('
name|'parsed'
op|'.'
name|'path'
op|','
name|'self'
op|'.'
name|'container'
op|')'
op|','
nl|'\n'
string|"''"
op|','
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
dedent|''
name|'resp'
op|'='
name|'retry'
op|'('
name|'delete'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'204'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'getheader'
op|'('
string|"'Content-Type'"
op|')'
op|','
nl|'\n'
string|"'text/html; charset=UTF-8'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_null_name
dedent|''
name|'def'
name|'test_null_name'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'skip'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'SkipTest'
newline|'\n'
nl|'\n'
DECL|function|put
dedent|''
name|'def'
name|'put'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'PUT'"
op|','
string|"'%s/%s/abc%%00def'"
op|'%'
op|'('
name|'parsed'
op|'.'
name|'path'
op|','
nl|'\n'
name|'self'
op|'.'
name|'container'
op|')'
op|','
string|"'test'"
op|','
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
dedent|''
name|'resp'
op|'='
name|'retry'
op|'('
name|'put'
op|')'
newline|'\n'
name|'if'
op|'('
name|'web_front_end'
op|'=='
string|"'apache2'"
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'404'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
op|','
string|"'Invalid UTF8 or contains NULL'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'412'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
dedent|''
dedent|''
dedent|''
name|'if'
name|'__name__'
op|'=='
string|"'__main__'"
op|':'
newline|'\n'
indent|'    '
name|'unittest'
op|'.'
name|'main'
op|'('
op|')'
newline|'\n'
dedent|''
endmarker|''
end_unit
