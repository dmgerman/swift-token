begin_unit
comment|'# Copyright (c) 2011 OpenStack, LLC.'
nl|'\n'
comment|'#'
nl|'\n'
comment|'# Licensed under the Apache License, Version 2.0 (the "License");'
nl|'\n'
comment|'# you may not use this file except in compliance with the License.'
nl|'\n'
comment|'# You may obtain a copy of the License at'
nl|'\n'
comment|'#'
nl|'\n'
comment|'#    http://www.apache.org/licenses/LICENSE-2.0'
nl|'\n'
comment|'#'
nl|'\n'
comment|'# Unless required by applicable law or agreed to in writing, software'
nl|'\n'
comment|'# distributed under the License is distributed on an "AS IS" BASIS,'
nl|'\n'
comment|'# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or'
nl|'\n'
comment|'# implied.'
nl|'\n'
comment|'# See the License for the specific language governing permissions and'
nl|'\n'
comment|'# limitations under the License.'
nl|'\n'
nl|'\n'
name|'try'
op|':'
newline|'\n'
indent|'    '
name|'import'
name|'simplejson'
name|'as'
name|'json'
newline|'\n'
dedent|''
name|'except'
name|'ImportError'
op|':'
newline|'\n'
indent|'    '
name|'import'
name|'json'
newline|'\n'
dedent|''
name|'import'
name|'unittest'
newline|'\n'
name|'from'
name|'contextlib'
name|'import'
name|'contextmanager'
newline|'\n'
name|'from'
name|'time'
name|'import'
name|'time'
newline|'\n'
nl|'\n'
name|'from'
name|'webob'
name|'import'
name|'Request'
op|','
name|'Response'
newline|'\n'
nl|'\n'
name|'from'
name|'swift'
op|'.'
name|'common'
op|'.'
name|'middleware'
name|'import'
name|'tempauth'
name|'as'
name|'auth'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|FakeMemcache
name|'class'
name|'FakeMemcache'
op|'('
name|'object'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|member|__init__
indent|'    '
name|'def'
name|'__init__'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'store'
op|'='
op|'{'
op|'}'
newline|'\n'
nl|'\n'
DECL|member|get
dedent|''
name|'def'
name|'get'
op|'('
name|'self'
op|','
name|'key'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'self'
op|'.'
name|'store'
op|'.'
name|'get'
op|'('
name|'key'
op|')'
newline|'\n'
nl|'\n'
DECL|member|set
dedent|''
name|'def'
name|'set'
op|'('
name|'self'
op|','
name|'key'
op|','
name|'value'
op|','
name|'timeout'
op|'='
number|'0'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'store'
op|'['
name|'key'
op|']'
op|'='
name|'value'
newline|'\n'
name|'return'
name|'True'
newline|'\n'
nl|'\n'
DECL|member|incr
dedent|''
name|'def'
name|'incr'
op|'('
name|'self'
op|','
name|'key'
op|','
name|'timeout'
op|'='
number|'0'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'store'
op|'['
name|'key'
op|']'
op|'='
name|'self'
op|'.'
name|'store'
op|'.'
name|'setdefault'
op|'('
name|'key'
op|','
number|'0'
op|')'
op|'+'
number|'1'
newline|'\n'
name|'return'
name|'self'
op|'.'
name|'store'
op|'['
name|'key'
op|']'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'contextmanager'
newline|'\n'
DECL|member|soft_lock
name|'def'
name|'soft_lock'
op|'('
name|'self'
op|','
name|'key'
op|','
name|'timeout'
op|'='
number|'0'
op|','
name|'retries'
op|'='
number|'5'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'yield'
name|'True'
newline|'\n'
nl|'\n'
DECL|member|delete
dedent|''
name|'def'
name|'delete'
op|'('
name|'self'
op|','
name|'key'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'del'
name|'self'
op|'.'
name|'store'
op|'['
name|'key'
op|']'
newline|'\n'
dedent|''
name|'except'
name|'Exception'
op|':'
newline|'\n'
indent|'            '
name|'pass'
newline|'\n'
dedent|''
name|'return'
name|'True'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|FakeApp
dedent|''
dedent|''
name|'class'
name|'FakeApp'
op|'('
name|'object'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|member|__init__
indent|'    '
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'status_headers_body_iter'
op|'='
name|'None'
op|','
name|'acl'
op|'='
name|'None'
op|','
name|'sync_key'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'calls'
op|'='
number|'0'
newline|'\n'
name|'self'
op|'.'
name|'status_headers_body_iter'
op|'='
name|'status_headers_body_iter'
newline|'\n'
name|'if'
name|'not'
name|'self'
op|'.'
name|'status_headers_body_iter'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'status_headers_body_iter'
op|'='
name|'iter'
op|'('
op|'['
op|'('
string|"'404 Not Found'"
op|','
op|'{'
op|'}'
op|','
string|"''"
op|')'
op|']'
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'acl'
op|'='
name|'acl'
newline|'\n'
name|'self'
op|'.'
name|'sync_key'
op|'='
name|'sync_key'
newline|'\n'
nl|'\n'
DECL|member|__call__
dedent|''
name|'def'
name|'__call__'
op|'('
name|'self'
op|','
name|'env'
op|','
name|'start_response'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'calls'
op|'+='
number|'1'
newline|'\n'
name|'self'
op|'.'
name|'request'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"''"
op|','
name|'environ'
op|'='
name|'env'
op|')'
newline|'\n'
name|'if'
name|'self'
op|'.'
name|'acl'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'request'
op|'.'
name|'acl'
op|'='
name|'self'
op|'.'
name|'acl'
newline|'\n'
dedent|''
name|'if'
name|'self'
op|'.'
name|'sync_key'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'request'
op|'.'
name|'environ'
op|'['
string|"'swift_sync_key'"
op|']'
op|'='
name|'self'
op|'.'
name|'sync_key'
newline|'\n'
dedent|''
name|'if'
string|"'swift.authorize'"
name|'in'
name|'env'
op|':'
newline|'\n'
indent|'            '
name|'resp'
op|'='
name|'env'
op|'['
string|"'swift.authorize'"
op|']'
op|'('
name|'self'
op|'.'
name|'request'
op|')'
newline|'\n'
name|'if'
name|'resp'
op|':'
newline|'\n'
indent|'                '
name|'return'
name|'resp'
op|'('
name|'env'
op|','
name|'start_response'
op|')'
newline|'\n'
dedent|''
dedent|''
name|'status'
op|','
name|'headers'
op|','
name|'body'
op|'='
name|'self'
op|'.'
name|'status_headers_body_iter'
op|'.'
name|'next'
op|'('
op|')'
newline|'\n'
name|'return'
name|'Response'
op|'('
name|'status'
op|'='
name|'status'
op|','
name|'headers'
op|'='
name|'headers'
op|','
nl|'\n'
name|'body'
op|'='
name|'body'
op|')'
op|'('
name|'env'
op|','
name|'start_response'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|FakeConn
dedent|''
dedent|''
name|'class'
name|'FakeConn'
op|'('
name|'object'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|member|__init__
indent|'    '
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'status_headers_body_iter'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'calls'
op|'='
number|'0'
newline|'\n'
name|'self'
op|'.'
name|'status_headers_body_iter'
op|'='
name|'status_headers_body_iter'
newline|'\n'
name|'if'
name|'not'
name|'self'
op|'.'
name|'status_headers_body_iter'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'status_headers_body_iter'
op|'='
name|'iter'
op|'('
op|'['
op|'('
string|"'404 Not Found'"
op|','
op|'{'
op|'}'
op|','
string|"''"
op|')'
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|request
dedent|''
dedent|''
name|'def'
name|'request'
op|'('
name|'self'
op|','
name|'method'
op|','
name|'path'
op|','
name|'headers'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'calls'
op|'+='
number|'1'
newline|'\n'
name|'self'
op|'.'
name|'request_path'
op|'='
name|'path'
newline|'\n'
name|'self'
op|'.'
name|'status'
op|','
name|'self'
op|'.'
name|'headers'
op|','
name|'self'
op|'.'
name|'body'
op|'='
name|'self'
op|'.'
name|'status_headers_body_iter'
op|'.'
name|'next'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'status'
op|','
name|'self'
op|'.'
name|'reason'
op|'='
name|'self'
op|'.'
name|'status'
op|'.'
name|'split'
op|'('
string|"' '"
op|','
number|'1'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'status'
op|'='
name|'int'
op|'('
name|'self'
op|'.'
name|'status'
op|')'
newline|'\n'
nl|'\n'
DECL|member|getresponse
dedent|''
name|'def'
name|'getresponse'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'self'
newline|'\n'
nl|'\n'
DECL|member|read
dedent|''
name|'def'
name|'read'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'body'
op|'='
name|'self'
op|'.'
name|'body'
newline|'\n'
name|'self'
op|'.'
name|'body'
op|'='
string|"''"
newline|'\n'
name|'return'
name|'body'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|TestAuth
dedent|''
dedent|''
name|'class'
name|'TestAuth'
op|'('
name|'unittest'
op|'.'
name|'TestCase'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|member|setUp
indent|'    '
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'test_auth'
op|'='
name|'auth'
op|'.'
name|'filter_factory'
op|'('
op|'{'
op|'}'
op|')'
op|'('
name|'FakeApp'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_make_request
dedent|''
name|'def'
name|'_make_request'
op|'('
name|'self'
op|','
name|'path'
op|','
op|'**'
name|'kwargs'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
name|'path'
op|','
op|'**'
name|'kwargs'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'environ'
op|'['
string|"'swift.cache'"
op|']'
op|'='
name|'FakeMemcache'
op|'('
op|')'
newline|'\n'
name|'return'
name|'req'
newline|'\n'
nl|'\n'
DECL|member|test_reseller_prefix_init
dedent|''
name|'def'
name|'test_reseller_prefix_init'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'app'
op|'='
name|'FakeApp'
op|'('
op|')'
newline|'\n'
name|'ath'
op|'='
name|'auth'
op|'.'
name|'filter_factory'
op|'('
op|'{'
op|'}'
op|')'
op|'('
name|'app'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'ath'
op|'.'
name|'reseller_prefix'
op|','
string|"'AUTH_'"
op|')'
newline|'\n'
name|'ath'
op|'='
name|'auth'
op|'.'
name|'filter_factory'
op|'('
op|'{'
string|"'reseller_prefix'"
op|':'
string|"'TEST'"
op|'}'
op|')'
op|'('
name|'app'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'ath'
op|'.'
name|'reseller_prefix'
op|','
string|"'TEST_'"
op|')'
newline|'\n'
name|'ath'
op|'='
name|'auth'
op|'.'
name|'filter_factory'
op|'('
op|'{'
string|"'reseller_prefix'"
op|':'
string|"'TEST_'"
op|'}'
op|')'
op|'('
name|'app'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'ath'
op|'.'
name|'reseller_prefix'
op|','
string|"'TEST_'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_auth_prefix_init
dedent|''
name|'def'
name|'test_auth_prefix_init'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'app'
op|'='
name|'FakeApp'
op|'('
op|')'
newline|'\n'
name|'ath'
op|'='
name|'auth'
op|'.'
name|'filter_factory'
op|'('
op|'{'
op|'}'
op|')'
op|'('
name|'app'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'ath'
op|'.'
name|'auth_prefix'
op|','
string|"'/auth/'"
op|')'
newline|'\n'
name|'ath'
op|'='
name|'auth'
op|'.'
name|'filter_factory'
op|'('
op|'{'
string|"'auth_prefix'"
op|':'
string|"''"
op|'}'
op|')'
op|'('
name|'app'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'ath'
op|'.'
name|'auth_prefix'
op|','
string|"'/auth/'"
op|')'
newline|'\n'
name|'ath'
op|'='
name|'auth'
op|'.'
name|'filter_factory'
op|'('
op|'{'
string|"'auth_prefix'"
op|':'
string|"'/test/'"
op|'}'
op|')'
op|'('
name|'app'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'ath'
op|'.'
name|'auth_prefix'
op|','
string|"'/test/'"
op|')'
newline|'\n'
name|'ath'
op|'='
name|'auth'
op|'.'
name|'filter_factory'
op|'('
op|'{'
string|"'auth_prefix'"
op|':'
string|"'/test'"
op|'}'
op|')'
op|'('
name|'app'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'ath'
op|'.'
name|'auth_prefix'
op|','
string|"'/test/'"
op|')'
newline|'\n'
name|'ath'
op|'='
name|'auth'
op|'.'
name|'filter_factory'
op|'('
op|'{'
string|"'auth_prefix'"
op|':'
string|"'test/'"
op|'}'
op|')'
op|'('
name|'app'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'ath'
op|'.'
name|'auth_prefix'
op|','
string|"'/test/'"
op|')'
newline|'\n'
name|'ath'
op|'='
name|'auth'
op|'.'
name|'filter_factory'
op|'('
op|'{'
string|"'auth_prefix'"
op|':'
string|"'test'"
op|'}'
op|')'
op|'('
name|'app'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'ath'
op|'.'
name|'auth_prefix'
op|','
string|"'/test/'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_top_level_deny
dedent|''
name|'def'
name|'test_top_level_deny'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'resp'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/'"
op|')'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'401'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'environ'
op|'['
string|"'swift.authorize'"
op|']'
op|','
nl|'\n'
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'denied_response'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_anon
dedent|''
name|'def'
name|'test_anon'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'resp'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/v1/AUTH_account'"
op|')'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'401'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'environ'
op|'['
string|"'swift.authorize'"
op|']'
op|','
nl|'\n'
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'authorize'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_override_asked_for_but_not_allowed
dedent|''
name|'def'
name|'test_override_asked_for_but_not_allowed'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'test_auth'
op|'='
name|'auth'
op|'.'
name|'filter_factory'
op|'('
op|'{'
string|"'allow_overrides'"
op|':'
string|"'false'"
op|'}'
op|')'
op|'('
name|'FakeApp'
op|'('
op|')'
op|')'
newline|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/v1/AUTH_account'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'swift.authorize_override'"
op|':'
name|'True'
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'401'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'environ'
op|'['
string|"'swift.authorize'"
op|']'
op|','
nl|'\n'
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'authorize'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_override_asked_for_and_allowed
dedent|''
name|'def'
name|'test_override_asked_for_and_allowed'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'test_auth'
op|'='
name|'auth'
op|'.'
name|'filter_factory'
op|'('
op|'{'
string|"'allow_overrides'"
op|':'
string|"'true'"
op|'}'
op|')'
op|'('
name|'FakeApp'
op|'('
op|')'
op|')'
newline|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/v1/AUTH_account'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'swift.authorize_override'"
op|':'
name|'True'
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'404'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
string|"'swift.authorize'"
name|'not'
name|'in'
name|'resp'
op|'.'
name|'environ'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_override_default_allowed
dedent|''
name|'def'
name|'test_override_default_allowed'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/v1/AUTH_account'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'swift.authorize_override'"
op|':'
name|'True'
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'404'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
string|"'swift.authorize'"
name|'not'
name|'in'
name|'resp'
op|'.'
name|'environ'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_auth_deny_non_reseller_prefix
dedent|''
name|'def'
name|'test_auth_deny_non_reseller_prefix'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'resp'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/v1/BLAH_account'"
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Auth-Token'"
op|':'
string|"'BLAH_t'"
op|'}'
op|')'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'401'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'environ'
op|'['
string|"'swift.authorize'"
op|']'
op|','
nl|'\n'
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'denied_response'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_auth_deny_non_reseller_prefix_no_override
dedent|''
name|'def'
name|'test_auth_deny_non_reseller_prefix_no_override'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'fake_authorize'
op|'='
name|'lambda'
name|'x'
op|':'
name|'Response'
op|'('
name|'status'
op|'='
string|"'500 Fake'"
op|')'
newline|'\n'
name|'resp'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/v1/BLAH_account'"
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Auth-Token'"
op|':'
string|"'BLAH_t'"
op|'}'
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'swift.authorize'"
op|':'
name|'fake_authorize'
op|'}'
nl|'\n'
op|')'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'500'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'environ'
op|'['
string|"'swift.authorize'"
op|']'
op|','
name|'fake_authorize'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_auth_no_reseller_prefix_deny
dedent|''
name|'def'
name|'test_auth_no_reseller_prefix_deny'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|"# Ensures that when we have no reseller prefix, we don't deny a request"
nl|'\n'
comment|'# outright but set up a denial swift.authorize and pass the request on'
nl|'\n'
comment|'# down the chain.'
nl|'\n'
indent|'        '
name|'local_app'
op|'='
name|'FakeApp'
op|'('
op|')'
newline|'\n'
name|'local_auth'
op|'='
name|'auth'
op|'.'
name|'filter_factory'
op|'('
op|'{'
string|"'reseller_prefix'"
op|':'
string|"''"
op|'}'
op|')'
op|'('
name|'local_app'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/v1/account'"
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Auth-Token'"
op|':'
string|"'t'"
op|'}'
op|')'
op|'.'
name|'get_response'
op|'('
name|'local_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'401'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'local_app'
op|'.'
name|'calls'
op|','
number|'1'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'environ'
op|'['
string|"'swift.authorize'"
op|']'
op|','
nl|'\n'
name|'local_auth'
op|'.'
name|'denied_response'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_auth_no_reseller_prefix_no_token
dedent|''
name|'def'
name|'test_auth_no_reseller_prefix_no_token'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# Check that normally we set up a call back to our authorize.'
nl|'\n'
indent|'        '
name|'local_auth'
op|'='
name|'auth'
op|'.'
name|'filter_factory'
op|'('
op|'{'
string|"'reseller_prefix'"
op|':'
string|"''"
op|'}'
op|')'
op|'('
name|'FakeApp'
op|'('
name|'iter'
op|'('
op|'['
op|']'
op|')'
op|')'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/v1/account'"
op|')'
op|'.'
name|'get_response'
op|'('
name|'local_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'401'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'environ'
op|'['
string|"'swift.authorize'"
op|']'
op|','
nl|'\n'
name|'local_auth'
op|'.'
name|'authorize'
op|')'
newline|'\n'
comment|"# Now make sure we don't override an existing swift.authorize when we"
nl|'\n'
comment|'# have no reseller prefix.'
nl|'\n'
name|'local_auth'
op|'='
name|'auth'
op|'.'
name|'filter_factory'
op|'('
op|'{'
string|"'reseller_prefix'"
op|':'
string|"''"
op|'}'
op|')'
op|'('
name|'FakeApp'
op|'('
op|')'
op|')'
newline|'\n'
name|'local_authorize'
op|'='
name|'lambda'
name|'req'
op|':'
name|'Response'
op|'('
string|"'test'"
op|')'
newline|'\n'
name|'resp'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/v1/account'"
op|','
name|'environ'
op|'='
op|'{'
string|"'swift.authorize'"
op|':'
nl|'\n'
name|'local_authorize'
op|'}'
op|')'
op|'.'
name|'get_response'
op|'('
name|'local_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'200'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'environ'
op|'['
string|"'swift.authorize'"
op|']'
op|','
name|'local_authorize'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_auth_fail
dedent|''
name|'def'
name|'test_auth_fail'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'resp'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/v1/AUTH_cfa'"
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Auth-Token'"
op|':'
string|"'AUTH_t'"
op|'}'
op|')'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'401'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_authorize_bad_path
dedent|''
name|'def'
name|'test_authorize_bad_path'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/badpath'"
op|')'
newline|'\n'
name|'resp'
op|'='
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'authorize'
op|'('
name|'req'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'401'
op|')'
newline|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/badpath'"
op|')'
newline|'\n'
name|'req'
op|'.'
name|'remote_user'
op|'='
string|"'act:usr,act,AUTH_cfa'"
newline|'\n'
name|'resp'
op|'='
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'authorize'
op|'('
name|'req'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'403'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_authorize_account_access
dedent|''
name|'def'
name|'test_authorize_account_access'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/v1/AUTH_cfa'"
op|')'
newline|'\n'
name|'req'
op|'.'
name|'remote_user'
op|'='
string|"'act:usr,act,AUTH_cfa'"
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'authorize'
op|'('
name|'req'
op|')'
op|','
name|'None'
op|')'
newline|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/v1/AUTH_cfa'"
op|')'
newline|'\n'
name|'req'
op|'.'
name|'remote_user'
op|'='
string|"'act:usr,act'"
newline|'\n'
name|'resp'
op|'='
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'authorize'
op|'('
name|'req'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'403'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_authorize_acl_group_access
dedent|''
name|'def'
name|'test_authorize_acl_group_access'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/v1/AUTH_cfa'"
op|')'
newline|'\n'
name|'req'
op|'.'
name|'remote_user'
op|'='
string|"'act:usr,act'"
newline|'\n'
name|'resp'
op|'='
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'authorize'
op|'('
name|'req'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'403'
op|')'
newline|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/v1/AUTH_cfa'"
op|')'
newline|'\n'
name|'req'
op|'.'
name|'remote_user'
op|'='
string|"'act:usr,act'"
newline|'\n'
name|'req'
op|'.'
name|'acl'
op|'='
string|"'act'"
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'authorize'
op|'('
name|'req'
op|')'
op|','
name|'None'
op|')'
newline|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/v1/AUTH_cfa'"
op|')'
newline|'\n'
name|'req'
op|'.'
name|'remote_user'
op|'='
string|"'act:usr,act'"
newline|'\n'
name|'req'
op|'.'
name|'acl'
op|'='
string|"'act:usr'"
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'authorize'
op|'('
name|'req'
op|')'
op|','
name|'None'
op|')'
newline|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/v1/AUTH_cfa'"
op|')'
newline|'\n'
name|'req'
op|'.'
name|'remote_user'
op|'='
string|"'act:usr,act'"
newline|'\n'
name|'req'
op|'.'
name|'acl'
op|'='
string|"'act2'"
newline|'\n'
name|'resp'
op|'='
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'authorize'
op|'('
name|'req'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'403'
op|')'
newline|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/v1/AUTH_cfa'"
op|')'
newline|'\n'
name|'req'
op|'.'
name|'remote_user'
op|'='
string|"'act:usr,act'"
newline|'\n'
name|'req'
op|'.'
name|'acl'
op|'='
string|"'act:usr2'"
newline|'\n'
name|'resp'
op|'='
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'authorize'
op|'('
name|'req'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'403'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_deny_cross_reseller
dedent|''
name|'def'
name|'test_deny_cross_reseller'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# Tests that cross-reseller is denied, even if ACLs/group names match'
nl|'\n'
indent|'        '
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/v1/OTHER_cfa'"
op|')'
newline|'\n'
name|'req'
op|'.'
name|'remote_user'
op|'='
string|"'act:usr,act,AUTH_cfa'"
newline|'\n'
name|'req'
op|'.'
name|'acl'
op|'='
string|"'act'"
newline|'\n'
name|'resp'
op|'='
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'authorize'
op|'('
name|'req'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'403'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_authorize_acl_referrer_access
dedent|''
name|'def'
name|'test_authorize_acl_referrer_access'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/v1/AUTH_cfa/c'"
op|')'
newline|'\n'
name|'req'
op|'.'
name|'remote_user'
op|'='
string|"'act:usr,act'"
newline|'\n'
name|'resp'
op|'='
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'authorize'
op|'('
name|'req'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'403'
op|')'
newline|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/v1/AUTH_cfa/c'"
op|')'
newline|'\n'
name|'req'
op|'.'
name|'remote_user'
op|'='
string|"'act:usr,act'"
newline|'\n'
name|'req'
op|'.'
name|'acl'
op|'='
string|"'.r:*,.rlistings'"
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'authorize'
op|'('
name|'req'
op|')'
op|','
name|'None'
op|')'
newline|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/v1/AUTH_cfa/c'"
op|')'
newline|'\n'
name|'req'
op|'.'
name|'remote_user'
op|'='
string|"'act:usr,act'"
newline|'\n'
name|'req'
op|'.'
name|'acl'
op|'='
string|"'.r:*'"
comment|'# No listings allowed'
newline|'\n'
name|'resp'
op|'='
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'authorize'
op|'('
name|'req'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'403'
op|')'
newline|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/v1/AUTH_cfa/c'"
op|')'
newline|'\n'
name|'req'
op|'.'
name|'remote_user'
op|'='
string|"'act:usr,act'"
newline|'\n'
name|'req'
op|'.'
name|'acl'
op|'='
string|"'.r:.example.com,.rlistings'"
newline|'\n'
name|'resp'
op|'='
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'authorize'
op|'('
name|'req'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'403'
op|')'
newline|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/v1/AUTH_cfa/c'"
op|')'
newline|'\n'
name|'req'
op|'.'
name|'remote_user'
op|'='
string|"'act:usr,act'"
newline|'\n'
name|'req'
op|'.'
name|'referer'
op|'='
string|"'http://www.example.com/index.html'"
newline|'\n'
name|'req'
op|'.'
name|'acl'
op|'='
string|"'.r:.example.com,.rlistings'"
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'authorize'
op|'('
name|'req'
op|')'
op|','
name|'None'
op|')'
newline|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/v1/AUTH_cfa/c'"
op|')'
newline|'\n'
name|'resp'
op|'='
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'authorize'
op|'('
name|'req'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'401'
op|')'
newline|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/v1/AUTH_cfa/c'"
op|')'
newline|'\n'
name|'req'
op|'.'
name|'acl'
op|'='
string|"'.r:*,.rlistings'"
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'authorize'
op|'('
name|'req'
op|')'
op|','
name|'None'
op|')'
newline|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/v1/AUTH_cfa/c'"
op|')'
newline|'\n'
name|'req'
op|'.'
name|'acl'
op|'='
string|"'.r:*'"
comment|'# No listings allowed'
newline|'\n'
name|'resp'
op|'='
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'authorize'
op|'('
name|'req'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'401'
op|')'
newline|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/v1/AUTH_cfa/c'"
op|')'
newline|'\n'
name|'req'
op|'.'
name|'acl'
op|'='
string|"'.r:.example.com,.rlistings'"
newline|'\n'
name|'resp'
op|'='
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'authorize'
op|'('
name|'req'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'401'
op|')'
newline|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/v1/AUTH_cfa/c'"
op|')'
newline|'\n'
name|'req'
op|'.'
name|'referer'
op|'='
string|"'http://www.example.com/index.html'"
newline|'\n'
name|'req'
op|'.'
name|'acl'
op|'='
string|"'.r:.example.com,.rlistings'"
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'authorize'
op|'('
name|'req'
op|')'
op|','
name|'None'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_account_put_permissions
dedent|''
name|'def'
name|'test_account_put_permissions'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/v1/AUTH_new'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'remote_user'
op|'='
string|"'act:usr,act'"
newline|'\n'
name|'resp'
op|'='
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'authorize'
op|'('
name|'req'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'403'
op|')'
newline|'\n'
nl|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/v1/AUTH_new'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'remote_user'
op|'='
string|"'act:usr,act,AUTH_other'"
newline|'\n'
name|'resp'
op|'='
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'authorize'
op|'('
name|'req'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'403'
op|')'
newline|'\n'
nl|'\n'
comment|'# Even PUTs to your own account as account admin should fail'
nl|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/v1/AUTH_old'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'remote_user'
op|'='
string|"'act:usr,act,AUTH_old'"
newline|'\n'
name|'resp'
op|'='
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'authorize'
op|'('
name|'req'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'403'
op|')'
newline|'\n'
nl|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/v1/AUTH_new'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'remote_user'
op|'='
string|"'act:usr,act,.reseller_admin'"
newline|'\n'
name|'resp'
op|'='
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'authorize'
op|'('
name|'req'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|','
name|'None'
op|')'
newline|'\n'
nl|'\n'
comment|'# .super_admin is not something the middleware should ever see or care'
nl|'\n'
comment|'# about'
nl|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/v1/AUTH_new'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'remote_user'
op|'='
string|"'act:usr,act,.super_admin'"
newline|'\n'
name|'resp'
op|'='
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'authorize'
op|'('
name|'req'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'403'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_account_delete_permissions
dedent|''
name|'def'
name|'test_account_delete_permissions'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/v1/AUTH_new'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'DELETE'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'remote_user'
op|'='
string|"'act:usr,act'"
newline|'\n'
name|'resp'
op|'='
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'authorize'
op|'('
name|'req'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'403'
op|')'
newline|'\n'
nl|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/v1/AUTH_new'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'DELETE'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'remote_user'
op|'='
string|"'act:usr,act,AUTH_other'"
newline|'\n'
name|'resp'
op|'='
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'authorize'
op|'('
name|'req'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'403'
op|')'
newline|'\n'
nl|'\n'
comment|'# Even DELETEs to your own account as account admin should fail'
nl|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/v1/AUTH_old'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'DELETE'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'remote_user'
op|'='
string|"'act:usr,act,AUTH_old'"
newline|'\n'
name|'resp'
op|'='
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'authorize'
op|'('
name|'req'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'403'
op|')'
newline|'\n'
nl|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/v1/AUTH_new'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'DELETE'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'remote_user'
op|'='
string|"'act:usr,act,.reseller_admin'"
newline|'\n'
name|'resp'
op|'='
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'authorize'
op|'('
name|'req'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|','
name|'None'
op|')'
newline|'\n'
nl|'\n'
comment|'# .super_admin is not something the middleware should ever see or care'
nl|'\n'
comment|'# about'
nl|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/v1/AUTH_new'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'DELETE'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'remote_user'
op|'='
string|"'act:usr,act,.super_admin'"
newline|'\n'
name|'resp'
op|'='
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'authorize'
op|'('
name|'req'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'403'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_token_fail
dedent|''
name|'def'
name|'test_get_token_fail'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'resp'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/auth/v1.0'"
op|')'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'401'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/auth/v1.0'"
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Auth-User'"
op|':'
string|"'act:usr'"
op|','
nl|'\n'
string|"'X-Auth-Key'"
op|':'
string|"'key'"
op|'}'
op|')'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'401'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_token_fail_invalid_x_auth_user_format
dedent|''
name|'def'
name|'test_get_token_fail_invalid_x_auth_user_format'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'resp'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/auth/v1/act/auth'"
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Auth-User'"
op|':'
string|"'usr'"
op|','
nl|'\n'
string|"'X-Auth-Key'"
op|':'
string|"'key'"
op|'}'
op|')'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'401'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_token_fail_non_matching_account_in_request
dedent|''
name|'def'
name|'test_get_token_fail_non_matching_account_in_request'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'resp'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/auth/v1/act/auth'"
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Auth-User'"
op|':'
string|"'act2:usr'"
op|','
nl|'\n'
string|"'X-Auth-Key'"
op|':'
string|"'key'"
op|'}'
op|')'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'401'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_token_fail_bad_path
dedent|''
name|'def'
name|'test_get_token_fail_bad_path'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'resp'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/auth/v1/act/auth/invalid'"
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Auth-User'"
op|':'
string|"'act:usr'"
op|','
nl|'\n'
string|"'X-Auth-Key'"
op|':'
string|"'key'"
op|'}'
op|')'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'400'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_token_fail_missing_key
dedent|''
name|'def'
name|'test_get_token_fail_missing_key'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'resp'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/auth/v1/act/auth'"
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Auth-User'"
op|':'
string|"'act:usr'"
op|'}'
op|')'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'401'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_allowed_sync_hosts
dedent|''
name|'def'
name|'test_allowed_sync_hosts'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'a'
op|'='
name|'auth'
op|'.'
name|'filter_factory'
op|'('
op|'{'
string|"'super_admin_key'"
op|':'
string|"'supertest'"
op|'}'
op|')'
op|'('
name|'FakeApp'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'a'
op|'.'
name|'allowed_sync_hosts'
op|','
op|'['
string|"'127.0.0.1'"
op|']'
op|')'
newline|'\n'
name|'a'
op|'='
name|'auth'
op|'.'
name|'filter_factory'
op|'('
op|'{'
string|"'super_admin_key'"
op|':'
string|"'supertest'"
op|','
nl|'\n'
string|"'allowed_sync_hosts'"
op|':'
nl|'\n'
string|"'1.1.1.1,2.1.1.1, 3.1.1.1 , 4.1.1.1,, , 5.1.1.1'"
op|'}'
op|')'
op|'('
name|'FakeApp'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'a'
op|'.'
name|'allowed_sync_hosts'
op|','
nl|'\n'
op|'['
string|"'1.1.1.1'"
op|','
string|"'2.1.1.1'"
op|','
string|"'3.1.1.1'"
op|','
string|"'4.1.1.1'"
op|','
string|"'5.1.1.1'"
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_reseller_admin_is_owner
dedent|''
name|'def'
name|'test_reseller_admin_is_owner'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'orig_authorize'
op|'='
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'authorize'
newline|'\n'
name|'owner_values'
op|'='
op|'['
op|']'
newline|'\n'
nl|'\n'
DECL|function|mitm_authorize
name|'def'
name|'mitm_authorize'
op|'('
name|'req'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'rv'
op|'='
name|'orig_authorize'
op|'('
name|'req'
op|')'
newline|'\n'
name|'owner_values'
op|'.'
name|'append'
op|'('
name|'req'
op|'.'
name|'environ'
op|'.'
name|'get'
op|'('
string|"'swift_owner'"
op|','
name|'False'
op|')'
op|')'
newline|'\n'
name|'return'
name|'rv'
newline|'\n'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'authorize'
op|'='
name|'mitm_authorize'
newline|'\n'
nl|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/v1/AUTH_cfa'"
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Auth-Token'"
op|':'
string|"'AUTH_t'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'remote_user'
op|'='
string|"'.reseller_admin'"
newline|'\n'
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'authorize'
op|'('
name|'req'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'owner_values'
op|','
op|'['
name|'True'
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_admin_is_owner
dedent|''
name|'def'
name|'test_admin_is_owner'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'orig_authorize'
op|'='
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'authorize'
newline|'\n'
name|'owner_values'
op|'='
op|'['
op|']'
newline|'\n'
nl|'\n'
DECL|function|mitm_authorize
name|'def'
name|'mitm_authorize'
op|'('
name|'req'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'rv'
op|'='
name|'orig_authorize'
op|'('
name|'req'
op|')'
newline|'\n'
name|'owner_values'
op|'.'
name|'append'
op|'('
name|'req'
op|'.'
name|'environ'
op|'.'
name|'get'
op|'('
string|"'swift_owner'"
op|','
name|'False'
op|')'
op|')'
newline|'\n'
name|'return'
name|'rv'
newline|'\n'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'authorize'
op|'='
name|'mitm_authorize'
newline|'\n'
nl|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/v1/AUTH_cfa'"
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Auth-Token'"
op|':'
string|"'AUTH_t'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'remote_user'
op|'='
string|"'AUTH_cfa'"
newline|'\n'
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'authorize'
op|'('
name|'req'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'owner_values'
op|','
op|'['
name|'True'
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_regular_is_not_owner
dedent|''
name|'def'
name|'test_regular_is_not_owner'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'orig_authorize'
op|'='
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'authorize'
newline|'\n'
name|'owner_values'
op|'='
op|'['
op|']'
newline|'\n'
nl|'\n'
DECL|function|mitm_authorize
name|'def'
name|'mitm_authorize'
op|'('
name|'req'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'rv'
op|'='
name|'orig_authorize'
op|'('
name|'req'
op|')'
newline|'\n'
name|'owner_values'
op|'.'
name|'append'
op|'('
name|'req'
op|'.'
name|'environ'
op|'.'
name|'get'
op|'('
string|"'swift_owner'"
op|','
name|'False'
op|')'
op|')'
newline|'\n'
name|'return'
name|'rv'
newline|'\n'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'authorize'
op|'='
name|'mitm_authorize'
newline|'\n'
nl|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/v1/AUTH_cfa/c'"
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Auth-Token'"
op|':'
string|"'AUTH_t'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'remote_user'
op|'='
string|"'act:usr'"
newline|'\n'
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'authorize'
op|'('
name|'req'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'owner_values'
op|','
op|'['
name|'False'
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_sync_request_success
dedent|''
name|'def'
name|'test_sync_request_success'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'app'
op|'='
name|'FakeApp'
op|'('
name|'iter'
op|'('
op|'['
op|'('
string|"'204 No Content'"
op|','
op|'{'
op|'}'
op|','
string|"''"
op|')'
op|']'
op|')'
op|','
nl|'\n'
name|'sync_key'
op|'='
string|"'secret'"
op|')'
newline|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/v1/AUTH_cfa/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'DELETE'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'x-container-sync-key'"
op|':'
string|"'secret'"
op|','
nl|'\n'
string|"'x-timestamp'"
op|':'
string|"'123.456'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'remote_addr'
op|'='
string|"'127.0.0.1'"
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'204'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_sync_request_fail_key
dedent|''
name|'def'
name|'test_sync_request_fail_key'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'app'
op|'='
name|'FakeApp'
op|'('
name|'iter'
op|'('
op|'['
op|'('
string|"'204 No Content'"
op|','
op|'{'
op|'}'
op|','
string|"''"
op|')'
op|']'
op|')'
op|','
nl|'\n'
name|'sync_key'
op|'='
string|"'secret'"
op|')'
newline|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/v1/AUTH_cfa/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'DELETE'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'x-container-sync-key'"
op|':'
string|"'wrongsecret'"
op|','
nl|'\n'
string|"'x-timestamp'"
op|':'
string|"'123.456'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'remote_addr'
op|'='
string|"'127.0.0.1'"
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'401'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'app'
op|'='
name|'FakeApp'
op|'('
name|'iter'
op|'('
op|'['
op|'('
string|"'204 No Content'"
op|','
op|'{'
op|'}'
op|','
string|"''"
op|')'
op|']'
op|')'
op|','
nl|'\n'
name|'sync_key'
op|'='
string|"'othersecret'"
op|')'
newline|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/v1/AUTH_cfa/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'DELETE'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'x-container-sync-key'"
op|':'
string|"'secret'"
op|','
nl|'\n'
string|"'x-timestamp'"
op|':'
string|"'123.456'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'remote_addr'
op|'='
string|"'127.0.0.1'"
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'401'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'app'
op|'='
name|'FakeApp'
op|'('
name|'iter'
op|'('
op|'['
op|'('
string|"'204 No Content'"
op|','
op|'{'
op|'}'
op|','
string|"''"
op|')'
op|']'
op|')'
op|','
nl|'\n'
name|'sync_key'
op|'='
name|'None'
op|')'
newline|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/v1/AUTH_cfa/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'DELETE'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'x-container-sync-key'"
op|':'
string|"'secret'"
op|','
nl|'\n'
string|"'x-timestamp'"
op|':'
string|"'123.456'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'remote_addr'
op|'='
string|"'127.0.0.1'"
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'401'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_sync_request_fail_no_timestamp
dedent|''
name|'def'
name|'test_sync_request_fail_no_timestamp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'app'
op|'='
name|'FakeApp'
op|'('
name|'iter'
op|'('
op|'['
op|'('
string|"'204 No Content'"
op|','
op|'{'
op|'}'
op|','
string|"''"
op|')'
op|']'
op|')'
op|','
nl|'\n'
name|'sync_key'
op|'='
string|"'secret'"
op|')'
newline|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/v1/AUTH_cfa/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'DELETE'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'x-container-sync-key'"
op|':'
string|"'secret'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'remote_addr'
op|'='
string|"'127.0.0.1'"
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'401'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_sync_request_fail_sync_host
dedent|''
name|'def'
name|'test_sync_request_fail_sync_host'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'app'
op|'='
name|'FakeApp'
op|'('
name|'iter'
op|'('
op|'['
op|'('
string|"'204 No Content'"
op|','
op|'{'
op|'}'
op|','
string|"''"
op|')'
op|']'
op|')'
op|','
nl|'\n'
name|'sync_key'
op|'='
string|"'secret'"
op|')'
newline|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/v1/AUTH_cfa/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'DELETE'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'x-container-sync-key'"
op|':'
string|"'secret'"
op|','
nl|'\n'
string|"'x-timestamp'"
op|':'
string|"'123.456'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'remote_addr'
op|'='
string|"'127.0.0.2'"
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'401'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_sync_request_success_lb_sync_host
dedent|''
name|'def'
name|'test_sync_request_success_lb_sync_host'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'app'
op|'='
name|'FakeApp'
op|'('
name|'iter'
op|'('
op|'['
op|'('
string|"'204 No Content'"
op|','
op|'{'
op|'}'
op|','
string|"''"
op|')'
op|']'
op|')'
op|','
nl|'\n'
name|'sync_key'
op|'='
string|"'secret'"
op|')'
newline|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/v1/AUTH_cfa/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'DELETE'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'x-container-sync-key'"
op|':'
string|"'secret'"
op|','
nl|'\n'
string|"'x-timestamp'"
op|':'
string|"'123.456'"
op|','
nl|'\n'
string|"'x-forwarded-for'"
op|':'
string|"'127.0.0.1'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'remote_addr'
op|'='
string|"'127.0.0.2'"
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'204'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'app'
op|'='
name|'FakeApp'
op|'('
name|'iter'
op|'('
op|'['
op|'('
string|"'204 No Content'"
op|','
op|'{'
op|'}'
op|','
string|"''"
op|')'
op|']'
op|')'
op|','
nl|'\n'
name|'sync_key'
op|'='
string|"'secret'"
op|')'
newline|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/v1/AUTH_cfa/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'DELETE'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'x-container-sync-key'"
op|':'
string|"'secret'"
op|','
nl|'\n'
string|"'x-timestamp'"
op|':'
string|"'123.456'"
op|','
nl|'\n'
string|"'x-cluster-client-ip'"
op|':'
string|"'127.0.0.1'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'remote_addr'
op|'='
string|"'127.0.0.2'"
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'204'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|TestParseUserCreation
dedent|''
dedent|''
name|'class'
name|'TestParseUserCreation'
op|'('
name|'unittest'
op|'.'
name|'TestCase'
op|')'
op|':'
newline|'\n'
DECL|member|test_parse_user_creation
indent|'    '
name|'def'
name|'test_parse_user_creation'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'auth_filter'
op|'='
name|'auth'
op|'.'
name|'filter_factory'
op|'('
op|'{'
nl|'\n'
string|"'user_test_tester3'"
op|':'
string|"'testing'"
op|','
nl|'\n'
string|"'user_admin_admin'"
op|':'
string|"'admin .admin .reseller_admin'"
op|','
nl|'\n'
op|'}'
op|')'
op|'('
name|'FakeApp'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'auth_filter'
op|'.'
name|'users'
op|','
op|'{'
nl|'\n'
string|"'admin:admin'"
op|':'
op|'{'
nl|'\n'
string|"'url'"
op|':'
string|"'http://127.0.0.1:8080/v1/AUTH_admin'"
op|','
nl|'\n'
string|"'groups'"
op|':'
op|'['
string|"'.admin'"
op|','
string|"'.reseller_admin'"
op|']'
op|','
nl|'\n'
string|"'key'"
op|':'
string|"'admin'"
nl|'\n'
op|'}'
op|','
string|"'test:tester3'"
op|':'
op|'{'
nl|'\n'
string|"'url'"
op|':'
string|"'http://127.0.0.1:8080/v1/AUTH_test'"
op|','
nl|'\n'
string|"'groups'"
op|':'
op|'['
op|']'
op|','
nl|'\n'
string|"'key'"
op|':'
string|"'testing'"
nl|'\n'
op|'}'
op|','
nl|'\n'
op|'}'
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'if'
name|'__name__'
op|'=='
string|"'__main__'"
op|':'
newline|'\n'
indent|'    '
name|'unittest'
op|'.'
name|'main'
op|'('
op|')'
newline|'\n'
dedent|''
endmarker|''
end_unit
