begin_unit
comment|'#!/usr/bin/python'
nl|'\n'
nl|'\n'
comment|'# Copyright (c) 2010-2012 OpenStack Foundation'
nl|'\n'
comment|'#'
nl|'\n'
comment|'# Licensed under the Apache License, Version 2.0 (the "License");'
nl|'\n'
comment|'# you may not use this file except in compliance with the License.'
nl|'\n'
comment|'# You may obtain a copy of the License at'
nl|'\n'
comment|'#'
nl|'\n'
comment|'#    http://www.apache.org/licenses/LICENSE-2.0'
nl|'\n'
comment|'#'
nl|'\n'
comment|'# Unless required by applicable law or agreed to in writing, software'
nl|'\n'
comment|'# distributed under the License is distributed on an "AS IS" BASIS,'
nl|'\n'
comment|'# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or'
nl|'\n'
comment|'# implied.'
nl|'\n'
comment|'# See the License for the specific language governing permissions and'
nl|'\n'
comment|'# limitations under the License.'
nl|'\n'
nl|'\n'
name|'import'
name|'json'
newline|'\n'
name|'import'
name|'unittest2'
newline|'\n'
name|'from'
name|'unittest2'
name|'import'
name|'SkipTest'
newline|'\n'
name|'from'
name|'uuid'
name|'import'
name|'uuid4'
newline|'\n'
nl|'\n'
name|'from'
name|'six'
op|'.'
name|'moves'
name|'import'
name|'range'
newline|'\n'
nl|'\n'
name|'from'
name|'test'
op|'.'
name|'functional'
name|'import'
name|'check_response'
op|','
name|'retry'
op|','
name|'requires_acls'
op|','
name|'requires_policies'
newline|'\n'
name|'import'
name|'test'
op|'.'
name|'functional'
name|'as'
name|'tf'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|function|setUpModule
name|'def'
name|'setUpModule'
op|'('
op|')'
op|':'
newline|'\n'
indent|'    '
name|'tf'
op|'.'
name|'setup_package'
op|'('
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|function|tearDownModule
dedent|''
name|'def'
name|'tearDownModule'
op|'('
op|')'
op|':'
newline|'\n'
indent|'    '
name|'tf'
op|'.'
name|'teardown_package'
op|'('
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|TestObject
dedent|''
name|'class'
name|'TestObject'
op|'('
name|'unittest2'
op|'.'
name|'TestCase'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|member|setUp
indent|'    '
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'tf'
op|'.'
name|'skip'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'SkipTest'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'container'
op|'='
name|'uuid4'
op|'('
op|')'
op|'.'
name|'hex'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'containers'
op|'='
op|'['
op|']'
newline|'\n'
name|'self'
op|'.'
name|'_create_container'
op|'('
name|'self'
op|'.'
name|'container'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_create_container'
op|'('
name|'self'
op|'.'
name|'container'
op|','
name|'use_account'
op|'='
number|'2'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'obj'
op|'='
name|'uuid4'
op|'('
op|')'
op|'.'
name|'hex'
newline|'\n'
nl|'\n'
DECL|function|put
name|'def'
name|'put'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'PUT'"
op|','
string|"'%s/%s/%s'"
op|'%'
op|'('
nl|'\n'
name|'parsed'
op|'.'
name|'path'
op|','
name|'self'
op|'.'
name|'container'
op|','
name|'self'
op|'.'
name|'obj'
op|')'
op|','
string|"'test'"
op|','
nl|'\n'
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
dedent|''
name|'resp'
op|'='
name|'retry'
op|'('
name|'put'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'201'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_create_container
dedent|''
name|'def'
name|'_create_container'
op|'('
name|'self'
op|','
name|'name'
op|'='
name|'None'
op|','
name|'headers'
op|'='
name|'None'
op|','
name|'use_account'
op|'='
number|'1'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'not'
name|'name'
op|':'
newline|'\n'
indent|'            '
name|'name'
op|'='
name|'uuid4'
op|'('
op|')'
op|'.'
name|'hex'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'containers'
op|'.'
name|'append'
op|'('
name|'name'
op|')'
newline|'\n'
name|'headers'
op|'='
name|'headers'
name|'or'
op|'{'
op|'}'
newline|'\n'
nl|'\n'
DECL|function|put
name|'def'
name|'put'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|','
name|'name'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'new_headers'
op|'='
name|'dict'
op|'('
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|'}'
op|','
op|'**'
name|'headers'
op|')'
newline|'\n'
name|'conn'
op|'.'
name|'request'
op|'('
string|"'PUT'"
op|','
name|'parsed'
op|'.'
name|'path'
op|'+'
string|"'/'"
op|'+'
name|'name'
op|','
string|"''"
op|','
nl|'\n'
name|'new_headers'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
dedent|''
name|'resp'
op|'='
name|'retry'
op|'('
name|'put'
op|','
name|'name'
op|','
name|'use_account'
op|'='
name|'use_account'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'201'
op|')'
newline|'\n'
nl|'\n'
comment|'# With keystoneauth we need the accounts to have had the project'
nl|'\n'
comment|'# domain id persisted as sysmeta prior to testing ACLs. This may'
nl|'\n'
comment|'# not be the case if, for example, the account was created using'
nl|'\n'
comment|'# a request with reseller_admin role, when project domain id may'
nl|'\n'
comment|'# not have been known. So we ensure that the project domain id is'
nl|'\n'
comment|'# in sysmeta by making a POST to the accounts using an admin role.'
nl|'\n'
DECL|function|post
name|'def'
name|'post'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'POST'"
op|','
name|'parsed'
op|'.'
name|'path'
op|','
string|"''"
op|','
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
dedent|''
name|'resp'
op|'='
name|'retry'
op|'('
name|'post'
op|','
name|'use_account'
op|'='
name|'use_account'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'204'
op|')'
newline|'\n'
nl|'\n'
name|'return'
name|'name'
newline|'\n'
nl|'\n'
DECL|member|tearDown
dedent|''
name|'def'
name|'tearDown'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'tf'
op|'.'
name|'skip'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'SkipTest'
newline|'\n'
nl|'\n'
comment|'# get list of objects in container'
nl|'\n'
DECL|function|get
dedent|''
name|'def'
name|'get'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|','
name|'container'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
nl|'\n'
string|"'GET'"
op|','
name|'parsed'
op|'.'
name|'path'
op|'+'
string|"'/'"
op|'+'
name|'container'
op|'+'
string|"'?format=json'"
op|','
string|"''"
op|','
nl|'\n'
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
nl|'\n'
comment|'# delete an object'
nl|'\n'
DECL|function|delete
dedent|''
name|'def'
name|'delete'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|','
name|'container'
op|','
name|'obj'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
nl|'\n'
string|"'DELETE'"
op|','
string|"'/'"
op|'.'
name|'join'
op|'('
op|'['
name|'parsed'
op|'.'
name|'path'
op|','
name|'container'
op|','
name|'obj'
op|'['
string|"'name'"
op|']'
op|']'
op|')'
op|','
string|"''"
op|','
nl|'\n'
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'for'
name|'container'
name|'in'
name|'self'
op|'.'
name|'containers'
op|':'
newline|'\n'
indent|'            '
name|'while'
name|'True'
op|':'
newline|'\n'
indent|'                '
name|'resp'
op|'='
name|'retry'
op|'('
name|'get'
op|','
name|'container'
op|')'
newline|'\n'
name|'body'
op|'='
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'if'
name|'resp'
op|'.'
name|'status'
op|'=='
number|'404'
op|':'
newline|'\n'
indent|'                    '
name|'break'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'resp'
op|'.'
name|'status'
op|'//'
number|'100'
op|'=='
number|'2'
op|','
name|'resp'
op|'.'
name|'status'
op|')'
newline|'\n'
name|'objs'
op|'='
name|'json'
op|'.'
name|'loads'
op|'('
name|'body'
op|')'
newline|'\n'
name|'if'
name|'not'
name|'objs'
op|':'
newline|'\n'
indent|'                    '
name|'break'
newline|'\n'
dedent|''
name|'for'
name|'obj'
name|'in'
name|'objs'
op|':'
newline|'\n'
indent|'                    '
name|'resp'
op|'='
name|'retry'
op|'('
name|'delete'
op|','
name|'container'
op|','
name|'obj'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'204'
op|')'
newline|'\n'
nl|'\n'
comment|'# delete the container'
nl|'\n'
DECL|function|delete
dedent|''
dedent|''
dedent|''
name|'def'
name|'delete'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|','
name|'name'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'DELETE'"
op|','
name|'parsed'
op|'.'
name|'path'
op|'+'
string|"'/'"
op|'+'
name|'name'
op|','
string|"''"
op|','
nl|'\n'
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'for'
name|'container'
name|'in'
name|'self'
op|'.'
name|'containers'
op|':'
newline|'\n'
indent|'            '
name|'resp'
op|'='
name|'retry'
op|'('
name|'delete'
op|','
name|'container'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertIn'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
op|'('
number|'204'
op|','
number|'404'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_if_none_match
dedent|''
dedent|''
name|'def'
name|'test_if_none_match'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
DECL|function|put
indent|'        '
name|'def'
name|'put'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'PUT'"
op|','
string|"'%s/%s/%s'"
op|'%'
op|'('
nl|'\n'
name|'parsed'
op|'.'
name|'path'
op|','
name|'self'
op|'.'
name|'container'
op|','
string|"'if_none_match_test'"
op|')'
op|','
string|"''"
op|','
nl|'\n'
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|','
nl|'\n'
string|"'Content-Length'"
op|':'
string|"'0'"
op|','
nl|'\n'
string|"'If-None-Match'"
op|':'
string|"'*'"
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
dedent|''
name|'resp'
op|'='
name|'retry'
op|'('
name|'put'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'201'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'retry'
op|'('
name|'put'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'412'
op|')'
newline|'\n'
nl|'\n'
DECL|function|put
name|'def'
name|'put'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'PUT'"
op|','
string|"'%s/%s/%s'"
op|'%'
op|'('
nl|'\n'
name|'parsed'
op|'.'
name|'path'
op|','
name|'self'
op|'.'
name|'container'
op|','
string|"'if_none_match_test'"
op|')'
op|','
string|"''"
op|','
nl|'\n'
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|','
nl|'\n'
string|"'Content-Length'"
op|':'
string|"'0'"
op|','
nl|'\n'
string|"'If-None-Match'"
op|':'
string|"'somethingelse'"
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
dedent|''
name|'resp'
op|'='
name|'retry'
op|'('
name|'put'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'400'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_non_integer_x_delete_after
dedent|''
name|'def'
name|'test_non_integer_x_delete_after'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
DECL|function|put
indent|'        '
name|'def'
name|'put'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'PUT'"
op|','
string|"'%s/%s/%s'"
op|'%'
op|'('
name|'parsed'
op|'.'
name|'path'
op|','
name|'self'
op|'.'
name|'container'
op|','
nl|'\n'
string|"'non_integer_x_delete_after'"
op|')'
op|','
nl|'\n'
string|"''"
op|','
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|','
nl|'\n'
string|"'Content-Length'"
op|':'
string|"'0'"
op|','
nl|'\n'
string|"'X-Delete-After'"
op|':'
string|"'*'"
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
dedent|''
name|'resp'
op|'='
name|'retry'
op|'('
name|'put'
op|')'
newline|'\n'
name|'body'
op|'='
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'400'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'body'
op|','
string|"'Non-integer X-Delete-After'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_non_integer_x_delete_at
dedent|''
name|'def'
name|'test_non_integer_x_delete_at'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
DECL|function|put
indent|'        '
name|'def'
name|'put'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'PUT'"
op|','
string|"'%s/%s/%s'"
op|'%'
op|'('
name|'parsed'
op|'.'
name|'path'
op|','
name|'self'
op|'.'
name|'container'
op|','
nl|'\n'
string|"'non_integer_x_delete_at'"
op|')'
op|','
nl|'\n'
string|"''"
op|','
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|','
nl|'\n'
string|"'Content-Length'"
op|':'
string|"'0'"
op|','
nl|'\n'
string|"'X-Delete-At'"
op|':'
string|"'*'"
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
dedent|''
name|'resp'
op|'='
name|'retry'
op|'('
name|'put'
op|')'
newline|'\n'
name|'body'
op|'='
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'400'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'body'
op|','
string|"'Non-integer X-Delete-At'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_x_delete_at_in_the_past
dedent|''
name|'def'
name|'test_x_delete_at_in_the_past'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
DECL|function|put
indent|'        '
name|'def'
name|'put'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'PUT'"
op|','
string|"'%s/%s/%s'"
op|'%'
op|'('
name|'parsed'
op|'.'
name|'path'
op|','
name|'self'
op|'.'
name|'container'
op|','
nl|'\n'
string|"'x_delete_at_in_the_past'"
op|')'
op|','
nl|'\n'
string|"''"
op|','
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|','
nl|'\n'
string|"'Content-Length'"
op|':'
string|"'0'"
op|','
nl|'\n'
string|"'X-Delete-At'"
op|':'
string|"'0'"
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
dedent|''
name|'resp'
op|'='
name|'retry'
op|'('
name|'put'
op|')'
newline|'\n'
name|'body'
op|'='
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'400'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'body'
op|','
string|"'X-Delete-At in past'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_copy_object
dedent|''
name|'def'
name|'test_copy_object'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'tf'
op|'.'
name|'skip'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'SkipTest'
newline|'\n'
nl|'\n'
dedent|''
name|'source'
op|'='
string|"'%s/%s'"
op|'%'
op|'('
name|'self'
op|'.'
name|'container'
op|','
name|'self'
op|'.'
name|'obj'
op|')'
newline|'\n'
name|'dest'
op|'='
string|"'%s/%s'"
op|'%'
op|'('
name|'self'
op|'.'
name|'container'
op|','
string|"'test_copy'"
op|')'
newline|'\n'
nl|'\n'
comment|'# get contents of source'
nl|'\n'
DECL|function|get_source
name|'def'
name|'get_source'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'GET'"
op|','
nl|'\n'
string|"'%s/%s'"
op|'%'
op|'('
name|'parsed'
op|'.'
name|'path'
op|','
name|'source'
op|')'
op|','
nl|'\n'
string|"''"
op|','
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
dedent|''
name|'resp'
op|'='
name|'retry'
op|'('
name|'get_source'
op|')'
newline|'\n'
name|'source_contents'
op|'='
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'200'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'source_contents'
op|','
string|"'test'"
op|')'
newline|'\n'
nl|'\n'
comment|'# copy source to dest with X-Copy-From'
nl|'\n'
DECL|function|put
name|'def'
name|'put'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'PUT'"
op|','
string|"'%s/%s'"
op|'%'
op|'('
name|'parsed'
op|'.'
name|'path'
op|','
name|'dest'
op|')'
op|','
string|"''"
op|','
nl|'\n'
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|','
nl|'\n'
string|"'Content-Length'"
op|':'
string|"'0'"
op|','
nl|'\n'
string|"'X-Copy-From'"
op|':'
name|'source'
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
dedent|''
name|'resp'
op|'='
name|'retry'
op|'('
name|'put'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'201'
op|')'
newline|'\n'
nl|'\n'
comment|'# contents of dest should be the same as source'
nl|'\n'
DECL|function|get_dest
name|'def'
name|'get_dest'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'GET'"
op|','
nl|'\n'
string|"'%s/%s'"
op|'%'
op|'('
name|'parsed'
op|'.'
name|'path'
op|','
name|'dest'
op|')'
op|','
nl|'\n'
string|"''"
op|','
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
dedent|''
name|'resp'
op|'='
name|'retry'
op|'('
name|'get_dest'
op|')'
newline|'\n'
name|'dest_contents'
op|'='
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'200'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dest_contents'
op|','
name|'source_contents'
op|')'
newline|'\n'
nl|'\n'
comment|'# delete the copy'
nl|'\n'
DECL|function|delete
name|'def'
name|'delete'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'DELETE'"
op|','
string|"'%s/%s'"
op|'%'
op|'('
name|'parsed'
op|'.'
name|'path'
op|','
name|'dest'
op|')'
op|','
string|"''"
op|','
nl|'\n'
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
dedent|''
name|'resp'
op|'='
name|'retry'
op|'('
name|'delete'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'204'
op|')'
newline|'\n'
comment|'# verify dest does not exist'
nl|'\n'
name|'resp'
op|'='
name|'retry'
op|'('
name|'get_dest'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'404'
op|')'
newline|'\n'
nl|'\n'
comment|'# copy source to dest with COPY'
nl|'\n'
DECL|function|copy
name|'def'
name|'copy'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'COPY'"
op|','
string|"'%s/%s'"
op|'%'
op|'('
name|'parsed'
op|'.'
name|'path'
op|','
name|'source'
op|')'
op|','
string|"''"
op|','
nl|'\n'
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|','
nl|'\n'
string|"'Destination'"
op|':'
name|'dest'
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
dedent|''
name|'resp'
op|'='
name|'retry'
op|'('
name|'copy'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'201'
op|')'
newline|'\n'
nl|'\n'
comment|'# contents of dest should be the same as source'
nl|'\n'
name|'resp'
op|'='
name|'retry'
op|'('
name|'get_dest'
op|')'
newline|'\n'
name|'dest_contents'
op|'='
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'200'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dest_contents'
op|','
name|'source_contents'
op|')'
newline|'\n'
nl|'\n'
comment|'# copy source to dest with COPY and range'
nl|'\n'
DECL|function|copy
name|'def'
name|'copy'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'COPY'"
op|','
string|"'%s/%s'"
op|'%'
op|'('
name|'parsed'
op|'.'
name|'path'
op|','
name|'source'
op|')'
op|','
string|"''"
op|','
nl|'\n'
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|','
nl|'\n'
string|"'Destination'"
op|':'
name|'dest'
op|','
nl|'\n'
string|"'Range'"
op|':'
string|"'bytes=1-2'"
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
dedent|''
name|'resp'
op|'='
name|'retry'
op|'('
name|'copy'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'201'
op|')'
newline|'\n'
nl|'\n'
comment|'# contents of dest should be the same as source'
nl|'\n'
name|'resp'
op|'='
name|'retry'
op|'('
name|'get_dest'
op|')'
newline|'\n'
name|'dest_contents'
op|'='
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'200'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dest_contents'
op|','
name|'source_contents'
op|'['
number|'1'
op|':'
number|'3'
op|']'
op|')'
newline|'\n'
nl|'\n'
comment|'# delete the copy'
nl|'\n'
name|'resp'
op|'='
name|'retry'
op|'('
name|'delete'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'204'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_copy_between_accounts
dedent|''
name|'def'
name|'test_copy_between_accounts'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'tf'
op|'.'
name|'skip'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'SkipTest'
newline|'\n'
nl|'\n'
dedent|''
name|'source'
op|'='
string|"'%s/%s'"
op|'%'
op|'('
name|'self'
op|'.'
name|'container'
op|','
name|'self'
op|'.'
name|'obj'
op|')'
newline|'\n'
name|'dest'
op|'='
string|"'%s/%s'"
op|'%'
op|'('
name|'self'
op|'.'
name|'container'
op|','
string|"'test_copy'"
op|')'
newline|'\n'
nl|'\n'
comment|'# get contents of source'
nl|'\n'
DECL|function|get_source
name|'def'
name|'get_source'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'GET'"
op|','
nl|'\n'
string|"'%s/%s'"
op|'%'
op|'('
name|'parsed'
op|'.'
name|'path'
op|','
name|'source'
op|')'
op|','
nl|'\n'
string|"''"
op|','
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
dedent|''
name|'resp'
op|'='
name|'retry'
op|'('
name|'get_source'
op|')'
newline|'\n'
name|'source_contents'
op|'='
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'200'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'source_contents'
op|','
string|"'test'"
op|')'
newline|'\n'
nl|'\n'
name|'acct'
op|'='
name|'tf'
op|'.'
name|'parsed'
op|'['
number|'0'
op|']'
op|'.'
name|'path'
op|'.'
name|'split'
op|'('
string|"'/'"
op|','
number|'2'
op|')'
op|'['
number|'2'
op|']'
newline|'\n'
nl|'\n'
comment|'# copy source to dest with X-Copy-From-Account'
nl|'\n'
DECL|function|put
name|'def'
name|'put'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'PUT'"
op|','
string|"'%s/%s'"
op|'%'
op|'('
name|'parsed'
op|'.'
name|'path'
op|','
name|'dest'
op|')'
op|','
string|"''"
op|','
nl|'\n'
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|','
nl|'\n'
string|"'Content-Length'"
op|':'
string|"'0'"
op|','
nl|'\n'
string|"'X-Copy-From-Account'"
op|':'
name|'acct'
op|','
nl|'\n'
string|"'X-Copy-From'"
op|':'
name|'source'
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
comment|'# try to put, will not succeed'
nl|'\n'
comment|'# user does not have permissions to read from source'
nl|'\n'
dedent|''
name|'resp'
op|'='
name|'retry'
op|'('
name|'put'
op|','
name|'use_account'
op|'='
number|'2'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'403'
op|')'
newline|'\n'
nl|'\n'
comment|'# add acl to allow reading from source'
nl|'\n'
DECL|function|post
name|'def'
name|'post'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'POST'"
op|','
string|"'%s/%s'"
op|'%'
op|'('
name|'parsed'
op|'.'
name|'path'
op|','
name|'self'
op|'.'
name|'container'
op|')'
op|','
string|"''"
op|','
nl|'\n'
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|','
nl|'\n'
string|"'X-Container-Read'"
op|':'
name|'tf'
op|'.'
name|'swift_test_perm'
op|'['
number|'1'
op|']'
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
dedent|''
name|'resp'
op|'='
name|'retry'
op|'('
name|'post'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'204'
op|')'
newline|'\n'
nl|'\n'
comment|'# retry previous put, now should succeed'
nl|'\n'
name|'resp'
op|'='
name|'retry'
op|'('
name|'put'
op|','
name|'use_account'
op|'='
number|'2'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'201'
op|')'
newline|'\n'
nl|'\n'
comment|'# contents of dest should be the same as source'
nl|'\n'
DECL|function|get_dest
name|'def'
name|'get_dest'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'GET'"
op|','
nl|'\n'
string|"'%s/%s'"
op|'%'
op|'('
name|'parsed'
op|'.'
name|'path'
op|','
name|'dest'
op|')'
op|','
nl|'\n'
string|"''"
op|','
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
dedent|''
name|'resp'
op|'='
name|'retry'
op|'('
name|'get_dest'
op|','
name|'use_account'
op|'='
number|'2'
op|')'
newline|'\n'
name|'dest_contents'
op|'='
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'200'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dest_contents'
op|','
name|'source_contents'
op|')'
newline|'\n'
nl|'\n'
comment|'# delete the copy'
nl|'\n'
DECL|function|delete
name|'def'
name|'delete'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'DELETE'"
op|','
string|"'%s/%s'"
op|'%'
op|'('
name|'parsed'
op|'.'
name|'path'
op|','
name|'dest'
op|')'
op|','
string|"''"
op|','
nl|'\n'
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
dedent|''
name|'resp'
op|'='
name|'retry'
op|'('
name|'delete'
op|','
name|'use_account'
op|'='
number|'2'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'204'
op|')'
newline|'\n'
comment|'# verify dest does not exist'
nl|'\n'
name|'resp'
op|'='
name|'retry'
op|'('
name|'get_dest'
op|','
name|'use_account'
op|'='
number|'2'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'404'
op|')'
newline|'\n'
nl|'\n'
name|'acct_dest'
op|'='
name|'tf'
op|'.'
name|'parsed'
op|'['
number|'1'
op|']'
op|'.'
name|'path'
op|'.'
name|'split'
op|'('
string|"'/'"
op|','
number|'2'
op|')'
op|'['
number|'2'
op|']'
newline|'\n'
nl|'\n'
comment|'# copy source to dest with COPY'
nl|'\n'
DECL|function|copy
name|'def'
name|'copy'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'COPY'"
op|','
string|"'%s/%s'"
op|'%'
op|'('
name|'parsed'
op|'.'
name|'path'
op|','
name|'source'
op|')'
op|','
string|"''"
op|','
nl|'\n'
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|','
nl|'\n'
string|"'Destination-Account'"
op|':'
name|'acct_dest'
op|','
nl|'\n'
string|"'Destination'"
op|':'
name|'dest'
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
comment|'# try to copy, will not succeed'
nl|'\n'
comment|'# user does not have permissions to write to destination'
nl|'\n'
dedent|''
name|'resp'
op|'='
name|'retry'
op|'('
name|'copy'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'403'
op|')'
newline|'\n'
nl|'\n'
comment|'# add acl to allow write to destination'
nl|'\n'
DECL|function|post
name|'def'
name|'post'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'POST'"
op|','
string|"'%s/%s'"
op|'%'
op|'('
name|'parsed'
op|'.'
name|'path'
op|','
name|'self'
op|'.'
name|'container'
op|')'
op|','
string|"''"
op|','
nl|'\n'
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|','
nl|'\n'
string|"'X-Container-Write'"
op|':'
name|'tf'
op|'.'
name|'swift_test_perm'
op|'['
number|'0'
op|']'
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
dedent|''
name|'resp'
op|'='
name|'retry'
op|'('
name|'post'
op|','
name|'use_account'
op|'='
number|'2'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'204'
op|')'
newline|'\n'
nl|'\n'
comment|'# now copy will succeed'
nl|'\n'
name|'resp'
op|'='
name|'retry'
op|'('
name|'copy'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'201'
op|')'
newline|'\n'
nl|'\n'
comment|'# contents of dest should be the same as source'
nl|'\n'
name|'resp'
op|'='
name|'retry'
op|'('
name|'get_dest'
op|','
name|'use_account'
op|'='
number|'2'
op|')'
newline|'\n'
name|'dest_contents'
op|'='
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'200'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dest_contents'
op|','
name|'source_contents'
op|')'
newline|'\n'
nl|'\n'
comment|'# delete the copy'
nl|'\n'
name|'resp'
op|'='
name|'retry'
op|'('
name|'delete'
op|','
name|'use_account'
op|'='
number|'2'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'204'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_public_object
dedent|''
name|'def'
name|'test_public_object'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'tf'
op|'.'
name|'skip'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'SkipTest'
newline|'\n'
nl|'\n'
DECL|function|get
dedent|''
name|'def'
name|'get'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'GET'"
op|','
nl|'\n'
string|"'%s/%s/%s'"
op|'%'
op|'('
name|'parsed'
op|'.'
name|'path'
op|','
name|'self'
op|'.'
name|'container'
op|','
name|'self'
op|'.'
name|'obj'
op|')'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
dedent|''
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'resp'
op|'='
name|'retry'
op|'('
name|'get'
op|')'
newline|'\n'
name|'raise'
name|'Exception'
op|'('
string|"'Should not have been able to GET'"
op|')'
newline|'\n'
dedent|''
name|'except'
name|'Exception'
name|'as'
name|'err'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'str'
op|'('
name|'err'
op|')'
op|'.'
name|'startswith'
op|'('
string|"'No result after '"
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|function|post
dedent|''
name|'def'
name|'post'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'POST'"
op|','
name|'parsed'
op|'.'
name|'path'
op|'+'
string|"'/'"
op|'+'
name|'self'
op|'.'
name|'container'
op|','
string|"''"
op|','
nl|'\n'
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|','
nl|'\n'
string|"'X-Container-Read'"
op|':'
string|"'.r:*'"
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
dedent|''
name|'resp'
op|'='
name|'retry'
op|'('
name|'post'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'204'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'retry'
op|'('
name|'get'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'200'
op|')'
newline|'\n'
nl|'\n'
DECL|function|post
name|'def'
name|'post'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'POST'"
op|','
name|'parsed'
op|'.'
name|'path'
op|'+'
string|"'/'"
op|'+'
name|'self'
op|'.'
name|'container'
op|','
string|"''"
op|','
nl|'\n'
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|','
string|"'X-Container-Read'"
op|':'
string|"''"
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
dedent|''
name|'resp'
op|'='
name|'retry'
op|'('
name|'post'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'204'
op|')'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'resp'
op|'='
name|'retry'
op|'('
name|'get'
op|')'
newline|'\n'
name|'raise'
name|'Exception'
op|'('
string|"'Should not have been able to GET'"
op|')'
newline|'\n'
dedent|''
name|'except'
name|'Exception'
name|'as'
name|'err'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'str'
op|'('
name|'err'
op|')'
op|'.'
name|'startswith'
op|'('
string|"'No result after '"
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_private_object
dedent|''
dedent|''
name|'def'
name|'test_private_object'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'tf'
op|'.'
name|'skip'
name|'or'
name|'tf'
op|'.'
name|'skip3'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'SkipTest'
newline|'\n'
nl|'\n'
comment|"# Ensure we can't access the object with the third account"
nl|'\n'
DECL|function|get
dedent|''
name|'def'
name|'get'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'GET'"
op|','
string|"'%s/%s/%s'"
op|'%'
op|'('
nl|'\n'
name|'parsed'
op|'.'
name|'path'
op|','
name|'self'
op|'.'
name|'container'
op|','
name|'self'
op|'.'
name|'obj'
op|')'
op|','
string|"''"
op|','
nl|'\n'
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
dedent|''
name|'resp'
op|'='
name|'retry'
op|'('
name|'get'
op|','
name|'use_account'
op|'='
number|'3'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'403'
op|')'
newline|'\n'
nl|'\n'
comment|'# create a shared container writable by account3'
nl|'\n'
name|'shared_container'
op|'='
name|'uuid4'
op|'('
op|')'
op|'.'
name|'hex'
newline|'\n'
nl|'\n'
DECL|function|put
name|'def'
name|'put'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'PUT'"
op|','
string|"'%s/%s'"
op|'%'
op|'('
nl|'\n'
name|'parsed'
op|'.'
name|'path'
op|','
name|'shared_container'
op|')'
op|','
string|"''"
op|','
nl|'\n'
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|','
nl|'\n'
string|"'X-Container-Read'"
op|':'
name|'tf'
op|'.'
name|'swift_test_perm'
op|'['
number|'2'
op|']'
op|','
nl|'\n'
string|"'X-Container-Write'"
op|':'
name|'tf'
op|'.'
name|'swift_test_perm'
op|'['
number|'2'
op|']'
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
dedent|''
name|'resp'
op|'='
name|'retry'
op|'('
name|'put'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'201'
op|')'
newline|'\n'
nl|'\n'
comment|'# verify third account can not copy from private container'
nl|'\n'
DECL|function|copy
name|'def'
name|'copy'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'PUT'"
op|','
string|"'%s/%s/%s'"
op|'%'
op|'('
nl|'\n'
name|'parsed'
op|'.'
name|'path'
op|','
name|'shared_container'
op|','
string|"'private_object'"
op|')'
op|','
string|"''"
op|','
nl|'\n'
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|','
nl|'\n'
string|"'Content-Length'"
op|':'
string|"'0'"
op|','
nl|'\n'
string|"'X-Copy-From'"
op|':'
string|"'%s/%s'"
op|'%'
op|'('
name|'self'
op|'.'
name|'container'
op|','
name|'self'
op|'.'
name|'obj'
op|')'
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
dedent|''
name|'resp'
op|'='
name|'retry'
op|'('
name|'copy'
op|','
name|'use_account'
op|'='
number|'3'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'403'
op|')'
newline|'\n'
nl|'\n'
comment|'# verify third account can write "obj1" to shared container'
nl|'\n'
DECL|function|put
name|'def'
name|'put'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'PUT'"
op|','
string|"'%s/%s/%s'"
op|'%'
op|'('
nl|'\n'
name|'parsed'
op|'.'
name|'path'
op|','
name|'shared_container'
op|','
string|"'obj1'"
op|')'
op|','
string|"'test'"
op|','
nl|'\n'
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
dedent|''
name|'resp'
op|'='
name|'retry'
op|'('
name|'put'
op|','
name|'use_account'
op|'='
number|'3'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'201'
op|')'
newline|'\n'
nl|'\n'
comment|'# verify third account can copy "obj1" to shared container'
nl|'\n'
DECL|function|copy2
name|'def'
name|'copy2'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'COPY'"
op|','
string|"'%s/%s/%s'"
op|'%'
op|'('
nl|'\n'
name|'parsed'
op|'.'
name|'path'
op|','
name|'shared_container'
op|','
string|"'obj1'"
op|')'
op|','
string|"''"
op|','
nl|'\n'
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|','
nl|'\n'
string|"'Destination'"
op|':'
string|"'%s/%s'"
op|'%'
op|'('
name|'shared_container'
op|','
string|"'obj1'"
op|')'
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
dedent|''
name|'resp'
op|'='
name|'retry'
op|'('
name|'copy2'
op|','
name|'use_account'
op|'='
number|'3'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'201'
op|')'
newline|'\n'
nl|'\n'
comment|'# verify third account STILL can not copy from private container'
nl|'\n'
DECL|function|copy3
name|'def'
name|'copy3'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'COPY'"
op|','
string|"'%s/%s/%s'"
op|'%'
op|'('
nl|'\n'
name|'parsed'
op|'.'
name|'path'
op|','
name|'self'
op|'.'
name|'container'
op|','
name|'self'
op|'.'
name|'obj'
op|')'
op|','
string|"''"
op|','
nl|'\n'
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|','
nl|'\n'
string|"'Destination'"
op|':'
string|"'%s/%s'"
op|'%'
op|'('
name|'shared_container'
op|','
nl|'\n'
string|"'private_object'"
op|')'
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
dedent|''
name|'resp'
op|'='
name|'retry'
op|'('
name|'copy3'
op|','
name|'use_account'
op|'='
number|'3'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'403'
op|')'
newline|'\n'
nl|'\n'
comment|'# clean up "obj1"'
nl|'\n'
DECL|function|delete
name|'def'
name|'delete'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'DELETE'"
op|','
string|"'%s/%s/%s'"
op|'%'
op|'('
nl|'\n'
name|'parsed'
op|'.'
name|'path'
op|','
name|'shared_container'
op|','
string|"'obj1'"
op|')'
op|','
string|"''"
op|','
nl|'\n'
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
dedent|''
name|'resp'
op|'='
name|'retry'
op|'('
name|'delete'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'204'
op|')'
newline|'\n'
nl|'\n'
comment|'# clean up shared_container'
nl|'\n'
DECL|function|delete
name|'def'
name|'delete'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'DELETE'"
op|','
nl|'\n'
name|'parsed'
op|'.'
name|'path'
op|'+'
string|"'/'"
op|'+'
name|'shared_container'
op|','
string|"''"
op|','
nl|'\n'
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
dedent|''
name|'resp'
op|'='
name|'retry'
op|'('
name|'delete'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'204'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_container_write_only
dedent|''
name|'def'
name|'test_container_write_only'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'tf'
op|'.'
name|'skip'
name|'or'
name|'tf'
op|'.'
name|'skip3'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'SkipTest'
newline|'\n'
nl|'\n'
comment|"# Ensure we can't access the object with the third account"
nl|'\n'
DECL|function|get
dedent|''
name|'def'
name|'get'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'GET'"
op|','
string|"'%s/%s/%s'"
op|'%'
op|'('
nl|'\n'
name|'parsed'
op|'.'
name|'path'
op|','
name|'self'
op|'.'
name|'container'
op|','
name|'self'
op|'.'
name|'obj'
op|')'
op|','
string|"''"
op|','
nl|'\n'
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
dedent|''
name|'resp'
op|'='
name|'retry'
op|'('
name|'get'
op|','
name|'use_account'
op|'='
number|'3'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'403'
op|')'
newline|'\n'
nl|'\n'
comment|'# create a shared container writable (but not readable) by account3'
nl|'\n'
name|'shared_container'
op|'='
name|'uuid4'
op|'('
op|')'
op|'.'
name|'hex'
newline|'\n'
nl|'\n'
DECL|function|put
name|'def'
name|'put'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'PUT'"
op|','
string|"'%s/%s'"
op|'%'
op|'('
nl|'\n'
name|'parsed'
op|'.'
name|'path'
op|','
name|'shared_container'
op|')'
op|','
string|"''"
op|','
nl|'\n'
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|','
nl|'\n'
string|"'X-Container-Write'"
op|':'
name|'tf'
op|'.'
name|'swift_test_perm'
op|'['
number|'2'
op|']'
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
dedent|''
name|'resp'
op|'='
name|'retry'
op|'('
name|'put'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'201'
op|')'
newline|'\n'
nl|'\n'
comment|'# verify third account can write "obj1" to shared container'
nl|'\n'
DECL|function|put
name|'def'
name|'put'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'PUT'"
op|','
string|"'%s/%s/%s'"
op|'%'
op|'('
nl|'\n'
name|'parsed'
op|'.'
name|'path'
op|','
name|'shared_container'
op|','
string|"'obj1'"
op|')'
op|','
string|"'test'"
op|','
nl|'\n'
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
dedent|''
name|'resp'
op|'='
name|'retry'
op|'('
name|'put'
op|','
name|'use_account'
op|'='
number|'3'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'201'
op|')'
newline|'\n'
nl|'\n'
comment|'# verify third account cannot copy "obj1" to shared container'
nl|'\n'
DECL|function|copy
name|'def'
name|'copy'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'COPY'"
op|','
string|"'%s/%s/%s'"
op|'%'
op|'('
nl|'\n'
name|'parsed'
op|'.'
name|'path'
op|','
name|'shared_container'
op|','
string|"'obj1'"
op|')'
op|','
string|"''"
op|','
nl|'\n'
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|','
nl|'\n'
string|"'Destination'"
op|':'
string|"'%s/%s'"
op|'%'
op|'('
name|'shared_container'
op|','
string|"'obj2'"
op|')'
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
dedent|''
name|'resp'
op|'='
name|'retry'
op|'('
name|'copy'
op|','
name|'use_account'
op|'='
number|'3'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'403'
op|')'
newline|'\n'
nl|'\n'
comment|'# verify third account can POST to "obj1" in shared container'
nl|'\n'
DECL|function|post
name|'def'
name|'post'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'POST'"
op|','
string|"'%s/%s/%s'"
op|'%'
op|'('
nl|'\n'
name|'parsed'
op|'.'
name|'path'
op|','
name|'shared_container'
op|','
string|"'obj1'"
op|')'
op|','
string|"''"
op|','
nl|'\n'
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|','
nl|'\n'
string|"'X-Object-Meta-Color'"
op|':'
string|"'blue'"
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
dedent|''
name|'resp'
op|'='
name|'retry'
op|'('
name|'post'
op|','
name|'use_account'
op|'='
number|'3'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'202'
op|')'
newline|'\n'
nl|'\n'
comment|'# verify third account can DELETE from shared container'
nl|'\n'
DECL|function|delete
name|'def'
name|'delete'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'DELETE'"
op|','
string|"'%s/%s/%s'"
op|'%'
op|'('
nl|'\n'
name|'parsed'
op|'.'
name|'path'
op|','
name|'shared_container'
op|','
string|"'obj1'"
op|')'
op|','
string|"''"
op|','
nl|'\n'
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
dedent|''
name|'resp'
op|'='
name|'retry'
op|'('
name|'delete'
op|','
name|'use_account'
op|'='
number|'3'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'204'
op|')'
newline|'\n'
nl|'\n'
comment|'# clean up shared_container'
nl|'\n'
DECL|function|delete
name|'def'
name|'delete'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'DELETE'"
op|','
nl|'\n'
name|'parsed'
op|'.'
name|'path'
op|'+'
string|"'/'"
op|'+'
name|'shared_container'
op|','
string|"''"
op|','
nl|'\n'
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
dedent|''
name|'resp'
op|'='
name|'retry'
op|'('
name|'delete'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'204'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'requires_acls'
newline|'\n'
DECL|member|test_read_only
name|'def'
name|'test_read_only'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'tf'
op|'.'
name|'skip3'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'tf'
op|'.'
name|'SkipTest'
newline|'\n'
nl|'\n'
DECL|function|get_listing
dedent|''
name|'def'
name|'get_listing'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'GET'"
op|','
string|"'%s/%s'"
op|'%'
op|'('
name|'parsed'
op|'.'
name|'path'
op|','
name|'self'
op|'.'
name|'container'
op|')'
op|','
string|"''"
op|','
nl|'\n'
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
nl|'\n'
DECL|function|post_account
dedent|''
name|'def'
name|'post_account'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|','
name|'headers'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'new_headers'
op|'='
name|'dict'
op|'('
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|'}'
op|','
op|'**'
name|'headers'
op|')'
newline|'\n'
name|'conn'
op|'.'
name|'request'
op|'('
string|"'POST'"
op|','
name|'parsed'
op|'.'
name|'path'
op|','
string|"''"
op|','
name|'new_headers'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
nl|'\n'
DECL|function|get
dedent|''
name|'def'
name|'get'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|','
name|'name'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'GET'"
op|','
string|"'%s/%s/%s'"
op|'%'
op|'('
nl|'\n'
name|'parsed'
op|'.'
name|'path'
op|','
name|'self'
op|'.'
name|'container'
op|','
name|'name'
op|')'
op|','
string|"''"
op|','
nl|'\n'
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
nl|'\n'
DECL|function|put
dedent|''
name|'def'
name|'put'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|','
name|'name'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'PUT'"
op|','
string|"'%s/%s/%s'"
op|'%'
op|'('
nl|'\n'
name|'parsed'
op|'.'
name|'path'
op|','
name|'self'
op|'.'
name|'container'
op|','
name|'name'
op|')'
op|','
string|"'test'"
op|','
nl|'\n'
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
nl|'\n'
DECL|function|delete
dedent|''
name|'def'
name|'delete'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|','
name|'name'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'PUT'"
op|','
string|"'%s/%s/%s'"
op|'%'
op|'('
nl|'\n'
name|'parsed'
op|'.'
name|'path'
op|','
name|'self'
op|'.'
name|'container'
op|','
name|'name'
op|')'
op|','
string|"''"
op|','
nl|'\n'
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
nl|'\n'
comment|'# cannot list objects'
nl|'\n'
dedent|''
name|'resp'
op|'='
name|'retry'
op|'('
name|'get_listing'
op|','
name|'use_account'
op|'='
number|'3'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'403'
op|')'
newline|'\n'
nl|'\n'
comment|'# cannot get object'
nl|'\n'
name|'resp'
op|'='
name|'retry'
op|'('
name|'get'
op|','
name|'self'
op|'.'
name|'obj'
op|','
name|'use_account'
op|'='
number|'3'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'403'
op|')'
newline|'\n'
nl|'\n'
comment|'# grant read-only access'
nl|'\n'
name|'acl_user'
op|'='
name|'tf'
op|'.'
name|'swift_test_user'
op|'['
number|'2'
op|']'
newline|'\n'
name|'acl'
op|'='
op|'{'
string|"'read-only'"
op|':'
op|'['
name|'acl_user'
op|']'
op|'}'
newline|'\n'
name|'headers'
op|'='
op|'{'
string|"'x-account-access-control'"
op|':'
name|'json'
op|'.'
name|'dumps'
op|'('
name|'acl'
op|')'
op|'}'
newline|'\n'
name|'resp'
op|'='
name|'retry'
op|'('
name|'post_account'
op|','
name|'headers'
op|'='
name|'headers'
op|','
name|'use_account'
op|'='
number|'1'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'204'
op|')'
newline|'\n'
nl|'\n'
comment|'# can list objects'
nl|'\n'
name|'resp'
op|'='
name|'retry'
op|'('
name|'get_listing'
op|','
name|'use_account'
op|'='
number|'3'
op|')'
newline|'\n'
name|'listing'
op|'='
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'200'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertIn'
op|'('
name|'self'
op|'.'
name|'obj'
op|','
name|'listing'
op|')'
newline|'\n'
nl|'\n'
comment|'# can get object'
nl|'\n'
name|'resp'
op|'='
name|'retry'
op|'('
name|'get'
op|','
name|'self'
op|'.'
name|'obj'
op|','
name|'use_account'
op|'='
number|'3'
op|')'
newline|'\n'
name|'body'
op|'='
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'200'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'body'
op|','
string|"'test'"
op|')'
newline|'\n'
nl|'\n'
comment|'# can not put an object'
nl|'\n'
name|'obj_name'
op|'='
name|'str'
op|'('
name|'uuid4'
op|'('
op|')'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'retry'
op|'('
name|'put'
op|','
name|'obj_name'
op|','
name|'use_account'
op|'='
number|'3'
op|')'
newline|'\n'
name|'body'
op|'='
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'403'
op|')'
newline|'\n'
nl|'\n'
comment|'# can not delete an object'
nl|'\n'
name|'resp'
op|'='
name|'retry'
op|'('
name|'delete'
op|','
name|'self'
op|'.'
name|'obj'
op|','
name|'use_account'
op|'='
number|'3'
op|')'
newline|'\n'
name|'body'
op|'='
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'403'
op|')'
newline|'\n'
nl|'\n'
comment|'# sanity with account1'
nl|'\n'
name|'resp'
op|'='
name|'retry'
op|'('
name|'get_listing'
op|','
name|'use_account'
op|'='
number|'3'
op|')'
newline|'\n'
name|'listing'
op|'='
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'200'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertNotIn'
op|'('
name|'obj_name'
op|','
name|'listing'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertIn'
op|'('
name|'self'
op|'.'
name|'obj'
op|','
name|'listing'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'requires_acls'
newline|'\n'
DECL|member|test_read_write
name|'def'
name|'test_read_write'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'tf'
op|'.'
name|'skip3'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'SkipTest'
newline|'\n'
nl|'\n'
DECL|function|get_listing
dedent|''
name|'def'
name|'get_listing'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'GET'"
op|','
string|"'%s/%s'"
op|'%'
op|'('
name|'parsed'
op|'.'
name|'path'
op|','
name|'self'
op|'.'
name|'container'
op|')'
op|','
string|"''"
op|','
nl|'\n'
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
nl|'\n'
DECL|function|post_account
dedent|''
name|'def'
name|'post_account'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|','
name|'headers'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'new_headers'
op|'='
name|'dict'
op|'('
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|'}'
op|','
op|'**'
name|'headers'
op|')'
newline|'\n'
name|'conn'
op|'.'
name|'request'
op|'('
string|"'POST'"
op|','
name|'parsed'
op|'.'
name|'path'
op|','
string|"''"
op|','
name|'new_headers'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
nl|'\n'
DECL|function|get
dedent|''
name|'def'
name|'get'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|','
name|'name'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'GET'"
op|','
string|"'%s/%s/%s'"
op|'%'
op|'('
nl|'\n'
name|'parsed'
op|'.'
name|'path'
op|','
name|'self'
op|'.'
name|'container'
op|','
name|'name'
op|')'
op|','
string|"''"
op|','
nl|'\n'
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
nl|'\n'
DECL|function|put
dedent|''
name|'def'
name|'put'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|','
name|'name'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'PUT'"
op|','
string|"'%s/%s/%s'"
op|'%'
op|'('
nl|'\n'
name|'parsed'
op|'.'
name|'path'
op|','
name|'self'
op|'.'
name|'container'
op|','
name|'name'
op|')'
op|','
string|"'test'"
op|','
nl|'\n'
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
nl|'\n'
DECL|function|delete
dedent|''
name|'def'
name|'delete'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|','
name|'name'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'DELETE'"
op|','
string|"'%s/%s/%s'"
op|'%'
op|'('
nl|'\n'
name|'parsed'
op|'.'
name|'path'
op|','
name|'self'
op|'.'
name|'container'
op|','
name|'name'
op|')'
op|','
string|"''"
op|','
nl|'\n'
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
nl|'\n'
comment|'# cannot list objects'
nl|'\n'
dedent|''
name|'resp'
op|'='
name|'retry'
op|'('
name|'get_listing'
op|','
name|'use_account'
op|'='
number|'3'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'403'
op|')'
newline|'\n'
nl|'\n'
comment|'# cannot get object'
nl|'\n'
name|'resp'
op|'='
name|'retry'
op|'('
name|'get'
op|','
name|'self'
op|'.'
name|'obj'
op|','
name|'use_account'
op|'='
number|'3'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'403'
op|')'
newline|'\n'
nl|'\n'
comment|'# grant read-write access'
nl|'\n'
name|'acl_user'
op|'='
name|'tf'
op|'.'
name|'swift_test_user'
op|'['
number|'2'
op|']'
newline|'\n'
name|'acl'
op|'='
op|'{'
string|"'read-write'"
op|':'
op|'['
name|'acl_user'
op|']'
op|'}'
newline|'\n'
name|'headers'
op|'='
op|'{'
string|"'x-account-access-control'"
op|':'
name|'json'
op|'.'
name|'dumps'
op|'('
name|'acl'
op|')'
op|'}'
newline|'\n'
name|'resp'
op|'='
name|'retry'
op|'('
name|'post_account'
op|','
name|'headers'
op|'='
name|'headers'
op|','
name|'use_account'
op|'='
number|'1'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'204'
op|')'
newline|'\n'
nl|'\n'
comment|'# can list objects'
nl|'\n'
name|'resp'
op|'='
name|'retry'
op|'('
name|'get_listing'
op|','
name|'use_account'
op|'='
number|'3'
op|')'
newline|'\n'
name|'listing'
op|'='
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'200'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertIn'
op|'('
name|'self'
op|'.'
name|'obj'
op|','
name|'listing'
op|')'
newline|'\n'
nl|'\n'
comment|'# can get object'
nl|'\n'
name|'resp'
op|'='
name|'retry'
op|'('
name|'get'
op|','
name|'self'
op|'.'
name|'obj'
op|','
name|'use_account'
op|'='
number|'3'
op|')'
newline|'\n'
name|'body'
op|'='
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'200'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'body'
op|','
string|"'test'"
op|')'
newline|'\n'
nl|'\n'
comment|'# can put an object'
nl|'\n'
name|'obj_name'
op|'='
name|'str'
op|'('
name|'uuid4'
op|'('
op|')'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'retry'
op|'('
name|'put'
op|','
name|'obj_name'
op|','
name|'use_account'
op|'='
number|'3'
op|')'
newline|'\n'
name|'body'
op|'='
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'201'
op|')'
newline|'\n'
nl|'\n'
comment|'# can delete an object'
nl|'\n'
name|'resp'
op|'='
name|'retry'
op|'('
name|'delete'
op|','
name|'self'
op|'.'
name|'obj'
op|','
name|'use_account'
op|'='
number|'3'
op|')'
newline|'\n'
name|'body'
op|'='
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'204'
op|')'
newline|'\n'
nl|'\n'
comment|'# sanity with account1'
nl|'\n'
name|'resp'
op|'='
name|'retry'
op|'('
name|'get_listing'
op|','
name|'use_account'
op|'='
number|'3'
op|')'
newline|'\n'
name|'listing'
op|'='
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'200'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertIn'
op|'('
name|'obj_name'
op|','
name|'listing'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertNotIn'
op|'('
name|'self'
op|'.'
name|'obj'
op|','
name|'listing'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'requires_acls'
newline|'\n'
DECL|member|test_admin
name|'def'
name|'test_admin'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'tf'
op|'.'
name|'skip3'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'SkipTest'
newline|'\n'
nl|'\n'
DECL|function|get_listing
dedent|''
name|'def'
name|'get_listing'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'GET'"
op|','
string|"'%s/%s'"
op|'%'
op|'('
name|'parsed'
op|'.'
name|'path'
op|','
name|'self'
op|'.'
name|'container'
op|')'
op|','
string|"''"
op|','
nl|'\n'
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
nl|'\n'
DECL|function|post_account
dedent|''
name|'def'
name|'post_account'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|','
name|'headers'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'new_headers'
op|'='
name|'dict'
op|'('
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|'}'
op|','
op|'**'
name|'headers'
op|')'
newline|'\n'
name|'conn'
op|'.'
name|'request'
op|'('
string|"'POST'"
op|','
name|'parsed'
op|'.'
name|'path'
op|','
string|"''"
op|','
name|'new_headers'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
nl|'\n'
DECL|function|get
dedent|''
name|'def'
name|'get'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|','
name|'name'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'GET'"
op|','
string|"'%s/%s/%s'"
op|'%'
op|'('
nl|'\n'
name|'parsed'
op|'.'
name|'path'
op|','
name|'self'
op|'.'
name|'container'
op|','
name|'name'
op|')'
op|','
string|"''"
op|','
nl|'\n'
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
nl|'\n'
DECL|function|put
dedent|''
name|'def'
name|'put'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|','
name|'name'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'PUT'"
op|','
string|"'%s/%s/%s'"
op|'%'
op|'('
nl|'\n'
name|'parsed'
op|'.'
name|'path'
op|','
name|'self'
op|'.'
name|'container'
op|','
name|'name'
op|')'
op|','
string|"'test'"
op|','
nl|'\n'
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
nl|'\n'
DECL|function|delete
dedent|''
name|'def'
name|'delete'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|','
name|'name'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'DELETE'"
op|','
string|"'%s/%s/%s'"
op|'%'
op|'('
nl|'\n'
name|'parsed'
op|'.'
name|'path'
op|','
name|'self'
op|'.'
name|'container'
op|','
name|'name'
op|')'
op|','
string|"''"
op|','
nl|'\n'
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
nl|'\n'
comment|'# cannot list objects'
nl|'\n'
dedent|''
name|'resp'
op|'='
name|'retry'
op|'('
name|'get_listing'
op|','
name|'use_account'
op|'='
number|'3'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'403'
op|')'
newline|'\n'
nl|'\n'
comment|'# cannot get object'
nl|'\n'
name|'resp'
op|'='
name|'retry'
op|'('
name|'get'
op|','
name|'self'
op|'.'
name|'obj'
op|','
name|'use_account'
op|'='
number|'3'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'403'
op|')'
newline|'\n'
nl|'\n'
comment|'# grant admin access'
nl|'\n'
name|'acl_user'
op|'='
name|'tf'
op|'.'
name|'swift_test_user'
op|'['
number|'2'
op|']'
newline|'\n'
name|'acl'
op|'='
op|'{'
string|"'admin'"
op|':'
op|'['
name|'acl_user'
op|']'
op|'}'
newline|'\n'
name|'headers'
op|'='
op|'{'
string|"'x-account-access-control'"
op|':'
name|'json'
op|'.'
name|'dumps'
op|'('
name|'acl'
op|')'
op|'}'
newline|'\n'
name|'resp'
op|'='
name|'retry'
op|'('
name|'post_account'
op|','
name|'headers'
op|'='
name|'headers'
op|','
name|'use_account'
op|'='
number|'1'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'204'
op|')'
newline|'\n'
nl|'\n'
comment|'# can list objects'
nl|'\n'
name|'resp'
op|'='
name|'retry'
op|'('
name|'get_listing'
op|','
name|'use_account'
op|'='
number|'3'
op|')'
newline|'\n'
name|'listing'
op|'='
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'200'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertIn'
op|'('
name|'self'
op|'.'
name|'obj'
op|','
name|'listing'
op|')'
newline|'\n'
nl|'\n'
comment|'# can get object'
nl|'\n'
name|'resp'
op|'='
name|'retry'
op|'('
name|'get'
op|','
name|'self'
op|'.'
name|'obj'
op|','
name|'use_account'
op|'='
number|'3'
op|')'
newline|'\n'
name|'body'
op|'='
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'200'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'body'
op|','
string|"'test'"
op|')'
newline|'\n'
nl|'\n'
comment|'# can put an object'
nl|'\n'
name|'obj_name'
op|'='
name|'str'
op|'('
name|'uuid4'
op|'('
op|')'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'retry'
op|'('
name|'put'
op|','
name|'obj_name'
op|','
name|'use_account'
op|'='
number|'3'
op|')'
newline|'\n'
name|'body'
op|'='
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'201'
op|')'
newline|'\n'
nl|'\n'
comment|'# can delete an object'
nl|'\n'
name|'resp'
op|'='
name|'retry'
op|'('
name|'delete'
op|','
name|'self'
op|'.'
name|'obj'
op|','
name|'use_account'
op|'='
number|'3'
op|')'
newline|'\n'
name|'body'
op|'='
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'204'
op|')'
newline|'\n'
nl|'\n'
comment|'# sanity with account1'
nl|'\n'
name|'resp'
op|'='
name|'retry'
op|'('
name|'get_listing'
op|','
name|'use_account'
op|'='
number|'3'
op|')'
newline|'\n'
name|'listing'
op|'='
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'200'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertIn'
op|'('
name|'obj_name'
op|','
name|'listing'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertNotIn'
op|'('
name|'self'
op|'.'
name|'obj'
op|','
name|'listing'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_manifest
dedent|''
name|'def'
name|'test_manifest'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'tf'
op|'.'
name|'skip'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'SkipTest'
newline|'\n'
comment|'# Data for the object segments'
nl|'\n'
dedent|''
name|'segments1'
op|'='
op|'['
string|"'one'"
op|','
string|"'two'"
op|','
string|"'three'"
op|','
string|"'four'"
op|','
string|"'five'"
op|']'
newline|'\n'
name|'segments2'
op|'='
op|'['
string|"'six'"
op|','
string|"'seven'"
op|','
string|"'eight'"
op|']'
newline|'\n'
name|'segments3'
op|'='
op|'['
string|"'nine'"
op|','
string|"'ten'"
op|','
string|"'eleven'"
op|']'
newline|'\n'
nl|'\n'
comment|'# Upload the first set of segments'
nl|'\n'
DECL|function|put
name|'def'
name|'put'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|','
name|'objnum'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'PUT'"
op|','
string|"'%s/%s/segments1/%s'"
op|'%'
op|'('
nl|'\n'
name|'parsed'
op|'.'
name|'path'
op|','
name|'self'
op|'.'
name|'container'
op|','
name|'str'
op|'('
name|'objnum'
op|')'
op|')'
op|','
name|'segments1'
op|'['
name|'objnum'
op|']'
op|','
nl|'\n'
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
dedent|''
name|'for'
name|'objnum'
name|'in'
name|'range'
op|'('
name|'len'
op|'('
name|'segments1'
op|')'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'resp'
op|'='
name|'retry'
op|'('
name|'put'
op|','
name|'objnum'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'201'
op|')'
newline|'\n'
nl|'\n'
comment|'# Upload the manifest'
nl|'\n'
DECL|function|put
dedent|''
name|'def'
name|'put'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'PUT'"
op|','
string|"'%s/%s/manifest'"
op|'%'
op|'('
nl|'\n'
name|'parsed'
op|'.'
name|'path'
op|','
name|'self'
op|'.'
name|'container'
op|')'
op|','
string|"''"
op|','
op|'{'
nl|'\n'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|','
nl|'\n'
string|"'X-Object-Manifest'"
op|':'
string|"'%s/segments1/'"
op|'%'
name|'self'
op|'.'
name|'container'
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'text/jibberish'"
op|','
string|"'Content-Length'"
op|':'
string|"'0'"
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
dedent|''
name|'resp'
op|'='
name|'retry'
op|'('
name|'put'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'201'
op|')'
newline|'\n'
nl|'\n'
comment|'# Get the manifest (should get all the segments as the body)'
nl|'\n'
DECL|function|get
name|'def'
name|'get'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'GET'"
op|','
string|"'%s/%s/manifest'"
op|'%'
op|'('
nl|'\n'
name|'parsed'
op|'.'
name|'path'
op|','
name|'self'
op|'.'
name|'container'
op|')'
op|','
string|"''"
op|','
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
dedent|''
name|'resp'
op|'='
name|'retry'
op|'('
name|'get'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
op|','
string|"''"
op|'.'
name|'join'
op|'('
name|'segments1'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'200'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'getheader'
op|'('
string|"'content-type'"
op|')'
op|','
string|"'text/jibberish'"
op|')'
newline|'\n'
nl|'\n'
comment|'# Get with a range at the start of the second segment'
nl|'\n'
DECL|function|get
name|'def'
name|'get'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'GET'"
op|','
string|"'%s/%s/manifest'"
op|'%'
op|'('
nl|'\n'
name|'parsed'
op|'.'
name|'path'
op|','
name|'self'
op|'.'
name|'container'
op|')'
op|','
string|"''"
op|','
op|'{'
nl|'\n'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|','
string|"'Range'"
op|':'
string|"'bytes=3-'"
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
dedent|''
name|'resp'
op|'='
name|'retry'
op|'('
name|'get'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
op|','
string|"''"
op|'.'
name|'join'
op|'('
name|'segments1'
op|'['
number|'1'
op|':'
op|']'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'206'
op|')'
newline|'\n'
nl|'\n'
comment|'# Get with a range in the middle of the second segment'
nl|'\n'
DECL|function|get
name|'def'
name|'get'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'GET'"
op|','
string|"'%s/%s/manifest'"
op|'%'
op|'('
nl|'\n'
name|'parsed'
op|'.'
name|'path'
op|','
name|'self'
op|'.'
name|'container'
op|')'
op|','
string|"''"
op|','
op|'{'
nl|'\n'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|','
string|"'Range'"
op|':'
string|"'bytes=5-'"
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
dedent|''
name|'resp'
op|'='
name|'retry'
op|'('
name|'get'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
op|','
string|"''"
op|'.'
name|'join'
op|'('
name|'segments1'
op|')'
op|'['
number|'5'
op|':'
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'206'
op|')'
newline|'\n'
nl|'\n'
comment|'# Get with a full start and stop range'
nl|'\n'
DECL|function|get
name|'def'
name|'get'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'GET'"
op|','
string|"'%s/%s/manifest'"
op|'%'
op|'('
nl|'\n'
name|'parsed'
op|'.'
name|'path'
op|','
name|'self'
op|'.'
name|'container'
op|')'
op|','
string|"''"
op|','
op|'{'
nl|'\n'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|','
string|"'Range'"
op|':'
string|"'bytes=5-10'"
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
dedent|''
name|'resp'
op|'='
name|'retry'
op|'('
name|'get'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
op|','
string|"''"
op|'.'
name|'join'
op|'('
name|'segments1'
op|')'
op|'['
number|'5'
op|':'
number|'11'
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'206'
op|')'
newline|'\n'
nl|'\n'
comment|'# Upload the second set of segments'
nl|'\n'
DECL|function|put
name|'def'
name|'put'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|','
name|'objnum'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'PUT'"
op|','
string|"'%s/%s/segments2/%s'"
op|'%'
op|'('
nl|'\n'
name|'parsed'
op|'.'
name|'path'
op|','
name|'self'
op|'.'
name|'container'
op|','
name|'str'
op|'('
name|'objnum'
op|')'
op|')'
op|','
name|'segments2'
op|'['
name|'objnum'
op|']'
op|','
nl|'\n'
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
dedent|''
name|'for'
name|'objnum'
name|'in'
name|'range'
op|'('
name|'len'
op|'('
name|'segments2'
op|')'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'resp'
op|'='
name|'retry'
op|'('
name|'put'
op|','
name|'objnum'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'201'
op|')'
newline|'\n'
nl|'\n'
comment|'# Get the manifest (should still be the first segments of course)'
nl|'\n'
DECL|function|get
dedent|''
name|'def'
name|'get'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'GET'"
op|','
string|"'%s/%s/manifest'"
op|'%'
op|'('
nl|'\n'
name|'parsed'
op|'.'
name|'path'
op|','
name|'self'
op|'.'
name|'container'
op|')'
op|','
string|"''"
op|','
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
dedent|''
name|'resp'
op|'='
name|'retry'
op|'('
name|'get'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
op|','
string|"''"
op|'.'
name|'join'
op|'('
name|'segments1'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'200'
op|')'
newline|'\n'
nl|'\n'
comment|'# Update the manifest'
nl|'\n'
DECL|function|put
name|'def'
name|'put'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'PUT'"
op|','
string|"'%s/%s/manifest'"
op|'%'
op|'('
nl|'\n'
name|'parsed'
op|'.'
name|'path'
op|','
name|'self'
op|'.'
name|'container'
op|')'
op|','
string|"''"
op|','
op|'{'
nl|'\n'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|','
nl|'\n'
string|"'X-Object-Manifest'"
op|':'
string|"'%s/segments2/'"
op|'%'
name|'self'
op|'.'
name|'container'
op|','
nl|'\n'
string|"'Content-Length'"
op|':'
string|"'0'"
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
dedent|''
name|'resp'
op|'='
name|'retry'
op|'('
name|'put'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'201'
op|')'
newline|'\n'
nl|'\n'
comment|'# Get the manifest (should be the second set of segments now)'
nl|'\n'
DECL|function|get
name|'def'
name|'get'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'GET'"
op|','
string|"'%s/%s/manifest'"
op|'%'
op|'('
nl|'\n'
name|'parsed'
op|'.'
name|'path'
op|','
name|'self'
op|'.'
name|'container'
op|')'
op|','
string|"''"
op|','
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
dedent|''
name|'resp'
op|'='
name|'retry'
op|'('
name|'get'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
op|','
string|"''"
op|'.'
name|'join'
op|'('
name|'segments2'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'200'
op|')'
newline|'\n'
nl|'\n'
name|'if'
name|'not'
name|'tf'
op|'.'
name|'skip3'
op|':'
newline|'\n'
nl|'\n'
comment|"# Ensure we can't access the manifest with the third account"
nl|'\n'
DECL|function|get
indent|'            '
name|'def'
name|'get'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'GET'"
op|','
string|"'%s/%s/manifest'"
op|'%'
op|'('
nl|'\n'
name|'parsed'
op|'.'
name|'path'
op|','
name|'self'
op|'.'
name|'container'
op|')'
op|','
string|"''"
op|','
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
dedent|''
name|'resp'
op|'='
name|'retry'
op|'('
name|'get'
op|','
name|'use_account'
op|'='
number|'3'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'403'
op|')'
newline|'\n'
nl|'\n'
comment|'# Grant access to the third account'
nl|'\n'
DECL|function|post
name|'def'
name|'post'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'POST'"
op|','
string|"'%s/%s'"
op|'%'
op|'('
name|'parsed'
op|'.'
name|'path'
op|','
name|'self'
op|'.'
name|'container'
op|')'
op|','
nl|'\n'
string|"''"
op|','
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|','
nl|'\n'
string|"'X-Container-Read'"
op|':'
name|'tf'
op|'.'
name|'swift_test_perm'
op|'['
number|'2'
op|']'
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
dedent|''
name|'resp'
op|'='
name|'retry'
op|'('
name|'post'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'204'
op|')'
newline|'\n'
nl|'\n'
comment|'# The third account should be able to get the manifest now'
nl|'\n'
DECL|function|get
name|'def'
name|'get'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'GET'"
op|','
string|"'%s/%s/manifest'"
op|'%'
op|'('
nl|'\n'
name|'parsed'
op|'.'
name|'path'
op|','
name|'self'
op|'.'
name|'container'
op|')'
op|','
string|"''"
op|','
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
dedent|''
name|'resp'
op|'='
name|'retry'
op|'('
name|'get'
op|','
name|'use_account'
op|'='
number|'3'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
op|','
string|"''"
op|'.'
name|'join'
op|'('
name|'segments2'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'200'
op|')'
newline|'\n'
nl|'\n'
comment|'# Create another container for the third set of segments'
nl|'\n'
dedent|''
name|'acontainer'
op|'='
name|'uuid4'
op|'('
op|')'
op|'.'
name|'hex'
newline|'\n'
nl|'\n'
DECL|function|put
name|'def'
name|'put'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'PUT'"
op|','
name|'parsed'
op|'.'
name|'path'
op|'+'
string|"'/'"
op|'+'
name|'acontainer'
op|','
string|"''"
op|','
nl|'\n'
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
dedent|''
name|'resp'
op|'='
name|'retry'
op|'('
name|'put'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'201'
op|')'
newline|'\n'
nl|'\n'
comment|'# Upload the third set of segments in the other container'
nl|'\n'
DECL|function|put
name|'def'
name|'put'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|','
name|'objnum'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'PUT'"
op|','
string|"'%s/%s/segments3/%s'"
op|'%'
op|'('
nl|'\n'
name|'parsed'
op|'.'
name|'path'
op|','
name|'acontainer'
op|','
name|'str'
op|'('
name|'objnum'
op|')'
op|')'
op|','
name|'segments3'
op|'['
name|'objnum'
op|']'
op|','
nl|'\n'
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
dedent|''
name|'for'
name|'objnum'
name|'in'
name|'range'
op|'('
name|'len'
op|'('
name|'segments3'
op|')'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'resp'
op|'='
name|'retry'
op|'('
name|'put'
op|','
name|'objnum'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'201'
op|')'
newline|'\n'
nl|'\n'
comment|'# Update the manifest'
nl|'\n'
DECL|function|put
dedent|''
name|'def'
name|'put'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'PUT'"
op|','
string|"'%s/%s/manifest'"
op|'%'
op|'('
nl|'\n'
name|'parsed'
op|'.'
name|'path'
op|','
name|'self'
op|'.'
name|'container'
op|')'
op|','
string|"''"
op|','
nl|'\n'
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|','
nl|'\n'
string|"'X-Object-Manifest'"
op|':'
string|"'%s/segments3/'"
op|'%'
name|'acontainer'
op|','
nl|'\n'
string|"'Content-Length'"
op|':'
string|"'0'"
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
dedent|''
name|'resp'
op|'='
name|'retry'
op|'('
name|'put'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'201'
op|')'
newline|'\n'
nl|'\n'
comment|"# Get the manifest to ensure it's the third set of segments"
nl|'\n'
DECL|function|get
name|'def'
name|'get'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'GET'"
op|','
string|"'%s/%s/manifest'"
op|'%'
op|'('
nl|'\n'
name|'parsed'
op|'.'
name|'path'
op|','
name|'self'
op|'.'
name|'container'
op|')'
op|','
string|"''"
op|','
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
dedent|''
name|'resp'
op|'='
name|'retry'
op|'('
name|'get'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
op|','
string|"''"
op|'.'
name|'join'
op|'('
name|'segments3'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'200'
op|')'
newline|'\n'
nl|'\n'
name|'if'
name|'not'
name|'tf'
op|'.'
name|'skip3'
op|':'
newline|'\n'
nl|'\n'
comment|"# Ensure we can't access the manifest with the third account"
nl|'\n'
comment|'# (because the segments are in a protected container even if the'
nl|'\n'
comment|'# manifest itself is not).'
nl|'\n'
nl|'\n'
DECL|function|get
indent|'            '
name|'def'
name|'get'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'GET'"
op|','
string|"'%s/%s/manifest'"
op|'%'
op|'('
nl|'\n'
name|'parsed'
op|'.'
name|'path'
op|','
name|'self'
op|'.'
name|'container'
op|')'
op|','
string|"''"
op|','
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
dedent|''
name|'resp'
op|'='
name|'retry'
op|'('
name|'get'
op|','
name|'use_account'
op|'='
number|'3'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'403'
op|')'
newline|'\n'
nl|'\n'
comment|'# Grant access to the third account'
nl|'\n'
DECL|function|post
name|'def'
name|'post'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'POST'"
op|','
string|"'%s/%s'"
op|'%'
op|'('
name|'parsed'
op|'.'
name|'path'
op|','
name|'acontainer'
op|')'
op|','
nl|'\n'
string|"''"
op|','
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|','
nl|'\n'
string|"'X-Container-Read'"
op|':'
name|'tf'
op|'.'
name|'swift_test_perm'
op|'['
number|'2'
op|']'
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
dedent|''
name|'resp'
op|'='
name|'retry'
op|'('
name|'post'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'204'
op|')'
newline|'\n'
nl|'\n'
comment|'# The third account should be able to get the manifest now'
nl|'\n'
DECL|function|get
name|'def'
name|'get'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'GET'"
op|','
string|"'%s/%s/manifest'"
op|'%'
op|'('
nl|'\n'
name|'parsed'
op|'.'
name|'path'
op|','
name|'self'
op|'.'
name|'container'
op|')'
op|','
string|"''"
op|','
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
dedent|''
name|'resp'
op|'='
name|'retry'
op|'('
name|'get'
op|','
name|'use_account'
op|'='
number|'3'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
op|','
string|"''"
op|'.'
name|'join'
op|'('
name|'segments3'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'200'
op|')'
newline|'\n'
nl|'\n'
comment|'# Delete the manifest'
nl|'\n'
DECL|function|delete
dedent|''
name|'def'
name|'delete'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|','
name|'objnum'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'DELETE'"
op|','
string|"'%s/%s/manifest'"
op|'%'
op|'('
nl|'\n'
name|'parsed'
op|'.'
name|'path'
op|','
nl|'\n'
name|'self'
op|'.'
name|'container'
op|')'
op|','
string|"''"
op|','
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
dedent|''
name|'resp'
op|'='
name|'retry'
op|'('
name|'delete'
op|','
name|'objnum'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'204'
op|')'
newline|'\n'
nl|'\n'
comment|'# Delete the third set of segments'
nl|'\n'
DECL|function|delete
name|'def'
name|'delete'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|','
name|'objnum'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'DELETE'"
op|','
string|"'%s/%s/segments3/%s'"
op|'%'
op|'('
nl|'\n'
name|'parsed'
op|'.'
name|'path'
op|','
name|'acontainer'
op|','
name|'str'
op|'('
name|'objnum'
op|')'
op|')'
op|','
string|"''"
op|','
nl|'\n'
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
dedent|''
name|'for'
name|'objnum'
name|'in'
name|'range'
op|'('
name|'len'
op|'('
name|'segments3'
op|')'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'resp'
op|'='
name|'retry'
op|'('
name|'delete'
op|','
name|'objnum'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'204'
op|')'
newline|'\n'
nl|'\n'
comment|'# Delete the second set of segments'
nl|'\n'
DECL|function|delete
dedent|''
name|'def'
name|'delete'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|','
name|'objnum'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'DELETE'"
op|','
string|"'%s/%s/segments2/%s'"
op|'%'
op|'('
nl|'\n'
name|'parsed'
op|'.'
name|'path'
op|','
name|'self'
op|'.'
name|'container'
op|','
name|'str'
op|'('
name|'objnum'
op|')'
op|')'
op|','
string|"''"
op|','
nl|'\n'
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
dedent|''
name|'for'
name|'objnum'
name|'in'
name|'range'
op|'('
name|'len'
op|'('
name|'segments2'
op|')'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'resp'
op|'='
name|'retry'
op|'('
name|'delete'
op|','
name|'objnum'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'204'
op|')'
newline|'\n'
nl|'\n'
comment|'# Delete the first set of segments'
nl|'\n'
DECL|function|delete
dedent|''
name|'def'
name|'delete'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|','
name|'objnum'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'DELETE'"
op|','
string|"'%s/%s/segments1/%s'"
op|'%'
op|'('
nl|'\n'
name|'parsed'
op|'.'
name|'path'
op|','
name|'self'
op|'.'
name|'container'
op|','
name|'str'
op|'('
name|'objnum'
op|')'
op|')'
op|','
string|"''"
op|','
nl|'\n'
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
dedent|''
name|'for'
name|'objnum'
name|'in'
name|'range'
op|'('
name|'len'
op|'('
name|'segments1'
op|')'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'resp'
op|'='
name|'retry'
op|'('
name|'delete'
op|','
name|'objnum'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'204'
op|')'
newline|'\n'
nl|'\n'
comment|'# Delete the extra container'
nl|'\n'
DECL|function|delete
dedent|''
name|'def'
name|'delete'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'DELETE'"
op|','
string|"'%s/%s'"
op|'%'
op|'('
name|'parsed'
op|'.'
name|'path'
op|','
name|'acontainer'
op|')'
op|','
string|"''"
op|','
nl|'\n'
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
dedent|''
name|'resp'
op|'='
name|'retry'
op|'('
name|'delete'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'204'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_delete_content_type
dedent|''
name|'def'
name|'test_delete_content_type'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'tf'
op|'.'
name|'skip'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'SkipTest'
newline|'\n'
nl|'\n'
DECL|function|put
dedent|''
name|'def'
name|'put'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'PUT'"
op|','
string|"'%s/%s/hi'"
op|'%'
op|'('
name|'parsed'
op|'.'
name|'path'
op|','
name|'self'
op|'.'
name|'container'
op|')'
op|','
nl|'\n'
string|"'there'"
op|','
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
dedent|''
name|'resp'
op|'='
name|'retry'
op|'('
name|'put'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'201'
op|')'
newline|'\n'
nl|'\n'
DECL|function|delete
name|'def'
name|'delete'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'DELETE'"
op|','
string|"'%s/%s/hi'"
op|'%'
op|'('
name|'parsed'
op|'.'
name|'path'
op|','
name|'self'
op|'.'
name|'container'
op|')'
op|','
nl|'\n'
string|"''"
op|','
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
dedent|''
name|'resp'
op|'='
name|'retry'
op|'('
name|'delete'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'204'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'getheader'
op|'('
string|"'Content-Type'"
op|')'
op|','
nl|'\n'
string|"'text/html; charset=UTF-8'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_delete_if_delete_at_bad
dedent|''
name|'def'
name|'test_delete_if_delete_at_bad'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'tf'
op|'.'
name|'skip'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'SkipTest'
newline|'\n'
nl|'\n'
DECL|function|put
dedent|''
name|'def'
name|'put'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'PUT'"
op|','
nl|'\n'
string|"'%s/%s/hi-delete-bad'"
op|'%'
op|'('
name|'parsed'
op|'.'
name|'path'
op|','
name|'self'
op|'.'
name|'container'
op|')'
op|','
nl|'\n'
string|"'there'"
op|','
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
dedent|''
name|'resp'
op|'='
name|'retry'
op|'('
name|'put'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'201'
op|')'
newline|'\n'
nl|'\n'
DECL|function|delete
name|'def'
name|'delete'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'DELETE'"
op|','
string|"'%s/%s/hi'"
op|'%'
op|'('
name|'parsed'
op|'.'
name|'path'
op|','
name|'self'
op|'.'
name|'container'
op|')'
op|','
nl|'\n'
string|"''"
op|','
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|','
nl|'\n'
string|"'X-If-Delete-At'"
op|':'
string|"'bad'"
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
dedent|''
name|'resp'
op|'='
name|'retry'
op|'('
name|'delete'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'400'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_null_name
dedent|''
name|'def'
name|'test_null_name'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'tf'
op|'.'
name|'skip'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'SkipTest'
newline|'\n'
nl|'\n'
DECL|function|put
dedent|''
name|'def'
name|'put'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
string|"'PUT'"
op|','
string|"'%s/%s/abc%%00def'"
op|'%'
op|'('
nl|'\n'
name|'parsed'
op|'.'
name|'path'
op|','
nl|'\n'
name|'self'
op|'.'
name|'container'
op|')'
op|','
string|"'test'"
op|','
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
dedent|''
name|'resp'
op|'='
name|'retry'
op|'('
name|'put'
op|')'
newline|'\n'
name|'if'
op|'('
name|'tf'
op|'.'
name|'web_front_end'
op|'=='
string|"'apache2'"
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'404'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
op|','
string|"'Invalid UTF8 or contains NULL'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'412'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_cors
dedent|''
dedent|''
name|'def'
name|'test_cors'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'tf'
op|'.'
name|'skip'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'SkipTest'
newline|'\n'
nl|'\n'
dedent|''
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'strict_cors'
op|'='
name|'tf'
op|'.'
name|'cluster_info'
op|'['
string|"'swift'"
op|']'
op|'['
string|"'strict_cors_mode'"
op|']'
newline|'\n'
dedent|''
name|'except'
name|'KeyError'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'SkipTest'
op|'('
string|'"cors mode is unknown"'
op|')'
newline|'\n'
nl|'\n'
DECL|function|put_cors_cont
dedent|''
name|'def'
name|'put_cors_cont'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|','
name|'orig'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
nl|'\n'
string|"'PUT'"
op|','
string|"'%s/%s'"
op|'%'
op|'('
name|'parsed'
op|'.'
name|'path'
op|','
name|'self'
op|'.'
name|'container'
op|')'
op|','
nl|'\n'
string|"''"
op|','
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|','
nl|'\n'
string|"'X-Container-Meta-Access-Control-Allow-Origin'"
op|':'
name|'orig'
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
nl|'\n'
DECL|function|put_obj
dedent|''
name|'def'
name|'put_obj'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|','
name|'obj'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'request'
op|'('
nl|'\n'
string|"'PUT'"
op|','
string|"'%s/%s/%s'"
op|'%'
op|'('
name|'parsed'
op|'.'
name|'path'
op|','
name|'self'
op|'.'
name|'container'
op|','
name|'obj'
op|')'
op|','
nl|'\n'
string|"'test'"
op|','
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
nl|'\n'
DECL|function|check_cors
dedent|''
name|'def'
name|'check_cors'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|','
nl|'\n'
name|'method'
op|','
name|'obj'
op|','
name|'headers'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'method'
op|'!='
string|"'OPTIONS'"
op|':'
newline|'\n'
indent|'                '
name|'headers'
op|'['
string|"'X-Auth-Token'"
op|']'
op|'='
name|'token'
newline|'\n'
dedent|''
name|'conn'
op|'.'
name|'request'
op|'('
nl|'\n'
name|'method'
op|','
string|"'%s/%s/%s'"
op|'%'
op|'('
name|'parsed'
op|'.'
name|'path'
op|','
name|'self'
op|'.'
name|'container'
op|','
name|'obj'
op|')'
op|','
nl|'\n'
string|"''"
op|','
name|'headers'
op|')'
newline|'\n'
name|'return'
name|'conn'
op|'.'
name|'getresponse'
op|'('
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'resp'
op|'='
name|'retry'
op|'('
name|'put_cors_cont'
op|','
string|"'*'"
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|'//'
number|'100'
op|','
number|'2'
op|')'
newline|'\n'
nl|'\n'
name|'resp'
op|'='
name|'retry'
op|'('
name|'put_obj'
op|','
string|"'cat'"
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|'//'
number|'100'
op|','
number|'2'
op|')'
newline|'\n'
nl|'\n'
name|'resp'
op|'='
name|'retry'
op|'('
name|'check_cors'
op|','
nl|'\n'
string|"'OPTIONS'"
op|','
string|"'cat'"
op|','
op|'{'
string|"'Origin'"
op|':'
string|"'http://m.com'"
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'401'
op|')'
newline|'\n'
nl|'\n'
name|'resp'
op|'='
name|'retry'
op|'('
name|'check_cors'
op|','
nl|'\n'
string|"'OPTIONS'"
op|','
string|"'cat'"
op|','
nl|'\n'
op|'{'
string|"'Origin'"
op|':'
string|"'http://m.com'"
op|','
nl|'\n'
string|"'Access-Control-Request-Method'"
op|':'
string|"'GET'"
op|'}'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'200'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'headers'
op|'='
name|'dict'
op|'('
op|'('
name|'k'
op|'.'
name|'lower'
op|'('
op|')'
op|','
name|'v'
op|')'
name|'for'
name|'k'
op|','
name|'v'
name|'in'
name|'resp'
op|'.'
name|'getheaders'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'headers'
op|'.'
name|'get'
op|'('
string|"'access-control-allow-origin'"
op|')'
op|','
nl|'\n'
string|"'*'"
op|')'
newline|'\n'
nl|'\n'
name|'resp'
op|'='
name|'retry'
op|'('
name|'check_cors'
op|','
nl|'\n'
string|"'GET'"
op|','
string|"'cat'"
op|','
op|'{'
string|"'Origin'"
op|':'
string|"'http://m.com'"
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'200'
op|')'
newline|'\n'
name|'headers'
op|'='
name|'dict'
op|'('
op|'('
name|'k'
op|'.'
name|'lower'
op|'('
op|')'
op|','
name|'v'
op|')'
name|'for'
name|'k'
op|','
name|'v'
name|'in'
name|'resp'
op|'.'
name|'getheaders'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'headers'
op|'.'
name|'get'
op|'('
string|"'access-control-allow-origin'"
op|')'
op|','
nl|'\n'
string|"'*'"
op|')'
newline|'\n'
nl|'\n'
name|'resp'
op|'='
name|'retry'
op|'('
name|'check_cors'
op|','
nl|'\n'
string|"'GET'"
op|','
string|"'cat'"
op|','
op|'{'
string|"'Origin'"
op|':'
string|"'http://m.com'"
op|','
nl|'\n'
string|"'X-Web-Mode'"
op|':'
string|"'True'"
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'200'
op|')'
newline|'\n'
name|'headers'
op|'='
name|'dict'
op|'('
op|'('
name|'k'
op|'.'
name|'lower'
op|'('
op|')'
op|','
name|'v'
op|')'
name|'for'
name|'k'
op|','
name|'v'
name|'in'
name|'resp'
op|'.'
name|'getheaders'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'headers'
op|'.'
name|'get'
op|'('
string|"'access-control-allow-origin'"
op|')'
op|','
nl|'\n'
string|"'*'"
op|')'
newline|'\n'
nl|'\n'
comment|'####################'
nl|'\n'
nl|'\n'
name|'resp'
op|'='
name|'retry'
op|'('
name|'put_cors_cont'
op|','
string|"'http://secret.com'"
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|'//'
number|'100'
op|','
number|'2'
op|')'
newline|'\n'
nl|'\n'
name|'resp'
op|'='
name|'retry'
op|'('
name|'check_cors'
op|','
nl|'\n'
string|"'OPTIONS'"
op|','
string|"'cat'"
op|','
nl|'\n'
op|'{'
string|"'Origin'"
op|':'
string|"'http://m.com'"
op|','
nl|'\n'
string|"'Access-Control-Request-Method'"
op|':'
string|"'GET'"
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'401'
op|')'
newline|'\n'
nl|'\n'
name|'if'
name|'strict_cors'
op|':'
newline|'\n'
indent|'            '
name|'resp'
op|'='
name|'retry'
op|'('
name|'check_cors'
op|','
nl|'\n'
string|"'GET'"
op|','
string|"'cat'"
op|','
op|'{'
string|"'Origin'"
op|':'
string|"'http://m.com'"
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'200'
op|')'
newline|'\n'
name|'headers'
op|'='
name|'dict'
op|'('
op|'('
name|'k'
op|'.'
name|'lower'
op|'('
op|')'
op|','
name|'v'
op|')'
name|'for'
name|'k'
op|','
name|'v'
name|'in'
name|'resp'
op|'.'
name|'getheaders'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertNotIn'
op|'('
string|"'access-control-allow-origin'"
op|','
name|'headers'
op|')'
newline|'\n'
nl|'\n'
name|'resp'
op|'='
name|'retry'
op|'('
name|'check_cors'
op|','
nl|'\n'
string|"'GET'"
op|','
string|"'cat'"
op|','
op|'{'
string|"'Origin'"
op|':'
string|"'http://secret.com'"
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'200'
op|')'
newline|'\n'
name|'headers'
op|'='
name|'dict'
op|'('
op|'('
name|'k'
op|'.'
name|'lower'
op|'('
op|')'
op|','
name|'v'
op|')'
name|'for'
name|'k'
op|','
name|'v'
name|'in'
name|'resp'
op|'.'
name|'getheaders'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'headers'
op|'.'
name|'get'
op|'('
string|"'access-control-allow-origin'"
op|')'
op|','
nl|'\n'
string|"'http://secret.com'"
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'resp'
op|'='
name|'retry'
op|'('
name|'check_cors'
op|','
nl|'\n'
string|"'GET'"
op|','
string|"'cat'"
op|','
op|'{'
string|"'Origin'"
op|':'
string|"'http://m.com'"
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'200'
op|')'
newline|'\n'
name|'headers'
op|'='
name|'dict'
op|'('
op|'('
name|'k'
op|'.'
name|'lower'
op|'('
op|')'
op|','
name|'v'
op|')'
name|'for'
name|'k'
op|','
name|'v'
name|'in'
name|'resp'
op|'.'
name|'getheaders'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'headers'
op|'.'
name|'get'
op|'('
string|"'access-control-allow-origin'"
op|')'
op|','
nl|'\n'
string|"'http://m.com'"
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
op|'@'
name|'requires_policies'
newline|'\n'
DECL|member|test_cross_policy_copy
name|'def'
name|'test_cross_policy_copy'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# create container in first policy'
nl|'\n'
indent|'        '
name|'policy'
op|'='
name|'self'
op|'.'
name|'policies'
op|'.'
name|'select'
op|'('
op|')'
newline|'\n'
name|'container'
op|'='
name|'self'
op|'.'
name|'_create_container'
op|'('
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Storage-Policy'"
op|':'
name|'policy'
op|'['
string|"'name'"
op|']'
op|'}'
op|')'
newline|'\n'
name|'obj'
op|'='
name|'uuid4'
op|'('
op|')'
op|'.'
name|'hex'
newline|'\n'
nl|'\n'
comment|'# create a container in second policy'
nl|'\n'
name|'other_policy'
op|'='
name|'self'
op|'.'
name|'policies'
op|'.'
name|'exclude'
op|'('
name|'name'
op|'='
name|'policy'
op|'['
string|"'name'"
op|']'
op|')'
op|'.'
name|'select'
op|'('
op|')'
newline|'\n'
name|'other_container'
op|'='
name|'self'
op|'.'
name|'_create_container'
op|'('
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Storage-Policy'"
op|':'
name|'other_policy'
op|'['
string|"'name'"
op|']'
op|'}'
op|')'
newline|'\n'
name|'other_obj'
op|'='
name|'uuid4'
op|'('
op|')'
op|'.'
name|'hex'
newline|'\n'
nl|'\n'
DECL|function|put_obj
name|'def'
name|'put_obj'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|','
name|'container'
op|','
name|'obj'
op|')'
op|':'
newline|'\n'
comment|'# to keep track of things, use the original path as the body'
nl|'\n'
indent|'            '
name|'content'
op|'='
string|"'%s/%s'"
op|'%'
op|'('
name|'container'
op|','
name|'obj'
op|')'
newline|'\n'
name|'path'
op|'='
string|"'%s/%s'"
op|'%'
op|'('
name|'parsed'
op|'.'
name|'path'
op|','
name|'content'
op|')'
newline|'\n'
name|'conn'
op|'.'
name|'request'
op|'('
string|"'PUT'"
op|','
name|'path'
op|','
name|'content'
op|','
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
nl|'\n'
comment|'# create objects'
nl|'\n'
dedent|''
name|'for'
name|'c'
op|','
name|'o'
name|'in'
name|'zip'
op|'('
op|'('
name|'container'
op|','
name|'other_container'
op|')'
op|','
op|'('
name|'obj'
op|','
name|'other_obj'
op|')'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'resp'
op|'='
name|'retry'
op|'('
name|'put_obj'
op|','
name|'c'
op|','
name|'o'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'201'
op|')'
newline|'\n'
nl|'\n'
DECL|function|put_copy_from
dedent|''
name|'def'
name|'put_copy_from'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|','
name|'container'
op|','
name|'obj'
op|','
name|'source'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'dest_path'
op|'='
string|"'%s/%s/%s'"
op|'%'
op|'('
name|'parsed'
op|'.'
name|'path'
op|','
name|'container'
op|','
name|'obj'
op|')'
newline|'\n'
name|'conn'
op|'.'
name|'request'
op|'('
string|"'PUT'"
op|','
name|'dest_path'
op|','
string|"''"
op|','
nl|'\n'
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|','
nl|'\n'
string|"'Content-Length'"
op|':'
string|"'0'"
op|','
nl|'\n'
string|"'X-Copy-From'"
op|':'
name|'source'
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'copy_requests'
op|'='
op|'('
nl|'\n'
op|'('
name|'container'
op|','
name|'other_obj'
op|','
string|"'%s/%s'"
op|'%'
op|'('
name|'other_container'
op|','
name|'other_obj'
op|')'
op|')'
op|','
nl|'\n'
op|'('
name|'other_container'
op|','
name|'obj'
op|','
string|"'%s/%s'"
op|'%'
op|'('
name|'container'
op|','
name|'obj'
op|')'
op|')'
op|','
nl|'\n'
op|')'
newline|'\n'
nl|'\n'
comment|'# copy objects'
nl|'\n'
name|'for'
name|'c'
op|','
name|'o'
op|','
name|'source'
name|'in'
name|'copy_requests'
op|':'
newline|'\n'
indent|'            '
name|'resp'
op|'='
name|'retry'
op|'('
name|'put_copy_from'
op|','
name|'c'
op|','
name|'o'
op|','
name|'source'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'201'
op|')'
newline|'\n'
nl|'\n'
DECL|function|get_obj
dedent|''
name|'def'
name|'get_obj'
op|'('
name|'url'
op|','
name|'token'
op|','
name|'parsed'
op|','
name|'conn'
op|','
name|'container'
op|','
name|'obj'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'path'
op|'='
string|"'%s/%s/%s'"
op|'%'
op|'('
name|'parsed'
op|'.'
name|'path'
op|','
name|'container'
op|','
name|'obj'
op|')'
newline|'\n'
name|'conn'
op|'.'
name|'request'
op|'('
string|"'GET'"
op|','
name|'path'
op|','
string|"''"
op|','
op|'{'
string|"'X-Auth-Token'"
op|':'
name|'token'
op|'}'
op|')'
newline|'\n'
name|'return'
name|'check_response'
op|'('
name|'conn'
op|')'
newline|'\n'
nl|'\n'
comment|'# validate contents, contents should be source'
nl|'\n'
dedent|''
name|'validate_requests'
op|'='
name|'copy_requests'
newline|'\n'
name|'for'
name|'c'
op|','
name|'o'
op|','
name|'body'
name|'in'
name|'validate_requests'
op|':'
newline|'\n'
indent|'            '
name|'resp'
op|'='
name|'retry'
op|'('
name|'get_obj'
op|','
name|'c'
op|','
name|'o'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'200'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'body'
op|','
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
dedent|''
dedent|''
dedent|''
name|'if'
name|'__name__'
op|'=='
string|"'__main__'"
op|':'
newline|'\n'
indent|'    '
name|'unittest2'
op|'.'
name|'main'
op|'('
op|')'
newline|'\n'
dedent|''
endmarker|''
end_unit
