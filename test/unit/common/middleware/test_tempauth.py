begin_unit
comment|'# -*- coding: utf-8 -*-'
nl|'\n'
comment|'# Copyright (c) 2011-2015 OpenStack Foundation'
nl|'\n'
comment|'#'
nl|'\n'
comment|'# Licensed under the Apache License, Version 2.0 (the "License");'
nl|'\n'
comment|'# you may not use this file except in compliance with the License.'
nl|'\n'
comment|'# You may obtain a copy of the License at'
nl|'\n'
comment|'#'
nl|'\n'
comment|'#    http://www.apache.org/licenses/LICENSE-2.0'
nl|'\n'
comment|'#'
nl|'\n'
comment|'# Unless required by applicable law or agreed to in writing, software'
nl|'\n'
comment|'# distributed under the License is distributed on an "AS IS" BASIS,'
nl|'\n'
comment|'# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or'
nl|'\n'
comment|'# implied.'
nl|'\n'
comment|'# See the License for the specific language governing permissions and'
nl|'\n'
comment|'# limitations under the License.'
nl|'\n'
nl|'\n'
name|'import'
name|'json'
newline|'\n'
name|'import'
name|'unittest'
newline|'\n'
name|'from'
name|'contextlib'
name|'import'
name|'contextmanager'
newline|'\n'
name|'from'
name|'base64'
name|'import'
name|'b64encode'
newline|'\n'
name|'from'
name|'time'
name|'import'
name|'time'
newline|'\n'
name|'import'
name|'mock'
newline|'\n'
nl|'\n'
name|'from'
name|'swift'
op|'.'
name|'common'
op|'.'
name|'middleware'
name|'import'
name|'tempauth'
name|'as'
name|'auth'
newline|'\n'
name|'from'
name|'swift'
op|'.'
name|'common'
op|'.'
name|'middleware'
op|'.'
name|'acl'
name|'import'
name|'format_acl'
newline|'\n'
name|'from'
name|'swift'
op|'.'
name|'common'
op|'.'
name|'swob'
name|'import'
name|'Request'
op|','
name|'Response'
newline|'\n'
name|'from'
name|'swift'
op|'.'
name|'common'
op|'.'
name|'utils'
name|'import'
name|'split_path'
newline|'\n'
nl|'\n'
DECL|variable|NO_CONTENT_RESP
name|'NO_CONTENT_RESP'
op|'='
op|'('
op|'('
string|"'204 No Content'"
op|','
op|'{'
op|'}'
op|','
string|"''"
op|')'
op|','
op|')'
comment|'# mock server response'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|FakeMemcache
name|'class'
name|'FakeMemcache'
op|'('
name|'object'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|member|__init__
indent|'    '
name|'def'
name|'__init__'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'store'
op|'='
op|'{'
op|'}'
newline|'\n'
nl|'\n'
DECL|member|get
dedent|''
name|'def'
name|'get'
op|'('
name|'self'
op|','
name|'key'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'self'
op|'.'
name|'store'
op|'.'
name|'get'
op|'('
name|'key'
op|')'
newline|'\n'
nl|'\n'
DECL|member|set
dedent|''
name|'def'
name|'set'
op|'('
name|'self'
op|','
name|'key'
op|','
name|'value'
op|','
name|'time'
op|'='
number|'0'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'store'
op|'['
name|'key'
op|']'
op|'='
name|'value'
newline|'\n'
name|'return'
name|'True'
newline|'\n'
nl|'\n'
DECL|member|incr
dedent|''
name|'def'
name|'incr'
op|'('
name|'self'
op|','
name|'key'
op|','
name|'time'
op|'='
number|'0'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'store'
op|'['
name|'key'
op|']'
op|'='
name|'self'
op|'.'
name|'store'
op|'.'
name|'setdefault'
op|'('
name|'key'
op|','
number|'0'
op|')'
op|'+'
number|'1'
newline|'\n'
name|'return'
name|'self'
op|'.'
name|'store'
op|'['
name|'key'
op|']'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'contextmanager'
newline|'\n'
DECL|member|soft_lock
name|'def'
name|'soft_lock'
op|'('
name|'self'
op|','
name|'key'
op|','
name|'timeout'
op|'='
number|'0'
op|','
name|'retries'
op|'='
number|'5'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'yield'
name|'True'
newline|'\n'
nl|'\n'
DECL|member|delete
dedent|''
name|'def'
name|'delete'
op|'('
name|'self'
op|','
name|'key'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'del'
name|'self'
op|'.'
name|'store'
op|'['
name|'key'
op|']'
newline|'\n'
dedent|''
name|'except'
name|'Exception'
op|':'
newline|'\n'
indent|'            '
name|'pass'
newline|'\n'
dedent|''
name|'return'
name|'True'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|FakeApp
dedent|''
dedent|''
name|'class'
name|'FakeApp'
op|'('
name|'object'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|member|__init__
indent|'    '
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'status_headers_body_iter'
op|'='
name|'None'
op|','
name|'acl'
op|'='
name|'None'
op|','
name|'sync_key'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'calls'
op|'='
number|'0'
newline|'\n'
name|'self'
op|'.'
name|'status_headers_body_iter'
op|'='
name|'status_headers_body_iter'
newline|'\n'
name|'if'
name|'not'
name|'self'
op|'.'
name|'status_headers_body_iter'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'status_headers_body_iter'
op|'='
name|'iter'
op|'('
op|'['
op|'('
string|"'404 Not Found'"
op|','
op|'{'
op|'}'
op|','
string|"''"
op|')'
op|']'
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'acl'
op|'='
name|'acl'
newline|'\n'
name|'self'
op|'.'
name|'sync_key'
op|'='
name|'sync_key'
newline|'\n'
nl|'\n'
DECL|member|__call__
dedent|''
name|'def'
name|'__call__'
op|'('
name|'self'
op|','
name|'env'
op|','
name|'start_response'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'calls'
op|'+='
number|'1'
newline|'\n'
name|'self'
op|'.'
name|'request'
op|'='
name|'Request'
op|'('
name|'env'
op|')'
newline|'\n'
name|'if'
name|'self'
op|'.'
name|'acl'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'request'
op|'.'
name|'acl'
op|'='
name|'self'
op|'.'
name|'acl'
newline|'\n'
dedent|''
name|'if'
name|'self'
op|'.'
name|'sync_key'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'request'
op|'.'
name|'environ'
op|'['
string|"'swift_sync_key'"
op|']'
op|'='
name|'self'
op|'.'
name|'sync_key'
newline|'\n'
dedent|''
name|'if'
string|"'swift.authorize'"
name|'in'
name|'env'
op|':'
newline|'\n'
indent|'            '
name|'resp'
op|'='
name|'env'
op|'['
string|"'swift.authorize'"
op|']'
op|'('
name|'self'
op|'.'
name|'request'
op|')'
newline|'\n'
name|'if'
name|'resp'
op|':'
newline|'\n'
indent|'                '
name|'return'
name|'resp'
op|'('
name|'env'
op|','
name|'start_response'
op|')'
newline|'\n'
dedent|''
dedent|''
name|'status'
op|','
name|'headers'
op|','
name|'body'
op|'='
name|'next'
op|'('
name|'self'
op|'.'
name|'status_headers_body_iter'
op|')'
newline|'\n'
name|'return'
name|'Response'
op|'('
name|'status'
op|'='
name|'status'
op|','
name|'headers'
op|'='
name|'headers'
op|','
nl|'\n'
name|'body'
op|'='
name|'body'
op|')'
op|'('
name|'env'
op|','
name|'start_response'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|FakeConn
dedent|''
dedent|''
name|'class'
name|'FakeConn'
op|'('
name|'object'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|member|__init__
indent|'    '
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'status_headers_body_iter'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'calls'
op|'='
number|'0'
newline|'\n'
name|'self'
op|'.'
name|'status_headers_body_iter'
op|'='
name|'status_headers_body_iter'
newline|'\n'
name|'if'
name|'not'
name|'self'
op|'.'
name|'status_headers_body_iter'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'status_headers_body_iter'
op|'='
name|'iter'
op|'('
op|'['
op|'('
string|"'404 Not Found'"
op|','
op|'{'
op|'}'
op|','
string|"''"
op|')'
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|request
dedent|''
dedent|''
name|'def'
name|'request'
op|'('
name|'self'
op|','
name|'method'
op|','
name|'path'
op|','
name|'headers'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'calls'
op|'+='
number|'1'
newline|'\n'
name|'self'
op|'.'
name|'request_path'
op|'='
name|'path'
newline|'\n'
name|'self'
op|'.'
name|'status'
op|','
name|'self'
op|'.'
name|'headers'
op|','
name|'self'
op|'.'
name|'body'
op|'='
name|'next'
op|'('
name|'self'
op|'.'
name|'status_headers_body_iter'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'status'
op|','
name|'self'
op|'.'
name|'reason'
op|'='
name|'self'
op|'.'
name|'status'
op|'.'
name|'split'
op|'('
string|"' '"
op|','
number|'1'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'status'
op|'='
name|'int'
op|'('
name|'self'
op|'.'
name|'status'
op|')'
newline|'\n'
nl|'\n'
DECL|member|getresponse
dedent|''
name|'def'
name|'getresponse'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'self'
newline|'\n'
nl|'\n'
DECL|member|read
dedent|''
name|'def'
name|'read'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'body'
op|'='
name|'self'
op|'.'
name|'body'
newline|'\n'
name|'self'
op|'.'
name|'body'
op|'='
string|"''"
newline|'\n'
name|'return'
name|'body'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|TestAuth
dedent|''
dedent|''
name|'class'
name|'TestAuth'
op|'('
name|'unittest'
op|'.'
name|'TestCase'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|member|setUp
indent|'    '
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'test_auth'
op|'='
name|'auth'
op|'.'
name|'filter_factory'
op|'('
op|'{'
op|'}'
op|')'
op|'('
name|'FakeApp'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_make_request
dedent|''
name|'def'
name|'_make_request'
op|'('
name|'self'
op|','
name|'path'
op|','
op|'**'
name|'kwargs'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
name|'path'
op|','
op|'**'
name|'kwargs'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'environ'
op|'['
string|"'swift.cache'"
op|']'
op|'='
name|'FakeMemcache'
op|'('
op|')'
newline|'\n'
name|'return'
name|'req'
newline|'\n'
nl|'\n'
DECL|member|test_reseller_prefix_init
dedent|''
name|'def'
name|'test_reseller_prefix_init'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'app'
op|'='
name|'FakeApp'
op|'('
op|')'
newline|'\n'
name|'ath'
op|'='
name|'auth'
op|'.'
name|'filter_factory'
op|'('
op|'{'
op|'}'
op|')'
op|'('
name|'app'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'ath'
op|'.'
name|'reseller_prefix'
op|','
string|"'AUTH_'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'ath'
op|'.'
name|'reseller_prefixes'
op|','
op|'['
string|"'AUTH_'"
op|']'
op|')'
newline|'\n'
name|'ath'
op|'='
name|'auth'
op|'.'
name|'filter_factory'
op|'('
op|'{'
string|"'reseller_prefix'"
op|':'
string|"'TEST'"
op|'}'
op|')'
op|'('
name|'app'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'ath'
op|'.'
name|'reseller_prefix'
op|','
string|"'TEST_'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'ath'
op|'.'
name|'reseller_prefixes'
op|','
op|'['
string|"'TEST_'"
op|']'
op|')'
newline|'\n'
name|'ath'
op|'='
name|'auth'
op|'.'
name|'filter_factory'
op|'('
op|'{'
string|"'reseller_prefix'"
op|':'
string|"'TEST_'"
op|'}'
op|')'
op|'('
name|'app'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'ath'
op|'.'
name|'reseller_prefix'
op|','
string|"'TEST_'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'ath'
op|'.'
name|'reseller_prefixes'
op|','
op|'['
string|"'TEST_'"
op|']'
op|')'
newline|'\n'
name|'ath'
op|'='
name|'auth'
op|'.'
name|'filter_factory'
op|'('
op|'{'
string|"'reseller_prefix'"
op|':'
string|"''"
op|'}'
op|')'
op|'('
name|'app'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'ath'
op|'.'
name|'reseller_prefix'
op|','
string|"''"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'ath'
op|'.'
name|'reseller_prefixes'
op|','
op|'['
string|"''"
op|']'
op|')'
newline|'\n'
name|'ath'
op|'='
name|'auth'
op|'.'
name|'filter_factory'
op|'('
op|'{'
string|"'reseller_prefix'"
op|':'
string|"'    '"
op|'}'
op|')'
op|'('
name|'app'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'ath'
op|'.'
name|'reseller_prefix'
op|','
string|"''"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'ath'
op|'.'
name|'reseller_prefixes'
op|','
op|'['
string|"''"
op|']'
op|')'
newline|'\n'
name|'ath'
op|'='
name|'auth'
op|'.'
name|'filter_factory'
op|'('
op|'{'
string|"'reseller_prefix'"
op|':'
string|"'  '"
string|"'  '"
op|'}'
op|')'
op|'('
name|'app'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'ath'
op|'.'
name|'reseller_prefix'
op|','
string|"''"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'ath'
op|'.'
name|'reseller_prefixes'
op|','
op|'['
string|"''"
op|']'
op|')'
newline|'\n'
name|'ath'
op|'='
name|'auth'
op|'.'
name|'filter_factory'
op|'('
op|'{'
string|"'reseller_prefix'"
op|':'
string|'" \'\', TEST"'
op|'}'
op|')'
op|'('
name|'app'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'ath'
op|'.'
name|'reseller_prefix'
op|','
string|"''"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
string|"''"
name|'in'
name|'ath'
op|'.'
name|'reseller_prefixes'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
string|"'TEST_'"
name|'in'
name|'ath'
op|'.'
name|'reseller_prefixes'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_auth_prefix_init
dedent|''
name|'def'
name|'test_auth_prefix_init'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'app'
op|'='
name|'FakeApp'
op|'('
op|')'
newline|'\n'
name|'ath'
op|'='
name|'auth'
op|'.'
name|'filter_factory'
op|'('
op|'{'
op|'}'
op|')'
op|'('
name|'app'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'ath'
op|'.'
name|'auth_prefix'
op|','
string|"'/auth/'"
op|')'
newline|'\n'
name|'ath'
op|'='
name|'auth'
op|'.'
name|'filter_factory'
op|'('
op|'{'
string|"'auth_prefix'"
op|':'
string|"''"
op|'}'
op|')'
op|'('
name|'app'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'ath'
op|'.'
name|'auth_prefix'
op|','
string|"'/auth/'"
op|')'
newline|'\n'
name|'ath'
op|'='
name|'auth'
op|'.'
name|'filter_factory'
op|'('
op|'{'
string|"'auth_prefix'"
op|':'
string|"'/'"
op|'}'
op|')'
op|'('
name|'app'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'ath'
op|'.'
name|'auth_prefix'
op|','
string|"'/auth/'"
op|')'
newline|'\n'
name|'ath'
op|'='
name|'auth'
op|'.'
name|'filter_factory'
op|'('
op|'{'
string|"'auth_prefix'"
op|':'
string|"'/test/'"
op|'}'
op|')'
op|'('
name|'app'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'ath'
op|'.'
name|'auth_prefix'
op|','
string|"'/test/'"
op|')'
newline|'\n'
name|'ath'
op|'='
name|'auth'
op|'.'
name|'filter_factory'
op|'('
op|'{'
string|"'auth_prefix'"
op|':'
string|"'/test'"
op|'}'
op|')'
op|'('
name|'app'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'ath'
op|'.'
name|'auth_prefix'
op|','
string|"'/test/'"
op|')'
newline|'\n'
name|'ath'
op|'='
name|'auth'
op|'.'
name|'filter_factory'
op|'('
op|'{'
string|"'auth_prefix'"
op|':'
string|"'test/'"
op|'}'
op|')'
op|'('
name|'app'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'ath'
op|'.'
name|'auth_prefix'
op|','
string|"'/test/'"
op|')'
newline|'\n'
name|'ath'
op|'='
name|'auth'
op|'.'
name|'filter_factory'
op|'('
op|'{'
string|"'auth_prefix'"
op|':'
string|"'test'"
op|'}'
op|')'
op|'('
name|'app'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'ath'
op|'.'
name|'auth_prefix'
op|','
string|"'/test/'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_top_level_deny
dedent|''
name|'def'
name|'test_top_level_deny'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/'"
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'401'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'req'
op|'.'
name|'environ'
op|'['
string|"'swift.authorize'"
op|']'
op|','
nl|'\n'
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'denied_response'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'.'
name|'get'
op|'('
string|"'Www-Authenticate'"
op|')'
op|','
nl|'\n'
string|'\'Swift realm="unknown"\''
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_anon
dedent|''
name|'def'
name|'test_anon'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/v1/AUTH_account'"
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'401'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'req'
op|'.'
name|'environ'
op|'['
string|"'swift.authorize'"
op|']'
op|','
nl|'\n'
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'authorize'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'.'
name|'get'
op|'('
string|"'Www-Authenticate'"
op|')'
op|','
nl|'\n'
string|'\'Swift realm="AUTH_account"\''
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_anon_badpath
dedent|''
name|'def'
name|'test_anon_badpath'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/v1'"
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'401'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'.'
name|'get'
op|'('
string|"'Www-Authenticate'"
op|')'
op|','
nl|'\n'
string|'\'Swift realm="unknown"\''
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_override_asked_for_but_not_allowed
dedent|''
name|'def'
name|'test_override_asked_for_but_not_allowed'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'test_auth'
op|'='
name|'auth'
op|'.'
name|'filter_factory'
op|'('
op|'{'
string|"'allow_overrides'"
op|':'
string|"'false'"
op|'}'
op|')'
op|'('
name|'FakeApp'
op|'('
op|')'
op|')'
newline|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/v1/AUTH_account'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'swift.authorize_override'"
op|':'
name|'True'
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'401'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'.'
name|'get'
op|'('
string|"'Www-Authenticate'"
op|')'
op|','
nl|'\n'
string|'\'Swift realm="AUTH_account"\''
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'req'
op|'.'
name|'environ'
op|'['
string|"'swift.authorize'"
op|']'
op|','
nl|'\n'
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'authorize'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_override_asked_for_and_allowed
dedent|''
name|'def'
name|'test_override_asked_for_and_allowed'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'test_auth'
op|'='
name|'auth'
op|'.'
name|'filter_factory'
op|'('
op|'{'
string|"'allow_overrides'"
op|':'
string|"'true'"
op|'}'
op|')'
op|'('
name|'FakeApp'
op|'('
op|')'
op|')'
newline|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/v1/AUTH_account'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'swift.authorize_override'"
op|':'
name|'True'
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'404'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
string|"'swift.authorize'"
name|'not'
name|'in'
name|'req'
op|'.'
name|'environ'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_override_default_allowed
dedent|''
name|'def'
name|'test_override_default_allowed'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/v1/AUTH_account'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'swift.authorize_override'"
op|':'
name|'True'
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'404'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
string|"'swift.authorize'"
name|'not'
name|'in'
name|'req'
op|'.'
name|'environ'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_auth_deny_non_reseller_prefix
dedent|''
name|'def'
name|'test_auth_deny_non_reseller_prefix'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/v1/BLAH_account'"
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Auth-Token'"
op|':'
string|"'BLAH_t'"
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'401'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'.'
name|'get'
op|'('
string|"'Www-Authenticate'"
op|')'
op|','
nl|'\n'
string|'\'Swift realm="BLAH_account"\''
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'req'
op|'.'
name|'environ'
op|'['
string|"'swift.authorize'"
op|']'
op|','
nl|'\n'
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'denied_response'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_auth_deny_non_reseller_prefix_no_override
dedent|''
name|'def'
name|'test_auth_deny_non_reseller_prefix_no_override'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'fake_authorize'
op|'='
name|'lambda'
name|'x'
op|':'
name|'Response'
op|'('
name|'status'
op|'='
string|"'500 Fake'"
op|')'
newline|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/v1/BLAH_account'"
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Auth-Token'"
op|':'
string|"'BLAH_t'"
op|'}'
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'swift.authorize'"
op|':'
name|'fake_authorize'
op|'}'
nl|'\n'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'500'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'req'
op|'.'
name|'environ'
op|'['
string|"'swift.authorize'"
op|']'
op|','
name|'fake_authorize'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_auth_no_reseller_prefix_deny
dedent|''
name|'def'
name|'test_auth_no_reseller_prefix_deny'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|"# Ensures that when we have no reseller prefix, we don't deny a request"
nl|'\n'
comment|'# outright but set up a denial swift.authorize and pass the request on'
nl|'\n'
comment|'# down the chain.'
nl|'\n'
indent|'        '
name|'local_app'
op|'='
name|'FakeApp'
op|'('
op|')'
newline|'\n'
name|'local_auth'
op|'='
name|'auth'
op|'.'
name|'filter_factory'
op|'('
op|'{'
string|"'reseller_prefix'"
op|':'
string|"''"
op|'}'
op|')'
op|'('
name|'local_app'
op|')'
newline|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/v1/account'"
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Auth-Token'"
op|':'
string|"'t'"
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'local_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'401'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'.'
name|'get'
op|'('
string|"'Www-Authenticate'"
op|')'
op|','
nl|'\n'
string|'\'Swift realm="account"\''
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'local_app'
op|'.'
name|'calls'
op|','
number|'1'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'req'
op|'.'
name|'environ'
op|'['
string|"'swift.authorize'"
op|']'
op|','
nl|'\n'
name|'local_auth'
op|'.'
name|'denied_response'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_auth_reseller_prefix_with_s3_deny
dedent|''
name|'def'
name|'test_auth_reseller_prefix_with_s3_deny'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# Ensures that when we have a reseller prefix and using a middleware'
nl|'\n'
comment|"# relying on Http-Authorization (for example swift3), we don't deny a"
nl|'\n'
comment|'# request outright but set up a denial swift.authorize and pass the'
nl|'\n'
comment|'# request on down the chain.'
nl|'\n'
indent|'        '
name|'local_app'
op|'='
name|'FakeApp'
op|'('
op|')'
newline|'\n'
name|'local_auth'
op|'='
name|'auth'
op|'.'
name|'filter_factory'
op|'('
op|'{'
string|"'reseller_prefix'"
op|':'
string|"'PRE'"
op|'}'
op|')'
op|'('
name|'local_app'
op|')'
newline|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/v1/account'"
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Auth-Token'"
op|':'
string|"'t'"
op|','
nl|'\n'
string|"'Authorization'"
op|':'
string|"'AWS user:pw'"
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'local_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'401'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'local_app'
op|'.'
name|'calls'
op|','
number|'1'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'req'
op|'.'
name|'environ'
op|'['
string|"'swift.authorize'"
op|']'
op|','
nl|'\n'
name|'local_auth'
op|'.'
name|'denied_response'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_auth_with_s3_authorization
dedent|''
name|'def'
name|'test_auth_with_s3_authorization'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'local_app'
op|'='
name|'FakeApp'
op|'('
op|')'
newline|'\n'
name|'local_auth'
op|'='
name|'auth'
op|'.'
name|'filter_factory'
op|'('
nl|'\n'
op|'{'
string|"'user_s3_s3'"
op|':'
string|"'s3 .admin'"
op|'}'
op|')'
op|'('
name|'local_app'
op|')'
newline|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/v1/AUTH_s3'"
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Auth-Token'"
op|':'
string|"'t'"
op|','
nl|'\n'
string|"'AUTHORIZATION'"
op|':'
string|"'AWS s3:s3:pass'"
op|'}'
op|')'
newline|'\n'
nl|'\n'
name|'with'
name|'mock'
op|'.'
name|'patch'
op|'('
string|"'base64.urlsafe_b64decode'"
op|')'
name|'as'
name|'msg'
op|','
name|'mock'
op|'.'
name|'patch'
op|'('
string|"'base64.encodestring'"
op|')'
name|'as'
name|'sign'
op|':'
newline|'\n'
indent|'            '
name|'msg'
op|'.'
name|'return_value'
op|'='
string|"''"
newline|'\n'
name|'sign'
op|'.'
name|'return_value'
op|'='
string|"'pass'"
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'local_auth'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'404'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'local_app'
op|'.'
name|'calls'
op|','
number|'1'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'req'
op|'.'
name|'environ'
op|'['
string|"'swift.authorize'"
op|']'
op|','
nl|'\n'
name|'local_auth'
op|'.'
name|'authorize'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_auth_no_reseller_prefix_no_token
dedent|''
name|'def'
name|'test_auth_no_reseller_prefix_no_token'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# Check that normally we set up a call back to our authorize.'
nl|'\n'
indent|'        '
name|'local_auth'
op|'='
name|'auth'
op|'.'
name|'filter_factory'
op|'('
op|'{'
string|"'reseller_prefix'"
op|':'
string|"''"
op|'}'
op|')'
op|'('
name|'FakeApp'
op|'('
op|')'
op|')'
newline|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/v1/account'"
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'local_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'401'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'.'
name|'get'
op|'('
string|"'Www-Authenticate'"
op|')'
op|','
nl|'\n'
string|'\'Swift realm="account"\''
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'req'
op|'.'
name|'environ'
op|'['
string|"'swift.authorize'"
op|']'
op|','
nl|'\n'
name|'local_auth'
op|'.'
name|'authorize'
op|')'
newline|'\n'
comment|"# Now make sure we don't override an existing swift.authorize when we"
nl|'\n'
comment|'# have no reseller prefix.'
nl|'\n'
name|'local_auth'
op|'='
name|'auth'
op|'.'
name|'filter_factory'
op|'('
op|'{'
string|"'reseller_prefix'"
op|':'
string|"''"
op|'}'
op|')'
op|'('
name|'FakeApp'
op|'('
op|')'
op|')'
newline|'\n'
name|'local_authorize'
op|'='
name|'lambda'
name|'req'
op|':'
name|'Response'
op|'('
string|"'test'"
op|')'
newline|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/v1/account'"
op|','
name|'environ'
op|'='
op|'{'
string|"'swift.authorize'"
op|':'
nl|'\n'
name|'local_authorize'
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'local_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'req'
op|'.'
name|'environ'
op|'['
string|"'swift.authorize'"
op|']'
op|','
name|'local_authorize'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'200'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_auth_fail
dedent|''
name|'def'
name|'test_auth_fail'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'resp'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
nl|'\n'
string|"'/v1/AUTH_cfa'"
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Auth-Token'"
op|':'
string|"'AUTH_t'"
op|'}'
op|')'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'401'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'.'
name|'get'
op|'('
string|"'Www-Authenticate'"
op|')'
op|','
nl|'\n'
string|'\'Swift realm="AUTH_cfa"\''
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_authorize_bad_path
dedent|''
name|'def'
name|'test_authorize_bad_path'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/badpath'"
op|')'
newline|'\n'
name|'resp'
op|'='
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'authorize'
op|'('
name|'req'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'401'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'.'
name|'get'
op|'('
string|"'Www-Authenticate'"
op|')'
op|','
nl|'\n'
string|'\'Swift realm="unknown"\''
op|')'
newline|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/badpath'"
op|')'
newline|'\n'
name|'req'
op|'.'
name|'remote_user'
op|'='
string|"'act:usr,act,AUTH_cfa'"
newline|'\n'
name|'resp'
op|'='
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'authorize'
op|'('
name|'req'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'403'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_authorize_account_access
dedent|''
name|'def'
name|'test_authorize_account_access'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/v1/AUTH_cfa'"
op|')'
newline|'\n'
name|'req'
op|'.'
name|'remote_user'
op|'='
string|"'act:usr,act,AUTH_cfa'"
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'authorize'
op|'('
name|'req'
op|')'
op|','
name|'None'
op|')'
newline|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/v1/AUTH_cfa'"
op|')'
newline|'\n'
name|'req'
op|'.'
name|'remote_user'
op|'='
string|"'act:usr,act'"
newline|'\n'
name|'resp'
op|'='
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'authorize'
op|'('
name|'req'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'403'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_authorize_acl_group_access
dedent|''
name|'def'
name|'test_authorize_acl_group_access'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'test_auth'
op|'='
name|'auth'
op|'.'
name|'filter_factory'
op|'('
op|'{'
op|'}'
op|')'
op|'('
nl|'\n'
name|'FakeApp'
op|'('
name|'iter'
op|'('
name|'NO_CONTENT_RESP'
op|'*'
number|'3'
op|')'
op|')'
op|')'
newline|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/v1/AUTH_cfa'"
op|')'
newline|'\n'
name|'req'
op|'.'
name|'remote_user'
op|'='
string|"'act:usr,act'"
newline|'\n'
name|'resp'
op|'='
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'authorize'
op|'('
name|'req'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'403'
op|')'
newline|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/v1/AUTH_cfa'"
op|')'
newline|'\n'
name|'req'
op|'.'
name|'remote_user'
op|'='
string|"'act:usr,act'"
newline|'\n'
name|'req'
op|'.'
name|'acl'
op|'='
string|"'act'"
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'authorize'
op|'('
name|'req'
op|')'
op|','
name|'None'
op|')'
newline|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/v1/AUTH_cfa'"
op|')'
newline|'\n'
name|'req'
op|'.'
name|'remote_user'
op|'='
string|"'act:usr,act'"
newline|'\n'
name|'req'
op|'.'
name|'acl'
op|'='
string|"'act:usr'"
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'authorize'
op|'('
name|'req'
op|')'
op|','
name|'None'
op|')'
newline|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/v1/AUTH_cfa'"
op|')'
newline|'\n'
name|'req'
op|'.'
name|'remote_user'
op|'='
string|"'act:usr,act'"
newline|'\n'
name|'req'
op|'.'
name|'acl'
op|'='
string|"'act2'"
newline|'\n'
name|'resp'
op|'='
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'authorize'
op|'('
name|'req'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'403'
op|')'
newline|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/v1/AUTH_cfa'"
op|')'
newline|'\n'
name|'req'
op|'.'
name|'remote_user'
op|'='
string|"'act:usr,act'"
newline|'\n'
name|'req'
op|'.'
name|'acl'
op|'='
string|"'act:usr2'"
newline|'\n'
name|'resp'
op|'='
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'authorize'
op|'('
name|'req'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'403'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_deny_cross_reseller
dedent|''
name|'def'
name|'test_deny_cross_reseller'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# Tests that cross-reseller is denied, even if ACLs/group names match'
nl|'\n'
indent|'        '
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/v1/OTHER_cfa'"
op|')'
newline|'\n'
name|'req'
op|'.'
name|'remote_user'
op|'='
string|"'act:usr,act,AUTH_cfa'"
newline|'\n'
name|'req'
op|'.'
name|'acl'
op|'='
string|"'act'"
newline|'\n'
name|'resp'
op|'='
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'authorize'
op|'('
name|'req'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'403'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_authorize_acl_referer_after_user_groups
dedent|''
name|'def'
name|'test_authorize_acl_referer_after_user_groups'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/v1/AUTH_cfa/c'"
op|')'
newline|'\n'
name|'req'
op|'.'
name|'remote_user'
op|'='
string|"'act:usr'"
newline|'\n'
name|'req'
op|'.'
name|'acl'
op|'='
string|"'.r:*,act:usr'"
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'authorize'
op|'('
name|'req'
op|')'
op|','
name|'None'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_authorize_acl_referrer_access
dedent|''
name|'def'
name|'test_authorize_acl_referrer_access'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'test_auth'
op|'='
name|'auth'
op|'.'
name|'filter_factory'
op|'('
op|'{'
op|'}'
op|')'
op|'('
nl|'\n'
name|'FakeApp'
op|'('
name|'iter'
op|'('
name|'NO_CONTENT_RESP'
op|'*'
number|'6'
op|')'
op|')'
op|')'
newline|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/v1/AUTH_cfa/c'"
op|')'
newline|'\n'
name|'req'
op|'.'
name|'remote_user'
op|'='
string|"'act:usr,act'"
newline|'\n'
name|'resp'
op|'='
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'authorize'
op|'('
name|'req'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'403'
op|')'
newline|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/v1/AUTH_cfa/c'"
op|')'
newline|'\n'
name|'req'
op|'.'
name|'remote_user'
op|'='
string|"'act:usr,act'"
newline|'\n'
name|'req'
op|'.'
name|'acl'
op|'='
string|"'.r:*,.rlistings'"
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'authorize'
op|'('
name|'req'
op|')'
op|','
name|'None'
op|')'
newline|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/v1/AUTH_cfa/c'"
op|')'
newline|'\n'
name|'req'
op|'.'
name|'remote_user'
op|'='
string|"'act:usr,act'"
newline|'\n'
name|'req'
op|'.'
name|'acl'
op|'='
string|"'.r:*'"
comment|'# No listings allowed'
newline|'\n'
name|'resp'
op|'='
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'authorize'
op|'('
name|'req'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'403'
op|')'
newline|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/v1/AUTH_cfa/c'"
op|')'
newline|'\n'
name|'req'
op|'.'
name|'remote_user'
op|'='
string|"'act:usr,act'"
newline|'\n'
name|'req'
op|'.'
name|'acl'
op|'='
string|"'.r:.example.com,.rlistings'"
newline|'\n'
name|'resp'
op|'='
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'authorize'
op|'('
name|'req'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'403'
op|')'
newline|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/v1/AUTH_cfa/c'"
op|')'
newline|'\n'
name|'req'
op|'.'
name|'remote_user'
op|'='
string|"'act:usr,act'"
newline|'\n'
name|'req'
op|'.'
name|'referer'
op|'='
string|"'http://www.example.com/index.html'"
newline|'\n'
name|'req'
op|'.'
name|'acl'
op|'='
string|"'.r:.example.com,.rlistings'"
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'authorize'
op|'('
name|'req'
op|')'
op|','
name|'None'
op|')'
newline|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/v1/AUTH_cfa/c'"
op|')'
newline|'\n'
name|'resp'
op|'='
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'authorize'
op|'('
name|'req'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'401'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'.'
name|'get'
op|'('
string|"'Www-Authenticate'"
op|')'
op|','
nl|'\n'
string|'\'Swift realm="AUTH_cfa"\''
op|')'
newline|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/v1/AUTH_cfa/c'"
op|')'
newline|'\n'
name|'req'
op|'.'
name|'acl'
op|'='
string|"'.r:*,.rlistings'"
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'authorize'
op|'('
name|'req'
op|')'
op|','
name|'None'
op|')'
newline|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/v1/AUTH_cfa/c'"
op|')'
newline|'\n'
name|'req'
op|'.'
name|'acl'
op|'='
string|"'.r:*'"
comment|'# No listings allowed'
newline|'\n'
name|'resp'
op|'='
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'authorize'
op|'('
name|'req'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'401'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'.'
name|'get'
op|'('
string|"'Www-Authenticate'"
op|')'
op|','
nl|'\n'
string|'\'Swift realm="AUTH_cfa"\''
op|')'
newline|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/v1/AUTH_cfa/c'"
op|')'
newline|'\n'
name|'req'
op|'.'
name|'acl'
op|'='
string|"'.r:.example.com,.rlistings'"
newline|'\n'
name|'resp'
op|'='
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'authorize'
op|'('
name|'req'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'401'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'.'
name|'get'
op|'('
string|"'Www-Authenticate'"
op|')'
op|','
nl|'\n'
string|'\'Swift realm="AUTH_cfa"\''
op|')'
newline|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/v1/AUTH_cfa/c'"
op|')'
newline|'\n'
name|'req'
op|'.'
name|'referer'
op|'='
string|"'http://www.example.com/index.html'"
newline|'\n'
name|'req'
op|'.'
name|'acl'
op|'='
string|"'.r:.example.com,.rlistings'"
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'authorize'
op|'('
name|'req'
op|')'
op|','
name|'None'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_detect_reseller_request
dedent|''
name|'def'
name|'test_detect_reseller_request'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/v1/AUTH_admin'"
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Auth-Token'"
op|':'
string|"'AUTH_t'"
op|'}'
op|')'
newline|'\n'
name|'cache_key'
op|'='
string|"'AUTH_/token/AUTH_t'"
newline|'\n'
name|'cache_entry'
op|'='
op|'('
name|'time'
op|'('
op|')'
op|'+'
number|'3600'
op|','
string|"'.reseller_admin'"
op|')'
newline|'\n'
name|'req'
op|'.'
name|'environ'
op|'['
string|"'swift.cache'"
op|']'
op|'.'
name|'set'
op|'('
name|'cache_key'
op|','
name|'cache_entry'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'req'
op|'.'
name|'environ'
op|'.'
name|'get'
op|'('
string|"'reseller_request'"
op|','
name|'False'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_account_put_permissions
dedent|''
name|'def'
name|'test_account_put_permissions'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'test_auth'
op|'='
name|'auth'
op|'.'
name|'filter_factory'
op|'('
op|'{'
op|'}'
op|')'
op|'('
nl|'\n'
name|'FakeApp'
op|'('
name|'iter'
op|'('
name|'NO_CONTENT_RESP'
op|'*'
number|'4'
op|')'
op|')'
op|')'
newline|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/v1/AUTH_new'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'remote_user'
op|'='
string|"'act:usr,act'"
newline|'\n'
name|'resp'
op|'='
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'authorize'
op|'('
name|'req'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'403'
op|')'
newline|'\n'
nl|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/v1/AUTH_new'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'remote_user'
op|'='
string|"'act:usr,act,AUTH_other'"
newline|'\n'
name|'resp'
op|'='
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'authorize'
op|'('
name|'req'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'403'
op|')'
newline|'\n'
nl|'\n'
comment|'# Even PUTs to your own account as account admin should fail'
nl|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/v1/AUTH_old'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'remote_user'
op|'='
string|"'act:usr,act,AUTH_old'"
newline|'\n'
name|'resp'
op|'='
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'authorize'
op|'('
name|'req'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'403'
op|')'
newline|'\n'
nl|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/v1/AUTH_new'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'remote_user'
op|'='
string|"'act:usr,act,.reseller_admin'"
newline|'\n'
name|'resp'
op|'='
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'authorize'
op|'('
name|'req'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|','
name|'None'
op|')'
newline|'\n'
nl|'\n'
comment|'# .super_admin is not something the middleware should ever see or care'
nl|'\n'
comment|'# about'
nl|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/v1/AUTH_new'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'remote_user'
op|'='
string|"'act:usr,act,.super_admin'"
newline|'\n'
name|'resp'
op|'='
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'authorize'
op|'('
name|'req'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'403'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_account_delete_permissions
dedent|''
name|'def'
name|'test_account_delete_permissions'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'test_auth'
op|'='
name|'auth'
op|'.'
name|'filter_factory'
op|'('
op|'{'
op|'}'
op|')'
op|'('
nl|'\n'
name|'FakeApp'
op|'('
name|'iter'
op|'('
name|'NO_CONTENT_RESP'
op|'*'
number|'4'
op|')'
op|')'
op|')'
newline|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/v1/AUTH_new'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'DELETE'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'remote_user'
op|'='
string|"'act:usr,act'"
newline|'\n'
name|'resp'
op|'='
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'authorize'
op|'('
name|'req'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'403'
op|')'
newline|'\n'
nl|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/v1/AUTH_new'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'DELETE'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'remote_user'
op|'='
string|"'act:usr,act,AUTH_other'"
newline|'\n'
name|'resp'
op|'='
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'authorize'
op|'('
name|'req'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'403'
op|')'
newline|'\n'
nl|'\n'
comment|'# Even DELETEs to your own account as account admin should fail'
nl|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/v1/AUTH_old'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'DELETE'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'remote_user'
op|'='
string|"'act:usr,act,AUTH_old'"
newline|'\n'
name|'resp'
op|'='
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'authorize'
op|'('
name|'req'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'403'
op|')'
newline|'\n'
nl|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/v1/AUTH_new'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'DELETE'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'remote_user'
op|'='
string|"'act:usr,act,.reseller_admin'"
newline|'\n'
name|'resp'
op|'='
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'authorize'
op|'('
name|'req'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|','
name|'None'
op|')'
newline|'\n'
nl|'\n'
comment|'# .super_admin is not something the middleware should ever see or care'
nl|'\n'
comment|'# about'
nl|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/v1/AUTH_new'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'DELETE'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'remote_user'
op|'='
string|"'act:usr,act,.super_admin'"
newline|'\n'
name|'resp'
op|'='
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'authorize'
op|'('
name|'req'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'403'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_token_success
dedent|''
name|'def'
name|'test_get_token_success'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# Example of how to simulate the auth transaction'
nl|'\n'
indent|'        '
name|'test_auth'
op|'='
name|'auth'
op|'.'
name|'filter_factory'
op|'('
op|'{'
string|"'user_ac_user'"
op|':'
string|"'testing'"
op|'}'
op|')'
op|'('
name|'FakeApp'
op|'('
op|')'
op|')'
newline|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
nl|'\n'
string|"'/auth/v1.0'"
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Auth-User'"
op|':'
string|"'ac:user'"
op|','
string|"'X-Auth-Key'"
op|':'
string|"'testing'"
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'200'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'['
string|"'x-storage-url'"
op|']'
op|'.'
name|'endswith'
op|'('
string|"'/v1/AUTH_ac'"
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'['
string|"'x-auth-token'"
op|']'
op|'.'
name|'startswith'
op|'('
string|"'AUTH_'"
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'['
string|"'x-auth-token'"
op|']'
op|','
nl|'\n'
name|'resp'
op|'.'
name|'headers'
op|'['
string|"'x-storage-token'"
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertAlmostEqual'
op|'('
name|'int'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'['
string|"'x-auth-token-expires'"
op|']'
op|')'
op|','
nl|'\n'
name|'auth'
op|'.'
name|'DEFAULT_TOKEN_LIFE'
op|'-'
number|'0.5'
op|','
name|'delta'
op|'='
number|'0.5'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertGreater'
op|'('
name|'len'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'['
string|"'x-auth-token'"
op|']'
op|')'
op|','
number|'10'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_token_success_other_auth_prefix
dedent|''
name|'def'
name|'test_get_token_success_other_auth_prefix'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'test_auth'
op|'='
name|'auth'
op|'.'
name|'filter_factory'
op|'('
op|'{'
string|"'user_ac_user'"
op|':'
string|"'testing'"
op|','
nl|'\n'
string|"'auth_prefix'"
op|':'
string|"'/other/'"
op|'}'
op|')'
op|'('
name|'FakeApp'
op|'('
op|')'
op|')'
newline|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
nl|'\n'
string|"'/other/v1.0'"
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Auth-User'"
op|':'
string|"'ac:user'"
op|','
string|"'X-Auth-Key'"
op|':'
string|"'testing'"
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'200'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'['
string|"'x-storage-url'"
op|']'
op|'.'
name|'endswith'
op|'('
string|"'/v1/AUTH_ac'"
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'['
string|"'x-auth-token'"
op|']'
op|'.'
name|'startswith'
op|'('
string|"'AUTH_'"
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'len'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'['
string|"'x-auth-token'"
op|']'
op|')'
op|'>'
number|'10'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_use_token_success
dedent|''
name|'def'
name|'test_use_token_success'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# Example of how to simulate an authorized request'
nl|'\n'
indent|'        '
name|'test_auth'
op|'='
name|'auth'
op|'.'
name|'filter_factory'
op|'('
op|'{'
string|"'user_acct_user'"
op|':'
string|"'testing'"
op|'}'
op|')'
op|'('
nl|'\n'
name|'FakeApp'
op|'('
name|'iter'
op|'('
name|'NO_CONTENT_RESP'
op|'*'
number|'1'
op|')'
op|')'
op|')'
newline|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/v1/AUTH_acct'"
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Auth-Token'"
op|':'
string|"'AUTH_t'"
op|'}'
op|')'
newline|'\n'
name|'cache_key'
op|'='
string|"'AUTH_/token/AUTH_t'"
newline|'\n'
name|'cache_entry'
op|'='
op|'('
name|'time'
op|'('
op|')'
op|'+'
number|'3600'
op|','
string|"'AUTH_acct'"
op|')'
newline|'\n'
name|'req'
op|'.'
name|'environ'
op|'['
string|"'swift.cache'"
op|']'
op|'.'
name|'set'
op|'('
name|'cache_key'
op|','
name|'cache_entry'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'204'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_token_fail
dedent|''
name|'def'
name|'test_get_token_fail'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'resp'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/auth/v1.0'"
op|')'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'401'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'.'
name|'get'
op|'('
string|"'Www-Authenticate'"
op|')'
op|','
nl|'\n'
string|'\'Swift realm="unknown"\''
op|')'
newline|'\n'
name|'resp'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
nl|'\n'
string|"'/auth/v1.0'"
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Auth-User'"
op|':'
string|"'act:usr'"
op|','
nl|'\n'
string|"'X-Auth-Key'"
op|':'
string|"'key'"
op|'}'
op|')'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'401'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
string|"'Www-Authenticate'"
name|'in'
name|'resp'
op|'.'
name|'headers'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'.'
name|'get'
op|'('
string|"'Www-Authenticate'"
op|')'
op|','
nl|'\n'
string|'\'Swift realm="act"\''
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_token_fail_invalid_x_auth_user_format
dedent|''
name|'def'
name|'test_get_token_fail_invalid_x_auth_user_format'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'resp'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
nl|'\n'
string|"'/auth/v1/act/auth'"
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Auth-User'"
op|':'
string|"'usr'"
op|','
nl|'\n'
string|"'X-Auth-Key'"
op|':'
string|"'key'"
op|'}'
op|')'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'401'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'.'
name|'get'
op|'('
string|"'Www-Authenticate'"
op|')'
op|','
nl|'\n'
string|'\'Swift realm="act"\''
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_token_fail_non_matching_account_in_request
dedent|''
name|'def'
name|'test_get_token_fail_non_matching_account_in_request'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'resp'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
nl|'\n'
string|"'/auth/v1/act/auth'"
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Auth-User'"
op|':'
string|"'act2:usr'"
op|','
nl|'\n'
string|"'X-Auth-Key'"
op|':'
string|"'key'"
op|'}'
op|')'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'401'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'.'
name|'get'
op|'('
string|"'Www-Authenticate'"
op|')'
op|','
nl|'\n'
string|'\'Swift realm="act"\''
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_token_fail_bad_path
dedent|''
name|'def'
name|'test_get_token_fail_bad_path'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'resp'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
nl|'\n'
string|"'/auth/v1/act/auth/invalid'"
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Auth-User'"
op|':'
string|"'act:usr'"
op|','
nl|'\n'
string|"'X-Auth-Key'"
op|':'
string|"'key'"
op|'}'
op|')'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'400'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_token_fail_missing_key
dedent|''
name|'def'
name|'test_get_token_fail_missing_key'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'resp'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
nl|'\n'
string|"'/auth/v1/act/auth'"
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Auth-User'"
op|':'
string|"'act:usr'"
op|'}'
op|')'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'401'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'.'
name|'get'
op|'('
string|"'Www-Authenticate'"
op|')'
op|','
nl|'\n'
string|'\'Swift realm="act"\''
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_object_name_containing_slash
dedent|''
name|'def'
name|'test_object_name_containing_slash'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'test_auth'
op|'='
name|'auth'
op|'.'
name|'filter_factory'
op|'('
op|'{'
string|"'user_acct_user'"
op|':'
string|"'testing'"
op|'}'
op|')'
op|'('
nl|'\n'
name|'FakeApp'
op|'('
name|'iter'
op|'('
name|'NO_CONTENT_RESP'
op|'*'
number|'1'
op|')'
op|')'
op|')'
newline|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/v1/AUTH_acct/cont/obj/name/with/slash'"
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Auth-Token'"
op|':'
string|"'AUTH_t'"
op|'}'
op|')'
newline|'\n'
name|'cache_key'
op|'='
string|"'AUTH_/token/AUTH_t'"
newline|'\n'
name|'cache_entry'
op|'='
op|'('
name|'time'
op|'('
op|')'
op|'+'
number|'3600'
op|','
string|"'AUTH_acct'"
op|')'
newline|'\n'
name|'req'
op|'.'
name|'environ'
op|'['
string|"'swift.cache'"
op|']'
op|'.'
name|'set'
op|'('
name|'cache_key'
op|','
name|'cache_entry'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'204'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_storage_url_default
dedent|''
name|'def'
name|'test_storage_url_default'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'test_auth'
op|'='
name|'auth'
op|'.'
name|'filter_factory'
op|'('
op|'{'
string|"'user_test_tester'"
op|':'
string|"'testing'"
op|'}'
op|')'
op|'('
name|'FakeApp'
op|'('
op|')'
op|')'
newline|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
nl|'\n'
string|"'/auth/v1.0'"
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Auth-User'"
op|':'
string|"'test:tester'"
op|','
string|"'X-Auth-Key'"
op|':'
string|"'testing'"
op|'}'
op|')'
newline|'\n'
name|'del'
name|'req'
op|'.'
name|'environ'
op|'['
string|"'HTTP_HOST'"
op|']'
newline|'\n'
name|'req'
op|'.'
name|'environ'
op|'['
string|"'SERVER_NAME'"
op|']'
op|'='
string|"'bob'"
newline|'\n'
name|'req'
op|'.'
name|'environ'
op|'['
string|"'SERVER_PORT'"
op|']'
op|'='
string|"'1234'"
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'200'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'['
string|"'x-storage-url'"
op|']'
op|','
nl|'\n'
string|"'http://bob:1234/v1/AUTH_test'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_storage_url_based_on_host
dedent|''
name|'def'
name|'test_storage_url_based_on_host'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'test_auth'
op|'='
name|'auth'
op|'.'
name|'filter_factory'
op|'('
op|'{'
string|"'user_test_tester'"
op|':'
string|"'testing'"
op|'}'
op|')'
op|'('
name|'FakeApp'
op|'('
op|')'
op|')'
newline|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
nl|'\n'
string|"'/auth/v1.0'"
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Auth-User'"
op|':'
string|"'test:tester'"
op|','
string|"'X-Auth-Key'"
op|':'
string|"'testing'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'environ'
op|'['
string|"'HTTP_HOST'"
op|']'
op|'='
string|"'somehost:5678'"
newline|'\n'
name|'req'
op|'.'
name|'environ'
op|'['
string|"'SERVER_NAME'"
op|']'
op|'='
string|"'bob'"
newline|'\n'
name|'req'
op|'.'
name|'environ'
op|'['
string|"'SERVER_PORT'"
op|']'
op|'='
string|"'1234'"
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'200'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'['
string|"'x-storage-url'"
op|']'
op|','
nl|'\n'
string|"'http://somehost:5678/v1/AUTH_test'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_storage_url_overridden_scheme
dedent|''
name|'def'
name|'test_storage_url_overridden_scheme'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'test_auth'
op|'='
name|'auth'
op|'.'
name|'filter_factory'
op|'('
op|'{'
string|"'user_test_tester'"
op|':'
string|"'testing'"
op|','
nl|'\n'
string|"'storage_url_scheme'"
op|':'
string|"'fake'"
op|'}'
op|')'
op|'('
name|'FakeApp'
op|'('
op|')'
op|')'
newline|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
nl|'\n'
string|"'/auth/v1.0'"
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Auth-User'"
op|':'
string|"'test:tester'"
op|','
string|"'X-Auth-Key'"
op|':'
string|"'testing'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'environ'
op|'['
string|"'HTTP_HOST'"
op|']'
op|'='
string|"'somehost:5678'"
newline|'\n'
name|'req'
op|'.'
name|'environ'
op|'['
string|"'SERVER_NAME'"
op|']'
op|'='
string|"'bob'"
newline|'\n'
name|'req'
op|'.'
name|'environ'
op|'['
string|"'SERVER_PORT'"
op|']'
op|'='
string|"'1234'"
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'200'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'['
string|"'x-storage-url'"
op|']'
op|','
nl|'\n'
string|"'fake://somehost:5678/v1/AUTH_test'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_use_old_token_from_memcached
dedent|''
name|'def'
name|'test_use_old_token_from_memcached'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'test_auth'
op|'='
name|'auth'
op|'.'
name|'filter_factory'
op|'('
op|'{'
string|"'user_test_tester'"
op|':'
string|"'testing'"
op|','
nl|'\n'
string|"'storage_url_scheme'"
op|':'
string|"'fake'"
op|'}'
op|')'
op|'('
name|'FakeApp'
op|'('
op|')'
op|')'
newline|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
nl|'\n'
string|"'/auth/v1.0'"
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Auth-User'"
op|':'
string|"'test:tester'"
op|','
string|"'X-Auth-Key'"
op|':'
string|"'testing'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'environ'
op|'['
string|"'HTTP_HOST'"
op|']'
op|'='
string|"'somehost:5678'"
newline|'\n'
name|'req'
op|'.'
name|'environ'
op|'['
string|"'SERVER_NAME'"
op|']'
op|'='
string|"'bob'"
newline|'\n'
name|'req'
op|'.'
name|'environ'
op|'['
string|"'SERVER_PORT'"
op|']'
op|'='
string|"'1234'"
newline|'\n'
name|'req'
op|'.'
name|'environ'
op|'['
string|"'swift.cache'"
op|']'
op|'.'
name|'set'
op|'('
string|"'AUTH_/user/test:tester'"
op|','
string|"'uuid_token'"
op|')'
newline|'\n'
name|'expires'
op|'='
name|'time'
op|'('
op|')'
op|'+'
number|'180'
newline|'\n'
name|'req'
op|'.'
name|'environ'
op|'['
string|"'swift.cache'"
op|']'
op|'.'
name|'set'
op|'('
string|"'AUTH_/token/uuid_token'"
op|','
nl|'\n'
op|'('
name|'expires'
op|','
string|"'test,test:tester'"
op|')'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'200'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'['
string|"'x-auth-token'"
op|']'
op|','
string|"'uuid_token'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'['
string|"'x-auth-token'"
op|']'
op|','
nl|'\n'
name|'resp'
op|'.'
name|'headers'
op|'['
string|"'x-storage-token'"
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertAlmostEqual'
op|'('
name|'int'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'['
string|"'x-auth-token-expires'"
op|']'
op|')'
op|','
nl|'\n'
number|'179.5'
op|','
name|'delta'
op|'='
number|'0.5'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_old_token_overdate
dedent|''
name|'def'
name|'test_old_token_overdate'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'test_auth'
op|'='
name|'auth'
op|'.'
name|'filter_factory'
op|'('
op|'{'
string|"'user_test_tester'"
op|':'
string|"'testing'"
op|','
nl|'\n'
string|"'storage_url_scheme'"
op|':'
string|"'fake'"
op|'}'
op|')'
op|'('
name|'FakeApp'
op|'('
op|')'
op|')'
newline|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
nl|'\n'
string|"'/auth/v1.0'"
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Auth-User'"
op|':'
string|"'test:tester'"
op|','
string|"'X-Auth-Key'"
op|':'
string|"'testing'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'environ'
op|'['
string|"'HTTP_HOST'"
op|']'
op|'='
string|"'somehost:5678'"
newline|'\n'
name|'req'
op|'.'
name|'environ'
op|'['
string|"'SERVER_NAME'"
op|']'
op|'='
string|"'bob'"
newline|'\n'
name|'req'
op|'.'
name|'environ'
op|'['
string|"'SERVER_PORT'"
op|']'
op|'='
string|"'1234'"
newline|'\n'
name|'req'
op|'.'
name|'environ'
op|'['
string|"'swift.cache'"
op|']'
op|'.'
name|'set'
op|'('
string|"'AUTH_/user/test:tester'"
op|','
string|"'uuid_token'"
op|')'
newline|'\n'
name|'req'
op|'.'
name|'environ'
op|'['
string|"'swift.cache'"
op|']'
op|'.'
name|'set'
op|'('
string|"'AUTH_/token/uuid_token'"
op|','
nl|'\n'
op|'('
number|'0'
op|','
string|"'test,test:tester'"
op|')'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'200'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertNotEqual'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'['
string|"'x-auth-token'"
op|']'
op|','
string|"'uuid_token'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'['
string|"'x-auth-token'"
op|']'
op|'['
op|':'
number|'7'
op|']'
op|','
string|"'AUTH_tk'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertAlmostEqual'
op|'('
name|'int'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'['
string|"'x-auth-token-expires'"
op|']'
op|')'
op|','
nl|'\n'
name|'auth'
op|'.'
name|'DEFAULT_TOKEN_LIFE'
op|'-'
number|'0.5'
op|','
name|'delta'
op|'='
number|'0.5'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_old_token_with_old_data
dedent|''
name|'def'
name|'test_old_token_with_old_data'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'test_auth'
op|'='
name|'auth'
op|'.'
name|'filter_factory'
op|'('
op|'{'
string|"'user_test_tester'"
op|':'
string|"'testing'"
op|','
nl|'\n'
string|"'storage_url_scheme'"
op|':'
string|"'fake'"
op|'}'
op|')'
op|'('
name|'FakeApp'
op|'('
op|')'
op|')'
newline|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
nl|'\n'
string|"'/auth/v1.0'"
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Auth-User'"
op|':'
string|"'test:tester'"
op|','
string|"'X-Auth-Key'"
op|':'
string|"'testing'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'environ'
op|'['
string|"'HTTP_HOST'"
op|']'
op|'='
string|"'somehost:5678'"
newline|'\n'
name|'req'
op|'.'
name|'environ'
op|'['
string|"'SERVER_NAME'"
op|']'
op|'='
string|"'bob'"
newline|'\n'
name|'req'
op|'.'
name|'environ'
op|'['
string|"'SERVER_PORT'"
op|']'
op|'='
string|"'1234'"
newline|'\n'
name|'req'
op|'.'
name|'environ'
op|'['
string|"'swift.cache'"
op|']'
op|'.'
name|'set'
op|'('
string|"'AUTH_/user/test:tester'"
op|','
string|"'uuid_token'"
op|')'
newline|'\n'
name|'req'
op|'.'
name|'environ'
op|'['
string|"'swift.cache'"
op|']'
op|'.'
name|'set'
op|'('
string|"'AUTH_/token/uuid_token'"
op|','
nl|'\n'
op|'('
name|'time'
op|'('
op|')'
op|'+'
number|'99'
op|','
string|"'test,test:tester,.role'"
op|')'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'200'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertNotEqual'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'['
string|"'x-auth-token'"
op|']'
op|','
string|"'uuid_token'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'['
string|"'x-auth-token'"
op|']'
op|'['
op|':'
number|'7'
op|']'
op|','
string|"'AUTH_tk'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertAlmostEqual'
op|'('
name|'int'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'['
string|"'x-auth-token-expires'"
op|']'
op|')'
op|','
nl|'\n'
name|'auth'
op|'.'
name|'DEFAULT_TOKEN_LIFE'
op|'-'
number|'0.5'
op|','
name|'delta'
op|'='
number|'0.5'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_reseller_admin_is_owner
dedent|''
name|'def'
name|'test_reseller_admin_is_owner'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'orig_authorize'
op|'='
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'authorize'
newline|'\n'
name|'owner_values'
op|'='
op|'['
op|']'
newline|'\n'
nl|'\n'
DECL|function|mitm_authorize
name|'def'
name|'mitm_authorize'
op|'('
name|'req'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'rv'
op|'='
name|'orig_authorize'
op|'('
name|'req'
op|')'
newline|'\n'
name|'owner_values'
op|'.'
name|'append'
op|'('
name|'req'
op|'.'
name|'environ'
op|'.'
name|'get'
op|'('
string|"'swift_owner'"
op|','
name|'False'
op|')'
op|')'
newline|'\n'
name|'return'
name|'rv'
newline|'\n'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'authorize'
op|'='
name|'mitm_authorize'
newline|'\n'
nl|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/v1/AUTH_cfa'"
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Auth-Token'"
op|':'
string|"'AUTH_t'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'remote_user'
op|'='
string|"'.reseller_admin'"
newline|'\n'
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'authorize'
op|'('
name|'req'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'owner_values'
op|','
op|'['
name|'True'
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_admin_is_owner
dedent|''
name|'def'
name|'test_admin_is_owner'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'orig_authorize'
op|'='
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'authorize'
newline|'\n'
name|'owner_values'
op|'='
op|'['
op|']'
newline|'\n'
nl|'\n'
DECL|function|mitm_authorize
name|'def'
name|'mitm_authorize'
op|'('
name|'req'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'rv'
op|'='
name|'orig_authorize'
op|'('
name|'req'
op|')'
newline|'\n'
name|'owner_values'
op|'.'
name|'append'
op|'('
name|'req'
op|'.'
name|'environ'
op|'.'
name|'get'
op|'('
string|"'swift_owner'"
op|','
name|'False'
op|')'
op|')'
newline|'\n'
name|'return'
name|'rv'
newline|'\n'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'authorize'
op|'='
name|'mitm_authorize'
newline|'\n'
nl|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
nl|'\n'
string|"'/v1/AUTH_cfa'"
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Auth-Token'"
op|':'
string|"'AUTH_t'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'remote_user'
op|'='
string|"'AUTH_cfa'"
newline|'\n'
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'authorize'
op|'('
name|'req'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'owner_values'
op|','
op|'['
name|'True'
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_regular_is_not_owner
dedent|''
name|'def'
name|'test_regular_is_not_owner'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'orig_authorize'
op|'='
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'authorize'
newline|'\n'
name|'owner_values'
op|'='
op|'['
op|']'
newline|'\n'
nl|'\n'
DECL|function|mitm_authorize
name|'def'
name|'mitm_authorize'
op|'('
name|'req'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'rv'
op|'='
name|'orig_authorize'
op|'('
name|'req'
op|')'
newline|'\n'
name|'owner_values'
op|'.'
name|'append'
op|'('
name|'req'
op|'.'
name|'environ'
op|'.'
name|'get'
op|'('
string|"'swift_owner'"
op|','
name|'False'
op|')'
op|')'
newline|'\n'
name|'return'
name|'rv'
newline|'\n'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'authorize'
op|'='
name|'mitm_authorize'
newline|'\n'
nl|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
nl|'\n'
string|"'/v1/AUTH_cfa/c'"
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Auth-Token'"
op|':'
string|"'AUTH_t'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'remote_user'
op|'='
string|"'act:usr'"
newline|'\n'
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'authorize'
op|'('
name|'req'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'owner_values'
op|','
op|'['
name|'False'
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_sync_request_success
dedent|''
name|'def'
name|'test_sync_request_success'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'app'
op|'='
name|'FakeApp'
op|'('
name|'iter'
op|'('
name|'NO_CONTENT_RESP'
op|'*'
number|'1'
op|')'
op|','
nl|'\n'
name|'sync_key'
op|'='
string|"'secret'"
op|')'
newline|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
nl|'\n'
string|"'/v1/AUTH_cfa/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'DELETE'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'x-container-sync-key'"
op|':'
string|"'secret'"
op|','
nl|'\n'
string|"'x-timestamp'"
op|':'
string|"'123.456'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'remote_addr'
op|'='
string|"'127.0.0.1'"
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'204'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_sync_request_fail_key
dedent|''
name|'def'
name|'test_sync_request_fail_key'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'app'
op|'='
name|'FakeApp'
op|'('
name|'sync_key'
op|'='
string|"'secret'"
op|')'
newline|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
nl|'\n'
string|"'/v1/AUTH_cfa/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'DELETE'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'x-container-sync-key'"
op|':'
string|"'wrongsecret'"
op|','
nl|'\n'
string|"'x-timestamp'"
op|':'
string|"'123.456'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'remote_addr'
op|'='
string|"'127.0.0.1'"
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'401'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'.'
name|'get'
op|'('
string|"'Www-Authenticate'"
op|')'
op|','
nl|'\n'
string|'\'Swift realm="AUTH_cfa"\''
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'app'
op|'='
name|'FakeApp'
op|'('
name|'sync_key'
op|'='
string|"'othersecret'"
op|')'
newline|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
nl|'\n'
string|"'/v1/AUTH_cfa/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'DELETE'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'x-container-sync-key'"
op|':'
string|"'secret'"
op|','
nl|'\n'
string|"'x-timestamp'"
op|':'
string|"'123.456'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'remote_addr'
op|'='
string|"'127.0.0.1'"
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'401'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'.'
name|'get'
op|'('
string|"'Www-Authenticate'"
op|')'
op|','
nl|'\n'
string|'\'Swift realm="AUTH_cfa"\''
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'app'
op|'='
name|'FakeApp'
op|'('
name|'sync_key'
op|'='
name|'None'
op|')'
newline|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
nl|'\n'
string|"'/v1/AUTH_cfa/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'DELETE'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'x-container-sync-key'"
op|':'
string|"'secret'"
op|','
nl|'\n'
string|"'x-timestamp'"
op|':'
string|"'123.456'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'remote_addr'
op|'='
string|"'127.0.0.1'"
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'401'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'.'
name|'get'
op|'('
string|"'Www-Authenticate'"
op|')'
op|','
nl|'\n'
string|'\'Swift realm="AUTH_cfa"\''
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_sync_request_fail_no_timestamp
dedent|''
name|'def'
name|'test_sync_request_fail_no_timestamp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'app'
op|'='
name|'FakeApp'
op|'('
name|'sync_key'
op|'='
string|"'secret'"
op|')'
newline|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
nl|'\n'
string|"'/v1/AUTH_cfa/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'DELETE'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'x-container-sync-key'"
op|':'
string|"'secret'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'remote_addr'
op|'='
string|"'127.0.0.1'"
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'401'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'.'
name|'get'
op|'('
string|"'Www-Authenticate'"
op|')'
op|','
nl|'\n'
string|'\'Swift realm="AUTH_cfa"\''
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_sync_request_success_lb_sync_host
dedent|''
name|'def'
name|'test_sync_request_success_lb_sync_host'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'app'
op|'='
name|'FakeApp'
op|'('
name|'iter'
op|'('
name|'NO_CONTENT_RESP'
op|'*'
number|'1'
op|')'
op|','
nl|'\n'
name|'sync_key'
op|'='
string|"'secret'"
op|')'
newline|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
nl|'\n'
string|"'/v1/AUTH_cfa/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'DELETE'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'x-container-sync-key'"
op|':'
string|"'secret'"
op|','
nl|'\n'
string|"'x-timestamp'"
op|':'
string|"'123.456'"
op|','
nl|'\n'
string|"'x-forwarded-for'"
op|':'
string|"'127.0.0.1'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'remote_addr'
op|'='
string|"'127.0.0.2'"
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'204'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'app'
op|'='
name|'FakeApp'
op|'('
name|'iter'
op|'('
name|'NO_CONTENT_RESP'
op|'*'
number|'1'
op|')'
op|','
nl|'\n'
name|'sync_key'
op|'='
string|"'secret'"
op|')'
newline|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
nl|'\n'
string|"'/v1/AUTH_cfa/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'DELETE'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'x-container-sync-key'"
op|':'
string|"'secret'"
op|','
nl|'\n'
string|"'x-timestamp'"
op|':'
string|"'123.456'"
op|','
nl|'\n'
string|"'x-cluster-client-ip'"
op|':'
string|"'127.0.0.1'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'remote_addr'
op|'='
string|"'127.0.0.2'"
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'204'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_options_call
dedent|''
name|'def'
name|'test_options_call'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/v1/AUTH_cfa/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'OPTIONS'"
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'authorize'
op|'('
name|'req'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|','
name|'None'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_user_group
dedent|''
name|'def'
name|'test_get_user_group'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# More tests in TestGetUserGroups class'
nl|'\n'
indent|'        '
name|'app'
op|'='
name|'FakeApp'
op|'('
op|')'
newline|'\n'
name|'ath'
op|'='
name|'auth'
op|'.'
name|'filter_factory'
op|'('
op|'{'
op|'}'
op|')'
op|'('
name|'app'
op|')'
newline|'\n'
nl|'\n'
name|'ath'
op|'.'
name|'users'
op|'='
op|'{'
string|"'test:tester'"
op|':'
op|'{'
string|"'groups'"
op|':'
op|'['
string|"'.admin'"
op|']'
op|'}'
op|'}'
newline|'\n'
name|'groups'
op|'='
name|'ath'
op|'.'
name|'_get_user_groups'
op|'('
string|"'test'"
op|','
string|"'test:tester'"
op|','
string|"'AUTH_test'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'groups'
op|','
string|"'test,test:tester,AUTH_test'"
op|')'
newline|'\n'
nl|'\n'
name|'ath'
op|'.'
name|'users'
op|'='
op|'{'
string|"'test:tester'"
op|':'
op|'{'
string|"'groups'"
op|':'
op|'['
op|']'
op|'}'
op|'}'
newline|'\n'
name|'groups'
op|'='
name|'ath'
op|'.'
name|'_get_user_groups'
op|'('
string|"'test'"
op|','
string|"'test:tester'"
op|','
string|"'AUTH_test'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'groups'
op|','
string|"'test,test:tester'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_auth_scheme
dedent|''
name|'def'
name|'test_auth_scheme'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/v1/BLAH_account'"
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Auth-Token'"
op|':'
string|"'BLAH_t'"
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'401'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
string|"'Www-Authenticate'"
name|'in'
name|'resp'
op|'.'
name|'headers'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'.'
name|'get'
op|'('
string|"'Www-Authenticate'"
op|')'
op|','
nl|'\n'
string|'\'Swift realm="BLAH_account"\''
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|TestAuthWithMultiplePrefixes
dedent|''
dedent|''
name|'class'
name|'TestAuthWithMultiplePrefixes'
op|'('
name|'TestAuth'
op|')'
op|':'
newline|'\n'
indent|'    '
string|'"""\n    Repeats all tests in TestAuth except adds multiple\n    reseller_prefix items\n    """'
newline|'\n'
nl|'\n'
DECL|member|setUp
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'test_auth'
op|'='
name|'auth'
op|'.'
name|'filter_factory'
op|'('
nl|'\n'
op|'{'
string|"'reseller_prefix'"
op|':'
string|"'AUTH_, SOMEOTHER_, YETANOTHER_'"
op|'}'
op|')'
op|'('
name|'FakeApp'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|TestGetUserGroups
dedent|''
dedent|''
name|'class'
name|'TestGetUserGroups'
op|'('
name|'unittest'
op|'.'
name|'TestCase'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|member|test_custom_url_config
indent|'    '
name|'def'
name|'test_custom_url_config'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'app'
op|'='
name|'FakeApp'
op|'('
op|')'
newline|'\n'
name|'ath'
op|'='
name|'auth'
op|'.'
name|'filter_factory'
op|'('
op|'{'
nl|'\n'
string|"'user_test_tester'"
op|':'
nl|'\n'
string|"'testing .admin http://saio:8080/v1/AUTH_monkey'"
op|'}'
op|')'
op|'('
name|'app'
op|')'
newline|'\n'
name|'groups'
op|'='
name|'ath'
op|'.'
name|'_get_user_groups'
op|'('
string|"'test'"
op|','
string|"'test:tester'"
op|','
string|"'AUTH_monkey'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'groups'
op|','
string|"'test,test:tester,AUTH_test,AUTH_monkey'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_no_prefix_reseller
dedent|''
name|'def'
name|'test_no_prefix_reseller'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'app'
op|'='
name|'FakeApp'
op|'('
op|')'
newline|'\n'
name|'ath'
op|'='
name|'auth'
op|'.'
name|'filter_factory'
op|'('
op|'{'
string|"'reseller_prefix'"
op|':'
string|"''"
op|'}'
op|')'
op|'('
name|'app'
op|')'
newline|'\n'
nl|'\n'
name|'ath'
op|'.'
name|'users'
op|'='
op|'{'
string|"'test:tester'"
op|':'
op|'{'
string|"'groups'"
op|':'
op|'['
string|"'.admin'"
op|']'
op|'}'
op|'}'
newline|'\n'
name|'groups'
op|'='
name|'ath'
op|'.'
name|'_get_user_groups'
op|'('
string|"'test'"
op|','
string|"'test:tester'"
op|','
string|"'test'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'groups'
op|','
string|"'test,test:tester'"
op|')'
newline|'\n'
nl|'\n'
name|'ath'
op|'.'
name|'users'
op|'='
op|'{'
string|"'test:tester'"
op|':'
op|'{'
string|"'groups'"
op|':'
op|'['
op|']'
op|'}'
op|'}'
newline|'\n'
name|'groups'
op|'='
name|'ath'
op|'.'
name|'_get_user_groups'
op|'('
string|"'test'"
op|','
string|"'test:tester'"
op|','
string|"'test'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'groups'
op|','
string|"'test,test:tester'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_single_reseller
dedent|''
name|'def'
name|'test_single_reseller'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'app'
op|'='
name|'FakeApp'
op|'('
op|')'
newline|'\n'
name|'ath'
op|'='
name|'auth'
op|'.'
name|'filter_factory'
op|'('
op|'{'
op|'}'
op|')'
op|'('
name|'app'
op|')'
newline|'\n'
nl|'\n'
name|'ath'
op|'.'
name|'users'
op|'='
op|'{'
string|"'test:tester'"
op|':'
op|'{'
string|"'groups'"
op|':'
op|'['
string|"'.admin'"
op|']'
op|'}'
op|'}'
newline|'\n'
name|'groups'
op|'='
name|'ath'
op|'.'
name|'_get_user_groups'
op|'('
string|"'test'"
op|','
string|"'test:tester'"
op|','
string|"'AUTH_test'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'groups'
op|','
string|"'test,test:tester,AUTH_test'"
op|')'
newline|'\n'
nl|'\n'
name|'ath'
op|'.'
name|'users'
op|'='
op|'{'
string|"'test:tester'"
op|':'
op|'{'
string|"'groups'"
op|':'
op|'['
op|']'
op|'}'
op|'}'
newline|'\n'
name|'groups'
op|'='
name|'ath'
op|'.'
name|'_get_user_groups'
op|'('
string|"'test'"
op|','
string|"'test:tester'"
op|','
string|"'AUTH_test'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'groups'
op|','
string|"'test,test:tester'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_multiple_reseller
dedent|''
name|'def'
name|'test_multiple_reseller'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'app'
op|'='
name|'FakeApp'
op|'('
op|')'
newline|'\n'
name|'ath'
op|'='
name|'auth'
op|'.'
name|'filter_factory'
op|'('
nl|'\n'
op|'{'
string|"'reseller_prefix'"
op|':'
string|"'AUTH_, SOMEOTHER_, YETANOTHER_'"
op|'}'
op|')'
op|'('
name|'app'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'ath'
op|'.'
name|'reseller_prefixes'
op|','
op|'['
string|"'AUTH_'"
op|','
string|"'SOMEOTHER_'"
op|','
nl|'\n'
string|"'YETANOTHER_'"
op|']'
op|')'
newline|'\n'
nl|'\n'
name|'ath'
op|'.'
name|'users'
op|'='
op|'{'
string|"'test:tester'"
op|':'
op|'{'
string|"'groups'"
op|':'
op|'['
string|"'.admin'"
op|']'
op|'}'
op|'}'
newline|'\n'
name|'groups'
op|'='
name|'ath'
op|'.'
name|'_get_user_groups'
op|'('
string|"'test'"
op|','
string|"'test:tester'"
op|','
string|"'AUTH_test'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'groups'
op|','
nl|'\n'
string|"'test,test:tester,AUTH_test,'"
nl|'\n'
string|"'SOMEOTHER_test,YETANOTHER_test'"
op|')'
newline|'\n'
nl|'\n'
name|'ath'
op|'.'
name|'users'
op|'='
op|'{'
string|"'test:tester'"
op|':'
op|'{'
string|"'groups'"
op|':'
op|'['
op|']'
op|'}'
op|'}'
newline|'\n'
name|'groups'
op|'='
name|'ath'
op|'.'
name|'_get_user_groups'
op|'('
string|"'test'"
op|','
string|"'test:tester'"
op|','
string|"'AUTH_test'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'groups'
op|','
string|"'test,test:tester'"
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|TestDefinitiveAuth
dedent|''
dedent|''
name|'class'
name|'TestDefinitiveAuth'
op|'('
name|'unittest'
op|'.'
name|'TestCase'
op|')'
op|':'
newline|'\n'
DECL|member|setUp
indent|'    '
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'test_auth'
op|'='
name|'auth'
op|'.'
name|'filter_factory'
op|'('
nl|'\n'
op|'{'
string|"'reseller_prefix'"
op|':'
string|"'AUTH_, SOMEOTHER_'"
op|'}'
op|')'
op|'('
name|'FakeApp'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_noreseller_prefix
dedent|''
name|'def'
name|'test_noreseller_prefix'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'ath'
op|'='
name|'auth'
op|'.'
name|'filter_factory'
op|'('
op|'{'
string|"'reseller_prefix'"
op|':'
string|"''"
op|'}'
op|')'
op|'('
name|'FakeApp'
op|'('
op|')'
op|')'
newline|'\n'
name|'result'
op|'='
name|'ath'
op|'.'
name|'_is_definitive_auth'
op|'('
name|'path'
op|'='
string|"'/v1/test'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'result'
op|','
name|'False'
op|')'
newline|'\n'
name|'result'
op|'='
name|'ath'
op|'.'
name|'_is_definitive_auth'
op|'('
name|'path'
op|'='
string|"'/v1/AUTH_test'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'result'
op|','
name|'False'
op|')'
newline|'\n'
name|'result'
op|'='
name|'ath'
op|'.'
name|'_is_definitive_auth'
op|'('
name|'path'
op|'='
string|"'/v1/BLAH_test'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'result'
op|','
name|'False'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_blank_prefix
dedent|''
name|'def'
name|'test_blank_prefix'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'ath'
op|'='
name|'auth'
op|'.'
name|'filter_factory'
op|'('
op|'{'
string|"'reseller_prefix'"
op|':'
nl|'\n'
string|'" \'\', SOMEOTHER"'
op|'}'
op|')'
op|'('
name|'FakeApp'
op|'('
op|')'
op|')'
newline|'\n'
name|'result'
op|'='
name|'ath'
op|'.'
name|'_is_definitive_auth'
op|'('
name|'path'
op|'='
string|"'/v1/test'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'result'
op|','
name|'False'
op|')'
newline|'\n'
name|'result'
op|'='
name|'ath'
op|'.'
name|'_is_definitive_auth'
op|'('
name|'path'
op|'='
string|"'/v1/SOMEOTHER_test'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'result'
op|','
name|'True'
op|')'
newline|'\n'
name|'result'
op|'='
name|'ath'
op|'.'
name|'_is_definitive_auth'
op|'('
name|'path'
op|'='
string|"'/v1/SOMEOTHERtest'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'result'
op|','
name|'False'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_default_prefix
dedent|''
name|'def'
name|'test_default_prefix'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'ath'
op|'='
name|'auth'
op|'.'
name|'filter_factory'
op|'('
op|'{'
op|'}'
op|')'
op|'('
name|'FakeApp'
op|'('
op|')'
op|')'
newline|'\n'
name|'result'
op|'='
name|'ath'
op|'.'
name|'_is_definitive_auth'
op|'('
name|'path'
op|'='
string|"'/v1/AUTH_test'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'result'
op|','
name|'True'
op|')'
newline|'\n'
name|'result'
op|'='
name|'ath'
op|'.'
name|'_is_definitive_auth'
op|'('
name|'path'
op|'='
string|"'/v1/BLAH_test'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'result'
op|','
name|'False'
op|')'
newline|'\n'
name|'ath'
op|'='
name|'auth'
op|'.'
name|'filter_factory'
op|'('
op|'{'
string|"'reseller_prefix'"
op|':'
string|"'AUTH'"
op|'}'
op|')'
op|'('
name|'FakeApp'
op|'('
op|')'
op|')'
newline|'\n'
name|'result'
op|'='
name|'ath'
op|'.'
name|'_is_definitive_auth'
op|'('
name|'path'
op|'='
string|"'/v1/AUTH_test'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'result'
op|','
name|'True'
op|')'
newline|'\n'
name|'result'
op|'='
name|'ath'
op|'.'
name|'_is_definitive_auth'
op|'('
name|'path'
op|'='
string|"'/v1/BLAH_test'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'result'
op|','
name|'False'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_multiple_prefixes
dedent|''
name|'def'
name|'test_multiple_prefixes'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'ath'
op|'='
name|'auth'
op|'.'
name|'filter_factory'
op|'('
op|'{'
string|"'reseller_prefix'"
op|':'
nl|'\n'
string|"'AUTH, SOMEOTHER'"
op|'}'
op|')'
op|'('
name|'FakeApp'
op|'('
op|')'
op|')'
newline|'\n'
name|'result'
op|'='
name|'ath'
op|'.'
name|'_is_definitive_auth'
op|'('
name|'path'
op|'='
string|"'/v1/AUTH_test'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'result'
op|','
name|'True'
op|')'
newline|'\n'
name|'result'
op|'='
name|'ath'
op|'.'
name|'_is_definitive_auth'
op|'('
name|'path'
op|'='
string|"'/v1/SOMEOTHER_test'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'result'
op|','
name|'True'
op|')'
newline|'\n'
name|'result'
op|'='
name|'ath'
op|'.'
name|'_is_definitive_auth'
op|'('
name|'path'
op|'='
string|"'/v1/BLAH_test'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'result'
op|','
name|'False'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|TestParseUserCreation
dedent|''
dedent|''
name|'class'
name|'TestParseUserCreation'
op|'('
name|'unittest'
op|'.'
name|'TestCase'
op|')'
op|':'
newline|'\n'
DECL|member|test_parse_user_creation
indent|'    '
name|'def'
name|'test_parse_user_creation'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'auth_filter'
op|'='
name|'auth'
op|'.'
name|'filter_factory'
op|'('
op|'{'
nl|'\n'
string|"'reseller_prefix'"
op|':'
string|"'ABC'"
op|','
nl|'\n'
string|"'user_test_tester3'"
op|':'
string|"'testing'"
op|','
nl|'\n'
string|"'user_has_url'"
op|':'
string|"'urlly .admin http://a.b/v1/DEF_has'"
op|','
nl|'\n'
string|"'user_admin_admin'"
op|':'
string|"'admin .admin .reseller_admin'"
op|','
nl|'\n'
op|'}'
op|')'
op|'('
name|'FakeApp'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'auth_filter'
op|'.'
name|'users'
op|','
op|'{'
nl|'\n'
string|"'admin:admin'"
op|':'
op|'{'
nl|'\n'
string|"'url'"
op|':'
string|"'$HOST/v1/ABC_admin'"
op|','
nl|'\n'
string|"'groups'"
op|':'
op|'['
string|"'.admin'"
op|','
string|"'.reseller_admin'"
op|']'
op|','
nl|'\n'
string|"'key'"
op|':'
string|"'admin'"
nl|'\n'
op|'}'
op|','
string|"'test:tester3'"
op|':'
op|'{'
nl|'\n'
string|"'url'"
op|':'
string|"'$HOST/v1/ABC_test'"
op|','
nl|'\n'
string|"'groups'"
op|':'
op|'['
op|']'
op|','
nl|'\n'
string|"'key'"
op|':'
string|"'testing'"
nl|'\n'
op|'}'
op|','
string|"'has:url'"
op|':'
op|'{'
nl|'\n'
string|"'url'"
op|':'
string|"'http://a.b/v1/DEF_has'"
op|','
nl|'\n'
string|"'groups'"
op|':'
op|'['
string|"'.admin'"
op|']'
op|','
nl|'\n'
string|"'key'"
op|':'
string|"'urlly'"
nl|'\n'
op|'}'
op|','
nl|'\n'
op|'}'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_base64_encoding
dedent|''
name|'def'
name|'test_base64_encoding'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'auth_filter'
op|'='
name|'auth'
op|'.'
name|'filter_factory'
op|'('
op|'{'
nl|'\n'
string|"'reseller_prefix'"
op|':'
string|"'ABC'"
op|','
nl|'\n'
string|"'user64_%s_%s'"
op|'%'
op|'('
nl|'\n'
name|'b64encode'
op|'('
string|"'test'"
op|')'
op|'.'
name|'rstrip'
op|'('
string|"'='"
op|')'
op|','
nl|'\n'
name|'b64encode'
op|'('
string|"'tester3'"
op|')'
op|'.'
name|'rstrip'
op|'('
string|"'='"
op|')'
op|')'
op|':'
nl|'\n'
string|"'testing .reseller_admin'"
op|','
nl|'\n'
string|"'user64_%s_%s'"
op|'%'
op|'('
nl|'\n'
name|'b64encode'
op|'('
string|"'user_foo'"
op|')'
op|'.'
name|'rstrip'
op|'('
string|"'='"
op|')'
op|','
nl|'\n'
name|'b64encode'
op|'('
string|"'ab'"
op|')'
op|'.'
name|'rstrip'
op|'('
string|"'='"
op|')'
op|')'
op|':'
nl|'\n'
string|"'urlly .admin http://a.b/v1/DEF_has'"
op|','
nl|'\n'
op|'}'
op|')'
op|'('
name|'FakeApp'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'auth_filter'
op|'.'
name|'users'
op|','
op|'{'
nl|'\n'
string|"'test:tester3'"
op|':'
op|'{'
nl|'\n'
string|"'url'"
op|':'
string|"'$HOST/v1/ABC_test'"
op|','
nl|'\n'
string|"'groups'"
op|':'
op|'['
string|"'.reseller_admin'"
op|']'
op|','
nl|'\n'
string|"'key'"
op|':'
string|"'testing'"
nl|'\n'
op|'}'
op|','
string|"'user_foo:ab'"
op|':'
op|'{'
nl|'\n'
string|"'url'"
op|':'
string|"'http://a.b/v1/DEF_has'"
op|','
nl|'\n'
string|"'groups'"
op|':'
op|'['
string|"'.admin'"
op|']'
op|','
nl|'\n'
string|"'key'"
op|':'
string|"'urlly'"
nl|'\n'
op|'}'
op|','
nl|'\n'
op|'}'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_key_with_no_value
dedent|''
name|'def'
name|'test_key_with_no_value'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ValueError'
op|','
name|'auth'
op|'.'
name|'filter_factory'
op|'('
op|'{'
nl|'\n'
string|"'user_test_tester3'"
op|':'
string|"'testing'"
op|','
nl|'\n'
string|"'user_bob_bobby'"
op|':'
string|"''"
op|','
nl|'\n'
string|"'user_admin_admin'"
op|':'
string|"'admin .admin .reseller_admin'"
op|','
nl|'\n'
op|'}'
op|')'
op|','
name|'FakeApp'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|TestAccountAcls
dedent|''
dedent|''
name|'class'
name|'TestAccountAcls'
op|'('
name|'unittest'
op|'.'
name|'TestCase'
op|')'
op|':'
newline|'\n'
indent|'    '
string|'"""\n    These tests use a single reseller prefix (AUTH_) and the\n    target paths are /v1/AUTH_<blah>\n    """'
newline|'\n'
nl|'\n'
DECL|member|setUp
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'reseller_prefix'
op|'='
op|'{'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'accpre'
op|'='
string|"'AUTH'"
newline|'\n'
nl|'\n'
DECL|member|_make_request
dedent|''
name|'def'
name|'_make_request'
op|'('
name|'self'
op|','
name|'path'
op|','
op|'**'
name|'kwargs'
op|')'
op|':'
newline|'\n'
comment|'# Our TestAccountAcls default request will have a valid auth token'
nl|'\n'
indent|'        '
name|'version'
op|','
name|'acct'
op|','
name|'_'
op|'='
name|'split_path'
op|'('
name|'path'
op|','
number|'1'
op|','
number|'3'
op|','
name|'True'
op|')'
newline|'\n'
name|'headers'
op|'='
name|'kwargs'
op|'.'
name|'pop'
op|'('
string|"'headers'"
op|','
op|'{'
string|"'X-Auth-Token'"
op|':'
string|"'AUTH_t'"
op|'}'
op|')'
newline|'\n'
name|'user_groups'
op|'='
name|'kwargs'
op|'.'
name|'pop'
op|'('
string|"'user_groups'"
op|','
string|"'AUTH_firstacct'"
op|')'
newline|'\n'
nl|'\n'
comment|'# The account being accessed will have account ACLs'
nl|'\n'
name|'acl'
op|'='
op|'{'
string|"'admin'"
op|':'
op|'['
string|"'AUTH_admin'"
op|']'
op|','
string|"'read-write'"
op|':'
op|'['
string|"'AUTH_rw'"
op|']'
op|','
nl|'\n'
string|"'read-only'"
op|':'
op|'['
string|"'AUTH_ro'"
op|']'
op|'}'
newline|'\n'
name|'header_data'
op|'='
op|'{'
string|"'core-access-control'"
op|':'
nl|'\n'
name|'format_acl'
op|'('
name|'version'
op|'='
number|'2'
op|','
name|'acl_dict'
op|'='
name|'acl'
op|')'
op|'}'
newline|'\n'
name|'acls'
op|'='
name|'kwargs'
op|'.'
name|'pop'
op|'('
string|"'acls'"
op|','
name|'header_data'
op|')'
newline|'\n'
nl|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
name|'path'
op|','
name|'headers'
op|'='
name|'headers'
op|','
op|'**'
name|'kwargs'
op|')'
newline|'\n'
nl|'\n'
comment|"# Authorize the token by populating the request's cache"
nl|'\n'
name|'req'
op|'.'
name|'environ'
op|'['
string|"'swift.cache'"
op|']'
op|'='
name|'FakeMemcache'
op|'('
op|')'
newline|'\n'
name|'cache_key'
op|'='
string|"'AUTH_/token/AUTH_t'"
newline|'\n'
name|'cache_entry'
op|'='
op|'('
name|'time'
op|'('
op|')'
op|'+'
number|'3600'
op|','
name|'user_groups'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'environ'
op|'['
string|"'swift.cache'"
op|']'
op|'.'
name|'set'
op|'('
name|'cache_key'
op|','
name|'cache_entry'
op|')'
newline|'\n'
nl|'\n'
comment|'# Pretend get_account_info returned ACLs in sysmeta, and we cached that'
nl|'\n'
name|'cache_key'
op|'='
string|"'account/%s'"
op|'%'
name|'acct'
newline|'\n'
name|'cache_entry'
op|'='
op|'{'
string|"'sysmeta'"
op|':'
name|'acls'
op|'}'
newline|'\n'
name|'req'
op|'.'
name|'environ'
op|'['
string|"'swift.cache'"
op|']'
op|'.'
name|'set'
op|'('
name|'cache_key'
op|','
name|'cache_entry'
op|')'
newline|'\n'
nl|'\n'
name|'return'
name|'req'
newline|'\n'
nl|'\n'
DECL|member|_conf
dedent|''
name|'def'
name|'_conf'
op|'('
name|'self'
op|','
name|'moreconf'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'conf'
op|'='
name|'self'
op|'.'
name|'reseller_prefix'
newline|'\n'
name|'conf'
op|'.'
name|'update'
op|'('
name|'moreconf'
op|')'
newline|'\n'
name|'return'
name|'conf'
newline|'\n'
nl|'\n'
DECL|member|test_account_acl_success
dedent|''
name|'def'
name|'test_account_acl_success'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'test_auth'
op|'='
name|'auth'
op|'.'
name|'filter_factory'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'_conf'
op|'('
op|'{'
string|"'user_admin_user'"
op|':'
string|"'testing'"
op|'}'
op|')'
op|')'
op|'('
nl|'\n'
name|'FakeApp'
op|'('
name|'iter'
op|'('
name|'NO_CONTENT_RESP'
op|'*'
number|'1'
op|')'
op|')'
op|')'
newline|'\n'
nl|'\n'
comment|'# admin (not a swift admin) wants to read from otheracct'
nl|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/v1/%s_otheract'"
op|'%'
name|'self'
op|'.'
name|'accpre'
op|','
nl|'\n'
name|'user_groups'
op|'='
string|'"AUTH_admin"'
op|')'
newline|'\n'
nl|'\n'
comment|'# The request returned by _make_request should be allowed'
nl|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'204'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_account_acl_failures
dedent|''
name|'def'
name|'test_account_acl_failures'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'test_auth'
op|'='
name|'auth'
op|'.'
name|'filter_factory'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'_conf'
op|'('
op|'{'
string|"'user_admin_user'"
op|':'
string|"'testing'"
op|'}'
op|')'
op|')'
op|'('
nl|'\n'
name|'FakeApp'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
comment|"# If I'm not authed as anyone on the ACLs, I shouldn't get in"
nl|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/v1/%s_otheract'"
op|'%'
name|'self'
op|'.'
name|'accpre'
op|','
nl|'\n'
name|'user_groups'
op|'='
string|'"AUTH_bob"'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'403'
op|')'
newline|'\n'
nl|'\n'
comment|"# If the target account has no ACLs, a non-owner shouldn't get in"
nl|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/v1/%s_otheract'"
op|'%'
name|'self'
op|'.'
name|'accpre'
op|','
nl|'\n'
name|'user_groups'
op|'='
string|'"AUTH_admin"'
op|','
nl|'\n'
name|'acls'
op|'='
op|'{'
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'403'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_admin_privileges
dedent|''
name|'def'
name|'test_admin_privileges'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'test_auth'
op|'='
name|'auth'
op|'.'
name|'filter_factory'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'_conf'
op|'('
op|'{'
string|"'user_admin_user'"
op|':'
string|"'testing'"
op|'}'
op|')'
op|')'
op|'('
nl|'\n'
name|'FakeApp'
op|'('
name|'iter'
op|'('
name|'NO_CONTENT_RESP'
op|'*'
number|'18'
op|')'
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'for'
name|'target'
name|'in'
op|'('
nl|'\n'
string|"'/v1/%s_otheracct'"
op|'%'
name|'self'
op|'.'
name|'accpre'
op|','
nl|'\n'
string|"'/v1/%s_otheracct/container'"
op|'%'
name|'self'
op|'.'
name|'accpre'
op|','
nl|'\n'
string|"'/v1/%s_otheracct/container/obj'"
op|'%'
name|'self'
op|'.'
name|'accpre'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'for'
name|'method'
name|'in'
op|'('
string|"'GET'"
op|','
string|"'HEAD'"
op|','
string|"'OPTIONS'"
op|','
string|"'PUT'"
op|','
string|"'POST'"
op|','
string|"'DELETE'"
op|')'
op|':'
newline|'\n'
comment|'# Admin ACL user can do anything'
nl|'\n'
indent|'                '
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
name|'target'
op|','
name|'user_groups'
op|'='
string|'"AUTH_admin"'
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
name|'method'
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'204'
op|')'
newline|'\n'
nl|'\n'
comment|'# swift_owner should be set to True'
nl|'\n'
name|'if'
name|'method'
op|'!='
string|"'OPTIONS'"
op|':'
newline|'\n'
indent|'                    '
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'req'
op|'.'
name|'environ'
op|'.'
name|'get'
op|'('
string|"'swift_owner'"
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_readwrite_privileges
dedent|''
dedent|''
dedent|''
dedent|''
name|'def'
name|'test_readwrite_privileges'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'test_auth'
op|'='
name|'auth'
op|'.'
name|'filter_factory'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'_conf'
op|'('
op|'{'
string|"'user_rw_user'"
op|':'
string|"'testing'"
op|'}'
op|')'
op|')'
op|'('
nl|'\n'
name|'FakeApp'
op|'('
name|'iter'
op|'('
name|'NO_CONTENT_RESP'
op|'*'
number|'15'
op|')'
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'for'
name|'target'
name|'in'
op|'('
string|"'/v1/%s_otheracct'"
op|'%'
name|'self'
op|'.'
name|'accpre'
op|','
op|')'
op|':'
newline|'\n'
indent|'            '
name|'for'
name|'method'
name|'in'
op|'('
string|"'GET'"
op|','
string|"'HEAD'"
op|','
string|"'OPTIONS'"
op|')'
op|':'
newline|'\n'
comment|'# Read-Write user can read account data'
nl|'\n'
indent|'                '
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
name|'target'
op|','
name|'user_groups'
op|'='
string|'"AUTH_rw"'
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
name|'method'
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'204'
op|')'
newline|'\n'
nl|'\n'
comment|'# swift_owner should NOT be set to True'
nl|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'req'
op|'.'
name|'environ'
op|'.'
name|'get'
op|'('
string|"'swift_owner'"
op|')'
op|')'
newline|'\n'
nl|'\n'
comment|'# RW user should NOT be able to PUT, POST, or DELETE to the account'
nl|'\n'
dedent|''
name|'for'
name|'method'
name|'in'
op|'('
string|"'PUT'"
op|','
string|"'POST'"
op|','
string|"'DELETE'"
op|')'
op|':'
newline|'\n'
indent|'                '
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
name|'target'
op|','
name|'user_groups'
op|'='
string|'"AUTH_rw"'
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
name|'method'
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'403'
op|')'
newline|'\n'
nl|'\n'
comment|'# RW user should be able to GET, PUT, POST, or DELETE to containers'
nl|'\n'
comment|'# and objects'
nl|'\n'
dedent|''
dedent|''
name|'for'
name|'target'
name|'in'
op|'('
string|"'/v1/%s_otheracct/c'"
op|'%'
name|'self'
op|'.'
name|'accpre'
op|','
nl|'\n'
string|"'/v1/%s_otheracct/c/o'"
op|'%'
name|'self'
op|'.'
name|'accpre'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'for'
name|'method'
name|'in'
op|'('
string|"'GET'"
op|','
string|"'HEAD'"
op|','
string|"'OPTIONS'"
op|','
string|"'PUT'"
op|','
string|"'POST'"
op|','
string|"'DELETE'"
op|')'
op|':'
newline|'\n'
indent|'                '
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
name|'target'
op|','
name|'user_groups'
op|'='
string|'"AUTH_rw"'
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
name|'method'
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'204'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_readonly_privileges
dedent|''
dedent|''
dedent|''
name|'def'
name|'test_readonly_privileges'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'test_auth'
op|'='
name|'auth'
op|'.'
name|'filter_factory'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'_conf'
op|'('
op|'{'
string|"'user_ro_user'"
op|':'
string|"'testing'"
op|'}'
op|')'
op|')'
op|'('
nl|'\n'
name|'FakeApp'
op|'('
name|'iter'
op|'('
name|'NO_CONTENT_RESP'
op|'*'
number|'9'
op|')'
op|')'
op|')'
newline|'\n'
nl|'\n'
comment|'# ReadOnly user should NOT be able to PUT, POST, or DELETE to account,'
nl|'\n'
comment|'# container, or object'
nl|'\n'
name|'for'
name|'target'
name|'in'
op|'('
string|"'/v1/%s_otheracct'"
op|'%'
name|'self'
op|'.'
name|'accpre'
op|','
nl|'\n'
string|"'/v1/%s_otheracct/cont'"
op|'%'
name|'self'
op|'.'
name|'accpre'
op|','
nl|'\n'
string|"'/v1/%s_otheracct/cont/obj'"
op|'%'
name|'self'
op|'.'
name|'accpre'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'for'
name|'method'
name|'in'
op|'('
string|"'GET'"
op|','
string|"'HEAD'"
op|','
string|"'OPTIONS'"
op|')'
op|':'
newline|'\n'
indent|'                '
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
name|'target'
op|','
name|'user_groups'
op|'='
string|'"AUTH_ro"'
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
name|'method'
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'204'
op|')'
newline|'\n'
comment|'# swift_owner should NOT be set to True for the ReadOnly ACL'
nl|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'req'
op|'.'
name|'environ'
op|'.'
name|'get'
op|'('
string|"'swift_owner'"
op|')'
op|')'
newline|'\n'
dedent|''
name|'for'
name|'method'
name|'in'
op|'('
string|"'PUT'"
op|','
string|"'POST'"
op|','
string|"'DELETE'"
op|')'
op|':'
newline|'\n'
indent|'                '
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
name|'target'
op|','
name|'user_groups'
op|'='
string|'"AUTH_ro"'
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
name|'method'
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'403'
op|')'
newline|'\n'
comment|'# swift_owner should NOT be set to True for the ReadOnly ACL'
nl|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'req'
op|'.'
name|'environ'
op|'.'
name|'get'
op|'('
string|"'swift_owner'"
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_user_gets_best_acl
dedent|''
dedent|''
dedent|''
name|'def'
name|'test_user_gets_best_acl'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'test_auth'
op|'='
name|'auth'
op|'.'
name|'filter_factory'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'_conf'
op|'('
op|'{'
string|"'user_acct_username'"
op|':'
string|"'testing'"
op|'}'
op|')'
op|')'
op|'('
nl|'\n'
name|'FakeApp'
op|'('
name|'iter'
op|'('
name|'NO_CONTENT_RESP'
op|'*'
number|'18'
op|')'
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'mygroups'
op|'='
string|'"AUTH_acct,AUTH_ro,AUTH_something,AUTH_admin"'
newline|'\n'
name|'for'
name|'target'
name|'in'
op|'('
string|"'/v1/%s_otheracct'"
op|'%'
name|'self'
op|'.'
name|'accpre'
op|','
nl|'\n'
string|"'/v1/%s_otheracct/container'"
op|'%'
name|'self'
op|'.'
name|'accpre'
op|','
nl|'\n'
string|"'/v1/%s_otheracct/container/obj'"
op|'%'
name|'self'
op|'.'
name|'accpre'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'for'
name|'method'
name|'in'
op|'('
string|"'GET'"
op|','
string|"'HEAD'"
op|','
string|"'OPTIONS'"
op|','
string|"'PUT'"
op|','
string|"'POST'"
op|','
string|"'DELETE'"
op|')'
op|':'
newline|'\n'
comment|'# Admin ACL user can do anything'
nl|'\n'
indent|'                '
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
name|'target'
op|','
name|'user_groups'
op|'='
name|'mygroups'
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
name|'method'
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
nl|'\n'
name|'resp'
op|'.'
name|'status_int'
op|','
number|'204'
op|','
string|'"%s (%s) - expected 204, got %d"'
op|'%'
nl|'\n'
op|'('
name|'target'
op|','
name|'method'
op|','
name|'resp'
op|'.'
name|'status_int'
op|')'
op|')'
newline|'\n'
nl|'\n'
comment|'# swift_owner should be set to True'
nl|'\n'
name|'if'
name|'method'
op|'!='
string|"'OPTIONS'"
op|':'
newline|'\n'
indent|'                    '
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'req'
op|'.'
name|'environ'
op|'.'
name|'get'
op|'('
string|"'swift_owner'"
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_acl_syntax_verification
dedent|''
dedent|''
dedent|''
dedent|''
name|'def'
name|'test_acl_syntax_verification'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'test_auth'
op|'='
name|'auth'
op|'.'
name|'filter_factory'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'_conf'
op|'('
op|'{'
string|"'user_admin_user'"
op|':'
string|"'testing .admin'"
op|'}'
op|')'
op|')'
op|'('
nl|'\n'
name|'FakeApp'
op|'('
name|'iter'
op|'('
name|'NO_CONTENT_RESP'
op|'*'
number|'5'
op|')'
op|')'
op|')'
newline|'\n'
name|'user_groups'
op|'='
name|'test_auth'
op|'.'
name|'_get_user_groups'
op|'('
string|"'admin'"
op|','
string|"'admin:user'"
op|','
nl|'\n'
string|"'AUTH_admin'"
op|')'
newline|'\n'
name|'good_headers'
op|'='
op|'{'
string|"'X-Auth-Token'"
op|':'
string|"'AUTH_t'"
op|'}'
newline|'\n'
name|'good_acl'
op|'='
name|'json'
op|'.'
name|'dumps'
op|'('
op|'{'
string|'"read-only"'
op|':'
op|'['
string|'u"\xc3\xa1"'
op|','
string|'"b"'
op|']'
op|'}'
op|')'
newline|'\n'
name|'bad_list_types'
op|'='
string|'\'{"read-only": ["a", 99]}\''
newline|'\n'
name|'bad_acl'
op|'='
string|"'syntactically invalid acl -- this does not parse as JSON'"
newline|'\n'
name|'wrong_acl'
op|'='
string|'\'{"other-auth-system":["valid","json","but","wrong"]}\''
newline|'\n'
name|'bad_value_acl'
op|'='
string|'\'{"read-write":["fine"],"admin":"should be a list"}\''
newline|'\n'
name|'not_dict_acl'
op|'='
string|'\'["read-only"]\''
newline|'\n'
name|'not_dict_acl2'
op|'='
number|'1'
newline|'\n'
name|'empty_acls'
op|'='
op|'['
string|"'{}'"
op|','
string|"''"
op|','
string|"'{ }'"
op|']'
newline|'\n'
name|'target'
op|'='
string|"'/v1/%s_firstacct'"
op|'%'
name|'self'
op|'.'
name|'accpre'
newline|'\n'
nl|'\n'
comment|'# no acls -- no problem!'
nl|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
name|'target'
op|','
name|'headers'
op|'='
name|'good_headers'
op|','
nl|'\n'
name|'user_groups'
op|'='
name|'user_groups'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'204'
op|')'
newline|'\n'
nl|'\n'
comment|'# syntactically valid acls should go through'
nl|'\n'
name|'update'
op|'='
op|'{'
string|"'x-account-access-control'"
op|':'
name|'good_acl'
op|'}'
newline|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
name|'target'
op|','
name|'user_groups'
op|'='
name|'user_groups'
op|','
nl|'\n'
name|'headers'
op|'='
name|'dict'
op|'('
name|'good_headers'
op|','
op|'**'
name|'update'
op|')'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'204'
op|','
nl|'\n'
string|"'Expected 204, got %s, response body: %s'"
nl|'\n'
op|'%'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
name|'resp'
op|'.'
name|'body'
op|')'
op|')'
newline|'\n'
nl|'\n'
comment|'# syntactically valid empty acls should go through'
nl|'\n'
name|'for'
name|'acl'
name|'in'
name|'empty_acls'
op|':'
newline|'\n'
indent|'            '
name|'update'
op|'='
op|'{'
string|"'x-account-access-control'"
op|':'
name|'acl'
op|'}'
newline|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
name|'target'
op|','
name|'user_groups'
op|'='
name|'user_groups'
op|','
nl|'\n'
name|'headers'
op|'='
name|'dict'
op|'('
name|'good_headers'
op|','
op|'**'
name|'update'
op|')'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'204'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'errmsg'
op|'='
string|"'X-Account-Access-Control invalid: %s'"
newline|'\n'
comment|'# syntactically invalid acls get a 400'
nl|'\n'
name|'update'
op|'='
op|'{'
string|"'x-account-access-control'"
op|':'
name|'bad_acl'
op|'}'
newline|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
name|'target'
op|','
name|'headers'
op|'='
name|'dict'
op|'('
name|'good_headers'
op|','
op|'**'
name|'update'
op|')'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'400'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'errmsg'
op|'%'
string|'"Syntax error"'
op|','
name|'resp'
op|'.'
name|'body'
op|'['
op|':'
number|'46'
op|']'
op|')'
newline|'\n'
nl|'\n'
comment|'# syntactically valid acls with bad keys also get a 400'
nl|'\n'
name|'update'
op|'='
op|'{'
string|"'x-account-access-control'"
op|':'
name|'wrong_acl'
op|'}'
newline|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
name|'target'
op|','
name|'headers'
op|'='
name|'dict'
op|'('
name|'good_headers'
op|','
op|'**'
name|'update'
op|')'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'400'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'resp'
op|'.'
name|'body'
op|'.'
name|'startswith'
op|'('
nl|'\n'
name|'errmsg'
op|'%'
string|'"Key \'other-auth-system\' not recognized"'
op|')'
op|','
name|'resp'
op|'.'
name|'body'
op|')'
newline|'\n'
nl|'\n'
comment|'# acls with good keys but bad values also get a 400'
nl|'\n'
name|'update'
op|'='
op|'{'
string|"'x-account-access-control'"
op|':'
name|'bad_value_acl'
op|'}'
newline|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
name|'target'
op|','
name|'headers'
op|'='
name|'dict'
op|'('
name|'good_headers'
op|','
op|'**'
name|'update'
op|')'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'400'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'resp'
op|'.'
name|'body'
op|'.'
name|'startswith'
op|'('
nl|'\n'
name|'errmsg'
op|'%'
string|'"Value for key \'admin\' must be a list"'
op|')'
op|','
name|'resp'
op|'.'
name|'body'
op|')'
newline|'\n'
nl|'\n'
comment|'# acls with non-string-types in list also get a 400'
nl|'\n'
name|'update'
op|'='
op|'{'
string|"'x-account-access-control'"
op|':'
name|'bad_list_types'
op|'}'
newline|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
name|'target'
op|','
name|'headers'
op|'='
name|'dict'
op|'('
name|'good_headers'
op|','
op|'**'
name|'update'
op|')'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'400'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'resp'
op|'.'
name|'body'
op|'.'
name|'startswith'
op|'('
nl|'\n'
name|'errmsg'
op|'%'
string|'"Elements of \'read-only\' list must be strings"'
op|')'
op|','
nl|'\n'
name|'resp'
op|'.'
name|'body'
op|')'
newline|'\n'
nl|'\n'
comment|'# acls with wrong json structure also get a 400'
nl|'\n'
name|'update'
op|'='
op|'{'
string|"'x-account-access-control'"
op|':'
name|'not_dict_acl'
op|'}'
newline|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
name|'target'
op|','
name|'headers'
op|'='
name|'dict'
op|'('
name|'good_headers'
op|','
op|'**'
name|'update'
op|')'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'400'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'errmsg'
op|'%'
string|'"Syntax error"'
op|','
name|'resp'
op|'.'
name|'body'
op|'['
op|':'
number|'46'
op|']'
op|')'
newline|'\n'
nl|'\n'
comment|'# acls with wrong json structure also get a 400'
nl|'\n'
name|'update'
op|'='
op|'{'
string|"'x-account-access-control'"
op|':'
name|'not_dict_acl2'
op|'}'
newline|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
name|'target'
op|','
name|'headers'
op|'='
name|'dict'
op|'('
name|'good_headers'
op|','
op|'**'
name|'update'
op|')'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'400'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'errmsg'
op|'%'
string|'"Syntax error"'
op|','
name|'resp'
op|'.'
name|'body'
op|'['
op|':'
number|'46'
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_acls_propagate_to_sysmeta
dedent|''
name|'def'
name|'test_acls_propagate_to_sysmeta'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'test_auth'
op|'='
name|'auth'
op|'.'
name|'filter_factory'
op|'('
op|'{'
string|"'user_admin_user'"
op|':'
string|"'testing'"
op|'}'
op|')'
op|'('
nl|'\n'
name|'FakeApp'
op|'('
name|'iter'
op|'('
name|'NO_CONTENT_RESP'
op|'*'
number|'3'
op|')'
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'sysmeta_hdr'
op|'='
string|"'x-account-sysmeta-core-access-control'"
newline|'\n'
name|'target'
op|'='
string|"'/v1/AUTH_firstacct'"
newline|'\n'
name|'good_headers'
op|'='
op|'{'
string|"'X-Auth-Token'"
op|':'
string|"'AUTH_t'"
op|'}'
newline|'\n'
name|'good_acl'
op|'='
string|'\'{"read-only":["a","b"]}\''
newline|'\n'
nl|'\n'
comment|'# no acls -- no problem!'
nl|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
name|'target'
op|','
name|'headers'
op|'='
name|'good_headers'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'204'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertIsNone'
op|'('
name|'req'
op|'.'
name|'headers'
op|'.'
name|'get'
op|'('
name|'sysmeta_hdr'
op|')'
op|')'
newline|'\n'
nl|'\n'
comment|'# syntactically valid acls should go through'
nl|'\n'
name|'update'
op|'='
op|'{'
string|"'x-account-access-control'"
op|':'
name|'good_acl'
op|'}'
newline|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
name|'target'
op|','
name|'headers'
op|'='
name|'dict'
op|'('
name|'good_headers'
op|','
op|'**'
name|'update'
op|')'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'204'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'good_acl'
op|','
name|'req'
op|'.'
name|'headers'
op|'.'
name|'get'
op|'('
name|'sysmeta_hdr'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_bad_acls_get_denied
dedent|''
name|'def'
name|'test_bad_acls_get_denied'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'test_auth'
op|'='
name|'auth'
op|'.'
name|'filter_factory'
op|'('
op|'{'
string|"'user_admin_user'"
op|':'
string|"'testing'"
op|'}'
op|')'
op|'('
nl|'\n'
name|'FakeApp'
op|'('
name|'iter'
op|'('
name|'NO_CONTENT_RESP'
op|'*'
number|'3'
op|')'
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'target'
op|'='
string|"'/v1/AUTH_firstacct'"
newline|'\n'
name|'good_headers'
op|'='
op|'{'
string|"'X-Auth-Token'"
op|':'
string|"'AUTH_t'"
op|'}'
newline|'\n'
name|'bad_acls'
op|'='
op|'('
nl|'\n'
string|"'syntax error'"
op|','
nl|'\n'
string|'\'{"bad_key":"should_fail"}\''
op|','
nl|'\n'
string|'\'{"admin":"not a list, should fail"}\''
op|','
nl|'\n'
string|'\'{"admin":["valid"],"read-write":"not a list, should fail"}\''
op|','
nl|'\n'
op|')'
newline|'\n'
nl|'\n'
name|'for'
name|'bad_acl'
name|'in'
name|'bad_acls'
op|':'
newline|'\n'
indent|'            '
name|'hdrs'
op|'='
name|'dict'
op|'('
name|'good_headers'
op|','
op|'**'
op|'{'
string|"'x-account-access-control'"
op|':'
name|'bad_acl'
op|'}'
op|')'
newline|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
name|'target'
op|','
name|'headers'
op|'='
name|'hdrs'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'400'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|TestAuthMultiplePrefixes
dedent|''
dedent|''
dedent|''
name|'class'
name|'TestAuthMultiplePrefixes'
op|'('
name|'TestAccountAcls'
op|')'
op|':'
newline|'\n'
indent|'    '
string|'"""\n    These tests repeat the same tests as TestAccountACLs,\n    but use multiple reseller prefix items (AUTH_ and SOMEOTHER_).\n    The target paths are /v1/SOMEOTHER_<blah>\n    """'
newline|'\n'
nl|'\n'
DECL|member|setUp
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'reseller_prefix'
op|'='
op|'{'
string|"'reseller_prefix'"
op|':'
string|"'AUTH_, SOMEOTHER_'"
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'accpre'
op|'='
string|"'SOMEOTHER'"
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|PrefixAccount
dedent|''
dedent|''
name|'class'
name|'PrefixAccount'
op|'('
name|'unittest'
op|'.'
name|'TestCase'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|member|test_default
indent|'    '
name|'def'
name|'test_default'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'conf'
op|'='
op|'{'
op|'}'
newline|'\n'
name|'test_auth'
op|'='
name|'auth'
op|'.'
name|'filter_factory'
op|'('
name|'conf'
op|')'
op|'('
name|'FakeApp'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'test_auth'
op|'.'
name|'_get_account_prefix'
op|'('
nl|'\n'
string|"'AUTH_1234'"
op|')'
op|','
string|"'AUTH_'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'test_auth'
op|'.'
name|'_get_account_prefix'
op|'('
nl|'\n'
string|"'JUNK_1234'"
op|')'
op|','
name|'None'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_same_as_default
dedent|''
name|'def'
name|'test_same_as_default'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'conf'
op|'='
op|'{'
string|"'reseller_prefix'"
op|':'
string|"'AUTH'"
op|'}'
newline|'\n'
name|'test_auth'
op|'='
name|'auth'
op|'.'
name|'filter_factory'
op|'('
name|'conf'
op|')'
op|'('
name|'FakeApp'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'test_auth'
op|'.'
name|'_get_account_prefix'
op|'('
nl|'\n'
string|"'AUTH_1234'"
op|')'
op|','
string|"'AUTH_'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'test_auth'
op|'.'
name|'_get_account_prefix'
op|'('
nl|'\n'
string|"'JUNK_1234'"
op|')'
op|','
name|'None'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_blank_reseller
dedent|''
name|'def'
name|'test_blank_reseller'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'conf'
op|'='
op|'{'
string|"'reseller_prefix'"
op|':'
string|"''"
op|'}'
newline|'\n'
name|'test_auth'
op|'='
name|'auth'
op|'.'
name|'filter_factory'
op|'('
name|'conf'
op|')'
op|'('
name|'FakeApp'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'test_auth'
op|'.'
name|'_get_account_prefix'
op|'('
nl|'\n'
string|"'1234'"
op|')'
op|','
string|"''"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'test_auth'
op|'.'
name|'_get_account_prefix'
op|'('
nl|'\n'
string|"'JUNK_1234'"
op|')'
op|','
string|"''"
op|')'
comment|"# yes, it should return ''"
newline|'\n'
nl|'\n'
DECL|member|test_multiple_resellers
dedent|''
name|'def'
name|'test_multiple_resellers'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'conf'
op|'='
op|'{'
string|"'reseller_prefix'"
op|':'
string|"'AUTH, PRE2'"
op|'}'
newline|'\n'
name|'test_auth'
op|'='
name|'auth'
op|'.'
name|'filter_factory'
op|'('
name|'conf'
op|')'
op|'('
name|'FakeApp'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'test_auth'
op|'.'
name|'_get_account_prefix'
op|'('
nl|'\n'
string|"'AUTH_1234'"
op|')'
op|','
string|"'AUTH_'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'test_auth'
op|'.'
name|'_get_account_prefix'
op|'('
nl|'\n'
string|"'JUNK_1234'"
op|')'
op|','
name|'None'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|ServiceTokenFunctionality
dedent|''
dedent|''
name|'class'
name|'ServiceTokenFunctionality'
op|'('
name|'unittest'
op|'.'
name|'TestCase'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|member|_make_authed_request
indent|'    '
name|'def'
name|'_make_authed_request'
op|'('
name|'self'
op|','
name|'conf'
op|','
name|'remote_user'
op|','
name|'path'
op|','
name|'method'
op|'='
string|"'GET'"
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Make a request with tempauth as auth\n\n        Acts as though the user had presented a token\n        granting groups as described in remote_user.\n        If remote_user contains the .service group, it emulates presenting\n        X-Service-Token containing a .service group.\n\n        :param conf: configuration for tempauth\n        :param remote_user: the groups the user belongs to. Examples:\n            acct:joe,acct                         user joe, no .admin\n            acct:joe,acct,AUTH_joeacct            user joe, jas .admin group\n            acct:joe,acct,AUTH_joeacct,.service   adds .service group\n        :param path: the path of the request\n        :param method: the method (defaults to GET)\n\n        :returns: response object\n        """'
newline|'\n'
name|'self'
op|'.'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
name|'path'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'req'
op|'.'
name|'method'
op|'='
name|'method'
newline|'\n'
name|'self'
op|'.'
name|'req'
op|'.'
name|'remote_user'
op|'='
name|'remote_user'
newline|'\n'
name|'fake_app'
op|'='
name|'FakeApp'
op|'('
name|'iter'
op|'('
op|'['
op|'('
string|"'200 OK'"
op|','
op|'{'
op|'}'
op|','
string|"''"
op|')'
op|']'
op|')'
op|')'
newline|'\n'
name|'test_auth'
op|'='
name|'auth'
op|'.'
name|'filter_factory'
op|'('
name|'conf'
op|')'
op|'('
name|'fake_app'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'self'
op|'.'
name|'req'
op|'.'
name|'get_response'
op|'('
name|'test_auth'
op|')'
newline|'\n'
name|'return'
name|'resp'
newline|'\n'
nl|'\n'
DECL|member|test_authed_for_path_single
dedent|''
name|'def'
name|'test_authed_for_path_single'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'resp'
op|'='
name|'self'
op|'.'
name|'_make_authed_request'
op|'('
op|'{'
op|'}'
op|','
string|"'acct:joe,acct,AUTH_acct'"
op|','
nl|'\n'
string|"'/v1/AUTH_acct'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'200'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'self'
op|'.'
name|'_make_authed_request'
op|'('
nl|'\n'
op|'{'
string|"'reseller_prefix'"
op|':'
string|"'AUTH'"
op|'}'
op|','
string|"'acct:joe,acct,AUTH_acct'"
op|','
nl|'\n'
string|"'/v1/AUTH_acct/c'"
op|','
name|'method'
op|'='
string|"'PUT'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'200'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'self'
op|'.'
name|'_make_authed_request'
op|'('
nl|'\n'
op|'{'
string|"'reseller_prefix'"
op|':'
string|"'AUTH'"
op|'}'
op|','
nl|'\n'
string|"'admin:mary,admin,AUTH_admin,.reseller_admin'"
op|','
nl|'\n'
string|"'/v1/AUTH_acct'"
op|','
name|'method'
op|'='
string|"'GET'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'200'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'self'
op|'.'
name|'_make_authed_request'
op|'('
nl|'\n'
op|'{'
string|"'reseller_prefix'"
op|':'
string|"'AUTH'"
op|'}'
op|','
nl|'\n'
string|"'admin:mary,admin,AUTH_admin,.reseller_admin'"
op|','
nl|'\n'
string|"'/v1/AUTH_acct'"
op|','
name|'method'
op|'='
string|"'DELETE'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'200'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_denied_for_path_single
dedent|''
name|'def'
name|'test_denied_for_path_single'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'resp'
op|'='
name|'self'
op|'.'
name|'_make_authed_request'
op|'('
nl|'\n'
op|'{'
string|"'reseller_prefix'"
op|':'
string|"'AUTH'"
op|'}'
op|','
nl|'\n'
string|"'fredacc:fred,fredacct,AUTH_fredacc'"
op|','
nl|'\n'
string|"'/v1/AUTH_acct'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'403'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'self'
op|'.'
name|'_make_authed_request'
op|'('
nl|'\n'
op|'{'
string|"'reseller_prefix'"
op|':'
string|"'AUTH'"
op|'}'
op|','
nl|'\n'
string|"'acct:joe,acct'"
op|','
nl|'\n'
string|"'/v1/AUTH_acct'"
op|','
nl|'\n'
name|'method'
op|'='
string|"'PUT'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'403'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'self'
op|'.'
name|'_make_authed_request'
op|'('
nl|'\n'
op|'{'
string|"'reseller_prefix'"
op|':'
string|"'AUTH'"
op|'}'
op|','
nl|'\n'
string|"'acct:joe,acct,AUTH_acct'"
op|','
nl|'\n'
string|"'/v1/AUTH_acct'"
op|','
nl|'\n'
name|'method'
op|'='
string|"'DELETE'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'403'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_authed_for_primary_path_multiple
dedent|''
name|'def'
name|'test_authed_for_primary_path_multiple'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'resp'
op|'='
name|'self'
op|'.'
name|'_make_authed_request'
op|'('
nl|'\n'
op|'{'
string|"'reseller_prefix'"
op|':'
string|"'AUTH, PRE2'"
op|'}'
op|','
nl|'\n'
string|"'acct:joe,acct,AUTH_acct,PRE2_acct'"
op|','
nl|'\n'
string|"'/v1/PRE2_acct'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'200'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_denied_for_second_path_with_only_operator_role
dedent|''
name|'def'
name|'test_denied_for_second_path_with_only_operator_role'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# User only presents a token in X-Auth-Token (or in X-Service-Token)'
nl|'\n'
indent|'        '
name|'resp'
op|'='
name|'self'
op|'.'
name|'_make_authed_request'
op|'('
nl|'\n'
op|'{'
string|"'reseller_prefix'"
op|':'
string|"'AUTH, PRE2'"
op|','
nl|'\n'
string|"'PRE2_require_group'"
op|':'
string|"'.service'"
op|'}'
op|','
nl|'\n'
string|"'acct:joe,acct,AUTH_acct,PRE2_acct'"
op|','
nl|'\n'
string|"'/v1/PRE2_acct'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'403'
op|')'
newline|'\n'
nl|'\n'
comment|'# User puts token in both X-Auth-Token and X-Service-Token'
nl|'\n'
name|'resp'
op|'='
name|'self'
op|'.'
name|'_make_authed_request'
op|'('
nl|'\n'
op|'{'
string|"'reseller_prefix'"
op|':'
string|"'AUTH, PRE2'"
op|','
nl|'\n'
string|"'PRE2_require_group'"
op|':'
string|"'.service'"
op|'}'
op|','
nl|'\n'
string|"'acct:joe,acct,AUTH_acct,PRE2_acct,AUTH_acct,PRE2_acct'"
op|','
nl|'\n'
string|"'/v1/PRE2_acct'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'403'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_authed_for_second_path_with_operator_role_and_service
dedent|''
name|'def'
name|'test_authed_for_second_path_with_operator_role_and_service'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'resp'
op|'='
name|'self'
op|'.'
name|'_make_authed_request'
op|'('
nl|'\n'
op|'{'
string|"'reseller_prefix'"
op|':'
string|"'AUTH, PRE2'"
op|','
nl|'\n'
string|"'PRE2_require_group'"
op|':'
string|"'.service'"
op|'}'
op|','
nl|'\n'
string|"'acct:joe,acct,AUTH_acct,PRE2_acct,'"
nl|'\n'
string|"'admin:mary,admin,AUTH_admin,PRE2_admin,.service'"
op|','
nl|'\n'
string|"'/v1/PRE2_acct'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'200'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_denied_for_second_path_with_only_service
dedent|''
name|'def'
name|'test_denied_for_second_path_with_only_service'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'resp'
op|'='
name|'self'
op|'.'
name|'_make_authed_request'
op|'('
nl|'\n'
op|'{'
string|"'reseller_prefix'"
op|':'
string|"'AUTH, PRE2'"
op|','
nl|'\n'
string|"'PRE2_require_group'"
op|':'
string|"'.service'"
op|'}'
op|','
nl|'\n'
string|"'admin:mary,admin,AUTH_admin,PRE2_admin,.service'"
op|','
nl|'\n'
string|"'/v1/PRE2_acct'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'403'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_denied_for_second_path_for_service_user
dedent|''
name|'def'
name|'test_denied_for_second_path_for_service_user'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|"# User presents token with 'service' role in X-Auth-Token"
nl|'\n'
indent|'        '
name|'resp'
op|'='
name|'self'
op|'.'
name|'_make_authed_request'
op|'('
nl|'\n'
op|'{'
string|"'reseller_prefix'"
op|':'
string|"'AUTH, PRE2'"
op|','
nl|'\n'
string|"'PRE2_require_group'"
op|':'
string|"'.service'"
op|'}'
op|','
nl|'\n'
string|"'admin:mary,admin,AUTH_admin,PRE2_admin,.service'"
op|','
nl|'\n'
string|"'/v1/PRE2_acct'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'403'
op|')'
newline|'\n'
nl|'\n'
comment|"# User presents token with 'service' role in X-Auth-Token"
nl|'\n'
comment|'# and also in X-Service-Token'
nl|'\n'
name|'resp'
op|'='
name|'self'
op|'.'
name|'_make_authed_request'
op|'('
nl|'\n'
op|'{'
string|"'reseller_prefix'"
op|':'
string|"'AUTH, PRE2'"
op|','
nl|'\n'
string|"'PRE2_require_group'"
op|':'
string|"'.service'"
op|'}'
op|','
nl|'\n'
string|"'admin:mary,admin,AUTH_admin,PRE2_admin,.service,'"
nl|'\n'
string|"'admin:mary,admin,AUTH_admin,PRE2_admin,.service'"
op|','
nl|'\n'
string|"'/v1/PRE2_acct'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'403'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_delete_denied_for_second_path
dedent|''
name|'def'
name|'test_delete_denied_for_second_path'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'resp'
op|'='
name|'self'
op|'.'
name|'_make_authed_request'
op|'('
nl|'\n'
op|'{'
string|"'reseller_prefix'"
op|':'
string|"'AUTH, PRE2'"
op|','
nl|'\n'
string|"'PRE2_require_group'"
op|':'
string|"'.service'"
op|'}'
op|','
nl|'\n'
string|"'acct:joe,acct,AUTH_acct,PRE2_acct,'"
nl|'\n'
string|"'admin:mary,admin,AUTH_admin,PRE2_admin,.service'"
op|','
nl|'\n'
string|"'/v1/PRE2_acct'"
op|','
nl|'\n'
name|'method'
op|'='
string|"'DELETE'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'403'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_delete_of_second_path_by_reseller_admin
dedent|''
name|'def'
name|'test_delete_of_second_path_by_reseller_admin'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'resp'
op|'='
name|'self'
op|'.'
name|'_make_authed_request'
op|'('
nl|'\n'
op|'{'
string|"'reseller_prefix'"
op|':'
string|"'AUTH, PRE2'"
op|','
nl|'\n'
string|"'PRE2_require_group'"
op|':'
string|"'.service'"
op|'}'
op|','
nl|'\n'
string|"'acct:joe,acct,AUTH_acct,PRE2_acct,'"
nl|'\n'
string|"'admin:mary,admin,AUTH_admin,PRE2_admin,.reseller_admin'"
op|','
nl|'\n'
string|"'/v1/PRE2_acct'"
op|','
nl|'\n'
name|'method'
op|'='
string|"'DELETE'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'200'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|TestTokenHandling
dedent|''
dedent|''
name|'class'
name|'TestTokenHandling'
op|'('
name|'unittest'
op|'.'
name|'TestCase'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|member|_make_request
indent|'    '
name|'def'
name|'_make_request'
op|'('
name|'self'
op|','
name|'conf'
op|','
name|'path'
op|','
name|'headers'
op|','
name|'method'
op|'='
string|"'GET'"
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Make a request with tempauth as auth\n\n        It sets up AUTH_t and AUTH_s as tokens in memcache, where "joe"\n        has .admin role on /v1/AUTH_acct and user "glance" has .service\n        role on /v1/AUTH_admin.\n\n        :param conf: configuration for tempauth\n        :param path: the path of the request\n        :param headers: allows you to pass X-Auth-Token, etc.\n        :param method: the method (defaults to GET)\n\n        :returns: response object\n        """'
newline|'\n'
name|'fake_app'
op|'='
name|'FakeApp'
op|'('
name|'iter'
op|'('
op|'['
op|'('
string|"'200 OK'"
op|','
op|'{'
op|'}'
op|','
string|"''"
op|')'
op|']'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'test_auth'
op|'='
name|'auth'
op|'.'
name|'filter_factory'
op|'('
name|'conf'
op|')'
op|'('
name|'fake_app'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
name|'path'
op|','
name|'headers'
op|'='
name|'headers'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'req'
op|'.'
name|'method'
op|'='
name|'method'
newline|'\n'
name|'self'
op|'.'
name|'req'
op|'.'
name|'environ'
op|'['
string|"'swift.cache'"
op|']'
op|'='
name|'FakeMemcache'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_setup_user_and_token'
op|'('
string|"'AUTH_t'"
op|','
string|"'acct'"
op|','
string|"'acct:joe'"
op|','
nl|'\n'
string|"'.admin'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_setup_user_and_token'
op|'('
string|"'AUTH_s'"
op|','
string|"'admin'"
op|','
string|"'admin:glance'"
op|','
nl|'\n'
string|"'.service'"
op|')'
newline|'\n'
name|'resp'
op|'='
name|'self'
op|'.'
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|')'
newline|'\n'
name|'return'
name|'resp'
newline|'\n'
nl|'\n'
DECL|member|_setup_user_and_token
dedent|''
name|'def'
name|'_setup_user_and_token'
op|'('
name|'self'
op|','
name|'token_name'
op|','
name|'account'
op|','
name|'account_user'
op|','
nl|'\n'
name|'groups'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Setup named token in memcache\n\n        :param token_name: name of token\n        :param account: example: acct\n        :param account_user: example: acct_joe\n        :param groups: example: .admin\n        """'
newline|'\n'
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'users'
op|'['
name|'account_user'
op|']'
op|'='
name|'dict'
op|'('
name|'groups'
op|'='
op|'['
name|'groups'
op|']'
op|')'
newline|'\n'
name|'account_id'
op|'='
string|"'AUTH_%s'"
op|'%'
name|'account'
newline|'\n'
name|'cache_key'
op|'='
string|"'AUTH_/token/%s'"
op|'%'
name|'token_name'
newline|'\n'
name|'cache_entry'
op|'='
op|'('
name|'time'
op|'('
op|')'
op|'+'
number|'3600'
op|','
nl|'\n'
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'_get_user_groups'
op|'('
name|'account'
op|','
nl|'\n'
name|'account_user'
op|','
nl|'\n'
name|'account_id'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'req'
op|'.'
name|'environ'
op|'['
string|"'swift.cache'"
op|']'
op|'.'
name|'set'
op|'('
name|'cache_key'
op|','
name|'cache_entry'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_tokens_set_remote_user
dedent|''
name|'def'
name|'test_tokens_set_remote_user'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'conf'
op|'='
op|'{'
op|'}'
comment|'# Default conf'
newline|'\n'
name|'resp'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
name|'conf'
op|','
string|"'/v1/AUTH_acct'"
op|','
nl|'\n'
op|'{'
string|"'x-auth-token'"
op|':'
string|"'AUTH_t'"
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'self'
op|'.'
name|'req'
op|'.'
name|'environ'
op|'['
string|"'REMOTE_USER'"
op|']'
op|','
nl|'\n'
string|"'acct,acct:joe,AUTH_acct'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'200'
op|')'
newline|'\n'
comment|'# Add x-service-token'
nl|'\n'
name|'resp'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
name|'conf'
op|','
string|"'/v1/AUTH_acct'"
op|','
nl|'\n'
op|'{'
string|"'x-auth-token'"
op|':'
string|"'AUTH_t'"
op|','
nl|'\n'
string|"'x-service-token'"
op|':'
string|"'AUTH_s'"
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'self'
op|'.'
name|'req'
op|'.'
name|'environ'
op|'['
string|"'REMOTE_USER'"
op|']'
op|','
nl|'\n'
string|"'acct,acct:joe,AUTH_acct,admin,admin:glance,.service'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'200'
op|')'
newline|'\n'
comment|'# Put x-auth-token value into x-service-token'
nl|'\n'
name|'resp'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
name|'conf'
op|','
string|"'/v1/AUTH_acct'"
op|','
nl|'\n'
op|'{'
string|"'x-auth-token'"
op|':'
string|"'AUTH_t'"
op|','
nl|'\n'
string|"'x-service-token'"
op|':'
string|"'AUTH_t'"
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'self'
op|'.'
name|'req'
op|'.'
name|'environ'
op|'['
string|"'REMOTE_USER'"
op|']'
op|','
nl|'\n'
string|"'acct,acct:joe,AUTH_acct,acct,acct:joe,AUTH_acct'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'200'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_service_token_given_and_needed
dedent|''
name|'def'
name|'test_service_token_given_and_needed'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'conf'
op|'='
op|'{'
string|"'reseller_prefix'"
op|':'
string|"'AUTH, PRE2'"
op|','
nl|'\n'
string|"'PRE2_require_group'"
op|':'
string|"'.service'"
op|'}'
newline|'\n'
name|'resp'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
name|'conf'
op|','
string|"'/v1/PRE2_acct'"
op|','
nl|'\n'
op|'{'
string|"'x-auth-token'"
op|':'
string|"'AUTH_t'"
op|','
nl|'\n'
string|"'x-service-token'"
op|':'
string|"'AUTH_s'"
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'200'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_service_token_omitted
dedent|''
name|'def'
name|'test_service_token_omitted'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'conf'
op|'='
op|'{'
string|"'reseller_prefix'"
op|':'
string|"'AUTH, PRE2'"
op|','
nl|'\n'
string|"'PRE2_require_group'"
op|':'
string|"'.service'"
op|'}'
newline|'\n'
name|'resp'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
name|'conf'
op|','
string|"'/v1/PRE2_acct'"
op|','
nl|'\n'
op|'{'
string|"'x-auth-token'"
op|':'
string|"'AUTH_t'"
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'403'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_invalid_tokens
dedent|''
name|'def'
name|'test_invalid_tokens'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'conf'
op|'='
op|'{'
string|"'reseller_prefix'"
op|':'
string|"'AUTH, PRE2'"
op|','
nl|'\n'
string|"'PRE2_require_group'"
op|':'
string|"'.service'"
op|'}'
newline|'\n'
name|'resp'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
name|'conf'
op|','
string|"'/v1/PRE2_acct'"
op|','
nl|'\n'
op|'{'
string|"'x-auth-token'"
op|':'
string|"'AUTH_junk'"
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'401'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
name|'conf'
op|','
string|"'/v1/PRE2_acct'"
op|','
nl|'\n'
op|'{'
string|"'x-auth-token'"
op|':'
string|"'AUTH_t'"
op|','
nl|'\n'
string|"'x-service-token'"
op|':'
string|"'AUTH_junk'"
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'403'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
name|'conf'
op|','
string|"'/v1/PRE2_acct'"
op|','
nl|'\n'
op|'{'
string|"'x-auth-token'"
op|':'
string|"'AUTH_junk'"
op|','
nl|'\n'
string|"'x-service-token'"
op|':'
string|"'AUTH_s'"
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'401'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|TestUtilityMethods
dedent|''
dedent|''
name|'class'
name|'TestUtilityMethods'
op|'('
name|'unittest'
op|'.'
name|'TestCase'
op|')'
op|':'
newline|'\n'
DECL|member|test_account_acls_bad_path_raises_exception
indent|'    '
name|'def'
name|'test_account_acls_bad_path_raises_exception'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'auth_inst'
op|'='
name|'auth'
op|'.'
name|'filter_factory'
op|'('
op|'{'
op|'}'
op|')'
op|'('
name|'FakeApp'
op|'('
op|')'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'('
op|'{'
string|"'PATH_INFO'"
op|':'
string|"'/'"
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ValueError'
op|','
name|'auth_inst'
op|'.'
name|'account_acls'
op|','
name|'req'
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'if'
name|'__name__'
op|'=='
string|"'__main__'"
op|':'
newline|'\n'
indent|'    '
name|'unittest'
op|'.'
name|'main'
op|'('
op|')'
newline|'\n'
dedent|''
endmarker|''
end_unit
