begin_unit
comment|'# Copyright (c) 2014 Christian Schwede <christian.schwede@enovance.com>'
nl|'\n'
comment|'#'
nl|'\n'
comment|'# Licensed under the Apache License, Version 2.0 (the "License");'
nl|'\n'
comment|'# you may not use this file except in compliance with the License.'
nl|'\n'
comment|'# You may obtain a copy of the License at'
nl|'\n'
comment|'#'
nl|'\n'
comment|'#    http://www.apache.org/licenses/LICENSE-2.0'
nl|'\n'
comment|'#'
nl|'\n'
comment|'# Unless required by applicable law or agreed to in writing, software'
nl|'\n'
comment|'# distributed under the License is distributed on an "AS IS" BASIS,'
nl|'\n'
comment|'# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or'
nl|'\n'
comment|'# implied.'
nl|'\n'
comment|'# See the License for the specific language governing permissions and'
nl|'\n'
comment|'# limitations under the License.'
nl|'\n'
nl|'\n'
name|'import'
name|'logging'
newline|'\n'
name|'import'
name|'mock'
newline|'\n'
name|'import'
name|'os'
newline|'\n'
name|'import'
name|'six'
newline|'\n'
name|'import'
name|'tempfile'
newline|'\n'
name|'import'
name|'unittest'
newline|'\n'
name|'import'
name|'uuid'
newline|'\n'
name|'import'
name|'shlex'
newline|'\n'
nl|'\n'
name|'from'
name|'swift'
op|'.'
name|'cli'
name|'import'
name|'ringbuilder'
newline|'\n'
name|'from'
name|'swift'
op|'.'
name|'common'
name|'import'
name|'exceptions'
newline|'\n'
name|'from'
name|'swift'
op|'.'
name|'common'
op|'.'
name|'ring'
name|'import'
name|'RingBuilder'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|RunSwiftRingBuilderMixin
name|'class'
name|'RunSwiftRingBuilderMixin'
op|'('
name|'object'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|member|run_srb
indent|'    '
name|'def'
name|'run_srb'
op|'('
name|'self'
op|','
op|'*'
name|'argv'
op|','
op|'**'
name|'kwargs'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'len'
op|'('
name|'argv'
op|')'
op|'=='
number|'1'
name|'and'
name|'isinstance'
op|'('
name|'argv'
op|'['
number|'0'
op|']'
op|','
name|'six'
op|'.'
name|'string_types'
op|')'
op|':'
newline|'\n'
comment|'# convert a single string to a list'
nl|'\n'
indent|'            '
name|'argv'
op|'='
name|'shlex'
op|'.'
name|'split'
op|'('
name|'argv'
op|'['
number|'0'
op|']'
op|')'
newline|'\n'
dedent|''
name|'mock_stdout'
op|'='
name|'six'
op|'.'
name|'StringIO'
op|'('
op|')'
newline|'\n'
name|'mock_stderr'
op|'='
name|'six'
op|'.'
name|'StringIO'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'if'
string|"'exp_results'"
name|'in'
name|'kwargs'
op|':'
newline|'\n'
indent|'            '
name|'exp_results'
op|'='
name|'kwargs'
op|'['
string|"'exp_results'"
op|']'
newline|'\n'
name|'argv'
op|'='
name|'argv'
op|'['
op|':'
op|'-'
number|'1'
op|']'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'exp_results'
op|'='
name|'None'
newline|'\n'
nl|'\n'
dedent|''
name|'srb_args'
op|'='
op|'['
string|'""'
op|','
name|'self'
op|'.'
name|'tempfile'
op|']'
op|'+'
op|'['
name|'str'
op|'('
name|'s'
op|')'
name|'for'
name|'s'
name|'in'
name|'argv'
op|']'
newline|'\n'
nl|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'with'
name|'mock'
op|'.'
name|'patch'
op|'('
string|'"sys.stdout"'
op|','
name|'mock_stdout'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'with'
name|'mock'
op|'.'
name|'patch'
op|'('
string|'"sys.stderr"'
op|','
name|'mock_stderr'
op|')'
op|':'
newline|'\n'
indent|'                    '
name|'ringbuilder'
op|'.'
name|'main'
op|'('
name|'srb_args'
op|')'
newline|'\n'
dedent|''
dedent|''
dedent|''
name|'except'
name|'SystemExit'
name|'as'
name|'err'
op|':'
newline|'\n'
indent|'            '
name|'valid_exit_codes'
op|'='
name|'None'
newline|'\n'
name|'if'
name|'exp_results'
name|'is'
name|'not'
name|'None'
name|'and'
string|"'valid_exit_codes'"
name|'in'
name|'exp_results'
op|':'
newline|'\n'
indent|'                '
name|'valid_exit_codes'
op|'='
name|'exp_results'
op|'['
string|"'valid_exit_codes'"
op|']'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                '
name|'valid_exit_codes'
op|'='
op|'('
number|'0'
op|','
number|'1'
op|')'
comment|'# (success, warning)'
newline|'\n'
nl|'\n'
dedent|''
name|'if'
name|'err'
op|'.'
name|'code'
name|'not'
name|'in'
name|'valid_exit_codes'
op|':'
newline|'\n'
indent|'                '
name|'msg'
op|'='
string|"'Unexpected exit status %s\\n'"
op|'%'
name|'err'
op|'.'
name|'code'
newline|'\n'
name|'msg'
op|'+='
string|"'STDOUT:\\n%s\\nSTDERR:\\n%s\\n'"
op|'%'
op|'('
nl|'\n'
name|'mock_stdout'
op|'.'
name|'getvalue'
op|'('
op|')'
op|','
name|'mock_stderr'
op|'.'
name|'getvalue'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'fail'
op|'('
name|'msg'
op|')'
newline|'\n'
dedent|''
dedent|''
name|'return'
op|'('
name|'mock_stdout'
op|'.'
name|'getvalue'
op|'('
op|')'
op|','
name|'mock_stderr'
op|'.'
name|'getvalue'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|TestCommands
dedent|''
dedent|''
name|'class'
name|'TestCommands'
op|'('
name|'unittest'
op|'.'
name|'TestCase'
op|','
name|'RunSwiftRingBuilderMixin'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|member|__init__
indent|'    '
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
op|'*'
name|'args'
op|','
op|'**'
name|'kwargs'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'super'
op|'('
name|'TestCommands'
op|','
name|'self'
op|')'
op|'.'
name|'__init__'
op|'('
op|'*'
name|'args'
op|','
op|'**'
name|'kwargs'
op|')'
newline|'\n'
nl|'\n'
comment|'# List of search values for various actions'
nl|'\n'
comment|'# These should all match the first device in the sample ring'
nl|'\n'
comment|'# (see below) but not the second device'
nl|'\n'
name|'self'
op|'.'
name|'search_values'
op|'='
op|'['
string|'"d0"'
op|','
string|'"/sda1"'
op|','
string|'"r0"'
op|','
string|'"z0"'
op|','
string|'"z0-127.0.0.1"'
op|','
nl|'\n'
string|'"127.0.0.1"'
op|','
string|'"z0:6000"'
op|','
string|'":6000"'
op|','
string|'"R127.0.0.1"'
op|','
nl|'\n'
string|'"127.0.0.1R127.0.0.1"'
op|','
string|'"R:6000"'
op|','
nl|'\n'
string|'"_some meta data"'
op|']'
newline|'\n'
name|'tmpf'
op|'='
name|'tempfile'
op|'.'
name|'NamedTemporaryFile'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'tempfile'
op|'='
name|'self'
op|'.'
name|'tmpfile'
op|'='
name|'tmpf'
op|'.'
name|'name'
newline|'\n'
nl|'\n'
DECL|member|tearDown
dedent|''
name|'def'
name|'tearDown'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'os'
op|'.'
name|'remove'
op|'('
name|'self'
op|'.'
name|'tmpfile'
op|')'
newline|'\n'
dedent|''
name|'except'
name|'OSError'
op|':'
newline|'\n'
indent|'            '
name|'pass'
newline|'\n'
nl|'\n'
DECL|member|create_sample_ring
dedent|''
dedent|''
name|'def'
name|'create_sample_ring'
op|'('
name|'self'
op|','
name|'part_power'
op|'='
number|'6'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'""" Create a sample ring with four devices\n\n        At least four devices are needed to test removing\n        a device, since having less devices than replicas\n        is not allowed.\n        """'
newline|'\n'
nl|'\n'
comment|'# Ensure there is no existing test builder file because'
nl|'\n'
comment|'# create_sample_ring() might be used more than once in a single test'
nl|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'os'
op|'.'
name|'remove'
op|'('
name|'self'
op|'.'
name|'tmpfile'
op|')'
newline|'\n'
dedent|''
name|'except'
name|'OSError'
op|':'
newline|'\n'
indent|'            '
name|'pass'
newline|'\n'
nl|'\n'
dedent|''
name|'ring'
op|'='
name|'RingBuilder'
op|'('
name|'part_power'
op|','
number|'3'
op|','
number|'1'
op|')'
newline|'\n'
name|'ring'
op|'.'
name|'add_dev'
op|'('
op|'{'
string|"'weight'"
op|':'
number|'100.0'
op|','
nl|'\n'
string|"'region'"
op|':'
number|'0'
op|','
nl|'\n'
string|"'zone'"
op|':'
number|'0'
op|','
nl|'\n'
string|"'ip'"
op|':'
string|"'127.0.0.1'"
op|','
nl|'\n'
string|"'port'"
op|':'
number|'6000'
op|','
nl|'\n'
string|"'device'"
op|':'
string|"'sda1'"
op|','
nl|'\n'
string|"'meta'"
op|':'
string|"'some meta data'"
op|','
nl|'\n'
op|'}'
op|')'
newline|'\n'
name|'ring'
op|'.'
name|'add_dev'
op|'('
op|'{'
string|"'weight'"
op|':'
number|'100.0'
op|','
nl|'\n'
string|"'region'"
op|':'
number|'1'
op|','
nl|'\n'
string|"'zone'"
op|':'
number|'1'
op|','
nl|'\n'
string|"'ip'"
op|':'
string|"'127.0.0.2'"
op|','
nl|'\n'
string|"'port'"
op|':'
number|'6001'
op|','
nl|'\n'
string|"'device'"
op|':'
string|"'sda2'"
nl|'\n'
op|'}'
op|')'
newline|'\n'
name|'ring'
op|'.'
name|'add_dev'
op|'('
op|'{'
string|"'weight'"
op|':'
number|'100.0'
op|','
nl|'\n'
string|"'region'"
op|':'
number|'2'
op|','
nl|'\n'
string|"'zone'"
op|':'
number|'2'
op|','
nl|'\n'
string|"'ip'"
op|':'
string|"'127.0.0.3'"
op|','
nl|'\n'
string|"'port'"
op|':'
number|'6002'
op|','
nl|'\n'
string|"'device'"
op|':'
string|"'sdc3'"
nl|'\n'
op|'}'
op|')'
newline|'\n'
name|'ring'
op|'.'
name|'add_dev'
op|'('
op|'{'
string|"'weight'"
op|':'
number|'100.0'
op|','
nl|'\n'
string|"'region'"
op|':'
number|'3'
op|','
nl|'\n'
string|"'zone'"
op|':'
number|'3'
op|','
nl|'\n'
string|"'ip'"
op|':'
string|"'127.0.0.4'"
op|','
nl|'\n'
string|"'port'"
op|':'
number|'6003'
op|','
nl|'\n'
string|"'device'"
op|':'
string|"'sdd4'"
nl|'\n'
op|'}'
op|')'
newline|'\n'
name|'ring'
op|'.'
name|'save'
op|'('
name|'self'
op|'.'
name|'tmpfile'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_parse_search_values_old_format
dedent|''
name|'def'
name|'test_parse_search_values_old_format'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# Test old format'
nl|'\n'
indent|'        '
name|'argv'
op|'='
op|'['
string|'"d0r0z0-127.0.0.1:6000R127.0.0.1:6000/sda1_some meta data"'
op|']'
newline|'\n'
name|'search_values'
op|'='
name|'ringbuilder'
op|'.'
name|'_parse_search_values'
op|'('
name|'argv'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'search_values'
op|'['
string|"'id'"
op|']'
op|','
number|'0'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'search_values'
op|'['
string|"'region'"
op|']'
op|','
number|'0'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'search_values'
op|'['
string|"'zone'"
op|']'
op|','
number|'0'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'search_values'
op|'['
string|"'ip'"
op|']'
op|','
string|"'127.0.0.1'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'search_values'
op|'['
string|"'port'"
op|']'
op|','
number|'6000'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'search_values'
op|'['
string|"'replication_ip'"
op|']'
op|','
string|"'127.0.0.1'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'search_values'
op|'['
string|"'replication_port'"
op|']'
op|','
number|'6000'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'search_values'
op|'['
string|"'device'"
op|']'
op|','
string|"'sda1'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'search_values'
op|'['
string|"'meta'"
op|']'
op|','
string|"'some meta data'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_parse_search_values_new_format
dedent|''
name|'def'
name|'test_parse_search_values_new_format'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# Test new format'
nl|'\n'
indent|'        '
name|'argv'
op|'='
op|'['
string|'"--id"'
op|','
string|'"0"'
op|','
string|'"--region"'
op|','
string|'"0"'
op|','
string|'"--zone"'
op|','
string|'"0"'
op|','
nl|'\n'
string|'"--ip"'
op|','
string|'"127.0.0.1"'
op|','
nl|'\n'
string|'"--port"'
op|','
string|'"6000"'
op|','
nl|'\n'
string|'"--replication-ip"'
op|','
string|'"127.0.0.1"'
op|','
nl|'\n'
string|'"--replication-port"'
op|','
string|'"6000"'
op|','
nl|'\n'
string|'"--device"'
op|','
string|'"sda1"'
op|','
string|'"--meta"'
op|','
string|'"some meta data"'
op|','
nl|'\n'
string|'"--weight"'
op|','
string|'"100"'
op|']'
newline|'\n'
name|'search_values'
op|'='
name|'ringbuilder'
op|'.'
name|'_parse_search_values'
op|'('
name|'argv'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'search_values'
op|'['
string|"'id'"
op|']'
op|','
number|'0'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'search_values'
op|'['
string|"'region'"
op|']'
op|','
number|'0'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'search_values'
op|'['
string|"'zone'"
op|']'
op|','
number|'0'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'search_values'
op|'['
string|"'ip'"
op|']'
op|','
string|"'127.0.0.1'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'search_values'
op|'['
string|"'port'"
op|']'
op|','
number|'6000'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'search_values'
op|'['
string|"'replication_ip'"
op|']'
op|','
string|"'127.0.0.1'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'search_values'
op|'['
string|"'replication_port'"
op|']'
op|','
number|'6000'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'search_values'
op|'['
string|"'device'"
op|']'
op|','
string|"'sda1'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'search_values'
op|'['
string|"'meta'"
op|']'
op|','
string|"'some meta data'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'search_values'
op|'['
string|"'weight'"
op|']'
op|','
number|'100'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_parse_search_values_number_of_arguments
dedent|''
name|'def'
name|'test_parse_search_values_number_of_arguments'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# Test Number of arguments abnormal'
nl|'\n'
indent|'        '
name|'argv'
op|'='
op|'['
string|'"--region"'
op|','
string|'"2"'
op|','
string|'"test"'
op|']'
newline|'\n'
name|'err'
op|'='
name|'None'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'ringbuilder'
op|'.'
name|'_parse_search_values'
op|'('
name|'argv'
op|')'
newline|'\n'
dedent|''
name|'except'
name|'SystemExit'
name|'as'
name|'e'
op|':'
newline|'\n'
indent|'            '
name|'err'
op|'='
name|'e'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'err'
op|'.'
name|'code'
op|','
number|'2'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_find_parts
dedent|''
name|'def'
name|'test_find_parts'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'rb'
op|'='
name|'RingBuilder'
op|'('
number|'8'
op|','
number|'3'
op|','
number|'0'
op|')'
newline|'\n'
name|'rb'
op|'.'
name|'add_dev'
op|'('
op|'{'
string|"'id'"
op|':'
number|'0'
op|','
string|"'region'"
op|':'
number|'1'
op|','
string|"'zone'"
op|':'
number|'0'
op|','
string|"'weight'"
op|':'
number|'100'
op|','
nl|'\n'
string|"'ip'"
op|':'
string|"'127.0.0.1'"
op|','
string|"'port'"
op|':'
number|'10000'
op|','
string|"'device'"
op|':'
string|"'sda1'"
op|'}'
op|')'
newline|'\n'
name|'rb'
op|'.'
name|'add_dev'
op|'('
op|'{'
string|"'id'"
op|':'
number|'3'
op|','
string|"'region'"
op|':'
number|'1'
op|','
string|"'zone'"
op|':'
number|'0'
op|','
string|"'weight'"
op|':'
number|'100'
op|','
nl|'\n'
string|"'ip'"
op|':'
string|"'127.0.0.1'"
op|','
string|"'port'"
op|':'
number|'10000'
op|','
string|"'device'"
op|':'
string|"'sdb1'"
op|'}'
op|')'
newline|'\n'
name|'rb'
op|'.'
name|'add_dev'
op|'('
op|'{'
string|"'id'"
op|':'
number|'1'
op|','
string|"'region'"
op|':'
number|'1'
op|','
string|"'zone'"
op|':'
number|'1'
op|','
string|"'weight'"
op|':'
number|'100'
op|','
nl|'\n'
string|"'ip'"
op|':'
string|"'127.0.0.1'"
op|','
string|"'port'"
op|':'
number|'10001'
op|','
string|"'device'"
op|':'
string|"'sda1'"
op|'}'
op|')'
newline|'\n'
name|'rb'
op|'.'
name|'add_dev'
op|'('
op|'{'
string|"'id'"
op|':'
number|'4'
op|','
string|"'region'"
op|':'
number|'1'
op|','
string|"'zone'"
op|':'
number|'1'
op|','
string|"'weight'"
op|':'
number|'100'
op|','
nl|'\n'
string|"'ip'"
op|':'
string|"'127.0.0.1'"
op|','
string|"'port'"
op|':'
number|'10001'
op|','
string|"'device'"
op|':'
string|"'sdb1'"
op|'}'
op|')'
newline|'\n'
name|'rb'
op|'.'
name|'add_dev'
op|'('
op|'{'
string|"'id'"
op|':'
number|'2'
op|','
string|"'region'"
op|':'
number|'1'
op|','
string|"'zone'"
op|':'
number|'2'
op|','
string|"'weight'"
op|':'
number|'100'
op|','
nl|'\n'
string|"'ip'"
op|':'
string|"'127.0.0.1'"
op|','
string|"'port'"
op|':'
number|'10002'
op|','
string|"'device'"
op|':'
string|"'sda1'"
op|'}'
op|')'
newline|'\n'
name|'rb'
op|'.'
name|'add_dev'
op|'('
op|'{'
string|"'id'"
op|':'
number|'5'
op|','
string|"'region'"
op|':'
number|'1'
op|','
string|"'zone'"
op|':'
number|'2'
op|','
string|"'weight'"
op|':'
number|'100'
op|','
nl|'\n'
string|"'ip'"
op|':'
string|"'127.0.0.1'"
op|','
string|"'port'"
op|':'
number|'10002'
op|','
string|"'device'"
op|':'
string|"'sdb1'"
op|'}'
op|')'
newline|'\n'
name|'rb'
op|'.'
name|'rebalance'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'rb'
op|'.'
name|'add_dev'
op|'('
op|'{'
string|"'id'"
op|':'
number|'6'
op|','
string|"'region'"
op|':'
number|'2'
op|','
string|"'zone'"
op|':'
number|'1'
op|','
string|"'weight'"
op|':'
number|'10'
op|','
nl|'\n'
string|"'ip'"
op|':'
string|"'127.0.0.1'"
op|','
string|"'port'"
op|':'
number|'10004'
op|','
string|"'device'"
op|':'
string|"'sda1'"
op|'}'
op|')'
newline|'\n'
name|'rb'
op|'.'
name|'pretend_min_part_hours_passed'
op|'('
op|')'
newline|'\n'
name|'rb'
op|'.'
name|'rebalance'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'ringbuilder'
op|'.'
name|'builder'
op|'='
name|'rb'
newline|'\n'
name|'sorted_partition_count'
op|'='
name|'ringbuilder'
op|'.'
name|'_find_parts'
op|'('
nl|'\n'
name|'rb'
op|'.'
name|'search_devs'
op|'('
op|'{'
string|"'ip'"
op|':'
string|"'127.0.0.1'"
op|'}'
op|')'
op|')'
newline|'\n'
nl|'\n'
comment|'# Expect 256 partitions in the output'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'256'
op|','
name|'len'
op|'('
name|'sorted_partition_count'
op|')'
op|')'
newline|'\n'
nl|'\n'
comment|'# Each partitions should have 3 replicas'
nl|'\n'
name|'for'
name|'partition'
op|','
name|'count'
name|'in'
name|'sorted_partition_count'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertEqual'
op|'('
nl|'\n'
number|'3'
op|','
name|'count'
op|','
string|'"Partition %d has only %d replicas"'
op|'%'
nl|'\n'
op|'('
name|'partition'
op|','
name|'count'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_parse_list_parts_values_number_of_arguments
dedent|''
dedent|''
name|'def'
name|'test_parse_list_parts_values_number_of_arguments'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# Test Number of arguments abnormal'
nl|'\n'
indent|'        '
name|'argv'
op|'='
op|'['
string|'"--region"'
op|','
string|'"2"'
op|','
string|'"test"'
op|']'
newline|'\n'
name|'err'
op|'='
name|'None'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'ringbuilder'
op|'.'
name|'_parse_list_parts_values'
op|'('
name|'argv'
op|')'
newline|'\n'
dedent|''
name|'except'
name|'SystemExit'
name|'as'
name|'e'
op|':'
newline|'\n'
indent|'            '
name|'err'
op|'='
name|'e'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'err'
op|'.'
name|'code'
op|','
number|'2'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_parse_add_values_number_of_arguments
dedent|''
name|'def'
name|'test_parse_add_values_number_of_arguments'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# Test Number of arguments abnormal'
nl|'\n'
indent|'        '
name|'argv'
op|'='
op|'['
string|'"--region"'
op|','
string|'"2"'
op|','
string|'"test"'
op|']'
newline|'\n'
name|'err'
op|'='
name|'None'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'ringbuilder'
op|'.'
name|'_parse_add_values'
op|'('
name|'argv'
op|')'
newline|'\n'
dedent|''
name|'except'
name|'SystemExit'
name|'as'
name|'e'
op|':'
newline|'\n'
indent|'            '
name|'err'
op|'='
name|'e'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'err'
op|'.'
name|'code'
op|','
number|'2'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_set_weight_values_no_devices
dedent|''
name|'def'
name|'test_set_weight_values_no_devices'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# Test no devices'
nl|'\n'
indent|'        '
name|'err'
op|'='
name|'None'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'ringbuilder'
op|'.'
name|'_set_weight_values'
op|'('
op|'['
op|']'
op|','
number|'100'
op|')'
newline|'\n'
dedent|''
name|'except'
name|'SystemExit'
name|'as'
name|'e'
op|':'
newline|'\n'
indent|'            '
name|'err'
op|'='
name|'e'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'err'
op|'.'
name|'code'
op|','
number|'2'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_parse_set_weight_values_number_of_arguments
dedent|''
name|'def'
name|'test_parse_set_weight_values_number_of_arguments'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# Test Number of arguments abnormal'
nl|'\n'
indent|'        '
name|'argv'
op|'='
op|'['
string|'"r1"'
op|','
string|'"100"'
op|','
string|'"r2"'
op|']'
newline|'\n'
name|'err'
op|'='
name|'None'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'ringbuilder'
op|'.'
name|'_parse_set_weight_values'
op|'('
name|'argv'
op|')'
newline|'\n'
dedent|''
name|'except'
name|'SystemExit'
name|'as'
name|'e'
op|':'
newline|'\n'
indent|'            '
name|'err'
op|'='
name|'e'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'err'
op|'.'
name|'code'
op|','
number|'2'
op|')'
newline|'\n'
nl|'\n'
name|'argv'
op|'='
op|'['
string|'"--region"'
op|','
string|'"2"'
op|']'
newline|'\n'
name|'err'
op|'='
name|'None'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'ringbuilder'
op|'.'
name|'_parse_set_weight_values'
op|'('
name|'argv'
op|')'
newline|'\n'
dedent|''
name|'except'
name|'SystemExit'
name|'as'
name|'e'
op|':'
newline|'\n'
indent|'            '
name|'err'
op|'='
name|'e'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'err'
op|'.'
name|'code'
op|','
number|'2'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_set_info_values_no_devices
dedent|''
name|'def'
name|'test_set_info_values_no_devices'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# Test no devices'
nl|'\n'
indent|'        '
name|'err'
op|'='
name|'None'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'ringbuilder'
op|'.'
name|'_set_info_values'
op|'('
op|'['
op|']'
op|','
number|'100'
op|')'
newline|'\n'
dedent|''
name|'except'
name|'SystemExit'
name|'as'
name|'e'
op|':'
newline|'\n'
indent|'            '
name|'err'
op|'='
name|'e'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'err'
op|'.'
name|'code'
op|','
number|'2'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_parse_set_info_values_number_of_arguments
dedent|''
name|'def'
name|'test_parse_set_info_values_number_of_arguments'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# Test Number of arguments abnormal'
nl|'\n'
indent|'        '
name|'argv'
op|'='
op|'['
string|'"r1"'
op|','
string|'"127.0.0.1"'
op|','
string|'"r2"'
op|']'
newline|'\n'
name|'err'
op|'='
name|'None'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'ringbuilder'
op|'.'
name|'_parse_set_info_values'
op|'('
name|'argv'
op|')'
newline|'\n'
dedent|''
name|'except'
name|'SystemExit'
name|'as'
name|'e'
op|':'
newline|'\n'
indent|'            '
name|'err'
op|'='
name|'e'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'err'
op|'.'
name|'code'
op|','
number|'2'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_parse_remove_values_number_of_arguments
dedent|''
name|'def'
name|'test_parse_remove_values_number_of_arguments'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# Test Number of arguments abnormal'
nl|'\n'
indent|'        '
name|'argv'
op|'='
op|'['
string|'"--region"'
op|','
string|'"2"'
op|','
string|'"test"'
op|']'
newline|'\n'
name|'err'
op|'='
name|'None'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'ringbuilder'
op|'.'
name|'_parse_remove_values'
op|'('
name|'argv'
op|')'
newline|'\n'
dedent|''
name|'except'
name|'SystemExit'
name|'as'
name|'e'
op|':'
newline|'\n'
indent|'            '
name|'err'
op|'='
name|'e'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'err'
op|'.'
name|'code'
op|','
number|'2'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_create_ring
dedent|''
name|'def'
name|'test_create_ring'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'argv'
op|'='
op|'['
string|'""'
op|','
name|'self'
op|'.'
name|'tmpfile'
op|','
string|'"create"'
op|','
string|'"6"'
op|','
string|'"3.14159265359"'
op|','
string|'"1"'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'SystemExit'
op|','
name|'ringbuilder'
op|'.'
name|'main'
op|','
name|'argv'
op|')'
newline|'\n'
name|'ring'
op|'='
name|'RingBuilder'
op|'.'
name|'load'
op|'('
name|'self'
op|'.'
name|'tmpfile'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'ring'
op|'.'
name|'part_power'
op|','
number|'6'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'ring'
op|'.'
name|'replicas'
op|','
number|'3.14159265359'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'ring'
op|'.'
name|'min_part_hours'
op|','
number|'1'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_create_ring_number_of_arguments
dedent|''
name|'def'
name|'test_create_ring_number_of_arguments'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# Test missing arguments'
nl|'\n'
indent|'        '
name|'argv'
op|'='
op|'['
string|'""'
op|','
name|'self'
op|'.'
name|'tmpfile'
op|','
string|'"create"'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'SystemExit'
op|','
name|'ringbuilder'
op|'.'
name|'main'
op|','
name|'argv'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_add_device_ipv4_old_format
dedent|''
name|'def'
name|'test_add_device_ipv4_old_format'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'create_sample_ring'
op|'('
op|')'
newline|'\n'
comment|'# Test ipv4(old format)'
nl|'\n'
name|'argv'
op|'='
op|'['
string|'""'
op|','
name|'self'
op|'.'
name|'tmpfile'
op|','
string|'"add"'
op|','
nl|'\n'
string|'"r2z3-127.0.0.1:6000/sda3_some meta data"'
op|','
string|'"3.14159265359"'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'SystemExit'
op|','
name|'ringbuilder'
op|'.'
name|'main'
op|','
name|'argv'
op|')'
newline|'\n'
nl|'\n'
comment|'# Check that device was created with given data'
nl|'\n'
name|'ring'
op|'='
name|'RingBuilder'
op|'.'
name|'load'
op|'('
name|'self'
op|'.'
name|'tmpfile'
op|')'
newline|'\n'
name|'dev'
op|'='
name|'ring'
op|'.'
name|'devs'
op|'['
op|'-'
number|'1'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'region'"
op|']'
op|','
number|'2'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'zone'"
op|']'
op|','
number|'3'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'ip'"
op|']'
op|','
string|"'127.0.0.1'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'port'"
op|']'
op|','
number|'6000'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'device'"
op|']'
op|','
string|"'sda3'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'weight'"
op|']'
op|','
number|'3.14159265359'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'replication_ip'"
op|']'
op|','
string|"'127.0.0.1'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'replication_port'"
op|']'
op|','
number|'6000'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'meta'"
op|']'
op|','
string|"'some meta data'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_add_duplicate_devices
dedent|''
name|'def'
name|'test_add_duplicate_devices'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'create_sample_ring'
op|'('
op|')'
newline|'\n'
comment|'# Test adding duplicate devices'
nl|'\n'
name|'argv'
op|'='
op|'['
string|'""'
op|','
name|'self'
op|'.'
name|'tmpfile'
op|','
string|'"add"'
op|','
nl|'\n'
string|'"r1z1-127.0.0.1:6000/sda9"'
op|','
string|'"3.14159265359"'
op|','
nl|'\n'
string|'"r1z1-127.0.0.1:6000/sda9"'
op|','
string|'"2"'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'SystemExit'
op|','
name|'ringbuilder'
op|'.'
name|'main'
op|','
name|'argv'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_add_device_ipv6_old_format
dedent|''
name|'def'
name|'test_add_device_ipv6_old_format'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'create_sample_ring'
op|'('
op|')'
newline|'\n'
comment|'# Test ipv6(old format)'
nl|'\n'
name|'argv'
op|'='
op|'['
string|'""'
op|','
name|'self'
op|'.'
name|'tmpfile'
op|','
string|'"add"'
op|','
nl|'\n'
string|'"r2z3-2001:0000:1234:0000:0000:C1C0:ABCD:0876:6000"'
nl|'\n'
string|'"R2::10:7000/sda3_some meta data"'
op|','
nl|'\n'
string|'"3.14159265359"'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'SystemExit'
op|','
name|'ringbuilder'
op|'.'
name|'main'
op|','
name|'argv'
op|')'
newline|'\n'
nl|'\n'
comment|'# Check that device was created with given data'
nl|'\n'
name|'ring'
op|'='
name|'RingBuilder'
op|'.'
name|'load'
op|'('
name|'self'
op|'.'
name|'tmpfile'
op|')'
newline|'\n'
name|'dev'
op|'='
name|'ring'
op|'.'
name|'devs'
op|'['
op|'-'
number|'1'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'region'"
op|']'
op|','
number|'2'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'zone'"
op|']'
op|','
number|'3'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'ip'"
op|']'
op|','
string|"'2001:0:1234::c1c0:abcd:876'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'port'"
op|']'
op|','
number|'6000'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'device'"
op|']'
op|','
string|"'sda3'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'weight'"
op|']'
op|','
number|'3.14159265359'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'replication_ip'"
op|']'
op|','
string|"'2::10'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'replication_port'"
op|']'
op|','
number|'7000'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'meta'"
op|']'
op|','
string|"'some meta data'"
op|')'
newline|'\n'
comment|'# Final check, rebalance and check ring is ok'
nl|'\n'
name|'ring'
op|'.'
name|'rebalance'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'ring'
op|'.'
name|'validate'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_add_device_ipv4_new_format
dedent|''
name|'def'
name|'test_add_device_ipv4_new_format'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'create_sample_ring'
op|'('
op|')'
newline|'\n'
comment|'# Test ipv4(new format)'
nl|'\n'
name|'argv'
op|'='
op|'['
string|'""'
op|','
name|'self'
op|'.'
name|'tmpfile'
op|','
string|'"add"'
op|','
nl|'\n'
string|'"--region"'
op|','
string|'"2"'
op|','
string|'"--zone"'
op|','
string|'"3"'
op|','
nl|'\n'
string|'"--ip"'
op|','
string|'"127.0.0.2"'
op|','
nl|'\n'
string|'"--port"'
op|','
string|'"6000"'
op|','
nl|'\n'
string|'"--replication-ip"'
op|','
string|'"127.0.0.2"'
op|','
nl|'\n'
string|'"--replication-port"'
op|','
string|'"6000"'
op|','
nl|'\n'
string|'"--device"'
op|','
string|'"sda3"'
op|','
string|'"--meta"'
op|','
string|'"some meta data"'
op|','
nl|'\n'
string|'"--weight"'
op|','
string|'"3.14159265359"'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'SystemExit'
op|','
name|'ringbuilder'
op|'.'
name|'main'
op|','
name|'argv'
op|')'
newline|'\n'
nl|'\n'
comment|'# Check that device was created with given data'
nl|'\n'
name|'ring'
op|'='
name|'RingBuilder'
op|'.'
name|'load'
op|'('
name|'self'
op|'.'
name|'tmpfile'
op|')'
newline|'\n'
name|'dev'
op|'='
name|'ring'
op|'.'
name|'devs'
op|'['
op|'-'
number|'1'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'region'"
op|']'
op|','
number|'2'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'zone'"
op|']'
op|','
number|'3'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'ip'"
op|']'
op|','
string|"'127.0.0.2'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'port'"
op|']'
op|','
number|'6000'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'device'"
op|']'
op|','
string|"'sda3'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'weight'"
op|']'
op|','
number|'3.14159265359'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'replication_ip'"
op|']'
op|','
string|"'127.0.0.2'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'replication_port'"
op|']'
op|','
number|'6000'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'meta'"
op|']'
op|','
string|"'some meta data'"
op|')'
newline|'\n'
comment|'# Final check, rebalance and check ring is ok'
nl|'\n'
name|'ring'
op|'.'
name|'rebalance'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'ring'
op|'.'
name|'validate'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_add_device_ipv6_new_format
dedent|''
name|'def'
name|'test_add_device_ipv6_new_format'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'create_sample_ring'
op|'('
op|')'
newline|'\n'
comment|'# Test ipv6(new format)'
nl|'\n'
name|'argv'
op|'='
op|'['
string|'""'
op|','
name|'self'
op|'.'
name|'tmpfile'
op|','
string|'"add"'
op|','
nl|'\n'
string|'"--region"'
op|','
string|'"2"'
op|','
string|'"--zone"'
op|','
string|'"3"'
op|','
nl|'\n'
string|'"--ip"'
op|','
string|'"[3001:0000:1234:0000:0000:C1C0:ABCD:0876]"'
op|','
nl|'\n'
string|'"--port"'
op|','
string|'"6000"'
op|','
nl|'\n'
string|'"--replication-ip"'
op|','
string|'"[3::10]"'
op|','
nl|'\n'
string|'"--replication-port"'
op|','
string|'"7000"'
op|','
nl|'\n'
string|'"--device"'
op|','
string|'"sda3"'
op|','
string|'"--meta"'
op|','
string|'"some meta data"'
op|','
nl|'\n'
string|'"--weight"'
op|','
string|'"3.14159265359"'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'SystemExit'
op|','
name|'ringbuilder'
op|'.'
name|'main'
op|','
name|'argv'
op|')'
newline|'\n'
nl|'\n'
comment|'# Check that device was created with given data'
nl|'\n'
name|'ring'
op|'='
name|'RingBuilder'
op|'.'
name|'load'
op|'('
name|'self'
op|'.'
name|'tmpfile'
op|')'
newline|'\n'
name|'dev'
op|'='
name|'ring'
op|'.'
name|'devs'
op|'['
op|'-'
number|'1'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'region'"
op|']'
op|','
number|'2'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'zone'"
op|']'
op|','
number|'3'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'ip'"
op|']'
op|','
string|"'3001:0:1234::c1c0:abcd:876'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'port'"
op|']'
op|','
number|'6000'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'device'"
op|']'
op|','
string|"'sda3'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'weight'"
op|']'
op|','
number|'3.14159265359'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'replication_ip'"
op|']'
op|','
string|"'3::10'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'replication_port'"
op|']'
op|','
number|'7000'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'meta'"
op|']'
op|','
string|"'some meta data'"
op|')'
newline|'\n'
comment|'# Final check, rebalance and check ring is ok'
nl|'\n'
name|'ring'
op|'.'
name|'rebalance'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'ring'
op|'.'
name|'validate'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_add_device_domain_new_format
dedent|''
name|'def'
name|'test_add_device_domain_new_format'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'create_sample_ring'
op|'('
op|')'
newline|'\n'
comment|'# Test domain name'
nl|'\n'
name|'argv'
op|'='
op|'['
string|'""'
op|','
name|'self'
op|'.'
name|'tmpfile'
op|','
string|'"add"'
op|','
nl|'\n'
string|'"--region"'
op|','
string|'"2"'
op|','
string|'"--zone"'
op|','
string|'"3"'
op|','
nl|'\n'
string|'"--ip"'
op|','
string|'"test.test.com"'
op|','
nl|'\n'
string|'"--port"'
op|','
string|'"6000"'
op|','
nl|'\n'
string|'"--replication-ip"'
op|','
string|'"r.test.com"'
op|','
nl|'\n'
string|'"--replication-port"'
op|','
string|'"7000"'
op|','
nl|'\n'
string|'"--device"'
op|','
string|'"sda3"'
op|','
string|'"--meta"'
op|','
string|'"some meta data"'
op|','
nl|'\n'
string|'"--weight"'
op|','
string|'"3.14159265359"'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'SystemExit'
op|','
name|'ringbuilder'
op|'.'
name|'main'
op|','
name|'argv'
op|')'
newline|'\n'
nl|'\n'
comment|'# Check that device was created with given data'
nl|'\n'
name|'ring'
op|'='
name|'RingBuilder'
op|'.'
name|'load'
op|'('
name|'self'
op|'.'
name|'tmpfile'
op|')'
newline|'\n'
name|'dev'
op|'='
name|'ring'
op|'.'
name|'devs'
op|'['
op|'-'
number|'1'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'region'"
op|']'
op|','
number|'2'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'zone'"
op|']'
op|','
number|'3'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'ip'"
op|']'
op|','
string|"'test.test.com'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'port'"
op|']'
op|','
number|'6000'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'device'"
op|']'
op|','
string|"'sda3'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'weight'"
op|']'
op|','
number|'3.14159265359'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'replication_ip'"
op|']'
op|','
string|"'r.test.com'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'replication_port'"
op|']'
op|','
number|'7000'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'meta'"
op|']'
op|','
string|"'some meta data'"
op|')'
newline|'\n'
comment|'# Final check, rebalance and check ring is ok'
nl|'\n'
name|'ring'
op|'.'
name|'rebalance'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'ring'
op|'.'
name|'validate'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_add_device_number_of_arguments
dedent|''
name|'def'
name|'test_add_device_number_of_arguments'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# Test Number of arguments abnormal'
nl|'\n'
indent|'        '
name|'argv'
op|'='
op|'['
string|'""'
op|','
name|'self'
op|'.'
name|'tmpfile'
op|','
string|'"add"'
op|']'
newline|'\n'
name|'err'
op|'='
name|'None'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'ringbuilder'
op|'.'
name|'main'
op|'('
name|'argv'
op|')'
newline|'\n'
dedent|''
name|'except'
name|'SystemExit'
name|'as'
name|'e'
op|':'
newline|'\n'
indent|'            '
name|'err'
op|'='
name|'e'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'err'
op|'.'
name|'code'
op|','
number|'2'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_add_device_already_exists
dedent|''
name|'def'
name|'test_add_device_already_exists'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# Test Add a device that already exists'
nl|'\n'
indent|'        '
name|'argv'
op|'='
op|'['
string|'""'
op|','
name|'self'
op|'.'
name|'tmpfile'
op|','
string|'"add"'
op|','
nl|'\n'
string|'"r0z0-127.0.0.1:6000/sda1_some meta data"'
op|','
string|'"100"'
op|']'
newline|'\n'
name|'err'
op|'='
name|'None'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'ringbuilder'
op|'.'
name|'main'
op|'('
name|'argv'
op|')'
newline|'\n'
dedent|''
name|'except'
name|'SystemExit'
name|'as'
name|'e'
op|':'
newline|'\n'
indent|'            '
name|'err'
op|'='
name|'e'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'err'
op|'.'
name|'code'
op|','
number|'2'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_add_device_old_missing_region
dedent|''
name|'def'
name|'test_add_device_old_missing_region'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'create_sample_ring'
op|'('
op|')'
newline|'\n'
comment|'# Test add device without specifying a region'
nl|'\n'
name|'argv'
op|'='
op|'['
string|'""'
op|','
name|'self'
op|'.'
name|'tmpfile'
op|','
string|'"add"'
op|','
nl|'\n'
string|'"z3-127.0.0.1:6000/sde3_some meta data"'
op|','
string|'"3.14159265359"'
op|']'
newline|'\n'
name|'exp_results'
op|'='
op|'{'
string|"'valid_exit_codes'"
op|':'
op|'['
number|'2'
op|']'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'run_srb'
op|'('
op|'*'
name|'argv'
op|','
name|'exp_results'
op|'='
name|'exp_results'
op|')'
newline|'\n'
comment|'# Check that ring was created with sane value for region'
nl|'\n'
name|'ring'
op|'='
name|'RingBuilder'
op|'.'
name|'load'
op|'('
name|'self'
op|'.'
name|'tmpfile'
op|')'
newline|'\n'
name|'dev'
op|'='
name|'ring'
op|'.'
name|'devs'
op|'['
op|'-'
number|'1'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'dev'
op|'['
string|"'region'"
op|']'
op|'>'
number|'0'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_remove_device
dedent|''
name|'def'
name|'test_remove_device'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'for'
name|'search_value'
name|'in'
name|'self'
op|'.'
name|'search_values'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'create_sample_ring'
op|'('
op|')'
newline|'\n'
name|'argv'
op|'='
op|'['
string|'""'
op|','
name|'self'
op|'.'
name|'tmpfile'
op|','
string|'"remove"'
op|','
name|'search_value'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'SystemExit'
op|','
name|'ringbuilder'
op|'.'
name|'main'
op|','
name|'argv'
op|')'
newline|'\n'
name|'ring'
op|'='
name|'RingBuilder'
op|'.'
name|'load'
op|'('
name|'self'
op|'.'
name|'tmpfile'
op|')'
newline|'\n'
nl|'\n'
comment|'# Check that weight was set to 0'
nl|'\n'
name|'dev'
op|'='
name|'ring'
op|'.'
name|'devs'
op|'['
number|'0'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'weight'"
op|']'
op|','
number|'0'
op|')'
newline|'\n'
nl|'\n'
comment|'# Check that device is in list of devices to be removed'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'region'"
op|']'
op|','
number|'0'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'zone'"
op|']'
op|','
number|'0'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'ip'"
op|']'
op|','
string|"'127.0.0.1'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'port'"
op|']'
op|','
number|'6000'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'device'"
op|']'
op|','
string|"'sda1'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'weight'"
op|']'
op|','
number|'0'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'replication_ip'"
op|']'
op|','
string|"'127.0.0.1'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'replication_port'"
op|']'
op|','
number|'6000'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'meta'"
op|']'
op|','
string|"'some meta data'"
op|')'
newline|'\n'
nl|'\n'
comment|'# Check that second device in ring is not affected'
nl|'\n'
name|'dev'
op|'='
name|'ring'
op|'.'
name|'devs'
op|'['
number|'1'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'weight'"
op|']'
op|','
number|'100'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
op|'['
name|'d'
name|'for'
name|'d'
name|'in'
name|'ring'
op|'.'
name|'_remove_devs'
name|'if'
name|'d'
op|'['
string|"'id'"
op|']'
op|'=='
number|'1'
op|']'
op|')'
newline|'\n'
nl|'\n'
comment|'# Final check, rebalance and check ring is ok'
nl|'\n'
name|'ring'
op|'.'
name|'rebalance'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'ring'
op|'.'
name|'validate'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_remove_device_ipv4_old_format
dedent|''
dedent|''
name|'def'
name|'test_remove_device_ipv4_old_format'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'create_sample_ring'
op|'('
op|')'
newline|'\n'
comment|'# Test ipv4(old format)'
nl|'\n'
name|'argv'
op|'='
op|'['
string|'""'
op|','
name|'self'
op|'.'
name|'tmpfile'
op|','
string|'"remove"'
op|','
nl|'\n'
string|'"d0r0z0-127.0.0.1:6000R127.0.0.1:6000/sda1_some meta data"'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'SystemExit'
op|','
name|'ringbuilder'
op|'.'
name|'main'
op|','
name|'argv'
op|')'
newline|'\n'
name|'ring'
op|'='
name|'RingBuilder'
op|'.'
name|'load'
op|'('
name|'self'
op|'.'
name|'tmpfile'
op|')'
newline|'\n'
nl|'\n'
comment|'# Check that weight was set to 0'
nl|'\n'
name|'dev'
op|'='
name|'ring'
op|'.'
name|'devs'
op|'['
number|'0'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'weight'"
op|']'
op|','
number|'0'
op|')'
newline|'\n'
nl|'\n'
comment|'# Check that device is in list of devices to be removed'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'region'"
op|']'
op|','
number|'0'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'zone'"
op|']'
op|','
number|'0'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'ip'"
op|']'
op|','
string|"'127.0.0.1'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'port'"
op|']'
op|','
number|'6000'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'device'"
op|']'
op|','
string|"'sda1'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'weight'"
op|']'
op|','
number|'0'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'replication_ip'"
op|']'
op|','
string|"'127.0.0.1'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'replication_port'"
op|']'
op|','
number|'6000'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'meta'"
op|']'
op|','
string|"'some meta data'"
op|')'
newline|'\n'
nl|'\n'
comment|'# Check that second device in ring is not affected'
nl|'\n'
name|'dev'
op|'='
name|'ring'
op|'.'
name|'devs'
op|'['
number|'1'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'weight'"
op|']'
op|','
number|'100'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
op|'['
name|'d'
name|'for'
name|'d'
name|'in'
name|'ring'
op|'.'
name|'_remove_devs'
name|'if'
name|'d'
op|'['
string|"'id'"
op|']'
op|'=='
number|'1'
op|']'
op|')'
newline|'\n'
nl|'\n'
comment|'# Final check, rebalance and check ring is ok'
nl|'\n'
name|'ring'
op|'.'
name|'rebalance'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'ring'
op|'.'
name|'validate'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_remove_device_ipv6_old_format
dedent|''
name|'def'
name|'test_remove_device_ipv6_old_format'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'create_sample_ring'
op|'('
op|')'
newline|'\n'
comment|'# add IPV6'
nl|'\n'
name|'argv'
op|'='
op|'['
string|'""'
op|','
name|'self'
op|'.'
name|'tmpfile'
op|','
string|'"add"'
op|','
nl|'\n'
string|'"--region"'
op|','
string|'"2"'
op|','
string|'"--zone"'
op|','
string|'"3"'
op|','
nl|'\n'
string|'"--ip"'
op|','
string|'"[2001:0000:1234:0000:0000:C1C0:ABCD:0876]"'
op|','
nl|'\n'
string|'"--port"'
op|','
string|'"6000"'
op|','
nl|'\n'
string|'"--replication-ip"'
op|','
string|'"[2::10]"'
op|','
nl|'\n'
string|'"--replication-port"'
op|','
string|'"7000"'
op|','
nl|'\n'
string|'"--device"'
op|','
string|'"sda3"'
op|','
string|'"--meta"'
op|','
string|'"some meta data"'
op|','
nl|'\n'
string|'"--weight"'
op|','
string|'"3.14159265359"'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'SystemExit'
op|','
name|'ringbuilder'
op|'.'
name|'main'
op|','
name|'argv'
op|')'
newline|'\n'
nl|'\n'
comment|'# Test ipv6(old format)'
nl|'\n'
name|'argv'
op|'='
op|'['
string|'""'
op|','
name|'self'
op|'.'
name|'tmpfile'
op|','
string|'"remove"'
op|','
nl|'\n'
string|'"d4r2z3-[2001:0000:1234:0000:0000:C1C0:ABCD:0876]:6000"'
nl|'\n'
string|'"R[2::10]:7000/sda3_some meta data"'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'SystemExit'
op|','
name|'ringbuilder'
op|'.'
name|'main'
op|','
name|'argv'
op|')'
newline|'\n'
name|'ring'
op|'='
name|'RingBuilder'
op|'.'
name|'load'
op|'('
name|'self'
op|'.'
name|'tmpfile'
op|')'
newline|'\n'
nl|'\n'
comment|'# Check that second device in ring is not affected'
nl|'\n'
name|'dev'
op|'='
name|'ring'
op|'.'
name|'devs'
op|'['
number|'0'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'weight'"
op|']'
op|','
number|'100'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
op|'['
name|'d'
name|'for'
name|'d'
name|'in'
name|'ring'
op|'.'
name|'_remove_devs'
name|'if'
name|'d'
op|'['
string|"'id'"
op|']'
op|'=='
number|'0'
op|']'
op|')'
newline|'\n'
nl|'\n'
comment|'# Check that second device in ring is not affected'
nl|'\n'
name|'dev'
op|'='
name|'ring'
op|'.'
name|'devs'
op|'['
number|'1'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'weight'"
op|']'
op|','
number|'100'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
op|'['
name|'d'
name|'for'
name|'d'
name|'in'
name|'ring'
op|'.'
name|'_remove_devs'
name|'if'
name|'d'
op|'['
string|"'id'"
op|']'
op|'=='
number|'1'
op|']'
op|')'
newline|'\n'
nl|'\n'
comment|'# Check that weight was set to 0'
nl|'\n'
name|'dev'
op|'='
name|'ring'
op|'.'
name|'devs'
op|'['
op|'-'
number|'1'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'weight'"
op|']'
op|','
number|'0'
op|')'
newline|'\n'
nl|'\n'
comment|'# Check that device is in list of devices to be removed'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'region'"
op|']'
op|','
number|'2'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'zone'"
op|']'
op|','
number|'3'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'ip'"
op|']'
op|','
string|"'2001:0:1234::c1c0:abcd:876'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'port'"
op|']'
op|','
number|'6000'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'device'"
op|']'
op|','
string|"'sda3'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'weight'"
op|']'
op|','
number|'0'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'replication_ip'"
op|']'
op|','
string|"'2::10'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'replication_port'"
op|']'
op|','
number|'7000'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'meta'"
op|']'
op|','
string|"'some meta data'"
op|')'
newline|'\n'
nl|'\n'
comment|'# Final check, rebalance and check ring is ok'
nl|'\n'
name|'ring'
op|'.'
name|'rebalance'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'ring'
op|'.'
name|'validate'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_remove_device_ipv4_new_format
dedent|''
name|'def'
name|'test_remove_device_ipv4_new_format'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'create_sample_ring'
op|'('
op|')'
newline|'\n'
comment|'# Test ipv4(new format)'
nl|'\n'
name|'argv'
op|'='
op|'['
string|'""'
op|','
name|'self'
op|'.'
name|'tmpfile'
op|','
string|'"remove"'
op|','
nl|'\n'
string|'"--id"'
op|','
string|'"0"'
op|','
string|'"--region"'
op|','
string|'"0"'
op|','
string|'"--zone"'
op|','
string|'"0"'
op|','
nl|'\n'
string|'"--ip"'
op|','
string|'"127.0.0.1"'
op|','
nl|'\n'
string|'"--port"'
op|','
string|'"6000"'
op|','
nl|'\n'
string|'"--replication-ip"'
op|','
string|'"127.0.0.1"'
op|','
nl|'\n'
string|'"--replication-port"'
op|','
string|'"6000"'
op|','
nl|'\n'
string|'"--device"'
op|','
string|'"sda1"'
op|','
string|'"--meta"'
op|','
string|'"some meta data"'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'SystemExit'
op|','
name|'ringbuilder'
op|'.'
name|'main'
op|','
name|'argv'
op|')'
newline|'\n'
name|'ring'
op|'='
name|'RingBuilder'
op|'.'
name|'load'
op|'('
name|'self'
op|'.'
name|'tmpfile'
op|')'
newline|'\n'
nl|'\n'
comment|'# Check that weight was set to 0'
nl|'\n'
name|'dev'
op|'='
name|'ring'
op|'.'
name|'devs'
op|'['
number|'0'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'weight'"
op|']'
op|','
number|'0'
op|')'
newline|'\n'
nl|'\n'
comment|'# Check that device is in list of devices to be removed'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'region'"
op|']'
op|','
number|'0'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'zone'"
op|']'
op|','
number|'0'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'ip'"
op|']'
op|','
string|"'127.0.0.1'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'port'"
op|']'
op|','
number|'6000'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'device'"
op|']'
op|','
string|"'sda1'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'weight'"
op|']'
op|','
number|'0'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'replication_ip'"
op|']'
op|','
string|"'127.0.0.1'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'replication_port'"
op|']'
op|','
number|'6000'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'meta'"
op|']'
op|','
string|"'some meta data'"
op|')'
newline|'\n'
nl|'\n'
comment|'# Check that second device in ring is not affected'
nl|'\n'
name|'dev'
op|'='
name|'ring'
op|'.'
name|'devs'
op|'['
number|'1'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'weight'"
op|']'
op|','
number|'100'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
op|'['
name|'d'
name|'for'
name|'d'
name|'in'
name|'ring'
op|'.'
name|'_remove_devs'
name|'if'
name|'d'
op|'['
string|"'id'"
op|']'
op|'=='
number|'1'
op|']'
op|')'
newline|'\n'
nl|'\n'
comment|'# Final check, rebalance and check ring is ok'
nl|'\n'
name|'ring'
op|'.'
name|'rebalance'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'ring'
op|'.'
name|'validate'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_remove_device_ipv6_new_format
dedent|''
name|'def'
name|'test_remove_device_ipv6_new_format'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'create_sample_ring'
op|'('
op|')'
newline|'\n'
name|'argv'
op|'='
op|'['
string|'""'
op|','
name|'self'
op|'.'
name|'tmpfile'
op|','
string|'"add"'
op|','
nl|'\n'
string|'"--region"'
op|','
string|'"2"'
op|','
string|'"--zone"'
op|','
string|'"3"'
op|','
nl|'\n'
string|'"--ip"'
op|','
string|'"[3001:0000:1234:0000:0000:C1C0:ABCD:0876]"'
op|','
nl|'\n'
string|'"--port"'
op|','
string|'"8000"'
op|','
nl|'\n'
string|'"--replication-ip"'
op|','
string|'"[3::10]"'
op|','
nl|'\n'
string|'"--replication-port"'
op|','
string|'"9000"'
op|','
nl|'\n'
string|'"--device"'
op|','
string|'"sda30"'
op|','
string|'"--meta"'
op|','
string|'"other meta data"'
op|','
nl|'\n'
string|'"--weight"'
op|','
string|'"3.14159265359"'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'SystemExit'
op|','
name|'ringbuilder'
op|'.'
name|'main'
op|','
name|'argv'
op|')'
newline|'\n'
nl|'\n'
comment|'# Test ipv6(new format)'
nl|'\n'
name|'argv'
op|'='
op|'['
string|'""'
op|','
name|'self'
op|'.'
name|'tmpfile'
op|','
string|'"remove"'
op|','
nl|'\n'
string|'"--id"'
op|','
string|'"4"'
op|','
string|'"--region"'
op|','
string|'"2"'
op|','
string|'"--zone"'
op|','
string|'"3"'
op|','
nl|'\n'
string|'"--ip"'
op|','
string|'"[3001:0000:1234:0000:0000:C1C0:ABCD:0876]"'
op|','
nl|'\n'
string|'"--port"'
op|','
string|'"8000"'
op|','
nl|'\n'
string|'"--replication-ip"'
op|','
string|'"[3::10]"'
op|','
nl|'\n'
string|'"--replication-port"'
op|','
string|'"9000"'
op|','
nl|'\n'
string|'"--device"'
op|','
string|'"sda30"'
op|','
string|'"--meta"'
op|','
string|'"other meta data"'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'SystemExit'
op|','
name|'ringbuilder'
op|'.'
name|'main'
op|','
name|'argv'
op|')'
newline|'\n'
name|'ring'
op|'='
name|'RingBuilder'
op|'.'
name|'load'
op|'('
name|'self'
op|'.'
name|'tmpfile'
op|')'
newline|'\n'
nl|'\n'
comment|'# Check that second device in ring is not affected'
nl|'\n'
name|'dev'
op|'='
name|'ring'
op|'.'
name|'devs'
op|'['
number|'0'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'weight'"
op|']'
op|','
number|'100'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
op|'['
name|'d'
name|'for'
name|'d'
name|'in'
name|'ring'
op|'.'
name|'_remove_devs'
name|'if'
name|'d'
op|'['
string|"'id'"
op|']'
op|'=='
number|'0'
op|']'
op|')'
newline|'\n'
nl|'\n'
comment|'# Check that second device in ring is not affected'
nl|'\n'
name|'dev'
op|'='
name|'ring'
op|'.'
name|'devs'
op|'['
number|'1'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'weight'"
op|']'
op|','
number|'100'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
op|'['
name|'d'
name|'for'
name|'d'
name|'in'
name|'ring'
op|'.'
name|'_remove_devs'
name|'if'
name|'d'
op|'['
string|"'id'"
op|']'
op|'=='
number|'1'
op|']'
op|')'
newline|'\n'
nl|'\n'
comment|'# Check that weight was set to 0'
nl|'\n'
name|'dev'
op|'='
name|'ring'
op|'.'
name|'devs'
op|'['
op|'-'
number|'1'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'weight'"
op|']'
op|','
number|'0'
op|')'
newline|'\n'
nl|'\n'
comment|'# Check that device is in list of devices to be removed'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'region'"
op|']'
op|','
number|'2'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'zone'"
op|']'
op|','
number|'3'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'ip'"
op|']'
op|','
string|"'3001:0:1234::c1c0:abcd:876'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'port'"
op|']'
op|','
number|'8000'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'device'"
op|']'
op|','
string|"'sda30'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'weight'"
op|']'
op|','
number|'0'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'replication_ip'"
op|']'
op|','
string|"'3::10'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'replication_port'"
op|']'
op|','
number|'9000'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'meta'"
op|']'
op|','
string|"'other meta data'"
op|')'
newline|'\n'
nl|'\n'
comment|'# Final check, rebalance and check ring is ok'
nl|'\n'
name|'ring'
op|'.'
name|'rebalance'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'ring'
op|'.'
name|'validate'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_remove_device_domain_new_format
dedent|''
name|'def'
name|'test_remove_device_domain_new_format'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'create_sample_ring'
op|'('
op|')'
newline|'\n'
comment|'# add domain name'
nl|'\n'
name|'argv'
op|'='
op|'['
string|'""'
op|','
name|'self'
op|'.'
name|'tmpfile'
op|','
string|'"add"'
op|','
nl|'\n'
string|'"--region"'
op|','
string|'"2"'
op|','
string|'"--zone"'
op|','
string|'"3"'
op|','
nl|'\n'
string|'"--ip"'
op|','
string|'"test.test.com"'
op|','
nl|'\n'
string|'"--port"'
op|','
string|'"6000"'
op|','
nl|'\n'
string|'"--replication-ip"'
op|','
string|'"r.test.com"'
op|','
nl|'\n'
string|'"--replication-port"'
op|','
string|'"7000"'
op|','
nl|'\n'
string|'"--device"'
op|','
string|'"sda3"'
op|','
string|'"--meta"'
op|','
string|'"some meta data"'
op|','
nl|'\n'
string|'"--weight"'
op|','
string|'"3.14159265359"'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'SystemExit'
op|','
name|'ringbuilder'
op|'.'
name|'main'
op|','
name|'argv'
op|')'
newline|'\n'
nl|'\n'
comment|'# Test domain name'
nl|'\n'
name|'argv'
op|'='
op|'['
string|'""'
op|','
name|'self'
op|'.'
name|'tmpfile'
op|','
string|'"remove"'
op|','
nl|'\n'
string|'"--id"'
op|','
string|'"4"'
op|','
string|'"--region"'
op|','
string|'"2"'
op|','
string|'"--zone"'
op|','
string|'"3"'
op|','
nl|'\n'
string|'"--ip"'
op|','
string|'"test.test.com"'
op|','
nl|'\n'
string|'"--port"'
op|','
string|'"6000"'
op|','
nl|'\n'
string|'"--replication-ip"'
op|','
string|'"r.test.com"'
op|','
nl|'\n'
string|'"--replication-port"'
op|','
string|'"7000"'
op|','
nl|'\n'
string|'"--device"'
op|','
string|'"sda3"'
op|','
string|'"--meta"'
op|','
string|'"some meta data"'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'SystemExit'
op|','
name|'ringbuilder'
op|'.'
name|'main'
op|','
name|'argv'
op|')'
newline|'\n'
name|'ring'
op|'='
name|'RingBuilder'
op|'.'
name|'load'
op|'('
name|'self'
op|'.'
name|'tmpfile'
op|')'
newline|'\n'
nl|'\n'
comment|'# Check that second device in ring is not affected'
nl|'\n'
name|'dev'
op|'='
name|'ring'
op|'.'
name|'devs'
op|'['
number|'0'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'weight'"
op|']'
op|','
number|'100'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
op|'['
name|'d'
name|'for'
name|'d'
name|'in'
name|'ring'
op|'.'
name|'_remove_devs'
name|'if'
name|'d'
op|'['
string|"'id'"
op|']'
op|'=='
number|'0'
op|']'
op|')'
newline|'\n'
nl|'\n'
comment|'# Check that second device in ring is not affected'
nl|'\n'
name|'dev'
op|'='
name|'ring'
op|'.'
name|'devs'
op|'['
number|'1'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'weight'"
op|']'
op|','
number|'100'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
op|'['
name|'d'
name|'for'
name|'d'
name|'in'
name|'ring'
op|'.'
name|'_remove_devs'
name|'if'
name|'d'
op|'['
string|"'id'"
op|']'
op|'=='
number|'1'
op|']'
op|')'
newline|'\n'
nl|'\n'
comment|'# Check that weight was set to 0'
nl|'\n'
name|'dev'
op|'='
name|'ring'
op|'.'
name|'devs'
op|'['
op|'-'
number|'1'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'weight'"
op|']'
op|','
number|'0'
op|')'
newline|'\n'
nl|'\n'
comment|'# Check that device is in list of devices to be removed'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'region'"
op|']'
op|','
number|'2'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'zone'"
op|']'
op|','
number|'3'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'ip'"
op|']'
op|','
string|"'test.test.com'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'port'"
op|']'
op|','
number|'6000'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'device'"
op|']'
op|','
string|"'sda3'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'weight'"
op|']'
op|','
number|'0'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'replication_ip'"
op|']'
op|','
string|"'r.test.com'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'replication_port'"
op|']'
op|','
number|'7000'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'meta'"
op|']'
op|','
string|"'some meta data'"
op|')'
newline|'\n'
nl|'\n'
comment|'# Final check, rebalance and check ring is ok'
nl|'\n'
name|'ring'
op|'.'
name|'rebalance'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'ring'
op|'.'
name|'validate'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_remove_device_number_of_arguments
dedent|''
name|'def'
name|'test_remove_device_number_of_arguments'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'create_sample_ring'
op|'('
op|')'
newline|'\n'
comment|'# Test Number of arguments abnormal'
nl|'\n'
name|'argv'
op|'='
op|'['
string|'""'
op|','
name|'self'
op|'.'
name|'tmpfile'
op|','
string|'"remove"'
op|']'
newline|'\n'
name|'err'
op|'='
name|'None'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'ringbuilder'
op|'.'
name|'main'
op|'('
name|'argv'
op|')'
newline|'\n'
dedent|''
name|'except'
name|'SystemExit'
name|'as'
name|'e'
op|':'
newline|'\n'
indent|'            '
name|'err'
op|'='
name|'e'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'err'
op|'.'
name|'code'
op|','
number|'2'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_remove_device_no_matching
dedent|''
name|'def'
name|'test_remove_device_no_matching'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'create_sample_ring'
op|'('
op|')'
newline|'\n'
comment|'# Test No matching devices'
nl|'\n'
name|'argv'
op|'='
op|'['
string|'""'
op|','
name|'self'
op|'.'
name|'tmpfile'
op|','
string|'"remove"'
op|','
nl|'\n'
string|'"--ip"'
op|','
string|'"unknown"'
op|']'
newline|'\n'
name|'err'
op|'='
name|'None'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'ringbuilder'
op|'.'
name|'main'
op|'('
name|'argv'
op|')'
newline|'\n'
dedent|''
name|'except'
name|'SystemExit'
name|'as'
name|'e'
op|':'
newline|'\n'
indent|'            '
name|'err'
op|'='
name|'e'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'err'
op|'.'
name|'code'
op|','
number|'2'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_set_weight
dedent|''
name|'def'
name|'test_set_weight'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'for'
name|'search_value'
name|'in'
name|'self'
op|'.'
name|'search_values'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'create_sample_ring'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'argv'
op|'='
op|'['
string|'""'
op|','
name|'self'
op|'.'
name|'tmpfile'
op|','
string|'"set_weight"'
op|','
nl|'\n'
name|'search_value'
op|','
string|'"3.14159265359"'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'SystemExit'
op|','
name|'ringbuilder'
op|'.'
name|'main'
op|','
name|'argv'
op|')'
newline|'\n'
name|'ring'
op|'='
name|'RingBuilder'
op|'.'
name|'load'
op|'('
name|'self'
op|'.'
name|'tmpfile'
op|')'
newline|'\n'
nl|'\n'
comment|'# Check that weight was changed'
nl|'\n'
name|'dev'
op|'='
name|'ring'
op|'.'
name|'devs'
op|'['
number|'0'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'weight'"
op|']'
op|','
number|'3.14159265359'
op|')'
newline|'\n'
nl|'\n'
comment|'# Check that second device in ring is not affected'
nl|'\n'
name|'dev'
op|'='
name|'ring'
op|'.'
name|'devs'
op|'['
number|'1'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'weight'"
op|']'
op|','
number|'100'
op|')'
newline|'\n'
nl|'\n'
comment|'# Final check, rebalance and check ring is ok'
nl|'\n'
name|'ring'
op|'.'
name|'rebalance'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'ring'
op|'.'
name|'validate'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_set_weight_ipv4_old_format
dedent|''
dedent|''
name|'def'
name|'test_set_weight_ipv4_old_format'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'create_sample_ring'
op|'('
op|')'
newline|'\n'
comment|'# Test ipv4(old format)'
nl|'\n'
name|'argv'
op|'='
op|'['
string|'""'
op|','
name|'self'
op|'.'
name|'tmpfile'
op|','
string|'"set_weight"'
op|','
nl|'\n'
string|'"d0r0z0-127.0.0.1:6000R127.0.0.1:6000/sda1_some meta data"'
op|','
nl|'\n'
string|'"3.14159265359"'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'SystemExit'
op|','
name|'ringbuilder'
op|'.'
name|'main'
op|','
name|'argv'
op|')'
newline|'\n'
name|'ring'
op|'='
name|'RingBuilder'
op|'.'
name|'load'
op|'('
name|'self'
op|'.'
name|'tmpfile'
op|')'
newline|'\n'
nl|'\n'
comment|'# Check that weight was changed'
nl|'\n'
name|'dev'
op|'='
name|'ring'
op|'.'
name|'devs'
op|'['
number|'0'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'weight'"
op|']'
op|','
number|'3.14159265359'
op|')'
newline|'\n'
nl|'\n'
comment|'# Check that second device in ring is not affected'
nl|'\n'
name|'dev'
op|'='
name|'ring'
op|'.'
name|'devs'
op|'['
number|'1'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'weight'"
op|']'
op|','
number|'100'
op|')'
newline|'\n'
nl|'\n'
comment|'# Final check, rebalance and check ring is ok'
nl|'\n'
name|'ring'
op|'.'
name|'rebalance'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'ring'
op|'.'
name|'validate'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_set_weight_ipv6_old_format
dedent|''
name|'def'
name|'test_set_weight_ipv6_old_format'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'create_sample_ring'
op|'('
op|')'
newline|'\n'
comment|'# add IPV6'
nl|'\n'
name|'argv'
op|'='
op|'['
string|'""'
op|','
name|'self'
op|'.'
name|'tmpfile'
op|','
string|'"add"'
op|','
nl|'\n'
string|'"--region"'
op|','
string|'"2"'
op|','
string|'"--zone"'
op|','
string|'"3"'
op|','
nl|'\n'
string|'"--ip"'
op|','
string|'"[2001:0000:1234:0000:0000:C1C0:ABCD:0876]"'
op|','
nl|'\n'
string|'"--port"'
op|','
string|'"6000"'
op|','
nl|'\n'
string|'"--replication-ip"'
op|','
string|'"[2::10]"'
op|','
nl|'\n'
string|'"--replication-port"'
op|','
string|'"7000"'
op|','
nl|'\n'
string|'"--device"'
op|','
string|'"sda3"'
op|','
string|'"--meta"'
op|','
string|'"some meta data"'
op|','
nl|'\n'
string|'"--weight"'
op|','
string|'"100"'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'SystemExit'
op|','
name|'ringbuilder'
op|'.'
name|'main'
op|','
name|'argv'
op|')'
newline|'\n'
nl|'\n'
comment|'# Test ipv6(old format)'
nl|'\n'
name|'argv'
op|'='
op|'['
string|'""'
op|','
name|'self'
op|'.'
name|'tmpfile'
op|','
string|'"set_weight"'
op|','
nl|'\n'
string|'"d4r2z3-[2001:0000:1234:0000:0000:C1C0:ABCD:0876]:6000"'
nl|'\n'
string|'"R[2::10]:7000/sda3_some meta data"'
op|','
string|'"3.14159265359"'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'SystemExit'
op|','
name|'ringbuilder'
op|'.'
name|'main'
op|','
name|'argv'
op|')'
newline|'\n'
name|'ring'
op|'='
name|'RingBuilder'
op|'.'
name|'load'
op|'('
name|'self'
op|'.'
name|'tmpfile'
op|')'
newline|'\n'
nl|'\n'
comment|'# Check that second device in ring is not affected'
nl|'\n'
name|'dev'
op|'='
name|'ring'
op|'.'
name|'devs'
op|'['
number|'0'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'weight'"
op|']'
op|','
number|'100'
op|')'
newline|'\n'
nl|'\n'
comment|'# Check that second device in ring is not affected'
nl|'\n'
name|'dev'
op|'='
name|'ring'
op|'.'
name|'devs'
op|'['
number|'1'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'weight'"
op|']'
op|','
number|'100'
op|')'
newline|'\n'
nl|'\n'
comment|'# Check that weight was changed'
nl|'\n'
name|'dev'
op|'='
name|'ring'
op|'.'
name|'devs'
op|'['
op|'-'
number|'1'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'weight'"
op|']'
op|','
number|'3.14159265359'
op|')'
newline|'\n'
nl|'\n'
comment|'# Final check, rebalance and check ring is ok'
nl|'\n'
name|'ring'
op|'.'
name|'rebalance'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'ring'
op|'.'
name|'validate'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_set_weight_ipv4_new_format
dedent|''
name|'def'
name|'test_set_weight_ipv4_new_format'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'create_sample_ring'
op|'('
op|')'
newline|'\n'
comment|'# Test ipv4(new format)'
nl|'\n'
name|'argv'
op|'='
op|'['
string|'""'
op|','
name|'self'
op|'.'
name|'tmpfile'
op|','
string|'"set_weight"'
op|','
nl|'\n'
string|'"--id"'
op|','
string|'"0"'
op|','
string|'"--region"'
op|','
string|'"0"'
op|','
string|'"--zone"'
op|','
string|'"0"'
op|','
nl|'\n'
string|'"--ip"'
op|','
string|'"127.0.0.1"'
op|','
nl|'\n'
string|'"--port"'
op|','
string|'"6000"'
op|','
nl|'\n'
string|'"--replication-ip"'
op|','
string|'"127.0.0.1"'
op|','
nl|'\n'
string|'"--replication-port"'
op|','
string|'"6000"'
op|','
nl|'\n'
string|'"--device"'
op|','
string|'"sda1"'
op|','
string|'"--meta"'
op|','
string|'"some meta data"'
op|','
string|'"3.14159265359"'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'SystemExit'
op|','
name|'ringbuilder'
op|'.'
name|'main'
op|','
name|'argv'
op|')'
newline|'\n'
name|'ring'
op|'='
name|'RingBuilder'
op|'.'
name|'load'
op|'('
name|'self'
op|'.'
name|'tmpfile'
op|')'
newline|'\n'
nl|'\n'
comment|'# Check that weight was changed'
nl|'\n'
name|'dev'
op|'='
name|'ring'
op|'.'
name|'devs'
op|'['
number|'0'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'weight'"
op|']'
op|','
number|'3.14159265359'
op|')'
newline|'\n'
nl|'\n'
comment|'# Check that second device in ring is not affected'
nl|'\n'
name|'dev'
op|'='
name|'ring'
op|'.'
name|'devs'
op|'['
number|'1'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'weight'"
op|']'
op|','
number|'100'
op|')'
newline|'\n'
nl|'\n'
comment|'# Final check, rebalance and check ring is ok'
nl|'\n'
name|'ring'
op|'.'
name|'rebalance'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'ring'
op|'.'
name|'validate'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_set_weight_ipv6_new_format
dedent|''
name|'def'
name|'test_set_weight_ipv6_new_format'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'create_sample_ring'
op|'('
op|')'
newline|'\n'
comment|'# add IPV6'
nl|'\n'
name|'argv'
op|'='
op|'['
string|'""'
op|','
name|'self'
op|'.'
name|'tmpfile'
op|','
string|'"add"'
op|','
nl|'\n'
string|'"--region"'
op|','
string|'"2"'
op|','
string|'"--zone"'
op|','
string|'"3"'
op|','
nl|'\n'
string|'"--ip"'
op|','
string|'"[2001:0000:1234:0000:0000:C1C0:ABCD:0876]"'
op|','
nl|'\n'
string|'"--port"'
op|','
string|'"6000"'
op|','
nl|'\n'
string|'"--replication-ip"'
op|','
string|'"[2::10]"'
op|','
nl|'\n'
string|'"--replication-port"'
op|','
string|'"7000"'
op|','
nl|'\n'
string|'"--device"'
op|','
string|'"sda3"'
op|','
string|'"--meta"'
op|','
string|'"some meta data"'
op|','
nl|'\n'
string|'"--weight"'
op|','
string|'"100"'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'SystemExit'
op|','
name|'ringbuilder'
op|'.'
name|'main'
op|','
name|'argv'
op|')'
newline|'\n'
nl|'\n'
comment|'# Test ipv6(new format)'
nl|'\n'
name|'argv'
op|'='
op|'['
string|'""'
op|','
name|'self'
op|'.'
name|'tmpfile'
op|','
string|'"set_weight"'
op|','
nl|'\n'
string|'"--id"'
op|','
string|'"4"'
op|','
string|'"--region"'
op|','
string|'"2"'
op|','
string|'"--zone"'
op|','
string|'"3"'
op|','
nl|'\n'
string|'"--ip"'
op|','
string|'"[2001:0000:1234:0000:0000:C1C0:ABCD:0876]"'
op|','
nl|'\n'
string|'"--port"'
op|','
string|'"6000"'
op|','
nl|'\n'
string|'"--replication-ip"'
op|','
string|'"[2::10]"'
op|','
nl|'\n'
string|'"--replication-port"'
op|','
string|'"7000"'
op|','
nl|'\n'
string|'"--device"'
op|','
string|'"sda3"'
op|','
string|'"--meta"'
op|','
string|'"some meta data"'
op|','
string|'"3.14159265359"'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'SystemExit'
op|','
name|'ringbuilder'
op|'.'
name|'main'
op|','
name|'argv'
op|')'
newline|'\n'
name|'ring'
op|'='
name|'RingBuilder'
op|'.'
name|'load'
op|'('
name|'self'
op|'.'
name|'tmpfile'
op|')'
newline|'\n'
nl|'\n'
comment|'# Check that second device in ring is not affected'
nl|'\n'
name|'dev'
op|'='
name|'ring'
op|'.'
name|'devs'
op|'['
number|'0'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'weight'"
op|']'
op|','
number|'100'
op|')'
newline|'\n'
nl|'\n'
comment|'# Check that second device in ring is not affected'
nl|'\n'
name|'dev'
op|'='
name|'ring'
op|'.'
name|'devs'
op|'['
number|'1'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'weight'"
op|']'
op|','
number|'100'
op|')'
newline|'\n'
nl|'\n'
comment|'# Check that weight was changed'
nl|'\n'
name|'dev'
op|'='
name|'ring'
op|'.'
name|'devs'
op|'['
op|'-'
number|'1'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'weight'"
op|']'
op|','
number|'3.14159265359'
op|')'
newline|'\n'
nl|'\n'
comment|'# Final check, rebalance and check ring is ok'
nl|'\n'
name|'ring'
op|'.'
name|'rebalance'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'ring'
op|'.'
name|'validate'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_set_weight_domain_new_format
dedent|''
name|'def'
name|'test_set_weight_domain_new_format'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'create_sample_ring'
op|'('
op|')'
newline|'\n'
comment|'# add domain name'
nl|'\n'
name|'argv'
op|'='
op|'['
string|'""'
op|','
name|'self'
op|'.'
name|'tmpfile'
op|','
string|'"add"'
op|','
nl|'\n'
string|'"--region"'
op|','
string|'"2"'
op|','
string|'"--zone"'
op|','
string|'"3"'
op|','
nl|'\n'
string|'"--ip"'
op|','
string|'"test.test.com"'
op|','
nl|'\n'
string|'"--port"'
op|','
string|'"6000"'
op|','
nl|'\n'
string|'"--replication-ip"'
op|','
string|'"r.test.com"'
op|','
nl|'\n'
string|'"--replication-port"'
op|','
string|'"7000"'
op|','
nl|'\n'
string|'"--device"'
op|','
string|'"sda3"'
op|','
string|'"--meta"'
op|','
string|'"some meta data"'
op|','
nl|'\n'
string|'"--weight"'
op|','
string|'"100"'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'SystemExit'
op|','
name|'ringbuilder'
op|'.'
name|'main'
op|','
name|'argv'
op|')'
newline|'\n'
nl|'\n'
comment|'# Test domain name'
nl|'\n'
name|'argv'
op|'='
op|'['
string|'""'
op|','
name|'self'
op|'.'
name|'tmpfile'
op|','
string|'"set_weight"'
op|','
nl|'\n'
string|'"--id"'
op|','
string|'"4"'
op|','
string|'"--region"'
op|','
string|'"2"'
op|','
string|'"--zone"'
op|','
string|'"3"'
op|','
nl|'\n'
string|'"--ip"'
op|','
string|'"test.test.com"'
op|','
nl|'\n'
string|'"--port"'
op|','
string|'"6000"'
op|','
nl|'\n'
string|'"--replication-ip"'
op|','
string|'"r.test.com"'
op|','
nl|'\n'
string|'"--replication-port"'
op|','
string|'"7000"'
op|','
nl|'\n'
string|'"--device"'
op|','
string|'"sda3"'
op|','
string|'"--meta"'
op|','
string|'"some meta data"'
op|','
string|'"3.14159265359"'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'SystemExit'
op|','
name|'ringbuilder'
op|'.'
name|'main'
op|','
name|'argv'
op|')'
newline|'\n'
name|'ring'
op|'='
name|'RingBuilder'
op|'.'
name|'load'
op|'('
name|'self'
op|'.'
name|'tmpfile'
op|')'
newline|'\n'
nl|'\n'
comment|'# Check that second device in ring is not affected'
nl|'\n'
name|'dev'
op|'='
name|'ring'
op|'.'
name|'devs'
op|'['
number|'0'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'weight'"
op|']'
op|','
number|'100'
op|')'
newline|'\n'
nl|'\n'
comment|'# Check that second device in ring is not affected'
nl|'\n'
name|'dev'
op|'='
name|'ring'
op|'.'
name|'devs'
op|'['
number|'1'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'weight'"
op|']'
op|','
number|'100'
op|')'
newline|'\n'
nl|'\n'
comment|'# Check that weight was changed'
nl|'\n'
name|'dev'
op|'='
name|'ring'
op|'.'
name|'devs'
op|'['
op|'-'
number|'1'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'weight'"
op|']'
op|','
number|'3.14159265359'
op|')'
newline|'\n'
nl|'\n'
comment|'# Final check, rebalance and check ring is ok'
nl|'\n'
name|'ring'
op|'.'
name|'rebalance'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'ring'
op|'.'
name|'validate'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_set_weight_number_of_arguments
dedent|''
name|'def'
name|'test_set_weight_number_of_arguments'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'create_sample_ring'
op|'('
op|')'
newline|'\n'
comment|'# Test Number of arguments abnormal'
nl|'\n'
name|'argv'
op|'='
op|'['
string|'""'
op|','
name|'self'
op|'.'
name|'tmpfile'
op|','
string|'"set_weight"'
op|']'
newline|'\n'
name|'err'
op|'='
name|'None'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'ringbuilder'
op|'.'
name|'main'
op|'('
name|'argv'
op|')'
newline|'\n'
dedent|''
name|'except'
name|'SystemExit'
name|'as'
name|'e'
op|':'
newline|'\n'
indent|'            '
name|'err'
op|'='
name|'e'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'err'
op|'.'
name|'code'
op|','
number|'2'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_set_weight_no_matching
dedent|''
name|'def'
name|'test_set_weight_no_matching'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'create_sample_ring'
op|'('
op|')'
newline|'\n'
comment|'# Test No matching devices'
nl|'\n'
name|'argv'
op|'='
op|'['
string|'""'
op|','
name|'self'
op|'.'
name|'tmpfile'
op|','
string|'"set_weight"'
op|','
nl|'\n'
string|'"--ip"'
op|','
string|'"unknown"'
op|']'
newline|'\n'
name|'err'
op|'='
name|'None'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'ringbuilder'
op|'.'
name|'main'
op|'('
name|'argv'
op|')'
newline|'\n'
dedent|''
name|'except'
name|'SystemExit'
name|'as'
name|'e'
op|':'
newline|'\n'
indent|'            '
name|'err'
op|'='
name|'e'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'err'
op|'.'
name|'code'
op|','
number|'2'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_set_info
dedent|''
name|'def'
name|'test_set_info'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'for'
name|'search_value'
name|'in'
name|'self'
op|'.'
name|'search_values'
op|':'
newline|'\n'
nl|'\n'
indent|'            '
name|'self'
op|'.'
name|'create_sample_ring'
op|'('
op|')'
newline|'\n'
name|'argv'
op|'='
op|'['
string|'""'
op|','
name|'self'
op|'.'
name|'tmpfile'
op|','
string|'"set_info"'
op|','
name|'search_value'
op|','
nl|'\n'
string|'"127.0.1.1:8000/sda1_other meta data"'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'SystemExit'
op|','
name|'ringbuilder'
op|'.'
name|'main'
op|','
name|'argv'
op|')'
newline|'\n'
nl|'\n'
comment|'# Check that device was created with given data'
nl|'\n'
name|'ring'
op|'='
name|'RingBuilder'
op|'.'
name|'load'
op|'('
name|'self'
op|'.'
name|'tmpfile'
op|')'
newline|'\n'
name|'dev'
op|'='
name|'ring'
op|'.'
name|'devs'
op|'['
number|'0'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'ip'"
op|']'
op|','
string|"'127.0.1.1'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'port'"
op|']'
op|','
number|'8000'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'device'"
op|']'
op|','
string|"'sda1'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'meta'"
op|']'
op|','
string|"'other meta data'"
op|')'
newline|'\n'
nl|'\n'
comment|'# Check that second device in ring is not affected'
nl|'\n'
name|'dev'
op|'='
name|'ring'
op|'.'
name|'devs'
op|'['
number|'1'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'ip'"
op|']'
op|','
string|"'127.0.0.2'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'port'"
op|']'
op|','
number|'6001'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'device'"
op|']'
op|','
string|"'sda2'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'meta'"
op|']'
op|','
string|"''"
op|')'
newline|'\n'
nl|'\n'
comment|'# Final check, rebalance and check ring is ok'
nl|'\n'
name|'ring'
op|'.'
name|'rebalance'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'ring'
op|'.'
name|'validate'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_set_info_ipv4_old_format
dedent|''
dedent|''
name|'def'
name|'test_set_info_ipv4_old_format'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'create_sample_ring'
op|'('
op|')'
newline|'\n'
comment|'# Test ipv4(old format)'
nl|'\n'
name|'argv'
op|'='
op|'['
string|'""'
op|','
name|'self'
op|'.'
name|'tmpfile'
op|','
string|'"set_info"'
op|','
nl|'\n'
string|'"d0r0z0-127.0.0.1:6000R127.0.0.1:6000/sda1_some meta data"'
op|','
nl|'\n'
string|'"127.0.1.1:8000R127.0.1.1:8000/sda10_other meta data"'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'SystemExit'
op|','
name|'ringbuilder'
op|'.'
name|'main'
op|','
name|'argv'
op|')'
newline|'\n'
nl|'\n'
comment|'# Check that device was created with given data'
nl|'\n'
name|'ring'
op|'='
name|'RingBuilder'
op|'.'
name|'load'
op|'('
name|'self'
op|'.'
name|'tmpfile'
op|')'
newline|'\n'
name|'dev'
op|'='
name|'ring'
op|'.'
name|'devs'
op|'['
number|'0'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'ip'"
op|']'
op|','
string|"'127.0.1.1'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'port'"
op|']'
op|','
number|'8000'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'replication_ip'"
op|']'
op|','
string|"'127.0.1.1'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'replication_port'"
op|']'
op|','
number|'8000'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'device'"
op|']'
op|','
string|"'sda10'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'meta'"
op|']'
op|','
string|"'other meta data'"
op|')'
newline|'\n'
nl|'\n'
comment|'# Check that second device in ring is not affected'
nl|'\n'
name|'dev'
op|'='
name|'ring'
op|'.'
name|'devs'
op|'['
number|'1'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'ip'"
op|']'
op|','
string|"'127.0.0.2'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'port'"
op|']'
op|','
number|'6001'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'device'"
op|']'
op|','
string|"'sda2'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'meta'"
op|']'
op|','
string|"''"
op|')'
newline|'\n'
nl|'\n'
comment|'# Final check, rebalance and check ring is ok'
nl|'\n'
name|'ring'
op|'.'
name|'rebalance'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'ring'
op|'.'
name|'validate'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_set_info_ipv6_old_format
dedent|''
name|'def'
name|'test_set_info_ipv6_old_format'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'create_sample_ring'
op|'('
op|')'
newline|'\n'
comment|'# add IPV6'
nl|'\n'
name|'argv'
op|'='
op|'['
string|'""'
op|','
name|'self'
op|'.'
name|'tmpfile'
op|','
string|'"add"'
op|','
nl|'\n'
string|'"--region"'
op|','
string|'"2"'
op|','
string|'"--zone"'
op|','
string|'"3"'
op|','
nl|'\n'
string|'"--ip"'
op|','
string|'"[2001:0000:1234:0000:0000:C1C0:ABCD:0876]"'
op|','
nl|'\n'
string|'"--port"'
op|','
string|'"6000"'
op|','
nl|'\n'
string|'"--replication-ip"'
op|','
string|'"[2::10]"'
op|','
nl|'\n'
string|'"--replication-port"'
op|','
string|'"7000"'
op|','
nl|'\n'
string|'"--device"'
op|','
string|'"sda3"'
op|','
string|'"--meta"'
op|','
string|'"some meta data"'
op|','
nl|'\n'
string|'"--weight"'
op|','
string|'"3.14159265359"'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'SystemExit'
op|','
name|'ringbuilder'
op|'.'
name|'main'
op|','
name|'argv'
op|')'
newline|'\n'
nl|'\n'
comment|'# Test ipv6(old format)'
nl|'\n'
name|'argv'
op|'='
op|'['
string|'""'
op|','
name|'self'
op|'.'
name|'tmpfile'
op|','
string|'"set_info"'
op|','
nl|'\n'
string|'"d4r2z3-[2001:0000:1234:0000:0000:C1C0:ABCD:0876]:6000"'
nl|'\n'
string|'"R[2::10]:7000/sda3_some meta data"'
op|','
nl|'\n'
string|'"[3001:0000:1234:0000:0000:C1C0:ABCD:0876]:8000"'
nl|'\n'
string|'"R[3::10]:8000/sda30_other meta data"'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'SystemExit'
op|','
name|'ringbuilder'
op|'.'
name|'main'
op|','
name|'argv'
op|')'
newline|'\n'
name|'ring'
op|'='
name|'RingBuilder'
op|'.'
name|'load'
op|'('
name|'self'
op|'.'
name|'tmpfile'
op|')'
newline|'\n'
nl|'\n'
comment|'# Check that second device in ring is not affected'
nl|'\n'
name|'dev'
op|'='
name|'ring'
op|'.'
name|'devs'
op|'['
number|'0'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'ip'"
op|']'
op|','
string|"'127.0.0.1'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'port'"
op|']'
op|','
number|'6000'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'replication_ip'"
op|']'
op|','
string|"'127.0.0.1'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'replication_port'"
op|']'
op|','
number|'6000'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'device'"
op|']'
op|','
string|"'sda1'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'meta'"
op|']'
op|','
string|"'some meta data'"
op|')'
newline|'\n'
nl|'\n'
comment|'# Check that second device in ring is not affected'
nl|'\n'
name|'dev'
op|'='
name|'ring'
op|'.'
name|'devs'
op|'['
number|'1'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'ip'"
op|']'
op|','
string|"'127.0.0.2'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'port'"
op|']'
op|','
number|'6001'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'device'"
op|']'
op|','
string|"'sda2'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'meta'"
op|']'
op|','
string|"''"
op|')'
newline|'\n'
nl|'\n'
comment|'# Check that device was created with given data'
nl|'\n'
name|'dev'
op|'='
name|'ring'
op|'.'
name|'devs'
op|'['
op|'-'
number|'1'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'ip'"
op|']'
op|','
string|"'3001:0:1234::c1c0:abcd:876'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'port'"
op|']'
op|','
number|'8000'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'replication_ip'"
op|']'
op|','
string|"'3::10'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'replication_port'"
op|']'
op|','
number|'8000'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'device'"
op|']'
op|','
string|"'sda30'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'meta'"
op|']'
op|','
string|"'other meta data'"
op|')'
newline|'\n'
nl|'\n'
comment|'# Final check, rebalance and check ring is ok'
nl|'\n'
name|'ring'
op|'.'
name|'rebalance'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'ring'
op|'.'
name|'validate'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_set_info_ipv4_new_format
dedent|''
name|'def'
name|'test_set_info_ipv4_new_format'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'create_sample_ring'
op|'('
op|')'
newline|'\n'
comment|'# Test ipv4(new format)'
nl|'\n'
name|'argv'
op|'='
op|'['
string|'""'
op|','
name|'self'
op|'.'
name|'tmpfile'
op|','
string|'"set_info"'
op|','
nl|'\n'
string|'"--id"'
op|','
string|'"0"'
op|','
string|'"--region"'
op|','
string|'"0"'
op|','
string|'"--zone"'
op|','
string|'"0"'
op|','
nl|'\n'
string|'"--ip"'
op|','
string|'"127.0.0.1"'
op|','
nl|'\n'
string|'"--port"'
op|','
string|'"6000"'
op|','
nl|'\n'
string|'"--replication-ip"'
op|','
string|'"127.0.0.1"'
op|','
nl|'\n'
string|'"--replication-port"'
op|','
string|'"6000"'
op|','
nl|'\n'
string|'"--device"'
op|','
string|'"sda1"'
op|','
string|'"--meta"'
op|','
string|'"some meta data"'
op|','
nl|'\n'
string|'"--change-ip"'
op|','
string|'"127.0.2.1"'
op|','
nl|'\n'
string|'"--change-port"'
op|','
string|'"9000"'
op|','
nl|'\n'
string|'"--change-replication-ip"'
op|','
string|'"127.0.2.1"'
op|','
nl|'\n'
string|'"--change-replication-port"'
op|','
string|'"9000"'
op|','
nl|'\n'
string|'"--change-device"'
op|','
string|'"sda100"'
op|','
string|'"--change-meta"'
op|','
string|'"other meta data"'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'SystemExit'
op|','
name|'ringbuilder'
op|'.'
name|'main'
op|','
name|'argv'
op|')'
newline|'\n'
nl|'\n'
comment|'# Check that device was created with given data'
nl|'\n'
name|'ring'
op|'='
name|'RingBuilder'
op|'.'
name|'load'
op|'('
name|'self'
op|'.'
name|'tmpfile'
op|')'
newline|'\n'
name|'dev'
op|'='
name|'ring'
op|'.'
name|'devs'
op|'['
number|'0'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'ip'"
op|']'
op|','
string|"'127.0.2.1'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'port'"
op|']'
op|','
number|'9000'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'replication_ip'"
op|']'
op|','
string|"'127.0.2.1'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'replication_port'"
op|']'
op|','
number|'9000'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'device'"
op|']'
op|','
string|"'sda100'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'meta'"
op|']'
op|','
string|"'other meta data'"
op|')'
newline|'\n'
nl|'\n'
comment|'# Check that second device in ring is not affected'
nl|'\n'
name|'dev'
op|'='
name|'ring'
op|'.'
name|'devs'
op|'['
number|'1'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'ip'"
op|']'
op|','
string|"'127.0.0.2'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'port'"
op|']'
op|','
number|'6001'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'device'"
op|']'
op|','
string|"'sda2'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'meta'"
op|']'
op|','
string|"''"
op|')'
newline|'\n'
nl|'\n'
comment|'# Final check, rebalance and check ring is ok'
nl|'\n'
name|'ring'
op|'.'
name|'rebalance'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'ring'
op|'.'
name|'validate'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_set_info_ipv6_new_format
dedent|''
name|'def'
name|'test_set_info_ipv6_new_format'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'create_sample_ring'
op|'('
op|')'
newline|'\n'
comment|'# add IPV6'
nl|'\n'
name|'argv'
op|'='
op|'['
string|'""'
op|','
name|'self'
op|'.'
name|'tmpfile'
op|','
string|'"add"'
op|','
nl|'\n'
string|'"--region"'
op|','
string|'"2"'
op|','
string|'"--zone"'
op|','
string|'"3"'
op|','
nl|'\n'
string|'"--ip"'
op|','
string|'"[2001:0000:1234:0000:0000:C1C0:ABCD:0876]"'
op|','
nl|'\n'
string|'"--port"'
op|','
string|'"6000"'
op|','
nl|'\n'
string|'"--replication-ip"'
op|','
string|'"[2::10]"'
op|','
nl|'\n'
string|'"--replication-port"'
op|','
string|'"7000"'
op|','
nl|'\n'
string|'"--device"'
op|','
string|'"sda3"'
op|','
string|'"--meta"'
op|','
string|'"some meta data"'
op|','
nl|'\n'
string|'"--weight"'
op|','
string|'"3.14159265359"'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'SystemExit'
op|','
name|'ringbuilder'
op|'.'
name|'main'
op|','
name|'argv'
op|')'
newline|'\n'
nl|'\n'
comment|'# Test ipv6(new format)'
nl|'\n'
name|'argv'
op|'='
op|'['
string|'""'
op|','
name|'self'
op|'.'
name|'tmpfile'
op|','
string|'"set_info"'
op|','
nl|'\n'
string|'"--id"'
op|','
string|'"4"'
op|','
string|'"--region"'
op|','
string|'"2"'
op|','
string|'"--zone"'
op|','
string|'"3"'
op|','
nl|'\n'
string|'"--ip"'
op|','
string|'"[2001:0000:1234:0000:0000:C1C0:ABCD:0876]"'
op|','
nl|'\n'
string|'"--port"'
op|','
string|'"6000"'
op|','
nl|'\n'
string|'"--replication-ip"'
op|','
string|'"[2::10]"'
op|','
nl|'\n'
string|'"--replication-port"'
op|','
string|'"7000"'
op|','
nl|'\n'
string|'"--device"'
op|','
string|'"sda3"'
op|','
string|'"--meta"'
op|','
string|'"some meta data"'
op|','
nl|'\n'
string|'"--change-ip"'
op|','
string|'"[4001:0000:1234:0000:0000:C1C0:ABCD:0876]"'
op|','
nl|'\n'
string|'"--change-port"'
op|','
string|'"9000"'
op|','
nl|'\n'
string|'"--change-replication-ip"'
op|','
string|'"[4::10]"'
op|','
nl|'\n'
string|'"--change-replication-port"'
op|','
string|'"9000"'
op|','
nl|'\n'
string|'"--change-device"'
op|','
string|'"sda300"'
op|','
string|'"--change-meta"'
op|','
string|'"other meta data"'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'SystemExit'
op|','
name|'ringbuilder'
op|'.'
name|'main'
op|','
name|'argv'
op|')'
newline|'\n'
name|'ring'
op|'='
name|'RingBuilder'
op|'.'
name|'load'
op|'('
name|'self'
op|'.'
name|'tmpfile'
op|')'
newline|'\n'
nl|'\n'
comment|'# Check that second device in ring is not affected'
nl|'\n'
name|'dev'
op|'='
name|'ring'
op|'.'
name|'devs'
op|'['
number|'0'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'ip'"
op|']'
op|','
string|"'127.0.0.1'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'port'"
op|']'
op|','
number|'6000'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'replication_ip'"
op|']'
op|','
string|"'127.0.0.1'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'replication_port'"
op|']'
op|','
number|'6000'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'device'"
op|']'
op|','
string|"'sda1'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'meta'"
op|']'
op|','
string|"'some meta data'"
op|')'
newline|'\n'
nl|'\n'
comment|'# Check that second device in ring is not affected'
nl|'\n'
name|'dev'
op|'='
name|'ring'
op|'.'
name|'devs'
op|'['
number|'1'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'ip'"
op|']'
op|','
string|"'127.0.0.2'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'port'"
op|']'
op|','
number|'6001'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'device'"
op|']'
op|','
string|"'sda2'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'meta'"
op|']'
op|','
string|"''"
op|')'
newline|'\n'
nl|'\n'
comment|'# Check that device was created with given data'
nl|'\n'
name|'ring'
op|'='
name|'RingBuilder'
op|'.'
name|'load'
op|'('
name|'self'
op|'.'
name|'tmpfile'
op|')'
newline|'\n'
name|'dev'
op|'='
name|'ring'
op|'.'
name|'devs'
op|'['
op|'-'
number|'1'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'ip'"
op|']'
op|','
string|"'4001:0:1234::c1c0:abcd:876'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'port'"
op|']'
op|','
number|'9000'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'replication_ip'"
op|']'
op|','
string|"'4::10'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'replication_port'"
op|']'
op|','
number|'9000'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'device'"
op|']'
op|','
string|"'sda300'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'meta'"
op|']'
op|','
string|"'other meta data'"
op|')'
newline|'\n'
nl|'\n'
comment|'# Final check, rebalance and check ring is ok'
nl|'\n'
name|'ring'
op|'.'
name|'rebalance'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'ring'
op|'.'
name|'validate'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_set_info_domain_new_format
dedent|''
name|'def'
name|'test_set_info_domain_new_format'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'create_sample_ring'
op|'('
op|')'
newline|'\n'
comment|'# add domain name'
nl|'\n'
name|'argv'
op|'='
op|'['
string|'""'
op|','
name|'self'
op|'.'
name|'tmpfile'
op|','
string|'"add"'
op|','
nl|'\n'
string|'"--region"'
op|','
string|'"2"'
op|','
string|'"--zone"'
op|','
string|'"3"'
op|','
nl|'\n'
string|'"--ip"'
op|','
string|'"test.test.com"'
op|','
nl|'\n'
string|'"--port"'
op|','
string|'"6000"'
op|','
nl|'\n'
string|'"--replication-ip"'
op|','
string|'"r.test.com"'
op|','
nl|'\n'
string|'"--replication-port"'
op|','
string|'"7000"'
op|','
nl|'\n'
string|'"--device"'
op|','
string|'"sda3"'
op|','
string|'"--meta"'
op|','
string|'"some meta data"'
op|','
nl|'\n'
string|'"--weight"'
op|','
string|'"3.14159265359"'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'SystemExit'
op|','
name|'ringbuilder'
op|'.'
name|'main'
op|','
name|'argv'
op|')'
newline|'\n'
nl|'\n'
comment|'# Test domain name'
nl|'\n'
name|'argv'
op|'='
op|'['
string|'""'
op|','
name|'self'
op|'.'
name|'tmpfile'
op|','
string|'"set_info"'
op|','
nl|'\n'
string|'"--id"'
op|','
string|'"4"'
op|','
string|'"--region"'
op|','
string|'"2"'
op|','
string|'"--zone"'
op|','
string|'"3"'
op|','
nl|'\n'
string|'"--ip"'
op|','
string|'"test.test.com"'
op|','
nl|'\n'
string|'"--port"'
op|','
string|'"6000"'
op|','
nl|'\n'
string|'"--replication-ip"'
op|','
string|'"r.test.com"'
op|','
nl|'\n'
string|'"--replication-port"'
op|','
string|'"7000"'
op|','
nl|'\n'
string|'"--device"'
op|','
string|'"sda3"'
op|','
string|'"--meta"'
op|','
string|'"some meta data"'
op|','
nl|'\n'
string|'"--change-ip"'
op|','
string|'"test.test2.com"'
op|','
nl|'\n'
string|'"--change-port"'
op|','
string|'"9000"'
op|','
nl|'\n'
string|'"--change-replication-ip"'
op|','
string|'"r.test2.com"'
op|','
nl|'\n'
string|'"--change-replication-port"'
op|','
string|'"9000"'
op|','
nl|'\n'
string|'"--change-device"'
op|','
string|'"sda300"'
op|','
string|'"--change-meta"'
op|','
string|'"other meta data"'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'SystemExit'
op|','
name|'ringbuilder'
op|'.'
name|'main'
op|','
name|'argv'
op|')'
newline|'\n'
name|'ring'
op|'='
name|'RingBuilder'
op|'.'
name|'load'
op|'('
name|'self'
op|'.'
name|'tmpfile'
op|')'
newline|'\n'
nl|'\n'
comment|'# Check that second device in ring is not affected'
nl|'\n'
name|'dev'
op|'='
name|'ring'
op|'.'
name|'devs'
op|'['
number|'0'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'ip'"
op|']'
op|','
string|"'127.0.0.1'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'port'"
op|']'
op|','
number|'6000'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'replication_ip'"
op|']'
op|','
string|"'127.0.0.1'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'replication_port'"
op|']'
op|','
number|'6000'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'device'"
op|']'
op|','
string|"'sda1'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'meta'"
op|']'
op|','
string|"'some meta data'"
op|')'
newline|'\n'
nl|'\n'
comment|'# Check that second device in ring is not affected'
nl|'\n'
name|'dev'
op|'='
name|'ring'
op|'.'
name|'devs'
op|'['
number|'1'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'ip'"
op|']'
op|','
string|"'127.0.0.2'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'port'"
op|']'
op|','
number|'6001'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'device'"
op|']'
op|','
string|"'sda2'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'meta'"
op|']'
op|','
string|"''"
op|')'
newline|'\n'
nl|'\n'
comment|'# Check that device was created with given data'
nl|'\n'
name|'dev'
op|'='
name|'ring'
op|'.'
name|'devs'
op|'['
op|'-'
number|'1'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'ip'"
op|']'
op|','
string|"'test.test2.com'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'port'"
op|']'
op|','
number|'9000'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'replication_ip'"
op|']'
op|','
string|"'r.test2.com'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'replication_port'"
op|']'
op|','
number|'9000'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'device'"
op|']'
op|','
string|"'sda300'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'dev'
op|'['
string|"'meta'"
op|']'
op|','
string|"'other meta data'"
op|')'
newline|'\n'
nl|'\n'
comment|'# Final check, rebalance and check ring is ok'
nl|'\n'
name|'ring'
op|'.'
name|'rebalance'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'ring'
op|'.'
name|'validate'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_set_info_number_of_arguments
dedent|''
name|'def'
name|'test_set_info_number_of_arguments'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'create_sample_ring'
op|'('
op|')'
newline|'\n'
comment|'# Test Number of arguments abnormal'
nl|'\n'
name|'argv'
op|'='
op|'['
string|'""'
op|','
name|'self'
op|'.'
name|'tmpfile'
op|','
string|'"set_info"'
op|']'
newline|'\n'
name|'err'
op|'='
name|'None'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'ringbuilder'
op|'.'
name|'main'
op|'('
name|'argv'
op|')'
newline|'\n'
dedent|''
name|'except'
name|'SystemExit'
name|'as'
name|'e'
op|':'
newline|'\n'
indent|'            '
name|'err'
op|'='
name|'e'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'err'
op|'.'
name|'code'
op|','
number|'2'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_set_info_no_matching
dedent|''
name|'def'
name|'test_set_info_no_matching'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'create_sample_ring'
op|'('
op|')'
newline|'\n'
comment|'# Test No matching devices'
nl|'\n'
name|'argv'
op|'='
op|'['
string|'""'
op|','
name|'self'
op|'.'
name|'tmpfile'
op|','
string|'"set_info"'
op|','
nl|'\n'
string|'"--ip"'
op|','
string|'"unknown"'
op|']'
newline|'\n'
name|'err'
op|'='
name|'None'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'ringbuilder'
op|'.'
name|'main'
op|'('
name|'argv'
op|')'
newline|'\n'
dedent|''
name|'except'
name|'SystemExit'
name|'as'
name|'e'
op|':'
newline|'\n'
indent|'            '
name|'err'
op|'='
name|'e'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'err'
op|'.'
name|'code'
op|','
number|'2'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_set_info_already_exists
dedent|''
name|'def'
name|'test_set_info_already_exists'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'create_sample_ring'
op|'('
op|')'
newline|'\n'
comment|'# Test Set a device that already exists'
nl|'\n'
name|'argv'
op|'='
op|'['
string|'""'
op|','
name|'self'
op|'.'
name|'tmpfile'
op|','
string|'"set_info"'
op|','
nl|'\n'
string|'"--id"'
op|','
string|'"0"'
op|','
string|'"--region"'
op|','
string|'"0"'
op|','
string|'"--zone"'
op|','
string|'"0"'
op|','
nl|'\n'
string|'"--ip"'
op|','
string|'"127.0.0.1"'
op|','
nl|'\n'
string|'"--port"'
op|','
string|'"6000"'
op|','
nl|'\n'
string|'"--replication-ip"'
op|','
string|'"127.0.0.1"'
op|','
nl|'\n'
string|'"--replication-port"'
op|','
string|'"6000"'
op|','
nl|'\n'
string|'"--device"'
op|','
string|'"sda1"'
op|','
string|'"--meta"'
op|','
string|'"some meta data"'
op|','
nl|'\n'
string|'"--change-ip"'
op|','
string|'"127.0.0.2"'
op|','
nl|'\n'
string|'"--change-port"'
op|','
string|'"6001"'
op|','
nl|'\n'
string|'"--change-replication-ip"'
op|','
string|'"127.0.0.2"'
op|','
nl|'\n'
string|'"--change-replication-port"'
op|','
string|'"6001"'
op|','
nl|'\n'
string|'"--change-device"'
op|','
string|'"sda2"'
op|','
string|'"--change-meta"'
op|','
string|'""'
op|']'
newline|'\n'
name|'err'
op|'='
name|'None'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'ringbuilder'
op|'.'
name|'main'
op|'('
name|'argv'
op|')'
newline|'\n'
dedent|''
name|'except'
name|'SystemExit'
name|'as'
name|'e'
op|':'
newline|'\n'
indent|'            '
name|'err'
op|'='
name|'e'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'err'
op|'.'
name|'code'
op|','
number|'2'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_set_min_part_hours
dedent|''
name|'def'
name|'test_set_min_part_hours'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'create_sample_ring'
op|'('
op|')'
newline|'\n'
name|'argv'
op|'='
op|'['
string|'""'
op|','
name|'self'
op|'.'
name|'tmpfile'
op|','
string|'"set_min_part_hours"'
op|','
string|'"24"'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'SystemExit'
op|','
name|'ringbuilder'
op|'.'
name|'main'
op|','
name|'argv'
op|')'
newline|'\n'
name|'ring'
op|'='
name|'RingBuilder'
op|'.'
name|'load'
op|'('
name|'self'
op|'.'
name|'tmpfile'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'ring'
op|'.'
name|'min_part_hours'
op|','
number|'24'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_set_min_part_hours_number_of_arguments
dedent|''
name|'def'
name|'test_set_min_part_hours_number_of_arguments'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'create_sample_ring'
op|'('
op|')'
newline|'\n'
comment|'# Test Number of arguments abnormal'
nl|'\n'
name|'argv'
op|'='
op|'['
string|'""'
op|','
name|'self'
op|'.'
name|'tmpfile'
op|','
string|'"set_min_part_hours"'
op|']'
newline|'\n'
name|'err'
op|'='
name|'None'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'ringbuilder'
op|'.'
name|'main'
op|'('
name|'argv'
op|')'
newline|'\n'
dedent|''
name|'except'
name|'SystemExit'
name|'as'
name|'e'
op|':'
newline|'\n'
indent|'            '
name|'err'
op|'='
name|'e'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'err'
op|'.'
name|'code'
op|','
number|'2'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_set_replicas
dedent|''
name|'def'
name|'test_set_replicas'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'create_sample_ring'
op|'('
op|')'
newline|'\n'
name|'argv'
op|'='
op|'['
string|'""'
op|','
name|'self'
op|'.'
name|'tmpfile'
op|','
string|'"set_replicas"'
op|','
string|'"3.14159265359"'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'SystemExit'
op|','
name|'ringbuilder'
op|'.'
name|'main'
op|','
name|'argv'
op|')'
newline|'\n'
name|'ring'
op|'='
name|'RingBuilder'
op|'.'
name|'load'
op|'('
name|'self'
op|'.'
name|'tmpfile'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'ring'
op|'.'
name|'replicas'
op|','
number|'3.14159265359'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_set_overload
dedent|''
name|'def'
name|'test_set_overload'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'create_sample_ring'
op|'('
op|')'
newline|'\n'
name|'argv'
op|'='
op|'['
string|'""'
op|','
name|'self'
op|'.'
name|'tmpfile'
op|','
string|'"set_overload"'
op|','
string|'"0.19878"'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'SystemExit'
op|','
name|'ringbuilder'
op|'.'
name|'main'
op|','
name|'argv'
op|')'
newline|'\n'
name|'ring'
op|'='
name|'RingBuilder'
op|'.'
name|'load'
op|'('
name|'self'
op|'.'
name|'tmpfile'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'ring'
op|'.'
name|'overload'
op|','
number|'0.19878'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_set_overload_negative
dedent|''
name|'def'
name|'test_set_overload_negative'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'create_sample_ring'
op|'('
op|')'
newline|'\n'
name|'argv'
op|'='
op|'['
string|'""'
op|','
name|'self'
op|'.'
name|'tmpfile'
op|','
string|'"set_overload"'
op|','
string|'"-0.19878"'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'SystemExit'
op|','
name|'ringbuilder'
op|'.'
name|'main'
op|','
name|'argv'
op|')'
newline|'\n'
name|'ring'
op|'='
name|'RingBuilder'
op|'.'
name|'load'
op|'('
name|'self'
op|'.'
name|'tmpfile'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'ring'
op|'.'
name|'overload'
op|','
number|'0.0'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_set_overload_non_numeric
dedent|''
name|'def'
name|'test_set_overload_non_numeric'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'create_sample_ring'
op|'('
op|')'
newline|'\n'
name|'argv'
op|'='
op|'['
string|'""'
op|','
name|'self'
op|'.'
name|'tmpfile'
op|','
string|'"set_overload"'
op|','
string|'"swedish fish"'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'SystemExit'
op|','
name|'ringbuilder'
op|'.'
name|'main'
op|','
name|'argv'
op|')'
newline|'\n'
name|'ring'
op|'='
name|'RingBuilder'
op|'.'
name|'load'
op|'('
name|'self'
op|'.'
name|'tmpfile'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'ring'
op|'.'
name|'overload'
op|','
number|'0.0'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_set_overload_percent
dedent|''
name|'def'
name|'test_set_overload_percent'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'create_sample_ring'
op|'('
op|')'
newline|'\n'
name|'argv'
op|'='
string|'"set_overload 10%"'
op|'.'
name|'split'
op|'('
op|')'
newline|'\n'
name|'out'
op|','
name|'err'
op|'='
name|'self'
op|'.'
name|'run_srb'
op|'('
op|'*'
name|'argv'
op|')'
newline|'\n'
name|'ring'
op|'='
name|'RingBuilder'
op|'.'
name|'load'
op|'('
name|'self'
op|'.'
name|'tmpfile'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'ring'
op|'.'
name|'overload'
op|','
number|'0.1'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
string|"'10.00%'"
name|'in'
name|'out'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
string|"'0.100000'"
name|'in'
name|'out'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_set_overload_percent_strange_input
dedent|''
name|'def'
name|'test_set_overload_percent_strange_input'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'create_sample_ring'
op|'('
op|')'
newline|'\n'
name|'argv'
op|'='
string|'"set_overload 26%%%%"'
op|'.'
name|'split'
op|'('
op|')'
newline|'\n'
name|'out'
op|','
name|'err'
op|'='
name|'self'
op|'.'
name|'run_srb'
op|'('
op|'*'
name|'argv'
op|')'
newline|'\n'
name|'ring'
op|'='
name|'RingBuilder'
op|'.'
name|'load'
op|'('
name|'self'
op|'.'
name|'tmpfile'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'ring'
op|'.'
name|'overload'
op|','
number|'0.26'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
string|"'26.00%'"
name|'in'
name|'out'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
string|"'0.260000'"
name|'in'
name|'out'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_server_overload_crazy_high
dedent|''
name|'def'
name|'test_server_overload_crazy_high'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'create_sample_ring'
op|'('
op|')'
newline|'\n'
name|'argv'
op|'='
string|'"set_overload 10"'
op|'.'
name|'split'
op|'('
op|')'
newline|'\n'
name|'out'
op|','
name|'err'
op|'='
name|'self'
op|'.'
name|'run_srb'
op|'('
op|'*'
name|'argv'
op|')'
newline|'\n'
name|'ring'
op|'='
name|'RingBuilder'
op|'.'
name|'load'
op|'('
name|'self'
op|'.'
name|'tmpfile'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'ring'
op|'.'
name|'overload'
op|','
number|'10.0'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
string|"'Warning overload is greater than 100%'"
name|'in'
name|'out'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
string|"'1000.00%'"
name|'in'
name|'out'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
string|"'10.000000'"
name|'in'
name|'out'
op|')'
newline|'\n'
comment|"# but it's cool if you do it on purpose"
nl|'\n'
name|'argv'
op|'['
op|'-'
number|'1'
op|']'
op|'='
string|"'1000%'"
newline|'\n'
name|'out'
op|','
name|'err'
op|'='
name|'self'
op|'.'
name|'run_srb'
op|'('
op|'*'
name|'argv'
op|')'
newline|'\n'
name|'ring'
op|'='
name|'RingBuilder'
op|'.'
name|'load'
op|'('
name|'self'
op|'.'
name|'tmpfile'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'ring'
op|'.'
name|'overload'
op|','
number|'10.0'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
string|"'Warning overload is greater than 100%'"
name|'not'
name|'in'
name|'out'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
string|"'1000.00%'"
name|'in'
name|'out'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
string|"'10.000000'"
name|'in'
name|'out'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_set_overload_number_of_arguments
dedent|''
name|'def'
name|'test_set_overload_number_of_arguments'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'create_sample_ring'
op|'('
op|')'
newline|'\n'
comment|'# Test missing arguments'
nl|'\n'
name|'argv'
op|'='
op|'['
string|'""'
op|','
name|'self'
op|'.'
name|'tmpfile'
op|','
string|'"set_overload"'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'SystemExit'
op|','
name|'ringbuilder'
op|'.'
name|'main'
op|','
name|'argv'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_set_replicas_number_of_arguments
dedent|''
name|'def'
name|'test_set_replicas_number_of_arguments'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'create_sample_ring'
op|'('
op|')'
newline|'\n'
comment|'# Test Number of arguments abnormal'
nl|'\n'
name|'argv'
op|'='
op|'['
string|'""'
op|','
name|'self'
op|'.'
name|'tmpfile'
op|','
string|'"set_replicas"'
op|']'
newline|'\n'
name|'err'
op|'='
name|'None'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'ringbuilder'
op|'.'
name|'main'
op|'('
name|'argv'
op|')'
newline|'\n'
dedent|''
name|'except'
name|'SystemExit'
name|'as'
name|'e'
op|':'
newline|'\n'
indent|'            '
name|'err'
op|'='
name|'e'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'err'
op|'.'
name|'code'
op|','
number|'2'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_set_replicas_invalid_value
dedent|''
name|'def'
name|'test_set_replicas_invalid_value'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'create_sample_ring'
op|'('
op|')'
newline|'\n'
comment|'# Test not a valid number'
nl|'\n'
name|'argv'
op|'='
op|'['
string|'""'
op|','
name|'self'
op|'.'
name|'tmpfile'
op|','
string|'"set_replicas"'
op|','
string|'"test"'
op|']'
newline|'\n'
name|'err'
op|'='
name|'None'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'ringbuilder'
op|'.'
name|'main'
op|'('
name|'argv'
op|')'
newline|'\n'
dedent|''
name|'except'
name|'SystemExit'
name|'as'
name|'e'
op|':'
newline|'\n'
indent|'            '
name|'err'
op|'='
name|'e'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'err'
op|'.'
name|'code'
op|','
number|'2'
op|')'
newline|'\n'
nl|'\n'
comment|'# Test new replicas is 0'
nl|'\n'
name|'argv'
op|'='
op|'['
string|'""'
op|','
name|'self'
op|'.'
name|'tmpfile'
op|','
string|'"set_replicas"'
op|','
string|'"0"'
op|']'
newline|'\n'
name|'err'
op|'='
name|'None'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'ringbuilder'
op|'.'
name|'main'
op|'('
name|'argv'
op|')'
newline|'\n'
dedent|''
name|'except'
name|'SystemExit'
name|'as'
name|'e'
op|':'
newline|'\n'
indent|'            '
name|'err'
op|'='
name|'e'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'err'
op|'.'
name|'code'
op|','
number|'2'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_validate
dedent|''
name|'def'
name|'test_validate'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'create_sample_ring'
op|'('
op|')'
newline|'\n'
name|'ring'
op|'='
name|'RingBuilder'
op|'.'
name|'load'
op|'('
name|'self'
op|'.'
name|'tmpfile'
op|')'
newline|'\n'
name|'ring'
op|'.'
name|'rebalance'
op|'('
op|')'
newline|'\n'
name|'ring'
op|'.'
name|'save'
op|'('
name|'self'
op|'.'
name|'tmpfile'
op|')'
newline|'\n'
name|'argv'
op|'='
op|'['
string|'""'
op|','
name|'self'
op|'.'
name|'tmpfile'
op|','
string|'"validate"'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'SystemExit'
op|','
name|'ringbuilder'
op|'.'
name|'main'
op|','
name|'argv'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_validate_empty_file
dedent|''
name|'def'
name|'test_validate_empty_file'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'open'
op|'('
name|'self'
op|'.'
name|'tmpfile'
op|','
string|"'a'"
op|')'
op|'.'
name|'close'
newline|'\n'
name|'argv'
op|'='
op|'['
string|'""'
op|','
name|'self'
op|'.'
name|'tmpfile'
op|','
string|'"validate"'
op|']'
newline|'\n'
name|'err'
op|'='
name|'None'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'ringbuilder'
op|'.'
name|'main'
op|'('
name|'argv'
op|')'
newline|'\n'
dedent|''
name|'except'
name|'SystemExit'
name|'as'
name|'e'
op|':'
newline|'\n'
indent|'            '
name|'err'
op|'='
name|'e'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'err'
op|'.'
name|'code'
op|','
number|'2'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_validate_corrupted_file
dedent|''
name|'def'
name|'test_validate_corrupted_file'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'create_sample_ring'
op|'('
op|')'
newline|'\n'
name|'ring'
op|'='
name|'RingBuilder'
op|'.'
name|'load'
op|'('
name|'self'
op|'.'
name|'tmpfile'
op|')'
newline|'\n'
name|'ring'
op|'.'
name|'rebalance'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'ring'
op|'.'
name|'validate'
op|'('
op|')'
op|')'
comment|'# ring is valid until now'
newline|'\n'
name|'ring'
op|'.'
name|'save'
op|'('
name|'self'
op|'.'
name|'tmpfile'
op|')'
newline|'\n'
name|'argv'
op|'='
op|'['
string|'""'
op|','
name|'self'
op|'.'
name|'tmpfile'
op|','
string|'"validate"'
op|']'
newline|'\n'
nl|'\n'
comment|'# corrupt the file'
nl|'\n'
name|'with'
name|'open'
op|'('
name|'self'
op|'.'
name|'tmpfile'
op|','
string|"'wb'"
op|')'
name|'as'
name|'f'
op|':'
newline|'\n'
indent|'            '
name|'f'
op|'.'
name|'write'
op|'('
name|'os'
op|'.'
name|'urandom'
op|'('
number|'1024'
op|')'
op|')'
newline|'\n'
dedent|''
name|'err'
op|'='
name|'None'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'ringbuilder'
op|'.'
name|'main'
op|'('
name|'argv'
op|')'
newline|'\n'
dedent|''
name|'except'
name|'SystemExit'
name|'as'
name|'e'
op|':'
newline|'\n'
indent|'            '
name|'err'
op|'='
name|'e'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'err'
op|'.'
name|'code'
op|','
number|'2'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_validate_non_existent_file
dedent|''
name|'def'
name|'test_validate_non_existent_file'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'rand_file'
op|'='
string|"'%s/%s'"
op|'%'
op|'('
string|"'/tmp'"
op|','
name|'str'
op|'('
name|'uuid'
op|'.'
name|'uuid4'
op|'('
op|')'
op|')'
op|')'
newline|'\n'
name|'argv'
op|'='
op|'['
string|'""'
op|','
name|'rand_file'
op|','
string|'"validate"'
op|']'
newline|'\n'
name|'err'
op|'='
name|'None'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'ringbuilder'
op|'.'
name|'main'
op|'('
name|'argv'
op|')'
newline|'\n'
dedent|''
name|'except'
name|'SystemExit'
name|'as'
name|'e'
op|':'
newline|'\n'
indent|'            '
name|'err'
op|'='
name|'e'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'err'
op|'.'
name|'code'
op|','
number|'2'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_validate_non_accessible_file
dedent|''
name|'def'
name|'test_validate_non_accessible_file'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'with'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
nl|'\n'
name|'RingBuilder'
op|','
string|"'load'"
op|','
nl|'\n'
name|'mock'
op|'.'
name|'Mock'
op|'('
name|'side_effect'
op|'='
name|'exceptions'
op|'.'
name|'PermissionError'
op|')'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'argv'
op|'='
op|'['
string|'""'
op|','
name|'self'
op|'.'
name|'tmpfile'
op|','
string|'"validate"'
op|']'
newline|'\n'
name|'err'
op|'='
name|'None'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'                '
name|'ringbuilder'
op|'.'
name|'main'
op|'('
name|'argv'
op|')'
newline|'\n'
dedent|''
name|'except'
name|'SystemExit'
name|'as'
name|'e'
op|':'
newline|'\n'
indent|'                '
name|'err'
op|'='
name|'e'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'err'
op|'.'
name|'code'
op|','
number|'2'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_validate_generic_error
dedent|''
dedent|''
name|'def'
name|'test_validate_generic_error'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'with'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
nl|'\n'
name|'RingBuilder'
op|','
string|"'load'"
op|','
name|'mock'
op|'.'
name|'Mock'
op|'('
nl|'\n'
name|'side_effect'
op|'='
name|'IOError'
op|'('
string|"'Generic error occurred'"
op|')'
op|')'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'argv'
op|'='
op|'['
string|'""'
op|','
name|'self'
op|'.'
name|'tmpfile'
op|','
string|'"validate"'
op|']'
newline|'\n'
name|'err'
op|'='
name|'None'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'                '
name|'ringbuilder'
op|'.'
name|'main'
op|'('
name|'argv'
op|')'
newline|'\n'
dedent|''
name|'except'
name|'SystemExit'
name|'as'
name|'e'
op|':'
newline|'\n'
indent|'                '
name|'err'
op|'='
name|'e'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'err'
op|'.'
name|'code'
op|','
number|'2'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_search_device_ipv4_old_format
dedent|''
dedent|''
name|'def'
name|'test_search_device_ipv4_old_format'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'create_sample_ring'
op|'('
op|')'
newline|'\n'
comment|'# Test ipv4(old format)'
nl|'\n'
name|'argv'
op|'='
op|'['
string|'""'
op|','
name|'self'
op|'.'
name|'tmpfile'
op|','
string|'"search"'
op|','
nl|'\n'
string|'"d0r0z0-127.0.0.1:6000R127.0.0.1:6000/sda1_some meta data"'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'SystemExit'
op|','
name|'ringbuilder'
op|'.'
name|'main'
op|','
name|'argv'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_search_device_ipv6_old_format
dedent|''
name|'def'
name|'test_search_device_ipv6_old_format'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'create_sample_ring'
op|'('
op|')'
newline|'\n'
comment|'# add IPV6'
nl|'\n'
name|'argv'
op|'='
op|'['
string|'""'
op|','
name|'self'
op|'.'
name|'tmpfile'
op|','
string|'"add"'
op|','
nl|'\n'
string|'"--region"'
op|','
string|'"2"'
op|','
string|'"--zone"'
op|','
string|'"3"'
op|','
nl|'\n'
string|'"--ip"'
op|','
string|'"[2001:0000:1234:0000:0000:C1C0:ABCD:0876]"'
op|','
nl|'\n'
string|'"--port"'
op|','
string|'"6000"'
op|','
nl|'\n'
string|'"--replication-ip"'
op|','
string|'"[2::10]"'
op|','
nl|'\n'
string|'"--replication-port"'
op|','
string|'"7000"'
op|','
nl|'\n'
string|'"--device"'
op|','
string|'"sda3"'
op|','
string|'"--meta"'
op|','
string|'"some meta data"'
op|','
nl|'\n'
string|'"--weight"'
op|','
string|'"3.14159265359"'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'SystemExit'
op|','
name|'ringbuilder'
op|'.'
name|'main'
op|','
name|'argv'
op|')'
newline|'\n'
nl|'\n'
comment|'# Test ipv6(old format)'
nl|'\n'
name|'argv'
op|'='
op|'['
string|'""'
op|','
name|'self'
op|'.'
name|'tmpfile'
op|','
string|'"search"'
op|','
nl|'\n'
string|'"d2r2z3-[2001:0000:1234:0000:0000:C1C0:ABCD:0876]:6000"'
nl|'\n'
string|'"R[2::10]:7000/sda3_some meta data"'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'SystemExit'
op|','
name|'ringbuilder'
op|'.'
name|'main'
op|','
name|'argv'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_search_device_ipv4_new_format
dedent|''
name|'def'
name|'test_search_device_ipv4_new_format'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'create_sample_ring'
op|'('
op|')'
newline|'\n'
comment|'# Test ipv4(new format)'
nl|'\n'
name|'argv'
op|'='
op|'['
string|'""'
op|','
name|'self'
op|'.'
name|'tmpfile'
op|','
string|'"search"'
op|','
nl|'\n'
string|'"--id"'
op|','
string|'"0"'
op|','
string|'"--region"'
op|','
string|'"0"'
op|','
string|'"--zone"'
op|','
string|'"0"'
op|','
nl|'\n'
string|'"--ip"'
op|','
string|'"127.0.0.1"'
op|','
nl|'\n'
string|'"--port"'
op|','
string|'"6000"'
op|','
nl|'\n'
string|'"--replication-ip"'
op|','
string|'"127.0.0.1"'
op|','
nl|'\n'
string|'"--replication-port"'
op|','
string|'"6000"'
op|','
nl|'\n'
string|'"--device"'
op|','
string|'"sda1"'
op|','
string|'"--meta"'
op|','
string|'"some meta data"'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'SystemExit'
op|','
name|'ringbuilder'
op|'.'
name|'main'
op|','
name|'argv'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_search_device_ipv6_new_format
dedent|''
name|'def'
name|'test_search_device_ipv6_new_format'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'create_sample_ring'
op|'('
op|')'
newline|'\n'
comment|'# add IPV6'
nl|'\n'
name|'argv'
op|'='
op|'['
string|'""'
op|','
name|'self'
op|'.'
name|'tmpfile'
op|','
string|'"add"'
op|','
nl|'\n'
string|'"--region"'
op|','
string|'"2"'
op|','
string|'"--zone"'
op|','
string|'"3"'
op|','
nl|'\n'
string|'"--ip"'
op|','
string|'"[2001:0000:1234:0000:0000:C1C0:ABCD:0876]"'
op|','
nl|'\n'
string|'"--port"'
op|','
string|'"6000"'
op|','
nl|'\n'
string|'"--replication-ip"'
op|','
string|'"[2::10]"'
op|','
nl|'\n'
string|'"--replication-port"'
op|','
string|'"7000"'
op|','
nl|'\n'
string|'"--device"'
op|','
string|'"sda3"'
op|','
string|'"--meta"'
op|','
string|'"some meta data"'
op|','
nl|'\n'
string|'"--weight"'
op|','
string|'"3.14159265359"'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'SystemExit'
op|','
name|'ringbuilder'
op|'.'
name|'main'
op|','
name|'argv'
op|')'
newline|'\n'
nl|'\n'
comment|'# Test ipv6(new format)'
nl|'\n'
name|'argv'
op|'='
op|'['
string|'""'
op|','
name|'self'
op|'.'
name|'tmpfile'
op|','
string|'"search"'
op|','
nl|'\n'
string|'"--id"'
op|','
string|'"2"'
op|','
string|'"--region"'
op|','
string|'"2"'
op|','
string|'"--zone"'
op|','
string|'"3"'
op|','
nl|'\n'
string|'"--ip"'
op|','
string|'"[2001:0000:1234:0000:0000:C1C0:ABCD:0876]"'
op|','
nl|'\n'
string|'"--port"'
op|','
string|'"6000"'
op|','
nl|'\n'
string|'"--replication-ip"'
op|','
string|'"[2::10]"'
op|','
nl|'\n'
string|'"--replication-port"'
op|','
string|'"7000"'
op|','
nl|'\n'
string|'"--device"'
op|','
string|'"sda3"'
op|','
string|'"--meta"'
op|','
string|'"some meta data"'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'SystemExit'
op|','
name|'ringbuilder'
op|'.'
name|'main'
op|','
name|'argv'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_search_device_domain_new_format
dedent|''
name|'def'
name|'test_search_device_domain_new_format'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'create_sample_ring'
op|'('
op|')'
newline|'\n'
comment|'# add domain name'
nl|'\n'
name|'argv'
op|'='
op|'['
string|'""'
op|','
name|'self'
op|'.'
name|'tmpfile'
op|','
string|'"add"'
op|','
nl|'\n'
string|'"--region"'
op|','
string|'"2"'
op|','
string|'"--zone"'
op|','
string|'"3"'
op|','
nl|'\n'
string|'"--ip"'
op|','
string|'"test.test.com"'
op|','
nl|'\n'
string|'"--port"'
op|','
string|'"6000"'
op|','
nl|'\n'
string|'"--replication-ip"'
op|','
string|'"r.test.com"'
op|','
nl|'\n'
string|'"--replication-port"'
op|','
string|'"7000"'
op|','
nl|'\n'
string|'"--device"'
op|','
string|'"sda3"'
op|','
string|'"--meta"'
op|','
string|'"some meta data"'
op|','
nl|'\n'
string|'"--weight"'
op|','
string|'"3.14159265359"'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'SystemExit'
op|','
name|'ringbuilder'
op|'.'
name|'main'
op|','
name|'argv'
op|')'
newline|'\n'
nl|'\n'
comment|'# Test domain name'
nl|'\n'
name|'argv'
op|'='
op|'['
string|'""'
op|','
name|'self'
op|'.'
name|'tmpfile'
op|','
string|'"search"'
op|','
nl|'\n'
string|'"--id"'
op|','
string|'"2"'
op|','
string|'"--region"'
op|','
string|'"2"'
op|','
string|'"--zone"'
op|','
string|'"3"'
op|','
nl|'\n'
string|'"--ip"'
op|','
string|'"test.test.com"'
op|','
nl|'\n'
string|'"--port"'
op|','
string|'"6000"'
op|','
nl|'\n'
string|'"--replication-ip"'
op|','
string|'"r.test.com"'
op|','
nl|'\n'
string|'"--replication-port"'
op|','
string|'"7000"'
op|','
nl|'\n'
string|'"--device"'
op|','
string|'"sda3"'
op|','
string|'"--meta"'
op|','
string|'"some meta data"'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'SystemExit'
op|','
name|'ringbuilder'
op|'.'
name|'main'
op|','
name|'argv'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_search_device_number_of_arguments
dedent|''
name|'def'
name|'test_search_device_number_of_arguments'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'create_sample_ring'
op|'('
op|')'
newline|'\n'
comment|'# Test Number of arguments abnormal'
nl|'\n'
name|'argv'
op|'='
op|'['
string|'""'
op|','
name|'self'
op|'.'
name|'tmpfile'
op|','
string|'"search"'
op|']'
newline|'\n'
name|'err'
op|'='
name|'None'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'ringbuilder'
op|'.'
name|'main'
op|'('
name|'argv'
op|')'
newline|'\n'
dedent|''
name|'except'
name|'SystemExit'
name|'as'
name|'e'
op|':'
newline|'\n'
indent|'            '
name|'err'
op|'='
name|'e'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'err'
op|'.'
name|'code'
op|','
number|'2'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_search_device_no_matching
dedent|''
name|'def'
name|'test_search_device_no_matching'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'create_sample_ring'
op|'('
op|')'
newline|'\n'
comment|'# Test No matching devices'
nl|'\n'
name|'argv'
op|'='
op|'['
string|'""'
op|','
name|'self'
op|'.'
name|'tmpfile'
op|','
string|'"search"'
op|','
nl|'\n'
string|'"--ip"'
op|','
string|'"unknown"'
op|']'
newline|'\n'
name|'err'
op|'='
name|'None'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'ringbuilder'
op|'.'
name|'main'
op|'('
name|'argv'
op|')'
newline|'\n'
dedent|''
name|'except'
name|'SystemExit'
name|'as'
name|'e'
op|':'
newline|'\n'
indent|'            '
name|'err'
op|'='
name|'e'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'err'
op|'.'
name|'code'
op|','
number|'2'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_list_parts_ipv4_old_format
dedent|''
name|'def'
name|'test_list_parts_ipv4_old_format'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'create_sample_ring'
op|'('
op|')'
newline|'\n'
comment|'# Test ipv4(old format)'
nl|'\n'
name|'argv'
op|'='
op|'['
string|'""'
op|','
name|'self'
op|'.'
name|'tmpfile'
op|','
string|'"list_parts"'
op|','
nl|'\n'
string|'"d0r0z0-127.0.0.1:6000R127.0.0.1:6000/sda1_some meta data"'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'SystemExit'
op|','
name|'ringbuilder'
op|'.'
name|'main'
op|','
name|'argv'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_list_parts_ipv6_old_format
dedent|''
name|'def'
name|'test_list_parts_ipv6_old_format'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'create_sample_ring'
op|'('
op|')'
newline|'\n'
comment|'# add IPV6'
nl|'\n'
name|'argv'
op|'='
op|'['
string|'""'
op|','
name|'self'
op|'.'
name|'tmpfile'
op|','
string|'"add"'
op|','
nl|'\n'
string|'"--region"'
op|','
string|'"2"'
op|','
string|'"--zone"'
op|','
string|'"3"'
op|','
nl|'\n'
string|'"--ip"'
op|','
string|'"[2001:0000:1234:0000:0000:C1C0:ABCD:0876]"'
op|','
nl|'\n'
string|'"--port"'
op|','
string|'"6000"'
op|','
nl|'\n'
string|'"--replication-ip"'
op|','
string|'"[2::10]"'
op|','
nl|'\n'
string|'"--replication-port"'
op|','
string|'"7000"'
op|','
nl|'\n'
string|'"--device"'
op|','
string|'"sda3"'
op|','
string|'"--meta"'
op|','
string|'"some meta data"'
op|','
nl|'\n'
string|'"--weight"'
op|','
string|'"3.14159265359"'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'SystemExit'
op|','
name|'ringbuilder'
op|'.'
name|'main'
op|','
name|'argv'
op|')'
newline|'\n'
nl|'\n'
comment|'# Test ipv6(old format)'
nl|'\n'
name|'argv'
op|'='
op|'['
string|'""'
op|','
name|'self'
op|'.'
name|'tmpfile'
op|','
string|'"list_parts"'
op|','
nl|'\n'
string|'"d2r2z3-[2001:0000:1234:0000:0000:C1C0:ABCD:0876]:6000"'
nl|'\n'
string|'"R[2::10]:7000/sda3_some meta data"'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'SystemExit'
op|','
name|'ringbuilder'
op|'.'
name|'main'
op|','
name|'argv'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_list_parts_ipv4_new_format
dedent|''
name|'def'
name|'test_list_parts_ipv4_new_format'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'create_sample_ring'
op|'('
op|')'
newline|'\n'
comment|'# Test ipv4(new format)'
nl|'\n'
name|'argv'
op|'='
op|'['
string|'""'
op|','
name|'self'
op|'.'
name|'tmpfile'
op|','
string|'"list_parts"'
op|','
nl|'\n'
string|'"--id"'
op|','
string|'"0"'
op|','
string|'"--region"'
op|','
string|'"0"'
op|','
string|'"--zone"'
op|','
string|'"0"'
op|','
nl|'\n'
string|'"--ip"'
op|','
string|'"127.0.0.1"'
op|','
nl|'\n'
string|'"--port"'
op|','
string|'"6000"'
op|','
nl|'\n'
string|'"--replication-ip"'
op|','
string|'"127.0.0.1"'
op|','
nl|'\n'
string|'"--replication-port"'
op|','
string|'"6000"'
op|','
nl|'\n'
string|'"--device"'
op|','
string|'"sda1"'
op|','
string|'"--meta"'
op|','
string|'"some meta data"'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'SystemExit'
op|','
name|'ringbuilder'
op|'.'
name|'main'
op|','
name|'argv'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_list_parts_ipv6_new_format
dedent|''
name|'def'
name|'test_list_parts_ipv6_new_format'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'create_sample_ring'
op|'('
op|')'
newline|'\n'
comment|'# add IPV6'
nl|'\n'
name|'argv'
op|'='
op|'['
string|'""'
op|','
name|'self'
op|'.'
name|'tmpfile'
op|','
string|'"add"'
op|','
nl|'\n'
string|'"--region"'
op|','
string|'"2"'
op|','
string|'"--zone"'
op|','
string|'"3"'
op|','
nl|'\n'
string|'"--ip"'
op|','
string|'"[2001:0000:1234:0000:0000:C1C0:ABCD:0876]"'
op|','
nl|'\n'
string|'"--port"'
op|','
string|'"6000"'
op|','
nl|'\n'
string|'"--replication-ip"'
op|','
string|'"[2::10]"'
op|','
nl|'\n'
string|'"--replication-port"'
op|','
string|'"7000"'
op|','
nl|'\n'
string|'"--device"'
op|','
string|'"sda3"'
op|','
string|'"--meta"'
op|','
string|'"some meta data"'
op|','
nl|'\n'
string|'"--weight"'
op|','
string|'"3.14159265359"'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'SystemExit'
op|','
name|'ringbuilder'
op|'.'
name|'main'
op|','
name|'argv'
op|')'
newline|'\n'
nl|'\n'
comment|'# Test ipv6(new format)'
nl|'\n'
name|'argv'
op|'='
op|'['
string|'""'
op|','
name|'self'
op|'.'
name|'tmpfile'
op|','
string|'"list_parts"'
op|','
nl|'\n'
string|'"--id"'
op|','
string|'"2"'
op|','
string|'"--region"'
op|','
string|'"2"'
op|','
string|'"--zone"'
op|','
string|'"3"'
op|','
nl|'\n'
string|'"--ip"'
op|','
string|'"[2001:0000:1234:0000:0000:C1C0:ABCD:0876]"'
op|','
nl|'\n'
string|'"--port"'
op|','
string|'"6000"'
op|','
nl|'\n'
string|'"--replication-ip"'
op|','
string|'"[2::10]"'
op|','
nl|'\n'
string|'"--replication-port"'
op|','
string|'"7000"'
op|','
nl|'\n'
string|'"--device"'
op|','
string|'"sda3"'
op|','
string|'"--meta"'
op|','
string|'"some meta data"'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'SystemExit'
op|','
name|'ringbuilder'
op|'.'
name|'main'
op|','
name|'argv'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_list_parts_domain_new_format
dedent|''
name|'def'
name|'test_list_parts_domain_new_format'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'create_sample_ring'
op|'('
op|')'
newline|'\n'
comment|'# add domain name'
nl|'\n'
name|'argv'
op|'='
op|'['
string|'""'
op|','
name|'self'
op|'.'
name|'tmpfile'
op|','
string|'"add"'
op|','
nl|'\n'
string|'"--region"'
op|','
string|'"2"'
op|','
string|'"--zone"'
op|','
string|'"3"'
op|','
nl|'\n'
string|'"--ip"'
op|','
string|'"test.test.com"'
op|','
nl|'\n'
string|'"--port"'
op|','
string|'"6000"'
op|','
nl|'\n'
string|'"--replication-ip"'
op|','
string|'"r.test.com"'
op|','
nl|'\n'
string|'"--replication-port"'
op|','
string|'"7000"'
op|','
nl|'\n'
string|'"--device"'
op|','
string|'"sda3"'
op|','
string|'"--meta"'
op|','
string|'"some meta data"'
op|','
nl|'\n'
string|'"--weight"'
op|','
string|'"3.14159265359"'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'SystemExit'
op|','
name|'ringbuilder'
op|'.'
name|'main'
op|','
name|'argv'
op|')'
newline|'\n'
nl|'\n'
comment|'# Test domain name'
nl|'\n'
name|'argv'
op|'='
op|'['
string|'""'
op|','
name|'self'
op|'.'
name|'tmpfile'
op|','
string|'"list_parts"'
op|','
nl|'\n'
string|'"--id"'
op|','
string|'"2"'
op|','
string|'"--region"'
op|','
string|'"2"'
op|','
string|'"--zone"'
op|','
string|'"3"'
op|','
nl|'\n'
string|'"--ip"'
op|','
string|'"test.test.com"'
op|','
nl|'\n'
string|'"--port"'
op|','
string|'"6000"'
op|','
nl|'\n'
string|'"--replication-ip"'
op|','
string|'"r.test.com"'
op|','
nl|'\n'
string|'"--replication-port"'
op|','
string|'"7000"'
op|','
nl|'\n'
string|'"--device"'
op|','
string|'"sda3"'
op|','
string|'"--meta"'
op|','
string|'"some meta data"'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'SystemExit'
op|','
name|'ringbuilder'
op|'.'
name|'main'
op|','
name|'argv'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_list_parts_number_of_arguments
dedent|''
name|'def'
name|'test_list_parts_number_of_arguments'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'create_sample_ring'
op|'('
op|')'
newline|'\n'
comment|'# Test Number of arguments abnormal'
nl|'\n'
name|'argv'
op|'='
op|'['
string|'""'
op|','
name|'self'
op|'.'
name|'tmpfile'
op|','
string|'"list_parts"'
op|']'
newline|'\n'
name|'err'
op|'='
name|'None'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'ringbuilder'
op|'.'
name|'main'
op|'('
name|'argv'
op|')'
newline|'\n'
dedent|''
name|'except'
name|'SystemExit'
name|'as'
name|'e'
op|':'
newline|'\n'
indent|'            '
name|'err'
op|'='
name|'e'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'err'
op|'.'
name|'code'
op|','
number|'2'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_list_parts_no_matching
dedent|''
name|'def'
name|'test_list_parts_no_matching'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'create_sample_ring'
op|'('
op|')'
newline|'\n'
comment|'# Test No matching devices'
nl|'\n'
name|'argv'
op|'='
op|'['
string|'""'
op|','
name|'self'
op|'.'
name|'tmpfile'
op|','
string|'"list_parts"'
op|','
nl|'\n'
string|'"--ip"'
op|','
string|'"unknown"'
op|']'
newline|'\n'
name|'err'
op|'='
name|'None'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'ringbuilder'
op|'.'
name|'main'
op|'('
name|'argv'
op|')'
newline|'\n'
dedent|''
name|'except'
name|'SystemExit'
name|'as'
name|'e'
op|':'
newline|'\n'
indent|'            '
name|'err'
op|'='
name|'e'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'err'
op|'.'
name|'code'
op|','
number|'2'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_unknown
dedent|''
name|'def'
name|'test_unknown'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'create_sample_ring'
op|'('
op|')'
newline|'\n'
name|'argv'
op|'='
op|'['
string|'""'
op|','
name|'self'
op|'.'
name|'tmpfile'
op|','
string|'"unknown"'
op|']'
newline|'\n'
name|'err'
op|'='
name|'None'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'ringbuilder'
op|'.'
name|'main'
op|'('
name|'argv'
op|')'
newline|'\n'
dedent|''
name|'except'
name|'SystemExit'
name|'as'
name|'e'
op|':'
newline|'\n'
indent|'            '
name|'err'
op|'='
name|'e'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'err'
op|'.'
name|'code'
op|','
number|'2'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_default
dedent|''
name|'def'
name|'test_default'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'create_sample_ring'
op|'('
op|')'
newline|'\n'
name|'argv'
op|'='
op|'['
string|'""'
op|','
name|'self'
op|'.'
name|'tmpfile'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'SystemExit'
op|','
name|'ringbuilder'
op|'.'
name|'main'
op|','
name|'argv'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_default_show_removed
dedent|''
name|'def'
name|'test_default_show_removed'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'mock_stdout'
op|'='
name|'six'
op|'.'
name|'StringIO'
op|'('
op|')'
newline|'\n'
name|'mock_stderr'
op|'='
name|'six'
op|'.'
name|'StringIO'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'create_sample_ring'
op|'('
op|')'
newline|'\n'
nl|'\n'
comment|"# Note: it also sets device's weight to zero."
nl|'\n'
name|'argv'
op|'='
op|'['
string|'""'
op|','
name|'self'
op|'.'
name|'tmpfile'
op|','
string|'"remove"'
op|','
string|'"--id"'
op|','
string|'"1"'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'SystemExit'
op|','
name|'ringbuilder'
op|'.'
name|'main'
op|','
name|'argv'
op|')'
newline|'\n'
nl|'\n'
comment|"# Setting another device's weight to zero to be sure we distinguish"
nl|'\n'
comment|'# real removed device and device with zero weight.'
nl|'\n'
name|'argv'
op|'='
op|'['
string|'""'
op|','
name|'self'
op|'.'
name|'tmpfile'
op|','
string|'"set_weight"'
op|','
string|'"0"'
op|','
string|'"--id"'
op|','
string|'"3"'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'SystemExit'
op|','
name|'ringbuilder'
op|'.'
name|'main'
op|','
name|'argv'
op|')'
newline|'\n'
nl|'\n'
name|'argv'
op|'='
op|'['
string|'""'
op|','
name|'self'
op|'.'
name|'tmpfile'
op|']'
newline|'\n'
name|'with'
name|'mock'
op|'.'
name|'patch'
op|'('
string|'"sys.stdout"'
op|','
name|'mock_stdout'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'with'
name|'mock'
op|'.'
name|'patch'
op|'('
string|'"sys.stderr"'
op|','
name|'mock_stderr'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'SystemExit'
op|','
name|'ringbuilder'
op|'.'
name|'main'
op|','
name|'argv'
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'expected'
op|'='
string|'"%s, build version 6\\n"'
string|'"64 partitions, 3.000000 replicas, 4 regions, 4 zones, "'
string|'"4 devices, 100.00 balance, 0.00 dispersion\\n"'
string|'"The minimum number of hours before a partition can be "'
string|'"reassigned is 1\\n"'
string|'"The overload factor is 0.00%% (0.000000)\\n"'
string|'"Devices:    id  region  zone      ip address  port  "'
string|'"replication ip  replication port      name weight "'
string|'"partitions balance flags meta\\n"'
string|'"             0       0     0       127.0.0.1  6000       "'
string|'"127.0.0.1              6000      sda1 100.00"'
string|'"          0 -100.00       some meta data\\n"'
string|'"             1       1     1       127.0.0.2  6001       "'
string|'"127.0.0.2              6001      sda2   0.00"'
string|'"          0    0.00   DEL \\n"'
string|'"             2       2     2       127.0.0.3  6002       "'
string|'"127.0.0.3              6002      sdc3 100.00"'
string|'"          0 -100.00       \\n"'
string|'"             3       3     3       127.0.0.4  6003       "'
string|'"127.0.0.4              6003      sdd4   0.00"'
string|'"          0    0.00       \\n"'
op|'%'
name|'self'
op|'.'
name|'tmpfile'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'expected'
op|','
name|'mock_stdout'
op|'.'
name|'getvalue'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_rebalance
dedent|''
name|'def'
name|'test_rebalance'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'create_sample_ring'
op|'('
op|')'
newline|'\n'
name|'argv'
op|'='
op|'['
string|'""'
op|','
name|'self'
op|'.'
name|'tmpfile'
op|','
string|'"rebalance"'
op|','
string|'"3"'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'SystemExit'
op|','
name|'ringbuilder'
op|'.'
name|'main'
op|','
name|'argv'
op|')'
newline|'\n'
name|'ring'
op|'='
name|'RingBuilder'
op|'.'
name|'load'
op|'('
name|'self'
op|'.'
name|'tmpfile'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'ring'
op|'.'
name|'validate'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_rebalance_no_device_change
dedent|''
name|'def'
name|'test_rebalance_no_device_change'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'create_sample_ring'
op|'('
op|')'
newline|'\n'
name|'ring'
op|'='
name|'RingBuilder'
op|'.'
name|'load'
op|'('
name|'self'
op|'.'
name|'tmpfile'
op|')'
newline|'\n'
name|'ring'
op|'.'
name|'rebalance'
op|'('
op|')'
newline|'\n'
name|'ring'
op|'.'
name|'save'
op|'('
name|'self'
op|'.'
name|'tmpfile'
op|')'
newline|'\n'
comment|'# Test No change to the device'
nl|'\n'
name|'argv'
op|'='
op|'['
string|'""'
op|','
name|'self'
op|'.'
name|'tmpfile'
op|','
string|'"rebalance"'
op|','
string|'"3"'
op|']'
newline|'\n'
name|'err'
op|'='
name|'None'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'ringbuilder'
op|'.'
name|'main'
op|'('
name|'argv'
op|')'
newline|'\n'
dedent|''
name|'except'
name|'SystemExit'
name|'as'
name|'e'
op|':'
newline|'\n'
indent|'            '
name|'err'
op|'='
name|'e'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'err'
op|'.'
name|'code'
op|','
number|'1'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_rebalance_no_devices
dedent|''
name|'def'
name|'test_rebalance_no_devices'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# Test no devices'
nl|'\n'
indent|'        '
name|'argv'
op|'='
op|'['
string|'""'
op|','
name|'self'
op|'.'
name|'tmpfile'
op|','
string|'"create"'
op|','
string|'"6"'
op|','
string|'"3.14159265359"'
op|','
string|'"1"'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'SystemExit'
op|','
name|'ringbuilder'
op|'.'
name|'main'
op|','
name|'argv'
op|')'
newline|'\n'
name|'argv'
op|'='
op|'['
string|'""'
op|','
name|'self'
op|'.'
name|'tmpfile'
op|','
string|'"rebalance"'
op|']'
newline|'\n'
name|'err'
op|'='
name|'None'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'ringbuilder'
op|'.'
name|'main'
op|'('
name|'argv'
op|')'
newline|'\n'
dedent|''
name|'except'
name|'SystemExit'
name|'as'
name|'e'
op|':'
newline|'\n'
indent|'            '
name|'err'
op|'='
name|'e'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'err'
op|'.'
name|'code'
op|','
number|'2'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_rebalance_remove_zero_weighted_device
dedent|''
name|'def'
name|'test_rebalance_remove_zero_weighted_device'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'create_sample_ring'
op|'('
op|')'
newline|'\n'
name|'ring'
op|'='
name|'RingBuilder'
op|'.'
name|'load'
op|'('
name|'self'
op|'.'
name|'tmpfile'
op|')'
newline|'\n'
name|'ring'
op|'.'
name|'set_dev_weight'
op|'('
number|'3'
op|','
number|'0.0'
op|')'
newline|'\n'
name|'ring'
op|'.'
name|'rebalance'
op|'('
op|')'
newline|'\n'
name|'ring'
op|'.'
name|'remove_dev'
op|'('
number|'3'
op|')'
newline|'\n'
name|'ring'
op|'.'
name|'save'
op|'('
name|'self'
op|'.'
name|'tmpfile'
op|')'
newline|'\n'
nl|'\n'
comment|'# Test rebalance after remove 0 weighted device'
nl|'\n'
name|'argv'
op|'='
op|'['
string|'""'
op|','
name|'self'
op|'.'
name|'tmpfile'
op|','
string|'"rebalance"'
op|','
string|'"3"'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'SystemExit'
op|','
name|'ringbuilder'
op|'.'
name|'main'
op|','
name|'argv'
op|')'
newline|'\n'
name|'ring'
op|'='
name|'RingBuilder'
op|'.'
name|'load'
op|'('
name|'self'
op|'.'
name|'tmpfile'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'ring'
op|'.'
name|'validate'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'ring'
op|'.'
name|'devs'
op|'['
number|'3'
op|']'
op|','
name|'None'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_rebalance_with_seed
dedent|''
name|'def'
name|'test_rebalance_with_seed'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'create_sample_ring'
op|'('
op|')'
newline|'\n'
comment|'# Test rebalance using explicit seed parameter'
nl|'\n'
name|'argv'
op|'='
op|'['
string|'""'
op|','
name|'self'
op|'.'
name|'tmpfile'
op|','
string|'"rebalance"'
op|','
string|'"--seed"'
op|','
string|'"2"'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'SystemExit'
op|','
name|'ringbuilder'
op|'.'
name|'main'
op|','
name|'argv'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_write_ring
dedent|''
name|'def'
name|'test_write_ring'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'create_sample_ring'
op|'('
op|')'
newline|'\n'
name|'argv'
op|'='
op|'['
string|'""'
op|','
name|'self'
op|'.'
name|'tmpfile'
op|','
string|'"rebalance"'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'SystemExit'
op|','
name|'ringbuilder'
op|'.'
name|'main'
op|','
name|'argv'
op|')'
newline|'\n'
nl|'\n'
name|'argv'
op|'='
op|'['
string|'""'
op|','
name|'self'
op|'.'
name|'tmpfile'
op|','
string|'"write_ring"'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'SystemExit'
op|','
name|'ringbuilder'
op|'.'
name|'main'
op|','
name|'argv'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_write_builder
dedent|''
name|'def'
name|'test_write_builder'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# Test builder file already exists'
nl|'\n'
indent|'        '
name|'self'
op|'.'
name|'create_sample_ring'
op|'('
op|')'
newline|'\n'
name|'argv'
op|'='
op|'['
string|'""'
op|','
name|'self'
op|'.'
name|'tmpfile'
op|','
string|'"rebalance"'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'SystemExit'
op|','
name|'ringbuilder'
op|'.'
name|'main'
op|','
name|'argv'
op|')'
newline|'\n'
name|'argv'
op|'='
op|'['
string|'""'
op|','
name|'self'
op|'.'
name|'tmpfile'
op|','
string|'"write_builder"'
op|']'
newline|'\n'
name|'exp_results'
op|'='
op|'{'
string|"'valid_exit_codes'"
op|':'
op|'['
number|'2'
op|']'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'run_srb'
op|'('
op|'*'
name|'argv'
op|','
name|'exp_results'
op|'='
name|'exp_results'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_write_builder_after_device_removal
dedent|''
name|'def'
name|'test_write_builder_after_device_removal'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# Test regenerating builder file after having removed a device'
nl|'\n'
comment|'# and lost the builder file'
nl|'\n'
indent|'        '
name|'self'
op|'.'
name|'create_sample_ring'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'argv'
op|'='
op|'['
string|'""'
op|','
name|'self'
op|'.'
name|'tmpfile'
op|','
string|'"add"'
op|','
string|'"r1z1-127.0.0.1:6000/sdb"'
string|'"1.0"'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'SystemExit'
op|','
name|'ringbuilder'
op|'.'
name|'main'
op|','
name|'argv'
op|')'
newline|'\n'
name|'argv'
op|'='
op|'['
string|'""'
op|','
name|'self'
op|'.'
name|'tmpfile'
op|','
string|'"add"'
op|','
string|'"r1z1-127.0.0.1:6000/sdc"'
string|'"1.0"'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'SystemExit'
op|','
name|'ringbuilder'
op|'.'
name|'main'
op|','
name|'argv'
op|')'
newline|'\n'
name|'argv'
op|'='
op|'['
string|'""'
op|','
name|'self'
op|'.'
name|'tmpfile'
op|','
string|'"rebalance"'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'SystemExit'
op|','
name|'ringbuilder'
op|'.'
name|'main'
op|','
name|'argv'
op|')'
newline|'\n'
nl|'\n'
name|'argv'
op|'='
op|'['
string|'""'
op|','
name|'self'
op|'.'
name|'tmpfile'
op|','
string|'"remove"'
op|','
string|'"--id"'
op|','
string|'"0"'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'SystemExit'
op|','
name|'ringbuilder'
op|'.'
name|'main'
op|','
name|'argv'
op|')'
newline|'\n'
name|'argv'
op|'='
op|'['
string|'""'
op|','
name|'self'
op|'.'
name|'tmpfile'
op|','
string|'"rebalance"'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'SystemExit'
op|','
name|'ringbuilder'
op|'.'
name|'main'
op|','
name|'argv'
op|')'
newline|'\n'
nl|'\n'
name|'backup_file'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'dirname'
op|'('
name|'self'
op|'.'
name|'tmpfile'
op|')'
op|','
nl|'\n'
name|'os'
op|'.'
name|'path'
op|'.'
name|'basename'
op|'('
name|'self'
op|'.'
name|'tmpfile'
op|')'
op|'+'
string|'".ring.gz"'
op|')'
newline|'\n'
name|'os'
op|'.'
name|'remove'
op|'('
name|'self'
op|'.'
name|'tmpfile'
op|')'
comment|'# loses file...'
newline|'\n'
nl|'\n'
name|'argv'
op|'='
op|'['
string|'""'
op|','
name|'backup_file'
op|','
string|'"write_builder"'
op|','
string|'"24"'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'ringbuilder'
op|'.'
name|'main'
op|'('
name|'argv'
op|')'
op|','
name|'None'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_warn_at_risk
dedent|''
name|'def'
name|'test_warn_at_risk'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# when the number of total part replicas (3 * 2 ** 4 = 48 in'
nl|'\n'
comment|'# this ring) is less than the total units of weight (310 in this'
nl|'\n'
comment|'# ring) the relative number of parts per unit of weight (called'
nl|'\n'
comment|'# weight_of_one_part) is less than 1 - and each whole part'
nl|'\n'
comment|'# placed takes up a larger ratio of the fractional number of'
nl|'\n'
comment|"# parts the device wants - so it's much more difficult to"
nl|'\n'
comment|"# satisfy a device's weight exactly - that is to say less parts"
nl|'\n'
comment|'# to go around tends to make things lumpy'
nl|'\n'
indent|'        '
name|'self'
op|'.'
name|'create_sample_ring'
op|'('
number|'4'
op|')'
newline|'\n'
name|'ring'
op|'='
name|'RingBuilder'
op|'.'
name|'load'
op|'('
name|'self'
op|'.'
name|'tmpfile'
op|')'
newline|'\n'
name|'ring'
op|'.'
name|'devs'
op|'['
number|'0'
op|']'
op|'['
string|"'weight'"
op|']'
op|'='
number|'10'
newline|'\n'
name|'ring'
op|'.'
name|'save'
op|'('
name|'self'
op|'.'
name|'tmpfile'
op|')'
newline|'\n'
name|'argv'
op|'='
op|'['
string|'""'
op|','
name|'self'
op|'.'
name|'tmpfile'
op|','
string|'"rebalance"'
op|']'
newline|'\n'
name|'err'
op|'='
name|'None'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'ringbuilder'
op|'.'
name|'main'
op|'('
name|'argv'
op|')'
newline|'\n'
dedent|''
name|'except'
name|'SystemExit'
name|'as'
name|'e'
op|':'
newline|'\n'
indent|'            '
name|'err'
op|'='
name|'e'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'err'
op|'.'
name|'code'
op|','
number|'1'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_no_warn_when_balanced
dedent|''
name|'def'
name|'test_no_warn_when_balanced'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# when the number of total part replicas (3 * 2 ** 10 = 3072 in'
nl|'\n'
comment|'# this ring) is larger than the total units of weight (310 in'
nl|'\n'
comment|'# this ring) the relative number of parts per unit of weight'
nl|'\n'
comment|'# (called weight_of_one_part) is more than 1 - and each whole'
nl|'\n'
comment|'# part placed takes up a smaller ratio of the larger number of'
nl|'\n'
comment|"# parts the device wants - so it's much easier to satisfy a"
nl|'\n'
comment|"# device's weight exactly - that is to say more parts to go"
nl|'\n'
comment|'# around tends to smooth things out'
nl|'\n'
indent|'        '
name|'self'
op|'.'
name|'create_sample_ring'
op|'('
number|'10'
op|')'
newline|'\n'
name|'ring'
op|'='
name|'RingBuilder'
op|'.'
name|'load'
op|'('
name|'self'
op|'.'
name|'tmpfile'
op|')'
newline|'\n'
name|'ring'
op|'.'
name|'devs'
op|'['
number|'0'
op|']'
op|'['
string|"'weight'"
op|']'
op|'='
number|'10'
newline|'\n'
name|'ring'
op|'.'
name|'save'
op|'('
name|'self'
op|'.'
name|'tmpfile'
op|')'
newline|'\n'
name|'argv'
op|'='
op|'['
string|'""'
op|','
name|'self'
op|'.'
name|'tmpfile'
op|','
string|'"rebalance"'
op|']'
newline|'\n'
name|'err'
op|'='
name|'None'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'ringbuilder'
op|'.'
name|'main'
op|'('
name|'argv'
op|')'
newline|'\n'
dedent|''
name|'except'
name|'SystemExit'
name|'as'
name|'e'
op|':'
newline|'\n'
indent|'            '
name|'err'
op|'='
name|'e'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'err'
op|'.'
name|'code'
op|','
number|'0'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_invalid_device_name
dedent|''
name|'def'
name|'test_invalid_device_name'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'create_sample_ring'
op|'('
op|')'
newline|'\n'
name|'for'
name|'device_name'
name|'in'
op|'['
string|'""'
op|','
string|'" "'
op|','
string|'" sda1"'
op|','
string|'"sda1 "'
op|','
string|'" meta "'
op|']'
op|':'
newline|'\n'
indent|'            '
name|'err'
op|'='
number|'0'
newline|'\n'
nl|'\n'
name|'argv'
op|'='
op|'['
string|'""'
op|','
nl|'\n'
name|'self'
op|'.'
name|'tmpfile'
op|','
nl|'\n'
string|'"add"'
op|','
nl|'\n'
string|'"r1z1-127.0.0.1:6000/%s"'
op|'%'
name|'device_name'
op|','
nl|'\n'
string|'"1"'
op|']'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'                '
name|'ringbuilder'
op|'.'
name|'main'
op|'('
name|'argv'
op|')'
newline|'\n'
dedent|''
name|'except'
name|'SystemExit'
name|'as'
name|'exc'
op|':'
newline|'\n'
indent|'                '
name|'err'
op|'='
name|'exc'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'err'
op|'.'
name|'code'
op|','
number|'2'
op|')'
newline|'\n'
nl|'\n'
name|'argv'
op|'='
op|'['
string|'""'
op|','
nl|'\n'
name|'self'
op|'.'
name|'tmpfile'
op|','
nl|'\n'
string|'"add"'
op|','
nl|'\n'
string|'"--region"'
op|','
string|'"1"'
op|','
nl|'\n'
string|'"--zone"'
op|','
string|'"1"'
op|','
nl|'\n'
string|'"--ip"'
op|','
string|'"127.0.0.1"'
op|','
nl|'\n'
string|'"--port"'
op|','
string|'"6000"'
op|','
nl|'\n'
string|'"--device"'
op|','
name|'device_name'
op|','
nl|'\n'
string|'"--weight"'
op|','
string|'"100"'
op|']'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'                '
name|'ringbuilder'
op|'.'
name|'main'
op|'('
name|'argv'
op|')'
newline|'\n'
dedent|''
name|'except'
name|'SystemExit'
name|'as'
name|'exc'
op|':'
newline|'\n'
indent|'                '
name|'err'
op|'='
name|'exc'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'err'
op|'.'
name|'code'
op|','
number|'2'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_dispersion_command
dedent|''
dedent|''
name|'def'
name|'test_dispersion_command'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'create_sample_ring'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'run_srb'
op|'('
string|"'rebalance'"
op|')'
newline|'\n'
name|'out'
op|','
name|'err'
op|'='
name|'self'
op|'.'
name|'run_srb'
op|'('
string|"'dispersion -v'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertIn'
op|'('
string|"'dispersion'"
op|','
name|'out'
op|'.'
name|'lower'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'err'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_use_ringfile_as_builderfile
dedent|''
name|'def'
name|'test_use_ringfile_as_builderfile'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'mock_stdout'
op|'='
name|'six'
op|'.'
name|'StringIO'
op|'('
op|')'
newline|'\n'
name|'mock_stderr'
op|'='
name|'six'
op|'.'
name|'StringIO'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'argv'
op|'='
op|'['
string|'""'
op|','
string|'"object.ring.gz"'
op|']'
newline|'\n'
nl|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'with'
name|'mock'
op|'.'
name|'patch'
op|'('
string|'"sys.stdout"'
op|','
name|'mock_stdout'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'with'
name|'mock'
op|'.'
name|'patch'
op|'('
string|'"sys.stderr"'
op|','
name|'mock_stderr'
op|')'
op|':'
newline|'\n'
indent|'                    '
name|'ringbuilder'
op|'.'
name|'main'
op|'('
name|'argv'
op|')'
newline|'\n'
dedent|''
dedent|''
dedent|''
name|'except'
name|'SystemExit'
op|':'
newline|'\n'
indent|'            '
name|'pass'
newline|'\n'
dedent|''
name|'expected'
op|'='
string|'"Note: using object.builder instead of object.ring.gz "'
string|'"as builder file\\n"'
string|'"Ring Builder file does not exist: object.builder\\n"'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'expected'
op|','
name|'mock_stdout'
op|'.'
name|'getvalue'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_main_no_arguments
dedent|''
name|'def'
name|'test_main_no_arguments'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# Test calling main with no arguments'
nl|'\n'
indent|'        '
name|'argv'
op|'='
op|'['
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'SystemExit'
op|','
name|'ringbuilder'
op|'.'
name|'main'
op|','
name|'argv'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_main_single_argument
dedent|''
name|'def'
name|'test_main_single_argument'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# Test calling main with single argument'
nl|'\n'
indent|'        '
name|'argv'
op|'='
op|'['
string|'""'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'SystemExit'
op|','
name|'ringbuilder'
op|'.'
name|'main'
op|','
name|'argv'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_main_with_safe
dedent|''
name|'def'
name|'test_main_with_safe'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|"# Test calling main with '-safe' argument"
nl|'\n'
indent|'        '
name|'self'
op|'.'
name|'create_sample_ring'
op|'('
op|')'
newline|'\n'
name|'argv'
op|'='
op|'['
string|'"-safe"'
op|','
name|'self'
op|'.'
name|'tmpfile'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'SystemExit'
op|','
name|'ringbuilder'
op|'.'
name|'main'
op|','
name|'argv'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|TestRebalanceCommand
dedent|''
dedent|''
name|'class'
name|'TestRebalanceCommand'
op|'('
name|'unittest'
op|'.'
name|'TestCase'
op|','
name|'RunSwiftRingBuilderMixin'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|member|__init__
indent|'    '
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
op|'*'
name|'args'
op|','
op|'**'
name|'kwargs'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'super'
op|'('
name|'TestRebalanceCommand'
op|','
name|'self'
op|')'
op|'.'
name|'__init__'
op|'('
op|'*'
name|'args'
op|','
op|'**'
name|'kwargs'
op|')'
newline|'\n'
name|'tmpf'
op|'='
name|'tempfile'
op|'.'
name|'NamedTemporaryFile'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'tempfile'
op|'='
name|'self'
op|'.'
name|'tmpfile'
op|'='
name|'tmpf'
op|'.'
name|'name'
newline|'\n'
nl|'\n'
DECL|member|tearDown
dedent|''
name|'def'
name|'tearDown'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'os'
op|'.'
name|'remove'
op|'('
name|'self'
op|'.'
name|'tempfile'
op|')'
newline|'\n'
dedent|''
name|'except'
name|'OSError'
op|':'
newline|'\n'
indent|'            '
name|'pass'
newline|'\n'
nl|'\n'
DECL|member|run_srb
dedent|''
dedent|''
name|'def'
name|'run_srb'
op|'('
name|'self'
op|','
op|'*'
name|'argv'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'mock_stdout'
op|'='
name|'six'
op|'.'
name|'StringIO'
op|'('
op|')'
newline|'\n'
name|'mock_stderr'
op|'='
name|'six'
op|'.'
name|'StringIO'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'srb_args'
op|'='
op|'['
string|'""'
op|','
name|'self'
op|'.'
name|'tempfile'
op|']'
op|'+'
op|'['
name|'str'
op|'('
name|'s'
op|')'
name|'for'
name|'s'
name|'in'
name|'argv'
op|']'
newline|'\n'
nl|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'with'
name|'mock'
op|'.'
name|'patch'
op|'('
string|'"sys.stdout"'
op|','
name|'mock_stdout'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'with'
name|'mock'
op|'.'
name|'patch'
op|'('
string|'"sys.stderr"'
op|','
name|'mock_stderr'
op|')'
op|':'
newline|'\n'
indent|'                    '
name|'ringbuilder'
op|'.'
name|'main'
op|'('
name|'srb_args'
op|')'
newline|'\n'
dedent|''
dedent|''
dedent|''
name|'except'
name|'SystemExit'
name|'as'
name|'err'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'err'
op|'.'
name|'code'
name|'not'
name|'in'
op|'('
number|'0'
op|','
number|'1'
op|')'
op|':'
comment|'# (success, warning)'
newline|'\n'
indent|'                '
name|'raise'
newline|'\n'
dedent|''
dedent|''
name|'return'
op|'('
name|'mock_stdout'
op|'.'
name|'getvalue'
op|'('
op|')'
op|','
name|'mock_stderr'
op|'.'
name|'getvalue'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_debug
dedent|''
name|'def'
name|'test_debug'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# NB: getLogger(name) always returns the same object'
nl|'\n'
indent|'        '
name|'rb_logger'
op|'='
name|'logging'
op|'.'
name|'getLogger'
op|'('
string|'"swift.ring.builder"'
op|')'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertNotEqual'
op|'('
name|'rb_logger'
op|'.'
name|'getEffectiveLevel'
op|'('
op|')'
op|','
name|'logging'
op|'.'
name|'DEBUG'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'run_srb'
op|'('
string|'"create"'
op|','
number|'8'
op|','
number|'3'
op|','
number|'1'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'run_srb'
op|'('
string|'"add"'
op|','
nl|'\n'
string|'"r1z1-10.1.1.1:2345/sda"'
op|','
number|'100.0'
op|','
nl|'\n'
string|'"r1z1-10.1.1.1:2345/sdb"'
op|','
number|'100.0'
op|','
nl|'\n'
string|'"r1z1-10.1.1.1:2345/sdc"'
op|','
number|'100.0'
op|','
nl|'\n'
string|'"r1z1-10.1.1.1:2345/sdd"'
op|','
number|'100.0'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'run_srb'
op|'('
string|'"rebalance"'
op|','
string|'"--debug"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'rb_logger'
op|'.'
name|'getEffectiveLevel'
op|'('
op|')'
op|','
name|'logging'
op|'.'
name|'DEBUG'
op|')'
newline|'\n'
nl|'\n'
name|'rb_logger'
op|'.'
name|'setLevel'
op|'('
name|'logging'
op|'.'
name|'INFO'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'run_srb'
op|'('
string|'"rebalance"'
op|','
string|'"--debug"'
op|','
string|'"123"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'rb_logger'
op|'.'
name|'getEffectiveLevel'
op|'('
op|')'
op|','
name|'logging'
op|'.'
name|'DEBUG'
op|')'
newline|'\n'
nl|'\n'
name|'rb_logger'
op|'.'
name|'setLevel'
op|'('
name|'logging'
op|'.'
name|'INFO'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'run_srb'
op|'('
string|'"rebalance"'
op|','
string|'"123"'
op|','
string|'"--debug"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'rb_logger'
op|'.'
name|'getEffectiveLevel'
op|'('
op|')'
op|','
name|'logging'
op|'.'
name|'DEBUG'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'finally'
op|':'
newline|'\n'
indent|'            '
name|'rb_logger'
op|'.'
name|'setLevel'
op|'('
name|'logging'
op|'.'
name|'INFO'
op|')'
comment|'# silence other test cases'
newline|'\n'
nl|'\n'
DECL|member|test_rebalance_warning_appears
dedent|''
dedent|''
name|'def'
name|'test_rebalance_warning_appears'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'run_srb'
op|'('
string|'"create"'
op|','
number|'8'
op|','
number|'3'
op|','
number|'24'
op|')'
newline|'\n'
comment|'# all in one machine: totally balanceable'
nl|'\n'
name|'self'
op|'.'
name|'run_srb'
op|'('
string|'"add"'
op|','
nl|'\n'
string|'"r1z1-10.1.1.1:2345/sda"'
op|','
number|'100.0'
op|','
nl|'\n'
string|'"r1z1-10.1.1.1:2345/sdb"'
op|','
number|'100.0'
op|','
nl|'\n'
string|'"r1z1-10.1.1.1:2345/sdc"'
op|','
number|'100.0'
op|','
nl|'\n'
string|'"r1z1-10.1.1.1:2345/sdd"'
op|','
number|'100.0'
op|')'
newline|'\n'
name|'out'
op|','
name|'err'
op|'='
name|'self'
op|'.'
name|'run_srb'
op|'('
string|'"rebalance"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
string|'"rebalance/repush"'
name|'not'
name|'in'
name|'out'
op|')'
newline|'\n'
nl|'\n'
comment|'# 2 machines of equal size: balanceable, but not in one pass due to'
nl|'\n'
comment|'# min_part_hours > 0'
nl|'\n'
name|'self'
op|'.'
name|'run_srb'
op|'('
string|'"add"'
op|','
nl|'\n'
string|'"r1z1-10.1.1.2:2345/sda"'
op|','
number|'100.0'
op|','
nl|'\n'
string|'"r1z1-10.1.1.2:2345/sdb"'
op|','
number|'100.0'
op|','
nl|'\n'
string|'"r1z1-10.1.1.2:2345/sdc"'
op|','
number|'100.0'
op|','
nl|'\n'
string|'"r1z1-10.1.1.2:2345/sdd"'
op|','
number|'100.0'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'run_srb'
op|'('
string|'"pretend_min_part_hours_passed"'
op|')'
newline|'\n'
name|'out'
op|','
name|'err'
op|'='
name|'self'
op|'.'
name|'run_srb'
op|'('
string|'"rebalance"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
string|'"rebalance/repush"'
name|'in'
name|'out'
op|')'
newline|'\n'
nl|'\n'
comment|"# after two passes, it's all balanced out"
nl|'\n'
name|'self'
op|'.'
name|'run_srb'
op|'('
string|'"pretend_min_part_hours_passed"'
op|')'
newline|'\n'
name|'out'
op|','
name|'err'
op|'='
name|'self'
op|'.'
name|'run_srb'
op|'('
string|'"rebalance"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
string|'"rebalance/repush"'
name|'not'
name|'in'
name|'out'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_rebalance_warning_with_overload
dedent|''
name|'def'
name|'test_rebalance_warning_with_overload'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'run_srb'
op|'('
string|'"create"'
op|','
number|'8'
op|','
number|'3'
op|','
number|'24'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'run_srb'
op|'('
string|'"set_overload"'
op|','
number|'0.12'
op|')'
newline|'\n'
comment|"# The ring's balance is at least 5, so normally we'd get a warning,"
nl|'\n'
comment|"# but it's suppressed due to the overload factor."
nl|'\n'
name|'self'
op|'.'
name|'run_srb'
op|'('
string|'"add"'
op|','
nl|'\n'
string|'"r1z1-10.1.1.1:2345/sda"'
op|','
number|'100.0'
op|','
nl|'\n'
string|'"r1z1-10.1.1.1:2345/sdb"'
op|','
number|'100.0'
op|','
nl|'\n'
string|'"r1z1-10.1.1.1:2345/sdc"'
op|','
number|'120.0'
op|')'
newline|'\n'
name|'out'
op|','
name|'err'
op|'='
name|'self'
op|'.'
name|'run_srb'
op|'('
string|'"rebalance"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
string|'"rebalance/repush"'
name|'not'
name|'in'
name|'out'
op|')'
newline|'\n'
nl|'\n'
comment|'# Now we add in a really big device, but not enough partitions move'
nl|'\n'
comment|'# to fill it in one pass, so we see the rebalance warning.'
nl|'\n'
name|'self'
op|'.'
name|'run_srb'
op|'('
string|'"add"'
op|','
string|'"r1z1-10.1.1.1:2345/sdd"'
op|','
number|'99999.0'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'run_srb'
op|'('
string|'"pretend_min_part_hours_passed"'
op|')'
newline|'\n'
name|'out'
op|','
name|'err'
op|'='
name|'self'
op|'.'
name|'run_srb'
op|'('
string|'"rebalance"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
string|'"rebalance/repush"'
name|'in'
name|'out'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_cached_dispersion_value
dedent|''
name|'def'
name|'test_cached_dispersion_value'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'run_srb'
op|'('
string|'"create"'
op|','
number|'8'
op|','
number|'3'
op|','
number|'24'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'run_srb'
op|'('
string|'"add"'
op|','
nl|'\n'
string|'"r1z1-10.1.1.1:2345/sda"'
op|','
number|'100.0'
op|','
nl|'\n'
string|'"r1z1-10.1.1.1:2345/sdb"'
op|','
number|'100.0'
op|','
nl|'\n'
string|'"r1z1-10.1.1.1:2345/sdc"'
op|','
number|'100.0'
op|','
nl|'\n'
string|'"r1z1-10.1.1.1:2345/sdd"'
op|','
number|'100.0'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'run_srb'
op|'('
string|"'rebalance'"
op|')'
newline|'\n'
name|'out'
op|','
name|'err'
op|'='
name|'self'
op|'.'
name|'run_srb'
op|'('
op|')'
comment|'# list devices'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
string|"'dispersion'"
name|'in'
name|'out'
op|')'
newline|'\n'
comment|'# remove cached dispersion value'
nl|'\n'
name|'builder'
op|'='
name|'RingBuilder'
op|'.'
name|'load'
op|'('
name|'self'
op|'.'
name|'tempfile'
op|')'
newline|'\n'
name|'builder'
op|'.'
name|'dispersion'
op|'='
name|'None'
newline|'\n'
name|'builder'
op|'.'
name|'save'
op|'('
name|'self'
op|'.'
name|'tempfile'
op|')'
newline|'\n'
comment|'# now dispersion output is suppressed'
nl|'\n'
name|'out'
op|','
name|'err'
op|'='
name|'self'
op|'.'
name|'run_srb'
op|'('
op|')'
comment|'# list devices'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
string|"'dispersion'"
name|'in'
name|'out'
op|')'
newline|'\n'
comment|'# but will show up after rebalance'
nl|'\n'
name|'self'
op|'.'
name|'run_srb'
op|'('
string|"'rebalance'"
op|','
string|"'-f'"
op|')'
newline|'\n'
name|'out'
op|','
name|'err'
op|'='
name|'self'
op|'.'
name|'run_srb'
op|'('
op|')'
comment|'# list devices'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
string|"'dispersion'"
name|'in'
name|'out'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
dedent|''
dedent|''
name|'if'
name|'__name__'
op|'=='
string|"'__main__'"
op|':'
newline|'\n'
indent|'    '
name|'unittest'
op|'.'
name|'main'
op|'('
op|')'
newline|'\n'
dedent|''
endmarker|''
end_unit
