begin_unit
comment|'# Copyright (c) 2011 OpenStack, LLC.'
nl|'\n'
comment|'#'
nl|'\n'
comment|'# Licensed under the Apache License, Version 2.0 (the "License");'
nl|'\n'
comment|'# you may not use this file except in compliance with the License.'
nl|'\n'
comment|'# You may obtain a copy of the License at'
nl|'\n'
comment|'#'
nl|'\n'
comment|'#    http://www.apache.org/licenses/LICENSE-2.0'
nl|'\n'
comment|'#'
nl|'\n'
comment|'# Unless required by applicable law or agreed to in writing, software'
nl|'\n'
comment|'# distributed under the License is distributed on an "AS IS" BASIS,'
nl|'\n'
comment|'# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or'
nl|'\n'
comment|'# implied.'
nl|'\n'
comment|'# See the License for the specific language governing permissions and'
nl|'\n'
comment|'# limitations under the License.'
nl|'\n'
nl|'\n'
name|'import'
name|'json'
newline|'\n'
name|'from'
name|'sys'
name|'import'
name|'exc_info'
newline|'\n'
name|'from'
name|'time'
name|'import'
name|'time'
newline|'\n'
name|'from'
name|'unittest'
name|'import'
name|'main'
op|','
name|'TestCase'
newline|'\n'
nl|'\n'
name|'from'
name|'swift'
op|'.'
name|'obj'
name|'import'
name|'expirer'
newline|'\n'
name|'from'
name|'swift'
op|'.'
name|'proxy'
op|'.'
name|'server'
name|'import'
name|'Application'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|function|not_random
name|'def'
name|'not_random'
op|'('
op|')'
op|':'
newline|'\n'
indent|'    '
name|'return'
number|'0.5'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|variable|last_not_sleep
dedent|''
name|'last_not_sleep'
op|'='
number|'0'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|function|not_sleep
name|'def'
name|'not_sleep'
op|'('
name|'seconds'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'global'
name|'last_not_sleep'
newline|'\n'
name|'last_not_sleep'
op|'='
name|'seconds'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|MockLogger
dedent|''
name|'class'
name|'MockLogger'
op|'('
name|'object'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|member|__init__
indent|'    '
name|'def'
name|'__init__'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'debugs'
op|'='
op|'['
op|']'
newline|'\n'
name|'self'
op|'.'
name|'infos'
op|'='
op|'['
op|']'
newline|'\n'
name|'self'
op|'.'
name|'exceptions'
op|'='
op|'['
op|']'
newline|'\n'
nl|'\n'
DECL|member|debug
dedent|''
name|'def'
name|'debug'
op|'('
name|'self'
op|','
name|'msg'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'debugs'
op|'.'
name|'append'
op|'('
name|'msg'
op|')'
newline|'\n'
nl|'\n'
DECL|member|info
dedent|''
name|'def'
name|'info'
op|'('
name|'self'
op|','
name|'msg'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'infos'
op|'.'
name|'append'
op|'('
name|'msg'
op|')'
newline|'\n'
nl|'\n'
DECL|member|exception
dedent|''
name|'def'
name|'exception'
op|'('
name|'self'
op|','
name|'msg'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'exceptions'
op|'.'
name|'append'
op|'('
string|"'%s: %s'"
op|'%'
op|'('
name|'msg'
op|','
name|'exc_info'
op|'('
op|')'
op|'['
number|'1'
op|']'
op|')'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|FakeRing
dedent|''
dedent|''
name|'class'
name|'FakeRing'
op|'('
name|'object'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|member|__init__
indent|'    '
name|'def'
name|'__init__'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'devs'
op|'='
op|'{'
number|'1'
op|':'
op|'{'
string|"'ip'"
op|':'
string|"'10.0.0.1'"
op|','
string|"'port'"
op|':'
number|'1000'
op|','
string|"'device'"
op|':'
string|"'sda'"
op|'}'
op|','
nl|'\n'
number|'2'
op|':'
op|'{'
string|"'ip'"
op|':'
string|"'10.0.0.2'"
op|','
string|"'port'"
op|':'
number|'1000'
op|','
string|"'device'"
op|':'
string|"'sda'"
op|'}'
op|','
nl|'\n'
number|'3'
op|':'
op|'{'
string|"'ip'"
op|':'
string|"'10.0.0.3'"
op|','
string|"'port'"
op|':'
number|'1000'
op|','
string|"'device'"
op|':'
string|"'sda'"
op|'}'
op|','
nl|'\n'
number|'4'
op|':'
op|'{'
string|"'ip'"
op|':'
string|"'10.0.0.4'"
op|','
string|"'port'"
op|':'
number|'1000'
op|','
string|"'device'"
op|':'
string|"'sda'"
op|'}'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'replica_count'
op|'='
number|'3'
newline|'\n'
nl|'\n'
DECL|member|get_nodes
dedent|''
name|'def'
name|'get_nodes'
op|'('
name|'self'
op|','
name|'account'
op|','
name|'container'
op|'='
name|'None'
op|','
name|'obj'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
number|'1'
op|','
op|'['
name|'self'
op|'.'
name|'devs'
op|'['
name|'i'
op|']'
name|'for'
name|'i'
name|'in'
name|'xrange'
op|'('
number|'1'
op|','
name|'self'
op|'.'
name|'replica_count'
op|'+'
number|'1'
op|')'
op|']'
newline|'\n'
nl|'\n'
DECL|member|get_part_nodes
dedent|''
name|'def'
name|'get_part_nodes'
op|'('
name|'self'
op|','
name|'part'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'self'
op|'.'
name|'get_nodes'
op|'('
string|"''"
op|')'
op|'['
number|'1'
op|']'
newline|'\n'
nl|'\n'
DECL|member|get_more_nodes
dedent|''
name|'def'
name|'get_more_nodes'
op|'('
name|'self'
op|','
name|'nodes'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'yield'
name|'self'
op|'.'
name|'devs'
op|'['
name|'self'
op|'.'
name|'replica_count'
op|'+'
number|'1'
op|']'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|TestObjectExpirer
dedent|''
dedent|''
name|'class'
name|'TestObjectExpirer'
op|'('
name|'TestCase'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|member|setUp
indent|'    '
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'orig_loadapp'
op|'='
name|'expirer'
op|'.'
name|'loadapp'
newline|'\n'
name|'expirer'
op|'.'
name|'loadapp'
op|'='
name|'lambda'
name|'x'
op|':'
name|'Application'
op|'('
op|'{'
op|'}'
op|','
name|'account_ring'
op|'='
name|'FakeRing'
op|'('
op|')'
op|','
nl|'\n'
name|'container_ring'
op|'='
name|'FakeRing'
op|'('
op|')'
op|','
name|'object_ring'
op|'='
name|'FakeRing'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|tearDown
dedent|''
name|'def'
name|'tearDown'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'expirer'
op|'.'
name|'loadapp'
op|'='
name|'self'
op|'.'
name|'orig_loadapp'
newline|'\n'
nl|'\n'
DECL|member|test_report
dedent|''
name|'def'
name|'test_report'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'x'
op|'='
name|'expirer'
op|'.'
name|'ObjectExpirer'
op|'('
op|'{'
op|'}'
op|')'
newline|'\n'
name|'x'
op|'.'
name|'logger'
op|'='
name|'MockLogger'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'x'
op|'.'
name|'logger'
op|'.'
name|'infos'
op|'='
op|'['
op|']'
newline|'\n'
name|'x'
op|'.'
name|'report'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'x'
op|'.'
name|'logger'
op|'.'
name|'infos'
op|','
op|'['
op|']'
op|')'
newline|'\n'
nl|'\n'
name|'x'
op|'.'
name|'logger'
op|'.'
name|'infos'
op|'='
op|'['
op|']'
newline|'\n'
name|'x'
op|'.'
name|'report'
op|'('
name|'final'
op|'='
name|'True'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
string|"'completed'"
name|'in'
name|'x'
op|'.'
name|'logger'
op|'.'
name|'infos'
op|'['
op|'-'
number|'1'
op|']'
op|','
name|'x'
op|'.'
name|'logger'
op|'.'
name|'infos'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
string|"'so far'"
name|'not'
name|'in'
name|'x'
op|'.'
name|'logger'
op|'.'
name|'infos'
op|'['
op|'-'
number|'1'
op|']'
op|','
name|'x'
op|'.'
name|'logger'
op|'.'
name|'infos'
op|')'
newline|'\n'
nl|'\n'
name|'x'
op|'.'
name|'logger'
op|'.'
name|'infos'
op|'='
op|'['
op|']'
newline|'\n'
name|'x'
op|'.'
name|'report_last_time'
op|'='
name|'time'
op|'('
op|')'
op|'-'
name|'x'
op|'.'
name|'report_interval'
newline|'\n'
name|'x'
op|'.'
name|'report'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
string|"'completed'"
name|'not'
name|'in'
name|'x'
op|'.'
name|'logger'
op|'.'
name|'infos'
op|'['
op|'-'
number|'1'
op|']'
op|','
name|'x'
op|'.'
name|'logger'
op|'.'
name|'infos'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
string|"'so far'"
name|'in'
name|'x'
op|'.'
name|'logger'
op|'.'
name|'infos'
op|'['
op|'-'
number|'1'
op|']'
op|','
name|'x'
op|'.'
name|'logger'
op|'.'
name|'infos'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_run_once_nothing_to_do
dedent|''
name|'def'
name|'test_run_once_nothing_to_do'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'x'
op|'='
name|'expirer'
op|'.'
name|'ObjectExpirer'
op|'('
op|'{'
op|'}'
op|')'
newline|'\n'
name|'x'
op|'.'
name|'logger'
op|'='
name|'MockLogger'
op|'('
op|')'
newline|'\n'
name|'x'
op|'.'
name|'get_account_info'
op|'='
string|"'throw error because a string is not callable'"
newline|'\n'
name|'x'
op|'.'
name|'run_once'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'x'
op|'.'
name|'logger'
op|'.'
name|'exceptions'
op|','
nl|'\n'
op|'['
string|'"Unhandled exception: \'str\' object is not callable"'
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_run_once_calls_report
dedent|''
name|'def'
name|'test_run_once_calls_report'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'x'
op|'='
name|'expirer'
op|'.'
name|'ObjectExpirer'
op|'('
op|'{'
op|'}'
op|')'
newline|'\n'
name|'x'
op|'.'
name|'logger'
op|'='
name|'MockLogger'
op|'('
op|')'
newline|'\n'
name|'x'
op|'.'
name|'get_account_info'
op|'='
name|'lambda'
op|':'
op|'('
number|'1'
op|','
number|'2'
op|')'
newline|'\n'
name|'x'
op|'.'
name|'iter_containers'
op|'='
name|'lambda'
op|':'
op|'['
op|']'
newline|'\n'
name|'x'
op|'.'
name|'run_once'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'x'
op|'.'
name|'logger'
op|'.'
name|'exceptions'
op|','
op|'['
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'x'
op|'.'
name|'logger'
op|'.'
name|'infos'
op|','
nl|'\n'
op|'['
string|"'Pass beginning; 1 possible containers; 2 possible objects'"
op|','
nl|'\n'
string|"'Pass completed in 0s; 0 objects expired'"
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_container_timestamp_break
dedent|''
name|'def'
name|'test_container_timestamp_break'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|function|should_not_get_called
indent|'        '
name|'def'
name|'should_not_get_called'
op|'('
name|'container'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'Exception'
op|'('
string|"'This should not have been called'"
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'x'
op|'='
name|'expirer'
op|'.'
name|'ObjectExpirer'
op|'('
op|'{'
op|'}'
op|')'
newline|'\n'
name|'x'
op|'.'
name|'logger'
op|'='
name|'MockLogger'
op|'('
op|')'
newline|'\n'
name|'x'
op|'.'
name|'get_account_info'
op|'='
name|'lambda'
op|':'
op|'('
number|'1'
op|','
number|'2'
op|')'
newline|'\n'
name|'x'
op|'.'
name|'iter_containers'
op|'='
name|'lambda'
op|':'
op|'['
name|'str'
op|'('
name|'int'
op|'('
name|'time'
op|'('
op|')'
op|'+'
number|'86400'
op|')'
op|')'
op|']'
newline|'\n'
name|'x'
op|'.'
name|'iter_objects'
op|'='
name|'should_not_get_called'
newline|'\n'
name|'x'
op|'.'
name|'run_once'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'x'
op|'.'
name|'logger'
op|'.'
name|'exceptions'
op|','
op|'['
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'x'
op|'.'
name|'logger'
op|'.'
name|'infos'
op|','
nl|'\n'
op|'['
string|"'Pass beginning; 1 possible containers; 2 possible objects'"
op|','
nl|'\n'
string|"'Pass completed in 0s; 0 objects expired'"
op|']'
op|')'
newline|'\n'
nl|'\n'
comment|'# Reverse test to be sure it still would blow up the way expected.'
nl|'\n'
name|'x'
op|'='
name|'expirer'
op|'.'
name|'ObjectExpirer'
op|'('
op|'{'
op|'}'
op|')'
newline|'\n'
name|'x'
op|'.'
name|'logger'
op|'='
name|'MockLogger'
op|'('
op|')'
newline|'\n'
name|'x'
op|'.'
name|'get_account_info'
op|'='
name|'lambda'
op|':'
op|'('
number|'1'
op|','
number|'2'
op|')'
newline|'\n'
name|'x'
op|'.'
name|'iter_containers'
op|'='
name|'lambda'
op|':'
op|'['
name|'str'
op|'('
name|'int'
op|'('
name|'time'
op|'('
op|')'
op|'-'
number|'86400'
op|')'
op|')'
op|']'
newline|'\n'
name|'x'
op|'.'
name|'iter_objects'
op|'='
name|'should_not_get_called'
newline|'\n'
name|'x'
op|'.'
name|'run_once'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'x'
op|'.'
name|'logger'
op|'.'
name|'exceptions'
op|','
nl|'\n'
op|'['
string|"'Unhandled exception: This should not have been called'"
op|']'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|test_object_timestamp_break
dedent|''
name|'def'
name|'test_object_timestamp_break'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|function|should_not_get_called
indent|'        '
name|'def'
name|'should_not_get_called'
op|'('
name|'actual_obj'
op|','
name|'timestamp'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'Exception'
op|'('
string|"'This should not have been called'"
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'x'
op|'='
name|'expirer'
op|'.'
name|'ObjectExpirer'
op|'('
op|'{'
op|'}'
op|')'
newline|'\n'
name|'x'
op|'.'
name|'logger'
op|'='
name|'MockLogger'
op|'('
op|')'
newline|'\n'
name|'x'
op|'.'
name|'get_account_info'
op|'='
name|'lambda'
op|':'
op|'('
number|'1'
op|','
number|'2'
op|')'
newline|'\n'
name|'x'
op|'.'
name|'iter_containers'
op|'='
name|'lambda'
op|':'
op|'['
name|'str'
op|'('
name|'int'
op|'('
name|'time'
op|'('
op|')'
op|'-'
number|'86400'
op|')'
op|')'
op|']'
newline|'\n'
name|'x'
op|'.'
name|'iter_objects'
op|'='
name|'lambda'
name|'c'
op|':'
op|'['
string|"'%d-actual-obj'"
op|'%'
name|'int'
op|'('
name|'time'
op|'('
op|')'
op|'+'
number|'86400'
op|')'
op|']'
newline|'\n'
name|'x'
op|'.'
name|'delete_actual_object'
op|'='
name|'should_not_get_called'
newline|'\n'
name|'x'
op|'.'
name|'delete_container'
op|'='
name|'lambda'
name|'c'
op|':'
name|'None'
newline|'\n'
name|'x'
op|'.'
name|'run_once'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'x'
op|'.'
name|'logger'
op|'.'
name|'exceptions'
op|','
op|'['
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'x'
op|'.'
name|'logger'
op|'.'
name|'infos'
op|','
nl|'\n'
op|'['
string|"'Pass beginning; 1 possible containers; 2 possible objects'"
op|','
nl|'\n'
string|"'Pass completed in 0s; 0 objects expired'"
op|']'
op|')'
newline|'\n'
nl|'\n'
comment|'# Reverse test to be sure it still would blow up the way expected.'
nl|'\n'
name|'x'
op|'='
name|'expirer'
op|'.'
name|'ObjectExpirer'
op|'('
op|'{'
op|'}'
op|')'
newline|'\n'
name|'x'
op|'.'
name|'logger'
op|'='
name|'MockLogger'
op|'('
op|')'
newline|'\n'
name|'x'
op|'.'
name|'get_account_info'
op|'='
name|'lambda'
op|':'
op|'('
number|'1'
op|','
number|'2'
op|')'
newline|'\n'
name|'x'
op|'.'
name|'iter_containers'
op|'='
name|'lambda'
op|':'
op|'['
name|'str'
op|'('
name|'int'
op|'('
name|'time'
op|'('
op|')'
op|'-'
number|'86400'
op|')'
op|')'
op|']'
newline|'\n'
name|'ts'
op|'='
name|'int'
op|'('
name|'time'
op|'('
op|')'
op|'-'
number|'86400'
op|')'
newline|'\n'
name|'x'
op|'.'
name|'iter_objects'
op|'='
name|'lambda'
name|'c'
op|':'
op|'['
string|"'%d-actual-obj'"
op|'%'
name|'ts'
op|']'
newline|'\n'
name|'x'
op|'.'
name|'delete_actual_object'
op|'='
name|'should_not_get_called'
newline|'\n'
name|'x'
op|'.'
name|'delete_container'
op|'='
name|'lambda'
name|'c'
op|':'
name|'None'
newline|'\n'
name|'x'
op|'.'
name|'run_once'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'x'
op|'.'
name|'logger'
op|'.'
name|'exceptions'
op|','
op|'['
string|"'Exception while deleting '"
nl|'\n'
string|"'object %d %d-actual-obj This should not have been called: This '"
nl|'\n'
string|"'should not have been called'"
op|'%'
op|'('
name|'ts'
op|','
name|'ts'
op|')'
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_failed_delete_keeps_entry
dedent|''
name|'def'
name|'test_failed_delete_keeps_entry'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|function|deliberately_blow_up
indent|'        '
name|'def'
name|'deliberately_blow_up'
op|'('
name|'actual_obj'
op|','
name|'timestamp'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'Exception'
op|'('
string|"'failed to delete actual object'"
op|')'
newline|'\n'
nl|'\n'
DECL|function|should_not_get_called
dedent|''
name|'def'
name|'should_not_get_called'
op|'('
name|'container'
op|','
name|'obj'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'Exception'
op|'('
string|"'This should not have been called'"
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'x'
op|'='
name|'expirer'
op|'.'
name|'ObjectExpirer'
op|'('
op|'{'
op|'}'
op|')'
newline|'\n'
name|'x'
op|'.'
name|'logger'
op|'='
name|'MockLogger'
op|'('
op|')'
newline|'\n'
name|'x'
op|'.'
name|'get_account_info'
op|'='
name|'lambda'
op|':'
op|'('
number|'1'
op|','
number|'2'
op|')'
newline|'\n'
name|'x'
op|'.'
name|'iter_containers'
op|'='
name|'lambda'
op|':'
op|'['
name|'str'
op|'('
name|'int'
op|'('
name|'time'
op|'('
op|')'
op|'-'
number|'86400'
op|')'
op|')'
op|']'
newline|'\n'
name|'ts'
op|'='
name|'int'
op|'('
name|'time'
op|'('
op|')'
op|'-'
number|'86400'
op|')'
newline|'\n'
name|'x'
op|'.'
name|'iter_objects'
op|'='
name|'lambda'
name|'c'
op|':'
op|'['
string|"'%d-actual-obj'"
op|'%'
name|'ts'
op|']'
newline|'\n'
name|'x'
op|'.'
name|'delete_actual_object'
op|'='
name|'deliberately_blow_up'
newline|'\n'
name|'x'
op|'.'
name|'delete_object'
op|'='
name|'should_not_get_called'
newline|'\n'
name|'x'
op|'.'
name|'delete_container'
op|'='
name|'lambda'
name|'c'
op|':'
name|'None'
newline|'\n'
name|'x'
op|'.'
name|'run_once'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'x'
op|'.'
name|'logger'
op|'.'
name|'exceptions'
op|','
op|'['
string|"'Exception while deleting '"
nl|'\n'
string|"'object %d %d-actual-obj failed to delete actual object: failed '"
nl|'\n'
string|"'to delete actual object'"
op|'%'
op|'('
name|'ts'
op|','
name|'ts'
op|')'
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'x'
op|'.'
name|'logger'
op|'.'
name|'infos'
op|','
nl|'\n'
op|'['
string|"'Pass beginning; 1 possible containers; 2 possible objects'"
op|','
nl|'\n'
string|"'Pass completed in 0s; 0 objects expired'"
op|']'
op|')'
newline|'\n'
nl|'\n'
comment|'# Reverse test to be sure it still would blow up the way expected.'
nl|'\n'
name|'x'
op|'='
name|'expirer'
op|'.'
name|'ObjectExpirer'
op|'('
op|'{'
op|'}'
op|')'
newline|'\n'
name|'x'
op|'.'
name|'logger'
op|'='
name|'MockLogger'
op|'('
op|')'
newline|'\n'
name|'x'
op|'.'
name|'get_account_info'
op|'='
name|'lambda'
op|':'
op|'('
number|'1'
op|','
number|'2'
op|')'
newline|'\n'
name|'x'
op|'.'
name|'iter_containers'
op|'='
name|'lambda'
op|':'
op|'['
name|'str'
op|'('
name|'int'
op|'('
name|'time'
op|'('
op|')'
op|'-'
number|'86400'
op|')'
op|')'
op|']'
newline|'\n'
name|'ts'
op|'='
name|'int'
op|'('
name|'time'
op|'('
op|')'
op|'-'
number|'86400'
op|')'
newline|'\n'
name|'x'
op|'.'
name|'iter_objects'
op|'='
name|'lambda'
name|'c'
op|':'
op|'['
string|"'%d-actual-obj'"
op|'%'
name|'ts'
op|']'
newline|'\n'
name|'x'
op|'.'
name|'delete_actual_object'
op|'='
name|'lambda'
name|'o'
op|','
name|'t'
op|':'
name|'None'
newline|'\n'
name|'x'
op|'.'
name|'delete_object'
op|'='
name|'should_not_get_called'
newline|'\n'
name|'x'
op|'.'
name|'delete_container'
op|'='
name|'lambda'
name|'c'
op|':'
name|'None'
newline|'\n'
name|'x'
op|'.'
name|'run_once'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'x'
op|'.'
name|'logger'
op|'.'
name|'exceptions'
op|','
op|'['
string|"'Exception while deleting '"
nl|'\n'
string|"'object %d %d-actual-obj This should not have been called: This '"
nl|'\n'
string|"'should not have been called'"
op|'%'
op|'('
name|'ts'
op|','
name|'ts'
op|')'
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_success_gets_counted
dedent|''
name|'def'
name|'test_success_gets_counted'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'x'
op|'='
name|'expirer'
op|'.'
name|'ObjectExpirer'
op|'('
op|'{'
op|'}'
op|')'
newline|'\n'
name|'x'
op|'.'
name|'logger'
op|'='
name|'MockLogger'
op|'('
op|')'
newline|'\n'
name|'x'
op|'.'
name|'get_account_info'
op|'='
name|'lambda'
op|':'
op|'('
number|'1'
op|','
number|'2'
op|')'
newline|'\n'
name|'x'
op|'.'
name|'iter_containers'
op|'='
name|'lambda'
op|':'
op|'['
name|'str'
op|'('
name|'int'
op|'('
name|'time'
op|'('
op|')'
op|'-'
number|'86400'
op|')'
op|')'
op|']'
newline|'\n'
name|'x'
op|'.'
name|'iter_objects'
op|'='
name|'lambda'
name|'c'
op|':'
op|'['
string|"'%d-actual-obj'"
op|'%'
name|'int'
op|'('
name|'time'
op|'('
op|')'
op|'-'
number|'86400'
op|')'
op|']'
newline|'\n'
name|'x'
op|'.'
name|'delete_actual_object'
op|'='
name|'lambda'
name|'o'
op|','
name|'t'
op|':'
name|'None'
newline|'\n'
name|'x'
op|'.'
name|'delete_object'
op|'='
name|'lambda'
name|'c'
op|','
name|'o'
op|':'
name|'None'
newline|'\n'
name|'x'
op|'.'
name|'delete_container'
op|'='
name|'lambda'
name|'c'
op|':'
name|'None'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'x'
op|'.'
name|'report_objects'
op|','
number|'0'
op|')'
newline|'\n'
name|'x'
op|'.'
name|'run_once'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'x'
op|'.'
name|'report_objects'
op|','
number|'1'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'x'
op|'.'
name|'logger'
op|'.'
name|'exceptions'
op|','
op|'['
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'x'
op|'.'
name|'logger'
op|'.'
name|'infos'
op|','
nl|'\n'
op|'['
string|"'Pass beginning; 1 possible containers; 2 possible objects'"
op|','
nl|'\n'
string|"'Pass completed in 0s; 1 objects expired'"
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_failed_delete_continues_on
dedent|''
name|'def'
name|'test_failed_delete_continues_on'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|function|fail_delete_actual_object
indent|'        '
name|'def'
name|'fail_delete_actual_object'
op|'('
name|'actual_obj'
op|','
name|'timestamp'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'Exception'
op|'('
string|"'failed to delete actual object'"
op|')'
newline|'\n'
nl|'\n'
DECL|function|fail_delete_container
dedent|''
name|'def'
name|'fail_delete_container'
op|'('
name|'container'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'Exception'
op|'('
string|"'failed to delete container'"
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'x'
op|'='
name|'expirer'
op|'.'
name|'ObjectExpirer'
op|'('
op|'{'
op|'}'
op|')'
newline|'\n'
name|'x'
op|'.'
name|'logger'
op|'='
name|'MockLogger'
op|'('
op|')'
newline|'\n'
name|'x'
op|'.'
name|'get_account_info'
op|'='
name|'lambda'
op|':'
op|'('
number|'1'
op|','
number|'2'
op|')'
newline|'\n'
name|'cts'
op|'='
name|'int'
op|'('
name|'time'
op|'('
op|')'
op|'-'
number|'86400'
op|')'
newline|'\n'
name|'x'
op|'.'
name|'iter_containers'
op|'='
name|'lambda'
op|':'
op|'['
name|'str'
op|'('
name|'cts'
op|')'
op|','
name|'str'
op|'('
name|'cts'
op|'+'
number|'1'
op|')'
op|']'
newline|'\n'
name|'ots'
op|'='
name|'int'
op|'('
name|'time'
op|'('
op|')'
op|'-'
number|'86400'
op|')'
newline|'\n'
name|'x'
op|'.'
name|'iter_objects'
op|'='
name|'lambda'
name|'c'
op|':'
op|'['
string|"'%d-actual-obj'"
op|'%'
name|'ots'
op|','
string|"'%d-next-obj'"
op|'%'
name|'ots'
op|']'
newline|'\n'
name|'x'
op|'.'
name|'delete_actual_object'
op|'='
name|'fail_delete_actual_object'
newline|'\n'
name|'x'
op|'.'
name|'delete_object'
op|'='
name|'lambda'
name|'c'
op|','
name|'o'
op|':'
name|'None'
newline|'\n'
name|'x'
op|'.'
name|'delete_container'
op|'='
name|'fail_delete_container'
newline|'\n'
name|'x'
op|'.'
name|'run_once'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'x'
op|'.'
name|'logger'
op|'.'
name|'exceptions'
op|','
op|'['
nl|'\n'
string|"'Exception while deleting object %d %d-actual-obj failed to '"
nl|'\n'
string|"'delete actual object: failed to delete actual object'"
op|'%'
nl|'\n'
op|'('
name|'cts'
op|','
name|'ots'
op|')'
op|','
nl|'\n'
string|"'Exception while deleting object %d %d-next-obj failed to delete '"
nl|'\n'
string|"'actual object: failed to delete actual object'"
op|'%'
op|'('
name|'cts'
op|','
name|'ots'
op|')'
op|','
nl|'\n'
string|"'Exception while deleting container %d failed to delete '"
nl|'\n'
string|"'container: failed to delete container'"
op|'%'
name|'cts'
op|','
nl|'\n'
string|"'Exception while deleting object %d %d-actual-obj failed to '"
nl|'\n'
string|"'delete actual object: failed to delete actual object'"
op|'%'
nl|'\n'
op|'('
name|'cts'
op|'+'
number|'1'
op|','
name|'ots'
op|')'
op|','
nl|'\n'
string|"'Exception while deleting object %d %d-next-obj failed to delete '"
nl|'\n'
string|"'actual object: failed to delete actual object'"
op|'%'
op|'('
name|'cts'
op|'+'
number|'1'
op|','
name|'ots'
op|')'
op|','
nl|'\n'
string|"'Exception while deleting container %d failed to delete '"
nl|'\n'
string|"'container: failed to delete container'"
op|'%'
op|'('
name|'cts'
op|'+'
number|'1'
op|')'
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'x'
op|'.'
name|'logger'
op|'.'
name|'infos'
op|','
nl|'\n'
op|'['
string|"'Pass beginning; 1 possible containers; 2 possible objects'"
op|','
nl|'\n'
string|"'Pass completed in 0s; 0 objects expired'"
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_run_forever_initial_sleep_random
dedent|''
name|'def'
name|'test_run_forever_initial_sleep_random'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'global'
name|'last_not_sleep'
newline|'\n'
nl|'\n'
DECL|function|raise_system_exit
name|'def'
name|'raise_system_exit'
op|'('
op|')'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'SystemExit'
op|'('
string|"'test_run_forever'"
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'interval'
op|'='
number|'1234'
newline|'\n'
name|'x'
op|'='
name|'expirer'
op|'.'
name|'ObjectExpirer'
op|'('
op|'{'
string|"'__file__'"
op|':'
string|"'unit_test'"
op|','
nl|'\n'
string|"'interval'"
op|':'
name|'interval'
op|'}'
op|')'
newline|'\n'
name|'orig_random'
op|'='
name|'expirer'
op|'.'
name|'random'
newline|'\n'
name|'orig_sleep'
op|'='
name|'expirer'
op|'.'
name|'sleep'
newline|'\n'
name|'exc'
op|'='
name|'None'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'expirer'
op|'.'
name|'random'
op|'='
name|'not_random'
newline|'\n'
name|'expirer'
op|'.'
name|'sleep'
op|'='
name|'not_sleep'
newline|'\n'
name|'x'
op|'.'
name|'run_once'
op|'='
name|'raise_system_exit'
newline|'\n'
name|'x'
op|'.'
name|'run_forever'
op|'('
op|')'
newline|'\n'
dedent|''
name|'except'
name|'SystemExit'
op|','
name|'err'
op|':'
newline|'\n'
indent|'            '
name|'exc'
op|'='
name|'err'
newline|'\n'
dedent|''
name|'finally'
op|':'
newline|'\n'
indent|'            '
name|'expirer'
op|'.'
name|'random'
op|'='
name|'orig_random'
newline|'\n'
name|'expirer'
op|'.'
name|'sleep'
op|'='
name|'orig_sleep'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'str'
op|'('
name|'err'
op|')'
op|','
string|"'test_run_forever'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'last_not_sleep'
op|','
number|'0.5'
op|'*'
name|'interval'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_run_forever_catches_usual_exceptions
dedent|''
name|'def'
name|'test_run_forever_catches_usual_exceptions'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'raises'
op|'='
op|'['
number|'0'
op|']'
newline|'\n'
nl|'\n'
DECL|function|raise_exceptions
name|'def'
name|'raise_exceptions'
op|'('
op|')'
op|':'
newline|'\n'
indent|'            '
name|'raises'
op|'['
number|'0'
op|']'
op|'+='
number|'1'
newline|'\n'
name|'if'
name|'raises'
op|'['
number|'0'
op|']'
op|'<'
number|'2'
op|':'
newline|'\n'
indent|'                '
name|'raise'
name|'Exception'
op|'('
string|"'exception %d'"
op|'%'
name|'raises'
op|'['
number|'0'
op|']'
op|')'
newline|'\n'
dedent|''
name|'raise'
name|'SystemExit'
op|'('
string|"'exiting exception %d'"
op|'%'
name|'raises'
op|'['
number|'0'
op|']'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'x'
op|'='
name|'expirer'
op|'.'
name|'ObjectExpirer'
op|'('
op|'{'
op|'}'
op|')'
newline|'\n'
name|'x'
op|'.'
name|'logger'
op|'='
name|'MockLogger'
op|'('
op|')'
newline|'\n'
name|'orig_sleep'
op|'='
name|'expirer'
op|'.'
name|'sleep'
newline|'\n'
name|'exc'
op|'='
name|'None'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'expirer'
op|'.'
name|'sleep'
op|'='
name|'not_sleep'
newline|'\n'
name|'x'
op|'.'
name|'run_once'
op|'='
name|'raise_exceptions'
newline|'\n'
name|'x'
op|'.'
name|'run_forever'
op|'('
op|')'
newline|'\n'
dedent|''
name|'except'
name|'SystemExit'
op|','
name|'err'
op|':'
newline|'\n'
indent|'            '
name|'exc'
op|'='
name|'err'
newline|'\n'
dedent|''
name|'finally'
op|':'
newline|'\n'
indent|'            '
name|'expirer'
op|'.'
name|'sleep'
op|'='
name|'orig_sleep'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'str'
op|'('
name|'err'
op|')'
op|','
string|"'exiting exception 2'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'x'
op|'.'
name|'logger'
op|'.'
name|'exceptions'
op|','
nl|'\n'
op|'['
string|"'Unhandled exception: exception 1'"
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_response_sets_user_agent
dedent|''
name|'def'
name|'test_get_response_sets_user_agent'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'env_given'
op|'='
op|'['
name|'None'
op|']'
newline|'\n'
nl|'\n'
DECL|function|fake_app
name|'def'
name|'fake_app'
op|'('
name|'env'
op|','
name|'start_response'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'env_given'
op|'['
number|'0'
op|']'
op|'='
name|'env'
newline|'\n'
name|'start_response'
op|'('
string|"'200 Ok'"
op|','
op|'['
op|'('
string|"'Content-Length'"
op|','
string|"'0'"
op|')'
op|']'
op|')'
newline|'\n'
name|'return'
op|'['
op|']'
newline|'\n'
nl|'\n'
dedent|''
name|'x'
op|'='
name|'expirer'
op|'.'
name|'ObjectExpirer'
op|'('
op|'{'
op|'}'
op|')'
newline|'\n'
name|'x'
op|'.'
name|'app'
op|'='
name|'fake_app'
newline|'\n'
name|'resp'
op|'='
name|'x'
op|'.'
name|'get_response'
op|'('
string|"'GET'"
op|','
string|"'/'"
op|','
op|'{'
op|'}'
op|','
op|'('
number|'200'
op|','
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'env_given'
op|'['
number|'0'
op|']'
op|'['
string|"'HTTP_USER_AGENT'"
op|']'
op|','
nl|'\n'
string|"'Swift Object Expirer'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_response_retries
dedent|''
name|'def'
name|'test_get_response_retries'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'global'
name|'last_not_sleep'
newline|'\n'
name|'tries'
op|'='
op|'['
number|'0'
op|']'
newline|'\n'
nl|'\n'
DECL|function|fake_app
name|'def'
name|'fake_app'
op|'('
name|'env'
op|','
name|'start_response'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'tries'
op|'['
number|'0'
op|']'
op|'+='
number|'1'
newline|'\n'
name|'if'
name|'tries'
op|'['
number|'0'
op|']'
op|'<'
number|'3'
op|':'
newline|'\n'
indent|'                '
name|'start_response'
op|'('
string|"'500 Internal Server Error'"
op|','
nl|'\n'
op|'['
op|'('
string|"'Content-Length'"
op|','
string|"'0'"
op|')'
op|']'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                '
name|'start_response'
op|'('
string|"'200 Ok'"
op|','
op|'['
op|'('
string|"'Content-Length'"
op|','
string|"'0'"
op|')'
op|']'
op|')'
newline|'\n'
dedent|''
name|'return'
op|'['
op|']'
newline|'\n'
nl|'\n'
dedent|''
name|'x'
op|'='
name|'expirer'
op|'.'
name|'ObjectExpirer'
op|'('
op|'{'
op|'}'
op|')'
newline|'\n'
name|'x'
op|'.'
name|'app'
op|'='
name|'fake_app'
newline|'\n'
name|'orig_sleep'
op|'='
name|'expirer'
op|'.'
name|'sleep'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'expirer'
op|'.'
name|'sleep'
op|'='
name|'not_sleep'
newline|'\n'
name|'resp'
op|'='
name|'x'
op|'.'
name|'get_response'
op|'('
string|"'GET'"
op|','
string|"'/'"
op|','
op|'{'
op|'}'
op|','
op|'('
number|'200'
op|','
op|')'
op|')'
newline|'\n'
dedent|''
name|'finally'
op|':'
newline|'\n'
indent|'            '
name|'expirer'
op|'.'
name|'sleep'
op|'='
name|'orig_sleep'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'tries'
op|'['
number|'0'
op|']'
op|','
number|'3'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'last_not_sleep'
op|','
number|'4'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_response_method_path_headers
dedent|''
name|'def'
name|'test_get_response_method_path_headers'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'env_given'
op|'='
op|'['
name|'None'
op|']'
newline|'\n'
nl|'\n'
DECL|function|fake_app
name|'def'
name|'fake_app'
op|'('
name|'env'
op|','
name|'start_response'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'env_given'
op|'['
number|'0'
op|']'
op|'='
name|'env'
newline|'\n'
name|'start_response'
op|'('
string|"'200 Ok'"
op|','
op|'['
op|'('
string|"'Content-Length'"
op|','
string|"'0'"
op|')'
op|']'
op|')'
newline|'\n'
name|'return'
op|'['
op|']'
newline|'\n'
nl|'\n'
dedent|''
name|'x'
op|'='
name|'expirer'
op|'.'
name|'ObjectExpirer'
op|'('
op|'{'
op|'}'
op|')'
newline|'\n'
name|'x'
op|'.'
name|'app'
op|'='
name|'fake_app'
newline|'\n'
name|'for'
name|'method'
name|'in'
op|'('
string|"'GET'"
op|','
string|"'SOMETHINGELSE'"
op|')'
op|':'
newline|'\n'
indent|'            '
name|'resp'
op|'='
name|'x'
op|'.'
name|'get_response'
op|'('
name|'method'
op|','
string|"'/'"
op|','
op|'{'
op|'}'
op|','
op|'('
number|'200'
op|','
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'env_given'
op|'['
number|'0'
op|']'
op|'['
string|"'REQUEST_METHOD'"
op|']'
op|','
name|'method'
op|')'
newline|'\n'
dedent|''
name|'for'
name|'path'
name|'in'
op|'('
string|"'/one'"
op|','
string|"'/two/three'"
op|')'
op|':'
newline|'\n'
indent|'            '
name|'resp'
op|'='
name|'x'
op|'.'
name|'get_response'
op|'('
string|"'GET'"
op|','
name|'path'
op|','
op|'{'
string|"'X-Test'"
op|':'
name|'path'
op|'}'
op|','
op|'('
number|'200'
op|','
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'env_given'
op|'['
number|'0'
op|']'
op|'['
string|"'PATH_INFO'"
op|']'
op|','
name|'path'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'env_given'
op|'['
number|'0'
op|']'
op|'['
string|"'HTTP_X_TEST'"
op|']'
op|','
name|'path'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_response_codes
dedent|''
dedent|''
name|'def'
name|'test_get_response_codes'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|function|fake_app
indent|'        '
name|'def'
name|'fake_app'
op|'('
name|'env'
op|','
name|'start_response'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'start_response'
op|'('
string|"'200 Ok'"
op|','
op|'['
op|'('
string|"'Content-Length'"
op|','
string|"'0'"
op|')'
op|']'
op|')'
newline|'\n'
name|'return'
op|'['
op|']'
newline|'\n'
nl|'\n'
dedent|''
name|'x'
op|'='
name|'expirer'
op|'.'
name|'ObjectExpirer'
op|'('
op|'{'
op|'}'
op|')'
newline|'\n'
name|'x'
op|'.'
name|'app'
op|'='
name|'fake_app'
newline|'\n'
name|'orig_sleep'
op|'='
name|'expirer'
op|'.'
name|'sleep'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'expirer'
op|'.'
name|'sleep'
op|'='
name|'not_sleep'
newline|'\n'
name|'resp'
op|'='
name|'x'
op|'.'
name|'get_response'
op|'('
string|"'GET'"
op|','
string|"'/'"
op|','
op|'{'
op|'}'
op|','
op|'('
number|'200'
op|','
op|')'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'x'
op|'.'
name|'get_response'
op|'('
string|"'GET'"
op|','
string|"'/'"
op|','
op|'{'
op|'}'
op|','
op|'('
number|'2'
op|','
op|')'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'x'
op|'.'
name|'get_response'
op|'('
string|"'GET'"
op|','
string|"'/'"
op|','
op|'{'
op|'}'
op|','
op|'('
number|'400'
op|','
number|'200'
op|')'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'x'
op|'.'
name|'get_response'
op|'('
string|"'GET'"
op|','
string|"'/'"
op|','
op|'{'
op|'}'
op|','
op|'('
number|'400'
op|','
number|'2'
op|')'
op|')'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'                '
name|'resp'
op|'='
name|'x'
op|'.'
name|'get_response'
op|'('
string|"'GET'"
op|','
string|"'/'"
op|','
op|'{'
op|'}'
op|','
op|'('
number|'400'
op|','
op|')'
op|')'
newline|'\n'
dedent|''
name|'except'
name|'Exception'
op|','
name|'err'
op|':'
newline|'\n'
indent|'                '
name|'exc'
op|'='
name|'err'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'str'
op|'('
name|'err'
op|')'
op|','
string|"'Unexpected response 200 Ok'"
op|')'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'                '
name|'resp'
op|'='
name|'x'
op|'.'
name|'get_response'
op|'('
string|"'GET'"
op|','
string|"'/'"
op|','
op|'{'
op|'}'
op|','
op|'('
number|'201'
op|','
op|')'
op|')'
newline|'\n'
dedent|''
name|'except'
name|'Exception'
op|','
name|'err'
op|':'
newline|'\n'
indent|'                '
name|'exc'
op|'='
name|'err'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'str'
op|'('
name|'err'
op|')'
op|','
string|"'Unexpected response 200 Ok'"
op|')'
newline|'\n'
dedent|''
name|'finally'
op|':'
newline|'\n'
indent|'            '
name|'expirer'
op|'.'
name|'sleep'
op|'='
name|'orig_sleep'
newline|'\n'
nl|'\n'
DECL|member|test_get_account_info
dedent|''
dedent|''
name|'def'
name|'test_get_account_info'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|function|fake_app
indent|'        '
name|'def'
name|'fake_app'
op|'('
name|'env'
op|','
name|'start_response'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'start_response'
op|'('
string|"'200 Ok'"
op|','
op|'['
op|'('
string|"'Content-Length'"
op|','
string|"'0'"
op|')'
op|','
nl|'\n'
op|'('
string|"'X-Account-Container-Count'"
op|','
string|"'80'"
op|')'
op|','
nl|'\n'
op|'('
string|"'X-Account-Object-Count'"
op|','
string|"'90'"
op|')'
op|']'
op|')'
newline|'\n'
name|'return'
op|'['
op|']'
newline|'\n'
nl|'\n'
dedent|''
name|'x'
op|'='
name|'expirer'
op|'.'
name|'ObjectExpirer'
op|'('
op|'{'
op|'}'
op|')'
newline|'\n'
name|'x'
op|'.'
name|'app'
op|'='
name|'fake_app'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'x'
op|'.'
name|'get_account_info'
op|'('
op|')'
op|','
op|'('
number|'80'
op|','
number|'90'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_account_info_handles_404
dedent|''
name|'def'
name|'test_get_account_info_handles_404'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|function|fake_app
indent|'        '
name|'def'
name|'fake_app'
op|'('
name|'env'
op|','
name|'start_response'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'start_response'
op|'('
string|"'404 Not Found'"
op|','
op|'['
op|'('
string|"'Content-Length'"
op|','
string|"'0'"
op|')'
op|']'
op|')'
newline|'\n'
name|'return'
op|'['
op|']'
newline|'\n'
nl|'\n'
dedent|''
name|'x'
op|'='
name|'expirer'
op|'.'
name|'ObjectExpirer'
op|'('
op|'{'
op|'}'
op|')'
newline|'\n'
name|'x'
op|'.'
name|'app'
op|'='
name|'fake_app'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'x'
op|'.'
name|'get_account_info'
op|'('
op|')'
op|','
op|'('
number|'0'
op|','
number|'0'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_iter_containers
dedent|''
name|'def'
name|'test_iter_containers'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'calls'
op|'='
op|'['
number|'0'
op|']'
newline|'\n'
nl|'\n'
DECL|function|fake_app
name|'def'
name|'fake_app'
op|'('
name|'env'
op|','
name|'start_response'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'calls'
op|'['
number|'0'
op|']'
op|'+='
number|'1'
newline|'\n'
name|'if'
name|'calls'
op|'['
number|'0'
op|']'
op|'=='
number|'1'
op|':'
newline|'\n'
indent|'                '
name|'body'
op|'='
name|'json'
op|'.'
name|'dumps'
op|'('
op|'['
op|'{'
string|"'name'"
op|':'
string|"'one'"
op|'}'
op|','
op|'{'
string|"'name'"
op|':'
string|"'two'"
op|'}'
op|']'
op|')'
newline|'\n'
name|'start_response'
op|'('
string|"'200 Ok'"
op|','
op|'['
op|'('
string|"'Content-Length'"
op|','
name|'str'
op|'('
name|'len'
op|'('
name|'body'
op|')'
op|')'
op|')'
op|']'
op|')'
newline|'\n'
name|'return'
op|'['
name|'body'
op|']'
newline|'\n'
dedent|''
name|'elif'
name|'calls'
op|'['
number|'0'
op|']'
op|'=='
number|'2'
op|':'
newline|'\n'
indent|'                '
name|'body'
op|'='
name|'json'
op|'.'
name|'dumps'
op|'('
op|'['
op|'{'
string|"'name'"
op|':'
string|"'three'"
op|'}'
op|','
op|'{'
string|"'name'"
op|':'
string|"'four'"
op|'}'
op|']'
op|')'
newline|'\n'
name|'start_response'
op|'('
string|"'200 Ok'"
op|','
op|'['
op|'('
string|"'Content-Length'"
op|','
name|'str'
op|'('
name|'len'
op|'('
name|'body'
op|')'
op|')'
op|')'
op|']'
op|')'
newline|'\n'
name|'return'
op|'['
name|'body'
op|']'
newline|'\n'
dedent|''
name|'elif'
name|'calls'
op|'['
number|'0'
op|']'
op|'=='
number|'3'
op|':'
newline|'\n'
indent|'                '
name|'start_response'
op|'('
string|"'204 Ok'"
op|','
op|'['
op|'('
string|"'Content-Length'"
op|','
string|"'0'"
op|')'
op|']'
op|')'
newline|'\n'
name|'return'
op|'['
op|']'
newline|'\n'
dedent|''
name|'raise'
name|'Exception'
op|'('
string|"'Should not get here'"
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'x'
op|'='
name|'expirer'
op|'.'
name|'ObjectExpirer'
op|'('
op|'{'
op|'}'
op|')'
newline|'\n'
name|'x'
op|'.'
name|'app'
op|'='
name|'fake_app'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'list'
op|'('
name|'x'
op|'.'
name|'iter_containers'
op|'('
op|')'
op|')'
op|','
nl|'\n'
op|'['
string|"'one'"
op|','
string|"'two'"
op|','
string|"'three'"
op|','
string|"'four'"
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_iter_containers_handles_404
dedent|''
name|'def'
name|'test_iter_containers_handles_404'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|function|fake_app
indent|'        '
name|'def'
name|'fake_app'
op|'('
name|'env'
op|','
name|'start_response'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'start_response'
op|'('
string|"'404 Not Found'"
op|','
op|'['
op|'('
string|"'Content-Length'"
op|','
string|"'0'"
op|')'
op|']'
op|')'
newline|'\n'
name|'return'
op|'['
op|']'
newline|'\n'
nl|'\n'
dedent|''
name|'x'
op|'='
name|'expirer'
op|'.'
name|'ObjectExpirer'
op|'('
op|'{'
op|'}'
op|')'
newline|'\n'
name|'x'
op|'.'
name|'app'
op|'='
name|'fake_app'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'list'
op|'('
name|'x'
op|'.'
name|'iter_containers'
op|'('
op|')'
op|')'
op|','
op|'['
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_iter_objects
dedent|''
name|'def'
name|'test_iter_objects'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'calls'
op|'='
op|'['
number|'0'
op|']'
newline|'\n'
nl|'\n'
DECL|function|fake_app
name|'def'
name|'fake_app'
op|'('
name|'env'
op|','
name|'start_response'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'calls'
op|'['
number|'0'
op|']'
op|'+='
number|'1'
newline|'\n'
name|'if'
name|'calls'
op|'['
number|'0'
op|']'
op|'=='
number|'1'
op|':'
newline|'\n'
indent|'                '
name|'body'
op|'='
name|'json'
op|'.'
name|'dumps'
op|'('
op|'['
op|'{'
string|"'name'"
op|':'
string|"'one'"
op|'}'
op|','
op|'{'
string|"'name'"
op|':'
string|"'two'"
op|'}'
op|']'
op|')'
newline|'\n'
name|'start_response'
op|'('
string|"'200 Ok'"
op|','
op|'['
op|'('
string|"'Content-Length'"
op|','
name|'str'
op|'('
name|'len'
op|'('
name|'body'
op|')'
op|')'
op|')'
op|']'
op|')'
newline|'\n'
name|'return'
op|'['
name|'body'
op|']'
newline|'\n'
dedent|''
name|'elif'
name|'calls'
op|'['
number|'0'
op|']'
op|'=='
number|'2'
op|':'
newline|'\n'
indent|'                '
name|'body'
op|'='
name|'json'
op|'.'
name|'dumps'
op|'('
op|'['
op|'{'
string|"'name'"
op|':'
string|"'three'"
op|'}'
op|','
op|'{'
string|"'name'"
op|':'
string|"'four'"
op|'}'
op|']'
op|')'
newline|'\n'
name|'start_response'
op|'('
string|"'200 Ok'"
op|','
op|'['
op|'('
string|"'Content-Length'"
op|','
name|'str'
op|'('
name|'len'
op|'('
name|'body'
op|')'
op|')'
op|')'
op|']'
op|')'
newline|'\n'
name|'return'
op|'['
name|'body'
op|']'
newline|'\n'
dedent|''
name|'elif'
name|'calls'
op|'['
number|'0'
op|']'
op|'=='
number|'3'
op|':'
newline|'\n'
indent|'                '
name|'start_response'
op|'('
string|"'204 Ok'"
op|','
op|'['
op|'('
string|"'Content-Length'"
op|','
string|"'0'"
op|')'
op|']'
op|')'
newline|'\n'
name|'return'
op|'['
op|']'
newline|'\n'
dedent|''
name|'raise'
name|'Exception'
op|'('
string|"'Should not get here'"
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'x'
op|'='
name|'expirer'
op|'.'
name|'ObjectExpirer'
op|'('
op|'{'
op|'}'
op|')'
newline|'\n'
name|'x'
op|'.'
name|'app'
op|'='
name|'fake_app'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'list'
op|'('
name|'x'
op|'.'
name|'iter_objects'
op|'('
string|"'container'"
op|')'
op|')'
op|','
nl|'\n'
op|'['
string|"'one'"
op|','
string|"'two'"
op|','
string|"'three'"
op|','
string|"'four'"
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_iter_objects_handles_404
dedent|''
name|'def'
name|'test_iter_objects_handles_404'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|function|fake_app
indent|'        '
name|'def'
name|'fake_app'
op|'('
name|'env'
op|','
name|'start_response'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'start_response'
op|'('
string|"'404 Not Found'"
op|','
op|'['
op|'('
string|"'Content-Length'"
op|','
string|"'0'"
op|')'
op|']'
op|')'
newline|'\n'
name|'return'
op|'['
op|']'
newline|'\n'
nl|'\n'
dedent|''
name|'x'
op|'='
name|'expirer'
op|'.'
name|'ObjectExpirer'
op|'('
op|'{'
op|'}'
op|')'
newline|'\n'
name|'x'
op|'.'
name|'app'
op|'='
name|'fake_app'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'list'
op|'('
name|'x'
op|'.'
name|'iter_objects'
op|'('
string|"'container'"
op|')'
op|')'
op|','
op|'['
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_delete_actual_object
dedent|''
name|'def'
name|'test_delete_actual_object'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'got_env'
op|'='
op|'['
name|'None'
op|']'
newline|'\n'
nl|'\n'
DECL|function|fake_app
name|'def'
name|'fake_app'
op|'('
name|'env'
op|','
name|'start_response'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'got_env'
op|'['
number|'0'
op|']'
op|'='
name|'env'
newline|'\n'
name|'start_response'
op|'('
string|"'204 No Content'"
op|','
op|'['
op|'('
string|"'Content-Length'"
op|','
string|"'0'"
op|')'
op|']'
op|')'
newline|'\n'
name|'return'
op|'['
op|']'
newline|'\n'
nl|'\n'
dedent|''
name|'x'
op|'='
name|'expirer'
op|'.'
name|'ObjectExpirer'
op|'('
op|'{'
op|'}'
op|')'
newline|'\n'
name|'x'
op|'.'
name|'app'
op|'='
name|'fake_app'
newline|'\n'
name|'ts'
op|'='
string|"'1234'"
newline|'\n'
name|'x'
op|'.'
name|'delete_actual_object'
op|'('
string|"'/path/to/object'"
op|','
name|'ts'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'got_env'
op|'['
number|'0'
op|']'
op|'['
string|"'HTTP_X_IF_DELETE_AT'"
op|']'
op|','
name|'ts'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_delete_actual_object_handles_404
dedent|''
name|'def'
name|'test_delete_actual_object_handles_404'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|function|fake_app
indent|'        '
name|'def'
name|'fake_app'
op|'('
name|'env'
op|','
name|'start_response'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'start_response'
op|'('
string|"'404 Not Found'"
op|','
op|'['
op|'('
string|"'Content-Length'"
op|','
string|"'0'"
op|')'
op|']'
op|')'
newline|'\n'
name|'return'
op|'['
op|']'
newline|'\n'
nl|'\n'
dedent|''
name|'x'
op|'='
name|'expirer'
op|'.'
name|'ObjectExpirer'
op|'('
op|'{'
op|'}'
op|')'
newline|'\n'
name|'x'
op|'.'
name|'app'
op|'='
name|'fake_app'
newline|'\n'
name|'x'
op|'.'
name|'delete_actual_object'
op|'('
string|"'/path/to/object'"
op|','
string|"'1234'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_delete_actual_object_handles_412
dedent|''
name|'def'
name|'test_delete_actual_object_handles_412'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|function|fake_app
indent|'        '
name|'def'
name|'fake_app'
op|'('
name|'env'
op|','
name|'start_response'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'start_response'
op|'('
string|"'412 Precondition Failed'"
op|','
nl|'\n'
op|'['
op|'('
string|"'Content-Length'"
op|','
string|"'0'"
op|')'
op|']'
op|')'
newline|'\n'
name|'return'
op|'['
op|']'
newline|'\n'
nl|'\n'
dedent|''
name|'x'
op|'='
name|'expirer'
op|'.'
name|'ObjectExpirer'
op|'('
op|'{'
op|'}'
op|')'
newline|'\n'
name|'x'
op|'.'
name|'app'
op|'='
name|'fake_app'
newline|'\n'
name|'x'
op|'.'
name|'delete_actual_object'
op|'('
string|"'/path/to/object'"
op|','
string|"'1234'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_delete_actual_object_does_not_handle_odd_stuff
dedent|''
name|'def'
name|'test_delete_actual_object_does_not_handle_odd_stuff'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|function|fake_app
indent|'        '
name|'def'
name|'fake_app'
op|'('
name|'env'
op|','
name|'start_response'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'start_response'
op|'('
string|"'503 Internal Server Error'"
op|','
nl|'\n'
op|'['
op|'('
string|"'Content-Length'"
op|','
string|"'0'"
op|')'
op|']'
op|')'
newline|'\n'
name|'return'
op|'['
op|']'
newline|'\n'
nl|'\n'
dedent|''
name|'x'
op|'='
name|'expirer'
op|'.'
name|'ObjectExpirer'
op|'('
op|'{'
op|'}'
op|')'
newline|'\n'
name|'x'
op|'.'
name|'app'
op|'='
name|'fake_app'
newline|'\n'
name|'orig_sleep'
op|'='
name|'expirer'
op|'.'
name|'sleep'
newline|'\n'
name|'exc'
op|'='
name|'None'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'expirer'
op|'.'
name|'sleep'
op|'='
name|'not_sleep'
newline|'\n'
name|'x'
op|'.'
name|'delete_actual_object'
op|'('
string|"'/path/to/object'"
op|','
string|"'1234'"
op|')'
newline|'\n'
dedent|''
name|'except'
name|'Exception'
op|','
name|'err'
op|':'
newline|'\n'
indent|'            '
name|'exc'
op|'='
name|'err'
newline|'\n'
dedent|''
name|'finally'
op|':'
newline|'\n'
indent|'            '
name|'expirer'
op|'.'
name|'sleep'
op|'='
name|'orig_sleep'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'str'
op|'('
name|'err'
op|')'
op|','
nl|'\n'
string|"'Unexpected response 503 Internal Server Error'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_delete_object
dedent|''
name|'def'
name|'test_delete_object'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'got_env'
op|'='
op|'['
name|'None'
op|']'
newline|'\n'
nl|'\n'
DECL|function|fake_app
name|'def'
name|'fake_app'
op|'('
name|'env'
op|','
name|'start_response'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'got_env'
op|'['
number|'0'
op|']'
op|'='
name|'env'
newline|'\n'
name|'start_response'
op|'('
string|"'204 No Content'"
op|','
op|'['
op|'('
string|"'Content-Length'"
op|','
string|"'0'"
op|')'
op|']'
op|')'
newline|'\n'
name|'return'
op|'['
op|']'
newline|'\n'
nl|'\n'
dedent|''
name|'x'
op|'='
name|'expirer'
op|'.'
name|'ObjectExpirer'
op|'('
op|'{'
op|'}'
op|')'
newline|'\n'
name|'x'
op|'.'
name|'app'
op|'='
name|'fake_app'
newline|'\n'
name|'x'
op|'.'
name|'delete_object'
op|'('
string|"'container'"
op|','
string|"'object'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_delete_object_handles_404
dedent|''
name|'def'
name|'test_delete_object_handles_404'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|function|fake_app
indent|'        '
name|'def'
name|'fake_app'
op|'('
name|'env'
op|','
name|'start_response'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'start_response'
op|'('
string|"'404 Not Found'"
op|','
op|'['
op|'('
string|"'Content-Length'"
op|','
string|"'0'"
op|')'
op|']'
op|')'
newline|'\n'
name|'return'
op|'['
op|']'
newline|'\n'
nl|'\n'
dedent|''
name|'x'
op|'='
name|'expirer'
op|'.'
name|'ObjectExpirer'
op|'('
op|'{'
op|'}'
op|')'
newline|'\n'
name|'x'
op|'.'
name|'app'
op|'='
name|'fake_app'
newline|'\n'
name|'x'
op|'.'
name|'delete_object'
op|'('
string|"'container'"
op|','
string|"'object'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_delete_object_does_not_handle_odd_stuff
dedent|''
name|'def'
name|'test_delete_object_does_not_handle_odd_stuff'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|function|fake_app
indent|'        '
name|'def'
name|'fake_app'
op|'('
name|'env'
op|','
name|'start_response'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'start_response'
op|'('
string|"'503 Internal Server Error'"
op|','
nl|'\n'
op|'['
op|'('
string|"'Content-Length'"
op|','
string|"'0'"
op|')'
op|']'
op|')'
newline|'\n'
name|'return'
op|'['
op|']'
newline|'\n'
nl|'\n'
dedent|''
name|'x'
op|'='
name|'expirer'
op|'.'
name|'ObjectExpirer'
op|'('
op|'{'
op|'}'
op|')'
newline|'\n'
name|'x'
op|'.'
name|'app'
op|'='
name|'fake_app'
newline|'\n'
name|'orig_sleep'
op|'='
name|'expirer'
op|'.'
name|'sleep'
newline|'\n'
name|'exc'
op|'='
name|'None'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'expirer'
op|'.'
name|'sleep'
op|'='
name|'not_sleep'
newline|'\n'
name|'x'
op|'.'
name|'delete_object'
op|'('
string|"'container'"
op|','
string|"'object'"
op|')'
newline|'\n'
dedent|''
name|'except'
name|'Exception'
op|','
name|'err'
op|':'
newline|'\n'
indent|'            '
name|'exc'
op|'='
name|'err'
newline|'\n'
dedent|''
name|'finally'
op|':'
newline|'\n'
indent|'            '
name|'expirer'
op|'.'
name|'sleep'
op|'='
name|'orig_sleep'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'str'
op|'('
name|'err'
op|')'
op|','
nl|'\n'
string|"'Unexpected response 503 Internal Server Error'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_delete_container
dedent|''
name|'def'
name|'test_delete_container'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'got_env'
op|'='
op|'['
name|'None'
op|']'
newline|'\n'
nl|'\n'
DECL|function|fake_app
name|'def'
name|'fake_app'
op|'('
name|'env'
op|','
name|'start_response'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'got_env'
op|'['
number|'0'
op|']'
op|'='
name|'env'
newline|'\n'
name|'start_response'
op|'('
string|"'204 No Content'"
op|','
op|'['
op|'('
string|"'Content-Length'"
op|','
string|"'0'"
op|')'
op|']'
op|')'
newline|'\n'
name|'return'
op|'['
op|']'
newline|'\n'
nl|'\n'
dedent|''
name|'x'
op|'='
name|'expirer'
op|'.'
name|'ObjectExpirer'
op|'('
op|'{'
op|'}'
op|')'
newline|'\n'
name|'x'
op|'.'
name|'app'
op|'='
name|'fake_app'
newline|'\n'
name|'x'
op|'.'
name|'delete_container'
op|'('
string|"'container'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_delete_container_handles_404
dedent|''
name|'def'
name|'test_delete_container_handles_404'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|function|fake_app
indent|'        '
name|'def'
name|'fake_app'
op|'('
name|'env'
op|','
name|'start_response'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'start_response'
op|'('
string|"'404 Not Found'"
op|','
op|'['
op|'('
string|"'Content-Length'"
op|','
string|"'0'"
op|')'
op|']'
op|')'
newline|'\n'
name|'return'
op|'['
op|']'
newline|'\n'
nl|'\n'
dedent|''
name|'x'
op|'='
name|'expirer'
op|'.'
name|'ObjectExpirer'
op|'('
op|'{'
op|'}'
op|')'
newline|'\n'
name|'x'
op|'.'
name|'app'
op|'='
name|'fake_app'
newline|'\n'
name|'x'
op|'.'
name|'delete_container'
op|'('
string|"'container'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_delete_container_handles_409
dedent|''
name|'def'
name|'test_delete_container_handles_409'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|function|fake_app
indent|'        '
name|'def'
name|'fake_app'
op|'('
name|'env'
op|','
name|'start_response'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'start_response'
op|'('
string|"'409 Conflict'"
op|','
op|'['
op|'('
string|"'Content-Length'"
op|','
string|"'0'"
op|')'
op|']'
op|')'
newline|'\n'
name|'return'
op|'['
op|']'
newline|'\n'
nl|'\n'
dedent|''
name|'x'
op|'='
name|'expirer'
op|'.'
name|'ObjectExpirer'
op|'('
op|'{'
op|'}'
op|')'
newline|'\n'
name|'x'
op|'.'
name|'app'
op|'='
name|'fake_app'
newline|'\n'
name|'x'
op|'.'
name|'delete_container'
op|'('
string|"'container'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_delete_container_does_not_handle_odd_stuff
dedent|''
name|'def'
name|'test_delete_container_does_not_handle_odd_stuff'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|function|fake_app
indent|'        '
name|'def'
name|'fake_app'
op|'('
name|'env'
op|','
name|'start_response'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'start_response'
op|'('
string|"'503 Internal Server Error'"
op|','
nl|'\n'
op|'['
op|'('
string|"'Content-Length'"
op|','
string|"'0'"
op|')'
op|']'
op|')'
newline|'\n'
name|'return'
op|'['
op|']'
newline|'\n'
nl|'\n'
dedent|''
name|'x'
op|'='
name|'expirer'
op|'.'
name|'ObjectExpirer'
op|'('
op|'{'
op|'}'
op|')'
newline|'\n'
name|'x'
op|'.'
name|'app'
op|'='
name|'fake_app'
newline|'\n'
name|'orig_sleep'
op|'='
name|'expirer'
op|'.'
name|'sleep'
newline|'\n'
name|'exc'
op|'='
name|'None'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'expirer'
op|'.'
name|'sleep'
op|'='
name|'not_sleep'
newline|'\n'
name|'x'
op|'.'
name|'delete_container'
op|'('
string|"'container'"
op|')'
newline|'\n'
dedent|''
name|'except'
name|'Exception'
op|','
name|'err'
op|':'
newline|'\n'
indent|'            '
name|'exc'
op|'='
name|'err'
newline|'\n'
dedent|''
name|'finally'
op|':'
newline|'\n'
indent|'            '
name|'expirer'
op|'.'
name|'sleep'
op|'='
name|'orig_sleep'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'str'
op|'('
name|'err'
op|')'
op|','
nl|'\n'
string|"'Unexpected response 503 Internal Server Error'"
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
dedent|''
dedent|''
name|'if'
name|'__name__'
op|'=='
string|"'__main__'"
op|':'
newline|'\n'
indent|'    '
name|'main'
op|'('
op|')'
newline|'\n'
dedent|''
endmarker|''
end_unit
