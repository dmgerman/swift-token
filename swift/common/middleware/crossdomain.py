begin_unit
comment|'# Copyright (c) 2013 OpenStack Foundation.'
nl|'\n'
comment|'#'
nl|'\n'
comment|'# Licensed under the Apache License, Version 2.0 (the "License");'
nl|'\n'
comment|'# you may not use this file except in compliance with the License.'
nl|'\n'
comment|'# You may obtain a copy of the License at'
nl|'\n'
comment|'#'
nl|'\n'
comment|'#    http://www.apache.org/licenses/LICENSE-2.0'
nl|'\n'
comment|'#'
nl|'\n'
comment|'# Unless required by applicable law or agreed to in writing, software'
nl|'\n'
comment|'# distributed under the License is distributed on an "AS IS" BASIS,'
nl|'\n'
comment|'# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or'
nl|'\n'
comment|'# implied.'
nl|'\n'
comment|'# See the License for the specific language governing permissions and'
nl|'\n'
comment|'# limitations under the License.'
nl|'\n'
nl|'\n'
name|'from'
name|'swift'
op|'.'
name|'common'
op|'.'
name|'swob'
name|'import'
name|'Request'
op|','
name|'Response'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|CrossDomainMiddleware
name|'class'
name|'CrossDomainMiddleware'
op|'('
name|'object'
op|')'
op|':'
newline|'\n'
nl|'\n'
indent|'    '
string|'"""\n    Cross domain middleware used to respond to requests for cross domain\n    policy information.\n\n    If the path is /crossdomain.xml it will respond with an xml cross domain\n    policy document. This allows web pages hosted elsewhere to use client\n    side technologies such as Flash, Java and Silverlight to interact\n    with the Swift API.\n\n    To enable this middleware, add it to the pipeline in your proxy-server.conf\n    file. It should be added before any authentication (e.g., tempauth or\n    keystone) middleware. In this example ellipsis (...) indicate other\n    middleware you may have chosen to use::\n\n        [pipeline:main]\n        pipeline =  ... crossdomain ... authtoken ... proxy-server\n\n    And add a filter section, such as::\n\n        [filter:crossdomain]\n        use = egg:swift#crossdomain\n        cross_domain_policy = <allow-access-from domain="*.example.com" />\n            <allow-access-from domain="www.example.com" secure="false" />\n\n    For continuation lines, put some whitespace before the continuation\n    text. Ensure you put a completely blank line to terminate the\n    cross_domain_policy value.\n\n    The cross_domain_policy name/value is optional. If omited, the policy\n    defaults as if you had specified::\n\n        cross_domain_policy = <allow-access-from domain="*" secure="false" />\n\n\n    """'
newline|'\n'
nl|'\n'
DECL|member|__init__
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'app'
op|','
name|'conf'
op|','
op|'*'
name|'args'
op|','
op|'**'
name|'kwargs'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'app'
op|'='
name|'app'
newline|'\n'
name|'self'
op|'.'
name|'conf'
op|'='
name|'conf'
newline|'\n'
name|'default_domain_policy'
op|'='
string|'\'<allow-access-from domain="*"\''
string|'\' secure="false" />\''
newline|'\n'
name|'self'
op|'.'
name|'cross_domain_policy'
op|'='
name|'self'
op|'.'
name|'conf'
op|'.'
name|'get'
op|'('
string|"'cross_domain_policy'"
op|','
nl|'\n'
name|'default_domain_policy'
op|')'
newline|'\n'
nl|'\n'
DECL|member|GET
dedent|''
name|'def'
name|'GET'
op|'('
name|'self'
op|','
name|'req'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Returns a 200 response with cross domain policy information """'
newline|'\n'
name|'body'
op|'='
string|'\'<?xml version="1.0"?>\\n\''
string|"'<!DOCTYPE cross-domain-policy SYSTEM '"
string|'\'"http://www.adobe.com/xml/dtds/cross-domain-policy.dtd" >\\n\''
string|"'<cross-domain-policy>\\n'"
string|"'%s\\n'"
string|"'</cross-domain-policy>'"
op|'%'
name|'self'
op|'.'
name|'cross_domain_policy'
newline|'\n'
name|'return'
name|'Response'
op|'('
name|'request'
op|'='
name|'req'
op|','
name|'body'
op|'='
name|'body'
op|','
nl|'\n'
name|'content_type'
op|'='
string|'"application/xml"'
op|')'
newline|'\n'
nl|'\n'
DECL|member|__call__
dedent|''
name|'def'
name|'__call__'
op|'('
name|'self'
op|','
name|'env'
op|','
name|'start_response'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'req'
op|'='
name|'Request'
op|'('
name|'env'
op|')'
newline|'\n'
name|'if'
name|'req'
op|'.'
name|'path'
op|'=='
string|"'/crossdomain.xml'"
name|'and'
name|'req'
op|'.'
name|'method'
op|'=='
string|"'GET'"
op|':'
newline|'\n'
indent|'            '
name|'return'
name|'self'
op|'.'
name|'GET'
op|'('
name|'req'
op|')'
op|'('
name|'env'
op|','
name|'start_response'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'return'
name|'self'
op|'.'
name|'app'
op|'('
name|'env'
op|','
name|'start_response'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|function|filter_factory
dedent|''
dedent|''
dedent|''
name|'def'
name|'filter_factory'
op|'('
name|'global_conf'
op|','
op|'**'
name|'local_conf'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'conf'
op|'='
name|'global_conf'
op|'.'
name|'copy'
op|'('
op|')'
newline|'\n'
name|'conf'
op|'.'
name|'update'
op|'('
name|'local_conf'
op|')'
newline|'\n'
nl|'\n'
DECL|function|crossdomain_filter
name|'def'
name|'crossdomain_filter'
op|'('
name|'app'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'CrossDomainMiddleware'
op|'('
name|'app'
op|','
name|'conf'
op|')'
newline|'\n'
dedent|''
name|'return'
name|'crossdomain_filter'
newline|'\n'
dedent|''
endmarker|''
end_unit
