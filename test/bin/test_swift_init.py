begin_unit
comment|'# Copyright (c) 2010 OpenStack, LLC.'
nl|'\n'
comment|'#'
nl|'\n'
comment|'# Licensed under the Apache License, Version 2.0 (the "License");'
nl|'\n'
comment|'# you may not use this file except in compliance with the License.'
nl|'\n'
comment|'# You may obtain a copy of the License at'
nl|'\n'
comment|'#'
nl|'\n'
comment|'#    http://www.apache.org/licenses/LICENSE-2.0'
nl|'\n'
comment|'#'
nl|'\n'
comment|'# Unless required by applicable law or agreed to in writing, software'
nl|'\n'
comment|'# distributed under the License is distributed on an "AS IS" BASIS,'
nl|'\n'
comment|'# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or'
nl|'\n'
comment|'# implied.'
nl|'\n'
comment|'# See the License for the specific language governing permissions and'
nl|'\n'
comment|'# limitations under the License.'
nl|'\n'
nl|'\n'
name|'import'
name|'unittest'
newline|'\n'
nl|'\n'
name|'import'
name|'os'
newline|'\n'
name|'import'
name|'sys'
newline|'\n'
name|'import'
name|'signal'
newline|'\n'
name|'from'
name|'shutil'
name|'import'
name|'rmtree'
newline|'\n'
name|'from'
name|'contextlib'
name|'import'
name|'contextmanager'
newline|'\n'
name|'from'
name|'tempfile'
name|'import'
name|'mkdtemp'
newline|'\n'
name|'from'
name|'collections'
name|'import'
name|'defaultdict'
newline|'\n'
nl|'\n'
name|'from'
name|'test'
name|'import'
name|'bin'
comment|'# for reloading...'
newline|'\n'
name|'from'
name|'test'
op|'.'
name|'bin'
name|'import'
name|'swift_init'
comment|'# for testing...'
newline|'\n'
nl|'\n'
DECL|variable|DUMMY_SIG
name|'DUMMY_SIG'
op|'='
number|'1'
newline|'\n'
nl|'\n'
nl|'\n'
op|'@'
name|'contextmanager'
newline|'\n'
DECL|function|temptree
name|'def'
name|'temptree'
op|'('
name|'files'
op|','
name|'contents'
op|'='
string|"''"
op|')'
op|':'
newline|'\n'
comment|'# generate enough contents to fill the files'
nl|'\n'
indent|'    '
name|'c'
op|'='
name|'len'
op|'('
name|'files'
op|')'
newline|'\n'
name|'contents'
op|'='
op|'('
name|'list'
op|'('
name|'contents'
op|')'
op|'+'
op|'['
string|"''"
op|']'
op|'*'
name|'c'
op|')'
op|'['
op|':'
name|'c'
op|']'
newline|'\n'
name|'tempdir'
op|'='
name|'mkdtemp'
op|'('
op|')'
newline|'\n'
name|'for'
name|'path'
op|','
name|'content'
name|'in'
name|'zip'
op|'('
name|'files'
op|','
name|'contents'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'os'
op|'.'
name|'path'
op|'.'
name|'isabs'
op|'('
name|'path'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'path'
op|'='
string|"'.'"
op|'+'
name|'path'
newline|'\n'
dedent|''
name|'new_path'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'tempdir'
op|','
name|'path'
op|')'
newline|'\n'
name|'subdir'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'dirname'
op|'('
name|'new_path'
op|')'
newline|'\n'
name|'if'
name|'not'
name|'os'
op|'.'
name|'path'
op|'.'
name|'exists'
op|'('
name|'subdir'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'os'
op|'.'
name|'makedirs'
op|'('
name|'subdir'
op|')'
newline|'\n'
dedent|''
name|'with'
name|'open'
op|'('
name|'new_path'
op|','
string|"'w'"
op|')'
name|'as'
name|'f'
op|':'
newline|'\n'
indent|'            '
name|'f'
op|'.'
name|'write'
op|'('
name|'str'
op|'('
name|'content'
op|')'
op|')'
newline|'\n'
dedent|''
dedent|''
name|'try'
op|':'
newline|'\n'
indent|'        '
name|'yield'
name|'tempdir'
newline|'\n'
dedent|''
name|'finally'
op|':'
newline|'\n'
indent|'        '
name|'rmtree'
op|'('
name|'tempdir'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|MockOs
dedent|''
dedent|''
name|'class'
name|'MockOs'
op|'('
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|member|__init__
indent|'    '
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'pids'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'running_pids'
op|'='
name|'pids'
newline|'\n'
name|'self'
op|'.'
name|'pid_sigs'
op|'='
name|'defaultdict'
op|'('
name|'list'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'closed_fds'
op|'='
op|'['
op|']'
newline|'\n'
name|'self'
op|'.'
name|'child_pid'
op|'='
number|'9999'
comment|'# fork defaults to test parent process path'
newline|'\n'
name|'self'
op|'.'
name|'execlp_called'
op|'='
name|'False'
newline|'\n'
nl|'\n'
DECL|member|kill
dedent|''
name|'def'
name|'kill'
op|'('
name|'self'
op|','
name|'pid'
op|','
name|'sig'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'pid'
name|'not'
name|'in'
name|'self'
op|'.'
name|'running_pids'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'OSError'
op|'('
number|'3'
op|','
string|"'No such process'"
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'pid_sigs'
op|'['
name|'pid'
op|']'
op|'.'
name|'append'
op|'('
name|'sig'
op|')'
newline|'\n'
nl|'\n'
DECL|member|__getattr__
dedent|''
name|'def'
name|'__getattr__'
op|'('
name|'self'
op|','
name|'name'
op|')'
op|':'
newline|'\n'
comment|'# I only over-ride portions of the os module'
nl|'\n'
indent|'        '
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'return'
name|'object'
op|'.'
name|'__getattr__'
op|'('
name|'self'
op|','
name|'name'
op|')'
newline|'\n'
dedent|''
name|'except'
name|'AttributeError'
op|':'
newline|'\n'
indent|'            '
name|'return'
name|'getattr'
op|'('
name|'os'
op|','
name|'name'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|function|pop_stream
dedent|''
dedent|''
dedent|''
name|'def'
name|'pop_stream'
op|'('
name|'f'
op|')'
op|':'
newline|'\n'
indent|'    '
string|'"""read everything out of file from the top and clear it out\n    """'
newline|'\n'
name|'f'
op|'.'
name|'flush'
op|'('
op|')'
newline|'\n'
name|'f'
op|'.'
name|'seek'
op|'('
number|'0'
op|')'
newline|'\n'
name|'output'
op|'='
name|'f'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'f'
op|'.'
name|'seek'
op|'('
number|'0'
op|')'
newline|'\n'
name|'f'
op|'.'
name|'truncate'
op|'('
op|')'
newline|'\n'
comment|'#print >> sys.stderr, output'
nl|'\n'
name|'return'
name|'output'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|TestSwiftInitModule
dedent|''
name|'class'
name|'TestSwiftInitModule'
op|'('
name|'unittest'
op|'.'
name|'TestCase'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|member|test_servers
indent|'    '
name|'def'
name|'test_servers'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'main_plus_rest'
op|'='
name|'set'
op|'('
name|'swift_init'
op|'.'
name|'MAIN_SERVERS'
op|'+'
name|'swift_init'
op|'.'
name|'REST_SERVERS'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'set'
op|'('
name|'swift_init'
op|'.'
name|'ALL_SERVERS'
op|')'
op|','
name|'main_plus_rest'
op|')'
newline|'\n'
comment|"# make sure there's no server listed in both"
nl|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'len'
op|'('
name|'main_plus_rest'
op|')'
op|','
name|'len'
op|'('
name|'swift_init'
op|'.'
name|'MAIN_SERVERS'
op|')'
op|'+'
nl|'\n'
name|'len'
op|'('
name|'swift_init'
op|'.'
name|'REST_SERVERS'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_search_tree
dedent|''
name|'def'
name|'test_search_tree'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# file match & ext miss'
nl|'\n'
indent|'        '
name|'with'
name|'temptree'
op|'('
op|'['
string|"'asdf.conf'"
op|','
string|"'blarg.conf'"
op|','
string|"'asdf.cfg'"
op|']'
op|')'
name|'as'
name|'t'
op|':'
newline|'\n'
indent|'            '
name|'asdf'
op|'='
name|'swift_init'
op|'.'
name|'search_tree'
op|'('
name|'t'
op|','
string|"'a*'"
op|','
string|"'.conf'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'len'
op|'('
name|'asdf'
op|')'
op|','
number|'1'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'asdf'
op|'['
number|'0'
op|']'
op|','
nl|'\n'
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'t'
op|','
string|"'asdf.conf'"
op|')'
op|')'
newline|'\n'
nl|'\n'
comment|'# multi-file match & glob miss & sort'
nl|'\n'
dedent|''
name|'with'
name|'temptree'
op|'('
op|'['
string|"'application.bin'"
op|','
string|"'apple.bin'"
op|','
string|"'apropos.bin'"
op|']'
op|')'
name|'as'
name|'t'
op|':'
newline|'\n'
indent|'            '
name|'app_bins'
op|'='
name|'swift_init'
op|'.'
name|'search_tree'
op|'('
name|'t'
op|','
string|"'app*'"
op|','
string|"'bin'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'len'
op|'('
name|'app_bins'
op|')'
op|','
number|'2'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'app_bins'
op|'['
number|'0'
op|']'
op|','
nl|'\n'
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'t'
op|','
string|"'apple.bin'"
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'app_bins'
op|'['
number|'1'
op|']'
op|','
nl|'\n'
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'t'
op|','
string|"'application.bin'"
op|')'
op|')'
newline|'\n'
nl|'\n'
comment|'# test file in folder & ext miss & glob miss'
nl|'\n'
dedent|''
name|'files'
op|'='
op|'('
nl|'\n'
string|"'sub/file1.ini'"
op|','
nl|'\n'
string|"'sub/file2.conf'"
op|','
nl|'\n'
string|"'sub.bin'"
op|','
nl|'\n'
string|"'bus.ini'"
op|','
nl|'\n'
string|"'bus/file3.ini'"
op|','
nl|'\n'
op|')'
newline|'\n'
name|'with'
name|'temptree'
op|'('
name|'files'
op|')'
name|'as'
name|'t'
op|':'
newline|'\n'
indent|'            '
name|'sub_ini'
op|'='
name|'swift_init'
op|'.'
name|'search_tree'
op|'('
name|'t'
op|','
string|"'sub*'"
op|','
string|"'.ini'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'len'
op|'('
name|'sub_ini'
op|')'
op|','
number|'1'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'sub_ini'
op|'['
number|'0'
op|']'
op|','
nl|'\n'
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'t'
op|','
string|"'sub/file1.ini'"
op|')'
op|')'
newline|'\n'
nl|'\n'
comment|'# test multi-file in folder & sub-folder & ext miss & glob miss'
nl|'\n'
dedent|''
name|'files'
op|'='
op|'('
nl|'\n'
string|"'folder_file.txt'"
op|','
nl|'\n'
string|"'folder/1.txt'"
op|','
nl|'\n'
string|"'folder/sub/2.txt'"
op|','
nl|'\n'
string|"'folder2/3.txt'"
op|','
nl|'\n'
string|"'Folder3/4.txt'"
nl|'\n'
string|"'folder.rc'"
op|','
nl|'\n'
op|')'
newline|'\n'
name|'with'
name|'temptree'
op|'('
name|'files'
op|')'
name|'as'
name|'t'
op|':'
newline|'\n'
indent|'            '
name|'folder_texts'
op|'='
name|'swift_init'
op|'.'
name|'search_tree'
op|'('
name|'t'
op|','
string|"'folder*'"
op|','
string|"'.txt'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'len'
op|'('
name|'folder_texts'
op|')'
op|','
number|'4'
op|')'
newline|'\n'
name|'f1'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'t'
op|','
string|"'folder_file.txt'"
op|')'
newline|'\n'
name|'f2'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'t'
op|','
string|"'folder/1.txt'"
op|')'
newline|'\n'
name|'f3'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'t'
op|','
string|"'folder/sub/2.txt'"
op|')'
newline|'\n'
name|'f4'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'t'
op|','
string|"'folder2/3.txt'"
op|')'
newline|'\n'
name|'for'
name|'f'
name|'in'
op|'['
name|'f1'
op|','
name|'f2'
op|','
name|'f3'
op|','
name|'f4'
op|']'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'assert_'
op|'('
name|'f'
name|'in'
name|'folder_texts'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_write_file
dedent|''
dedent|''
dedent|''
name|'def'
name|'test_write_file'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'with'
name|'temptree'
op|'('
op|'['
op|']'
op|')'
name|'as'
name|'t'
op|':'
newline|'\n'
indent|'            '
name|'file_name'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'t'
op|','
string|"'test'"
op|')'
newline|'\n'
name|'swift_init'
op|'.'
name|'write_file'
op|'('
name|'file_name'
op|','
string|"'test'"
op|')'
newline|'\n'
name|'with'
name|'open'
op|'('
name|'file_name'
op|','
string|"'r'"
op|')'
name|'as'
name|'f'
op|':'
newline|'\n'
indent|'                '
name|'contents'
op|'='
name|'f'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'contents'
op|','
string|"'test'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_remove_file
dedent|''
dedent|''
name|'def'
name|'test_remove_file'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'with'
name|'temptree'
op|'('
op|'['
op|']'
op|')'
name|'as'
name|'t'
op|':'
newline|'\n'
indent|'            '
name|'file_name'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'t'
op|','
string|"'blah.pid'"
op|')'
newline|'\n'
comment|'# assert no raise'
nl|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'exists'
op|'('
name|'file_name'
op|')'
op|','
name|'False'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'swift_init'
op|'.'
name|'remove_file'
op|'('
name|'file_name'
op|')'
op|','
name|'None'
op|')'
newline|'\n'
name|'with'
name|'open'
op|'('
name|'file_name'
op|','
string|"'w'"
op|')'
name|'as'
name|'f'
op|':'
newline|'\n'
indent|'                '
name|'f'
op|'.'
name|'write'
op|'('
string|"'1'"
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assert_'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'exists'
op|'('
name|'file_name'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'swift_init'
op|'.'
name|'remove_file'
op|'('
name|'file_name'
op|')'
op|','
name|'None'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'exists'
op|'('
name|'file_name'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_command_wrapper
dedent|''
dedent|''
name|'def'
name|'test_command_wrapper'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
op|'@'
name|'swift_init'
op|'.'
name|'command'
newline|'\n'
DECL|function|myfunc
name|'def'
name|'myfunc'
op|'('
name|'arg1'
op|')'
op|':'
newline|'\n'
indent|'            '
string|'"""test doc\n            """'
newline|'\n'
name|'return'
name|'arg1'
newline|'\n'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'myfunc'
op|'.'
name|'__doc__'
op|'.'
name|'strip'
op|'('
op|')'
op|','
string|"'test doc'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'myfunc'
op|'('
number|'1'
op|')'
op|','
number|'1'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'myfunc'
op|'('
number|'0'
op|')'
op|','
number|'0'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'myfunc'
op|'('
name|'True'
op|')'
op|','
number|'1'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'myfunc'
op|'('
name|'False'
op|')'
op|','
number|'0'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_'
op|'('
name|'hasattr'
op|'('
name|'myfunc'
op|','
string|"'publicly_accessible'"
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_'
op|'('
name|'myfunc'
op|'.'
name|'publicly_accessible'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_exc
dedent|''
name|'def'
name|'test_exc'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'assert_'
op|'('
name|'issubclass'
op|'('
name|'swift_init'
op|'.'
name|'UnknownCommand'
op|','
name|'Exception'
op|')'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|TestSwiftServerClass
dedent|''
dedent|''
name|'class'
name|'TestSwiftServerClass'
op|'('
name|'unittest'
op|'.'
name|'TestCase'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|member|tearDown
indent|'    '
name|'def'
name|'tearDown'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'reload'
op|'('
name|'bin'
op|')'
newline|'\n'
nl|'\n'
DECL|member|join_swift_dir
dedent|''
name|'def'
name|'join_swift_dir'
op|'('
name|'self'
op|','
name|'path'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'swift_init'
op|'.'
name|'SWIFT_DIR'
op|','
name|'path'
op|')'
newline|'\n'
nl|'\n'
DECL|member|join_run_dir
dedent|''
name|'def'
name|'join_run_dir'
op|'('
name|'self'
op|','
name|'path'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'swift_init'
op|'.'
name|'RUN_DIR'
op|','
name|'path'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_server_init
dedent|''
name|'def'
name|'test_server_init'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'server'
op|'='
name|'swift_init'
op|'.'
name|'SwiftServer'
op|'('
string|"'proxy'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'server'
op|'.'
name|'server'
op|','
string|"'proxy-server'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'server'
op|'.'
name|'type'
op|','
string|"'proxy'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'server'
op|'.'
name|'cmd'
op|','
string|"'swift-proxy-server'"
op|')'
newline|'\n'
name|'server'
op|'='
name|'swift_init'
op|'.'
name|'SwiftServer'
op|'('
string|"'object-replicator'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'server'
op|'.'
name|'server'
op|','
string|"'object-replicator'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'server'
op|'.'
name|'type'
op|','
string|"'object'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'server'
op|'.'
name|'cmd'
op|','
string|"'swift-object-replicator'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_pid_file_name
dedent|''
name|'def'
name|'test_get_pid_file_name'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'server'
op|'='
name|'swift_init'
op|'.'
name|'SwiftServer'
op|'('
string|"'proxy'"
op|')'
newline|'\n'
name|'ini_file'
op|'='
name|'self'
op|'.'
name|'join_swift_dir'
op|'('
string|"'proxy-server.conf'"
op|')'
newline|'\n'
name|'pid_file'
op|'='
name|'self'
op|'.'
name|'join_run_dir'
op|'('
string|"'proxy-server.pid'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'pid_file'
op|','
name|'server'
op|'.'
name|'get_pid_file_name'
op|'('
name|'ini_file'
op|')'
op|')'
newline|'\n'
name|'server'
op|'='
name|'swift_init'
op|'.'
name|'SwiftServer'
op|'('
string|"'object-replicator'"
op|')'
newline|'\n'
name|'ini_file'
op|'='
name|'self'
op|'.'
name|'join_swift_dir'
op|'('
string|"'object-server/1.conf'"
op|')'
newline|'\n'
name|'pid_file'
op|'='
name|'self'
op|'.'
name|'join_run_dir'
op|'('
string|"'object-replicator/1.pid'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'pid_file'
op|','
name|'server'
op|'.'
name|'get_pid_file_name'
op|'('
name|'ini_file'
op|')'
op|')'
newline|'\n'
name|'server'
op|'='
name|'swift_init'
op|'.'
name|'SwiftServer'
op|'('
string|"'container-auditor'"
op|')'
newline|'\n'
name|'ini_file'
op|'='
name|'self'
op|'.'
name|'join_swift_dir'
op|'('
nl|'\n'
string|"'container-server/1/container-auditor.conf'"
op|')'
newline|'\n'
name|'pid_file'
op|'='
name|'self'
op|'.'
name|'join_run_dir'
op|'('
nl|'\n'
string|"'container-auditor/1/container-auditor.pid'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'pid_file'
op|','
name|'server'
op|'.'
name|'get_pid_file_name'
op|'('
name|'ini_file'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_ini_file_name
dedent|''
name|'def'
name|'test_get_ini_file_name'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'server'
op|'='
name|'swift_init'
op|'.'
name|'SwiftServer'
op|'('
string|"'proxy'"
op|')'
newline|'\n'
name|'ini_file'
op|'='
name|'self'
op|'.'
name|'join_swift_dir'
op|'('
string|"'proxy-server.conf'"
op|')'
newline|'\n'
name|'pid_file'
op|'='
name|'self'
op|'.'
name|'join_run_dir'
op|'('
string|"'proxy-server.pid'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'ini_file'
op|','
name|'server'
op|'.'
name|'get_ini_file_name'
op|'('
name|'pid_file'
op|')'
op|')'
newline|'\n'
name|'server'
op|'='
name|'swift_init'
op|'.'
name|'SwiftServer'
op|'('
string|"'object-replicator'"
op|')'
newline|'\n'
name|'ini_file'
op|'='
name|'self'
op|'.'
name|'join_swift_dir'
op|'('
string|"'object-server/1.conf'"
op|')'
newline|'\n'
name|'pid_file'
op|'='
name|'self'
op|'.'
name|'join_run_dir'
op|'('
string|"'object-replicator/1.pid'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'ini_file'
op|','
name|'server'
op|'.'
name|'get_ini_file_name'
op|'('
name|'pid_file'
op|')'
op|')'
newline|'\n'
name|'server'
op|'='
name|'swift_init'
op|'.'
name|'SwiftServer'
op|'('
string|"'container-auditor'"
op|')'
newline|'\n'
name|'ini_file'
op|'='
name|'self'
op|'.'
name|'join_swift_dir'
op|'('
nl|'\n'
string|"'container-server/1/container-auditor.conf'"
op|')'
newline|'\n'
name|'pid_file'
op|'='
name|'self'
op|'.'
name|'join_run_dir'
op|'('
nl|'\n'
string|"'container-auditor/1/container-auditor.pid'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'ini_file'
op|','
name|'server'
op|'.'
name|'get_ini_file_name'
op|'('
name|'pid_file'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_ini_files
dedent|''
name|'def'
name|'test_ini_files'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# test get single ini file'
nl|'\n'
indent|'        '
name|'ini_files'
op|'='
op|'('
nl|'\n'
string|"'proxy-server.conf'"
op|','
nl|'\n'
string|"'proxy-server.ini'"
op|','
nl|'\n'
string|"'auth-server.conf'"
op|','
nl|'\n'
op|')'
newline|'\n'
name|'with'
name|'temptree'
op|'('
name|'ini_files'
op|')'
name|'as'
name|'t'
op|':'
newline|'\n'
indent|'            '
name|'swift_init'
op|'.'
name|'SWIFT_DIR'
op|'='
name|'t'
newline|'\n'
name|'server'
op|'='
name|'swift_init'
op|'.'
name|'SwiftServer'
op|'('
string|"'proxy'"
op|')'
newline|'\n'
name|'ini_files'
op|'='
name|'server'
op|'.'
name|'ini_files'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'len'
op|'('
name|'ini_files'
op|')'
op|','
number|'1'
op|')'
newline|'\n'
name|'ini_file'
op|'='
name|'ini_files'
op|'['
number|'0'
op|']'
newline|'\n'
name|'proxy_conf'
op|'='
name|'self'
op|'.'
name|'join_swift_dir'
op|'('
string|"'proxy-server.conf'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'ini_file'
op|','
name|'proxy_conf'
op|')'
newline|'\n'
nl|'\n'
comment|'# test multi server conf files & grouping of server-type config'
nl|'\n'
dedent|''
name|'ini_files'
op|'='
op|'('
nl|'\n'
string|"'object-server1.conf'"
op|','
nl|'\n'
string|"'object-server/2.conf'"
op|','
nl|'\n'
string|"'object-server/object3.conf'"
op|','
nl|'\n'
string|"'object-server/conf/server4.conf'"
op|','
nl|'\n'
string|"'object-server.txt'"
op|','
nl|'\n'
string|"'proxy-server.conf'"
op|','
nl|'\n'
op|')'
newline|'\n'
name|'with'
name|'temptree'
op|'('
name|'ini_files'
op|')'
name|'as'
name|'t'
op|':'
newline|'\n'
indent|'            '
name|'swift_init'
op|'.'
name|'SWIFT_DIR'
op|'='
name|'t'
newline|'\n'
name|'server'
op|'='
name|'swift_init'
op|'.'
name|'SwiftServer'
op|'('
string|"'object-replicator'"
op|')'
newline|'\n'
name|'ini_files'
op|'='
name|'server'
op|'.'
name|'ini_files'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'len'
op|'('
name|'ini_files'
op|')'
op|','
number|'4'
op|')'
newline|'\n'
name|'c1'
op|'='
name|'self'
op|'.'
name|'join_swift_dir'
op|'('
string|"'object-server1.conf'"
op|')'
newline|'\n'
name|'c2'
op|'='
name|'self'
op|'.'
name|'join_swift_dir'
op|'('
string|"'object-server/2.conf'"
op|')'
newline|'\n'
name|'c3'
op|'='
name|'self'
op|'.'
name|'join_swift_dir'
op|'('
string|"'object-server/object3.conf'"
op|')'
newline|'\n'
name|'c4'
op|'='
name|'self'
op|'.'
name|'join_swift_dir'
op|'('
string|"'object-server/conf/server4.conf'"
op|')'
newline|'\n'
name|'for'
name|'c'
name|'in'
op|'['
name|'c1'
op|','
name|'c2'
op|','
name|'c3'
op|','
name|'c4'
op|']'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'assert_'
op|'('
name|'c'
name|'in'
name|'ini_files'
op|')'
newline|'\n'
comment|'# test configs returned sorted'
nl|'\n'
dedent|''
name|'sorted_confs'
op|'='
name|'sorted'
op|'('
op|'['
name|'c1'
op|','
name|'c2'
op|','
name|'c3'
op|','
name|'c4'
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'ini_files'
op|','
name|'sorted_confs'
op|')'
newline|'\n'
nl|'\n'
comment|'# test get single numbered conf'
nl|'\n'
dedent|''
name|'ini_files'
op|'='
op|'('
nl|'\n'
string|"'account-server/1.conf'"
op|','
nl|'\n'
string|"'account-server/2.conf'"
op|','
nl|'\n'
string|"'account-server/3.conf'"
op|','
nl|'\n'
string|"'account-server/4.conf'"
op|','
nl|'\n'
op|')'
newline|'\n'
name|'with'
name|'temptree'
op|'('
name|'ini_files'
op|')'
name|'as'
name|'t'
op|':'
newline|'\n'
indent|'            '
name|'swift_init'
op|'.'
name|'SWIFT_DIR'
op|'='
name|'t'
newline|'\n'
name|'server'
op|'='
name|'swift_init'
op|'.'
name|'SwiftServer'
op|'('
string|"'account'"
op|')'
newline|'\n'
name|'ini_files'
op|'='
name|'server'
op|'.'
name|'ini_files'
op|'('
name|'number'
op|'='
number|'2'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'len'
op|'('
name|'ini_files'
op|')'
op|','
number|'1'
op|')'
newline|'\n'
name|'ini_file'
op|'='
name|'ini_files'
op|'['
number|'0'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'ini_file'
op|','
nl|'\n'
name|'self'
op|'.'
name|'join_swift_dir'
op|'('
string|"'account-server/2.conf'"
op|')'
op|')'
newline|'\n'
comment|'# test missing config number'
nl|'\n'
name|'ini_files'
op|'='
name|'server'
op|'.'
name|'ini_files'
op|'('
name|'number'
op|'='
number|'5'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'ini_files'
op|')'
newline|'\n'
nl|'\n'
comment|'# test verbose & quiet'
nl|'\n'
dedent|''
name|'ini_files'
op|'='
op|'('
nl|'\n'
string|"'auth-server.ini'"
op|','
nl|'\n'
string|"'container-server/1.conf'"
op|','
nl|'\n'
op|')'
newline|'\n'
name|'with'
name|'temptree'
op|'('
name|'ini_files'
op|')'
name|'as'
name|'t'
op|':'
newline|'\n'
indent|'            '
name|'swift_init'
op|'.'
name|'SWIFT_DIR'
op|'='
name|'t'
newline|'\n'
name|'old_stdout'
op|'='
name|'sys'
op|'.'
name|'stdout'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'                '
name|'with'
name|'open'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'t'
op|','
string|"'output'"
op|')'
op|','
string|"'w+'"
op|')'
name|'as'
name|'f'
op|':'
newline|'\n'
indent|'                    '
name|'sys'
op|'.'
name|'stdout'
op|'='
name|'f'
newline|'\n'
name|'server'
op|'='
name|'swift_init'
op|'.'
name|'SwiftServer'
op|'('
string|"'auth'"
op|')'
newline|'\n'
comment|'# check warn "unable to locate"'
nl|'\n'
name|'ini_files'
op|'='
name|'server'
op|'.'
name|'ini_files'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'ini_files'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_'
op|'('
string|"'unable to locate'"
name|'in'
name|'pop_stream'
op|'('
name|'f'
op|')'
op|'.'
name|'lower'
op|'('
op|')'
op|')'
newline|'\n'
comment|'# check quiet will silence warning'
nl|'\n'
name|'ini_files'
op|'='
name|'server'
op|'.'
name|'ini_files'
op|'('
name|'verbose'
op|'='
name|'True'
op|','
name|'quiet'
op|'='
name|'True'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'pop_stream'
op|'('
name|'f'
op|')'
op|','
string|"''"
op|')'
newline|'\n'
comment|'# check found config no warning'
nl|'\n'
name|'server'
op|'='
name|'swift_init'
op|'.'
name|'SwiftServer'
op|'('
string|"'container-auditor'"
op|')'
newline|'\n'
name|'ini_files'
op|'='
name|'server'
op|'.'
name|'ini_files'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'pop_stream'
op|'('
name|'f'
op|')'
op|','
string|"''"
op|')'
newline|'\n'
comment|'# check missing config number warn "unable to locate"'
nl|'\n'
name|'ini_files'
op|'='
name|'server'
op|'.'
name|'ini_files'
op|'('
name|'number'
op|'='
number|'2'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_'
op|'('
string|"'unable to locate'"
name|'in'
name|'pop_stream'
op|'('
name|'f'
op|')'
op|'.'
name|'lower'
op|'('
op|')'
op|')'
newline|'\n'
comment|'# check verbose lists configs'
nl|'\n'
name|'ini_files'
op|'='
name|'server'
op|'.'
name|'ini_files'
op|'('
name|'number'
op|'='
number|'2'
op|','
name|'verbose'
op|'='
name|'True'
op|')'
newline|'\n'
name|'c1'
op|'='
name|'self'
op|'.'
name|'join_swift_dir'
op|'('
string|"'container-server/1.conf'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_'
op|'('
name|'c1'
name|'in'
name|'pop_stream'
op|'('
name|'f'
op|')'
op|')'
newline|'\n'
dedent|''
dedent|''
name|'finally'
op|':'
newline|'\n'
indent|'                '
name|'sys'
op|'.'
name|'stdout'
op|'='
name|'old_stdout'
newline|'\n'
nl|'\n'
DECL|member|test_iter_pid_files
dedent|''
dedent|''
dedent|''
name|'def'
name|'test_iter_pid_files'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        SwiftServer.iter_pid_files is kinda boring, test the\n        SwiftServer.pid_files stuff here as well\n        """'
newline|'\n'
name|'pid_files'
op|'='
op|'('
nl|'\n'
op|'('
string|"'proxy-server.pid'"
op|','
number|'1'
op|')'
op|','
nl|'\n'
op|'('
string|"'auth-server.pid'"
op|','
string|"'blah'"
op|')'
op|','
nl|'\n'
op|'('
string|"'object-replicator/1.pid'"
op|','
number|'11'
op|')'
op|','
nl|'\n'
op|'('
string|"'object-replicator/2.pid'"
op|','
number|'12'
op|')'
op|','
nl|'\n'
op|')'
newline|'\n'
name|'files'
op|','
name|'contents'
op|'='
name|'zip'
op|'('
op|'*'
name|'pid_files'
op|')'
newline|'\n'
name|'with'
name|'temptree'
op|'('
name|'files'
op|','
name|'contents'
op|')'
name|'as'
name|'t'
op|':'
newline|'\n'
indent|'            '
name|'swift_init'
op|'.'
name|'RUN_DIR'
op|'='
name|'t'
newline|'\n'
name|'server'
op|'='
name|'swift_init'
op|'.'
name|'SwiftServer'
op|'('
string|"'proxy'"
op|')'
newline|'\n'
comment|'# test get one file'
nl|'\n'
name|'iter'
op|'='
name|'server'
op|'.'
name|'iter_pid_files'
op|'('
op|')'
newline|'\n'
name|'pid_file'
op|','
name|'pid'
op|'='
name|'iter'
op|'.'
name|'next'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'pid_file'
op|','
name|'self'
op|'.'
name|'join_run_dir'
op|'('
string|"'proxy-server.pid'"
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'pid'
op|','
number|'1'
op|')'
newline|'\n'
comment|'# ... and only one file'
nl|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'StopIteration'
op|','
name|'iter'
op|'.'
name|'next'
op|')'
newline|'\n'
comment|'# test invalid value in pid file'
nl|'\n'
name|'server'
op|'='
name|'swift_init'
op|'.'
name|'SwiftServer'
op|'('
string|"'auth'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ValueError'
op|','
name|'server'
op|'.'
name|'iter_pid_files'
op|'('
op|')'
op|'.'
name|'next'
op|')'
newline|'\n'
comment|"# test object-server doesn't steal pids from object-replicator"
nl|'\n'
name|'server'
op|'='
name|'swift_init'
op|'.'
name|'SwiftServer'
op|'('
string|"'object'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'StopIteration'
op|','
name|'server'
op|'.'
name|'iter_pid_files'
op|'('
op|')'
op|'.'
name|'next'
op|')'
newline|'\n'
comment|'# test multi-pid iter'
nl|'\n'
name|'server'
op|'='
name|'swift_init'
op|'.'
name|'SwiftServer'
op|'('
string|"'object-replicator'"
op|')'
newline|'\n'
name|'real_map'
op|'='
op|'{'
nl|'\n'
number|'11'
op|':'
name|'self'
op|'.'
name|'join_run_dir'
op|'('
string|"'object-replicator/1.pid'"
op|')'
op|','
nl|'\n'
number|'12'
op|':'
name|'self'
op|'.'
name|'join_run_dir'
op|'('
string|"'object-replicator/2.pid'"
op|')'
op|','
nl|'\n'
op|'}'
newline|'\n'
name|'pid_map'
op|'='
op|'{'
op|'}'
newline|'\n'
name|'for'
name|'pid_file'
op|','
name|'pid'
name|'in'
name|'server'
op|'.'
name|'iter_pid_files'
op|'('
op|')'
op|':'
newline|'\n'
indent|'                '
name|'pid_map'
op|'['
name|'pid'
op|']'
op|'='
name|'pid_file'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'pid_map'
op|','
name|'real_map'
op|')'
newline|'\n'
nl|'\n'
comment|'# test get pid_files by number'
nl|'\n'
dedent|''
name|'ini_files'
op|'='
op|'('
nl|'\n'
string|"'object-server/1.conf'"
op|','
nl|'\n'
string|"'object-server/2.conf'"
op|','
nl|'\n'
string|"'object-server/3.conf'"
op|','
nl|'\n'
string|"'object-server/4.conf'"
op|','
nl|'\n'
op|')'
newline|'\n'
nl|'\n'
name|'pid_files'
op|'='
op|'('
nl|'\n'
op|'('
string|"'object-server/1.pid'"
op|','
number|'1'
op|')'
op|','
nl|'\n'
op|'('
string|"'object-server/2.pid'"
op|','
number|'2'
op|')'
op|','
nl|'\n'
op|'('
string|"'object-server/5.pid'"
op|','
number|'5'
op|')'
op|','
nl|'\n'
op|')'
newline|'\n'
nl|'\n'
name|'with'
name|'temptree'
op|'('
name|'ini_files'
op|')'
name|'as'
name|'swift_dir'
op|':'
newline|'\n'
indent|'            '
name|'swift_init'
op|'.'
name|'SWIFT_DIR'
op|'='
name|'swift_dir'
newline|'\n'
name|'files'
op|','
name|'pids'
op|'='
name|'zip'
op|'('
op|'*'
name|'pid_files'
op|')'
newline|'\n'
name|'with'
name|'temptree'
op|'('
name|'files'
op|','
name|'pids'
op|')'
name|'as'
name|'t'
op|':'
newline|'\n'
indent|'                '
name|'swift_init'
op|'.'
name|'RUN_DIR'
op|'='
name|'t'
newline|'\n'
name|'server'
op|'='
name|'swift_init'
op|'.'
name|'SwiftServer'
op|'('
string|"'object'"
op|')'
newline|'\n'
comment|'# test get all pid files'
nl|'\n'
name|'real_map'
op|'='
op|'{'
nl|'\n'
number|'1'
op|':'
name|'self'
op|'.'
name|'join_run_dir'
op|'('
string|"'object-server/1.pid'"
op|')'
op|','
nl|'\n'
number|'2'
op|':'
name|'self'
op|'.'
name|'join_run_dir'
op|'('
string|"'object-server/2.pid'"
op|')'
op|','
nl|'\n'
number|'5'
op|':'
name|'self'
op|'.'
name|'join_run_dir'
op|'('
string|"'object-server/5.pid'"
op|')'
op|','
nl|'\n'
op|'}'
newline|'\n'
name|'pid_map'
op|'='
op|'{'
op|'}'
newline|'\n'
name|'for'
name|'pid_file'
op|','
name|'pid'
name|'in'
name|'server'
op|'.'
name|'iter_pid_files'
op|'('
op|')'
op|':'
newline|'\n'
indent|'                    '
name|'pid_map'
op|'['
name|'pid'
op|']'
op|'='
name|'pid_file'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'pid_map'
op|','
name|'real_map'
op|')'
newline|'\n'
comment|'# test get pid with matching conf'
nl|'\n'
name|'pids'
op|'='
name|'list'
op|'('
name|'server'
op|'.'
name|'iter_pid_files'
op|'('
name|'number'
op|'='
number|'2'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'len'
op|'('
name|'pids'
op|')'
op|','
number|'1'
op|')'
newline|'\n'
name|'pid_file'
op|','
name|'pid'
op|'='
name|'pids'
op|'['
number|'0'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'pid'
op|','
number|'2'
op|')'
newline|'\n'
name|'pid_two'
op|'='
name|'self'
op|'.'
name|'join_run_dir'
op|'('
string|"'object-server/2.pid'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'pid_file'
op|','
name|'pid_two'
op|')'
newline|'\n'
comment|'# try to iter on a pid number with a matching conf but no pid'
nl|'\n'
name|'pids'
op|'='
name|'list'
op|'('
name|'server'
op|'.'
name|'iter_pid_files'
op|'('
name|'number'
op|'='
number|'3'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'pids'
op|')'
newline|'\n'
comment|'# test get pids w/o matching conf'
nl|'\n'
name|'pids'
op|'='
name|'list'
op|'('
name|'server'
op|'.'
name|'iter_pid_files'
op|'('
name|'number'
op|'='
number|'5'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'pids'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_signal_pids
dedent|''
dedent|''
dedent|''
name|'def'
name|'test_signal_pids'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'pid_files'
op|'='
op|'('
nl|'\n'
op|'('
string|"'proxy-server.pid'"
op|','
number|'1'
op|')'
op|','
nl|'\n'
op|'('
string|"'auth-server.pid'"
op|','
number|'2'
op|')'
op|','
nl|'\n'
op|')'
newline|'\n'
name|'files'
op|','
name|'pids'
op|'='
name|'zip'
op|'('
op|'*'
name|'pid_files'
op|')'
newline|'\n'
name|'with'
name|'temptree'
op|'('
name|'files'
op|','
name|'pids'
op|')'
name|'as'
name|'t'
op|':'
newline|'\n'
indent|'            '
name|'swift_init'
op|'.'
name|'RUN_DIR'
op|'='
name|'t'
newline|'\n'
comment|'# mock os with both pids running'
nl|'\n'
name|'swift_init'
op|'.'
name|'os'
op|'='
name|'MockOs'
op|'('
op|'['
number|'1'
op|','
number|'2'
op|']'
op|')'
newline|'\n'
name|'server'
op|'='
name|'swift_init'
op|'.'
name|'SwiftServer'
op|'('
string|"'proxy'"
op|')'
newline|'\n'
name|'pids'
op|'='
name|'server'
op|'.'
name|'signal_pids'
op|'('
name|'DUMMY_SIG'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'len'
op|'('
name|'pids'
op|')'
op|','
number|'1'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_'
op|'('
number|'1'
name|'in'
name|'pids'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'swift_init'
op|'.'
name|'os'
op|'.'
name|'pid_sigs'
op|'['
number|'1'
op|']'
op|','
op|'['
name|'DUMMY_SIG'
op|']'
op|')'
newline|'\n'
comment|'# make sure other process not signaled'
nl|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
number|'2'
name|'in'
name|'pids'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
number|'2'
name|'in'
name|'swift_init'
op|'.'
name|'os'
op|'.'
name|'pid_sigs'
op|')'
newline|'\n'
comment|'# capture stdio'
nl|'\n'
name|'old_stdout'
op|'='
name|'sys'
op|'.'
name|'stdout'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'                '
name|'with'
name|'open'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'t'
op|','
string|"'output'"
op|')'
op|','
string|"'w+'"
op|')'
name|'as'
name|'f'
op|':'
newline|'\n'
indent|'                    '
name|'sys'
op|'.'
name|'stdout'
op|'='
name|'f'
newline|'\n'
comment|'#test print details'
nl|'\n'
name|'pids'
op|'='
name|'server'
op|'.'
name|'signal_pids'
op|'('
name|'DUMMY_SIG'
op|')'
newline|'\n'
name|'output'
op|'='
name|'pop_stream'
op|'('
name|'f'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_'
op|'('
string|"'pid: %s'"
op|'%'
number|'1'
name|'in'
name|'output'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_'
op|'('
string|"'signal: %s'"
op|'%'
name|'DUMMY_SIG'
name|'in'
name|'output'
op|')'
newline|'\n'
comment|'# test no details on signal.SIG_DFL'
nl|'\n'
name|'pids'
op|'='
name|'server'
op|'.'
name|'signal_pids'
op|'('
name|'signal'
op|'.'
name|'SIG_DFL'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'pop_stream'
op|'('
name|'f'
op|')'
op|','
string|"''"
op|')'
newline|'\n'
comment|'# reset mock os so only the other server is running'
nl|'\n'
name|'swift_init'
op|'.'
name|'os'
op|'='
name|'MockOs'
op|'('
op|'['
number|'2'
op|']'
op|')'
newline|'\n'
comment|'# test pid not running'
nl|'\n'
name|'pids'
op|'='
name|'server'
op|'.'
name|'signal_pids'
op|'('
name|'signal'
op|'.'
name|'SIG_DFL'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_'
op|'('
number|'1'
name|'not'
name|'in'
name|'pids'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_'
op|'('
number|'1'
name|'not'
name|'in'
name|'swift_init'
op|'.'
name|'os'
op|'.'
name|'pid_sigs'
op|')'
newline|'\n'
comment|'# test remove stale pid file'
nl|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'exists'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'join_run_dir'
op|'('
string|"'proxy-server.pid'"
op|')'
op|')'
op|')'
newline|'\n'
comment|'# reset mock os with no running pids'
nl|'\n'
name|'swift_init'
op|'.'
name|'os'
op|'='
name|'MockOs'
op|'('
op|'['
op|']'
op|')'
newline|'\n'
name|'server'
op|'='
name|'swift_init'
op|'.'
name|'SwiftServer'
op|'('
string|"'auth'"
op|')'
newline|'\n'
comment|'# test verbose warns on removing pid file'
nl|'\n'
name|'pids'
op|'='
name|'server'
op|'.'
name|'signal_pids'
op|'('
name|'signal'
op|'.'
name|'SIG_DFL'
op|','
name|'verbose'
op|'='
name|'True'
op|')'
newline|'\n'
name|'output'
op|'='
name|'pop_stream'
op|'('
name|'f'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_'
op|'('
string|"'stale pid'"
name|'in'
name|'output'
op|'.'
name|'lower'
op|'('
op|')'
op|')'
newline|'\n'
name|'auth_pid'
op|'='
name|'self'
op|'.'
name|'join_run_dir'
op|'('
string|"'auth-server.pid'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_'
op|'('
name|'auth_pid'
name|'in'
name|'output'
op|')'
newline|'\n'
dedent|''
dedent|''
name|'finally'
op|':'
newline|'\n'
indent|'                '
name|'sys'
op|'.'
name|'stdout'
op|'='
name|'old_stdout'
newline|'\n'
nl|'\n'
DECL|member|test_get_running_pids
dedent|''
dedent|''
dedent|''
name|'def'
name|'test_get_running_pids'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# test only gets running pids'
nl|'\n'
indent|'        '
name|'pid_files'
op|'='
op|'('
nl|'\n'
op|'('
string|"'test-server1.pid'"
op|','
number|'1'
op|')'
op|','
nl|'\n'
op|'('
string|"'test-server2.pid'"
op|','
number|'2'
op|')'
op|','
nl|'\n'
op|')'
newline|'\n'
name|'with'
name|'temptree'
op|'('
op|'*'
name|'zip'
op|'('
op|'*'
name|'pid_files'
op|')'
op|')'
name|'as'
name|'t'
op|':'
newline|'\n'
indent|'            '
name|'swift_init'
op|'.'
name|'RUN_DIR'
op|'='
name|'t'
newline|'\n'
name|'server'
op|'='
name|'swift_init'
op|'.'
name|'SwiftServer'
op|'('
string|"'test-server'"
op|')'
newline|'\n'
comment|"# mock os, only pid '1' is running"
nl|'\n'
name|'swift_init'
op|'.'
name|'os'
op|'='
name|'MockOs'
op|'('
op|'['
number|'1'
op|']'
op|')'
newline|'\n'
name|'running_pids'
op|'='
name|'server'
op|'.'
name|'get_running_pids'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'len'
op|'('
name|'running_pids'
op|')'
op|','
number|'1'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_'
op|'('
number|'1'
name|'in'
name|'running_pids'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_'
op|'('
number|'2'
name|'not'
name|'in'
name|'running_pids'
op|')'
newline|'\n'
comment|'# test persistant running pid files'
nl|'\n'
name|'self'
op|'.'
name|'assert_'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'exists'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'t'
op|','
string|"'test-server1.pid'"
op|')'
op|')'
op|')'
newline|'\n'
comment|'# test clean up stale pids'
nl|'\n'
name|'pid_two'
op|'='
name|'self'
op|'.'
name|'join_swift_dir'
op|'('
string|"'test-server2.pid'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'exists'
op|'('
name|'pid_two'
op|')'
op|')'
newline|'\n'
comment|'# reset mock os, no pids running'
nl|'\n'
name|'swift_init'
op|'.'
name|'os'
op|'='
name|'MockOs'
op|'('
op|'['
op|']'
op|')'
newline|'\n'
name|'running_pids'
op|'='
name|'server'
op|'.'
name|'get_running_pids'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'running_pids'
op|')'
newline|'\n'
comment|'# and now all pid files are cleaned out'
nl|'\n'
name|'pid_one'
op|'='
name|'self'
op|'.'
name|'join_run_dir'
op|'('
string|"'test-server1.pid'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'exists'
op|'('
name|'pid_one'
op|')'
op|')'
newline|'\n'
name|'all_pids'
op|'='
name|'os'
op|'.'
name|'listdir'
op|'('
name|'t'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'len'
op|'('
name|'all_pids'
op|')'
op|','
number|'0'
op|')'
newline|'\n'
nl|'\n'
comment|'# test only get pids for right server'
nl|'\n'
dedent|''
name|'pid_files'
op|'='
op|'('
nl|'\n'
op|'('
string|"'thing-doer.pid'"
op|','
number|'1'
op|')'
op|','
nl|'\n'
op|'('
string|"'thing-sayer.pid'"
op|','
number|'2'
op|')'
op|','
nl|'\n'
op|'('
string|"'other-doer.pid'"
op|','
number|'3'
op|')'
op|','
nl|'\n'
op|'('
string|"'other-sayer.pid'"
op|','
number|'4'
op|')'
op|','
nl|'\n'
op|')'
newline|'\n'
name|'files'
op|','
name|'pids'
op|'='
name|'zip'
op|'('
op|'*'
name|'pid_files'
op|')'
newline|'\n'
name|'with'
name|'temptree'
op|'('
name|'files'
op|','
name|'pids'
op|')'
name|'as'
name|'t'
op|':'
newline|'\n'
indent|'            '
name|'swift_init'
op|'.'
name|'RUN_DIR'
op|'='
name|'t'
newline|'\n'
comment|'# all pids are running'
nl|'\n'
name|'swift_init'
op|'.'
name|'os'
op|'='
name|'MockOs'
op|'('
name|'pids'
op|')'
newline|'\n'
name|'server'
op|'='
name|'swift_init'
op|'.'
name|'SwiftServer'
op|'('
string|"'thing-doer'"
op|')'
newline|'\n'
name|'running_pids'
op|'='
name|'server'
op|'.'
name|'get_running_pids'
op|'('
op|')'
newline|'\n'
comment|'# only thing-doer.pid, 1'
nl|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'len'
op|'('
name|'running_pids'
op|')'
op|','
number|'1'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_'
op|'('
number|'1'
name|'in'
name|'running_pids'
op|')'
newline|'\n'
comment|'# no other pids returned'
nl|'\n'
name|'for'
name|'n'
name|'in'
op|'('
number|'2'
op|','
number|'3'
op|','
number|'4'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'assert_'
op|'('
name|'n'
name|'not'
name|'in'
name|'running_pids'
op|')'
newline|'\n'
comment|'# assert stale pids for other servers ignored'
nl|'\n'
dedent|''
name|'swift_init'
op|'.'
name|'os'
op|'='
name|'MockOs'
op|'('
op|'['
number|'1'
op|']'
op|')'
comment|'# only thing-doer is running'
newline|'\n'
name|'running_pids'
op|'='
name|'server'
op|'.'
name|'get_running_pids'
op|'('
op|')'
newline|'\n'
name|'for'
name|'f'
name|'in'
op|'('
string|"'thing-sayer.pid'"
op|','
string|"'other-doer.pid'"
op|','
string|"'other-sayer.pid'"
op|')'
op|':'
newline|'\n'
comment|'# other server pid files persist'
nl|'\n'
indent|'                '
name|'self'
op|'.'
name|'assert_'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'exists'
op|','
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'t'
op|','
name|'f'
op|')'
op|')'
newline|'\n'
comment|'# verify that servers are in fact not running'
nl|'\n'
dedent|''
name|'for'
name|'server_name'
name|'in'
op|'('
string|"'thing-sayer'"
op|','
string|"'other-doer'"
op|','
string|"'other-sayer'"
op|')'
op|':'
newline|'\n'
indent|'                '
name|'server'
op|'='
name|'swift_init'
op|'.'
name|'SwiftServer'
op|'('
name|'server_name'
op|')'
newline|'\n'
name|'running_pids'
op|'='
name|'server'
op|'.'
name|'get_running_pids'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'running_pids'
op|')'
newline|'\n'
comment|'# and now all OTHER pid files are cleaned out'
nl|'\n'
dedent|''
name|'all_pids'
op|'='
name|'os'
op|'.'
name|'listdir'
op|'('
name|'t'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'len'
op|'('
name|'all_pids'
op|')'
op|','
number|'1'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'exists'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'t'
op|','
string|"'thing-doer.pid'"
op|')'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_kill_running_pids
dedent|''
dedent|''
name|'def'
name|'test_kill_running_pids'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'pid_files'
op|'='
op|'('
nl|'\n'
op|'('
string|"'object-server.pid'"
op|','
number|'1'
op|')'
op|','
nl|'\n'
op|'('
string|"'object-replicator1.pid'"
op|','
number|'11'
op|')'
op|','
nl|'\n'
op|'('
string|"'object-replicator2.pid'"
op|','
number|'12'
op|')'
op|','
nl|'\n'
op|')'
newline|'\n'
name|'files'
op|','
name|'pids'
op|'='
name|'zip'
op|'('
op|'*'
name|'pid_files'
op|')'
newline|'\n'
name|'with'
name|'temptree'
op|'('
name|'files'
op|','
name|'pids'
op|')'
name|'as'
name|'t'
op|':'
newline|'\n'
indent|'            '
name|'swift_init'
op|'.'
name|'RUN_DIR'
op|'='
name|'t'
newline|'\n'
name|'server'
op|'='
name|'swift_init'
op|'.'
name|'SwiftServer'
op|'('
string|"'object'"
op|')'
newline|'\n'
comment|'# test no servers running'
nl|'\n'
name|'pids'
op|'='
name|'server'
op|'.'
name|'kill_running_pids'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'pids'
op|')'
newline|'\n'
comment|'# start up pid'
nl|'\n'
name|'swift_init'
op|'.'
name|'os'
op|'='
name|'MockOs'
op|'('
op|'['
number|'1'
op|']'
op|')'
newline|'\n'
comment|'# test kill one pid'
nl|'\n'
name|'pids'
op|'='
name|'server'
op|'.'
name|'kill_running_pids'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'len'
op|'('
name|'pids'
op|')'
op|','
number|'1'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_'
op|'('
number|'1'
name|'in'
name|'pids'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'swift_init'
op|'.'
name|'os'
op|'.'
name|'pid_sigs'
op|'['
number|'1'
op|']'
op|','
op|'['
name|'signal'
op|'.'
name|'SIGTERM'
op|']'
op|')'
newline|'\n'
comment|'# reset os mock'
nl|'\n'
name|'swift_init'
op|'.'
name|'os'
op|'='
name|'MockOs'
op|'('
op|'['
number|'1'
op|']'
op|')'
newline|'\n'
comment|'# test shutdown'
nl|'\n'
name|'self'
op|'.'
name|'assert_'
op|'('
string|"'object-server'"
name|'in'
nl|'\n'
name|'swift_init'
op|'.'
name|'GRACEFUL_SHUTDOWN_SERVERS'
op|')'
newline|'\n'
name|'pids'
op|'='
name|'server'
op|'.'
name|'kill_running_pids'
op|'('
name|'graceful'
op|'='
name|'True'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'len'
op|'('
name|'pids'
op|')'
op|','
number|'1'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_'
op|'('
number|'1'
name|'in'
name|'pids'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'swift_init'
op|'.'
name|'os'
op|'.'
name|'pid_sigs'
op|'['
number|'1'
op|']'
op|','
op|'['
name|'signal'
op|'.'
name|'SIGHUP'
op|']'
op|')'
newline|'\n'
comment|'# start up other servers'
nl|'\n'
name|'swift_init'
op|'.'
name|'os'
op|'='
name|'MockOs'
op|'('
op|'['
number|'11'
op|','
number|'12'
op|']'
op|')'
newline|'\n'
comment|'# test multi server kill & ignore graceful on unsupport server'
nl|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
string|"'object-replicator'"
name|'in'
nl|'\n'
name|'swift_init'
op|'.'
name|'GRACEFUL_SHUTDOWN_SERVERS'
op|')'
newline|'\n'
name|'server'
op|'='
name|'swift_init'
op|'.'
name|'SwiftServer'
op|'('
string|"'object-replicator'"
op|')'
newline|'\n'
name|'pids'
op|'='
name|'server'
op|'.'
name|'kill_running_pids'
op|'('
name|'graceful'
op|'='
name|'True'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'len'
op|'('
name|'pids'
op|')'
op|','
number|'2'
op|')'
newline|'\n'
name|'for'
name|'pid'
name|'in'
op|'('
number|'11'
op|','
number|'12'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'assert_'
op|'('
name|'pid'
name|'in'
name|'pids'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'swift_init'
op|'.'
name|'os'
op|'.'
name|'pid_sigs'
op|'['
name|'pid'
op|']'
op|','
nl|'\n'
op|'['
name|'signal'
op|'.'
name|'SIGTERM'
op|']'
op|')'
newline|'\n'
comment|'# and the other pid is of course not signaled'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'assert_'
op|'('
number|'1'
name|'not'
name|'in'
name|'swift_init'
op|'.'
name|'os'
op|'.'
name|'pid_sigs'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_status
dedent|''
dedent|''
name|'def'
name|'test_status'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'ini_files'
op|'='
op|'('
nl|'\n'
string|"'test-server/1.conf'"
op|','
nl|'\n'
string|"'test-server/2.conf'"
op|','
nl|'\n'
string|"'test-server/3.conf'"
op|','
nl|'\n'
string|"'test-server/4.conf'"
op|','
nl|'\n'
op|')'
newline|'\n'
nl|'\n'
name|'pid_files'
op|'='
op|'('
nl|'\n'
op|'('
string|"'test-server/1.pid'"
op|','
number|'1'
op|')'
op|','
nl|'\n'
op|'('
string|"'test-server/2.pid'"
op|','
number|'2'
op|')'
op|','
nl|'\n'
op|'('
string|"'test-server/3.pid'"
op|','
number|'3'
op|')'
op|','
nl|'\n'
op|'('
string|"'test-server/4.pid'"
op|','
number|'4'
op|')'
op|','
nl|'\n'
op|')'
newline|'\n'
nl|'\n'
name|'with'
name|'temptree'
op|'('
name|'ini_files'
op|')'
name|'as'
name|'swift_dir'
op|':'
newline|'\n'
indent|'            '
name|'swift_init'
op|'.'
name|'SWIFT_DIR'
op|'='
name|'swift_dir'
newline|'\n'
name|'files'
op|','
name|'pids'
op|'='
name|'zip'
op|'('
op|'*'
name|'pid_files'
op|')'
newline|'\n'
name|'with'
name|'temptree'
op|'('
name|'files'
op|','
name|'pids'
op|')'
name|'as'
name|'t'
op|':'
newline|'\n'
indent|'                '
name|'swift_init'
op|'.'
name|'RUN_DIR'
op|'='
name|'t'
newline|'\n'
comment|'# setup running servers'
nl|'\n'
name|'server'
op|'='
name|'swift_init'
op|'.'
name|'SwiftServer'
op|'('
string|"'test'"
op|')'
newline|'\n'
comment|'# capture stdio'
nl|'\n'
name|'old_stdout'
op|'='
name|'sys'
op|'.'
name|'stdout'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'                    '
name|'with'
name|'open'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'t'
op|','
string|"'output'"
op|')'
op|','
string|"'w+'"
op|')'
name|'as'
name|'f'
op|':'
newline|'\n'
indent|'                        '
name|'sys'
op|'.'
name|'stdout'
op|'='
name|'f'
newline|'\n'
comment|'# test status for all running'
nl|'\n'
name|'swift_init'
op|'.'
name|'os'
op|'='
name|'MockOs'
op|'('
name|'pids'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'server'
op|'.'
name|'status'
op|'('
op|')'
op|','
number|'0'
op|')'
newline|'\n'
name|'output'
op|'='
name|'pop_stream'
op|'('
name|'f'
op|')'
op|'.'
name|'strip'
op|'('
op|')'
op|'.'
name|'splitlines'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'len'
op|'('
name|'output'
op|')'
op|','
number|'4'
op|')'
newline|'\n'
name|'for'
name|'line'
name|'in'
name|'output'
op|':'
newline|'\n'
indent|'                            '
name|'self'
op|'.'
name|'assert_'
op|'('
string|"'test-server running'"
name|'in'
name|'line'
op|')'
newline|'\n'
comment|'# test get single server by number'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'server'
op|'.'
name|'status'
op|'('
name|'number'
op|'='
number|'4'
op|')'
op|','
number|'0'
op|')'
newline|'\n'
name|'output'
op|'='
name|'pop_stream'
op|'('
name|'f'
op|')'
op|'.'
name|'strip'
op|'('
op|')'
op|'.'
name|'splitlines'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'len'
op|'('
name|'output'
op|')'
op|','
number|'1'
op|')'
newline|'\n'
name|'line'
op|'='
name|'output'
op|'['
number|'0'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assert_'
op|'('
string|"'test-server running'"
name|'in'
name|'line'
op|')'
newline|'\n'
name|'conf_four'
op|'='
name|'self'
op|'.'
name|'join_swift_dir'
op|'('
name|'ini_files'
op|'['
number|'3'
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_'
op|'('
string|"'4 - %s'"
op|'%'
name|'conf_four'
name|'in'
name|'line'
op|')'
newline|'\n'
comment|'# test some servers not running'
nl|'\n'
name|'swift_init'
op|'.'
name|'os'
op|'='
name|'MockOs'
op|'('
op|'['
number|'1'
op|','
number|'2'
op|','
number|'3'
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'server'
op|'.'
name|'status'
op|'('
op|')'
op|','
number|'0'
op|')'
newline|'\n'
name|'output'
op|'='
name|'pop_stream'
op|'('
name|'f'
op|')'
op|'.'
name|'strip'
op|'('
op|')'
op|'.'
name|'splitlines'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'len'
op|'('
name|'output'
op|')'
op|','
number|'3'
op|')'
newline|'\n'
name|'for'
name|'line'
name|'in'
name|'output'
op|':'
newline|'\n'
indent|'                            '
name|'self'
op|'.'
name|'assert_'
op|'('
string|"'test-server running'"
name|'in'
name|'line'
op|')'
newline|'\n'
comment|'# test single server not running'
nl|'\n'
dedent|''
name|'swift_init'
op|'.'
name|'os'
op|'='
name|'MockOs'
op|'('
op|'['
number|'1'
op|','
number|'2'
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'server'
op|'.'
name|'status'
op|'('
name|'number'
op|'='
number|'3'
op|')'
op|','
number|'1'
op|')'
newline|'\n'
name|'output'
op|'='
name|'pop_stream'
op|'('
name|'f'
op|')'
op|'.'
name|'strip'
op|'('
op|')'
op|'.'
name|'splitlines'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'len'
op|'('
name|'output'
op|')'
op|','
number|'1'
op|')'
newline|'\n'
name|'line'
op|'='
name|'output'
op|'['
number|'0'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assert_'
op|'('
string|"'not running'"
name|'in'
name|'line'
op|')'
newline|'\n'
name|'conf_three'
op|'='
name|'self'
op|'.'
name|'join_swift_dir'
op|'('
name|'ini_files'
op|'['
number|'2'
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_'
op|'('
name|'conf_three'
name|'in'
name|'line'
op|')'
newline|'\n'
comment|'# test no running pids'
nl|'\n'
name|'swift_init'
op|'.'
name|'os'
op|'='
name|'MockOs'
op|'('
op|'['
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'server'
op|'.'
name|'status'
op|'('
op|')'
op|','
number|'1'
op|')'
newline|'\n'
name|'output'
op|'='
name|'pop_stream'
op|'('
name|'f'
op|')'
op|'.'
name|'lower'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_'
op|'('
string|"'no test-server running'"
name|'in'
name|'output'
op|')'
newline|'\n'
comment|'# test use provided pids'
nl|'\n'
name|'pids'
op|'='
op|'{'
nl|'\n'
number|'1'
op|':'
string|"'1.pid'"
op|','
nl|'\n'
number|'2'
op|':'
string|"'2.pid'"
op|','
nl|'\n'
op|'}'
newline|'\n'
comment|"# shouldn't call get_running_pids"
nl|'\n'
name|'called'
op|'='
op|'['
op|']'
newline|'\n'
nl|'\n'
DECL|function|mock
name|'def'
name|'mock'
op|'('
op|'*'
name|'args'
op|','
op|'**'
name|'kwargs'
op|')'
op|':'
newline|'\n'
indent|'                            '
name|'called'
op|'.'
name|'append'
op|'('
name|'True'
op|')'
newline|'\n'
dedent|''
name|'server'
op|'.'
name|'get_running_pids'
op|'='
name|'mock'
newline|'\n'
name|'status'
op|'='
name|'server'
op|'.'
name|'status'
op|'('
name|'pids'
op|'='
name|'pids'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'status'
op|','
number|'0'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'called'
op|')'
newline|'\n'
name|'output'
op|'='
name|'pop_stream'
op|'('
name|'f'
op|')'
op|'.'
name|'strip'
op|'('
op|')'
op|'.'
name|'splitlines'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'len'
op|'('
name|'output'
op|')'
op|','
number|'2'
op|')'
newline|'\n'
name|'for'
name|'line'
name|'in'
name|'output'
op|':'
newline|'\n'
indent|'                            '
name|'self'
op|'.'
name|'assert_'
op|'('
string|"'test-server running'"
name|'in'
name|'line'
op|')'
newline|'\n'
dedent|''
dedent|''
dedent|''
name|'finally'
op|':'
newline|'\n'
indent|'                    '
name|'sys'
op|'.'
name|'stdout'
op|'='
name|'old_stdout'
newline|'\n'
nl|'\n'
comment|'#TODO: more tests'
nl|'\n'
DECL|member|test_spawn
dedent|''
dedent|''
dedent|''
dedent|''
name|'def'
name|'test_spawn'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'pass'
newline|'\n'
nl|'\n'
DECL|member|test_wait
dedent|''
name|'def'
name|'test_wait'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'pass'
newline|'\n'
nl|'\n'
DECL|member|test_interact
dedent|''
name|'def'
name|'test_interact'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'pass'
newline|'\n'
nl|'\n'
DECL|member|test_launch
dedent|''
name|'def'
name|'test_launch'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'pass'
newline|'\n'
nl|'\n'
DECL|member|test_stop
dedent|''
name|'def'
name|'test_stop'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'pass'
newline|'\n'
nl|'\n'
nl|'\n'
comment|'#TODO: test SwiftInit class'
nl|'\n'
DECL|class|TestSwiftInitClass
dedent|''
dedent|''
name|'class'
name|'TestSwiftInitClass'
op|'('
name|'unittest'
op|'.'
name|'TestCase'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|member|test_placeholder
indent|'    '
name|'def'
name|'test_placeholder'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'pass'
newline|'\n'
nl|'\n'
nl|'\n'
comment|'#TODO: test main'
nl|'\n'
DECL|class|TestMain
dedent|''
dedent|''
name|'class'
name|'TestMain'
op|'('
name|'unittest'
op|'.'
name|'TestCase'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|member|test_placeholder
indent|'    '
name|'def'
name|'test_placeholder'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'pass'
newline|'\n'
nl|'\n'
nl|'\n'
dedent|''
dedent|''
name|'if'
name|'__name__'
op|'=='
string|"'__main__'"
op|':'
newline|'\n'
indent|'    '
name|'unittest'
op|'.'
name|'main'
op|'('
op|')'
newline|'\n'
dedent|''
endmarker|''
end_unit
