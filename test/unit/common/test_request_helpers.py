begin_unit
comment|'# Copyright (c) 2010-2012 OpenStack Foundation'
nl|'\n'
comment|'#'
nl|'\n'
comment|'# Licensed under the Apache License, Version 2.0 (the "License");'
nl|'\n'
comment|'# you may not use this file except in compliance with the License.'
nl|'\n'
comment|'# You may obtain a copy of the License at'
nl|'\n'
comment|'#'
nl|'\n'
comment|'#    http://www.apache.org/licenses/LICENSE-2.0'
nl|'\n'
comment|'#'
nl|'\n'
comment|'# Unless required by applicable law or agreed to in writing, software'
nl|'\n'
comment|'# distributed under the License is distributed on an "AS IS" BASIS,'
nl|'\n'
comment|'# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or'
nl|'\n'
comment|'# implied.'
nl|'\n'
comment|'# See the License for the specific language governing permissions and'
nl|'\n'
comment|'# limitations under the License.'
nl|'\n'
nl|'\n'
string|'"""Tests for swift.common.request_helpers"""'
newline|'\n'
nl|'\n'
name|'import'
name|'unittest'
newline|'\n'
name|'from'
name|'swift'
op|'.'
name|'common'
op|'.'
name|'swob'
name|'import'
name|'Request'
op|','
name|'HTTPException'
newline|'\n'
name|'from'
name|'swift'
op|'.'
name|'common'
op|'.'
name|'storage_policy'
name|'import'
name|'POLICIES'
op|','
name|'EC_POLICY'
op|','
name|'REPL_POLICY'
newline|'\n'
name|'from'
name|'swift'
op|'.'
name|'common'
op|'.'
name|'request_helpers'
name|'import'
name|'is_sys_meta'
op|','
name|'is_user_meta'
op|','
name|'is_sys_or_user_meta'
op|','
name|'strip_sys_meta_prefix'
op|','
name|'strip_user_meta_prefix'
op|','
name|'remove_items'
op|','
name|'copy_header_subset'
op|','
name|'get_name_and_placement'
newline|'\n'
nl|'\n'
name|'from'
name|'test'
op|'.'
name|'unit'
name|'import'
name|'patch_policies'
newline|'\n'
nl|'\n'
DECL|variable|server_types
name|'server_types'
op|'='
op|'['
string|"'account'"
op|','
string|"'container'"
op|','
string|"'object'"
op|']'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|TestRequestHelpers
name|'class'
name|'TestRequestHelpers'
op|'('
name|'unittest'
op|'.'
name|'TestCase'
op|')'
op|':'
newline|'\n'
DECL|member|test_is_user_meta
indent|'    '
name|'def'
name|'test_is_user_meta'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'m_type'
op|'='
string|"'meta'"
newline|'\n'
name|'for'
name|'st'
name|'in'
name|'server_types'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'is_user_meta'
op|'('
name|'st'
op|','
string|"'x-%s-%s-foo'"
op|'%'
op|'('
name|'st'
op|','
name|'m_type'
op|')'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'is_user_meta'
op|'('
name|'st'
op|','
string|"'x-%s-%s-'"
op|'%'
op|'('
name|'st'
op|','
name|'m_type'
op|')'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'is_user_meta'
op|'('
name|'st'
op|','
string|"'x-%s-%sfoo'"
op|'%'
op|'('
name|'st'
op|','
name|'m_type'
op|')'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_is_sys_meta
dedent|''
dedent|''
name|'def'
name|'test_is_sys_meta'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'m_type'
op|'='
string|"'sysmeta'"
newline|'\n'
name|'for'
name|'st'
name|'in'
name|'server_types'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'is_sys_meta'
op|'('
name|'st'
op|','
string|"'x-%s-%s-foo'"
op|'%'
op|'('
name|'st'
op|','
name|'m_type'
op|')'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'is_sys_meta'
op|'('
name|'st'
op|','
string|"'x-%s-%s-'"
op|'%'
op|'('
name|'st'
op|','
name|'m_type'
op|')'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'is_sys_meta'
op|'('
name|'st'
op|','
string|"'x-%s-%sfoo'"
op|'%'
op|'('
name|'st'
op|','
name|'m_type'
op|')'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_is_sys_or_user_meta
dedent|''
dedent|''
name|'def'
name|'test_is_sys_or_user_meta'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'m_types'
op|'='
op|'['
string|"'sysmeta'"
op|','
string|"'meta'"
op|']'
newline|'\n'
name|'for'
name|'mt'
name|'in'
name|'m_types'
op|':'
newline|'\n'
indent|'            '
name|'for'
name|'st'
name|'in'
name|'server_types'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'is_sys_or_user_meta'
op|'('
name|'st'
op|','
string|"'x-%s-%s-foo'"
nl|'\n'
op|'%'
op|'('
name|'st'
op|','
name|'mt'
op|')'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'is_sys_or_user_meta'
op|'('
name|'st'
op|','
string|"'x-%s-%s-'"
nl|'\n'
op|'%'
op|'('
name|'st'
op|','
name|'mt'
op|')'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'is_sys_or_user_meta'
op|'('
name|'st'
op|','
string|"'x-%s-%sfoo'"
nl|'\n'
op|'%'
op|'('
name|'st'
op|','
name|'mt'
op|')'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_strip_sys_meta_prefix
dedent|''
dedent|''
dedent|''
name|'def'
name|'test_strip_sys_meta_prefix'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'mt'
op|'='
string|"'sysmeta'"
newline|'\n'
name|'for'
name|'st'
name|'in'
name|'server_types'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'strip_sys_meta_prefix'
op|'('
name|'st'
op|','
string|"'x-%s-%s-a'"
nl|'\n'
op|'%'
op|'('
name|'st'
op|','
name|'mt'
op|')'
op|')'
op|','
string|"'a'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_strip_user_meta_prefix
dedent|''
dedent|''
name|'def'
name|'test_strip_user_meta_prefix'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'mt'
op|'='
string|"'meta'"
newline|'\n'
name|'for'
name|'st'
name|'in'
name|'server_types'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'strip_user_meta_prefix'
op|'('
name|'st'
op|','
string|"'x-%s-%s-a'"
nl|'\n'
op|'%'
op|'('
name|'st'
op|','
name|'mt'
op|')'
op|')'
op|','
string|"'a'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_remove_items
dedent|''
dedent|''
name|'def'
name|'test_remove_items'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'src'
op|'='
op|'{'
string|"'a'"
op|':'
string|"'b'"
op|','
nl|'\n'
string|"'c'"
op|':'
string|"'d'"
op|'}'
newline|'\n'
name|'test'
op|'='
name|'lambda'
name|'x'
op|':'
name|'x'
op|'=='
string|"'a'"
newline|'\n'
name|'rem'
op|'='
name|'remove_items'
op|'('
name|'src'
op|','
name|'test'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'src'
op|','
op|'{'
string|"'c'"
op|':'
string|"'d'"
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'rem'
op|','
op|'{'
string|"'a'"
op|':'
string|"'b'"
op|'}'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_copy_header_subset
dedent|''
name|'def'
name|'test_copy_header_subset'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'src'
op|'='
op|'{'
string|"'a'"
op|':'
string|"'b'"
op|','
nl|'\n'
string|"'c'"
op|':'
string|"'d'"
op|'}'
newline|'\n'
name|'from_req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/path'"
op|','
name|'environ'
op|'='
op|'{'
op|'}'
op|','
name|'headers'
op|'='
name|'src'
op|')'
newline|'\n'
name|'to_req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/path'"
op|','
op|'{'
op|'}'
op|')'
newline|'\n'
name|'test'
op|'='
name|'lambda'
name|'x'
op|':'
name|'x'
op|'.'
name|'lower'
op|'('
op|')'
op|'=='
string|"'a'"
newline|'\n'
name|'copy_header_subset'
op|'('
name|'from_req'
op|','
name|'to_req'
op|','
name|'test'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
string|"'A'"
name|'in'
name|'to_req'
op|'.'
name|'headers'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'to_req'
op|'.'
name|'headers'
op|'['
string|"'A'"
op|']'
op|','
string|"'b'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
string|"'c'"
name|'in'
name|'to_req'
op|'.'
name|'headers'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
string|"'C'"
name|'in'
name|'to_req'
op|'.'
name|'headers'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'patch_policies'
op|'('
name|'with_ec_default'
op|'='
name|'True'
op|')'
newline|'\n'
DECL|member|test_get_name_and_placement_object_req
name|'def'
name|'test_get_name_and_placement_object_req'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'path'
op|'='
string|"'/device/part/account/container/object'"
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
name|'path'
op|','
name|'headers'
op|'='
op|'{'
nl|'\n'
string|"'X-Backend-Storage-Policy-Index'"
op|':'
string|"'0'"
op|'}'
op|')'
newline|'\n'
name|'device'
op|','
name|'part'
op|','
name|'account'
op|','
name|'container'
op|','
name|'obj'
op|','
name|'policy'
op|'='
name|'get_name_and_placement'
op|'('
name|'req'
op|','
number|'5'
op|','
number|'5'
op|','
name|'True'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'device'
op|','
string|"'device'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'part'
op|','
string|"'part'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'account'
op|','
string|"'account'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'container'
op|','
string|"'container'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'obj'
op|','
string|"'object'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'policy'
op|','
name|'POLICIES'
op|'['
number|'0'
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'policy'
op|'.'
name|'policy_type'
op|','
name|'EC_POLICY'
op|')'
newline|'\n'
nl|'\n'
name|'req'
op|'.'
name|'headers'
op|'['
string|"'X-Backend-Storage-Policy-Index'"
op|']'
op|'='
number|'1'
newline|'\n'
name|'device'
op|','
name|'part'
op|','
name|'account'
op|','
name|'container'
op|','
name|'obj'
op|','
name|'policy'
op|'='
name|'get_name_and_placement'
op|'('
name|'req'
op|','
number|'5'
op|','
number|'5'
op|','
name|'True'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'device'
op|','
string|"'device'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'part'
op|','
string|"'part'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'account'
op|','
string|"'account'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'container'
op|','
string|"'container'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'obj'
op|','
string|"'object'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'policy'
op|','
name|'POLICIES'
op|'['
number|'1'
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'policy'
op|'.'
name|'policy_type'
op|','
name|'REPL_POLICY'
op|')'
newline|'\n'
nl|'\n'
name|'req'
op|'.'
name|'headers'
op|'['
string|"'X-Backend-Storage-Policy-Index'"
op|']'
op|'='
string|"'foo'"
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'device'
op|','
name|'part'
op|','
name|'account'
op|','
name|'container'
op|','
name|'obj'
op|','
name|'policy'
op|'='
name|'get_name_and_placement'
op|'('
name|'req'
op|','
number|'5'
op|','
number|'5'
op|','
name|'True'
op|')'
newline|'\n'
dedent|''
name|'except'
name|'HTTPException'
name|'as'
name|'e'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'e'
op|'.'
name|'status_int'
op|','
number|'503'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'str'
op|'('
name|'e'
op|')'
op|','
string|"'503 Service Unavailable'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'e'
op|'.'
name|'body'
op|','
string|'"No policy with index foo"'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'fail'
op|'('
string|"'get_name_and_placement did not raise error '"
nl|'\n'
string|"'for invalid storage policy index'"
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
op|'@'
name|'patch_policies'
op|'('
name|'with_ec_default'
op|'='
name|'True'
op|')'
newline|'\n'
DECL|member|test_get_name_and_placement_object_replication
name|'def'
name|'test_get_name_and_placement_object_replication'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|"# yup, suffixes are sent '-'.joined in the path"
nl|'\n'
indent|'        '
name|'path'
op|'='
string|"'/device/part/012-345-678-9ab-cde'"
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
name|'path'
op|','
name|'headers'
op|'='
op|'{'
nl|'\n'
string|"'X-Backend-Storage-Policy-Index'"
op|':'
string|"'0'"
op|'}'
op|')'
newline|'\n'
name|'device'
op|','
name|'partition'
op|','
name|'suffix_parts'
op|','
name|'policy'
op|'='
name|'get_name_and_placement'
op|'('
name|'req'
op|','
number|'2'
op|','
number|'3'
op|','
name|'True'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'device'
op|','
string|"'device'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'partition'
op|','
string|"'part'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'suffix_parts'
op|','
string|"'012-345-678-9ab-cde'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'policy'
op|','
name|'POLICIES'
op|'['
number|'0'
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'policy'
op|'.'
name|'policy_type'
op|','
name|'EC_POLICY'
op|')'
newline|'\n'
nl|'\n'
name|'path'
op|'='
string|"'/device/part'"
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
name|'path'
op|','
name|'headers'
op|'='
op|'{'
nl|'\n'
string|"'X-Backend-Storage-Policy-Index'"
op|':'
string|"'1'"
op|'}'
op|')'
newline|'\n'
name|'device'
op|','
name|'partition'
op|','
name|'suffix_parts'
op|','
name|'policy'
op|'='
name|'get_name_and_placement'
op|'('
name|'req'
op|','
number|'2'
op|','
number|'3'
op|','
name|'True'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'device'
op|','
string|"'device'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'partition'
op|','
string|"'part'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'suffix_parts'
op|','
name|'None'
op|')'
comment|'# false-y'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'policy'
op|','
name|'POLICIES'
op|'['
number|'1'
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'policy'
op|'.'
name|'policy_type'
op|','
name|'REPL_POLICY'
op|')'
newline|'\n'
nl|'\n'
name|'path'
op|'='
string|"'/device/part/'"
comment|'# with a trailing slash'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
name|'path'
op|','
name|'headers'
op|'='
op|'{'
nl|'\n'
string|"'X-Backend-Storage-Policy-Index'"
op|':'
string|"'1'"
op|'}'
op|')'
newline|'\n'
name|'device'
op|','
name|'partition'
op|','
name|'suffix_parts'
op|','
name|'policy'
op|'='
name|'get_name_and_placement'
op|'('
name|'req'
op|','
number|'2'
op|','
number|'3'
op|','
name|'True'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'device'
op|','
string|"'device'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'partition'
op|','
string|"'part'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'suffix_parts'
op|','
string|"''"
op|')'
comment|'# still false-y'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'policy'
op|','
name|'POLICIES'
op|'['
number|'1'
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'policy'
op|'.'
name|'policy_type'
op|','
name|'REPL_POLICY'
op|')'
newline|'\n'
dedent|''
dedent|''
endmarker|''
end_unit
