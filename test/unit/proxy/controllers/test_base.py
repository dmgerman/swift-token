begin_unit
comment|'# Copyright (c) 2010-2012 OpenStack Foundation'
nl|'\n'
comment|'#'
nl|'\n'
comment|'# Licensed under the Apache License, Version 2.0 (the "License");'
nl|'\n'
comment|'# you may not use this file except in compliance with the License.'
nl|'\n'
comment|'# You may obtain a copy of the License at'
nl|'\n'
comment|'#'
nl|'\n'
comment|'#    http://www.apache.org/licenses/LICENSE-2.0'
nl|'\n'
comment|'#'
nl|'\n'
comment|'# Unless required by applicable law or agreed to in writing, software'
nl|'\n'
comment|'# distributed under the License is distributed on an "AS IS" BASIS,'
nl|'\n'
comment|'# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or'
nl|'\n'
comment|'# implied.'
nl|'\n'
comment|'# See the License for the specific language governing permissions and'
nl|'\n'
comment|'# limitations under the License.'
nl|'\n'
nl|'\n'
name|'import'
name|'itertools'
newline|'\n'
name|'from'
name|'collections'
name|'import'
name|'defaultdict'
newline|'\n'
name|'import'
name|'unittest'
newline|'\n'
name|'from'
name|'mock'
name|'import'
name|'patch'
newline|'\n'
name|'from'
name|'swift'
op|'.'
name|'proxy'
op|'.'
name|'controllers'
op|'.'
name|'base'
name|'import'
name|'headers_to_container_info'
op|','
name|'headers_to_account_info'
op|','
name|'headers_to_object_info'
op|','
name|'get_container_info'
op|','
name|'get_container_memcache_key'
op|','
name|'get_account_info'
op|','
name|'get_account_memcache_key'
op|','
name|'get_object_env_key'
op|','
name|'get_info'
op|','
name|'get_object_info'
op|','
name|'Controller'
op|','
name|'GetOrHeadHandler'
op|','
name|'_set_info_cache'
op|','
name|'_set_object_info_cache'
op|','
name|'bytes_to_skip'
newline|'\n'
name|'from'
name|'swift'
op|'.'
name|'common'
op|'.'
name|'swob'
name|'import'
name|'Request'
op|','
name|'HTTPException'
op|','
name|'HeaderKeyDict'
op|','
name|'RESPONSE_REASONS'
newline|'\n'
name|'from'
name|'swift'
op|'.'
name|'common'
name|'import'
name|'exceptions'
newline|'\n'
name|'from'
name|'swift'
op|'.'
name|'common'
op|'.'
name|'utils'
name|'import'
name|'split_path'
newline|'\n'
name|'from'
name|'swift'
op|'.'
name|'common'
op|'.'
name|'http'
name|'import'
name|'is_success'
newline|'\n'
name|'from'
name|'swift'
op|'.'
name|'common'
op|'.'
name|'storage_policy'
name|'import'
name|'StoragePolicy'
newline|'\n'
name|'from'
name|'test'
op|'.'
name|'unit'
name|'import'
name|'fake_http_connect'
op|','
name|'FakeRing'
op|','
name|'FakeMemcache'
newline|'\n'
name|'from'
name|'swift'
op|'.'
name|'proxy'
name|'import'
name|'server'
name|'as'
name|'proxy_server'
newline|'\n'
name|'from'
name|'swift'
op|'.'
name|'common'
op|'.'
name|'request_helpers'
name|'import'
name|'get_sys_meta_prefix'
newline|'\n'
nl|'\n'
name|'from'
name|'test'
op|'.'
name|'unit'
name|'import'
name|'patch_policies'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|FakeResponse
name|'class'
name|'FakeResponse'
op|'('
name|'object'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|variable|base_headers
indent|'    '
name|'base_headers'
op|'='
op|'{'
op|'}'
newline|'\n'
nl|'\n'
DECL|member|__init__
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'status_int'
op|'='
number|'200'
op|','
name|'headers'
op|'='
name|'None'
op|','
name|'body'
op|'='
string|"''"
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'status_int'
op|'='
name|'status_int'
newline|'\n'
name|'self'
op|'.'
name|'_headers'
op|'='
name|'headers'
name|'or'
op|'{'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'body'
op|'='
name|'body'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'property'
newline|'\n'
DECL|member|headers
name|'def'
name|'headers'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'is_success'
op|'('
name|'self'
op|'.'
name|'status_int'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'_headers'
op|'.'
name|'update'
op|'('
name|'self'
op|'.'
name|'base_headers'
op|')'
newline|'\n'
dedent|''
name|'return'
name|'self'
op|'.'
name|'_headers'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|AccountResponse
dedent|''
dedent|''
name|'class'
name|'AccountResponse'
op|'('
name|'FakeResponse'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|variable|base_headers
indent|'    '
name|'base_headers'
op|'='
op|'{'
nl|'\n'
string|"'x-account-container-count'"
op|':'
number|'333'
op|','
nl|'\n'
string|"'x-account-object-count'"
op|':'
number|'1000'
op|','
nl|'\n'
string|"'x-account-bytes-used'"
op|':'
number|'6666'
op|','
nl|'\n'
op|'}'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|ContainerResponse
dedent|''
name|'class'
name|'ContainerResponse'
op|'('
name|'FakeResponse'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|variable|base_headers
indent|'    '
name|'base_headers'
op|'='
op|'{'
nl|'\n'
string|"'x-container-object-count'"
op|':'
number|'1000'
op|','
nl|'\n'
string|"'x-container-bytes-used'"
op|':'
number|'6666'
op|','
nl|'\n'
op|'}'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|ObjectResponse
dedent|''
name|'class'
name|'ObjectResponse'
op|'('
name|'FakeResponse'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|variable|base_headers
indent|'    '
name|'base_headers'
op|'='
op|'{'
nl|'\n'
string|"'content-length'"
op|':'
number|'5555'
op|','
nl|'\n'
string|"'content-type'"
op|':'
string|"'text/plain'"
nl|'\n'
op|'}'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|DynamicResponseFactory
dedent|''
name|'class'
name|'DynamicResponseFactory'
op|'('
name|'object'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|member|__init__
indent|'    '
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
op|'*'
name|'statuses'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'statuses'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'statuses'
op|'='
name|'iter'
op|'('
name|'statuses'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'statuses'
op|'='
name|'itertools'
op|'.'
name|'repeat'
op|'('
number|'200'
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'stats'
op|'='
name|'defaultdict'
op|'('
name|'int'
op|')'
newline|'\n'
nl|'\n'
DECL|variable|response_type
dedent|''
name|'response_type'
op|'='
op|'{'
nl|'\n'
string|"'obj'"
op|':'
name|'ObjectResponse'
op|','
nl|'\n'
string|"'container'"
op|':'
name|'ContainerResponse'
op|','
nl|'\n'
string|"'account'"
op|':'
name|'AccountResponse'
op|','
nl|'\n'
op|'}'
newline|'\n'
nl|'\n'
DECL|member|_get_response
name|'def'
name|'_get_response'
op|'('
name|'self'
op|','
name|'type_'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'stats'
op|'['
name|'type_'
op|']'
op|'+='
number|'1'
newline|'\n'
name|'class_'
op|'='
name|'self'
op|'.'
name|'response_type'
op|'['
name|'type_'
op|']'
newline|'\n'
name|'return'
name|'class_'
op|'('
name|'next'
op|'('
name|'self'
op|'.'
name|'statuses'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|get_response
dedent|''
name|'def'
name|'get_response'
op|'('
name|'self'
op|','
name|'environ'
op|')'
op|':'
newline|'\n'
indent|'        '
op|'('
name|'version'
op|','
name|'account'
op|','
name|'container'
op|','
name|'obj'
op|')'
op|'='
name|'split_path'
op|'('
nl|'\n'
name|'environ'
op|'['
string|"'PATH_INFO'"
op|']'
op|','
number|'2'
op|','
number|'4'
op|','
name|'True'
op|')'
newline|'\n'
name|'if'
name|'obj'
op|':'
newline|'\n'
indent|'            '
name|'resp'
op|'='
name|'self'
op|'.'
name|'_get_response'
op|'('
string|"'obj'"
op|')'
newline|'\n'
dedent|''
name|'elif'
name|'container'
op|':'
newline|'\n'
indent|'            '
name|'resp'
op|'='
name|'self'
op|'.'
name|'_get_response'
op|'('
string|"'container'"
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'resp'
op|'='
name|'self'
op|'.'
name|'_get_response'
op|'('
string|"'account'"
op|')'
newline|'\n'
dedent|''
name|'resp'
op|'.'
name|'account'
op|'='
name|'account'
newline|'\n'
name|'resp'
op|'.'
name|'container'
op|'='
name|'container'
newline|'\n'
name|'resp'
op|'.'
name|'obj'
op|'='
name|'obj'
newline|'\n'
name|'return'
name|'resp'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|FakeApp
dedent|''
dedent|''
name|'class'
name|'FakeApp'
op|'('
name|'object'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|variable|recheck_container_existence
indent|'    '
name|'recheck_container_existence'
op|'='
number|'30'
newline|'\n'
DECL|variable|recheck_account_existence
name|'recheck_account_existence'
op|'='
number|'30'
newline|'\n'
nl|'\n'
DECL|member|__init__
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'response_factory'
op|'='
name|'None'
op|','
name|'statuses'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'responses'
op|'='
name|'response_factory'
name|'or'
name|'DynamicResponseFactory'
op|'('
op|'*'
name|'statuses'
name|'or'
op|'['
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'sources'
op|'='
op|'['
op|']'
newline|'\n'
nl|'\n'
DECL|member|__call__
dedent|''
name|'def'
name|'__call__'
op|'('
name|'self'
op|','
name|'environ'
op|','
name|'start_response'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'sources'
op|'.'
name|'append'
op|'('
name|'environ'
op|'.'
name|'get'
op|'('
string|"'swift.source'"
op|')'
op|')'
newline|'\n'
name|'response'
op|'='
name|'self'
op|'.'
name|'responses'
op|'.'
name|'get_response'
op|'('
name|'environ'
op|')'
newline|'\n'
name|'reason'
op|'='
name|'RESPONSE_REASONS'
op|'['
name|'response'
op|'.'
name|'status_int'
op|']'
op|'['
number|'0'
op|']'
newline|'\n'
name|'start_response'
op|'('
string|"'%d %s'"
op|'%'
op|'('
name|'response'
op|'.'
name|'status_int'
op|','
name|'reason'
op|')'
op|','
nl|'\n'
op|'['
op|'('
name|'k'
op|','
name|'v'
op|')'
name|'for'
name|'k'
op|','
name|'v'
name|'in'
name|'response'
op|'.'
name|'headers'
op|'.'
name|'items'
op|'('
op|')'
op|']'
op|')'
newline|'\n'
comment|"# It's a bit strange, but the get_info cache stuff relies on the"
nl|'\n'
comment|'# app setting some keys in the environment as it makes requests'
nl|'\n'
comment|'# (in particular GETorHEAD_base) - so our fake does the same'
nl|'\n'
name|'_set_info_cache'
op|'('
name|'self'
op|','
name|'environ'
op|','
name|'response'
op|'.'
name|'account'
op|','
nl|'\n'
name|'response'
op|'.'
name|'container'
op|','
name|'response'
op|')'
newline|'\n'
name|'if'
name|'response'
op|'.'
name|'obj'
op|':'
newline|'\n'
indent|'            '
name|'_set_object_info_cache'
op|'('
name|'self'
op|','
name|'environ'
op|','
name|'response'
op|'.'
name|'account'
op|','
nl|'\n'
name|'response'
op|'.'
name|'container'
op|','
name|'response'
op|'.'
name|'obj'
op|','
nl|'\n'
name|'response'
op|')'
newline|'\n'
dedent|''
name|'return'
name|'iter'
op|'('
name|'response'
op|'.'
name|'body'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|FakeCache
dedent|''
dedent|''
name|'class'
name|'FakeCache'
op|'('
name|'FakeMemcache'
op|')'
op|':'
newline|'\n'
DECL|member|__init__
indent|'    '
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'stub'
op|'='
name|'None'
op|','
op|'**'
name|'pre_cached'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'super'
op|'('
name|'FakeCache'
op|','
name|'self'
op|')'
op|'.'
name|'__init__'
op|'('
op|')'
newline|'\n'
name|'if'
name|'pre_cached'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'store'
op|'.'
name|'update'
op|'('
name|'pre_cached'
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'stub'
op|'='
name|'stub'
newline|'\n'
nl|'\n'
DECL|member|get
dedent|''
name|'def'
name|'get'
op|'('
name|'self'
op|','
name|'key'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'self'
op|'.'
name|'stub'
name|'or'
name|'self'
op|'.'
name|'store'
op|'.'
name|'get'
op|'('
name|'key'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
dedent|''
dedent|''
op|'@'
name|'patch_policies'
op|'('
op|'['
name|'StoragePolicy'
op|'('
number|'0'
op|','
string|"'zero'"
op|','
name|'True'
op|','
name|'object_ring'
op|'='
name|'FakeRing'
op|'('
op|')'
op|')'
op|']'
op|')'
newline|'\n'
DECL|class|TestFuncs
name|'class'
name|'TestFuncs'
op|'('
name|'unittest'
op|'.'
name|'TestCase'
op|')'
op|':'
newline|'\n'
DECL|member|setUp
indent|'    '
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'app'
op|'='
name|'proxy_server'
op|'.'
name|'Application'
op|'('
name|'None'
op|','
name|'FakeMemcache'
op|'('
op|')'
op|','
nl|'\n'
name|'account_ring'
op|'='
name|'FakeRing'
op|'('
op|')'
op|','
nl|'\n'
name|'container_ring'
op|'='
name|'FakeRing'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_GETorHEAD_base
dedent|''
name|'def'
name|'test_GETorHEAD_base'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'base'
op|'='
name|'Controller'
op|'('
name|'self'
op|'.'
name|'app'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/v1/a/c/o/with/slashes'"
op|')'
newline|'\n'
name|'ring'
op|'='
name|'FakeRing'
op|'('
op|')'
newline|'\n'
name|'nodes'
op|'='
name|'list'
op|'('
name|'ring'
op|'.'
name|'get_part_nodes'
op|'('
number|'0'
op|')'
op|')'
op|'+'
name|'list'
op|'('
name|'ring'
op|'.'
name|'get_more_nodes'
op|'('
number|'0'
op|')'
op|')'
newline|'\n'
name|'with'
name|'patch'
op|'('
string|"'swift.proxy.controllers.base.'"
nl|'\n'
string|"'http_connect'"
op|','
name|'fake_http_connect'
op|'('
number|'200'
op|')'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'resp'
op|'='
name|'base'
op|'.'
name|'GETorHEAD_base'
op|'('
name|'req'
op|','
string|"'object'"
op|','
name|'iter'
op|'('
name|'nodes'
op|')'
op|','
string|"'part'"
op|','
nl|'\n'
string|"'/a/c/o/with/slashes'"
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertTrue'
op|'('
string|"'swift.object/a/c/o/with/slashes'"
name|'in'
name|'resp'
op|'.'
name|'environ'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
nl|'\n'
name|'resp'
op|'.'
name|'environ'
op|'['
string|"'swift.object/a/c/o/with/slashes'"
op|']'
op|'['
string|"'status'"
op|']'
op|','
number|'200'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/v1/a/c/o'"
op|')'
newline|'\n'
name|'with'
name|'patch'
op|'('
string|"'swift.proxy.controllers.base.'"
nl|'\n'
string|"'http_connect'"
op|','
name|'fake_http_connect'
op|'('
number|'200'
op|')'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'resp'
op|'='
name|'base'
op|'.'
name|'GETorHEAD_base'
op|'('
name|'req'
op|','
string|"'object'"
op|','
name|'iter'
op|'('
name|'nodes'
op|')'
op|','
string|"'part'"
op|','
nl|'\n'
string|"'/a/c/o'"
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertTrue'
op|'('
string|"'swift.object/a/c/o'"
name|'in'
name|'resp'
op|'.'
name|'environ'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'environ'
op|'['
string|"'swift.object/a/c/o'"
op|']'
op|'['
string|"'status'"
op|']'
op|','
number|'200'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/v1/a/c'"
op|')'
newline|'\n'
name|'with'
name|'patch'
op|'('
string|"'swift.proxy.controllers.base.'"
nl|'\n'
string|"'http_connect'"
op|','
name|'fake_http_connect'
op|'('
number|'200'
op|')'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'resp'
op|'='
name|'base'
op|'.'
name|'GETorHEAD_base'
op|'('
name|'req'
op|','
string|"'container'"
op|','
name|'iter'
op|'('
name|'nodes'
op|')'
op|','
string|"'part'"
op|','
nl|'\n'
string|"'/a/c'"
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertTrue'
op|'('
string|"'swift.container/a/c'"
name|'in'
name|'resp'
op|'.'
name|'environ'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'environ'
op|'['
string|"'swift.container/a/c'"
op|']'
op|'['
string|"'status'"
op|']'
op|','
number|'200'
op|')'
newline|'\n'
nl|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/v1/a'"
op|')'
newline|'\n'
name|'with'
name|'patch'
op|'('
string|"'swift.proxy.controllers.base.'"
nl|'\n'
string|"'http_connect'"
op|','
name|'fake_http_connect'
op|'('
number|'200'
op|')'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'resp'
op|'='
name|'base'
op|'.'
name|'GETorHEAD_base'
op|'('
name|'req'
op|','
string|"'account'"
op|','
name|'iter'
op|'('
name|'nodes'
op|')'
op|','
string|"'part'"
op|','
nl|'\n'
string|"'/a'"
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertTrue'
op|'('
string|"'swift.account/a'"
name|'in'
name|'resp'
op|'.'
name|'environ'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'environ'
op|'['
string|"'swift.account/a'"
op|']'
op|'['
string|"'status'"
op|']'
op|','
number|'200'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_info
dedent|''
name|'def'
name|'test_get_info'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'app'
op|'='
name|'FakeApp'
op|'('
op|')'
newline|'\n'
comment|'# Do a non cached call to account'
nl|'\n'
name|'env'
op|'='
op|'{'
op|'}'
newline|'\n'
name|'info_a'
op|'='
name|'get_info'
op|'('
name|'app'
op|','
name|'env'
op|','
string|"'a'"
op|')'
newline|'\n'
comment|'# Check that you got proper info'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'info_a'
op|'['
string|"'status'"
op|']'
op|','
number|'200'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'info_a'
op|'['
string|"'bytes'"
op|']'
op|','
number|'6666'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'info_a'
op|'['
string|"'total_object_count'"
op|']'
op|','
number|'1000'
op|')'
newline|'\n'
comment|'# Make sure the env cache is set'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'env'
op|'.'
name|'get'
op|'('
string|"'swift.account/a'"
op|')'
op|','
name|'info_a'
op|')'
newline|'\n'
comment|'# Make sure the app was called'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'app'
op|'.'
name|'responses'
op|'.'
name|'stats'
op|'['
string|"'account'"
op|']'
op|','
number|'1'
op|')'
newline|'\n'
nl|'\n'
comment|'# Do an env cached call to account'
nl|'\n'
name|'info_a'
op|'='
name|'get_info'
op|'('
name|'app'
op|','
name|'env'
op|','
string|"'a'"
op|')'
newline|'\n'
comment|'# Check that you got proper info'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'info_a'
op|'['
string|"'status'"
op|']'
op|','
number|'200'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'info_a'
op|'['
string|"'bytes'"
op|']'
op|','
number|'6666'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'info_a'
op|'['
string|"'total_object_count'"
op|']'
op|','
number|'1000'
op|')'
newline|'\n'
comment|'# Make sure the env cache is set'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'env'
op|'.'
name|'get'
op|'('
string|"'swift.account/a'"
op|')'
op|','
name|'info_a'
op|')'
newline|'\n'
comment|'# Make sure the app was NOT called AGAIN'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'app'
op|'.'
name|'responses'
op|'.'
name|'stats'
op|'['
string|"'account'"
op|']'
op|','
number|'1'
op|')'
newline|'\n'
nl|'\n'
comment|'# This time do env cached call to account and non cached to container'
nl|'\n'
name|'info_c'
op|'='
name|'get_info'
op|'('
name|'app'
op|','
name|'env'
op|','
string|"'a'"
op|','
string|"'c'"
op|')'
newline|'\n'
comment|'# Check that you got proper info'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'info_c'
op|'['
string|"'status'"
op|']'
op|','
number|'200'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'info_c'
op|'['
string|"'bytes'"
op|']'
op|','
number|'6666'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'info_c'
op|'['
string|"'object_count'"
op|']'
op|','
number|'1000'
op|')'
newline|'\n'
comment|'# Make sure the env cache is set'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'env'
op|'.'
name|'get'
op|'('
string|"'swift.account/a'"
op|')'
op|','
name|'info_a'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'env'
op|'.'
name|'get'
op|'('
string|"'swift.container/a/c'"
op|')'
op|','
name|'info_c'
op|')'
newline|'\n'
comment|'# Make sure the app was called for container'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'app'
op|'.'
name|'responses'
op|'.'
name|'stats'
op|'['
string|"'container'"
op|']'
op|','
number|'1'
op|')'
newline|'\n'
nl|'\n'
comment|'# This time do a non cached call to account than non cached to'
nl|'\n'
comment|'# container'
nl|'\n'
name|'app'
op|'='
name|'FakeApp'
op|'('
op|')'
newline|'\n'
name|'env'
op|'='
op|'{'
op|'}'
comment|'# abandon previous call to env'
newline|'\n'
name|'info_c'
op|'='
name|'get_info'
op|'('
name|'app'
op|','
name|'env'
op|','
string|"'a'"
op|','
string|"'c'"
op|')'
newline|'\n'
comment|'# Check that you got proper info'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'info_c'
op|'['
string|"'status'"
op|']'
op|','
number|'200'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'info_c'
op|'['
string|"'bytes'"
op|']'
op|','
number|'6666'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'info_c'
op|'['
string|"'object_count'"
op|']'
op|','
number|'1000'
op|')'
newline|'\n'
comment|'# Make sure the env cache is set'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'env'
op|'.'
name|'get'
op|'('
string|"'swift.account/a'"
op|')'
op|','
name|'info_a'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'env'
op|'.'
name|'get'
op|'('
string|"'swift.container/a/c'"
op|')'
op|','
name|'info_c'
op|')'
newline|'\n'
comment|'# check app calls both account and container'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'app'
op|'.'
name|'responses'
op|'.'
name|'stats'
op|'['
string|"'account'"
op|']'
op|','
number|'1'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'app'
op|'.'
name|'responses'
op|'.'
name|'stats'
op|'['
string|"'container'"
op|']'
op|','
number|'1'
op|')'
newline|'\n'
nl|'\n'
comment|'# This time do an env cached call to container while account is not'
nl|'\n'
comment|'# cached'
nl|'\n'
name|'del'
op|'('
name|'env'
op|'['
string|"'swift.account/a'"
op|']'
op|')'
newline|'\n'
name|'info_c'
op|'='
name|'get_info'
op|'('
name|'app'
op|','
name|'env'
op|','
string|"'a'"
op|','
string|"'c'"
op|')'
newline|'\n'
comment|'# Check that you got proper info'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'info_a'
op|'['
string|"'status'"
op|']'
op|','
number|'200'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'info_c'
op|'['
string|"'bytes'"
op|']'
op|','
number|'6666'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'info_c'
op|'['
string|"'object_count'"
op|']'
op|','
number|'1000'
op|')'
newline|'\n'
comment|'# Make sure the env cache is set and account still not cached'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'env'
op|'.'
name|'get'
op|'('
string|"'swift.container/a/c'"
op|')'
op|','
name|'info_c'
op|')'
newline|'\n'
comment|'# no additional calls were made'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'app'
op|'.'
name|'responses'
op|'.'
name|'stats'
op|'['
string|"'account'"
op|']'
op|','
number|'1'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'app'
op|'.'
name|'responses'
op|'.'
name|'stats'
op|'['
string|"'container'"
op|']'
op|','
number|'1'
op|')'
newline|'\n'
nl|'\n'
comment|'# Do a non cached call to account not found with ret_not_found'
nl|'\n'
name|'app'
op|'='
name|'FakeApp'
op|'('
name|'statuses'
op|'='
op|'('
number|'404'
op|','
op|')'
op|')'
newline|'\n'
name|'env'
op|'='
op|'{'
op|'}'
newline|'\n'
name|'info_a'
op|'='
name|'get_info'
op|'('
name|'app'
op|','
name|'env'
op|','
string|"'a'"
op|','
name|'ret_not_found'
op|'='
name|'True'
op|')'
newline|'\n'
comment|'# Check that you got proper info'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'info_a'
op|'['
string|"'status'"
op|']'
op|','
number|'404'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'info_a'
op|'['
string|"'bytes'"
op|']'
op|','
name|'None'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'info_a'
op|'['
string|"'total_object_count'"
op|']'
op|','
name|'None'
op|')'
newline|'\n'
comment|'# Make sure the env cache is set'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'env'
op|'.'
name|'get'
op|'('
string|"'swift.account/a'"
op|')'
op|','
name|'info_a'
op|')'
newline|'\n'
comment|'# and account was called'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'app'
op|'.'
name|'responses'
op|'.'
name|'stats'
op|'['
string|"'account'"
op|']'
op|','
number|'1'
op|')'
newline|'\n'
nl|'\n'
comment|'# Do a cached call to account not found with ret_not_found'
nl|'\n'
name|'info_a'
op|'='
name|'get_info'
op|'('
name|'app'
op|','
name|'env'
op|','
string|"'a'"
op|','
name|'ret_not_found'
op|'='
name|'True'
op|')'
newline|'\n'
comment|'# Check that you got proper info'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'info_a'
op|'['
string|"'status'"
op|']'
op|','
number|'404'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'info_a'
op|'['
string|"'bytes'"
op|']'
op|','
name|'None'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'info_a'
op|'['
string|"'total_object_count'"
op|']'
op|','
name|'None'
op|')'
newline|'\n'
comment|'# Make sure the env cache is set'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'env'
op|'.'
name|'get'
op|'('
string|"'swift.account/a'"
op|')'
op|','
name|'info_a'
op|')'
newline|'\n'
comment|'# add account was NOT called AGAIN'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'app'
op|'.'
name|'responses'
op|'.'
name|'stats'
op|'['
string|"'account'"
op|']'
op|','
number|'1'
op|')'
newline|'\n'
nl|'\n'
comment|'# Do a non cached call to account not found without ret_not_found'
nl|'\n'
name|'app'
op|'='
name|'FakeApp'
op|'('
name|'statuses'
op|'='
op|'('
number|'404'
op|','
op|')'
op|')'
newline|'\n'
name|'env'
op|'='
op|'{'
op|'}'
newline|'\n'
name|'info_a'
op|'='
name|'get_info'
op|'('
name|'app'
op|','
name|'env'
op|','
string|"'a'"
op|')'
newline|'\n'
comment|'# Check that you got proper info'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'info_a'
op|','
name|'None'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'env'
op|'['
string|"'swift.account/a'"
op|']'
op|'['
string|"'status'"
op|']'
op|','
number|'404'
op|')'
newline|'\n'
comment|'# and account was called'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'app'
op|'.'
name|'responses'
op|'.'
name|'stats'
op|'['
string|"'account'"
op|']'
op|','
number|'1'
op|')'
newline|'\n'
nl|'\n'
comment|'# Do a cached call to account not found without ret_not_found'
nl|'\n'
name|'info_a'
op|'='
name|'get_info'
op|'('
name|'None'
op|','
name|'env'
op|','
string|"'a'"
op|')'
newline|'\n'
comment|'# Check that you got proper info'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'info_a'
op|','
name|'None'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'env'
op|'['
string|"'swift.account/a'"
op|']'
op|'['
string|"'status'"
op|']'
op|','
number|'404'
op|')'
newline|'\n'
comment|'# add account was NOT called AGAIN'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'app'
op|'.'
name|'responses'
op|'.'
name|'stats'
op|'['
string|"'account'"
op|']'
op|','
number|'1'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_container_info_swift_source
dedent|''
name|'def'
name|'test_get_container_info_swift_source'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'app'
op|'='
name|'FakeApp'
op|'('
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|'"/v1/a/c"'
op|','
name|'environ'
op|'='
op|'{'
string|"'swift.cache'"
op|':'
name|'FakeCache'
op|'('
op|')'
op|'}'
op|')'
newline|'\n'
name|'get_container_info'
op|'('
name|'req'
op|'.'
name|'environ'
op|','
name|'app'
op|','
name|'swift_source'
op|'='
string|"'MC'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'app'
op|'.'
name|'sources'
op|','
op|'['
string|"'GET_INFO'"
op|','
string|"'MC'"
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_object_info_swift_source
dedent|''
name|'def'
name|'test_get_object_info_swift_source'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'app'
op|'='
name|'FakeApp'
op|'('
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|'"/v1/a/c/o"'
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'swift.cache'"
op|':'
name|'FakeCache'
op|'('
op|')'
op|'}'
op|')'
newline|'\n'
name|'get_object_info'
op|'('
name|'req'
op|'.'
name|'environ'
op|','
name|'app'
op|','
name|'swift_source'
op|'='
string|"'LU'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'app'
op|'.'
name|'sources'
op|','
op|'['
string|"'LU'"
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_container_info_no_cache
dedent|''
name|'def'
name|'test_get_container_info_no_cache'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|'"/v1/AUTH_account/cont"'
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'swift.cache'"
op|':'
name|'FakeCache'
op|'('
op|'{'
op|'}'
op|')'
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'get_container_info'
op|'('
name|'req'
op|'.'
name|'environ'
op|','
name|'FakeApp'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'['
string|"'storage_policy'"
op|']'
op|','
string|"'0'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'['
string|"'bytes'"
op|']'
op|','
number|'6666'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'['
string|"'object_count'"
op|']'
op|','
number|'1000'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_container_info_no_account
dedent|''
name|'def'
name|'test_get_container_info_no_account'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'responses'
op|'='
name|'DynamicResponseFactory'
op|'('
number|'404'
op|','
number|'200'
op|')'
newline|'\n'
name|'app'
op|'='
name|'FakeApp'
op|'('
name|'responses'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|'"/v1/AUTH_does_not_exist/cont"'
op|')'
newline|'\n'
name|'info'
op|'='
name|'get_container_info'
op|'('
name|'req'
op|'.'
name|'environ'
op|','
name|'app'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'info'
op|'['
string|"'status'"
op|']'
op|','
number|'0'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_container_info_no_auto_account
dedent|''
name|'def'
name|'test_get_container_info_no_auto_account'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'responses'
op|'='
name|'DynamicResponseFactory'
op|'('
number|'404'
op|','
number|'200'
op|')'
newline|'\n'
name|'app'
op|'='
name|'FakeApp'
op|'('
name|'responses'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|'"/v1/.system_account/cont"'
op|')'
newline|'\n'
name|'info'
op|'='
name|'get_container_info'
op|'('
name|'req'
op|'.'
name|'environ'
op|','
name|'app'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'info'
op|'['
string|"'status'"
op|']'
op|','
number|'200'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'info'
op|'['
string|"'bytes'"
op|']'
op|','
number|'6666'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'info'
op|'['
string|"'object_count'"
op|']'
op|','
number|'1000'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_container_info_cache
dedent|''
name|'def'
name|'test_get_container_info_cache'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'cache_stub'
op|'='
op|'{'
nl|'\n'
string|"'status'"
op|':'
number|'404'
op|','
string|"'bytes'"
op|':'
number|'3333'
op|','
string|"'object_count'"
op|':'
number|'10'
op|','
nl|'\n'
comment|'# simplejson sometimes hands back strings, sometimes unicodes'
nl|'\n'
string|"'versions'"
op|':'
string|'u"\\u1F4A9"'
op|'}'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|'"/v1/account/cont"'
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'swift.cache'"
op|':'
name|'FakeCache'
op|'('
name|'cache_stub'
op|')'
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'get_container_info'
op|'('
name|'req'
op|'.'
name|'environ'
op|','
name|'FakeApp'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'['
string|"'storage_policy'"
op|']'
op|','
string|"'0'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'['
string|"'bytes'"
op|']'
op|','
number|'3333'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'['
string|"'object_count'"
op|']'
op|','
number|'10'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'['
string|"'status'"
op|']'
op|','
number|'404'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'['
string|"'versions'"
op|']'
op|','
string|'"\\xe1\\xbd\\x8a\\x39"'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_container_info_env
dedent|''
name|'def'
name|'test_get_container_info_env'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'cache_key'
op|'='
name|'get_container_memcache_key'
op|'('
string|'"account"'
op|','
string|'"cont"'
op|')'
newline|'\n'
name|'env_key'
op|'='
string|"'swift.%s'"
op|'%'
name|'cache_key'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|'"/v1/account/cont"'
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
name|'env_key'
op|':'
op|'{'
string|"'bytes'"
op|':'
number|'3867'
op|'}'
op|','
nl|'\n'
string|"'swift.cache'"
op|':'
name|'FakeCache'
op|'('
op|'{'
op|'}'
op|')'
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'get_container_info'
op|'('
name|'req'
op|'.'
name|'environ'
op|','
string|"'xxx'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'['
string|"'bytes'"
op|']'
op|','
number|'3867'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_account_info_swift_source
dedent|''
name|'def'
name|'test_get_account_info_swift_source'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'app'
op|'='
name|'FakeApp'
op|'('
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|'"/v1/a"'
op|','
name|'environ'
op|'='
op|'{'
string|"'swift.cache'"
op|':'
name|'FakeCache'
op|'('
op|')'
op|'}'
op|')'
newline|'\n'
name|'get_account_info'
op|'('
name|'req'
op|'.'
name|'environ'
op|','
name|'app'
op|','
name|'swift_source'
op|'='
string|"'MC'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'app'
op|'.'
name|'sources'
op|','
op|'['
string|"'MC'"
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_account_info_no_cache
dedent|''
name|'def'
name|'test_get_account_info_no_cache'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'app'
op|'='
name|'FakeApp'
op|'('
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|'"/v1/AUTH_account"'
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'swift.cache'"
op|':'
name|'FakeCache'
op|'('
op|'{'
op|'}'
op|')'
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'get_account_info'
op|'('
name|'req'
op|'.'
name|'environ'
op|','
name|'app'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'['
string|"'bytes'"
op|']'
op|','
number|'6666'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'['
string|"'total_object_count'"
op|']'
op|','
number|'1000'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_account_info_cache
dedent|''
name|'def'
name|'test_get_account_info_cache'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# The original test that we prefer to preserve'
nl|'\n'
indent|'        '
name|'cached'
op|'='
op|'{'
string|"'status'"
op|':'
number|'404'
op|','
nl|'\n'
string|"'bytes'"
op|':'
number|'3333'
op|','
nl|'\n'
string|"'total_object_count'"
op|':'
number|'10'
op|'}'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|'"/v1/account/cont"'
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'swift.cache'"
op|':'
name|'FakeCache'
op|'('
name|'cached'
op|')'
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'get_account_info'
op|'('
name|'req'
op|'.'
name|'environ'
op|','
name|'FakeApp'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'['
string|"'bytes'"
op|']'
op|','
number|'3333'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'['
string|"'total_object_count'"
op|']'
op|','
number|'10'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'['
string|"'status'"
op|']'
op|','
number|'404'
op|')'
newline|'\n'
nl|'\n'
comment|'# Here is a more realistic test'
nl|'\n'
name|'cached'
op|'='
op|'{'
string|"'status'"
op|':'
number|'404'
op|','
nl|'\n'
string|"'bytes'"
op|':'
string|"'3333'"
op|','
nl|'\n'
string|"'container_count'"
op|':'
string|"'234'"
op|','
nl|'\n'
string|"'total_object_count'"
op|':'
string|"'10'"
op|','
nl|'\n'
string|"'meta'"
op|':'
op|'{'
op|'}'
op|'}'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|'"/v1/account/cont"'
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'swift.cache'"
op|':'
name|'FakeCache'
op|'('
name|'cached'
op|')'
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'get_account_info'
op|'('
name|'req'
op|'.'
name|'environ'
op|','
name|'FakeApp'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'['
string|"'status'"
op|']'
op|','
number|'404'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'['
string|"'bytes'"
op|']'
op|','
string|"'3333'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'['
string|"'container_count'"
op|']'
op|','
number|'234'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'['
string|"'meta'"
op|']'
op|','
op|'{'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'['
string|"'total_object_count'"
op|']'
op|','
string|"'10'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_account_info_env
dedent|''
name|'def'
name|'test_get_account_info_env'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'cache_key'
op|'='
name|'get_account_memcache_key'
op|'('
string|'"account"'
op|')'
newline|'\n'
name|'env_key'
op|'='
string|"'swift.%s'"
op|'%'
name|'cache_key'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|'"/v1/account"'
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
name|'env_key'
op|':'
op|'{'
string|"'bytes'"
op|':'
number|'3867'
op|'}'
op|','
nl|'\n'
string|"'swift.cache'"
op|':'
name|'FakeCache'
op|'('
op|'{'
op|'}'
op|')'
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'get_account_info'
op|'('
name|'req'
op|'.'
name|'environ'
op|','
string|"'xxx'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'['
string|"'bytes'"
op|']'
op|','
number|'3867'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_object_info_env
dedent|''
name|'def'
name|'test_get_object_info_env'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'cached'
op|'='
op|'{'
string|"'status'"
op|':'
number|'200'
op|','
nl|'\n'
string|"'length'"
op|':'
number|'3333'
op|','
nl|'\n'
string|"'type'"
op|':'
string|"'application/json'"
op|','
nl|'\n'
string|"'meta'"
op|':'
op|'{'
op|'}'
op|'}'
newline|'\n'
name|'env_key'
op|'='
name|'get_object_env_key'
op|'('
string|'"account"'
op|','
string|'"cont"'
op|','
string|'"obj"'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|'"/v1/account/cont/obj"'
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
name|'env_key'
op|':'
name|'cached'
op|','
nl|'\n'
string|"'swift.cache'"
op|':'
name|'FakeCache'
op|'('
op|'{'
op|'}'
op|')'
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'get_object_info'
op|'('
name|'req'
op|'.'
name|'environ'
op|','
string|"'xxx'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'['
string|"'length'"
op|']'
op|','
number|'3333'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'['
string|"'type'"
op|']'
op|','
string|"'application/json'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_object_info_no_env
dedent|''
name|'def'
name|'test_get_object_info_no_env'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'app'
op|'='
name|'FakeApp'
op|'('
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|'"/v1/account/cont/obj"'
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'swift.cache'"
op|':'
name|'FakeCache'
op|'('
op|'{'
op|'}'
op|')'
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'get_object_info'
op|'('
name|'req'
op|'.'
name|'environ'
op|','
name|'app'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'app'
op|'.'
name|'responses'
op|'.'
name|'stats'
op|'['
string|"'account'"
op|']'
op|','
number|'0'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'app'
op|'.'
name|'responses'
op|'.'
name|'stats'
op|'['
string|"'container'"
op|']'
op|','
number|'0'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'app'
op|'.'
name|'responses'
op|'.'
name|'stats'
op|'['
string|"'obj'"
op|']'
op|','
number|'1'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'['
string|"'length'"
op|']'
op|','
number|'5555'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'['
string|"'type'"
op|']'
op|','
string|"'text/plain'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_options
dedent|''
name|'def'
name|'test_options'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'base'
op|'='
name|'Controller'
op|'('
name|'self'
op|'.'
name|'app'
op|')'
newline|'\n'
name|'base'
op|'.'
name|'account_name'
op|'='
string|"'a'"
newline|'\n'
name|'base'
op|'.'
name|'container_name'
op|'='
string|"'c'"
newline|'\n'
name|'origin'
op|'='
string|"'http://m.com'"
newline|'\n'
name|'self'
op|'.'
name|'app'
op|'.'
name|'cors_allow_origin'
op|'='
op|'['
name|'origin'
op|']'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/v1/a/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'swift.cache'"
op|':'
name|'FakeCache'
op|'('
op|')'
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'Origin'"
op|':'
name|'origin'
op|','
nl|'\n'
string|"'Access-Control-Request-Method'"
op|':'
string|"'GET'"
op|'}'
op|')'
newline|'\n'
nl|'\n'
name|'with'
name|'patch'
op|'('
string|"'swift.proxy.controllers.base.'"
nl|'\n'
string|"'http_connect'"
op|','
name|'fake_http_connect'
op|'('
number|'200'
op|')'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'resp'
op|'='
name|'base'
op|'.'
name|'OPTIONS'
op|'('
name|'req'
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'200'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_options_with_null_allow_origin
dedent|''
name|'def'
name|'test_options_with_null_allow_origin'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'base'
op|'='
name|'Controller'
op|'('
name|'self'
op|'.'
name|'app'
op|')'
newline|'\n'
name|'base'
op|'.'
name|'account_name'
op|'='
string|"'a'"
newline|'\n'
name|'base'
op|'.'
name|'container_name'
op|'='
string|"'c'"
newline|'\n'
nl|'\n'
DECL|function|my_container_info
name|'def'
name|'my_container_info'
op|'('
op|'*'
name|'args'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'return'
op|'{'
nl|'\n'
string|"'cors'"
op|':'
op|'{'
nl|'\n'
string|"'allow_origin'"
op|':'
string|"'*'"
op|','
nl|'\n'
op|'}'
nl|'\n'
op|'}'
newline|'\n'
dedent|''
name|'base'
op|'.'
name|'container_info'
op|'='
name|'my_container_info'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/v1/a/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'swift.cache'"
op|':'
name|'FakeCache'
op|'('
op|')'
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'Origin'"
op|':'
string|"'*'"
op|','
nl|'\n'
string|"'Access-Control-Request-Method'"
op|':'
string|"'GET'"
op|'}'
op|')'
newline|'\n'
nl|'\n'
name|'with'
name|'patch'
op|'('
string|"'swift.proxy.controllers.base.'"
nl|'\n'
string|"'http_connect'"
op|','
name|'fake_http_connect'
op|'('
number|'200'
op|')'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'resp'
op|'='
name|'base'
op|'.'
name|'OPTIONS'
op|'('
name|'req'
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'200'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_options_unauthorized
dedent|''
name|'def'
name|'test_options_unauthorized'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'base'
op|'='
name|'Controller'
op|'('
name|'self'
op|'.'
name|'app'
op|')'
newline|'\n'
name|'base'
op|'.'
name|'account_name'
op|'='
string|"'a'"
newline|'\n'
name|'base'
op|'.'
name|'container_name'
op|'='
string|"'c'"
newline|'\n'
name|'self'
op|'.'
name|'app'
op|'.'
name|'cors_allow_origin'
op|'='
op|'['
string|"'http://NOT_IT'"
op|']'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/v1/a/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'swift.cache'"
op|':'
name|'FakeCache'
op|'('
op|')'
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'Origin'"
op|':'
string|"'http://m.com'"
op|','
nl|'\n'
string|"'Access-Control-Request-Method'"
op|':'
string|"'GET'"
op|'}'
op|')'
newline|'\n'
nl|'\n'
name|'with'
name|'patch'
op|'('
string|"'swift.proxy.controllers.base.'"
nl|'\n'
string|"'http_connect'"
op|','
name|'fake_http_connect'
op|'('
number|'200'
op|')'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'resp'
op|'='
name|'base'
op|'.'
name|'OPTIONS'
op|'('
name|'req'
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'401'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_headers_to_container_info_missing
dedent|''
name|'def'
name|'test_headers_to_container_info_missing'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'resp'
op|'='
name|'headers_to_container_info'
op|'('
op|'{'
op|'}'
op|','
number|'404'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'['
string|"'status'"
op|']'
op|','
number|'404'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'['
string|"'read_acl'"
op|']'
op|','
name|'None'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'['
string|"'write_acl'"
op|']'
op|','
name|'None'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_headers_to_container_info_meta
dedent|''
name|'def'
name|'test_headers_to_container_info_meta'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'headers'
op|'='
op|'{'
string|"'X-Container-Meta-Whatevs'"
op|':'
number|'14'
op|','
nl|'\n'
string|"'x-container-meta-somethingelse'"
op|':'
number|'0'
op|'}'
newline|'\n'
name|'resp'
op|'='
name|'headers_to_container_info'
op|'('
name|'headers'
op|'.'
name|'items'
op|'('
op|')'
op|','
number|'200'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'len'
op|'('
name|'resp'
op|'['
string|"'meta'"
op|']'
op|')'
op|','
number|'2'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'['
string|"'meta'"
op|']'
op|'['
string|"'whatevs'"
op|']'
op|','
number|'14'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'['
string|"'meta'"
op|']'
op|'['
string|"'somethingelse'"
op|']'
op|','
number|'0'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_headers_to_container_info_sys_meta
dedent|''
name|'def'
name|'test_headers_to_container_info_sys_meta'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'prefix'
op|'='
name|'get_sys_meta_prefix'
op|'('
string|"'container'"
op|')'
newline|'\n'
name|'headers'
op|'='
op|'{'
string|"'%sWhatevs'"
op|'%'
name|'prefix'
op|':'
number|'14'
op|','
nl|'\n'
string|"'%ssomethingelse'"
op|'%'
name|'prefix'
op|':'
number|'0'
op|'}'
newline|'\n'
name|'resp'
op|'='
name|'headers_to_container_info'
op|'('
name|'headers'
op|'.'
name|'items'
op|'('
op|')'
op|','
number|'200'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'len'
op|'('
name|'resp'
op|'['
string|"'sysmeta'"
op|']'
op|')'
op|','
number|'2'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'['
string|"'sysmeta'"
op|']'
op|'['
string|"'whatevs'"
op|']'
op|','
number|'14'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'['
string|"'sysmeta'"
op|']'
op|'['
string|"'somethingelse'"
op|']'
op|','
number|'0'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_headers_to_container_info_values
dedent|''
name|'def'
name|'test_headers_to_container_info_values'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'headers'
op|'='
op|'{'
nl|'\n'
string|"'x-container-read'"
op|':'
string|"'readvalue'"
op|','
nl|'\n'
string|"'x-container-write'"
op|':'
string|"'writevalue'"
op|','
nl|'\n'
string|"'x-container-sync-key'"
op|':'
string|"'keyvalue'"
op|','
nl|'\n'
string|"'x-container-meta-access-control-allow-origin'"
op|':'
string|"'here'"
op|','
nl|'\n'
op|'}'
newline|'\n'
name|'resp'
op|'='
name|'headers_to_container_info'
op|'('
name|'headers'
op|'.'
name|'items'
op|'('
op|')'
op|','
number|'200'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'['
string|"'read_acl'"
op|']'
op|','
string|"'readvalue'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'['
string|"'write_acl'"
op|']'
op|','
string|"'writevalue'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'['
string|"'cors'"
op|']'
op|'['
string|"'allow_origin'"
op|']'
op|','
string|"'here'"
op|')'
newline|'\n'
nl|'\n'
name|'headers'
op|'['
string|"'x-unused-header'"
op|']'
op|'='
string|"'blahblahblah'"
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
nl|'\n'
name|'resp'
op|','
nl|'\n'
name|'headers_to_container_info'
op|'('
name|'headers'
op|'.'
name|'items'
op|'('
op|')'
op|','
number|'200'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_container_info_without_req
dedent|''
name|'def'
name|'test_container_info_without_req'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'base'
op|'='
name|'Controller'
op|'('
name|'self'
op|'.'
name|'app'
op|')'
newline|'\n'
name|'base'
op|'.'
name|'account_name'
op|'='
string|"'a'"
newline|'\n'
name|'base'
op|'.'
name|'container_name'
op|'='
string|"'c'"
newline|'\n'
nl|'\n'
name|'container_info'
op|'='
name|'base'
op|'.'
name|'container_info'
op|'('
name|'base'
op|'.'
name|'account_name'
op|','
nl|'\n'
name|'base'
op|'.'
name|'container_name'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'container_info'
op|'['
string|"'status'"
op|']'
op|','
number|'0'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_headers_to_account_info_missing
dedent|''
name|'def'
name|'test_headers_to_account_info_missing'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'resp'
op|'='
name|'headers_to_account_info'
op|'('
op|'{'
op|'}'
op|','
number|'404'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'['
string|"'status'"
op|']'
op|','
number|'404'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'['
string|"'bytes'"
op|']'
op|','
name|'None'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'['
string|"'container_count'"
op|']'
op|','
name|'None'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_headers_to_account_info_meta
dedent|''
name|'def'
name|'test_headers_to_account_info_meta'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'headers'
op|'='
op|'{'
string|"'X-Account-Meta-Whatevs'"
op|':'
number|'14'
op|','
nl|'\n'
string|"'x-account-meta-somethingelse'"
op|':'
number|'0'
op|'}'
newline|'\n'
name|'resp'
op|'='
name|'headers_to_account_info'
op|'('
name|'headers'
op|'.'
name|'items'
op|'('
op|')'
op|','
number|'200'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'len'
op|'('
name|'resp'
op|'['
string|"'meta'"
op|']'
op|')'
op|','
number|'2'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'['
string|"'meta'"
op|']'
op|'['
string|"'whatevs'"
op|']'
op|','
number|'14'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'['
string|"'meta'"
op|']'
op|'['
string|"'somethingelse'"
op|']'
op|','
number|'0'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_headers_to_account_info_sys_meta
dedent|''
name|'def'
name|'test_headers_to_account_info_sys_meta'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'prefix'
op|'='
name|'get_sys_meta_prefix'
op|'('
string|"'account'"
op|')'
newline|'\n'
name|'headers'
op|'='
op|'{'
string|"'%sWhatevs'"
op|'%'
name|'prefix'
op|':'
number|'14'
op|','
nl|'\n'
string|"'%ssomethingelse'"
op|'%'
name|'prefix'
op|':'
number|'0'
op|'}'
newline|'\n'
name|'resp'
op|'='
name|'headers_to_account_info'
op|'('
name|'headers'
op|'.'
name|'items'
op|'('
op|')'
op|','
number|'200'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'len'
op|'('
name|'resp'
op|'['
string|"'sysmeta'"
op|']'
op|')'
op|','
number|'2'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'['
string|"'sysmeta'"
op|']'
op|'['
string|"'whatevs'"
op|']'
op|','
number|'14'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'['
string|"'sysmeta'"
op|']'
op|'['
string|"'somethingelse'"
op|']'
op|','
number|'0'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_headers_to_account_info_values
dedent|''
name|'def'
name|'test_headers_to_account_info_values'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'headers'
op|'='
op|'{'
nl|'\n'
string|"'x-account-object-count'"
op|':'
string|"'10'"
op|','
nl|'\n'
string|"'x-account-container-count'"
op|':'
string|"'20'"
op|','
nl|'\n'
op|'}'
newline|'\n'
name|'resp'
op|'='
name|'headers_to_account_info'
op|'('
name|'headers'
op|'.'
name|'items'
op|'('
op|')'
op|','
number|'200'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'['
string|"'total_object_count'"
op|']'
op|','
string|"'10'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'['
string|"'container_count'"
op|']'
op|','
string|"'20'"
op|')'
newline|'\n'
nl|'\n'
name|'headers'
op|'['
string|"'x-unused-header'"
op|']'
op|'='
string|"'blahblahblah'"
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
nl|'\n'
name|'resp'
op|','
nl|'\n'
name|'headers_to_account_info'
op|'('
name|'headers'
op|'.'
name|'items'
op|'('
op|')'
op|','
number|'200'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_headers_to_object_info_missing
dedent|''
name|'def'
name|'test_headers_to_object_info_missing'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'resp'
op|'='
name|'headers_to_object_info'
op|'('
op|'{'
op|'}'
op|','
number|'404'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'['
string|"'status'"
op|']'
op|','
number|'404'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'['
string|"'length'"
op|']'
op|','
name|'None'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'['
string|"'etag'"
op|']'
op|','
name|'None'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_headers_to_object_info_meta
dedent|''
name|'def'
name|'test_headers_to_object_info_meta'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'headers'
op|'='
op|'{'
string|"'X-Object-Meta-Whatevs'"
op|':'
number|'14'
op|','
nl|'\n'
string|"'x-object-meta-somethingelse'"
op|':'
number|'0'
op|'}'
newline|'\n'
name|'resp'
op|'='
name|'headers_to_object_info'
op|'('
name|'headers'
op|'.'
name|'items'
op|'('
op|')'
op|','
number|'200'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'len'
op|'('
name|'resp'
op|'['
string|"'meta'"
op|']'
op|')'
op|','
number|'2'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'['
string|"'meta'"
op|']'
op|'['
string|"'whatevs'"
op|']'
op|','
number|'14'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'['
string|"'meta'"
op|']'
op|'['
string|"'somethingelse'"
op|']'
op|','
number|'0'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_headers_to_object_info_sys_meta
dedent|''
name|'def'
name|'test_headers_to_object_info_sys_meta'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'prefix'
op|'='
name|'get_sys_meta_prefix'
op|'('
string|"'object'"
op|')'
newline|'\n'
name|'headers'
op|'='
op|'{'
string|"'%sWhatevs'"
op|'%'
name|'prefix'
op|':'
number|'14'
op|','
nl|'\n'
string|"'%ssomethingelse'"
op|'%'
name|'prefix'
op|':'
number|'0'
op|'}'
newline|'\n'
name|'resp'
op|'='
name|'headers_to_object_info'
op|'('
name|'headers'
op|'.'
name|'items'
op|'('
op|')'
op|','
number|'200'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'len'
op|'('
name|'resp'
op|'['
string|"'sysmeta'"
op|']'
op|')'
op|','
number|'2'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'['
string|"'sysmeta'"
op|']'
op|'['
string|"'whatevs'"
op|']'
op|','
number|'14'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'['
string|"'sysmeta'"
op|']'
op|'['
string|"'somethingelse'"
op|']'
op|','
number|'0'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_headers_to_object_info_values
dedent|''
name|'def'
name|'test_headers_to_object_info_values'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'headers'
op|'='
op|'{'
nl|'\n'
string|"'content-length'"
op|':'
string|"'1024'"
op|','
nl|'\n'
string|"'content-type'"
op|':'
string|"'application/json'"
op|','
nl|'\n'
op|'}'
newline|'\n'
name|'resp'
op|'='
name|'headers_to_object_info'
op|'('
name|'headers'
op|'.'
name|'items'
op|'('
op|')'
op|','
number|'200'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'['
string|"'length'"
op|']'
op|','
string|"'1024'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'['
string|"'type'"
op|']'
op|','
string|"'application/json'"
op|')'
newline|'\n'
nl|'\n'
name|'headers'
op|'['
string|"'x-unused-header'"
op|']'
op|'='
string|"'blahblahblah'"
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
nl|'\n'
name|'resp'
op|','
nl|'\n'
name|'headers_to_object_info'
op|'('
name|'headers'
op|'.'
name|'items'
op|'('
op|')'
op|','
number|'200'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_base_have_quorum
dedent|''
name|'def'
name|'test_base_have_quorum'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'base'
op|'='
name|'Controller'
op|'('
name|'self'
op|'.'
name|'app'
op|')'
newline|'\n'
comment|'# just throw a bunch of test cases at it'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'base'
op|'.'
name|'have_quorum'
op|'('
op|'['
number|'201'
op|','
number|'404'
op|']'
op|','
number|'3'
op|')'
op|','
name|'False'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'base'
op|'.'
name|'have_quorum'
op|'('
op|'['
number|'201'
op|','
number|'201'
op|']'
op|','
number|'4'
op|')'
op|','
name|'False'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'base'
op|'.'
name|'have_quorum'
op|'('
op|'['
number|'201'
op|','
number|'201'
op|','
number|'404'
op|','
number|'404'
op|']'
op|','
number|'4'
op|')'
op|','
name|'False'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'base'
op|'.'
name|'have_quorum'
op|'('
op|'['
number|'201'
op|','
number|'503'
op|','
number|'503'
op|','
number|'201'
op|']'
op|','
number|'4'
op|')'
op|','
name|'False'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'base'
op|'.'
name|'have_quorum'
op|'('
op|'['
number|'201'
op|','
number|'201'
op|']'
op|','
number|'3'
op|')'
op|','
name|'True'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'base'
op|'.'
name|'have_quorum'
op|'('
op|'['
number|'404'
op|','
number|'404'
op|']'
op|','
number|'3'
op|')'
op|','
name|'True'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'base'
op|'.'
name|'have_quorum'
op|'('
op|'['
number|'201'
op|','
number|'201'
op|']'
op|','
number|'2'
op|')'
op|','
name|'True'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'base'
op|'.'
name|'have_quorum'
op|'('
op|'['
number|'404'
op|','
number|'404'
op|']'
op|','
number|'2'
op|')'
op|','
name|'True'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'base'
op|'.'
name|'have_quorum'
op|'('
op|'['
number|'201'
op|','
number|'404'
op|','
number|'201'
op|','
number|'201'
op|']'
op|','
number|'4'
op|')'
op|','
name|'True'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_best_response_overrides
dedent|''
name|'def'
name|'test_best_response_overrides'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'base'
op|'='
name|'Controller'
op|'('
name|'self'
op|'.'
name|'app'
op|')'
newline|'\n'
name|'responses'
op|'='
op|'['
nl|'\n'
op|'('
number|'302'
op|','
string|"'Found'"
op|','
string|"''"
op|','
string|"'The resource has moved temporarily.'"
op|')'
op|','
nl|'\n'
op|'('
number|'100'
op|','
string|"'Continue'"
op|','
string|"''"
op|','
string|"''"
op|')'
op|','
nl|'\n'
op|'('
number|'404'
op|','
string|"'Not Found'"
op|','
string|"''"
op|','
string|"'Custom body'"
op|')'
op|','
nl|'\n'
op|']'
newline|'\n'
name|'server_type'
op|'='
string|'"Base DELETE"'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/v1/a/c/o'"
op|','
name|'method'
op|'='
string|"'DELETE'"
op|')'
newline|'\n'
name|'statuses'
op|','
name|'reasons'
op|','
name|'headers'
op|','
name|'bodies'
op|'='
name|'zip'
op|'('
op|'*'
name|'responses'
op|')'
newline|'\n'
nl|'\n'
comment|"# First test that you can't make a quorum with only overridden"
nl|'\n'
comment|'# responses'
nl|'\n'
name|'overrides'
op|'='
op|'{'
number|'302'
op|':'
number|'204'
op|','
number|'100'
op|':'
number|'204'
op|'}'
newline|'\n'
name|'resp'
op|'='
name|'base'
op|'.'
name|'best_response'
op|'('
name|'req'
op|','
name|'statuses'
op|','
name|'reasons'
op|','
name|'bodies'
op|','
name|'server_type'
op|','
nl|'\n'
name|'headers'
op|'='
name|'headers'
op|','
name|'overrides'
op|'='
name|'overrides'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
string|"'503 Service Unavailable'"
op|')'
newline|'\n'
nl|'\n'
comment|'# next make a 404 quorum and make sure the last delete (real) 404'
nl|'\n'
comment|'# status is the one returned.'
nl|'\n'
name|'overrides'
op|'='
op|'{'
number|'100'
op|':'
number|'404'
op|'}'
newline|'\n'
name|'resp'
op|'='
name|'base'
op|'.'
name|'best_response'
op|'('
name|'req'
op|','
name|'statuses'
op|','
name|'reasons'
op|','
name|'bodies'
op|','
name|'server_type'
op|','
nl|'\n'
name|'headers'
op|'='
name|'headers'
op|','
name|'overrides'
op|'='
name|'overrides'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
string|"'404 Not Found'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'body'
op|','
string|"'Custom body'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_range_fast_forward
dedent|''
name|'def'
name|'test_range_fast_forward'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/'"
op|')'
newline|'\n'
name|'handler'
op|'='
name|'GetOrHeadHandler'
op|'('
name|'None'
op|','
name|'req'
op|','
name|'None'
op|','
name|'None'
op|','
name|'None'
op|','
name|'None'
op|','
op|'{'
op|'}'
op|')'
newline|'\n'
name|'handler'
op|'.'
name|'fast_forward'
op|'('
number|'50'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'handler'
op|'.'
name|'backend_headers'
op|'['
string|"'Range'"
op|']'
op|','
string|"'bytes=50-'"
op|')'
newline|'\n'
nl|'\n'
name|'handler'
op|'='
name|'GetOrHeadHandler'
op|'('
name|'None'
op|','
name|'req'
op|','
name|'None'
op|','
name|'None'
op|','
name|'None'
op|','
name|'None'
op|','
nl|'\n'
op|'{'
string|"'Range'"
op|':'
string|"'bytes=23-50'"
op|'}'
op|')'
newline|'\n'
name|'handler'
op|'.'
name|'fast_forward'
op|'('
number|'20'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'handler'
op|'.'
name|'backend_headers'
op|'['
string|"'Range'"
op|']'
op|','
string|"'bytes=43-50'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'HTTPException'
op|','
nl|'\n'
name|'handler'
op|'.'
name|'fast_forward'
op|','
number|'80'
op|')'
newline|'\n'
nl|'\n'
name|'handler'
op|'='
name|'GetOrHeadHandler'
op|'('
name|'None'
op|','
name|'req'
op|','
name|'None'
op|','
name|'None'
op|','
name|'None'
op|','
name|'None'
op|','
nl|'\n'
op|'{'
string|"'Range'"
op|':'
string|"'bytes=23-'"
op|'}'
op|')'
newline|'\n'
name|'handler'
op|'.'
name|'fast_forward'
op|'('
number|'20'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'handler'
op|'.'
name|'backend_headers'
op|'['
string|"'Range'"
op|']'
op|','
string|"'bytes=43-'"
op|')'
newline|'\n'
nl|'\n'
name|'handler'
op|'='
name|'GetOrHeadHandler'
op|'('
name|'None'
op|','
name|'req'
op|','
name|'None'
op|','
name|'None'
op|','
name|'None'
op|','
name|'None'
op|','
nl|'\n'
op|'{'
string|"'Range'"
op|':'
string|"'bytes=-100'"
op|'}'
op|')'
newline|'\n'
name|'handler'
op|'.'
name|'fast_forward'
op|'('
number|'20'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'handler'
op|'.'
name|'backend_headers'
op|'['
string|"'Range'"
op|']'
op|','
string|"'bytes=-80'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_transfer_headers_with_sysmeta
dedent|''
name|'def'
name|'test_transfer_headers_with_sysmeta'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'base'
op|'='
name|'Controller'
op|'('
name|'self'
op|'.'
name|'app'
op|')'
newline|'\n'
name|'good_hdrs'
op|'='
op|'{'
string|"'x-base-sysmeta-foo'"
op|':'
string|"'ok'"
op|','
nl|'\n'
string|"'X-Base-sysmeta-Bar'"
op|':'
string|"'also ok'"
op|'}'
newline|'\n'
name|'bad_hdrs'
op|'='
op|'{'
string|"'x-base-sysmeta-'"
op|':'
string|"'too short'"
op|'}'
newline|'\n'
name|'hdrs'
op|'='
name|'dict'
op|'('
name|'good_hdrs'
op|')'
newline|'\n'
name|'hdrs'
op|'.'
name|'update'
op|'('
name|'bad_hdrs'
op|')'
newline|'\n'
name|'dst_hdrs'
op|'='
name|'HeaderKeyDict'
op|'('
op|')'
newline|'\n'
name|'base'
op|'.'
name|'transfer_headers'
op|'('
name|'hdrs'
op|','
name|'dst_hdrs'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'HeaderKeyDict'
op|'('
name|'good_hdrs'
op|')'
op|','
name|'dst_hdrs'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_generate_request_headers
dedent|''
name|'def'
name|'test_generate_request_headers'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'base'
op|'='
name|'Controller'
op|'('
name|'self'
op|'.'
name|'app'
op|')'
newline|'\n'
name|'src_headers'
op|'='
op|'{'
string|"'x-remove-base-meta-owner'"
op|':'
string|"'x'"
op|','
nl|'\n'
string|"'x-base-meta-size'"
op|':'
string|"'151M'"
op|','
nl|'\n'
string|"'new-owner'"
op|':'
string|"'Kun'"
op|'}'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/v1/a/c/o'"
op|','
name|'headers'
op|'='
name|'src_headers'
op|')'
newline|'\n'
name|'dst_headers'
op|'='
name|'base'
op|'.'
name|'generate_request_headers'
op|'('
name|'req'
op|','
name|'transfer'
op|'='
name|'True'
op|')'
newline|'\n'
name|'expected_headers'
op|'='
op|'{'
string|"'x-base-meta-owner'"
op|':'
string|"''"
op|','
nl|'\n'
string|"'x-base-meta-size'"
op|':'
string|"'151M'"
op|','
nl|'\n'
string|"'connection'"
op|':'
string|"'close'"
op|'}'
newline|'\n'
name|'for'
name|'k'
op|','
name|'v'
name|'in'
name|'expected_headers'
op|'.'
name|'items'
op|'('
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'k'
name|'in'
name|'dst_headers'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'v'
op|','
name|'dst_headers'
op|'['
name|'k'
op|']'
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertFalse'
op|'('
string|"'new-owner'"
name|'in'
name|'dst_headers'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_generate_request_headers_with_sysmeta
dedent|''
name|'def'
name|'test_generate_request_headers_with_sysmeta'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'base'
op|'='
name|'Controller'
op|'('
name|'self'
op|'.'
name|'app'
op|')'
newline|'\n'
name|'good_hdrs'
op|'='
op|'{'
string|"'x-base-sysmeta-foo'"
op|':'
string|"'ok'"
op|','
nl|'\n'
string|"'X-Base-sysmeta-Bar'"
op|':'
string|"'also ok'"
op|'}'
newline|'\n'
name|'bad_hdrs'
op|'='
op|'{'
string|"'x-base-sysmeta-'"
op|':'
string|"'too short'"
op|'}'
newline|'\n'
name|'hdrs'
op|'='
name|'dict'
op|'('
name|'good_hdrs'
op|')'
newline|'\n'
name|'hdrs'
op|'.'
name|'update'
op|'('
name|'bad_hdrs'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/v1/a/c/o'"
op|','
name|'headers'
op|'='
name|'hdrs'
op|')'
newline|'\n'
name|'dst_headers'
op|'='
name|'base'
op|'.'
name|'generate_request_headers'
op|'('
name|'req'
op|','
name|'transfer'
op|'='
name|'True'
op|')'
newline|'\n'
name|'for'
name|'k'
op|','
name|'v'
name|'in'
name|'good_hdrs'
op|'.'
name|'items'
op|'('
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'k'
op|'.'
name|'lower'
op|'('
op|')'
name|'in'
name|'dst_headers'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'v'
op|','
name|'dst_headers'
op|'['
name|'k'
op|'.'
name|'lower'
op|'('
op|')'
op|']'
op|')'
newline|'\n'
dedent|''
name|'for'
name|'k'
op|','
name|'v'
name|'in'
name|'bad_hdrs'
op|'.'
name|'items'
op|'('
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'k'
op|'.'
name|'lower'
op|'('
op|')'
name|'in'
name|'dst_headers'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_generate_request_headers_with_no_orig_req
dedent|''
dedent|''
name|'def'
name|'test_generate_request_headers_with_no_orig_req'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'base'
op|'='
name|'Controller'
op|'('
name|'self'
op|'.'
name|'app'
op|')'
newline|'\n'
name|'src_headers'
op|'='
op|'{'
string|"'x-remove-base-meta-owner'"
op|':'
string|"'x'"
op|','
nl|'\n'
string|"'x-base-meta-size'"
op|':'
string|"'151M'"
op|','
nl|'\n'
string|"'new-owner'"
op|':'
string|"'Kun'"
op|'}'
newline|'\n'
name|'dst_headers'
op|'='
name|'base'
op|'.'
name|'generate_request_headers'
op|'('
name|'None'
op|','
nl|'\n'
name|'additional'
op|'='
name|'src_headers'
op|')'
newline|'\n'
name|'expected_headers'
op|'='
op|'{'
string|"'x-base-meta-size'"
op|':'
string|"'151M'"
op|','
nl|'\n'
string|"'connection'"
op|':'
string|"'close'"
op|'}'
newline|'\n'
name|'for'
name|'k'
op|','
name|'v'
name|'in'
name|'expected_headers'
op|'.'
name|'items'
op|'('
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertDictContainsSubset'
op|'('
name|'expected_headers'
op|','
name|'dst_headers'
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"''"
op|','
name|'dst_headers'
op|'['
string|"'Referer'"
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_client_chunk_size
dedent|''
name|'def'
name|'test_client_chunk_size'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|class|TestSource
indent|'        '
name|'class'
name|'TestSource'
op|'('
name|'object'
op|')'
op|':'
newline|'\n'
DECL|member|__init__
indent|'            '
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'chunks'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'chunks'
op|'='
name|'list'
op|'('
name|'chunks'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'status'
op|'='
number|'200'
newline|'\n'
nl|'\n'
DECL|member|read
dedent|''
name|'def'
name|'read'
op|'('
name|'self'
op|','
name|'_read_size'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'if'
name|'self'
op|'.'
name|'chunks'
op|':'
newline|'\n'
indent|'                    '
name|'return'
name|'self'
op|'.'
name|'chunks'
op|'.'
name|'pop'
op|'('
number|'0'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                    '
name|'return'
string|"''"
newline|'\n'
nl|'\n'
DECL|member|getheader
dedent|''
dedent|''
name|'def'
name|'getheader'
op|'('
name|'self'
op|','
name|'header'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'if'
name|'header'
op|'.'
name|'lower'
op|'('
op|')'
op|'=='
string|'"content-length"'
op|':'
newline|'\n'
indent|'                    '
name|'return'
name|'str'
op|'('
name|'sum'
op|'('
name|'len'
op|'('
name|'c'
op|')'
name|'for'
name|'c'
name|'in'
name|'self'
op|'.'
name|'chunks'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|getheaders
dedent|''
dedent|''
name|'def'
name|'getheaders'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'return'
op|'['
op|'('
string|"'content-length'"
op|','
name|'self'
op|'.'
name|'getheader'
op|'('
string|"'content-length'"
op|')'
op|')'
op|']'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'source'
op|'='
name|'TestSource'
op|'('
op|'('
nl|'\n'
string|"'abcd'"
op|','
string|"'1234'"
op|','
string|"'abc'"
op|','
string|"'d1'"
op|','
string|"'234abcd1234abcd1'"
op|','
string|"'2'"
op|')'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/v1/a/c/o'"
op|')'
newline|'\n'
name|'node'
op|'='
op|'{'
op|'}'
newline|'\n'
name|'handler'
op|'='
name|'GetOrHeadHandler'
op|'('
name|'self'
op|'.'
name|'app'
op|','
name|'req'
op|','
name|'None'
op|','
name|'None'
op|','
name|'None'
op|','
name|'None'
op|','
op|'{'
op|'}'
op|','
nl|'\n'
name|'client_chunk_size'
op|'='
number|'8'
op|')'
newline|'\n'
nl|'\n'
name|'app_iter'
op|'='
name|'handler'
op|'.'
name|'_make_app_iter'
op|'('
name|'req'
op|','
name|'node'
op|','
name|'source'
op|')'
newline|'\n'
name|'client_chunks'
op|'='
name|'list'
op|'('
name|'app_iter'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'client_chunks'
op|','
op|'['
nl|'\n'
string|"'abcd1234'"
op|','
string|"'abcd1234'"
op|','
string|"'abcd1234'"
op|','
string|"'abcd12'"
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_client_chunk_size_resuming
dedent|''
name|'def'
name|'test_client_chunk_size_resuming'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|class|TestSource
indent|'        '
name|'class'
name|'TestSource'
op|'('
name|'object'
op|')'
op|':'
newline|'\n'
DECL|member|__init__
indent|'            '
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'chunks'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'chunks'
op|'='
name|'list'
op|'('
name|'chunks'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'status'
op|'='
number|'200'
newline|'\n'
nl|'\n'
DECL|member|read
dedent|''
name|'def'
name|'read'
op|'('
name|'self'
op|','
name|'_read_size'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'if'
name|'self'
op|'.'
name|'chunks'
op|':'
newline|'\n'
indent|'                    '
name|'chunk'
op|'='
name|'self'
op|'.'
name|'chunks'
op|'.'
name|'pop'
op|'('
number|'0'
op|')'
newline|'\n'
name|'if'
name|'chunk'
name|'is'
name|'None'
op|':'
newline|'\n'
indent|'                        '
name|'raise'
name|'exceptions'
op|'.'
name|'ChunkReadTimeout'
op|'('
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                        '
name|'return'
name|'chunk'
newline|'\n'
dedent|''
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                    '
name|'return'
string|"''"
newline|'\n'
nl|'\n'
DECL|member|getheader
dedent|''
dedent|''
name|'def'
name|'getheader'
op|'('
name|'self'
op|','
name|'header'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'if'
name|'header'
op|'.'
name|'lower'
op|'('
op|')'
op|'=='
string|'"content-length"'
op|':'
newline|'\n'
indent|'                    '
name|'return'
name|'str'
op|'('
name|'sum'
op|'('
name|'len'
op|'('
name|'c'
op|')'
name|'for'
name|'c'
name|'in'
name|'self'
op|'.'
name|'chunks'
nl|'\n'
name|'if'
name|'c'
name|'is'
name|'not'
name|'None'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|getheaders
dedent|''
dedent|''
name|'def'
name|'getheaders'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'return'
op|'['
op|'('
string|"'content-length'"
op|','
name|'self'
op|'.'
name|'getheader'
op|'('
string|"'content-length'"
op|')'
op|')'
op|']'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'node'
op|'='
op|'{'
string|"'ip'"
op|':'
string|"'1.2.3.4'"
op|','
string|"'port'"
op|':'
number|'6000'
op|','
string|"'device'"
op|':'
string|"'sda'"
op|'}'
newline|'\n'
nl|'\n'
name|'source1'
op|'='
name|'TestSource'
op|'('
op|'['
string|"'abcd'"
op|','
string|"'1234'"
op|','
string|"'abc'"
op|','
name|'None'
op|']'
op|')'
newline|'\n'
name|'source2'
op|'='
name|'TestSource'
op|'('
op|'['
string|"'efgh5678'"
op|']'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/v1/a/c/o'"
op|')'
newline|'\n'
name|'handler'
op|'='
name|'GetOrHeadHandler'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'app'
op|','
name|'req'
op|','
string|"'Object'"
op|','
name|'None'
op|','
name|'None'
op|','
name|'None'
op|','
op|'{'
op|'}'
op|','
nl|'\n'
DECL|variable|client_chunk_size
name|'client_chunk_size'
op|'='
number|'8'
op|')'
newline|'\n'
nl|'\n'
name|'app_iter'
op|'='
name|'handler'
op|'.'
name|'_make_app_iter'
op|'('
name|'req'
op|','
name|'node'
op|','
name|'source1'
op|')'
newline|'\n'
name|'with'
name|'patch'
op|'.'
name|'object'
op|'('
name|'handler'
op|','
string|"'_get_source_and_node'"
op|','
nl|'\n'
name|'lambda'
op|':'
op|'('
name|'source2'
op|','
name|'node'
op|')'
op|')'
op|':'
newline|'\n'
DECL|variable|client_chunks
indent|'            '
name|'client_chunks'
op|'='
name|'list'
op|'('
name|'app_iter'
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'client_chunks'
op|','
op|'['
string|"'abcd1234'"
op|','
string|"'efgh5678'"
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_bytes_to_skip
dedent|''
name|'def'
name|'test_bytes_to_skip'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# if you start at the beginning, skip nothing'
nl|'\n'
indent|'        '
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'bytes_to_skip'
op|'('
number|'1024'
op|','
number|'0'
op|')'
op|','
number|'0'
op|')'
newline|'\n'
nl|'\n'
comment|"# missed the first 10 bytes, so we've got 1014 bytes of partial"
nl|'\n'
comment|'# record'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'bytes_to_skip'
op|'('
number|'1024'
op|','
number|'10'
op|')'
op|','
number|'1014'
op|')'
newline|'\n'
nl|'\n'
comment|'# skipped some whole records first'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'bytes_to_skip'
op|'('
number|'1024'
op|','
number|'4106'
op|')'
op|','
number|'1014'
op|')'
newline|'\n'
nl|'\n'
comment|'# landed on a record boundary'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'bytes_to_skip'
op|'('
number|'1024'
op|','
number|'1024'
op|')'
op|','
number|'0'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'bytes_to_skip'
op|'('
number|'1024'
op|','
number|'2048'
op|')'
op|','
number|'0'
op|')'
newline|'\n'
nl|'\n'
comment|'# big numbers'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'bytes_to_skip'
op|'('
number|'2'
op|'**'
number|'20'
op|','
number|'2'
op|'**'
number|'32'
op|')'
op|','
number|'0'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'bytes_to_skip'
op|'('
number|'2'
op|'**'
number|'20'
op|','
number|'2'
op|'**'
number|'32'
op|'+'
number|'1'
op|')'
op|','
number|'2'
op|'**'
number|'20'
op|'-'
number|'1'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'bytes_to_skip'
op|'('
number|'2'
op|'**'
number|'20'
op|','
number|'2'
op|'**'
number|'32'
op|'+'
number|'2'
op|'**'
number|'19'
op|')'
op|','
number|'2'
op|'**'
number|'19'
op|')'
newline|'\n'
nl|'\n'
comment|'# odd numbers'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'bytes_to_skip'
op|'('
number|'123'
op|','
number|'0'
op|')'
op|','
number|'0'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'bytes_to_skip'
op|'('
number|'123'
op|','
number|'23'
op|')'
op|','
number|'100'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'bytes_to_skip'
op|'('
number|'123'
op|','
number|'247'
op|')'
op|','
number|'122'
op|')'
newline|'\n'
nl|'\n'
comment|'# prime numbers'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'bytes_to_skip'
op|'('
number|'11'
op|','
number|'7'
op|')'
op|','
number|'4'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'bytes_to_skip'
op|'('
number|'97'
op|','
number|'7873823'
op|')'
op|','
number|'55'
op|')'
newline|'\n'
dedent|''
dedent|''
endmarker|''
end_unit
