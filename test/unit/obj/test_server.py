begin_unit
comment|'# coding: utf-8'
nl|'\n'
comment|'# Copyright (c) 2010-2012 OpenStack Foundation'
nl|'\n'
comment|'#'
nl|'\n'
comment|'# Licensed under the Apache License, Version 2.0 (the "License");'
nl|'\n'
comment|'# you may not use this file except in compliance with the License.'
nl|'\n'
comment|'# You may obtain a copy of the License at'
nl|'\n'
comment|'#'
nl|'\n'
comment|'#    http://www.apache.org/licenses/LICENSE-2.0'
nl|'\n'
comment|'#'
nl|'\n'
comment|'# Unless required by applicable law or agreed to in writing, software'
nl|'\n'
comment|'# distributed under the License is distributed on an "AS IS" BASIS,'
nl|'\n'
comment|'# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or'
nl|'\n'
comment|'# implied.'
nl|'\n'
comment|'# See the License for the specific language governing permissions and'
nl|'\n'
comment|'# limitations under the License.'
nl|'\n'
nl|'\n'
string|'"""Tests for swift.obj.server"""'
newline|'\n'
nl|'\n'
name|'import'
name|'six'
op|'.'
name|'moves'
op|'.'
name|'cPickle'
name|'as'
name|'pickle'
newline|'\n'
name|'import'
name|'datetime'
newline|'\n'
name|'import'
name|'json'
newline|'\n'
name|'import'
name|'errno'
newline|'\n'
name|'import'
name|'operator'
newline|'\n'
name|'import'
name|'os'
newline|'\n'
name|'import'
name|'mock'
newline|'\n'
name|'import'
name|'six'
newline|'\n'
name|'from'
name|'six'
name|'import'
name|'StringIO'
newline|'\n'
name|'import'
name|'unittest'
newline|'\n'
name|'import'
name|'math'
newline|'\n'
name|'import'
name|'random'
newline|'\n'
name|'from'
name|'shutil'
name|'import'
name|'rmtree'
newline|'\n'
name|'from'
name|'time'
name|'import'
name|'gmtime'
op|','
name|'strftime'
op|','
name|'time'
op|','
name|'struct_time'
newline|'\n'
name|'from'
name|'tempfile'
name|'import'
name|'mkdtemp'
newline|'\n'
name|'from'
name|'hashlib'
name|'import'
name|'md5'
newline|'\n'
name|'import'
name|'itertools'
newline|'\n'
name|'import'
name|'tempfile'
newline|'\n'
name|'from'
name|'collections'
name|'import'
name|'defaultdict'
newline|'\n'
name|'from'
name|'contextlib'
name|'import'
name|'contextmanager'
newline|'\n'
nl|'\n'
name|'from'
name|'eventlet'
name|'import'
name|'sleep'
op|','
name|'spawn'
op|','
name|'wsgi'
op|','
name|'listen'
op|','
name|'Timeout'
op|','
name|'tpool'
op|','
name|'greenthread'
newline|'\n'
name|'from'
name|'eventlet'
op|'.'
name|'green'
name|'import'
name|'httplib'
newline|'\n'
nl|'\n'
name|'from'
name|'nose'
name|'import'
name|'SkipTest'
newline|'\n'
nl|'\n'
name|'from'
name|'swift'
name|'import'
name|'__version__'
name|'as'
name|'swift_version'
newline|'\n'
name|'from'
name|'swift'
op|'.'
name|'common'
op|'.'
name|'http'
name|'import'
name|'is_success'
newline|'\n'
name|'from'
name|'test'
op|'.'
name|'unit'
name|'import'
name|'FakeLogger'
op|','
name|'debug_logger'
op|','
name|'mocked_http_conn'
op|','
name|'make_timestamp_iter'
op|','
name|'DEFAULT_TEST_EC_TYPE'
newline|'\n'
name|'from'
name|'test'
op|'.'
name|'unit'
name|'import'
name|'connect_tcp'
op|','
name|'readuntil2crlfs'
op|','
name|'patch_policies'
newline|'\n'
name|'from'
name|'swift'
op|'.'
name|'obj'
name|'import'
name|'server'
name|'as'
name|'object_server'
newline|'\n'
name|'from'
name|'swift'
op|'.'
name|'obj'
name|'import'
name|'diskfile'
newline|'\n'
name|'from'
name|'swift'
op|'.'
name|'common'
name|'import'
name|'utils'
op|','
name|'bufferedhttp'
newline|'\n'
name|'from'
name|'swift'
op|'.'
name|'common'
op|'.'
name|'utils'
name|'import'
name|'hash_path'
op|','
name|'mkdirs'
op|','
name|'normalize_timestamp'
op|','
name|'NullLogger'
op|','
name|'storage_directory'
op|','
name|'public'
op|','
name|'replication'
newline|'\n'
name|'from'
name|'swift'
op|'.'
name|'common'
name|'import'
name|'constraints'
newline|'\n'
name|'from'
name|'swift'
op|'.'
name|'common'
op|'.'
name|'swob'
name|'import'
name|'Request'
op|','
name|'HeaderKeyDict'
op|','
name|'WsgiBytesIO'
newline|'\n'
name|'from'
name|'swift'
op|'.'
name|'common'
op|'.'
name|'splice'
name|'import'
name|'splice'
newline|'\n'
name|'from'
name|'swift'
op|'.'
name|'common'
op|'.'
name|'storage_policy'
name|'import'
op|'('
name|'StoragePolicy'
op|','
name|'ECStoragePolicy'
op|','
nl|'\n'
name|'POLICIES'
op|','
name|'EC_POLICY'
op|')'
newline|'\n'
name|'from'
name|'swift'
op|'.'
name|'common'
op|'.'
name|'exceptions'
name|'import'
name|'DiskFileDeviceUnavailable'
op|','
name|'DiskFileNoSpace'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|function|mock_time
name|'def'
name|'mock_time'
op|'('
op|'*'
name|'args'
op|','
op|'**'
name|'kwargs'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'return'
number|'5000.0'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|variable|test_policies
dedent|''
name|'test_policies'
op|'='
op|'['
nl|'\n'
name|'StoragePolicy'
op|'('
number|'0'
op|','
name|'name'
op|'='
string|"'zero'"
op|','
name|'is_default'
op|'='
name|'True'
op|')'
op|','
nl|'\n'
name|'ECStoragePolicy'
op|'('
number|'1'
op|','
name|'name'
op|'='
string|"'one'"
op|','
name|'ec_type'
op|'='
name|'DEFAULT_TEST_EC_TYPE'
op|','
nl|'\n'
name|'ec_ndata'
op|'='
number|'10'
op|','
name|'ec_nparity'
op|'='
number|'4'
op|')'
op|','
nl|'\n'
op|']'
newline|'\n'
nl|'\n'
nl|'\n'
op|'@'
name|'contextmanager'
newline|'\n'
DECL|function|fake_spawn
name|'def'
name|'fake_spawn'
op|'('
op|')'
op|':'
newline|'\n'
indent|'    '
string|'"""\n    Spawn and capture the result so we can later wait on it. This means we can\n    test code executing in a greenthread but still wait() on the result to\n    ensure that the method has completed.\n    """'
newline|'\n'
nl|'\n'
name|'greenlets'
op|'='
op|'['
op|']'
newline|'\n'
nl|'\n'
DECL|function|_inner_fake_spawn
name|'def'
name|'_inner_fake_spawn'
op|'('
name|'func'
op|','
op|'*'
name|'a'
op|','
op|'**'
name|'kw'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'gt'
op|'='
name|'greenthread'
op|'.'
name|'spawn'
op|'('
name|'func'
op|','
op|'*'
name|'a'
op|','
op|'**'
name|'kw'
op|')'
newline|'\n'
name|'greenlets'
op|'.'
name|'append'
op|'('
name|'gt'
op|')'
newline|'\n'
name|'return'
name|'gt'
newline|'\n'
nl|'\n'
dedent|''
name|'object_server'
op|'.'
name|'spawn'
op|'='
name|'_inner_fake_spawn'
newline|'\n'
name|'with'
name|'mock'
op|'.'
name|'patch'
op|'('
string|"'swift.obj.server.spawn'"
op|','
name|'_inner_fake_spawn'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'yield'
newline|'\n'
dedent|''
name|'finally'
op|':'
newline|'\n'
indent|'            '
name|'for'
name|'gt'
name|'in'
name|'greenlets'
op|':'
newline|'\n'
indent|'                '
name|'gt'
op|'.'
name|'wait'
op|'('
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
dedent|''
dedent|''
dedent|''
dedent|''
op|'@'
name|'patch_policies'
op|'('
name|'test_policies'
op|')'
newline|'\n'
DECL|class|TestObjectController
name|'class'
name|'TestObjectController'
op|'('
name|'unittest'
op|'.'
name|'TestCase'
op|')'
op|':'
newline|'\n'
indent|'    '
string|'"""Test swift.obj.server.ObjectController"""'
newline|'\n'
nl|'\n'
DECL|member|setUp
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Set up for testing swift.object.server.ObjectController"""'
newline|'\n'
name|'utils'
op|'.'
name|'HASH_PATH_SUFFIX'
op|'='
string|"'endcap'"
newline|'\n'
name|'utils'
op|'.'
name|'HASH_PATH_PREFIX'
op|'='
string|"'startcap'"
newline|'\n'
name|'self'
op|'.'
name|'tmpdir'
op|'='
name|'mkdtemp'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'testdir'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'self'
op|'.'
name|'tmpdir'
op|','
nl|'\n'
string|"'tmp_test_object_server_ObjectController'"
op|')'
newline|'\n'
name|'mkdirs'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'self'
op|'.'
name|'testdir'
op|','
string|"'sda1'"
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'conf'
op|'='
op|'{'
string|"'devices'"
op|':'
name|'self'
op|'.'
name|'testdir'
op|','
string|"'mount_check'"
op|':'
string|"'false'"
op|','
nl|'\n'
string|"'container_update_timeout'"
op|':'
number|'0.0'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'object_controller'
op|'='
name|'object_server'
op|'.'
name|'ObjectController'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'conf'
op|','
name|'logger'
op|'='
name|'debug_logger'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'object_controller'
op|'.'
name|'bytes_per_sync'
op|'='
number|'1'
newline|'\n'
name|'self'
op|'.'
name|'_orig_tpool_exc'
op|'='
name|'tpool'
op|'.'
name|'execute'
newline|'\n'
name|'tpool'
op|'.'
name|'execute'
op|'='
name|'lambda'
name|'f'
op|','
op|'*'
name|'args'
op|','
op|'**'
name|'kwargs'
op|':'
name|'f'
op|'('
op|'*'
name|'args'
op|','
op|'**'
name|'kwargs'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'df_mgr'
op|'='
name|'diskfile'
op|'.'
name|'DiskFileManager'
op|'('
name|'self'
op|'.'
name|'conf'
op|','
nl|'\n'
name|'self'
op|'.'
name|'object_controller'
op|'.'
name|'logger'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'logger'
op|'='
name|'debug_logger'
op|'('
string|"'test-object-controller'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|tearDown
dedent|''
name|'def'
name|'tearDown'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Tear down for testing swift.object.server.ObjectController"""'
newline|'\n'
name|'rmtree'
op|'('
name|'self'
op|'.'
name|'tmpdir'
op|')'
newline|'\n'
name|'tpool'
op|'.'
name|'execute'
op|'='
name|'self'
op|'.'
name|'_orig_tpool_exc'
newline|'\n'
nl|'\n'
DECL|member|_stage_tmp_dir
dedent|''
name|'def'
name|'_stage_tmp_dir'
op|'('
name|'self'
op|','
name|'policy'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'mkdirs'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'self'
op|'.'
name|'testdir'
op|','
string|"'sda1'"
op|','
nl|'\n'
name|'diskfile'
op|'.'
name|'get_tmp_dir'
op|'('
name|'policy'
op|')'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|check_all_api_methods
dedent|''
name|'def'
name|'check_all_api_methods'
op|'('
name|'self'
op|','
name|'obj_name'
op|'='
string|"'o'"
op|','
name|'alt_res'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'path'
op|'='
string|"'/sda1/p/a/c/%s'"
op|'%'
name|'obj_name'
newline|'\n'
name|'body'
op|'='
string|"'SPECIAL_STRING'"
newline|'\n'
nl|'\n'
name|'op_table'
op|'='
op|'{'
nl|'\n'
string|'"PUT"'
op|':'
op|'('
name|'body'
op|','
name|'alt_res'
name|'or'
number|'201'
op|','
string|"''"
op|')'
op|','
comment|'# create one'
nl|'\n'
string|'"GET"'
op|':'
op|'('
string|"''"
op|','
name|'alt_res'
name|'or'
number|'200'
op|','
name|'body'
op|')'
op|','
comment|'# check it'
nl|'\n'
string|'"POST"'
op|':'
op|'('
string|"''"
op|','
name|'alt_res'
name|'or'
number|'202'
op|','
string|"''"
op|')'
op|','
comment|'# update it'
nl|'\n'
string|'"HEAD"'
op|':'
op|'('
string|"''"
op|','
name|'alt_res'
name|'or'
number|'200'
op|','
string|"''"
op|')'
op|','
comment|'# head it'
nl|'\n'
string|'"DELETE"'
op|':'
op|'('
string|"''"
op|','
name|'alt_res'
name|'or'
number|'204'
op|','
string|"''"
op|')'
comment|'# delete it'
nl|'\n'
op|'}'
newline|'\n'
nl|'\n'
name|'for'
name|'method'
name|'in'
op|'['
string|'"PUT"'
op|','
string|'"GET"'
op|','
string|'"POST"'
op|','
string|'"HEAD"'
op|','
string|'"DELETE"'
op|']'
op|':'
newline|'\n'
indent|'            '
name|'in_body'
op|','
name|'res'
op|','
name|'out_body'
op|'='
name|'op_table'
op|'['
name|'method'
op|']'
newline|'\n'
name|'timestamp'
op|'='
name|'normalize_timestamp'
op|'('
name|'time'
op|'('
op|')'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
name|'path'
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
name|'method'
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'timestamp'
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'application/x-test'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'body'
op|'='
name|'in_body'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
name|'res'
op|')'
newline|'\n'
name|'if'
name|'out_body'
name|'and'
op|'('
number|'200'
op|'<='
name|'res'
op|'<'
number|'300'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'body'
op|','
name|'out_body'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_REQUEST_SPECIAL_CHARS
dedent|''
dedent|''
dedent|''
name|'def'
name|'test_REQUEST_SPECIAL_CHARS'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'obj'
op|'='
string|"'special\xe6\x98\x86%20/%'"
newline|'\n'
name|'self'
op|'.'
name|'check_all_api_methods'
op|'('
name|'obj'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_device_unavailable
dedent|''
name|'def'
name|'test_device_unavailable'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
DECL|function|raise_disk_unavail
indent|'        '
name|'def'
name|'raise_disk_unavail'
op|'('
op|'*'
name|'args'
op|','
op|'**'
name|'kwargs'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'DiskFileDeviceUnavailable'
op|'('
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'object_controller'
op|'.'
name|'get_diskfile'
op|'='
name|'raise_disk_unavail'
newline|'\n'
name|'self'
op|'.'
name|'check_all_api_methods'
op|'('
name|'alt_res'
op|'='
number|'507'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_allowed_headers
dedent|''
name|'def'
name|'test_allowed_headers'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'dah'
op|'='
op|'['
string|"'content-disposition'"
op|','
string|"'content-encoding'"
op|','
string|"'x-delete-at'"
op|','
nl|'\n'
string|"'x-object-manifest'"
op|','
string|"'x-static-large-object'"
op|']'
newline|'\n'
name|'conf'
op|'='
op|'{'
string|"'devices'"
op|':'
name|'self'
op|'.'
name|'testdir'
op|','
string|"'mount_check'"
op|':'
string|"'false'"
op|','
nl|'\n'
string|"'allowed_headers'"
op|':'
string|"','"
op|'.'
name|'join'
op|'('
op|'['
string|"'content-type'"
op|']'
op|'+'
name|'dah'
op|')'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'object_controller'
op|'='
name|'object_server'
op|'.'
name|'ObjectController'
op|'('
nl|'\n'
name|'conf'
op|','
name|'logger'
op|'='
name|'debug_logger'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|'.'
name|'allowed_headers'
op|','
name|'set'
op|'('
name|'dah'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_POST_update_meta
dedent|''
name|'def'
name|'test_POST_update_meta'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# Test swift.obj.server.ObjectController.POST'
nl|'\n'
indent|'        '
name|'original_headers'
op|'='
name|'self'
op|'.'
name|'object_controller'
op|'.'
name|'allowed_headers'
newline|'\n'
name|'test_headers'
op|'='
string|"'content-encoding foo bar'"
op|'.'
name|'split'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'object_controller'
op|'.'
name|'allowed_headers'
op|'='
name|'set'
op|'('
name|'test_headers'
op|')'
newline|'\n'
name|'timestamp'
op|'='
name|'normalize_timestamp'
op|'('
name|'time'
op|'('
op|')'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'timestamp'
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'application/x-test'"
op|','
nl|'\n'
string|"'Foo'"
op|':'
string|"'fooheader'"
op|','
nl|'\n'
string|"'Baz'"
op|':'
string|"'bazheader'"
op|','
nl|'\n'
string|"'X-Object-Meta-1'"
op|':'
string|"'One'"
op|','
nl|'\n'
string|"'X-Object-Meta-Two'"
op|':'
string|"'Two'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'body'
op|'='
string|"'VERIFY'"
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'201'
op|')'
newline|'\n'
nl|'\n'
name|'timestamp'
op|'='
name|'normalize_timestamp'
op|'('
name|'time'
op|'('
op|')'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'POST'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'timestamp'
op|','
nl|'\n'
string|"'X-Object-Meta-3'"
op|':'
string|"'Three'"
op|','
nl|'\n'
string|"'X-Object-Meta-4'"
op|':'
string|"'Four'"
op|','
nl|'\n'
string|"'Content-Encoding'"
op|':'
string|"'gzip'"
op|','
nl|'\n'
string|"'Foo'"
op|':'
string|"'fooheader'"
op|','
nl|'\n'
string|"'Bar'"
op|':'
string|"'barheader'"
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'application/x-test'"
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'202'
op|')'
newline|'\n'
nl|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
string|'"X-Object-Meta-1"'
name|'not'
name|'in'
name|'resp'
op|'.'
name|'headers'
name|'and'
nl|'\n'
string|'"X-Object-Meta-Two"'
name|'not'
name|'in'
name|'resp'
op|'.'
name|'headers'
name|'and'
nl|'\n'
string|'"X-Object-Meta-3"'
name|'in'
name|'resp'
op|'.'
name|'headers'
name|'and'
nl|'\n'
string|'"X-Object-Meta-4"'
name|'in'
name|'resp'
op|'.'
name|'headers'
name|'and'
nl|'\n'
string|'"Foo"'
name|'in'
name|'resp'
op|'.'
name|'headers'
name|'and'
nl|'\n'
string|'"Bar"'
name|'in'
name|'resp'
op|'.'
name|'headers'
name|'and'
nl|'\n'
string|'"Baz"'
name|'not'
name|'in'
name|'resp'
op|'.'
name|'headers'
name|'and'
nl|'\n'
string|'"Content-Encoding"'
name|'in'
name|'resp'
op|'.'
name|'headers'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'['
string|"'Content-Type'"
op|']'
op|','
string|"'application/x-test'"
op|')'
newline|'\n'
nl|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'HEAD'"
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
string|'"X-Object-Meta-1"'
name|'not'
name|'in'
name|'resp'
op|'.'
name|'headers'
name|'and'
nl|'\n'
string|'"X-Object-Meta-Two"'
name|'not'
name|'in'
name|'resp'
op|'.'
name|'headers'
name|'and'
nl|'\n'
string|'"X-Object-Meta-3"'
name|'in'
name|'resp'
op|'.'
name|'headers'
name|'and'
nl|'\n'
string|'"X-Object-Meta-4"'
name|'in'
name|'resp'
op|'.'
name|'headers'
name|'and'
nl|'\n'
string|'"Foo"'
name|'in'
name|'resp'
op|'.'
name|'headers'
name|'and'
nl|'\n'
string|'"Bar"'
name|'in'
name|'resp'
op|'.'
name|'headers'
name|'and'
nl|'\n'
string|'"Baz"'
name|'not'
name|'in'
name|'resp'
op|'.'
name|'headers'
name|'and'
nl|'\n'
string|'"Content-Encoding"'
name|'in'
name|'resp'
op|'.'
name|'headers'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'['
string|"'Content-Type'"
op|']'
op|','
string|"'application/x-test'"
op|')'
newline|'\n'
nl|'\n'
name|'timestamp'
op|'='
name|'normalize_timestamp'
op|'('
name|'time'
op|'('
op|')'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'POST'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'timestamp'
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'application/x-test'"
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'202'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
string|'"X-Object-Meta-3"'
name|'not'
name|'in'
name|'resp'
op|'.'
name|'headers'
name|'and'
nl|'\n'
string|'"X-Object-Meta-4"'
name|'not'
name|'in'
name|'resp'
op|'.'
name|'headers'
name|'and'
nl|'\n'
string|'"Foo"'
name|'not'
name|'in'
name|'resp'
op|'.'
name|'headers'
name|'and'
nl|'\n'
string|'"Bar"'
name|'not'
name|'in'
name|'resp'
op|'.'
name|'headers'
name|'and'
nl|'\n'
string|'"Content-Encoding"'
name|'not'
name|'in'
name|'resp'
op|'.'
name|'headers'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'['
string|"'Content-Type'"
op|']'
op|','
string|"'application/x-test'"
op|')'
newline|'\n'
nl|'\n'
comment|'# test defaults'
nl|'\n'
name|'self'
op|'.'
name|'object_controller'
op|'.'
name|'allowed_headers'
op|'='
name|'original_headers'
newline|'\n'
name|'timestamp'
op|'='
name|'normalize_timestamp'
op|'('
name|'time'
op|'('
op|')'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'timestamp'
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'application/x-test'"
op|','
nl|'\n'
string|"'Foo'"
op|':'
string|"'fooheader'"
op|','
nl|'\n'
string|"'X-Object-Meta-1'"
op|':'
string|"'One'"
op|','
nl|'\n'
string|"'X-Object-Manifest'"
op|':'
string|"'c/bar'"
op|','
nl|'\n'
string|"'Content-Encoding'"
op|':'
string|"'gzip'"
op|','
nl|'\n'
string|"'Content-Disposition'"
op|':'
string|"'bar'"
op|','
nl|'\n'
string|"'X-Static-Large-Object'"
op|':'
string|"'True'"
op|','
nl|'\n'
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'body'
op|'='
string|"'VERIFY'"
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'201'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
string|'"X-Object-Meta-1"'
name|'in'
name|'resp'
op|'.'
name|'headers'
name|'and'
nl|'\n'
string|'"Foo"'
name|'not'
name|'in'
name|'resp'
op|'.'
name|'headers'
name|'and'
nl|'\n'
string|'"Content-Encoding"'
name|'in'
name|'resp'
op|'.'
name|'headers'
name|'and'
nl|'\n'
string|'"X-Object-Manifest"'
name|'in'
name|'resp'
op|'.'
name|'headers'
name|'and'
nl|'\n'
string|'"Content-Disposition"'
name|'in'
name|'resp'
op|'.'
name|'headers'
name|'and'
nl|'\n'
string|'"X-Static-Large-Object"'
name|'in'
name|'resp'
op|'.'
name|'headers'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'['
string|"'Content-Type'"
op|']'
op|','
string|"'application/x-test'"
op|')'
newline|'\n'
nl|'\n'
name|'timestamp'
op|'='
name|'normalize_timestamp'
op|'('
name|'time'
op|'('
op|')'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'POST'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'timestamp'
op|','
nl|'\n'
string|"'X-Object-Meta-3'"
op|':'
string|"'Three'"
op|','
nl|'\n'
string|"'Foo'"
op|':'
string|"'fooheader'"
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'application/x-test'"
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'202'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
string|'"X-Object-Meta-1"'
name|'not'
name|'in'
name|'resp'
op|'.'
name|'headers'
name|'and'
nl|'\n'
string|'"Foo"'
name|'not'
name|'in'
name|'resp'
op|'.'
name|'headers'
name|'and'
nl|'\n'
string|'"Content-Encoding"'
name|'not'
name|'in'
name|'resp'
op|'.'
name|'headers'
name|'and'
nl|'\n'
string|'"X-Object-Manifest"'
name|'not'
name|'in'
name|'resp'
op|'.'
name|'headers'
name|'and'
nl|'\n'
string|'"Content-Disposition"'
name|'not'
name|'in'
name|'resp'
op|'.'
name|'headers'
name|'and'
nl|'\n'
string|'"X-Object-Meta-3"'
name|'in'
name|'resp'
op|'.'
name|'headers'
name|'and'
nl|'\n'
string|'"X-Static-Large-Object"'
name|'in'
name|'resp'
op|'.'
name|'headers'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'['
string|"'Content-Type'"
op|']'
op|','
string|"'application/x-test'"
op|')'
newline|'\n'
nl|'\n'
comment|'# Test for empty metadata'
nl|'\n'
name|'timestamp'
op|'='
name|'normalize_timestamp'
op|'('
name|'time'
op|'('
op|')'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'POST'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'timestamp'
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'application/x-test'"
op|','
nl|'\n'
string|"'X-Object-Meta-3'"
op|':'
string|"''"
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'202'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'['
string|'"x-object-meta-3"'
op|']'
op|','
string|"''"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_POST_old_timestamp
dedent|''
name|'def'
name|'test_POST_old_timestamp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'ts'
op|'='
name|'time'
op|'('
op|')'
newline|'\n'
name|'orig_timestamp'
op|'='
name|'utils'
op|'.'
name|'Timestamp'
op|'('
name|'ts'
op|')'
op|'.'
name|'internal'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'orig_timestamp'
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'application/x-test'"
op|','
nl|'\n'
string|"'X-Object-Meta-1'"
op|':'
string|"'One'"
op|','
nl|'\n'
string|"'X-Object-Meta-Two'"
op|':'
string|"'Two'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'body'
op|'='
string|"'VERIFY'"
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'201'
op|')'
newline|'\n'
nl|'\n'
comment|'# Same timestamp should result in 409'
nl|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'POST'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'orig_timestamp'
op|','
nl|'\n'
string|"'X-Object-Meta-3'"
op|':'
string|"'Three'"
op|','
nl|'\n'
string|"'X-Object-Meta-4'"
op|':'
string|"'Four'"
op|','
nl|'\n'
string|"'Content-Encoding'"
op|':'
string|"'gzip'"
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'application/x-test'"
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'409'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'['
string|"'X-Backend-Timestamp'"
op|']'
op|','
name|'orig_timestamp'
op|')'
newline|'\n'
nl|'\n'
comment|'# Earlier timestamp should result in 409'
nl|'\n'
name|'timestamp'
op|'='
name|'normalize_timestamp'
op|'('
name|'ts'
op|'-'
number|'1'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'POST'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'timestamp'
op|','
nl|'\n'
string|"'X-Object-Meta-5'"
op|':'
string|"'Five'"
op|','
nl|'\n'
string|"'X-Object-Meta-6'"
op|':'
string|"'Six'"
op|','
nl|'\n'
string|"'Content-Encoding'"
op|':'
string|"'gzip'"
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'application/x-test'"
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'409'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'['
string|"'X-Backend-Timestamp'"
op|']'
op|','
name|'orig_timestamp'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_POST_conflicts_with_later_POST
dedent|''
name|'def'
name|'test_POST_conflicts_with_later_POST'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'ts_iter'
op|'='
name|'make_timestamp_iter'
op|'('
op|')'
newline|'\n'
name|'t_put'
op|'='
name|'next'
op|'('
name|'ts_iter'
op|')'
op|'.'
name|'internal'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'t_put'
op|','
nl|'\n'
string|"'Content-Length'"
op|':'
number|'0'
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'plain/text'"
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'201'
op|')'
newline|'\n'
nl|'\n'
name|'t_post1'
op|'='
name|'next'
op|'('
name|'ts_iter'
op|')'
op|'.'
name|'internal'
newline|'\n'
name|'t_post2'
op|'='
name|'next'
op|'('
name|'ts_iter'
op|')'
op|'.'
name|'internal'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'POST'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'t_post2'
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'202'
op|')'
newline|'\n'
nl|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'POST'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'t_post1'
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'409'
op|')'
newline|'\n'
nl|'\n'
name|'obj_dir'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'testdir'
op|','
string|"'sda1'"
op|','
nl|'\n'
name|'storage_directory'
op|'('
name|'diskfile'
op|'.'
name|'get_data_dir'
op|'('
number|'0'
op|')'
op|','
string|"'p'"
op|','
nl|'\n'
name|'hash_path'
op|'('
string|"'a'"
op|','
string|"'c'"
op|','
string|"'o'"
op|')'
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'ts_file'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'obj_dir'
op|','
name|'t_post2'
op|'+'
string|"'.meta'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'isfile'
op|'('
name|'ts_file'
op|')'
op|')'
newline|'\n'
name|'meta_file'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'obj_dir'
op|','
name|'t_post1'
op|'+'
string|"'.meta'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'isfile'
op|'('
name|'meta_file'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_POST_not_exist
dedent|''
name|'def'
name|'test_POST_not_exist'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'timestamp'
op|'='
name|'normalize_timestamp'
op|'('
name|'time'
op|'('
op|')'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/fail'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'POST'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'timestamp'
op|','
nl|'\n'
string|"'X-Object-Meta-1'"
op|':'
string|"'One'"
op|','
nl|'\n'
string|"'X-Object-Meta-2'"
op|':'
string|"'Two'"
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'text/plain'"
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'404'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_POST_invalid_path
dedent|''
name|'def'
name|'test_POST_invalid_path'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'timestamp'
op|'='
name|'normalize_timestamp'
op|'('
name|'time'
op|'('
op|')'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'POST'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'timestamp'
op|','
nl|'\n'
string|"'X-Object-Meta-1'"
op|':'
string|"'One'"
op|','
nl|'\n'
string|"'X-Object-Meta-2'"
op|':'
string|"'Two'"
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'text/plain'"
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'400'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_POST_no_timestamp
dedent|''
name|'def'
name|'test_POST_no_timestamp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'POST'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Object-Meta-1'"
op|':'
string|"'One'"
op|','
nl|'\n'
string|"'X-Object-Meta-2'"
op|':'
string|"'Two'"
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'text/plain'"
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'400'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_POST_bad_timestamp
dedent|''
name|'def'
name|'test_POST_bad_timestamp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'POST'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
string|"'bad'"
op|','
nl|'\n'
string|"'X-Object-Meta-1'"
op|':'
string|"'One'"
op|','
nl|'\n'
string|"'X-Object-Meta-2'"
op|':'
string|"'Two'"
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'text/plain'"
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'400'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_POST_container_connection
dedent|''
name|'def'
name|'test_POST_container_connection'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|function|mock_http_connect
indent|'        '
name|'def'
name|'mock_http_connect'
op|'('
name|'response'
op|','
name|'with_exc'
op|'='
name|'False'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|class|FakeConn
indent|'            '
name|'class'
name|'FakeConn'
op|'('
name|'object'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|member|__init__
indent|'                '
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'status'
op|','
name|'with_exc'
op|')'
op|':'
newline|'\n'
indent|'                    '
name|'self'
op|'.'
name|'status'
op|'='
name|'status'
newline|'\n'
name|'self'
op|'.'
name|'reason'
op|'='
string|"'Fake'"
newline|'\n'
name|'self'
op|'.'
name|'host'
op|'='
string|"'1.2.3.4'"
newline|'\n'
name|'self'
op|'.'
name|'port'
op|'='
string|"'1234'"
newline|'\n'
name|'self'
op|'.'
name|'with_exc'
op|'='
name|'with_exc'
newline|'\n'
nl|'\n'
DECL|member|getresponse
dedent|''
name|'def'
name|'getresponse'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'                    '
name|'if'
name|'self'
op|'.'
name|'with_exc'
op|':'
newline|'\n'
indent|'                        '
name|'raise'
name|'Exception'
op|'('
string|"'test'"
op|')'
newline|'\n'
dedent|''
name|'return'
name|'self'
newline|'\n'
nl|'\n'
DECL|member|read
dedent|''
name|'def'
name|'read'
op|'('
name|'self'
op|','
name|'amt'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
indent|'                    '
name|'return'
string|"''"
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'return'
name|'lambda'
op|'*'
name|'args'
op|','
op|'**'
name|'kwargs'
op|':'
name|'FakeConn'
op|'('
name|'response'
op|','
name|'with_exc'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'ts'
op|'='
name|'time'
op|'('
op|')'
newline|'\n'
name|'timestamp'
op|'='
name|'normalize_timestamp'
op|'('
name|'ts'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'timestamp'
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'text/plain'"
op|','
nl|'\n'
string|"'Content-Length'"
op|':'
string|"'0'"
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'201'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'POST'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'normalize_timestamp'
op|'('
name|'ts'
op|'+'
number|'1'
op|')'
op|','
nl|'\n'
string|"'X-Container-Host'"
op|':'
string|"'1.2.3.4:0'"
op|','
nl|'\n'
string|"'X-Container-Partition'"
op|':'
string|"'3'"
op|','
nl|'\n'
string|"'X-Container-Device'"
op|':'
string|"'sda1'"
op|','
nl|'\n'
string|"'X-Container-Timestamp'"
op|':'
string|"'1'"
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'application/new1'"
op|'}'
op|')'
newline|'\n'
name|'with'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'object_server'
op|','
string|"'http_connect'"
op|','
nl|'\n'
name|'mock_http_connect'
op|'('
number|'202'
op|')'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'202'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'POST'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'normalize_timestamp'
op|'('
name|'ts'
op|'+'
number|'2'
op|')'
op|','
nl|'\n'
string|"'X-Container-Host'"
op|':'
string|"'1.2.3.4:0'"
op|','
nl|'\n'
string|"'X-Container-Partition'"
op|':'
string|"'3'"
op|','
nl|'\n'
string|"'X-Container-Device'"
op|':'
string|"'sda1'"
op|','
nl|'\n'
string|"'X-Container-Timestamp'"
op|':'
string|"'1'"
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'application/new1'"
op|'}'
op|')'
newline|'\n'
name|'with'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'object_server'
op|','
string|"'http_connect'"
op|','
nl|'\n'
name|'mock_http_connect'
op|'('
number|'202'
op|','
name|'with_exc'
op|'='
name|'True'
op|')'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'202'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'POST'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'normalize_timestamp'
op|'('
name|'ts'
op|'+'
number|'3'
op|')'
op|','
nl|'\n'
string|"'X-Container-Host'"
op|':'
string|"'1.2.3.4:0'"
op|','
nl|'\n'
string|"'X-Container-Partition'"
op|':'
string|"'3'"
op|','
nl|'\n'
string|"'X-Container-Device'"
op|':'
string|"'sda1'"
op|','
nl|'\n'
string|"'X-Container-Timestamp'"
op|':'
string|"'1'"
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'application/new2'"
op|'}'
op|')'
newline|'\n'
name|'with'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'object_server'
op|','
string|"'http_connect'"
op|','
nl|'\n'
name|'mock_http_connect'
op|'('
number|'500'
op|')'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'202'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_POST_quarantine_zbyte
dedent|''
name|'def'
name|'test_POST_quarantine_zbyte'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'timestamp'
op|'='
name|'normalize_timestamp'
op|'('
name|'time'
op|'('
op|')'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'timestamp'
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'application/x-test'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'body'
op|'='
string|"'VERIFY'"
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'201'
op|')'
newline|'\n'
nl|'\n'
name|'objfile'
op|'='
name|'self'
op|'.'
name|'df_mgr'
op|'.'
name|'get_diskfile'
op|'('
string|"'sda1'"
op|','
string|"'p'"
op|','
string|"'a'"
op|','
string|"'c'"
op|','
string|"'o'"
op|','
nl|'\n'
name|'policy'
op|'='
name|'POLICIES'
op|'.'
name|'legacy'
op|')'
newline|'\n'
name|'objfile'
op|'.'
name|'open'
op|'('
op|')'
newline|'\n'
name|'file_name'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'basename'
op|'('
name|'objfile'
op|'.'
name|'_data_file'
op|')'
newline|'\n'
name|'with'
name|'open'
op|'('
name|'objfile'
op|'.'
name|'_data_file'
op|')'
name|'as'
name|'fp'
op|':'
newline|'\n'
indent|'            '
name|'metadata'
op|'='
name|'diskfile'
op|'.'
name|'read_metadata'
op|'('
name|'fp'
op|')'
newline|'\n'
dedent|''
name|'os'
op|'.'
name|'unlink'
op|'('
name|'objfile'
op|'.'
name|'_data_file'
op|')'
newline|'\n'
name|'with'
name|'open'
op|'('
name|'objfile'
op|'.'
name|'_data_file'
op|','
string|"'w'"
op|')'
name|'as'
name|'fp'
op|':'
newline|'\n'
indent|'            '
name|'diskfile'
op|'.'
name|'write_metadata'
op|'('
name|'fp'
op|','
name|'metadata'
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'os'
op|'.'
name|'listdir'
op|'('
name|'objfile'
op|'.'
name|'_datadir'
op|')'
op|'['
number|'0'
op|']'
op|','
name|'file_name'
op|')'
newline|'\n'
nl|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'POST'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'normalize_timestamp'
op|'('
name|'time'
op|'('
op|')'
op|')'
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'404'
op|')'
newline|'\n'
nl|'\n'
name|'quar_dir'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'testdir'
op|','
string|"'sda1'"
op|','
string|"'quarantined'"
op|','
string|"'objects'"
op|','
nl|'\n'
name|'os'
op|'.'
name|'path'
op|'.'
name|'basename'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'dirname'
op|'('
name|'objfile'
op|'.'
name|'_data_file'
op|')'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'os'
op|'.'
name|'listdir'
op|'('
name|'quar_dir'
op|')'
op|'['
number|'0'
op|']'
op|','
name|'file_name'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_PUT_invalid_path
dedent|''
name|'def'
name|'test_PUT_invalid_path'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'400'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_PUT_no_timestamp
dedent|''
name|'def'
name|'test_PUT_no_timestamp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|','
nl|'\n'
string|"'CONTENT_LENGTH'"
op|':'
string|"'0'"
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'400'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_PUT_no_content_type
dedent|''
name|'def'
name|'test_PUT_no_content_type'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'normalize_timestamp'
op|'('
name|'time'
op|'('
op|')'
op|')'
op|','
nl|'\n'
string|"'Content-Length'"
op|':'
string|"'6'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'body'
op|'='
string|"'VERIFY'"
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'400'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_PUT_invalid_content_type
dedent|''
name|'def'
name|'test_PUT_invalid_content_type'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'normalize_timestamp'
op|'('
name|'time'
op|'('
op|')'
op|')'
op|','
nl|'\n'
string|"'Content-Length'"
op|':'
string|"'6'"
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'\\xff\\xff'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'body'
op|'='
string|"'VERIFY'"
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'400'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
string|"'Content-Type'"
name|'in'
name|'resp'
op|'.'
name|'body'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_PUT_no_content_length
dedent|''
name|'def'
name|'test_PUT_no_content_length'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'normalize_timestamp'
op|'('
name|'time'
op|'('
op|')'
op|')'
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'application/octet-stream'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'body'
op|'='
string|"'VERIFY'"
newline|'\n'
name|'del'
name|'req'
op|'.'
name|'headers'
op|'['
string|"'Content-Length'"
op|']'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'411'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_PUT_zero_content_length
dedent|''
name|'def'
name|'test_PUT_zero_content_length'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'normalize_timestamp'
op|'('
name|'time'
op|'('
op|')'
op|')'
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'application/octet-stream'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'body'
op|'='
string|"''"
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'req'
op|'.'
name|'headers'
op|'['
string|"'Content-Length'"
op|']'
op|','
string|"'0'"
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'201'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_PUT_bad_transfer_encoding
dedent|''
name|'def'
name|'test_PUT_bad_transfer_encoding'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'normalize_timestamp'
op|'('
name|'time'
op|'('
op|')'
op|')'
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'application/octet-stream'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'body'
op|'='
string|"'VERIFY'"
newline|'\n'
name|'req'
op|'.'
name|'headers'
op|'['
string|"'Transfer-Encoding'"
op|']'
op|'='
string|"'bad'"
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'400'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_PUT_if_none_match_star
dedent|''
name|'def'
name|'test_PUT_if_none_match_star'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# First PUT should succeed'
nl|'\n'
indent|'        '
name|'timestamp'
op|'='
name|'normalize_timestamp'
op|'('
name|'time'
op|'('
op|')'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'timestamp'
op|','
nl|'\n'
string|"'Content-Length'"
op|':'
string|"'6'"
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'application/octet-stream'"
op|','
nl|'\n'
string|"'If-None-Match'"
op|':'
string|"'*'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'body'
op|'='
string|"'VERIFY'"
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'201'
op|')'
newline|'\n'
comment|'# File should already exist so it should fail'
nl|'\n'
name|'timestamp'
op|'='
name|'normalize_timestamp'
op|'('
name|'time'
op|'('
op|')'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'timestamp'
op|','
nl|'\n'
string|"'Content-Length'"
op|':'
string|"'6'"
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'application/octet-stream'"
op|','
nl|'\n'
string|"'If-None-Match'"
op|':'
string|"'*'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'body'
op|'='
string|"'VERIFY'"
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'412'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_PUT_if_none_match
dedent|''
name|'def'
name|'test_PUT_if_none_match'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# PUT with if-none-match set and nothing there should succeed'
nl|'\n'
indent|'        '
name|'timestamp'
op|'='
name|'normalize_timestamp'
op|'('
name|'time'
op|'('
op|')'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'timestamp'
op|','
nl|'\n'
string|"'Content-Length'"
op|':'
string|"'6'"
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'application/octet-stream'"
op|','
nl|'\n'
string|"'If-None-Match'"
op|':'
string|"'notthere'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'body'
op|'='
string|"'VERIFY'"
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'201'
op|')'
newline|'\n'
comment|'# PUT with if-none-match of the object etag should fail'
nl|'\n'
name|'timestamp'
op|'='
name|'normalize_timestamp'
op|'('
name|'time'
op|'('
op|')'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'timestamp'
op|','
nl|'\n'
string|"'Content-Length'"
op|':'
string|"'6'"
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'application/octet-stream'"
op|','
nl|'\n'
string|"'If-None-Match'"
op|':'
string|"'0b4c12d7e0a73840c1c4f148fda3b037'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'body'
op|'='
string|"'VERIFY'"
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'412'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_PUT_common
dedent|''
name|'def'
name|'test_PUT_common'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'timestamp'
op|'='
name|'normalize_timestamp'
op|'('
name|'time'
op|'('
op|')'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'timestamp'
op|','
nl|'\n'
string|"'Content-Length'"
op|':'
string|"'6'"
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'application/octet-stream'"
op|','
nl|'\n'
string|"'x-object-meta-test'"
op|':'
string|"'one'"
op|','
nl|'\n'
string|"'Custom-Header'"
op|':'
string|"'*'"
op|','
nl|'\n'
string|"'X-Backend-Replication-Headers'"
op|':'
nl|'\n'
string|"'Content-Type Content-Length'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'body'
op|'='
string|"'VERIFY'"
newline|'\n'
name|'with'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|','
string|"'allowed_headers'"
op|','
nl|'\n'
op|'['
string|"'Custom-Header'"
op|']'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'object_controller'
op|'.'
name|'allowed_headers'
op|'='
op|'['
string|"'Custom-Header'"
op|']'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'201'
op|')'
newline|'\n'
name|'objfile'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'testdir'
op|','
string|"'sda1'"
op|','
nl|'\n'
name|'storage_directory'
op|'('
name|'diskfile'
op|'.'
name|'get_data_dir'
op|'('
name|'POLICIES'
op|'['
number|'0'
op|']'
op|')'
op|','
nl|'\n'
string|"'p'"
op|','
name|'hash_path'
op|'('
string|"'a'"
op|','
string|"'c'"
op|','
string|"'o'"
op|')'
op|')'
op|','
nl|'\n'
name|'utils'
op|'.'
name|'Timestamp'
op|'('
name|'timestamp'
op|')'
op|'.'
name|'internal'
op|'+'
string|"'.data'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'isfile'
op|'('
name|'objfile'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'open'
op|'('
name|'objfile'
op|')'
op|'.'
name|'read'
op|'('
op|')'
op|','
string|"'VERIFY'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'diskfile'
op|'.'
name|'read_metadata'
op|'('
name|'objfile'
op|')'
op|','
nl|'\n'
op|'{'
string|"'X-Timestamp'"
op|':'
name|'utils'
op|'.'
name|'Timestamp'
op|'('
name|'timestamp'
op|')'
op|'.'
name|'internal'
op|','
nl|'\n'
string|"'Content-Length'"
op|':'
string|"'6'"
op|','
nl|'\n'
string|"'ETag'"
op|':'
string|"'0b4c12d7e0a73840c1c4f148fda3b037'"
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'application/octet-stream'"
op|','
nl|'\n'
string|"'name'"
op|':'
string|"'/a/c/o'"
op|','
nl|'\n'
string|"'X-Object-Meta-Test'"
op|':'
string|"'one'"
op|','
nl|'\n'
string|"'Custom-Header'"
op|':'
string|"'*'"
op|'}'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_PUT_overwrite
dedent|''
name|'def'
name|'test_PUT_overwrite'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'normalize_timestamp'
op|'('
name|'time'
op|'('
op|')'
op|')'
op|','
nl|'\n'
string|"'Content-Length'"
op|':'
string|"'6'"
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'application/octet-stream'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'body'
op|'='
string|"'VERIFY'"
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'201'
op|')'
newline|'\n'
name|'sleep'
op|'('
number|'.00001'
op|')'
newline|'\n'
name|'timestamp'
op|'='
name|'normalize_timestamp'
op|'('
name|'time'
op|'('
op|')'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'timestamp'
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'text/plain'"
op|','
nl|'\n'
string|"'Content-Encoding'"
op|':'
string|"'gzip'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'body'
op|'='
string|"'VERIFY TWO'"
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'201'
op|')'
newline|'\n'
name|'objfile'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'testdir'
op|','
string|"'sda1'"
op|','
nl|'\n'
name|'storage_directory'
op|'('
name|'diskfile'
op|'.'
name|'get_data_dir'
op|'('
name|'POLICIES'
op|'['
number|'0'
op|']'
op|')'
op|','
string|"'p'"
op|','
nl|'\n'
name|'hash_path'
op|'('
string|"'a'"
op|','
string|"'c'"
op|','
string|"'o'"
op|')'
op|')'
op|','
nl|'\n'
name|'utils'
op|'.'
name|'Timestamp'
op|'('
name|'timestamp'
op|')'
op|'.'
name|'internal'
op|'+'
string|"'.data'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'isfile'
op|'('
name|'objfile'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'open'
op|'('
name|'objfile'
op|')'
op|'.'
name|'read'
op|'('
op|')'
op|','
string|"'VERIFY TWO'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'diskfile'
op|'.'
name|'read_metadata'
op|'('
name|'objfile'
op|')'
op|','
nl|'\n'
op|'{'
string|"'X-Timestamp'"
op|':'
name|'utils'
op|'.'
name|'Timestamp'
op|'('
name|'timestamp'
op|')'
op|'.'
name|'internal'
op|','
nl|'\n'
string|"'Content-Length'"
op|':'
string|"'10'"
op|','
nl|'\n'
string|"'ETag'"
op|':'
string|"'b381a4c5dab1eaa1eb9711fa647cd039'"
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'text/plain'"
op|','
nl|'\n'
string|"'name'"
op|':'
string|"'/a/c/o'"
op|','
nl|'\n'
string|"'Content-Encoding'"
op|':'
string|"'gzip'"
op|'}'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_PUT_overwrite_to_older_ts_succcess
dedent|''
name|'def'
name|'test_PUT_overwrite_to_older_ts_succcess'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'ts_iter'
op|'='
name|'make_timestamp_iter'
op|'('
op|')'
newline|'\n'
name|'old_timestamp'
op|'='
name|'next'
op|'('
name|'ts_iter'
op|')'
newline|'\n'
name|'new_timestamp'
op|'='
name|'next'
op|'('
name|'ts_iter'
op|')'
newline|'\n'
nl|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'DELETE'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'old_timestamp'
op|'.'
name|'normal'
op|','
nl|'\n'
string|"'Content-Length'"
op|':'
string|"'0'"
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'application/octet-stream'"
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'404'
op|')'
newline|'\n'
nl|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'new_timestamp'
op|'.'
name|'normal'
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'text/plain'"
op|','
nl|'\n'
string|"'Content-Encoding'"
op|':'
string|"'gzip'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'body'
op|'='
string|"'VERIFY TWO'"
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'201'
op|')'
newline|'\n'
name|'objfile'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'testdir'
op|','
string|"'sda1'"
op|','
nl|'\n'
name|'storage_directory'
op|'('
name|'diskfile'
op|'.'
name|'get_data_dir'
op|'('
name|'POLICIES'
op|'['
number|'0'
op|']'
op|')'
op|','
string|"'p'"
op|','
nl|'\n'
name|'hash_path'
op|'('
string|"'a'"
op|','
string|"'c'"
op|','
string|"'o'"
op|')'
op|')'
op|','
nl|'\n'
name|'new_timestamp'
op|'.'
name|'internal'
op|'+'
string|"'.data'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'isfile'
op|'('
name|'objfile'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'open'
op|'('
name|'objfile'
op|')'
op|'.'
name|'read'
op|'('
op|')'
op|','
string|"'VERIFY TWO'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
nl|'\n'
name|'diskfile'
op|'.'
name|'read_metadata'
op|'('
name|'objfile'
op|')'
op|','
nl|'\n'
op|'{'
string|"'X-Timestamp'"
op|':'
name|'new_timestamp'
op|'.'
name|'internal'
op|','
nl|'\n'
string|"'Content-Length'"
op|':'
string|"'10'"
op|','
nl|'\n'
string|"'ETag'"
op|':'
string|"'b381a4c5dab1eaa1eb9711fa647cd039'"
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'text/plain'"
op|','
nl|'\n'
string|"'name'"
op|':'
string|"'/a/c/o'"
op|','
nl|'\n'
string|"'Content-Encoding'"
op|':'
string|"'gzip'"
op|'}'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_PUT_overwrite_to_newer_ts_failed
dedent|''
name|'def'
name|'test_PUT_overwrite_to_newer_ts_failed'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'ts_iter'
op|'='
name|'make_timestamp_iter'
op|'('
op|')'
newline|'\n'
name|'old_timestamp'
op|'='
name|'next'
op|'('
name|'ts_iter'
op|')'
newline|'\n'
name|'new_timestamp'
op|'='
name|'next'
op|'('
name|'ts_iter'
op|')'
newline|'\n'
nl|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'DELETE'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'new_timestamp'
op|'.'
name|'normal'
op|','
nl|'\n'
string|"'Content-Length'"
op|':'
string|"'0'"
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'application/octet-stream'"
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'404'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'old_timestamp'
op|'.'
name|'normal'
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'text/plain'"
op|','
nl|'\n'
string|"'Content-Encoding'"
op|':'
string|"'gzip'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'body'
op|'='
string|"'VERIFY TWO'"
newline|'\n'
nl|'\n'
name|'with'
name|'mock'
op|'.'
name|'patch'
op|'('
nl|'\n'
string|"'swift.obj.diskfile.BaseDiskFile.create'"
op|')'
name|'as'
name|'mock_create'
op|':'
newline|'\n'
indent|'            '
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'409'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'mock_create'
op|'.'
name|'call_count'
op|','
number|'0'
op|')'
newline|'\n'
nl|'\n'
comment|"# data file doesn't exist there (This is sanity because"
nl|'\n'
comment|'# if .data written unexpectedly, it will be removed'
nl|'\n'
comment|'# by hash_cleanup_list_dir)'
nl|'\n'
name|'datafile'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'testdir'
op|','
string|"'sda1'"
op|','
nl|'\n'
name|'storage_directory'
op|'('
name|'diskfile'
op|'.'
name|'get_data_dir'
op|'('
name|'POLICIES'
op|'['
number|'0'
op|']'
op|')'
op|','
string|"'p'"
op|','
nl|'\n'
name|'hash_path'
op|'('
string|"'a'"
op|','
string|"'c'"
op|','
string|"'o'"
op|')'
op|')'
op|','
nl|'\n'
name|'old_timestamp'
op|'.'
name|'internal'
op|'+'
string|"'.data'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'exists'
op|'('
name|'datafile'
op|')'
op|')'
newline|'\n'
nl|'\n'
comment|'# ts file sitll exists'
nl|'\n'
name|'tsfile'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'testdir'
op|','
string|"'sda1'"
op|','
nl|'\n'
name|'storage_directory'
op|'('
name|'diskfile'
op|'.'
name|'get_data_dir'
op|'('
name|'POLICIES'
op|'['
number|'0'
op|']'
op|')'
op|','
string|"'p'"
op|','
nl|'\n'
name|'hash_path'
op|'('
string|"'a'"
op|','
string|"'c'"
op|','
string|"'o'"
op|')'
op|')'
op|','
nl|'\n'
name|'new_timestamp'
op|'.'
name|'internal'
op|'+'
string|"'.ts'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'isfile'
op|'('
name|'tsfile'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_PUT_overwrite_w_delete_at
dedent|''
name|'def'
name|'test_PUT_overwrite_w_delete_at'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'normalize_timestamp'
op|'('
name|'time'
op|'('
op|')'
op|')'
op|','
nl|'\n'
string|"'X-Delete-At'"
op|':'
number|'9999999999'
op|','
nl|'\n'
string|"'Content-Length'"
op|':'
string|"'6'"
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'application/octet-stream'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'body'
op|'='
string|"'VERIFY'"
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'201'
op|')'
newline|'\n'
name|'sleep'
op|'('
number|'.00001'
op|')'
newline|'\n'
name|'timestamp'
op|'='
name|'normalize_timestamp'
op|'('
name|'time'
op|'('
op|')'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'timestamp'
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'text/plain'"
op|','
nl|'\n'
string|"'Content-Encoding'"
op|':'
string|"'gzip'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'body'
op|'='
string|"'VERIFY TWO'"
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'201'
op|')'
newline|'\n'
name|'objfile'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'testdir'
op|','
string|"'sda1'"
op|','
nl|'\n'
name|'storage_directory'
op|'('
name|'diskfile'
op|'.'
name|'get_data_dir'
op|'('
name|'POLICIES'
op|'['
number|'0'
op|']'
op|')'
op|','
string|"'p'"
op|','
nl|'\n'
name|'hash_path'
op|'('
string|"'a'"
op|','
string|"'c'"
op|','
string|"'o'"
op|')'
op|')'
op|','
nl|'\n'
name|'utils'
op|'.'
name|'Timestamp'
op|'('
name|'timestamp'
op|')'
op|'.'
name|'internal'
op|'+'
string|"'.data'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'isfile'
op|'('
name|'objfile'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'open'
op|'('
name|'objfile'
op|')'
op|'.'
name|'read'
op|'('
op|')'
op|','
string|"'VERIFY TWO'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'diskfile'
op|'.'
name|'read_metadata'
op|'('
name|'objfile'
op|')'
op|','
nl|'\n'
op|'{'
string|"'X-Timestamp'"
op|':'
name|'utils'
op|'.'
name|'Timestamp'
op|'('
name|'timestamp'
op|')'
op|'.'
name|'internal'
op|','
nl|'\n'
string|"'Content-Length'"
op|':'
string|"'10'"
op|','
nl|'\n'
string|"'ETag'"
op|':'
string|"'b381a4c5dab1eaa1eb9711fa647cd039'"
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'text/plain'"
op|','
nl|'\n'
string|"'name'"
op|':'
string|"'/a/c/o'"
op|','
nl|'\n'
string|"'Content-Encoding'"
op|':'
string|"'gzip'"
op|'}'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_PUT_old_timestamp
dedent|''
name|'def'
name|'test_PUT_old_timestamp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'ts'
op|'='
name|'time'
op|'('
op|')'
newline|'\n'
name|'orig_timestamp'
op|'='
name|'utils'
op|'.'
name|'Timestamp'
op|'('
name|'ts'
op|')'
op|'.'
name|'internal'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'orig_timestamp'
op|','
nl|'\n'
string|"'Content-Length'"
op|':'
string|"'6'"
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'application/octet-stream'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'body'
op|'='
string|"'VERIFY'"
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'201'
op|')'
newline|'\n'
nl|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'normalize_timestamp'
op|'('
name|'ts'
op|')'
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'text/plain'"
op|','
nl|'\n'
string|"'Content-Encoding'"
op|':'
string|"'gzip'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'body'
op|'='
string|"'VERIFY TWO'"
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'409'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'['
string|"'X-Backend-Timestamp'"
op|']'
op|','
name|'orig_timestamp'
op|')'
newline|'\n'
nl|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
nl|'\n'
string|"'X-Timestamp'"
op|':'
name|'normalize_timestamp'
op|'('
name|'ts'
op|'-'
number|'1'
op|')'
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'text/plain'"
op|','
nl|'\n'
string|"'Content-Encoding'"
op|':'
string|"'gzip'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'body'
op|'='
string|"'VERIFY THREE'"
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'409'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'['
string|"'X-Backend-Timestamp'"
op|']'
op|','
name|'orig_timestamp'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_PUT_new_object_really_old_timestamp
dedent|''
name|'def'
name|'test_PUT_new_object_really_old_timestamp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
string|"'-1'"
op|','
comment|'# 1969-12-31 23:59:59'
nl|'\n'
string|"'Content-Length'"
op|':'
string|"'6'"
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'application/octet-stream'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'body'
op|'='
string|"'VERIFY'"
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'400'
op|')'
newline|'\n'
nl|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
string|"'1'"
op|','
comment|'# 1970-01-01 00:00:01'
nl|'\n'
string|"'Content-Length'"
op|':'
string|"'6'"
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'application/octet-stream'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'body'
op|'='
string|"'VERIFY'"
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'201'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_PUT_object_really_new_timestamp
dedent|''
name|'def'
name|'test_PUT_object_really_new_timestamp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
string|"'9999999999'"
op|','
comment|'# 2286-11-20 17:46:40'
nl|'\n'
string|"'Content-Length'"
op|':'
string|"'6'"
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'application/octet-stream'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'body'
op|'='
string|"'VERIFY'"
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'201'
op|')'
newline|'\n'
nl|'\n'
comment|'# roll over to 11 digits before the decimal'
nl|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
string|"'10000000000'"
op|','
nl|'\n'
string|"'Content-Length'"
op|':'
string|"'6'"
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'application/octet-stream'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'body'
op|'='
string|"'VERIFY'"
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'400'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_PUT_no_etag
dedent|''
name|'def'
name|'test_PUT_no_etag'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'normalize_timestamp'
op|'('
name|'time'
op|'('
op|')'
op|')'
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'text/plain'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'body'
op|'='
string|"'test'"
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'201'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_PUT_invalid_etag
dedent|''
name|'def'
name|'test_PUT_invalid_etag'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'normalize_timestamp'
op|'('
name|'time'
op|'('
op|')'
op|')'
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'text/plain'"
op|','
nl|'\n'
string|"'ETag'"
op|':'
string|"'invalid'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'body'
op|'='
string|"'test'"
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'422'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_PUT_user_metadata
dedent|''
name|'def'
name|'test_PUT_user_metadata'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'timestamp'
op|'='
name|'normalize_timestamp'
op|'('
name|'time'
op|'('
op|')'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'timestamp'
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'text/plain'"
op|','
nl|'\n'
string|"'ETag'"
op|':'
string|"'b114ab7b90d9ccac4bd5d99cc7ebb568'"
op|','
nl|'\n'
string|"'X-Object-Meta-1'"
op|':'
string|"'One'"
op|','
nl|'\n'
string|"'X-Object-Meta-Two'"
op|':'
string|"'Two'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'body'
op|'='
string|"'VERIFY THREE'"
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'201'
op|')'
newline|'\n'
name|'objfile'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'testdir'
op|','
string|"'sda1'"
op|','
nl|'\n'
name|'storage_directory'
op|'('
name|'diskfile'
op|'.'
name|'get_data_dir'
op|'('
name|'POLICIES'
op|'['
number|'0'
op|']'
op|')'
op|','
string|"'p'"
op|','
nl|'\n'
name|'hash_path'
op|'('
string|"'a'"
op|','
string|"'c'"
op|','
string|"'o'"
op|')'
op|')'
op|','
nl|'\n'
name|'utils'
op|'.'
name|'Timestamp'
op|'('
name|'timestamp'
op|')'
op|'.'
name|'internal'
op|'+'
string|"'.data'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'isfile'
op|'('
name|'objfile'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'open'
op|'('
name|'objfile'
op|')'
op|'.'
name|'read'
op|'('
op|')'
op|','
string|"'VERIFY THREE'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'diskfile'
op|'.'
name|'read_metadata'
op|'('
name|'objfile'
op|')'
op|','
nl|'\n'
op|'{'
string|"'X-Timestamp'"
op|':'
name|'utils'
op|'.'
name|'Timestamp'
op|'('
name|'timestamp'
op|')'
op|'.'
name|'internal'
op|','
nl|'\n'
string|"'Content-Length'"
op|':'
string|"'12'"
op|','
nl|'\n'
string|"'ETag'"
op|':'
string|"'b114ab7b90d9ccac4bd5d99cc7ebb568'"
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'text/plain'"
op|','
nl|'\n'
string|"'name'"
op|':'
string|"'/a/c/o'"
op|','
nl|'\n'
string|"'X-Object-Meta-1'"
op|':'
string|"'One'"
op|','
nl|'\n'
string|"'X-Object-Meta-Two'"
op|':'
string|"'Two'"
op|'}'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_PUT_etag_in_footer
dedent|''
name|'def'
name|'test_PUT_etag_in_footer'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'timestamp'
op|'='
name|'normalize_timestamp'
op|'('
name|'time'
op|'('
op|')'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'timestamp'
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'text/plain'"
op|','
nl|'\n'
string|"'Transfer-Encoding'"
op|':'
string|"'chunked'"
op|','
nl|'\n'
string|"'Etag'"
op|':'
string|"'other-etag'"
op|','
nl|'\n'
string|"'X-Backend-Obj-Metadata-Footer'"
op|':'
string|"'yes'"
op|','
nl|'\n'
string|"'X-Backend-Obj-Multipart-Mime-Boundary'"
op|':'
string|"'boundary'"
op|'}'
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|')'
newline|'\n'
nl|'\n'
name|'obj_etag'
op|'='
name|'md5'
op|'('
string|'"obj data"'
op|')'
op|'.'
name|'hexdigest'
op|'('
op|')'
newline|'\n'
name|'footer_meta'
op|'='
name|'json'
op|'.'
name|'dumps'
op|'('
op|'{'
string|'"Etag"'
op|':'
name|'obj_etag'
op|'}'
op|')'
newline|'\n'
name|'footer_meta_cksum'
op|'='
name|'md5'
op|'('
name|'footer_meta'
op|')'
op|'.'
name|'hexdigest'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'req'
op|'.'
name|'body'
op|'='
string|'"\\r\\n"'
op|'.'
name|'join'
op|'('
op|'('
nl|'\n'
string|'"--boundary"'
op|','
nl|'\n'
string|'""'
op|','
nl|'\n'
string|'"obj data"'
op|','
nl|'\n'
string|'"--boundary"'
op|','
nl|'\n'
string|'"Content-MD5: "'
op|'+'
name|'footer_meta_cksum'
op|','
nl|'\n'
string|'""'
op|','
nl|'\n'
name|'footer_meta'
op|','
nl|'\n'
string|'"--boundary--"'
op|','
nl|'\n'
op|')'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'headers'
op|'.'
name|'pop'
op|'('
string|'"Content-Length"'
op|','
name|'None'
op|')'
newline|'\n'
nl|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'etag'
op|','
name|'obj_etag'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'201'
op|')'
newline|'\n'
nl|'\n'
name|'objfile'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'testdir'
op|','
string|"'sda1'"
op|','
nl|'\n'
name|'storage_directory'
op|'('
name|'diskfile'
op|'.'
name|'get_data_dir'
op|'('
name|'POLICIES'
op|'['
number|'0'
op|']'
op|')'
op|','
string|"'p'"
op|','
nl|'\n'
name|'hash_path'
op|'('
string|"'a'"
op|','
string|"'c'"
op|','
string|"'o'"
op|')'
op|')'
op|','
nl|'\n'
name|'utils'
op|'.'
name|'Timestamp'
op|'('
name|'timestamp'
op|')'
op|'.'
name|'internal'
op|'+'
string|"'.data'"
op|')'
newline|'\n'
name|'with'
name|'open'
op|'('
name|'objfile'
op|')'
name|'as'
name|'fh'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'fh'
op|'.'
name|'read'
op|'('
op|')'
op|','
string|'"obj data"'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_PUT_etag_in_footer_mismatch
dedent|''
dedent|''
name|'def'
name|'test_PUT_etag_in_footer_mismatch'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'timestamp'
op|'='
name|'normalize_timestamp'
op|'('
name|'time'
op|'('
op|')'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'timestamp'
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'text/plain'"
op|','
nl|'\n'
string|"'Transfer-Encoding'"
op|':'
string|"'chunked'"
op|','
nl|'\n'
string|"'X-Backend-Obj-Metadata-Footer'"
op|':'
string|"'yes'"
op|','
nl|'\n'
string|"'X-Backend-Obj-Multipart-Mime-Boundary'"
op|':'
string|"'boundary'"
op|'}'
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|')'
newline|'\n'
nl|'\n'
name|'footer_meta'
op|'='
name|'json'
op|'.'
name|'dumps'
op|'('
op|'{'
string|'"Etag"'
op|':'
name|'md5'
op|'('
string|'"green"'
op|')'
op|'.'
name|'hexdigest'
op|'('
op|')'
op|'}'
op|')'
newline|'\n'
name|'footer_meta_cksum'
op|'='
name|'md5'
op|'('
name|'footer_meta'
op|')'
op|'.'
name|'hexdigest'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'req'
op|'.'
name|'body'
op|'='
string|'"\\r\\n"'
op|'.'
name|'join'
op|'('
op|'('
nl|'\n'
string|'"--boundary"'
op|','
nl|'\n'
string|'""'
op|','
nl|'\n'
string|'"blue"'
op|','
nl|'\n'
string|'"--boundary"'
op|','
nl|'\n'
string|'"Content-MD5: "'
op|'+'
name|'footer_meta_cksum'
op|','
nl|'\n'
string|'""'
op|','
nl|'\n'
name|'footer_meta'
op|','
nl|'\n'
string|'"--boundary--"'
op|','
nl|'\n'
op|')'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'headers'
op|'.'
name|'pop'
op|'('
string|'"Content-Length"'
op|','
name|'None'
op|')'
newline|'\n'
nl|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'422'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_PUT_meta_in_footer
dedent|''
name|'def'
name|'test_PUT_meta_in_footer'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'timestamp'
op|'='
name|'normalize_timestamp'
op|'('
name|'time'
op|'('
op|')'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'timestamp'
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'text/plain'"
op|','
nl|'\n'
string|"'Transfer-Encoding'"
op|':'
string|"'chunked'"
op|','
nl|'\n'
string|"'X-Object-Meta-X'"
op|':'
string|"'Z'"
op|','
nl|'\n'
string|"'X-Object-Sysmeta-X'"
op|':'
string|"'Z'"
op|','
nl|'\n'
string|"'X-Backend-Obj-Metadata-Footer'"
op|':'
string|"'yes'"
op|','
nl|'\n'
string|"'X-Backend-Obj-Multipart-Mime-Boundary'"
op|':'
string|"'boundary'"
op|'}'
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|')'
newline|'\n'
nl|'\n'
name|'footer_meta'
op|'='
name|'json'
op|'.'
name|'dumps'
op|'('
op|'{'
nl|'\n'
string|"'X-Object-Meta-X'"
op|':'
string|"'Y'"
op|','
nl|'\n'
string|"'X-Object-Sysmeta-X'"
op|':'
string|"'Y'"
op|','
nl|'\n'
op|'}'
op|')'
newline|'\n'
name|'footer_meta_cksum'
op|'='
name|'md5'
op|'('
name|'footer_meta'
op|')'
op|'.'
name|'hexdigest'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'req'
op|'.'
name|'body'
op|'='
string|'"\\r\\n"'
op|'.'
name|'join'
op|'('
op|'('
nl|'\n'
string|'"--boundary"'
op|','
nl|'\n'
string|'""'
op|','
nl|'\n'
string|'"stuff stuff stuff"'
op|','
nl|'\n'
string|'"--boundary"'
op|','
nl|'\n'
string|'"Content-MD5: "'
op|'+'
name|'footer_meta_cksum'
op|','
nl|'\n'
string|'""'
op|','
nl|'\n'
name|'footer_meta'
op|','
nl|'\n'
string|'"--boundary--"'
op|','
nl|'\n'
op|')'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'headers'
op|'.'
name|'pop'
op|'('
string|'"Content-Length"'
op|','
name|'None'
op|')'
newline|'\n'
nl|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'201'
op|')'
newline|'\n'
nl|'\n'
name|'timestamp'
op|'='
name|'normalize_timestamp'
op|'('
name|'time'
op|'('
op|')'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'timestamp'
op|'}'
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'HEAD'"
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'.'
name|'get'
op|'('
string|"'X-Object-Meta-X'"
op|')'
op|','
string|"'Y'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'.'
name|'get'
op|'('
string|"'X-Object-Sysmeta-X'"
op|')'
op|','
string|"'Y'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_PUT_missing_footer_checksum
dedent|''
name|'def'
name|'test_PUT_missing_footer_checksum'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'timestamp'
op|'='
name|'normalize_timestamp'
op|'('
name|'time'
op|'('
op|')'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'timestamp'
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'text/plain'"
op|','
nl|'\n'
string|"'Transfer-Encoding'"
op|':'
string|"'chunked'"
op|','
nl|'\n'
string|"'X-Backend-Obj-Metadata-Footer'"
op|':'
string|"'yes'"
op|','
nl|'\n'
string|"'X-Backend-Obj-Multipart-Mime-Boundary'"
op|':'
string|"'boundary'"
op|'}'
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|')'
newline|'\n'
nl|'\n'
name|'footer_meta'
op|'='
name|'json'
op|'.'
name|'dumps'
op|'('
op|'{'
string|'"Etag"'
op|':'
name|'md5'
op|'('
string|'"obj data"'
op|')'
op|'.'
name|'hexdigest'
op|'('
op|')'
op|'}'
op|')'
newline|'\n'
nl|'\n'
name|'req'
op|'.'
name|'body'
op|'='
string|'"\\r\\n"'
op|'.'
name|'join'
op|'('
op|'('
nl|'\n'
string|'"--boundary"'
op|','
nl|'\n'
string|'""'
op|','
nl|'\n'
string|'"obj data"'
op|','
nl|'\n'
string|'"--boundary"'
op|','
nl|'\n'
comment|'# no Content-MD5'
nl|'\n'
string|'""'
op|','
nl|'\n'
name|'footer_meta'
op|','
nl|'\n'
string|'"--boundary--"'
op|','
nl|'\n'
op|')'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'headers'
op|'.'
name|'pop'
op|'('
string|'"Content-Length"'
op|','
name|'None'
op|')'
newline|'\n'
nl|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'400'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_PUT_bad_footer_checksum
dedent|''
name|'def'
name|'test_PUT_bad_footer_checksum'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'timestamp'
op|'='
name|'normalize_timestamp'
op|'('
name|'time'
op|'('
op|')'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'timestamp'
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'text/plain'"
op|','
nl|'\n'
string|"'Transfer-Encoding'"
op|':'
string|"'chunked'"
op|','
nl|'\n'
string|"'X-Backend-Obj-Metadata-Footer'"
op|':'
string|"'yes'"
op|','
nl|'\n'
string|"'X-Backend-Obj-Multipart-Mime-Boundary'"
op|':'
string|"'boundary'"
op|'}'
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|')'
newline|'\n'
nl|'\n'
name|'footer_meta'
op|'='
name|'json'
op|'.'
name|'dumps'
op|'('
op|'{'
string|'"Etag"'
op|':'
name|'md5'
op|'('
string|'"obj data"'
op|')'
op|'.'
name|'hexdigest'
op|'('
op|')'
op|'}'
op|')'
newline|'\n'
name|'bad_footer_meta_cksum'
op|'='
name|'md5'
op|'('
name|'footer_meta'
op|'+'
string|'"bad"'
op|')'
op|'.'
name|'hexdigest'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'req'
op|'.'
name|'body'
op|'='
string|'"\\r\\n"'
op|'.'
name|'join'
op|'('
op|'('
nl|'\n'
string|'"--boundary"'
op|','
nl|'\n'
string|'""'
op|','
nl|'\n'
string|'"obj data"'
op|','
nl|'\n'
string|'"--boundary"'
op|','
nl|'\n'
string|'"Content-MD5: "'
op|'+'
name|'bad_footer_meta_cksum'
op|','
nl|'\n'
string|'""'
op|','
nl|'\n'
name|'footer_meta'
op|','
nl|'\n'
string|'"--boundary--"'
op|','
nl|'\n'
op|')'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'headers'
op|'.'
name|'pop'
op|'('
string|'"Content-Length"'
op|','
name|'None'
op|')'
newline|'\n'
nl|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'422'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_PUT_bad_footer_json
dedent|''
name|'def'
name|'test_PUT_bad_footer_json'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'timestamp'
op|'='
name|'normalize_timestamp'
op|'('
name|'time'
op|'('
op|')'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'timestamp'
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'text/plain'"
op|','
nl|'\n'
string|"'Transfer-Encoding'"
op|':'
string|"'chunked'"
op|','
nl|'\n'
string|"'X-Backend-Obj-Metadata-Footer'"
op|':'
string|"'yes'"
op|','
nl|'\n'
string|"'X-Backend-Obj-Multipart-Mime-Boundary'"
op|':'
string|"'boundary'"
op|'}'
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|')'
newline|'\n'
nl|'\n'
name|'footer_meta'
op|'='
string|'"{{{[[{{[{[[{[{[[{{{[{{{{[[{{[{["'
newline|'\n'
name|'footer_meta_cksum'
op|'='
name|'md5'
op|'('
name|'footer_meta'
op|')'
op|'.'
name|'hexdigest'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'req'
op|'.'
name|'body'
op|'='
string|'"\\r\\n"'
op|'.'
name|'join'
op|'('
op|'('
nl|'\n'
string|'"--boundary"'
op|','
nl|'\n'
string|'""'
op|','
nl|'\n'
string|'"obj data"'
op|','
nl|'\n'
string|'"--boundary"'
op|','
nl|'\n'
string|'"Content-MD5: "'
op|'+'
name|'footer_meta_cksum'
op|','
nl|'\n'
string|'""'
op|','
nl|'\n'
name|'footer_meta'
op|','
nl|'\n'
string|'"--boundary--"'
op|','
nl|'\n'
op|')'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'headers'
op|'.'
name|'pop'
op|'('
string|'"Content-Length"'
op|','
name|'None'
op|')'
newline|'\n'
nl|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'400'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_PUT_extra_mime_docs_ignored
dedent|''
name|'def'
name|'test_PUT_extra_mime_docs_ignored'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'timestamp'
op|'='
name|'normalize_timestamp'
op|'('
name|'time'
op|'('
op|')'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'timestamp'
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'text/plain'"
op|','
nl|'\n'
string|"'Transfer-Encoding'"
op|':'
string|"'chunked'"
op|','
nl|'\n'
string|"'X-Backend-Obj-Metadata-Footer'"
op|':'
string|"'yes'"
op|','
nl|'\n'
string|"'X-Backend-Obj-Multipart-Mime-Boundary'"
op|':'
string|"'boundary'"
op|'}'
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|')'
newline|'\n'
nl|'\n'
name|'footer_meta'
op|'='
name|'json'
op|'.'
name|'dumps'
op|'('
op|'{'
string|"'X-Object-Meta-Mint'"
op|':'
string|"'pepper'"
op|'}'
op|')'
newline|'\n'
name|'footer_meta_cksum'
op|'='
name|'md5'
op|'('
name|'footer_meta'
op|')'
op|'.'
name|'hexdigest'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'req'
op|'.'
name|'body'
op|'='
string|'"\\r\\n"'
op|'.'
name|'join'
op|'('
op|'('
nl|'\n'
string|'"--boundary"'
op|','
nl|'\n'
string|'""'
op|','
nl|'\n'
string|'"obj data"'
op|','
nl|'\n'
string|'"--boundary"'
op|','
nl|'\n'
string|'"Content-MD5: "'
op|'+'
name|'footer_meta_cksum'
op|','
nl|'\n'
string|'""'
op|','
nl|'\n'
name|'footer_meta'
op|','
nl|'\n'
string|'"--boundary"'
op|','
nl|'\n'
string|'"This-Document-Is-Useless: yes"'
op|','
nl|'\n'
string|'""'
op|','
nl|'\n'
string|'"blah blah I take up space"'
op|','
nl|'\n'
string|'"--boundary--"'
nl|'\n'
op|')'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'headers'
op|'.'
name|'pop'
op|'('
string|'"Content-Length"'
op|','
name|'None'
op|')'
newline|'\n'
nl|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'201'
op|')'
newline|'\n'
nl|'\n'
comment|'# swob made this into a StringIO for us'
nl|'\n'
name|'wsgi_input'
op|'='
name|'req'
op|'.'
name|'environ'
op|'['
string|"'wsgi.input'"
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'wsgi_input'
op|'.'
name|'tell'
op|'('
op|')'
op|','
name|'len'
op|'('
name|'wsgi_input'
op|'.'
name|'getvalue'
op|'('
op|')'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_PUT_user_metadata_no_xattr
dedent|''
name|'def'
name|'test_PUT_user_metadata_no_xattr'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'timestamp'
op|'='
name|'normalize_timestamp'
op|'('
name|'time'
op|'('
op|')'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'timestamp'
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'text/plain'"
op|','
nl|'\n'
string|"'ETag'"
op|':'
string|"'b114ab7b90d9ccac4bd5d99cc7ebb568'"
op|','
nl|'\n'
string|"'X-Object-Meta-1'"
op|':'
string|"'One'"
op|','
nl|'\n'
string|"'X-Object-Meta-Two'"
op|':'
string|"'Two'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'body'
op|'='
string|"'VERIFY THREE'"
newline|'\n'
nl|'\n'
DECL|function|mock_get_and_setxattr
name|'def'
name|'mock_get_and_setxattr'
op|'('
op|'*'
name|'args'
op|','
op|'**'
name|'kargs'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'error_num'
op|'='
name|'errno'
op|'.'
name|'ENOTSUP'
name|'if'
name|'hasattr'
op|'('
name|'errno'
op|','
string|"'ENOTSUP'"
op|')'
name|'else'
name|'errno'
op|'.'
name|'EOPNOTSUPP'
newline|'\n'
name|'raise'
name|'IOError'
op|'('
name|'error_num'
op|','
string|"'Operation not supported'"
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'with'
name|'mock'
op|'.'
name|'patch'
op|'('
string|"'xattr.getxattr'"
op|','
name|'mock_get_and_setxattr'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'with'
name|'mock'
op|'.'
name|'patch'
op|'('
string|"'xattr.setxattr'"
op|','
name|'mock_get_and_setxattr'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'507'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_PUT_client_timeout
dedent|''
dedent|''
dedent|''
name|'def'
name|'test_PUT_client_timeout'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
DECL|class|FakeTimeout
indent|'        '
name|'class'
name|'FakeTimeout'
op|'('
name|'BaseException'
op|')'
op|':'
newline|'\n'
DECL|member|__enter__
indent|'            '
name|'def'
name|'__enter__'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'raise'
name|'self'
newline|'\n'
nl|'\n'
DECL|member|__exit__
dedent|''
name|'def'
name|'__exit__'
op|'('
name|'self'
op|','
name|'typ'
op|','
name|'value'
op|','
name|'tb'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'pass'
newline|'\n'
comment|'# This is just so the test fails when run on older object server code'
nl|'\n'
comment|'# instead of exploding.'
nl|'\n'
dedent|''
dedent|''
name|'if'
name|'not'
name|'hasattr'
op|'('
name|'object_server'
op|','
string|"'ChunkReadTimeout'"
op|')'
op|':'
newline|'\n'
indent|'            '
name|'object_server'
op|'.'
name|'ChunkReadTimeout'
op|'='
name|'None'
newline|'\n'
dedent|''
name|'with'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'object_server'
op|','
string|"'ChunkReadTimeout'"
op|','
name|'FakeTimeout'
op|')'
op|':'
newline|'\n'
DECL|variable|timestamp
indent|'            '
name|'timestamp'
op|'='
name|'normalize_timestamp'
op|'('
name|'time'
op|'('
op|')'
op|')'
newline|'\n'
DECL|variable|req
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'timestamp'
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'text/plain'"
op|','
nl|'\n'
string|"'Content-Length'"
op|':'
string|"'6'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'environ'
op|'['
string|"'wsgi.input'"
op|']'
op|'='
name|'WsgiBytesIO'
op|'('
string|"b'VERIFY'"
op|')'
newline|'\n'
DECL|variable|resp
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'408'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_PUT_system_metadata
dedent|''
dedent|''
name|'def'
name|'test_PUT_system_metadata'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# check that sysmeta is stored in diskfile'
nl|'\n'
indent|'        '
name|'timestamp'
op|'='
name|'normalize_timestamp'
op|'('
name|'time'
op|'('
op|')'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'timestamp'
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'text/plain'"
op|','
nl|'\n'
string|"'ETag'"
op|':'
string|"'1000d172764c9dbc3a5798a67ec5bb76'"
op|','
nl|'\n'
string|"'X-Object-Meta-1'"
op|':'
string|"'One'"
op|','
nl|'\n'
string|"'X-Object-Sysmeta-1'"
op|':'
string|"'One'"
op|','
nl|'\n'
string|"'X-Object-Sysmeta-Two'"
op|':'
string|"'Two'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'body'
op|'='
string|"'VERIFY SYSMETA'"
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'201'
op|')'
newline|'\n'
name|'objfile'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'testdir'
op|','
string|"'sda1'"
op|','
nl|'\n'
name|'storage_directory'
op|'('
name|'diskfile'
op|'.'
name|'get_data_dir'
op|'('
name|'POLICIES'
op|'['
number|'0'
op|']'
op|')'
op|','
string|"'p'"
op|','
nl|'\n'
name|'hash_path'
op|'('
string|"'a'"
op|','
string|"'c'"
op|','
string|"'o'"
op|')'
op|')'
op|','
nl|'\n'
name|'timestamp'
op|'+'
string|"'.data'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'isfile'
op|'('
name|'objfile'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'open'
op|'('
name|'objfile'
op|')'
op|'.'
name|'read'
op|'('
op|')'
op|','
string|"'VERIFY SYSMETA'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'diskfile'
op|'.'
name|'read_metadata'
op|'('
name|'objfile'
op|')'
op|','
nl|'\n'
op|'{'
string|"'X-Timestamp'"
op|':'
name|'timestamp'
op|','
nl|'\n'
string|"'Content-Length'"
op|':'
string|"'14'"
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'text/plain'"
op|','
nl|'\n'
string|"'ETag'"
op|':'
string|"'1000d172764c9dbc3a5798a67ec5bb76'"
op|','
nl|'\n'
string|"'name'"
op|':'
string|"'/a/c/o'"
op|','
nl|'\n'
string|"'X-Object-Meta-1'"
op|':'
string|"'One'"
op|','
nl|'\n'
string|"'X-Object-Sysmeta-1'"
op|':'
string|"'One'"
op|','
nl|'\n'
string|"'X-Object-Sysmeta-Two'"
op|':'
string|"'Two'"
op|'}'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_PUT_succeeds_with_later_POST
dedent|''
name|'def'
name|'test_PUT_succeeds_with_later_POST'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'ts_iter'
op|'='
name|'make_timestamp_iter'
op|'('
op|')'
newline|'\n'
name|'t_put'
op|'='
name|'next'
op|'('
name|'ts_iter'
op|')'
op|'.'
name|'internal'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'t_put'
op|','
nl|'\n'
string|"'Content-Length'"
op|':'
number|'0'
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'plain/text'"
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'201'
op|')'
newline|'\n'
nl|'\n'
name|'t_put2'
op|'='
name|'next'
op|'('
name|'ts_iter'
op|')'
op|'.'
name|'internal'
newline|'\n'
name|'t_post'
op|'='
name|'next'
op|'('
name|'ts_iter'
op|')'
op|'.'
name|'internal'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'POST'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'t_post'
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'202'
op|')'
newline|'\n'
nl|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'t_put2'
op|','
nl|'\n'
string|"'Content-Length'"
op|':'
number|'0'
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'plain/text'"
op|'}'
op|','
nl|'\n'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'201'
op|')'
newline|'\n'
nl|'\n'
name|'obj_dir'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'testdir'
op|','
string|"'sda1'"
op|','
nl|'\n'
name|'storage_directory'
op|'('
name|'diskfile'
op|'.'
name|'get_data_dir'
op|'('
number|'0'
op|')'
op|','
string|"'p'"
op|','
nl|'\n'
name|'hash_path'
op|'('
string|"'a'"
op|','
string|"'c'"
op|','
string|"'o'"
op|')'
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'ts_file'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'obj_dir'
op|','
name|'t_put2'
op|'+'
string|"'.data'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'isfile'
op|'('
name|'ts_file'
op|')'
op|')'
newline|'\n'
name|'meta_file'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'obj_dir'
op|','
name|'t_post'
op|'+'
string|"'.meta'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'isfile'
op|'('
name|'meta_file'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_POST_system_metadata
dedent|''
name|'def'
name|'test_POST_system_metadata'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# check that diskfile sysmeta is not changed by a POST'
nl|'\n'
indent|'        '
name|'timestamp1'
op|'='
name|'normalize_timestamp'
op|'('
name|'time'
op|'('
op|')'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'timestamp1'
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'text/plain'"
op|','
nl|'\n'
string|"'ETag'"
op|':'
string|"'1000d172764c9dbc3a5798a67ec5bb76'"
op|','
nl|'\n'
string|"'X-Object-Meta-1'"
op|':'
string|"'One'"
op|','
nl|'\n'
string|"'X-Object-Sysmeta-1'"
op|':'
string|"'One'"
op|','
nl|'\n'
string|"'X-Object-Sysmeta-Two'"
op|':'
string|"'Two'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'body'
op|'='
string|"'VERIFY SYSMETA'"
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'201'
op|')'
newline|'\n'
nl|'\n'
name|'timestamp2'
op|'='
name|'normalize_timestamp'
op|'('
name|'time'
op|'('
op|')'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'POST'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'timestamp2'
op|','
nl|'\n'
string|"'X-Object-Meta-1'"
op|':'
string|"'Not One'"
op|','
nl|'\n'
string|"'X-Object-Sysmeta-1'"
op|':'
string|"'Not One'"
op|','
nl|'\n'
string|"'X-Object-Sysmeta-Two'"
op|':'
string|"'Not Two'"
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'202'
op|')'
newline|'\n'
nl|'\n'
comment|'# original .data file metadata should be unchanged'
nl|'\n'
name|'objfile'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'testdir'
op|','
string|"'sda1'"
op|','
nl|'\n'
name|'storage_directory'
op|'('
name|'diskfile'
op|'.'
name|'get_data_dir'
op|'('
name|'POLICIES'
op|'['
number|'0'
op|']'
op|')'
op|','
string|"'p'"
op|','
nl|'\n'
name|'hash_path'
op|'('
string|"'a'"
op|','
string|"'c'"
op|','
string|"'o'"
op|')'
op|')'
op|','
nl|'\n'
name|'timestamp1'
op|'+'
string|"'.data'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'isfile'
op|'('
name|'objfile'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'open'
op|'('
name|'objfile'
op|')'
op|'.'
name|'read'
op|'('
op|')'
op|','
string|"'VERIFY SYSMETA'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'diskfile'
op|'.'
name|'read_metadata'
op|'('
name|'objfile'
op|')'
op|','
nl|'\n'
op|'{'
string|"'X-Timestamp'"
op|':'
name|'timestamp1'
op|','
nl|'\n'
string|"'Content-Length'"
op|':'
string|"'14'"
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'text/plain'"
op|','
nl|'\n'
string|"'ETag'"
op|':'
string|"'1000d172764c9dbc3a5798a67ec5bb76'"
op|','
nl|'\n'
string|"'name'"
op|':'
string|"'/a/c/o'"
op|','
nl|'\n'
string|"'X-Object-Meta-1'"
op|':'
string|"'One'"
op|','
nl|'\n'
string|"'X-Object-Sysmeta-1'"
op|':'
string|"'One'"
op|','
nl|'\n'
string|"'X-Object-Sysmeta-Two'"
op|':'
string|"'Two'"
op|'}'
op|')'
newline|'\n'
nl|'\n'
comment|'# .meta file metadata should have only user meta items'
nl|'\n'
name|'metafile'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'testdir'
op|','
string|"'sda1'"
op|','
nl|'\n'
name|'storage_directory'
op|'('
name|'diskfile'
op|'.'
name|'get_data_dir'
op|'('
name|'POLICIES'
op|'['
number|'0'
op|']'
op|')'
op|','
string|"'p'"
op|','
nl|'\n'
name|'hash_path'
op|'('
string|"'a'"
op|','
string|"'c'"
op|','
string|"'o'"
op|')'
op|')'
op|','
nl|'\n'
name|'timestamp2'
op|'+'
string|"'.meta'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'isfile'
op|'('
name|'metafile'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'diskfile'
op|'.'
name|'read_metadata'
op|'('
name|'metafile'
op|')'
op|','
nl|'\n'
op|'{'
string|"'X-Timestamp'"
op|':'
name|'timestamp2'
op|','
nl|'\n'
string|"'name'"
op|':'
string|"'/a/c/o'"
op|','
nl|'\n'
string|"'X-Object-Meta-1'"
op|':'
string|"'Not One'"
op|'}'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_PUT_then_fetch_system_metadata
dedent|''
name|'def'
name|'test_PUT_then_fetch_system_metadata'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'timestamp'
op|'='
name|'normalize_timestamp'
op|'('
name|'time'
op|'('
op|')'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'timestamp'
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'text/plain'"
op|','
nl|'\n'
string|"'ETag'"
op|':'
string|"'1000d172764c9dbc3a5798a67ec5bb76'"
op|','
nl|'\n'
string|"'X-Object-Meta-1'"
op|':'
string|"'One'"
op|','
nl|'\n'
string|"'X-Object-Sysmeta-1'"
op|':'
string|"'One'"
op|','
nl|'\n'
string|"'X-Object-Sysmeta-Two'"
op|':'
string|"'Two'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'body'
op|'='
string|"'VERIFY SYSMETA'"
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'201'
op|')'
newline|'\n'
nl|'\n'
DECL|function|check_response
name|'def'
name|'check_response'
op|'('
name|'resp'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'200'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'content_length'
op|','
number|'14'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'content_type'
op|','
string|"'text/plain'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'['
string|"'content-type'"
op|']'
op|','
string|"'text/plain'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
nl|'\n'
name|'resp'
op|'.'
name|'headers'
op|'['
string|"'last-modified'"
op|']'
op|','
nl|'\n'
name|'strftime'
op|'('
string|"'%a, %d %b %Y %H:%M:%S GMT'"
op|','
nl|'\n'
name|'gmtime'
op|'('
name|'math'
op|'.'
name|'ceil'
op|'('
name|'float'
op|'('
name|'timestamp'
op|')'
op|')'
op|')'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'['
string|"'etag'"
op|']'
op|','
nl|'\n'
string|'\'"1000d172764c9dbc3a5798a67ec5bb76"\''
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'['
string|"'x-object-meta-1'"
op|']'
op|','
string|"'One'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'['
string|"'x-object-sysmeta-1'"
op|']'
op|','
string|"'One'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'['
string|"'x-object-sysmeta-two'"
op|']'
op|','
string|"'Two'"
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'HEAD'"
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'check_response'
op|'('
name|'resp'
op|')'
newline|'\n'
nl|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'GET'"
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'check_response'
op|'('
name|'resp'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_PUT_then_POST_then_fetch_system_metadata
dedent|''
name|'def'
name|'test_PUT_then_POST_then_fetch_system_metadata'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'timestamp'
op|'='
name|'normalize_timestamp'
op|'('
name|'time'
op|'('
op|')'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'timestamp'
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'text/plain'"
op|','
nl|'\n'
string|"'ETag'"
op|':'
string|"'1000d172764c9dbc3a5798a67ec5bb76'"
op|','
nl|'\n'
string|"'X-Object-Meta-1'"
op|':'
string|"'One'"
op|','
nl|'\n'
string|"'X-Object-Sysmeta-1'"
op|':'
string|"'One'"
op|','
nl|'\n'
string|"'X-Object-Sysmeta-Two'"
op|':'
string|"'Two'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'body'
op|'='
string|"'VERIFY SYSMETA'"
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'201'
op|')'
newline|'\n'
nl|'\n'
name|'timestamp2'
op|'='
name|'normalize_timestamp'
op|'('
name|'time'
op|'('
op|')'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'POST'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'timestamp2'
op|','
nl|'\n'
string|"'X-Object-Meta-1'"
op|':'
string|"'Not One'"
op|','
nl|'\n'
string|"'X-Object-Sysmeta-1'"
op|':'
string|"'Not One'"
op|','
nl|'\n'
string|"'X-Object-Sysmeta-Two'"
op|':'
string|"'Not Two'"
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'202'
op|')'
newline|'\n'
nl|'\n'
DECL|function|check_response
name|'def'
name|'check_response'
op|'('
name|'resp'
op|')'
op|':'
newline|'\n'
comment|'# user meta should be updated but not sysmeta'
nl|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'200'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'content_length'
op|','
number|'14'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'content_type'
op|','
string|"'text/plain'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'['
string|"'content-type'"
op|']'
op|','
string|"'text/plain'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
nl|'\n'
name|'resp'
op|'.'
name|'headers'
op|'['
string|"'last-modified'"
op|']'
op|','
nl|'\n'
name|'strftime'
op|'('
string|"'%a, %d %b %Y %H:%M:%S GMT'"
op|','
nl|'\n'
name|'gmtime'
op|'('
name|'math'
op|'.'
name|'ceil'
op|'('
name|'float'
op|'('
name|'timestamp2'
op|')'
op|')'
op|')'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'['
string|"'etag'"
op|']'
op|','
nl|'\n'
string|'\'"1000d172764c9dbc3a5798a67ec5bb76"\''
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'['
string|"'x-object-meta-1'"
op|']'
op|','
string|"'Not One'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'['
string|"'x-object-sysmeta-1'"
op|']'
op|','
string|"'One'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'['
string|"'x-object-sysmeta-two'"
op|']'
op|','
string|"'Two'"
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'HEAD'"
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'check_response'
op|'('
name|'resp'
op|')'
newline|'\n'
nl|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'GET'"
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'check_response'
op|'('
name|'resp'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_PUT_with_replication_headers
dedent|''
name|'def'
name|'test_PUT_with_replication_headers'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# check that otherwise disallowed headers are accepted when specified'
nl|'\n'
comment|'# by X-Backend-Replication-Headers'
nl|'\n'
nl|'\n'
comment|'# first PUT object'
nl|'\n'
indent|'        '
name|'timestamp1'
op|'='
name|'normalize_timestamp'
op|'('
name|'time'
op|'('
op|')'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'timestamp1'
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'text/plain'"
op|','
nl|'\n'
string|"'Content-Length'"
op|':'
string|"'14'"
op|','
nl|'\n'
string|"'Etag'"
op|':'
string|"'1000d172764c9dbc3a5798a67ec5bb76'"
op|','
nl|'\n'
string|"'Custom-Header'"
op|':'
string|"'custom1'"
op|','
nl|'\n'
string|"'X-Object-Meta-1'"
op|':'
string|"'meta1'"
op|','
nl|'\n'
string|"'X-Static-Large-Object'"
op|':'
string|"'False'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'body'
op|'='
string|"'VERIFY SYSMETA'"
newline|'\n'
nl|'\n'
comment|'# restrict set of allowed headers on this server'
nl|'\n'
name|'with'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|','
string|"'allowed_headers'"
op|','
nl|'\n'
op|'['
string|"'Custom-Header'"
op|']'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'201'
op|')'
newline|'\n'
nl|'\n'
name|'objfile'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'testdir'
op|','
string|"'sda1'"
op|','
nl|'\n'
name|'storage_directory'
op|'('
name|'diskfile'
op|'.'
name|'get_data_dir'
op|'('
number|'0'
op|')'
op|','
string|"'p'"
op|','
nl|'\n'
name|'hash_path'
op|'('
string|"'a'"
op|','
string|"'c'"
op|','
string|"'o'"
op|')'
op|')'
op|','
nl|'\n'
name|'timestamp1'
op|'+'
string|"'.data'"
op|')'
newline|'\n'
comment|'# X-Static-Large-Object is disallowed.'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'diskfile'
op|'.'
name|'read_metadata'
op|'('
name|'objfile'
op|')'
op|','
nl|'\n'
op|'{'
string|"'X-Timestamp'"
op|':'
name|'timestamp1'
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'text/plain'"
op|','
nl|'\n'
string|"'Content-Length'"
op|':'
string|"'14'"
op|','
nl|'\n'
string|"'ETag'"
op|':'
string|"'1000d172764c9dbc3a5798a67ec5bb76'"
op|','
nl|'\n'
string|"'name'"
op|':'
string|"'/a/c/o'"
op|','
nl|'\n'
string|"'Custom-Header'"
op|':'
string|"'custom1'"
op|','
nl|'\n'
string|"'X-Object-Meta-1'"
op|':'
string|"'meta1'"
op|'}'
op|')'
newline|'\n'
nl|'\n'
comment|'# PUT object again with X-Backend-Replication-Headers'
nl|'\n'
name|'timestamp2'
op|'='
name|'normalize_timestamp'
op|'('
name|'time'
op|'('
op|')'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'timestamp2'
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'text/plain'"
op|','
nl|'\n'
string|"'Content-Length'"
op|':'
string|"'14'"
op|','
nl|'\n'
string|"'Etag'"
op|':'
string|"'1000d172764c9dbc3a5798a67ec5bb76'"
op|','
nl|'\n'
string|"'Custom-Header'"
op|':'
string|"'custom1'"
op|','
nl|'\n'
string|"'X-Object-Meta-1'"
op|':'
string|"'meta1'"
op|','
nl|'\n'
string|"'X-Static-Large-Object'"
op|':'
string|"'False'"
op|','
nl|'\n'
string|"'X-Backend-Replication-Headers'"
op|':'
nl|'\n'
string|"'X-Static-Large-Object'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'body'
op|'='
string|"'VERIFY SYSMETA'"
newline|'\n'
nl|'\n'
name|'with'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|','
string|"'allowed_headers'"
op|','
nl|'\n'
op|'['
string|"'Custom-Header'"
op|']'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'201'
op|')'
newline|'\n'
nl|'\n'
name|'objfile'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'testdir'
op|','
string|"'sda1'"
op|','
nl|'\n'
name|'storage_directory'
op|'('
name|'diskfile'
op|'.'
name|'get_data_dir'
op|'('
number|'0'
op|')'
op|','
string|"'p'"
op|','
nl|'\n'
name|'hash_path'
op|'('
string|"'a'"
op|','
string|"'c'"
op|','
string|"'o'"
op|')'
op|')'
op|','
nl|'\n'
name|'timestamp2'
op|'+'
string|"'.data'"
op|')'
newline|'\n'
comment|'# X-Static-Large-Object should be copied since it is now allowed by'
nl|'\n'
comment|'# replication headers.'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'diskfile'
op|'.'
name|'read_metadata'
op|'('
name|'objfile'
op|')'
op|','
nl|'\n'
op|'{'
string|"'X-Timestamp'"
op|':'
name|'timestamp2'
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'text/plain'"
op|','
nl|'\n'
string|"'Content-Length'"
op|':'
string|"'14'"
op|','
nl|'\n'
string|"'ETag'"
op|':'
string|"'1000d172764c9dbc3a5798a67ec5bb76'"
op|','
nl|'\n'
string|"'name'"
op|':'
string|"'/a/c/o'"
op|','
nl|'\n'
string|"'Custom-Header'"
op|':'
string|"'custom1'"
op|','
nl|'\n'
string|"'X-Object-Meta-1'"
op|':'
string|"'meta1'"
op|','
nl|'\n'
string|"'X-Static-Large-Object'"
op|':'
string|"'False'"
op|'}'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_PUT_container_connection
dedent|''
name|'def'
name|'test_PUT_container_connection'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|function|mock_http_connect
indent|'        '
name|'def'
name|'mock_http_connect'
op|'('
name|'response'
op|','
name|'with_exc'
op|'='
name|'False'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|class|FakeConn
indent|'            '
name|'class'
name|'FakeConn'
op|'('
name|'object'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|member|__init__
indent|'                '
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'status'
op|','
name|'with_exc'
op|')'
op|':'
newline|'\n'
indent|'                    '
name|'self'
op|'.'
name|'status'
op|'='
name|'status'
newline|'\n'
name|'self'
op|'.'
name|'reason'
op|'='
string|"'Fake'"
newline|'\n'
name|'self'
op|'.'
name|'host'
op|'='
string|"'1.2.3.4'"
newline|'\n'
name|'self'
op|'.'
name|'port'
op|'='
string|"'1234'"
newline|'\n'
name|'self'
op|'.'
name|'with_exc'
op|'='
name|'with_exc'
newline|'\n'
nl|'\n'
DECL|member|getresponse
dedent|''
name|'def'
name|'getresponse'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'                    '
name|'if'
name|'self'
op|'.'
name|'with_exc'
op|':'
newline|'\n'
indent|'                        '
name|'raise'
name|'Exception'
op|'('
string|"'test'"
op|')'
newline|'\n'
dedent|''
name|'return'
name|'self'
newline|'\n'
nl|'\n'
DECL|member|read
dedent|''
name|'def'
name|'read'
op|'('
name|'self'
op|','
name|'amt'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
indent|'                    '
name|'return'
string|"''"
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'return'
name|'lambda'
op|'*'
name|'args'
op|','
op|'**'
name|'kwargs'
op|':'
name|'FakeConn'
op|'('
name|'response'
op|','
name|'with_exc'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'timestamp'
op|'='
name|'normalize_timestamp'
op|'('
name|'time'
op|'('
op|')'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'timestamp'
op|','
nl|'\n'
string|"'X-Container-Host'"
op|':'
string|"'1.2.3.4:0'"
op|','
nl|'\n'
string|"'X-Container-Partition'"
op|':'
string|"'3'"
op|','
nl|'\n'
string|"'X-Container-Device'"
op|':'
string|"'sda1'"
op|','
nl|'\n'
string|"'X-Container-Timestamp'"
op|':'
string|"'1'"
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'application/new1'"
op|','
nl|'\n'
string|"'Content-Length'"
op|':'
string|"'0'"
op|'}'
op|')'
newline|'\n'
name|'with'
name|'fake_spawn'
op|'('
op|')'
op|','
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
nl|'\n'
name|'object_server'
op|','
string|"'http_connect'"
op|','
nl|'\n'
name|'mock_http_connect'
op|'('
number|'201'
op|')'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'201'
op|')'
newline|'\n'
name|'timestamp'
op|'='
name|'normalize_timestamp'
op|'('
name|'time'
op|'('
op|')'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'timestamp'
op|','
nl|'\n'
string|"'X-Container-Host'"
op|':'
string|"'1.2.3.4:0'"
op|','
nl|'\n'
string|"'X-Container-Partition'"
op|':'
string|"'3'"
op|','
nl|'\n'
string|"'X-Container-Device'"
op|':'
string|"'sda1'"
op|','
nl|'\n'
string|"'X-Container-Timestamp'"
op|':'
string|"'1'"
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'application/new1'"
op|','
nl|'\n'
string|"'Content-Length'"
op|':'
string|"'0'"
op|'}'
op|')'
newline|'\n'
name|'with'
name|'fake_spawn'
op|'('
op|')'
op|','
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
nl|'\n'
name|'object_server'
op|','
string|"'http_connect'"
op|','
nl|'\n'
name|'mock_http_connect'
op|'('
number|'500'
op|')'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'201'
op|')'
newline|'\n'
name|'timestamp'
op|'='
name|'normalize_timestamp'
op|'('
name|'time'
op|'('
op|')'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'timestamp'
op|','
nl|'\n'
string|"'X-Container-Host'"
op|':'
string|"'1.2.3.4:0'"
op|','
nl|'\n'
string|"'X-Container-Partition'"
op|':'
string|"'3'"
op|','
nl|'\n'
string|"'X-Container-Device'"
op|':'
string|"'sda1'"
op|','
nl|'\n'
string|"'X-Container-Timestamp'"
op|':'
string|"'1'"
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'application/new1'"
op|','
nl|'\n'
string|"'Content-Length'"
op|':'
string|"'0'"
op|'}'
op|')'
newline|'\n'
name|'with'
name|'fake_spawn'
op|'('
op|')'
op|','
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
nl|'\n'
name|'object_server'
op|','
string|"'http_connect'"
op|','
nl|'\n'
name|'mock_http_connect'
op|'('
number|'500'
op|','
name|'with_exc'
op|'='
name|'True'
op|')'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'201'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_PUT_ssync_multi_frag
dedent|''
name|'def'
name|'test_PUT_ssync_multi_frag'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'timestamp'
op|'='
name|'utils'
op|'.'
name|'Timestamp'
op|'('
name|'time'
op|'('
op|')'
op|')'
op|'.'
name|'internal'
newline|'\n'
nl|'\n'
DECL|function|put_with_index
name|'def'
name|'put_with_index'
op|'('
name|'expected_rsp'
op|','
name|'frag_index'
op|','
name|'node_index'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'data_file_tail'
op|'='
string|"'#%d.data'"
op|'%'
name|'frag_index'
newline|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'timestamp'
op|','
nl|'\n'
string|"'Content-Length'"
op|':'
string|"'6'"
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'application/octet-stream'"
op|','
nl|'\n'
string|"'X-Backend-Ssync-Frag-Index'"
op|':'
name|'node_index'
op|','
nl|'\n'
string|"'X-Object-Sysmeta-Ec-Frag-Index'"
op|':'
name|'frag_index'
op|','
nl|'\n'
string|"'X-Backend-Storage-Policy-Index'"
op|':'
name|'int'
op|'('
name|'policy'
op|')'
op|'}'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
name|'headers'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'body'
op|'='
string|"'VERIFY'"
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
nl|'\n'
name|'resp'
op|'.'
name|'status_int'
op|','
name|'expected_rsp'
op|','
nl|'\n'
string|"'got %s != %s for frag_index=%s node_index=%s'"
op|'%'
op|'('
nl|'\n'
name|'resp'
op|'.'
name|'status_int'
op|','
name|'expected_rsp'
op|','
nl|'\n'
name|'frag_index'
op|','
name|'node_index'
op|')'
op|')'
newline|'\n'
name|'if'
name|'expected_rsp'
op|'=='
number|'409'
op|':'
newline|'\n'
indent|'                '
name|'return'
newline|'\n'
dedent|''
name|'obj_dir'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'testdir'
op|','
string|"'sda1'"
op|','
nl|'\n'
name|'storage_directory'
op|'('
name|'diskfile'
op|'.'
name|'get_data_dir'
op|'('
name|'int'
op|'('
name|'policy'
op|')'
op|')'
op|','
nl|'\n'
string|"'p'"
op|','
name|'hash_path'
op|'('
string|"'a'"
op|','
string|"'c'"
op|','
string|"'o'"
op|')'
op|')'
op|')'
newline|'\n'
name|'data_file'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'obj_dir'
op|','
name|'timestamp'
op|')'
op|'+'
name|'data_file_tail'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'isfile'
op|'('
name|'data_file'
op|')'
op|','
nl|'\n'
string|"'Expected file %r not found in %r for policy %r'"
nl|'\n'
op|'%'
op|'('
name|'data_file'
op|','
name|'os'
op|'.'
name|'listdir'
op|'('
name|'obj_dir'
op|')'
op|','
name|'int'
op|'('
name|'policy'
op|')'
op|')'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'for'
name|'policy'
name|'in'
name|'POLICIES'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'policy'
op|'.'
name|'policy_type'
op|'=='
name|'EC_POLICY'
op|':'
newline|'\n'
comment|'# upload with a ec-frag-index'
nl|'\n'
indent|'                '
name|'put_with_index'
op|'('
number|'201'
op|','
number|'3'
op|')'
newline|'\n'
comment|'# same timestamp will conflict a different ec-frag-index'
nl|'\n'
name|'put_with_index'
op|'('
number|'409'
op|','
number|'2'
op|')'
newline|'\n'
comment|'# but with the ssync-frag-index (primary node) it will just'
nl|'\n'
comment|'# save both!'
nl|'\n'
name|'put_with_index'
op|'('
number|'201'
op|','
number|'2'
op|','
number|'2'
op|')'
newline|'\n'
comment|'# but even with the ssync-frag-index we can still get a'
nl|'\n'
comment|'# timestamp collisison if the file already exists'
nl|'\n'
name|'put_with_index'
op|'('
number|'409'
op|','
number|'3'
op|','
number|'3'
op|')'
newline|'\n'
nl|'\n'
comment|'# FWIW, ssync will never send in-consistent indexes - but if'
nl|'\n'
comment|'# something else did, from the object server perspective ...'
nl|'\n'
nl|'\n'
comment|'# ... the ssync-frag-index is canonical on the'
nl|'\n'
comment|'# read/pre-existance check'
nl|'\n'
name|'put_with_index'
op|'('
number|'409'
op|','
number|'7'
op|','
number|'2'
op|')'
newline|'\n'
comment|'# ... but the ec-frag-index is canonical when it comes to on'
nl|'\n'
comment|'# disk file'
nl|'\n'
name|'put_with_index'
op|'('
number|'201'
op|','
number|'7'
op|','
number|'6'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_PUT_durable_files
dedent|''
dedent|''
dedent|''
name|'def'
name|'test_PUT_durable_files'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'for'
name|'policy'
name|'in'
name|'POLICIES'
op|':'
newline|'\n'
indent|'            '
name|'timestamp'
op|'='
name|'utils'
op|'.'
name|'Timestamp'
op|'('
name|'int'
op|'('
name|'time'
op|'('
op|')'
op|')'
op|')'
op|'.'
name|'internal'
newline|'\n'
name|'data_file_tail'
op|'='
string|"'.data'"
newline|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'timestamp'
op|','
nl|'\n'
string|"'Content-Length'"
op|':'
string|"'6'"
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'application/octet-stream'"
op|','
nl|'\n'
string|"'X-Backend-Storage-Policy-Index'"
op|':'
name|'int'
op|'('
name|'policy'
op|')'
op|'}'
newline|'\n'
name|'if'
name|'policy'
op|'.'
name|'policy_type'
op|'=='
name|'EC_POLICY'
op|':'
newline|'\n'
indent|'                '
name|'headers'
op|'['
string|"'X-Object-Sysmeta-Ec-Frag-Index'"
op|']'
op|'='
string|"'2'"
newline|'\n'
name|'data_file_tail'
op|'='
string|"'#2.data'"
newline|'\n'
dedent|''
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
name|'headers'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'body'
op|'='
string|"'VERIFY'"
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'201'
op|')'
newline|'\n'
name|'obj_dir'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'testdir'
op|','
string|"'sda1'"
op|','
nl|'\n'
name|'storage_directory'
op|'('
name|'diskfile'
op|'.'
name|'get_data_dir'
op|'('
name|'int'
op|'('
name|'policy'
op|')'
op|')'
op|','
nl|'\n'
string|"'p'"
op|','
name|'hash_path'
op|'('
string|"'a'"
op|','
string|"'c'"
op|','
string|"'o'"
op|')'
op|')'
op|')'
newline|'\n'
name|'data_file'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'obj_dir'
op|','
name|'timestamp'
op|')'
op|'+'
name|'data_file_tail'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'isfile'
op|'('
name|'data_file'
op|')'
op|','
nl|'\n'
string|"'Expected file %r not found in %r for policy %r'"
nl|'\n'
op|'%'
op|'('
name|'data_file'
op|','
name|'os'
op|'.'
name|'listdir'
op|'('
name|'obj_dir'
op|')'
op|','
name|'int'
op|'('
name|'policy'
op|')'
op|')'
op|')'
newline|'\n'
name|'durable_file'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'obj_dir'
op|','
name|'timestamp'
op|')'
op|'+'
string|"'.durable'"
newline|'\n'
name|'if'
name|'policy'
op|'.'
name|'policy_type'
op|'=='
name|'EC_POLICY'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'isfile'
op|'('
name|'durable_file'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'getsize'
op|'('
name|'durable_file'
op|')'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'isfile'
op|'('
name|'durable_file'
op|')'
op|')'
newline|'\n'
dedent|''
name|'rmtree'
op|'('
name|'obj_dir'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_HEAD
dedent|''
dedent|''
name|'def'
name|'test_HEAD'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# Test swift.obj.server.ObjectController.HEAD'
nl|'\n'
indent|'        '
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'HEAD'"
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'400'
op|')'
newline|'\n'
nl|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'HEAD'"
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'404'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
string|"'X-Backend-Timestamp'"
name|'in'
name|'resp'
op|'.'
name|'headers'
op|')'
newline|'\n'
nl|'\n'
name|'timestamp'
op|'='
name|'normalize_timestamp'
op|'('
name|'time'
op|'('
op|')'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'timestamp'
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'application/x-test'"
op|','
nl|'\n'
string|"'X-Object-Meta-1'"
op|':'
string|"'One'"
op|','
nl|'\n'
string|"'X-Object-Meta-Two'"
op|':'
string|"'Two'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'body'
op|'='
string|"'VERIFY'"
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'201'
op|')'
newline|'\n'
nl|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'HEAD'"
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'200'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'content_length'
op|','
number|'6'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'content_type'
op|','
string|"'application/x-test'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'['
string|"'content-type'"
op|']'
op|','
string|"'application/x-test'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
nl|'\n'
name|'resp'
op|'.'
name|'headers'
op|'['
string|"'last-modified'"
op|']'
op|','
nl|'\n'
name|'strftime'
op|'('
string|"'%a, %d %b %Y %H:%M:%S GMT'"
op|','
nl|'\n'
name|'gmtime'
op|'('
name|'math'
op|'.'
name|'ceil'
op|'('
name|'float'
op|'('
name|'timestamp'
op|')'
op|')'
op|')'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'['
string|"'etag'"
op|']'
op|','
nl|'\n'
string|'\'"0b4c12d7e0a73840c1c4f148fda3b037"\''
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'['
string|"'x-object-meta-1'"
op|']'
op|','
string|"'One'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'['
string|"'x-object-meta-two'"
op|']'
op|','
string|"'Two'"
op|')'
newline|'\n'
nl|'\n'
name|'objfile'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'testdir'
op|','
string|"'sda1'"
op|','
nl|'\n'
name|'storage_directory'
op|'('
name|'diskfile'
op|'.'
name|'get_data_dir'
op|'('
name|'POLICIES'
op|'['
number|'0'
op|']'
op|')'
op|','
string|"'p'"
op|','
nl|'\n'
name|'hash_path'
op|'('
string|"'a'"
op|','
string|"'c'"
op|','
string|"'o'"
op|')'
op|')'
op|','
nl|'\n'
name|'utils'
op|'.'
name|'Timestamp'
op|'('
name|'timestamp'
op|')'
op|'.'
name|'internal'
op|'+'
string|"'.data'"
op|')'
newline|'\n'
name|'os'
op|'.'
name|'unlink'
op|'('
name|'objfile'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'HEAD'"
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'404'
op|')'
newline|'\n'
nl|'\n'
name|'sleep'
op|'('
number|'.00001'
op|')'
newline|'\n'
name|'timestamp'
op|'='
name|'normalize_timestamp'
op|'('
name|'time'
op|'('
op|')'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
nl|'\n'
string|"'X-Timestamp'"
op|':'
name|'timestamp'
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'application/octet-stream'"
op|','
nl|'\n'
string|"'Content-length'"
op|':'
string|"'6'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'body'
op|'='
string|"'VERIFY'"
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'201'
op|')'
newline|'\n'
nl|'\n'
name|'sleep'
op|'('
number|'.00001'
op|')'
newline|'\n'
name|'timestamp'
op|'='
name|'normalize_timestamp'
op|'('
name|'time'
op|'('
op|')'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'DELETE'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'timestamp'
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'204'
op|')'
newline|'\n'
nl|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'HEAD'"
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'404'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'['
string|"'X-Backend-Timestamp'"
op|']'
op|','
nl|'\n'
name|'utils'
op|'.'
name|'Timestamp'
op|'('
name|'timestamp'
op|')'
op|'.'
name|'internal'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_HEAD_quarantine_zbyte
dedent|''
name|'def'
name|'test_HEAD_quarantine_zbyte'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# Test swift.obj.server.ObjectController.GET'
nl|'\n'
indent|'        '
name|'timestamp'
op|'='
name|'normalize_timestamp'
op|'('
name|'time'
op|'('
op|')'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'timestamp'
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'application/x-test'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'body'
op|'='
string|"'VERIFY'"
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'201'
op|')'
newline|'\n'
name|'disk_file'
op|'='
name|'self'
op|'.'
name|'df_mgr'
op|'.'
name|'get_diskfile'
op|'('
string|"'sda1'"
op|','
string|"'p'"
op|','
string|"'a'"
op|','
string|"'c'"
op|','
string|"'o'"
op|','
nl|'\n'
name|'policy'
op|'='
name|'POLICIES'
op|'.'
name|'legacy'
op|')'
newline|'\n'
name|'disk_file'
op|'.'
name|'open'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'file_name'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'basename'
op|'('
name|'disk_file'
op|'.'
name|'_data_file'
op|')'
newline|'\n'
name|'with'
name|'open'
op|'('
name|'disk_file'
op|'.'
name|'_data_file'
op|')'
name|'as'
name|'fp'
op|':'
newline|'\n'
indent|'            '
name|'metadata'
op|'='
name|'diskfile'
op|'.'
name|'read_metadata'
op|'('
name|'fp'
op|')'
newline|'\n'
dedent|''
name|'os'
op|'.'
name|'unlink'
op|'('
name|'disk_file'
op|'.'
name|'_data_file'
op|')'
newline|'\n'
name|'with'
name|'open'
op|'('
name|'disk_file'
op|'.'
name|'_data_file'
op|','
string|"'w'"
op|')'
name|'as'
name|'fp'
op|':'
newline|'\n'
indent|'            '
name|'diskfile'
op|'.'
name|'write_metadata'
op|'('
name|'fp'
op|','
name|'metadata'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'file_name'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'basename'
op|'('
name|'disk_file'
op|'.'
name|'_data_file'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'os'
op|'.'
name|'listdir'
op|'('
name|'disk_file'
op|'.'
name|'_datadir'
op|')'
op|'['
number|'0'
op|']'
op|','
name|'file_name'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'HEAD'"
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'404'
op|')'
newline|'\n'
nl|'\n'
name|'quar_dir'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'testdir'
op|','
string|"'sda1'"
op|','
string|"'quarantined'"
op|','
string|"'objects'"
op|','
nl|'\n'
name|'os'
op|'.'
name|'path'
op|'.'
name|'basename'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'dirname'
op|'('
name|'disk_file'
op|'.'
name|'_data_file'
op|')'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'os'
op|'.'
name|'listdir'
op|'('
name|'quar_dir'
op|')'
op|'['
number|'0'
op|']'
op|','
name|'file_name'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_OPTIONS
dedent|''
name|'def'
name|'test_OPTIONS'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'conf'
op|'='
op|'{'
string|"'devices'"
op|':'
name|'self'
op|'.'
name|'testdir'
op|','
string|"'mount_check'"
op|':'
string|"'false'"
op|'}'
newline|'\n'
name|'server_handler'
op|'='
name|'object_server'
op|'.'
name|'ObjectController'
op|'('
nl|'\n'
name|'conf'
op|','
name|'logger'
op|'='
name|'debug_logger'
op|'('
op|')'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'OPTIONS'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'content_length'
op|'='
number|'0'
newline|'\n'
name|'resp'
op|'='
name|'server_handler'
op|'.'
name|'OPTIONS'
op|'('
name|'req'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'200'
op|','
name|'resp'
op|'.'
name|'status_int'
op|')'
newline|'\n'
name|'for'
name|'verb'
name|'in'
string|"'OPTIONS GET POST PUT DELETE HEAD REPLICATE \\\n                SSYNC'"
op|'.'
name|'split'
op|'('
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertTrue'
op|'('
nl|'\n'
name|'verb'
name|'in'
name|'resp'
op|'.'
name|'headers'
op|'['
string|"'Allow'"
op|']'
op|'.'
name|'split'
op|'('
string|"', '"
op|')'
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'len'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'['
string|"'Allow'"
op|']'
op|'.'
name|'split'
op|'('
string|"', '"
op|')'
op|')'
op|','
number|'8'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'['
string|"'Server'"
op|']'
op|','
nl|'\n'
op|'('
name|'server_handler'
op|'.'
name|'server_type'
op|'+'
string|"'/'"
op|'+'
name|'swift_version'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_GET
dedent|''
name|'def'
name|'test_GET'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# Test swift.obj.server.ObjectController.GET'
nl|'\n'
indent|'        '
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'GET'"
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'400'
op|')'
newline|'\n'
nl|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'GET'"
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'404'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
string|"'X-Backend-Timestamp'"
name|'in'
name|'resp'
op|'.'
name|'headers'
op|')'
newline|'\n'
nl|'\n'
name|'timestamp'
op|'='
name|'normalize_timestamp'
op|'('
name|'time'
op|'('
op|')'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'timestamp'
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'application/x-test'"
op|','
nl|'\n'
string|"'X-Object-Meta-1'"
op|':'
string|"'One'"
op|','
nl|'\n'
string|"'X-Object-Meta-Two'"
op|':'
string|"'Two'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'body'
op|'='
string|"'VERIFY'"
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'201'
op|')'
newline|'\n'
nl|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'GET'"
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'200'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'body'
op|','
string|"'VERIFY'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'content_length'
op|','
number|'6'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'content_type'
op|','
string|"'application/x-test'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'['
string|"'content-length'"
op|']'
op|','
string|"'6'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'['
string|"'content-type'"
op|']'
op|','
string|"'application/x-test'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
nl|'\n'
name|'resp'
op|'.'
name|'headers'
op|'['
string|"'last-modified'"
op|']'
op|','
nl|'\n'
name|'strftime'
op|'('
string|"'%a, %d %b %Y %H:%M:%S GMT'"
op|','
nl|'\n'
name|'gmtime'
op|'('
name|'math'
op|'.'
name|'ceil'
op|'('
name|'float'
op|'('
name|'timestamp'
op|')'
op|')'
op|')'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'['
string|"'etag'"
op|']'
op|','
nl|'\n'
string|'\'"0b4c12d7e0a73840c1c4f148fda3b037"\''
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'['
string|"'x-object-meta-1'"
op|']'
op|','
string|"'One'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'['
string|"'x-object-meta-two'"
op|']'
op|','
string|"'Two'"
op|')'
newline|'\n'
nl|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'GET'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'range'
op|'='
string|"'bytes=1-3'"
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'206'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'body'
op|','
string|"'ERI'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'['
string|"'content-length'"
op|']'
op|','
string|"'3'"
op|')'
newline|'\n'
nl|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'GET'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'range'
op|'='
string|"'bytes=1-'"
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'206'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'body'
op|','
string|"'ERIFY'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'['
string|"'content-length'"
op|']'
op|','
string|"'5'"
op|')'
newline|'\n'
nl|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'GET'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'range'
op|'='
string|"'bytes=-2'"
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'206'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'body'
op|','
string|"'FY'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'['
string|"'content-length'"
op|']'
op|','
string|"'2'"
op|')'
newline|'\n'
nl|'\n'
name|'objfile'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'testdir'
op|','
string|"'sda1'"
op|','
nl|'\n'
name|'storage_directory'
op|'('
name|'diskfile'
op|'.'
name|'get_data_dir'
op|'('
name|'POLICIES'
op|'['
number|'0'
op|']'
op|')'
op|','
string|"'p'"
op|','
nl|'\n'
name|'hash_path'
op|'('
string|"'a'"
op|','
string|"'c'"
op|','
string|"'o'"
op|')'
op|')'
op|','
nl|'\n'
name|'utils'
op|'.'
name|'Timestamp'
op|'('
name|'timestamp'
op|')'
op|'.'
name|'internal'
op|'+'
string|"'.data'"
op|')'
newline|'\n'
name|'os'
op|'.'
name|'unlink'
op|'('
name|'objfile'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'GET'"
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'404'
op|')'
newline|'\n'
nl|'\n'
name|'sleep'
op|'('
number|'.00001'
op|')'
newline|'\n'
name|'timestamp'
op|'='
name|'normalize_timestamp'
op|'('
name|'time'
op|'('
op|')'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
nl|'\n'
string|"'X-Timestamp'"
op|':'
name|'timestamp'
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'application:octet-stream'"
op|','
nl|'\n'
string|"'Content-Length'"
op|':'
string|"'6'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'body'
op|'='
string|"'VERIFY'"
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'201'
op|')'
newline|'\n'
nl|'\n'
name|'sleep'
op|'('
number|'.00001'
op|')'
newline|'\n'
name|'timestamp'
op|'='
name|'normalize_timestamp'
op|'('
name|'time'
op|'('
op|')'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'DELETE'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'timestamp'
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'204'
op|')'
newline|'\n'
nl|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'GET'"
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'404'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'['
string|"'X-Backend-Timestamp'"
op|']'
op|','
nl|'\n'
name|'utils'
op|'.'
name|'Timestamp'
op|'('
name|'timestamp'
op|')'
op|'.'
name|'internal'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_GET_if_match
dedent|''
name|'def'
name|'test_GET_if_match'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
nl|'\n'
string|"'X-Timestamp'"
op|':'
name|'normalize_timestamp'
op|'('
name|'time'
op|'('
op|')'
op|')'
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'application/octet-stream'"
op|','
nl|'\n'
string|"'Content-Length'"
op|':'
string|"'4'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'body'
op|'='
string|"'test'"
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'201'
op|')'
newline|'\n'
name|'etag'
op|'='
name|'resp'
op|'.'
name|'etag'
newline|'\n'
nl|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'GET'"
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'200'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'etag'
op|','
name|'etag'
op|')'
newline|'\n'
nl|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'GET'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'If-Match'"
op|':'
string|"'*'"
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'200'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'etag'
op|','
name|'etag'
op|')'
newline|'\n'
nl|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o2'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'GET'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'If-Match'"
op|':'
string|"'*'"
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'412'
op|')'
newline|'\n'
nl|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'GET'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'If-Match'"
op|':'
string|'\'"%s"\''
op|'%'
name|'etag'
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'200'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'etag'
op|','
name|'etag'
op|')'
newline|'\n'
nl|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'GET'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'If-Match'"
op|':'
string|'\'"11111111111111111111111111111111"\''
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'412'
op|')'
newline|'\n'
nl|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'GET'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
nl|'\n'
string|"'If-Match'"
op|':'
string|'\'"11111111111111111111111111111111", "%s"\''
op|'%'
name|'etag'
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'200'
op|')'
newline|'\n'
nl|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'GET'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
nl|'\n'
string|"'If-Match'"
op|':'
nl|'\n'
string|'\'"11111111111111111111111111111111", \''
nl|'\n'
string|'\'"22222222222222222222222222222222"\''
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'412'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_GET_if_match_etag_is_at
dedent|''
name|'def'
name|'test_GET_if_match_etag_is_at'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'headers'
op|'='
op|'{'
nl|'\n'
string|"'X-Timestamp'"
op|':'
name|'utils'
op|'.'
name|'Timestamp'
op|'('
name|'time'
op|'('
op|')'
op|')'
op|'.'
name|'internal'
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'application/octet-stream'"
op|','
nl|'\n'
string|"'X-Object-Meta-Xtag'"
op|':'
string|"'madeup'"
op|','
nl|'\n'
op|'}'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
name|'method'
op|'='
string|"'PUT'"
op|','
nl|'\n'
name|'headers'
op|'='
name|'headers'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'body'
op|'='
string|"'test'"
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'201'
op|')'
newline|'\n'
name|'real_etag'
op|'='
name|'resp'
op|'.'
name|'etag'
newline|'\n'
nl|'\n'
comment|'# match x-backend-etag-is-at'
nl|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
name|'headers'
op|'='
op|'{'
nl|'\n'
string|"'If-Match'"
op|':'
string|"'madeup'"
op|','
nl|'\n'
string|"'X-Backend-Etag-Is-At'"
op|':'
string|"'X-Object-Meta-Xtag'"
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'200'
op|')'
newline|'\n'
nl|'\n'
comment|'# no match x-backend-etag-is-at'
nl|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
name|'headers'
op|'='
op|'{'
nl|'\n'
string|"'If-Match'"
op|':'
name|'real_etag'
op|','
nl|'\n'
string|"'X-Backend-Etag-Is-At'"
op|':'
string|"'X-Object-Meta-Xtag'"
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'412'
op|')'
newline|'\n'
nl|'\n'
comment|"# etag-is-at metadata doesn't exist, default to real etag"
nl|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
name|'headers'
op|'='
op|'{'
nl|'\n'
string|"'If-Match'"
op|':'
name|'real_etag'
op|','
nl|'\n'
string|"'X-Backend-Etag-Is-At'"
op|':'
string|"'X-Object-Meta-Missing'"
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'200'
op|')'
newline|'\n'
nl|'\n'
comment|'# sanity no-match with no etag-is-at'
nl|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
name|'headers'
op|'='
op|'{'
nl|'\n'
string|"'If-Match'"
op|':'
string|"'madeup'"
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'412'
op|')'
newline|'\n'
nl|'\n'
comment|'# sanity match with no etag-is-at'
nl|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
name|'headers'
op|'='
op|'{'
nl|'\n'
string|"'If-Match'"
op|':'
name|'real_etag'
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'200'
op|')'
newline|'\n'
nl|'\n'
comment|'# sanity with no if-match'
nl|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
name|'headers'
op|'='
op|'{'
nl|'\n'
string|"'X-Backend-Etag-Is-At'"
op|':'
string|"'X-Object-Meta-Xtag'"
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'200'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_HEAD_if_match
dedent|''
name|'def'
name|'test_HEAD_if_match'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
nl|'\n'
string|"'X-Timestamp'"
op|':'
name|'normalize_timestamp'
op|'('
name|'time'
op|'('
op|')'
op|')'
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'application/octet-stream'"
op|','
nl|'\n'
string|"'Content-Length'"
op|':'
string|"'4'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'body'
op|'='
string|"'test'"
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'201'
op|')'
newline|'\n'
name|'etag'
op|'='
name|'resp'
op|'.'
name|'etag'
newline|'\n'
nl|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'HEAD'"
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'200'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'etag'
op|','
name|'etag'
op|')'
newline|'\n'
nl|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'HEAD'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'If-Match'"
op|':'
string|"'*'"
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'200'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'etag'
op|','
name|'etag'
op|')'
newline|'\n'
nl|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o2'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'HEAD'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'If-Match'"
op|':'
string|"'*'"
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'412'
op|')'
newline|'\n'
nl|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'HEAD'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'If-Match'"
op|':'
string|'\'"%s"\''
op|'%'
name|'etag'
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'200'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'etag'
op|','
name|'etag'
op|')'
newline|'\n'
nl|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'HEAD'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'If-Match'"
op|':'
string|'\'"11111111111111111111111111111111"\''
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'412'
op|')'
newline|'\n'
nl|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'HEAD'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
nl|'\n'
string|"'If-Match'"
op|':'
string|'\'"11111111111111111111111111111111", "%s"\''
op|'%'
name|'etag'
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'200'
op|')'
newline|'\n'
nl|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'HEAD'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
nl|'\n'
string|"'If-Match'"
op|':'
nl|'\n'
string|'\'"11111111111111111111111111111111", \''
nl|'\n'
string|'\'"22222222222222222222222222222222"\''
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'412'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_GET_if_none_match
dedent|''
name|'def'
name|'test_GET_if_none_match'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
nl|'\n'
string|"'X-Timestamp'"
op|':'
name|'normalize_timestamp'
op|'('
name|'time'
op|'('
op|')'
op|')'
op|','
nl|'\n'
string|"'X-Object-Meta-Soup'"
op|':'
string|"'gazpacho'"
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'application/fizzbuzz'"
op|','
nl|'\n'
string|"'Content-Length'"
op|':'
string|"'4'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'body'
op|'='
string|"'test'"
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'201'
op|')'
newline|'\n'
name|'etag'
op|'='
name|'resp'
op|'.'
name|'etag'
newline|'\n'
nl|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'GET'"
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'200'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'etag'
op|','
name|'etag'
op|')'
newline|'\n'
nl|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'GET'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'If-None-Match'"
op|':'
string|"'*'"
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'304'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'etag'
op|','
name|'etag'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'['
string|"'Content-Type'"
op|']'
op|','
string|"'application/fizzbuzz'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'['
string|"'X-Object-Meta-Soup'"
op|']'
op|','
string|"'gazpacho'"
op|')'
newline|'\n'
nl|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o2'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'GET'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'If-None-Match'"
op|':'
string|"'*'"
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'404'
op|')'
newline|'\n'
nl|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'GET'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'If-None-Match'"
op|':'
string|'\'"%s"\''
op|'%'
name|'etag'
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'304'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'etag'
op|','
name|'etag'
op|')'
newline|'\n'
nl|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'GET'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'If-None-Match'"
op|':'
string|'\'"11111111111111111111111111111111"\''
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'200'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'etag'
op|','
name|'etag'
op|')'
newline|'\n'
nl|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'GET'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'If-None-Match'"
op|':'
nl|'\n'
string|'\'"11111111111111111111111111111111", \''
nl|'\n'
string|'\'"%s"\''
op|'%'
name|'etag'
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'304'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'etag'
op|','
name|'etag'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_HEAD_if_none_match
dedent|''
name|'def'
name|'test_HEAD_if_none_match'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
nl|'\n'
string|"'X-Timestamp'"
op|':'
name|'normalize_timestamp'
op|'('
name|'time'
op|'('
op|')'
op|')'
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'application/octet-stream'"
op|','
nl|'\n'
string|"'Content-Length'"
op|':'
string|"'4'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'body'
op|'='
string|"'test'"
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'201'
op|')'
newline|'\n'
name|'etag'
op|'='
name|'resp'
op|'.'
name|'etag'
newline|'\n'
nl|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'HEAD'"
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'200'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'etag'
op|','
name|'etag'
op|')'
newline|'\n'
nl|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'HEAD'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'If-None-Match'"
op|':'
string|"'*'"
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'304'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'etag'
op|','
name|'etag'
op|')'
newline|'\n'
nl|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o2'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'HEAD'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'If-None-Match'"
op|':'
string|"'*'"
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'404'
op|')'
newline|'\n'
nl|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'HEAD'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'If-None-Match'"
op|':'
string|'\'"%s"\''
op|'%'
name|'etag'
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'304'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'etag'
op|','
name|'etag'
op|')'
newline|'\n'
nl|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'HEAD'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'If-None-Match'"
op|':'
string|'\'"11111111111111111111111111111111"\''
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'200'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'etag'
op|','
name|'etag'
op|')'
newline|'\n'
nl|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'HEAD'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'If-None-Match'"
op|':'
nl|'\n'
string|'\'"11111111111111111111111111111111", \''
nl|'\n'
string|'\'"%s"\''
op|'%'
name|'etag'
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'304'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'etag'
op|','
name|'etag'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_GET_if_modified_since
dedent|''
name|'def'
name|'test_GET_if_modified_since'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'timestamp'
op|'='
name|'normalize_timestamp'
op|'('
name|'time'
op|'('
op|')'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
nl|'\n'
string|"'X-Timestamp'"
op|':'
name|'timestamp'
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'application/octet-stream'"
op|','
nl|'\n'
string|"'Content-Length'"
op|':'
string|"'4'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'body'
op|'='
string|"'test'"
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'201'
op|')'
newline|'\n'
nl|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'GET'"
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'200'
op|')'
newline|'\n'
nl|'\n'
name|'since'
op|'='
name|'strftime'
op|'('
string|"'%a, %d %b %Y %H:%M:%S GMT'"
op|','
nl|'\n'
name|'gmtime'
op|'('
name|'float'
op|'('
name|'timestamp'
op|')'
op|'+'
number|'1'
op|')'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'GET'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'If-Modified-Since'"
op|':'
name|'since'
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'304'
op|')'
newline|'\n'
nl|'\n'
name|'since'
op|'='
name|'strftime'
op|'('
string|"'%a, %d %b %Y %H:%M:%S GMT'"
op|','
name|'gmtime'
op|'('
name|'float'
op|'('
name|'timestamp'
op|')'
op|'-'
number|'1'
op|')'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'GET'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'If-Modified-Since'"
op|':'
name|'since'
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'200'
op|')'
newline|'\n'
nl|'\n'
name|'since'
op|'='
name|'strftime'
op|'('
string|"'%a, %d %b %Y %H:%M:%S GMT'"
op|','
name|'gmtime'
op|'('
name|'float'
op|'('
name|'timestamp'
op|')'
op|'+'
number|'1'
op|')'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'GET'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'If-Modified-Since'"
op|':'
name|'since'
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'304'
op|')'
newline|'\n'
nl|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'HEAD'"
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'since'
op|'='
name|'resp'
op|'.'
name|'headers'
op|'['
string|"'Last-Modified'"
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'since'
op|','
name|'strftime'
op|'('
string|"'%a, %d %b %Y %H:%M:%S GMT'"
op|','
nl|'\n'
name|'gmtime'
op|'('
name|'math'
op|'.'
name|'ceil'
op|'('
name|'float'
op|'('
name|'timestamp'
op|')'
op|')'
op|')'
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'GET'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'If-Modified-Since'"
op|':'
name|'since'
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'304'
op|')'
newline|'\n'
nl|'\n'
name|'timestamp'
op|'='
name|'normalize_timestamp'
op|'('
name|'int'
op|'('
name|'time'
op|'('
op|')'
op|')'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o2'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
nl|'\n'
string|"'X-Timestamp'"
op|':'
name|'timestamp'
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'application/octet-stream'"
op|','
nl|'\n'
string|"'Content-Length'"
op|':'
string|"'4'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'body'
op|'='
string|"'test'"
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'201'
op|')'
newline|'\n'
nl|'\n'
name|'since'
op|'='
name|'strftime'
op|'('
string|"'%a, %d %b %Y %H:%M:%S GMT'"
op|','
nl|'\n'
name|'gmtime'
op|'('
name|'float'
op|'('
name|'timestamp'
op|')'
op|')'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o2'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'GET'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'If-Modified-Since'"
op|':'
name|'since'
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'304'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_HEAD_if_modified_since
dedent|''
name|'def'
name|'test_HEAD_if_modified_since'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'timestamp'
op|'='
name|'normalize_timestamp'
op|'('
name|'time'
op|'('
op|')'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
nl|'\n'
string|"'X-Timestamp'"
op|':'
name|'timestamp'
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'application/octet-stream'"
op|','
nl|'\n'
string|"'Content-Length'"
op|':'
string|"'4'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'body'
op|'='
string|"'test'"
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'201'
op|')'
newline|'\n'
nl|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'HEAD'"
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'200'
op|')'
newline|'\n'
nl|'\n'
name|'since'
op|'='
name|'strftime'
op|'('
string|"'%a, %d %b %Y %H:%M:%S GMT'"
op|','
nl|'\n'
name|'gmtime'
op|'('
name|'float'
op|'('
name|'timestamp'
op|')'
op|'+'
number|'1'
op|')'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'HEAD'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'If-Modified-Since'"
op|':'
name|'since'
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'304'
op|')'
newline|'\n'
nl|'\n'
name|'since'
op|'='
name|'strftime'
op|'('
string|"'%a, %d %b %Y %H:%M:%S GMT'"
op|','
name|'gmtime'
op|'('
name|'float'
op|'('
name|'timestamp'
op|')'
op|'-'
number|'1'
op|')'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'HEAD'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'If-Modified-Since'"
op|':'
name|'since'
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'200'
op|')'
newline|'\n'
nl|'\n'
name|'since'
op|'='
name|'strftime'
op|'('
string|"'%a, %d %b %Y %H:%M:%S GMT'"
op|','
name|'gmtime'
op|'('
name|'float'
op|'('
name|'timestamp'
op|')'
op|'+'
number|'1'
op|')'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'HEAD'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'If-Modified-Since'"
op|':'
name|'since'
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'304'
op|')'
newline|'\n'
nl|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'HEAD'"
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'since'
op|'='
name|'resp'
op|'.'
name|'headers'
op|'['
string|"'Last-Modified'"
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'since'
op|','
name|'strftime'
op|'('
string|"'%a, %d %b %Y %H:%M:%S GMT'"
op|','
nl|'\n'
name|'gmtime'
op|'('
name|'math'
op|'.'
name|'ceil'
op|'('
name|'float'
op|'('
name|'timestamp'
op|')'
op|')'
op|')'
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'HEAD'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'If-Modified-Since'"
op|':'
name|'since'
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'self'
op|'.'
name|'object_controller'
op|'.'
name|'GET'
op|'('
name|'req'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'304'
op|')'
newline|'\n'
nl|'\n'
name|'timestamp'
op|'='
name|'normalize_timestamp'
op|'('
name|'int'
op|'('
name|'time'
op|'('
op|')'
op|')'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o2'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
nl|'\n'
string|"'X-Timestamp'"
op|':'
name|'timestamp'
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'application/octet-stream'"
op|','
nl|'\n'
string|"'Content-Length'"
op|':'
string|"'4'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'body'
op|'='
string|"'test'"
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'201'
op|')'
newline|'\n'
nl|'\n'
name|'since'
op|'='
name|'strftime'
op|'('
string|"'%a, %d %b %Y %H:%M:%S GMT'"
op|','
nl|'\n'
name|'gmtime'
op|'('
name|'float'
op|'('
name|'timestamp'
op|')'
op|')'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o2'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'HEAD'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'If-Modified-Since'"
op|':'
name|'since'
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'304'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_GET_if_unmodified_since
dedent|''
name|'def'
name|'test_GET_if_unmodified_since'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'timestamp'
op|'='
name|'normalize_timestamp'
op|'('
name|'time'
op|'('
op|')'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
nl|'\n'
string|"'X-Timestamp'"
op|':'
name|'timestamp'
op|','
nl|'\n'
string|"'X-Object-Meta-Burr'"
op|':'
string|"'ito'"
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'application/cat-picture'"
op|','
nl|'\n'
string|"'Content-Length'"
op|':'
string|"'4'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'body'
op|'='
string|"'test'"
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'201'
op|')'
newline|'\n'
nl|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'GET'"
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'200'
op|')'
newline|'\n'
nl|'\n'
name|'since'
op|'='
name|'strftime'
op|'('
string|"'%a, %d %b %Y %H:%M:%S GMT'"
op|','
nl|'\n'
name|'gmtime'
op|'('
name|'float'
op|'('
name|'timestamp'
op|')'
op|'+'
number|'1'
op|')'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'GET'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'If-Unmodified-Since'"
op|':'
name|'since'
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'200'
op|')'
newline|'\n'
nl|'\n'
name|'since'
op|'='
name|'strftime'
op|'('
string|"'%a, %d %b %Y %H:%M:%S GMT'"
op|','
name|'gmtime'
op|'('
name|'float'
op|'('
name|'timestamp'
op|')'
op|'-'
number|'9'
op|')'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'GET'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'If-Unmodified-Since'"
op|':'
name|'since'
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'412'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'['
string|"'Content-Type'"
op|']'
op|','
nl|'\n'
string|"'application/cat-picture'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'['
string|"'X-Object-Meta-Burr'"
op|']'
op|','
string|"'ito'"
op|')'
newline|'\n'
nl|'\n'
name|'since'
op|'='
name|'strftime'
op|'('
string|"'%a, %d %b %Y %H:%M:%S GMT'"
op|','
name|'gmtime'
op|'('
name|'float'
op|'('
name|'timestamp'
op|')'
op|'+'
number|'9'
op|')'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'GET'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'If-Unmodified-Since'"
op|':'
name|'since'
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'200'
op|')'
newline|'\n'
nl|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'HEAD'"
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'since'
op|'='
name|'resp'
op|'.'
name|'headers'
op|'['
string|"'Last-Modified'"
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'since'
op|','
name|'strftime'
op|'('
string|"'%a, %d %b %Y %H:%M:%S GMT'"
op|','
nl|'\n'
name|'gmtime'
op|'('
name|'math'
op|'.'
name|'ceil'
op|'('
name|'float'
op|'('
name|'timestamp'
op|')'
op|')'
op|')'
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'GET'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'If-Unmodified-Since'"
op|':'
name|'since'
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'200'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_HEAD_if_unmodified_since
dedent|''
name|'def'
name|'test_HEAD_if_unmodified_since'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'timestamp'
op|'='
name|'normalize_timestamp'
op|'('
name|'time'
op|'('
op|')'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'timestamp'
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'application/octet-stream'"
op|','
nl|'\n'
string|"'Content-Length'"
op|':'
string|"'4'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'body'
op|'='
string|"'test'"
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'201'
op|')'
newline|'\n'
nl|'\n'
name|'since'
op|'='
name|'strftime'
op|'('
string|"'%a, %d %b %Y %H:%M:%S GMT'"
op|','
nl|'\n'
name|'gmtime'
op|'('
name|'math'
op|'.'
name|'ceil'
op|'('
name|'float'
op|'('
name|'timestamp'
op|')'
op|')'
op|'+'
number|'1'
op|')'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'HEAD'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'If-Unmodified-Since'"
op|':'
name|'since'
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'200'
op|')'
newline|'\n'
nl|'\n'
name|'since'
op|'='
name|'strftime'
op|'('
string|"'%a, %d %b %Y %H:%M:%S GMT'"
op|','
nl|'\n'
name|'gmtime'
op|'('
name|'math'
op|'.'
name|'ceil'
op|'('
name|'float'
op|'('
name|'timestamp'
op|')'
op|')'
op|')'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'HEAD'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'If-Unmodified-Since'"
op|':'
name|'since'
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'200'
op|')'
newline|'\n'
nl|'\n'
name|'since'
op|'='
name|'strftime'
op|'('
string|"'%a, %d %b %Y %H:%M:%S GMT'"
op|','
nl|'\n'
name|'gmtime'
op|'('
name|'math'
op|'.'
name|'ceil'
op|'('
name|'float'
op|'('
name|'timestamp'
op|')'
op|')'
op|'-'
number|'1'
op|')'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'HEAD'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'If-Unmodified-Since'"
op|':'
name|'since'
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'412'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_GET_quarantine
dedent|''
name|'def'
name|'test_GET_quarantine'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# Test swift.obj.server.ObjectController.GET'
nl|'\n'
indent|'        '
name|'timestamp'
op|'='
name|'normalize_timestamp'
op|'('
name|'time'
op|'('
op|')'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'timestamp'
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'application/x-test'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'body'
op|'='
string|"'VERIFY'"
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'201'
op|')'
newline|'\n'
name|'disk_file'
op|'='
name|'self'
op|'.'
name|'df_mgr'
op|'.'
name|'get_diskfile'
op|'('
string|"'sda1'"
op|','
string|"'p'"
op|','
string|"'a'"
op|','
string|"'c'"
op|','
string|"'o'"
op|','
nl|'\n'
name|'policy'
op|'='
name|'POLICIES'
op|'.'
name|'legacy'
op|')'
newline|'\n'
name|'disk_file'
op|'.'
name|'open'
op|'('
op|')'
newline|'\n'
name|'file_name'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'basename'
op|'('
name|'disk_file'
op|'.'
name|'_data_file'
op|')'
newline|'\n'
name|'etag'
op|'='
name|'md5'
op|'('
op|')'
newline|'\n'
name|'etag'
op|'.'
name|'update'
op|'('
string|"'VERIF'"
op|')'
newline|'\n'
name|'etag'
op|'='
name|'etag'
op|'.'
name|'hexdigest'
op|'('
op|')'
newline|'\n'
name|'metadata'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'timestamp'
op|','
string|"'name'"
op|':'
string|"'/a/c/o'"
op|','
nl|'\n'
string|"'Content-Length'"
op|':'
number|'6'
op|','
string|"'ETag'"
op|':'
name|'etag'
op|'}'
newline|'\n'
name|'diskfile'
op|'.'
name|'write_metadata'
op|'('
name|'disk_file'
op|'.'
name|'_fp'
op|','
name|'metadata'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'os'
op|'.'
name|'listdir'
op|'('
name|'disk_file'
op|'.'
name|'_datadir'
op|')'
op|'['
number|'0'
op|']'
op|','
name|'file_name'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'quar_dir'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'testdir'
op|','
string|"'sda1'"
op|','
string|"'quarantined'"
op|','
string|"'objects'"
op|','
nl|'\n'
name|'os'
op|'.'
name|'path'
op|'.'
name|'basename'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'dirname'
op|'('
name|'disk_file'
op|'.'
name|'_data_file'
op|')'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'os'
op|'.'
name|'listdir'
op|'('
name|'disk_file'
op|'.'
name|'_datadir'
op|')'
op|'['
number|'0'
op|']'
op|','
name|'file_name'
op|')'
newline|'\n'
name|'body'
op|'='
name|'resp'
op|'.'
name|'body'
comment|'# actually does quarantining'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'body'
op|','
string|"'VERIFY'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'os'
op|'.'
name|'listdir'
op|'('
name|'quar_dir'
op|')'
op|'['
number|'0'
op|']'
op|','
name|'file_name'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'404'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_GET_quarantine_zbyte
dedent|''
name|'def'
name|'test_GET_quarantine_zbyte'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# Test swift.obj.server.ObjectController.GET'
nl|'\n'
indent|'        '
name|'timestamp'
op|'='
name|'normalize_timestamp'
op|'('
name|'time'
op|'('
op|')'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'timestamp'
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'application/x-test'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'body'
op|'='
string|"'VERIFY'"
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'201'
op|')'
newline|'\n'
name|'disk_file'
op|'='
name|'self'
op|'.'
name|'df_mgr'
op|'.'
name|'get_diskfile'
op|'('
string|"'sda1'"
op|','
string|"'p'"
op|','
string|"'a'"
op|','
string|"'c'"
op|','
string|"'o'"
op|','
nl|'\n'
name|'policy'
op|'='
name|'POLICIES'
op|'.'
name|'legacy'
op|')'
newline|'\n'
name|'disk_file'
op|'.'
name|'open'
op|'('
op|')'
newline|'\n'
name|'file_name'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'basename'
op|'('
name|'disk_file'
op|'.'
name|'_data_file'
op|')'
newline|'\n'
name|'with'
name|'open'
op|'('
name|'disk_file'
op|'.'
name|'_data_file'
op|')'
name|'as'
name|'fp'
op|':'
newline|'\n'
indent|'            '
name|'metadata'
op|'='
name|'diskfile'
op|'.'
name|'read_metadata'
op|'('
name|'fp'
op|')'
newline|'\n'
dedent|''
name|'os'
op|'.'
name|'unlink'
op|'('
name|'disk_file'
op|'.'
name|'_data_file'
op|')'
newline|'\n'
name|'with'
name|'open'
op|'('
name|'disk_file'
op|'.'
name|'_data_file'
op|','
string|"'w'"
op|')'
name|'as'
name|'fp'
op|':'
newline|'\n'
indent|'            '
name|'diskfile'
op|'.'
name|'write_metadata'
op|'('
name|'fp'
op|','
name|'metadata'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'os'
op|'.'
name|'listdir'
op|'('
name|'disk_file'
op|'.'
name|'_datadir'
op|')'
op|'['
number|'0'
op|']'
op|','
name|'file_name'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'404'
op|')'
newline|'\n'
nl|'\n'
name|'quar_dir'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'testdir'
op|','
string|"'sda1'"
op|','
string|"'quarantined'"
op|','
string|"'objects'"
op|','
nl|'\n'
name|'os'
op|'.'
name|'path'
op|'.'
name|'basename'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'dirname'
op|'('
name|'disk_file'
op|'.'
name|'_data_file'
op|')'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'os'
op|'.'
name|'listdir'
op|'('
name|'quar_dir'
op|')'
op|'['
number|'0'
op|']'
op|','
name|'file_name'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_GET_quarantine_range
dedent|''
name|'def'
name|'test_GET_quarantine_range'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# Test swift.obj.server.ObjectController.GET'
nl|'\n'
indent|'        '
name|'timestamp'
op|'='
name|'normalize_timestamp'
op|'('
name|'time'
op|'('
op|')'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'timestamp'
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'application/x-test'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'body'
op|'='
string|"'VERIFY'"
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'201'
op|')'
newline|'\n'
name|'disk_file'
op|'='
name|'self'
op|'.'
name|'df_mgr'
op|'.'
name|'get_diskfile'
op|'('
string|"'sda1'"
op|','
string|"'p'"
op|','
string|"'a'"
op|','
string|"'c'"
op|','
string|"'o'"
op|','
nl|'\n'
name|'policy'
op|'='
name|'POLICIES'
op|'.'
name|'legacy'
op|')'
newline|'\n'
name|'disk_file'
op|'.'
name|'open'
op|'('
op|')'
newline|'\n'
name|'file_name'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'basename'
op|'('
name|'disk_file'
op|'.'
name|'_data_file'
op|')'
newline|'\n'
name|'etag'
op|'='
name|'md5'
op|'('
op|')'
newline|'\n'
name|'etag'
op|'.'
name|'update'
op|'('
string|"'VERIF'"
op|')'
newline|'\n'
name|'etag'
op|'='
name|'etag'
op|'.'
name|'hexdigest'
op|'('
op|')'
newline|'\n'
name|'metadata'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'timestamp'
op|','
string|"'name'"
op|':'
string|"'/a/c/o'"
op|','
nl|'\n'
string|"'Content-Length'"
op|':'
number|'6'
op|','
string|"'ETag'"
op|':'
name|'etag'
op|'}'
newline|'\n'
name|'diskfile'
op|'.'
name|'write_metadata'
op|'('
name|'disk_file'
op|'.'
name|'_fp'
op|','
name|'metadata'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'os'
op|'.'
name|'listdir'
op|'('
name|'disk_file'
op|'.'
name|'_datadir'
op|')'
op|'['
number|'0'
op|']'
op|','
name|'file_name'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|')'
newline|'\n'
name|'req'
op|'.'
name|'range'
op|'='
string|"'bytes=0-4'"
comment|'# partial'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'quar_dir'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'testdir'
op|','
string|"'sda1'"
op|','
string|"'quarantined'"
op|','
string|"'objects'"
op|','
nl|'\n'
name|'os'
op|'.'
name|'path'
op|'.'
name|'basename'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'dirname'
op|'('
name|'disk_file'
op|'.'
name|'_data_file'
op|')'
op|')'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'body'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'os'
op|'.'
name|'listdir'
op|'('
name|'disk_file'
op|'.'
name|'_datadir'
op|')'
op|'['
number|'0'
op|']'
op|','
name|'file_name'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'isdir'
op|'('
name|'quar_dir'
op|')'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'200'
op|')'
newline|'\n'
nl|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|')'
newline|'\n'
name|'req'
op|'.'
name|'range'
op|'='
string|"'bytes=1-6'"
comment|'# partial'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'quar_dir'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'testdir'
op|','
string|"'sda1'"
op|','
string|"'quarantined'"
op|','
string|"'objects'"
op|','
nl|'\n'
name|'os'
op|'.'
name|'path'
op|'.'
name|'basename'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'dirname'
op|'('
name|'disk_file'
op|'.'
name|'_data_file'
op|')'
op|')'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'body'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'os'
op|'.'
name|'listdir'
op|'('
name|'disk_file'
op|'.'
name|'_datadir'
op|')'
op|'['
number|'0'
op|']'
op|','
name|'file_name'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'isdir'
op|'('
name|'quar_dir'
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|')'
newline|'\n'
name|'req'
op|'.'
name|'range'
op|'='
string|"'bytes=0-14'"
comment|'# full'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'quar_dir'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'testdir'
op|','
string|"'sda1'"
op|','
string|"'quarantined'"
op|','
string|"'objects'"
op|','
nl|'\n'
name|'os'
op|'.'
name|'path'
op|'.'
name|'basename'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'dirname'
op|'('
name|'disk_file'
op|'.'
name|'_data_file'
op|')'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'os'
op|'.'
name|'listdir'
op|'('
name|'disk_file'
op|'.'
name|'_datadir'
op|')'
op|'['
number|'0'
op|']'
op|','
name|'file_name'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'body'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'isdir'
op|'('
name|'quar_dir'
op|')'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'404'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'('
string|'"time.time"'
op|','
name|'mock_time'
op|')'
newline|'\n'
DECL|member|test_DELETE
name|'def'
name|'test_DELETE'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# Test swift.obj.server.ObjectController.DELETE'
nl|'\n'
indent|'        '
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'DELETE'"
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'400'
op|')'
newline|'\n'
nl|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'DELETE'"
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'400'
op|')'
newline|'\n'
nl|'\n'
comment|'# The following should have created a tombstone file'
nl|'\n'
name|'timestamp'
op|'='
name|'normalize_timestamp'
op|'('
number|'1000'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'DELETE'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'timestamp'
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'404'
op|')'
newline|'\n'
name|'ts_1000_file'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'testdir'
op|','
string|"'sda1'"
op|','
nl|'\n'
name|'storage_directory'
op|'('
name|'diskfile'
op|'.'
name|'get_data_dir'
op|'('
name|'POLICIES'
op|'['
number|'0'
op|']'
op|')'
op|','
string|"'p'"
op|','
nl|'\n'
name|'hash_path'
op|'('
string|"'a'"
op|','
string|"'c'"
op|','
string|"'o'"
op|')'
op|')'
op|','
nl|'\n'
name|'utils'
op|'.'
name|'Timestamp'
op|'('
name|'timestamp'
op|')'
op|'.'
name|'internal'
op|'+'
string|"'.ts'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'isfile'
op|'('
name|'ts_1000_file'
op|')'
op|')'
newline|'\n'
comment|'# There should now be a 1000 ts file.'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'len'
op|'('
name|'os'
op|'.'
name|'listdir'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'dirname'
op|'('
name|'ts_1000_file'
op|')'
op|')'
op|')'
op|','
number|'1'
op|')'
newline|'\n'
nl|'\n'
comment|'# The following should *not* have created a tombstone file.'
nl|'\n'
name|'timestamp'
op|'='
name|'normalize_timestamp'
op|'('
number|'999'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'DELETE'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'timestamp'
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'404'
op|')'
newline|'\n'
name|'ts_999_file'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'testdir'
op|','
string|"'sda1'"
op|','
nl|'\n'
name|'storage_directory'
op|'('
name|'diskfile'
op|'.'
name|'get_data_dir'
op|'('
name|'POLICIES'
op|'['
number|'0'
op|']'
op|')'
op|','
string|"'p'"
op|','
nl|'\n'
name|'hash_path'
op|'('
string|"'a'"
op|','
string|"'c'"
op|','
string|"'o'"
op|')'
op|')'
op|','
nl|'\n'
name|'utils'
op|'.'
name|'Timestamp'
op|'('
name|'timestamp'
op|')'
op|'.'
name|'internal'
op|'+'
string|"'.ts'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'isfile'
op|'('
name|'ts_999_file'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'isfile'
op|'('
name|'ts_1000_file'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'len'
op|'('
name|'os'
op|'.'
name|'listdir'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'dirname'
op|'('
name|'ts_1000_file'
op|')'
op|')'
op|')'
op|','
number|'1'
op|')'
newline|'\n'
nl|'\n'
name|'orig_timestamp'
op|'='
name|'utils'
op|'.'
name|'Timestamp'
op|'('
number|'1002'
op|')'
op|'.'
name|'internal'
newline|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'orig_timestamp'
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'application/octet-stream'"
op|','
nl|'\n'
string|"'Content-Length'"
op|':'
string|"'4'"
op|'}'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
name|'headers'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'body'
op|'='
string|"'test'"
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'201'
op|')'
newline|'\n'
comment|'# There should now be 1000 ts and a 1001 data file.'
nl|'\n'
name|'data_1002_file'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'testdir'
op|','
string|"'sda1'"
op|','
nl|'\n'
name|'storage_directory'
op|'('
name|'diskfile'
op|'.'
name|'get_data_dir'
op|'('
name|'POLICIES'
op|'['
number|'0'
op|']'
op|')'
op|','
string|"'p'"
op|','
nl|'\n'
name|'hash_path'
op|'('
string|"'a'"
op|','
string|"'c'"
op|','
string|"'o'"
op|')'
op|')'
op|','
nl|'\n'
name|'orig_timestamp'
op|'+'
string|"'.data'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'isfile'
op|'('
name|'data_1002_file'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'len'
op|'('
name|'os'
op|'.'
name|'listdir'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'dirname'
op|'('
name|'data_1002_file'
op|')'
op|')'
op|')'
op|','
number|'1'
op|')'
newline|'\n'
nl|'\n'
comment|'# The following should *not* have created a tombstone file.'
nl|'\n'
name|'timestamp'
op|'='
name|'normalize_timestamp'
op|'('
number|'1001'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'DELETE'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'timestamp'
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'409'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'['
string|"'X-Backend-Timestamp'"
op|']'
op|','
name|'orig_timestamp'
op|')'
newline|'\n'
name|'ts_1001_file'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'testdir'
op|','
string|"'sda1'"
op|','
nl|'\n'
name|'storage_directory'
op|'('
name|'diskfile'
op|'.'
name|'get_data_dir'
op|'('
name|'POLICIES'
op|'['
number|'0'
op|']'
op|')'
op|','
string|"'p'"
op|','
nl|'\n'
name|'hash_path'
op|'('
string|"'a'"
op|','
string|"'c'"
op|','
string|"'o'"
op|')'
op|')'
op|','
nl|'\n'
name|'utils'
op|'.'
name|'Timestamp'
op|'('
name|'timestamp'
op|')'
op|'.'
name|'internal'
op|'+'
string|"'.ts'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'isfile'
op|'('
name|'ts_1001_file'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'isfile'
op|'('
name|'data_1002_file'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'len'
op|'('
name|'os'
op|'.'
name|'listdir'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'dirname'
op|'('
name|'ts_1001_file'
op|')'
op|')'
op|')'
op|','
number|'1'
op|')'
newline|'\n'
nl|'\n'
name|'timestamp'
op|'='
name|'normalize_timestamp'
op|'('
number|'1003'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'DELETE'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'timestamp'
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'204'
op|')'
newline|'\n'
name|'ts_1003_file'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'testdir'
op|','
string|"'sda1'"
op|','
nl|'\n'
name|'storage_directory'
op|'('
name|'diskfile'
op|'.'
name|'get_data_dir'
op|'('
name|'POLICIES'
op|'['
number|'0'
op|']'
op|')'
op|','
string|"'p'"
op|','
nl|'\n'
name|'hash_path'
op|'('
string|"'a'"
op|','
string|"'c'"
op|','
string|"'o'"
op|')'
op|')'
op|','
nl|'\n'
name|'utils'
op|'.'
name|'Timestamp'
op|'('
name|'timestamp'
op|')'
op|'.'
name|'internal'
op|'+'
string|"'.ts'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'isfile'
op|'('
name|'ts_1003_file'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'len'
op|'('
name|'os'
op|'.'
name|'listdir'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'dirname'
op|'('
name|'ts_1003_file'
op|')'
op|')'
op|')'
op|','
number|'1'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_DELETE_succeeds_with_later_POST
dedent|''
name|'def'
name|'test_DELETE_succeeds_with_later_POST'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'ts_iter'
op|'='
name|'make_timestamp_iter'
op|'('
op|')'
newline|'\n'
name|'t_put'
op|'='
name|'next'
op|'('
name|'ts_iter'
op|')'
op|'.'
name|'internal'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'t_put'
op|','
nl|'\n'
string|"'Content-Length'"
op|':'
number|'0'
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'plain/text'"
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'201'
op|')'
newline|'\n'
nl|'\n'
name|'t_delete'
op|'='
name|'next'
op|'('
name|'ts_iter'
op|')'
op|'.'
name|'internal'
newline|'\n'
name|'t_post'
op|'='
name|'next'
op|'('
name|'ts_iter'
op|')'
op|'.'
name|'internal'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'POST'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'t_post'
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'202'
op|')'
newline|'\n'
nl|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'DELETE'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'t_delete'
op|'}'
op|','
nl|'\n'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'204'
op|')'
newline|'\n'
nl|'\n'
name|'obj_dir'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'testdir'
op|','
string|"'sda1'"
op|','
nl|'\n'
name|'storage_directory'
op|'('
name|'diskfile'
op|'.'
name|'get_data_dir'
op|'('
number|'0'
op|')'
op|','
string|"'p'"
op|','
nl|'\n'
name|'hash_path'
op|'('
string|"'a'"
op|','
string|"'c'"
op|','
string|"'o'"
op|')'
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'ts_file'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'obj_dir'
op|','
name|'t_delete'
op|'+'
string|"'.ts'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'isfile'
op|'('
name|'ts_file'
op|')'
op|')'
newline|'\n'
name|'meta_file'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'obj_dir'
op|','
name|'t_post'
op|'+'
string|"'.meta'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'isfile'
op|'('
name|'meta_file'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_DELETE_container_updates
dedent|''
name|'def'
name|'test_DELETE_container_updates'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# Test swift.obj.server.ObjectController.DELETE and container'
nl|'\n'
comment|'# updates, making sure container update is called in the correct'
nl|'\n'
comment|'# state.'
nl|'\n'
indent|'        '
name|'start'
op|'='
name|'time'
op|'('
op|')'
newline|'\n'
name|'orig_timestamp'
op|'='
name|'utils'
op|'.'
name|'Timestamp'
op|'('
name|'start'
op|')'
newline|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'orig_timestamp'
op|'.'
name|'internal'
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'application/octet-stream'"
op|','
nl|'\n'
string|"'Content-Length'"
op|':'
string|"'4'"
op|'}'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
name|'headers'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'body'
op|'='
string|"'test'"
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'201'
op|')'
newline|'\n'
nl|'\n'
name|'calls_made'
op|'='
op|'['
number|'0'
op|']'
newline|'\n'
nl|'\n'
DECL|function|our_container_update
name|'def'
name|'our_container_update'
op|'('
op|'*'
name|'args'
op|','
op|'**'
name|'kwargs'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'calls_made'
op|'['
number|'0'
op|']'
op|'+='
number|'1'
newline|'\n'
nl|'\n'
dedent|''
name|'orig_cu'
op|'='
name|'self'
op|'.'
name|'object_controller'
op|'.'
name|'container_update'
newline|'\n'
name|'self'
op|'.'
name|'object_controller'
op|'.'
name|'container_update'
op|'='
name|'our_container_update'
newline|'\n'
name|'try'
op|':'
newline|'\n'
comment|'# The following request should return 409 (HTTP Conflict). A'
nl|'\n'
comment|'# tombstone file should not have been created with this timestamp.'
nl|'\n'
indent|'            '
name|'timestamp'
op|'='
name|'utils'
op|'.'
name|'Timestamp'
op|'('
name|'start'
op|'-'
number|'0.00001'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'DELETE'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'timestamp'
op|'.'
name|'internal'
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'409'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'['
string|"'x-backend-timestamp'"
op|']'
op|','
nl|'\n'
name|'orig_timestamp'
op|'.'
name|'internal'
op|')'
newline|'\n'
name|'objfile'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'testdir'
op|','
string|"'sda1'"
op|','
nl|'\n'
name|'storage_directory'
op|'('
name|'diskfile'
op|'.'
name|'get_data_dir'
op|'('
name|'POLICIES'
op|'['
number|'0'
op|']'
op|')'
op|','
string|"'p'"
op|','
nl|'\n'
name|'hash_path'
op|'('
string|"'a'"
op|','
string|"'c'"
op|','
string|"'o'"
op|')'
op|')'
op|','
nl|'\n'
name|'utils'
op|'.'
name|'Timestamp'
op|'('
name|'timestamp'
op|')'
op|'.'
name|'internal'
op|'+'
string|"'.ts'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'isfile'
op|'('
name|'objfile'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'len'
op|'('
name|'os'
op|'.'
name|'listdir'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'dirname'
op|'('
name|'objfile'
op|')'
op|')'
op|')'
op|','
number|'1'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'0'
op|','
name|'calls_made'
op|'['
number|'0'
op|']'
op|')'
newline|'\n'
nl|'\n'
comment|'# The following request should return 204, and the object should'
nl|'\n'
comment|'# be truly deleted (container update is performed) because this'
nl|'\n'
comment|'# timestamp is newer. A tombstone file should have been created'
nl|'\n'
comment|'# with this timestamp.'
nl|'\n'
name|'timestamp'
op|'='
name|'utils'
op|'.'
name|'Timestamp'
op|'('
name|'start'
op|'+'
number|'0.00001'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'DELETE'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'timestamp'
op|'.'
name|'internal'
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'204'
op|')'
newline|'\n'
name|'objfile'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'testdir'
op|','
string|"'sda1'"
op|','
nl|'\n'
name|'storage_directory'
op|'('
name|'diskfile'
op|'.'
name|'get_data_dir'
op|'('
name|'POLICIES'
op|'['
number|'0'
op|']'
op|')'
op|','
string|"'p'"
op|','
nl|'\n'
name|'hash_path'
op|'('
string|"'a'"
op|','
string|"'c'"
op|','
string|"'o'"
op|')'
op|')'
op|','
nl|'\n'
name|'utils'
op|'.'
name|'Timestamp'
op|'('
name|'timestamp'
op|')'
op|'.'
name|'internal'
op|'+'
string|"'.ts'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'isfile'
op|'('
name|'objfile'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'1'
op|','
name|'calls_made'
op|'['
number|'0'
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'len'
op|'('
name|'os'
op|'.'
name|'listdir'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'dirname'
op|'('
name|'objfile'
op|')'
op|')'
op|')'
op|','
number|'1'
op|')'
newline|'\n'
nl|'\n'
comment|'# The following request should return a 404, as the object should'
nl|'\n'
comment|'# already have been deleted, but it should have also performed a'
nl|'\n'
comment|'# container update because the timestamp is newer, and a tombstone'
nl|'\n'
comment|'# file should also exist with this timestamp.'
nl|'\n'
name|'timestamp'
op|'='
name|'utils'
op|'.'
name|'Timestamp'
op|'('
name|'start'
op|'+'
number|'0.00002'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'DELETE'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'timestamp'
op|'.'
name|'internal'
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'404'
op|')'
newline|'\n'
name|'objfile'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'testdir'
op|','
string|"'sda1'"
op|','
nl|'\n'
name|'storage_directory'
op|'('
name|'diskfile'
op|'.'
name|'get_data_dir'
op|'('
name|'POLICIES'
op|'['
number|'0'
op|']'
op|')'
op|','
string|"'p'"
op|','
nl|'\n'
name|'hash_path'
op|'('
string|"'a'"
op|','
string|"'c'"
op|','
string|"'o'"
op|')'
op|')'
op|','
nl|'\n'
name|'utils'
op|'.'
name|'Timestamp'
op|'('
name|'timestamp'
op|')'
op|'.'
name|'internal'
op|'+'
string|"'.ts'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'isfile'
op|'('
name|'objfile'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'2'
op|','
name|'calls_made'
op|'['
number|'0'
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'len'
op|'('
name|'os'
op|'.'
name|'listdir'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'dirname'
op|'('
name|'objfile'
op|')'
op|')'
op|')'
op|','
number|'1'
op|')'
newline|'\n'
nl|'\n'
comment|'# The following request should return a 404, as the object should'
nl|'\n'
comment|'# already have been deleted, and it should not have performed a'
nl|'\n'
comment|'# container update because the timestamp is older, or created a'
nl|'\n'
comment|'# tombstone file with this timestamp.'
nl|'\n'
name|'timestamp'
op|'='
name|'utils'
op|'.'
name|'Timestamp'
op|'('
name|'start'
op|'+'
number|'0.00001'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'DELETE'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'timestamp'
op|'.'
name|'internal'
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'404'
op|')'
newline|'\n'
name|'objfile'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'testdir'
op|','
string|"'sda1'"
op|','
nl|'\n'
name|'storage_directory'
op|'('
name|'diskfile'
op|'.'
name|'get_data_dir'
op|'('
name|'POLICIES'
op|'['
number|'0'
op|']'
op|')'
op|','
string|"'p'"
op|','
nl|'\n'
name|'hash_path'
op|'('
string|"'a'"
op|','
string|"'c'"
op|','
string|"'o'"
op|')'
op|')'
op|','
nl|'\n'
name|'utils'
op|'.'
name|'Timestamp'
op|'('
name|'timestamp'
op|')'
op|'.'
name|'internal'
op|'+'
string|"'.ts'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'isfile'
op|'('
name|'objfile'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'2'
op|','
name|'calls_made'
op|'['
number|'0'
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'len'
op|'('
name|'os'
op|'.'
name|'listdir'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'dirname'
op|'('
name|'objfile'
op|')'
op|')'
op|')'
op|','
number|'1'
op|')'
newline|'\n'
dedent|''
name|'finally'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'object_controller'
op|'.'
name|'container_update'
op|'='
name|'orig_cu'
newline|'\n'
nl|'\n'
DECL|member|test_DELETE_full_drive
dedent|''
dedent|''
name|'def'
name|'test_DELETE_full_drive'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|function|mock_diskfile_delete
indent|'        '
name|'def'
name|'mock_diskfile_delete'
op|'('
name|'self'
op|','
name|'timestamp'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'DiskFileNoSpace'
op|'('
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'t_put'
op|'='
name|'utils'
op|'.'
name|'Timestamp'
op|'('
name|'time'
op|'('
op|')'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'t_put'
op|'.'
name|'internal'
op|','
nl|'\n'
string|"'Content-Length'"
op|':'
number|'0'
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'plain/text'"
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'201'
op|')'
newline|'\n'
nl|'\n'
name|'with'
name|'mock'
op|'.'
name|'patch'
op|'('
string|"'swift.obj.diskfile.BaseDiskFile.delete'"
op|','
nl|'\n'
name|'mock_diskfile_delete'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'t_delete'
op|'='
name|'utils'
op|'.'
name|'Timestamp'
op|'('
name|'time'
op|'('
op|')'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'DELETE'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'t_delete'
op|'.'
name|'internal'
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'507'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_object_update_with_offset
dedent|''
name|'def'
name|'test_object_update_with_offset'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'ts'
op|'='
op|'('
name|'utils'
op|'.'
name|'Timestamp'
op|'('
name|'t'
op|')'
op|'.'
name|'internal'
name|'for'
name|'t'
name|'in'
nl|'\n'
name|'itertools'
op|'.'
name|'count'
op|'('
name|'int'
op|'('
name|'time'
op|'('
op|')'
op|')'
op|')'
op|')'
newline|'\n'
name|'container_updates'
op|'='
op|'['
op|']'
newline|'\n'
nl|'\n'
DECL|function|capture_updates
name|'def'
name|'capture_updates'
op|'('
name|'ip'
op|','
name|'port'
op|','
name|'method'
op|','
name|'path'
op|','
name|'headers'
op|','
op|'*'
name|'args'
op|','
op|'**'
name|'kwargs'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'container_updates'
op|'.'
name|'append'
op|'('
op|'('
name|'ip'
op|','
name|'port'
op|','
name|'method'
op|','
name|'path'
op|','
name|'headers'
op|')'
op|')'
newline|'\n'
comment|'# create a new object'
nl|'\n'
dedent|''
name|'create_timestamp'
op|'='
name|'next'
op|'('
name|'ts'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
name|'method'
op|'='
string|"'PUT'"
op|','
name|'body'
op|'='
string|"'test1'"
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'create_timestamp'
op|','
nl|'\n'
string|"'X-Container-Host'"
op|':'
string|"'10.0.0.1:8080'"
op|','
nl|'\n'
string|"'X-Container-Device'"
op|':'
string|"'sda1'"
op|','
nl|'\n'
string|"'X-Container-Partition'"
op|':'
string|"'p'"
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'text/plain'"
op|'}'
op|')'
newline|'\n'
name|'with'
name|'fake_spawn'
op|'('
op|')'
op|','
name|'mocked_http_conn'
op|'('
nl|'\n'
number|'200'
op|','
name|'give_connect'
op|'='
name|'capture_updates'
op|')'
name|'as'
name|'fake_conn'
op|':'
newline|'\n'
indent|'            '
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'StopIteration'
op|','
name|'fake_conn'
op|'.'
name|'code_iter'
op|'.'
name|'next'
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'201'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'1'
op|','
name|'len'
op|'('
name|'container_updates'
op|')'
op|')'
newline|'\n'
name|'for'
name|'update'
name|'in'
name|'container_updates'
op|':'
newline|'\n'
indent|'            '
name|'ip'
op|','
name|'port'
op|','
name|'method'
op|','
name|'path'
op|','
name|'headers'
op|'='
name|'update'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'ip'
op|','
string|"'10.0.0.1'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'port'
op|','
string|"'8080'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'method'
op|','
string|"'PUT'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'path'
op|','
string|"'/sda1/p/a/c/o'"
op|')'
newline|'\n'
name|'expected'
op|'='
op|'{'
nl|'\n'
string|"'X-Size'"
op|':'
name|'len'
op|'('
string|"'test1'"
op|')'
op|','
nl|'\n'
string|"'X-Etag'"
op|':'
name|'md5'
op|'('
string|"'test1'"
op|')'
op|'.'
name|'hexdigest'
op|'('
op|')'
op|','
nl|'\n'
string|"'X-Content-Type'"
op|':'
string|"'text/plain'"
op|','
nl|'\n'
string|"'X-Timestamp'"
op|':'
name|'create_timestamp'
op|','
nl|'\n'
op|'}'
newline|'\n'
name|'for'
name|'key'
op|','
name|'value'
name|'in'
name|'expected'
op|'.'
name|'items'
op|'('
op|')'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'headers'
op|'['
name|'key'
op|']'
op|','
name|'str'
op|'('
name|'value'
op|')'
op|')'
newline|'\n'
dedent|''
dedent|''
name|'container_updates'
op|'='
op|'['
op|']'
comment|'# reset'
newline|'\n'
comment|'# read back object'
nl|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
name|'method'
op|'='
string|"'GET'"
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'200'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'['
string|"'X-Timestamp'"
op|']'
op|','
nl|'\n'
name|'utils'
op|'.'
name|'Timestamp'
op|'('
name|'create_timestamp'
op|')'
op|'.'
name|'normal'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'['
string|"'X-Backend-Timestamp'"
op|']'
op|','
nl|'\n'
name|'create_timestamp'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'body'
op|','
string|"'test1'"
op|')'
newline|'\n'
comment|'# send an update with an offset'
nl|'\n'
name|'offset_timestamp'
op|'='
name|'utils'
op|'.'
name|'Timestamp'
op|'('
nl|'\n'
name|'create_timestamp'
op|','
name|'offset'
op|'='
number|'1'
op|')'
op|'.'
name|'internal'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
name|'method'
op|'='
string|"'PUT'"
op|','
name|'body'
op|'='
string|"'test2'"
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'offset_timestamp'
op|','
nl|'\n'
string|"'X-Container-Host'"
op|':'
string|"'10.0.0.1:8080'"
op|','
nl|'\n'
string|"'X-Container-Device'"
op|':'
string|"'sda1'"
op|','
nl|'\n'
string|"'X-Container-Partition'"
op|':'
string|"'p'"
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'text/html'"
op|'}'
op|')'
newline|'\n'
name|'with'
name|'fake_spawn'
op|'('
op|')'
op|','
name|'mocked_http_conn'
op|'('
nl|'\n'
number|'200'
op|','
name|'give_connect'
op|'='
name|'capture_updates'
op|')'
name|'as'
name|'fake_conn'
op|':'
newline|'\n'
indent|'            '
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'StopIteration'
op|','
name|'fake_conn'
op|'.'
name|'code_iter'
op|'.'
name|'next'
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'201'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'1'
op|','
name|'len'
op|'('
name|'container_updates'
op|')'
op|')'
newline|'\n'
name|'for'
name|'update'
name|'in'
name|'container_updates'
op|':'
newline|'\n'
indent|'            '
name|'ip'
op|','
name|'port'
op|','
name|'method'
op|','
name|'path'
op|','
name|'headers'
op|'='
name|'update'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'ip'
op|','
string|"'10.0.0.1'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'port'
op|','
string|"'8080'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'method'
op|','
string|"'PUT'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'path'
op|','
string|"'/sda1/p/a/c/o'"
op|')'
newline|'\n'
name|'expected'
op|'='
op|'{'
nl|'\n'
string|"'X-Size'"
op|':'
name|'len'
op|'('
string|"'test2'"
op|')'
op|','
nl|'\n'
string|"'X-Etag'"
op|':'
name|'md5'
op|'('
string|"'test2'"
op|')'
op|'.'
name|'hexdigest'
op|'('
op|')'
op|','
nl|'\n'
string|"'X-Content-Type'"
op|':'
string|"'text/html'"
op|','
nl|'\n'
string|"'X-Timestamp'"
op|':'
name|'offset_timestamp'
op|','
nl|'\n'
op|'}'
newline|'\n'
name|'for'
name|'key'
op|','
name|'value'
name|'in'
name|'expected'
op|'.'
name|'items'
op|'('
op|')'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'headers'
op|'['
name|'key'
op|']'
op|','
name|'str'
op|'('
name|'value'
op|')'
op|')'
newline|'\n'
dedent|''
dedent|''
name|'container_updates'
op|'='
op|'['
op|']'
comment|'# reset'
newline|'\n'
comment|'# read back new offset'
nl|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
name|'method'
op|'='
string|"'GET'"
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'200'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'['
string|"'X-Timestamp'"
op|']'
op|','
nl|'\n'
name|'utils'
op|'.'
name|'Timestamp'
op|'('
name|'offset_timestamp'
op|')'
op|'.'
name|'normal'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'['
string|"'X-Backend-Timestamp'"
op|']'
op|','
nl|'\n'
name|'offset_timestamp'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'body'
op|','
string|"'test2'"
op|')'
newline|'\n'
comment|'# now overwrite with a newer time'
nl|'\n'
name|'overwrite_timestamp'
op|'='
name|'next'
op|'('
name|'ts'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
name|'method'
op|'='
string|"'PUT'"
op|','
name|'body'
op|'='
string|"'test3'"
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'overwrite_timestamp'
op|','
nl|'\n'
string|"'X-Container-Host'"
op|':'
string|"'10.0.0.1:8080'"
op|','
nl|'\n'
string|"'X-Container-Device'"
op|':'
string|"'sda1'"
op|','
nl|'\n'
string|"'X-Container-Partition'"
op|':'
string|"'p'"
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'text/enriched'"
op|'}'
op|')'
newline|'\n'
name|'with'
name|'fake_spawn'
op|'('
op|')'
op|','
name|'mocked_http_conn'
op|'('
nl|'\n'
number|'200'
op|','
name|'give_connect'
op|'='
name|'capture_updates'
op|')'
name|'as'
name|'fake_conn'
op|':'
newline|'\n'
indent|'            '
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'StopIteration'
op|','
name|'fake_conn'
op|'.'
name|'code_iter'
op|'.'
name|'next'
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'201'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'1'
op|','
name|'len'
op|'('
name|'container_updates'
op|')'
op|')'
newline|'\n'
name|'for'
name|'update'
name|'in'
name|'container_updates'
op|':'
newline|'\n'
indent|'            '
name|'ip'
op|','
name|'port'
op|','
name|'method'
op|','
name|'path'
op|','
name|'headers'
op|'='
name|'update'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'ip'
op|','
string|"'10.0.0.1'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'port'
op|','
string|"'8080'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'method'
op|','
string|"'PUT'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'path'
op|','
string|"'/sda1/p/a/c/o'"
op|')'
newline|'\n'
name|'expected'
op|'='
op|'{'
nl|'\n'
string|"'X-Size'"
op|':'
name|'len'
op|'('
string|"'test3'"
op|')'
op|','
nl|'\n'
string|"'X-Etag'"
op|':'
name|'md5'
op|'('
string|"'test3'"
op|')'
op|'.'
name|'hexdigest'
op|'('
op|')'
op|','
nl|'\n'
string|"'X-Content-Type'"
op|':'
string|"'text/enriched'"
op|','
nl|'\n'
string|"'X-Timestamp'"
op|':'
name|'overwrite_timestamp'
op|','
nl|'\n'
op|'}'
newline|'\n'
name|'for'
name|'key'
op|','
name|'value'
name|'in'
name|'expected'
op|'.'
name|'items'
op|'('
op|')'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'headers'
op|'['
name|'key'
op|']'
op|','
name|'str'
op|'('
name|'value'
op|')'
op|')'
newline|'\n'
dedent|''
dedent|''
name|'container_updates'
op|'='
op|'['
op|']'
comment|'# reset'
newline|'\n'
comment|'# read back overwrite'
nl|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
name|'method'
op|'='
string|"'GET'"
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'200'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'['
string|"'X-Timestamp'"
op|']'
op|','
nl|'\n'
name|'utils'
op|'.'
name|'Timestamp'
op|'('
name|'overwrite_timestamp'
op|')'
op|'.'
name|'normal'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'['
string|"'X-Backend-Timestamp'"
op|']'
op|','
nl|'\n'
name|'overwrite_timestamp'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'body'
op|','
string|"'test3'"
op|')'
newline|'\n'
comment|'# delete with an offset'
nl|'\n'
name|'offset_delete'
op|'='
name|'utils'
op|'.'
name|'Timestamp'
op|'('
name|'overwrite_timestamp'
op|','
nl|'\n'
name|'offset'
op|'='
number|'1'
op|')'
op|'.'
name|'internal'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
name|'method'
op|'='
string|"'DELETE'"
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'offset_delete'
op|','
nl|'\n'
string|"'X-Container-Host'"
op|':'
string|"'10.0.0.1:8080'"
op|','
nl|'\n'
string|"'X-Container-Device'"
op|':'
string|"'sda1'"
op|','
nl|'\n'
string|"'X-Container-Partition'"
op|':'
string|"'p'"
op|'}'
op|')'
newline|'\n'
name|'with'
name|'fake_spawn'
op|'('
op|')'
op|','
name|'mocked_http_conn'
op|'('
nl|'\n'
number|'200'
op|','
name|'give_connect'
op|'='
name|'capture_updates'
op|')'
name|'as'
name|'fake_conn'
op|':'
newline|'\n'
indent|'            '
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'StopIteration'
op|','
name|'fake_conn'
op|'.'
name|'code_iter'
op|'.'
name|'next'
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'204'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'1'
op|','
name|'len'
op|'('
name|'container_updates'
op|')'
op|')'
newline|'\n'
name|'for'
name|'update'
name|'in'
name|'container_updates'
op|':'
newline|'\n'
indent|'            '
name|'ip'
op|','
name|'port'
op|','
name|'method'
op|','
name|'path'
op|','
name|'headers'
op|'='
name|'update'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'ip'
op|','
string|"'10.0.0.1'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'port'
op|','
string|"'8080'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'method'
op|','
string|"'DELETE'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'path'
op|','
string|"'/sda1/p/a/c/o'"
op|')'
newline|'\n'
name|'expected'
op|'='
op|'{'
nl|'\n'
string|"'X-Timestamp'"
op|':'
name|'offset_delete'
op|','
nl|'\n'
op|'}'
newline|'\n'
name|'for'
name|'key'
op|','
name|'value'
name|'in'
name|'expected'
op|'.'
name|'items'
op|'('
op|')'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'headers'
op|'['
name|'key'
op|']'
op|','
name|'str'
op|'('
name|'value'
op|')'
op|')'
newline|'\n'
dedent|''
dedent|''
name|'container_updates'
op|'='
op|'['
op|']'
comment|'# reset'
newline|'\n'
comment|'# read back offset delete'
nl|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
name|'method'
op|'='
string|"'GET'"
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'404'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'['
string|"'X-Timestamp'"
op|']'
op|','
name|'None'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'['
string|"'X-Backend-Timestamp'"
op|']'
op|','
name|'offset_delete'
op|')'
newline|'\n'
comment|'# and one more delete with a newer timestamp'
nl|'\n'
name|'delete_timestamp'
op|'='
name|'next'
op|'('
name|'ts'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
name|'method'
op|'='
string|"'DELETE'"
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'delete_timestamp'
op|','
nl|'\n'
string|"'X-Container-Host'"
op|':'
string|"'10.0.0.1:8080'"
op|','
nl|'\n'
string|"'X-Container-Device'"
op|':'
string|"'sda1'"
op|','
nl|'\n'
string|"'X-Container-Partition'"
op|':'
string|"'p'"
op|'}'
op|')'
newline|'\n'
name|'with'
name|'fake_spawn'
op|'('
op|')'
op|','
name|'mocked_http_conn'
op|'('
nl|'\n'
number|'200'
op|','
name|'give_connect'
op|'='
name|'capture_updates'
op|')'
name|'as'
name|'fake_conn'
op|':'
newline|'\n'
indent|'            '
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'StopIteration'
op|','
name|'fake_conn'
op|'.'
name|'code_iter'
op|'.'
name|'next'
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'404'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'1'
op|','
name|'len'
op|'('
name|'container_updates'
op|')'
op|')'
newline|'\n'
name|'for'
name|'update'
name|'in'
name|'container_updates'
op|':'
newline|'\n'
indent|'            '
name|'ip'
op|','
name|'port'
op|','
name|'method'
op|','
name|'path'
op|','
name|'headers'
op|'='
name|'update'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'ip'
op|','
string|"'10.0.0.1'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'port'
op|','
string|"'8080'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'method'
op|','
string|"'DELETE'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'path'
op|','
string|"'/sda1/p/a/c/o'"
op|')'
newline|'\n'
name|'expected'
op|'='
op|'{'
nl|'\n'
string|"'X-Timestamp'"
op|':'
name|'delete_timestamp'
op|','
nl|'\n'
op|'}'
newline|'\n'
name|'for'
name|'key'
op|','
name|'value'
name|'in'
name|'expected'
op|'.'
name|'items'
op|'('
op|')'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'headers'
op|'['
name|'key'
op|']'
op|','
name|'str'
op|'('
name|'value'
op|')'
op|')'
newline|'\n'
dedent|''
dedent|''
name|'container_updates'
op|'='
op|'['
op|']'
comment|'# reset'
newline|'\n'
comment|'# read back delete'
nl|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
name|'method'
op|'='
string|"'GET'"
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'404'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'['
string|"'X-Timestamp'"
op|']'
op|','
name|'None'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'['
string|"'X-Backend-Timestamp'"
op|']'
op|','
name|'delete_timestamp'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_call_bad_request
dedent|''
name|'def'
name|'test_call_bad_request'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# Test swift.obj.server.ObjectController.__call__'
nl|'\n'
indent|'        '
name|'inbuf'
op|'='
name|'WsgiBytesIO'
op|'('
op|')'
newline|'\n'
name|'errbuf'
op|'='
name|'StringIO'
op|'('
op|')'
newline|'\n'
name|'outbuf'
op|'='
name|'StringIO'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|function|start_response
name|'def'
name|'start_response'
op|'('
op|'*'
name|'args'
op|')'
op|':'
newline|'\n'
indent|'            '
string|'"""Sends args to outbuf"""'
newline|'\n'
name|'outbuf'
op|'.'
name|'writelines'
op|'('
name|'args'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'object_controller'
op|'.'
name|'__call__'
op|'('
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|','
nl|'\n'
string|"'SCRIPT_NAME'"
op|':'
string|"''"
op|','
nl|'\n'
string|"'PATH_INFO'"
op|':'
string|"'/sda1/p/a/c/o'"
op|','
nl|'\n'
string|"'SERVER_NAME'"
op|':'
string|"'127.0.0.1'"
op|','
nl|'\n'
string|"'SERVER_PORT'"
op|':'
string|"'8080'"
op|','
nl|'\n'
string|"'SERVER_PROTOCOL'"
op|':'
string|"'HTTP/1.0'"
op|','
nl|'\n'
string|"'CONTENT_LENGTH'"
op|':'
string|"'0'"
op|','
nl|'\n'
string|"'wsgi.version'"
op|':'
op|'('
number|'1'
op|','
number|'0'
op|')'
op|','
nl|'\n'
string|"'wsgi.url_scheme'"
op|':'
string|"'http'"
op|','
nl|'\n'
string|"'wsgi.input'"
op|':'
name|'inbuf'
op|','
nl|'\n'
string|"'wsgi.errors'"
op|':'
name|'errbuf'
op|','
nl|'\n'
string|"'wsgi.multithread'"
op|':'
name|'False'
op|','
nl|'\n'
string|"'wsgi.multiprocess'"
op|':'
name|'False'
op|','
nl|'\n'
string|"'wsgi.run_once'"
op|':'
name|'False'
op|'}'
op|','
nl|'\n'
name|'start_response'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'errbuf'
op|'.'
name|'getvalue'
op|'('
op|')'
op|','
string|"''"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'outbuf'
op|'.'
name|'getvalue'
op|'('
op|')'
op|'['
op|':'
number|'4'
op|']'
op|','
string|"'400 '"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_call_not_found
dedent|''
name|'def'
name|'test_call_not_found'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'inbuf'
op|'='
name|'WsgiBytesIO'
op|'('
op|')'
newline|'\n'
name|'errbuf'
op|'='
name|'StringIO'
op|'('
op|')'
newline|'\n'
name|'outbuf'
op|'='
name|'StringIO'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|function|start_response
name|'def'
name|'start_response'
op|'('
op|'*'
name|'args'
op|')'
op|':'
newline|'\n'
indent|'            '
string|'"""Sends args to outbuf"""'
newline|'\n'
name|'outbuf'
op|'.'
name|'writelines'
op|'('
name|'args'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'object_controller'
op|'.'
name|'__call__'
op|'('
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'GET'"
op|','
nl|'\n'
string|"'SCRIPT_NAME'"
op|':'
string|"''"
op|','
nl|'\n'
string|"'PATH_INFO'"
op|':'
string|"'/sda1/p/a/c/o'"
op|','
nl|'\n'
string|"'SERVER_NAME'"
op|':'
string|"'127.0.0.1'"
op|','
nl|'\n'
string|"'SERVER_PORT'"
op|':'
string|"'8080'"
op|','
nl|'\n'
string|"'SERVER_PROTOCOL'"
op|':'
string|"'HTTP/1.0'"
op|','
nl|'\n'
string|"'CONTENT_LENGTH'"
op|':'
string|"'0'"
op|','
nl|'\n'
string|"'wsgi.version'"
op|':'
op|'('
number|'1'
op|','
number|'0'
op|')'
op|','
nl|'\n'
string|"'wsgi.url_scheme'"
op|':'
string|"'http'"
op|','
nl|'\n'
string|"'wsgi.input'"
op|':'
name|'inbuf'
op|','
nl|'\n'
string|"'wsgi.errors'"
op|':'
name|'errbuf'
op|','
nl|'\n'
string|"'wsgi.multithread'"
op|':'
name|'False'
op|','
nl|'\n'
string|"'wsgi.multiprocess'"
op|':'
name|'False'
op|','
nl|'\n'
string|"'wsgi.run_once'"
op|':'
name|'False'
op|'}'
op|','
nl|'\n'
name|'start_response'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'errbuf'
op|'.'
name|'getvalue'
op|'('
op|')'
op|','
string|"''"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'outbuf'
op|'.'
name|'getvalue'
op|'('
op|')'
op|'['
op|':'
number|'4'
op|']'
op|','
string|"'404 '"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_call_bad_method
dedent|''
name|'def'
name|'test_call_bad_method'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'inbuf'
op|'='
name|'WsgiBytesIO'
op|'('
op|')'
newline|'\n'
name|'errbuf'
op|'='
name|'StringIO'
op|'('
op|')'
newline|'\n'
name|'outbuf'
op|'='
name|'StringIO'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|function|start_response
name|'def'
name|'start_response'
op|'('
op|'*'
name|'args'
op|')'
op|':'
newline|'\n'
indent|'            '
string|'"""Sends args to outbuf"""'
newline|'\n'
name|'outbuf'
op|'.'
name|'writelines'
op|'('
name|'args'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'object_controller'
op|'.'
name|'__call__'
op|'('
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'INVALID'"
op|','
nl|'\n'
string|"'SCRIPT_NAME'"
op|':'
string|"''"
op|','
nl|'\n'
string|"'PATH_INFO'"
op|':'
string|"'/sda1/p/a/c/o'"
op|','
nl|'\n'
string|"'SERVER_NAME'"
op|':'
string|"'127.0.0.1'"
op|','
nl|'\n'
string|"'SERVER_PORT'"
op|':'
string|"'8080'"
op|','
nl|'\n'
string|"'SERVER_PROTOCOL'"
op|':'
string|"'HTTP/1.0'"
op|','
nl|'\n'
string|"'CONTENT_LENGTH'"
op|':'
string|"'0'"
op|','
nl|'\n'
string|"'wsgi.version'"
op|':'
op|'('
number|'1'
op|','
number|'0'
op|')'
op|','
nl|'\n'
string|"'wsgi.url_scheme'"
op|':'
string|"'http'"
op|','
nl|'\n'
string|"'wsgi.input'"
op|':'
name|'inbuf'
op|','
nl|'\n'
string|"'wsgi.errors'"
op|':'
name|'errbuf'
op|','
nl|'\n'
string|"'wsgi.multithread'"
op|':'
name|'False'
op|','
nl|'\n'
string|"'wsgi.multiprocess'"
op|':'
name|'False'
op|','
nl|'\n'
string|"'wsgi.run_once'"
op|':'
name|'False'
op|'}'
op|','
nl|'\n'
name|'start_response'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'errbuf'
op|'.'
name|'getvalue'
op|'('
op|')'
op|','
string|"''"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'outbuf'
op|'.'
name|'getvalue'
op|'('
op|')'
op|'['
op|':'
number|'4'
op|']'
op|','
string|"'405 '"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_call_name_collision
dedent|''
name|'def'
name|'test_call_name_collision'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
DECL|function|my_check
indent|'        '
name|'def'
name|'my_check'
op|'('
op|'*'
name|'args'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'return'
name|'False'
newline|'\n'
nl|'\n'
DECL|function|my_hash_path
dedent|''
name|'def'
name|'my_hash_path'
op|'('
op|'*'
name|'args'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'return'
name|'md5'
op|'('
string|"'collide'"
op|')'
op|'.'
name|'hexdigest'
op|'('
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'with'
name|'mock'
op|'.'
name|'patch'
op|'('
string|'"swift.obj.diskfile.hash_path"'
op|','
name|'my_hash_path'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'with'
name|'mock'
op|'.'
name|'patch'
op|'('
string|'"swift.obj.server.check_object_creation"'
op|','
nl|'\n'
name|'my_check'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'inbuf'
op|'='
name|'WsgiBytesIO'
op|'('
op|')'
newline|'\n'
name|'errbuf'
op|'='
name|'StringIO'
op|'('
op|')'
newline|'\n'
name|'outbuf'
op|'='
name|'StringIO'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|function|start_response
name|'def'
name|'start_response'
op|'('
op|'*'
name|'args'
op|')'
op|':'
newline|'\n'
indent|'                    '
string|'"""Sends args to outbuf"""'
newline|'\n'
name|'outbuf'
op|'.'
name|'writelines'
op|'('
name|'args'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'object_controller'
op|'.'
name|'__call__'
op|'('
op|'{'
nl|'\n'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|','
nl|'\n'
string|"'SCRIPT_NAME'"
op|':'
string|"''"
op|','
nl|'\n'
string|"'PATH_INFO'"
op|':'
string|"'/sda1/p/a/c/o'"
op|','
nl|'\n'
string|"'SERVER_NAME'"
op|':'
string|"'127.0.0.1'"
op|','
nl|'\n'
string|"'SERVER_PORT'"
op|':'
string|"'8080'"
op|','
nl|'\n'
string|"'SERVER_PROTOCOL'"
op|':'
string|"'HTTP/1.0'"
op|','
nl|'\n'
string|"'CONTENT_LENGTH'"
op|':'
string|"'0'"
op|','
nl|'\n'
string|"'CONTENT_TYPE'"
op|':'
string|"'text/html'"
op|','
nl|'\n'
string|"'HTTP_X_TIMESTAMP'"
op|':'
name|'normalize_timestamp'
op|'('
number|'1.2'
op|')'
op|','
nl|'\n'
string|"'wsgi.version'"
op|':'
op|'('
number|'1'
op|','
number|'0'
op|')'
op|','
nl|'\n'
string|"'wsgi.url_scheme'"
op|':'
string|"'http'"
op|','
nl|'\n'
string|"'wsgi.input'"
op|':'
name|'inbuf'
op|','
nl|'\n'
string|"'wsgi.errors'"
op|':'
name|'errbuf'
op|','
nl|'\n'
string|"'wsgi.multithread'"
op|':'
name|'False'
op|','
nl|'\n'
string|"'wsgi.multiprocess'"
op|':'
name|'False'
op|','
nl|'\n'
string|"'wsgi.run_once'"
op|':'
name|'False'
op|'}'
op|','
nl|'\n'
name|'start_response'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'errbuf'
op|'.'
name|'getvalue'
op|'('
op|')'
op|','
string|"''"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'outbuf'
op|'.'
name|'getvalue'
op|'('
op|')'
op|'['
op|':'
number|'4'
op|']'
op|','
string|"'201 '"
op|')'
newline|'\n'
nl|'\n'
name|'inbuf'
op|'='
name|'WsgiBytesIO'
op|'('
op|')'
newline|'\n'
name|'errbuf'
op|'='
name|'StringIO'
op|'('
op|')'
newline|'\n'
name|'outbuf'
op|'='
name|'StringIO'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|function|start_response
name|'def'
name|'start_response'
op|'('
op|'*'
name|'args'
op|')'
op|':'
newline|'\n'
indent|'                    '
string|'"""Sends args to outbuf"""'
newline|'\n'
name|'outbuf'
op|'.'
name|'writelines'
op|'('
name|'args'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'object_controller'
op|'.'
name|'__call__'
op|'('
op|'{'
nl|'\n'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|','
nl|'\n'
string|"'SCRIPT_NAME'"
op|':'
string|"''"
op|','
nl|'\n'
string|"'PATH_INFO'"
op|':'
string|"'/sda1/p/b/d/x'"
op|','
nl|'\n'
string|"'SERVER_NAME'"
op|':'
string|"'127.0.0.1'"
op|','
nl|'\n'
string|"'SERVER_PORT'"
op|':'
string|"'8080'"
op|','
nl|'\n'
string|"'SERVER_PROTOCOL'"
op|':'
string|"'HTTP/1.0'"
op|','
nl|'\n'
string|"'CONTENT_LENGTH'"
op|':'
string|"'0'"
op|','
nl|'\n'
string|"'CONTENT_TYPE'"
op|':'
string|"'text/html'"
op|','
nl|'\n'
string|"'HTTP_X_TIMESTAMP'"
op|':'
name|'normalize_timestamp'
op|'('
number|'1.3'
op|')'
op|','
nl|'\n'
string|"'wsgi.version'"
op|':'
op|'('
number|'1'
op|','
number|'0'
op|')'
op|','
nl|'\n'
string|"'wsgi.url_scheme'"
op|':'
string|"'http'"
op|','
nl|'\n'
string|"'wsgi.input'"
op|':'
name|'inbuf'
op|','
nl|'\n'
string|"'wsgi.errors'"
op|':'
name|'errbuf'
op|','
nl|'\n'
string|"'wsgi.multithread'"
op|':'
name|'False'
op|','
nl|'\n'
string|"'wsgi.multiprocess'"
op|':'
name|'False'
op|','
nl|'\n'
string|"'wsgi.run_once'"
op|':'
name|'False'
op|'}'
op|','
nl|'\n'
name|'start_response'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'errbuf'
op|'.'
name|'getvalue'
op|'('
op|')'
op|','
string|"''"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'outbuf'
op|'.'
name|'getvalue'
op|'('
op|')'
op|'['
op|':'
number|'4'
op|']'
op|','
string|"'403 '"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_invalid_method_doesnt_exist
dedent|''
dedent|''
dedent|''
name|'def'
name|'test_invalid_method_doesnt_exist'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'errbuf'
op|'='
name|'StringIO'
op|'('
op|')'
newline|'\n'
name|'outbuf'
op|'='
name|'StringIO'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|function|start_response
name|'def'
name|'start_response'
op|'('
op|'*'
name|'args'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'outbuf'
op|'.'
name|'writelines'
op|'('
name|'args'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'object_controller'
op|'.'
name|'__call__'
op|'('
op|'{'
nl|'\n'
string|"'REQUEST_METHOD'"
op|':'
string|"'method_doesnt_exist'"
op|','
nl|'\n'
string|"'PATH_INFO'"
op|':'
string|"'/sda1/p/a/c/o'"
op|'}'
op|','
nl|'\n'
name|'start_response'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'errbuf'
op|'.'
name|'getvalue'
op|'('
op|')'
op|','
string|"''"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'outbuf'
op|'.'
name|'getvalue'
op|'('
op|')'
op|'['
op|':'
number|'4'
op|']'
op|','
string|"'405 '"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_invalid_method_is_not_public
dedent|''
name|'def'
name|'test_invalid_method_is_not_public'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'errbuf'
op|'='
name|'StringIO'
op|'('
op|')'
newline|'\n'
name|'outbuf'
op|'='
name|'StringIO'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|function|start_response
name|'def'
name|'start_response'
op|'('
op|'*'
name|'args'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'outbuf'
op|'.'
name|'writelines'
op|'('
name|'args'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'object_controller'
op|'.'
name|'__call__'
op|'('
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'__init__'"
op|','
nl|'\n'
string|"'PATH_INFO'"
op|':'
string|"'/sda1/p/a/c/o'"
op|'}'
op|','
nl|'\n'
name|'start_response'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'errbuf'
op|'.'
name|'getvalue'
op|'('
op|')'
op|','
string|"''"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'outbuf'
op|'.'
name|'getvalue'
op|'('
op|')'
op|'['
op|':'
number|'4'
op|']'
op|','
string|"'405 '"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_chunked_put
dedent|''
name|'def'
name|'test_chunked_put'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'listener'
op|'='
name|'listen'
op|'('
op|'('
string|"'localhost'"
op|','
number|'0'
op|')'
op|')'
newline|'\n'
name|'port'
op|'='
name|'listener'
op|'.'
name|'getsockname'
op|'('
op|')'
op|'['
number|'1'
op|']'
newline|'\n'
name|'killer'
op|'='
name|'spawn'
op|'('
name|'wsgi'
op|'.'
name|'server'
op|','
name|'listener'
op|','
name|'self'
op|'.'
name|'object_controller'
op|','
nl|'\n'
name|'NullLogger'
op|'('
op|')'
op|')'
newline|'\n'
name|'sock'
op|'='
name|'connect_tcp'
op|'('
op|'('
string|"'localhost'"
op|','
name|'port'
op|')'
op|')'
newline|'\n'
name|'fd'
op|'='
name|'sock'
op|'.'
name|'makefile'
op|'('
op|')'
newline|'\n'
name|'fd'
op|'.'
name|'write'
op|'('
string|"'PUT /sda1/p/a/c/o HTTP/1.1\\r\\nHost: localhost\\r\\n'"
nl|'\n'
string|"'Content-Type: text/plain\\r\\n'"
nl|'\n'
string|"'Connection: close\\r\\nX-Timestamp: %s\\r\\n'"
nl|'\n'
string|"'Transfer-Encoding: chunked\\r\\n\\r\\n'"
nl|'\n'
string|"'2\\r\\noh\\r\\n4\\r\\n hai\\r\\n0\\r\\n\\r\\n'"
op|'%'
name|'normalize_timestamp'
op|'('
nl|'\n'
number|'1.0'
op|')'
op|')'
newline|'\n'
name|'fd'
op|'.'
name|'flush'
op|'('
op|')'
newline|'\n'
name|'headers'
op|'='
name|'readuntil2crlfs'
op|'('
name|'fd'
op|')'
newline|'\n'
name|'exp'
op|'='
string|"'HTTP/1.1 201'"
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'headers'
op|'['
op|':'
name|'len'
op|'('
name|'exp'
op|')'
op|']'
op|','
name|'exp'
op|')'
newline|'\n'
name|'sock'
op|'='
name|'connect_tcp'
op|'('
op|'('
string|"'localhost'"
op|','
name|'port'
op|')'
op|')'
newline|'\n'
name|'fd'
op|'='
name|'sock'
op|'.'
name|'makefile'
op|'('
op|')'
newline|'\n'
name|'fd'
op|'.'
name|'write'
op|'('
string|"'GET /sda1/p/a/c/o HTTP/1.1\\r\\nHost: localhost\\r\\n'"
nl|'\n'
string|"'Connection: close\\r\\n\\r\\n'"
op|')'
newline|'\n'
name|'fd'
op|'.'
name|'flush'
op|'('
op|')'
newline|'\n'
name|'headers'
op|'='
name|'readuntil2crlfs'
op|'('
name|'fd'
op|')'
newline|'\n'
name|'exp'
op|'='
string|"'HTTP/1.1 200'"
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'headers'
op|'['
op|':'
name|'len'
op|'('
name|'exp'
op|')'
op|']'
op|','
name|'exp'
op|')'
newline|'\n'
name|'response'
op|'='
name|'fd'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'response'
op|','
string|"'oh hai'"
op|')'
newline|'\n'
name|'killer'
op|'.'
name|'kill'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_chunked_content_length_mismatch_zero
dedent|''
name|'def'
name|'test_chunked_content_length_mismatch_zero'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'listener'
op|'='
name|'listen'
op|'('
op|'('
string|"'localhost'"
op|','
number|'0'
op|')'
op|')'
newline|'\n'
name|'port'
op|'='
name|'listener'
op|'.'
name|'getsockname'
op|'('
op|')'
op|'['
number|'1'
op|']'
newline|'\n'
name|'killer'
op|'='
name|'spawn'
op|'('
name|'wsgi'
op|'.'
name|'server'
op|','
name|'listener'
op|','
name|'self'
op|'.'
name|'object_controller'
op|','
nl|'\n'
name|'NullLogger'
op|'('
op|')'
op|')'
newline|'\n'
name|'sock'
op|'='
name|'connect_tcp'
op|'('
op|'('
string|"'localhost'"
op|','
name|'port'
op|')'
op|')'
newline|'\n'
name|'fd'
op|'='
name|'sock'
op|'.'
name|'makefile'
op|'('
op|')'
newline|'\n'
name|'fd'
op|'.'
name|'write'
op|'('
string|"'PUT /sda1/p/a/c/o HTTP/1.1\\r\\nHost: localhost\\r\\n'"
nl|'\n'
string|"'Content-Type: text/plain\\r\\n'"
nl|'\n'
string|"'Connection: close\\r\\nX-Timestamp: %s\\r\\n'"
nl|'\n'
string|"'Content-Length: 0\\r\\n'"
nl|'\n'
string|"'Transfer-Encoding: chunked\\r\\n\\r\\n'"
nl|'\n'
string|"'2\\r\\noh\\r\\n4\\r\\n hai\\r\\n0\\r\\n\\r\\n'"
op|'%'
name|'normalize_timestamp'
op|'('
nl|'\n'
number|'1.0'
op|')'
op|')'
newline|'\n'
name|'fd'
op|'.'
name|'flush'
op|'('
op|')'
newline|'\n'
name|'headers'
op|'='
name|'readuntil2crlfs'
op|'('
name|'fd'
op|')'
newline|'\n'
name|'exp'
op|'='
string|"'HTTP/1.1 201'"
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'headers'
op|'['
op|':'
name|'len'
op|'('
name|'exp'
op|')'
op|']'
op|','
name|'exp'
op|')'
newline|'\n'
name|'sock'
op|'='
name|'connect_tcp'
op|'('
op|'('
string|"'localhost'"
op|','
name|'port'
op|')'
op|')'
newline|'\n'
name|'fd'
op|'='
name|'sock'
op|'.'
name|'makefile'
op|'('
op|')'
newline|'\n'
name|'fd'
op|'.'
name|'write'
op|'('
string|"'GET /sda1/p/a/c/o HTTP/1.1\\r\\nHost: localhost\\r\\n'"
nl|'\n'
string|"'Connection: close\\r\\n\\r\\n'"
op|')'
newline|'\n'
name|'fd'
op|'.'
name|'flush'
op|'('
op|')'
newline|'\n'
name|'headers'
op|'='
name|'readuntil2crlfs'
op|'('
name|'fd'
op|')'
newline|'\n'
name|'exp'
op|'='
string|"'HTTP/1.1 200'"
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'headers'
op|'['
op|':'
name|'len'
op|'('
name|'exp'
op|')'
op|']'
op|','
name|'exp'
op|')'
newline|'\n'
name|'response'
op|'='
name|'fd'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'response'
op|','
string|"'oh hai'"
op|')'
newline|'\n'
name|'killer'
op|'.'
name|'kill'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_max_object_name_length
dedent|''
name|'def'
name|'test_max_object_name_length'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'timestamp'
op|'='
name|'normalize_timestamp'
op|'('
name|'time'
op|'('
op|')'
op|')'
newline|'\n'
name|'max_name_len'
op|'='
name|'constraints'
op|'.'
name|'MAX_OBJECT_NAME_LENGTH'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/'"
op|'+'
op|'('
string|"'1'"
op|'*'
name|'max_name_len'
op|')'
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'timestamp'
op|','
nl|'\n'
string|"'Content-Length'"
op|':'
string|"'4'"
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'application/octet-stream'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'body'
op|'='
string|"'DATA'"
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'201'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/'"
op|'+'
op|'('
string|"'2'"
op|'*'
op|'('
name|'max_name_len'
op|'+'
number|'1'
op|')'
op|')'
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'timestamp'
op|','
nl|'\n'
string|"'Content-Length'"
op|':'
string|"'4'"
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'application/octet-stream'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'body'
op|'='
string|"'DATA'"
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'400'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_max_upload_time
dedent|''
name|'def'
name|'test_max_upload_time'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|class|SlowBody
indent|'        '
name|'class'
name|'SlowBody'
op|'('
name|'object'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|member|__init__
indent|'            '
name|'def'
name|'__init__'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'sent'
op|'='
number|'0'
newline|'\n'
nl|'\n'
DECL|member|read
dedent|''
name|'def'
name|'read'
op|'('
name|'self'
op|','
name|'size'
op|'='
op|'-'
number|'1'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'if'
name|'self'
op|'.'
name|'sent'
op|'<'
number|'4'
op|':'
newline|'\n'
indent|'                    '
name|'sleep'
op|'('
number|'0.1'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'sent'
op|'+='
number|'1'
newline|'\n'
name|'return'
string|"' '"
newline|'\n'
dedent|''
name|'return'
string|"''"
newline|'\n'
nl|'\n'
DECL|member|set_hundred_continue_response_headers
dedent|''
name|'def'
name|'set_hundred_continue_response_headers'
op|'('
op|'*'
name|'a'
op|','
op|'**'
name|'kw'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'pass'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
nl|'\n'
DECL|variable|environ
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|','
string|"'wsgi.input'"
op|':'
name|'SlowBody'
op|'('
op|')'
op|'}'
op|','
nl|'\n'
DECL|variable|headers
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'normalize_timestamp'
op|'('
name|'time'
op|'('
op|')'
op|')'
op|','
nl|'\n'
string|"'Content-Length'"
op|':'
string|"'4'"
op|','
string|"'Content-Type'"
op|':'
string|"'text/plain'"
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'201'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'object_controller'
op|'.'
name|'max_upload_time'
op|'='
number|'0.1'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
nl|'\n'
DECL|variable|environ
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|','
string|"'wsgi.input'"
op|':'
name|'SlowBody'
op|'('
op|')'
op|'}'
op|','
nl|'\n'
DECL|variable|headers
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'normalize_timestamp'
op|'('
name|'time'
op|'('
op|')'
op|')'
op|','
nl|'\n'
string|"'Content-Length'"
op|':'
string|"'4'"
op|','
string|"'Content-Type'"
op|':'
string|"'text/plain'"
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'408'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_short_body
dedent|''
name|'def'
name|'test_short_body'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|class|ShortBody
indent|'        '
name|'class'
name|'ShortBody'
op|'('
name|'object'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|member|__init__
indent|'            '
name|'def'
name|'__init__'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'sent'
op|'='
name|'False'
newline|'\n'
nl|'\n'
DECL|member|read
dedent|''
name|'def'
name|'read'
op|'('
name|'self'
op|','
name|'size'
op|'='
op|'-'
number|'1'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'if'
name|'not'
name|'self'
op|'.'
name|'sent'
op|':'
newline|'\n'
indent|'                    '
name|'self'
op|'.'
name|'sent'
op|'='
name|'True'
newline|'\n'
name|'return'
string|"'   '"
newline|'\n'
dedent|''
name|'return'
string|"''"
newline|'\n'
nl|'\n'
DECL|member|set_hundred_continue_response_headers
dedent|''
name|'def'
name|'set_hundred_continue_response_headers'
op|'('
op|'*'
name|'a'
op|','
op|'**'
name|'kw'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'pass'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
nl|'\n'
DECL|variable|environ
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|','
string|"'wsgi.input'"
op|':'
name|'ShortBody'
op|'('
op|')'
op|'}'
op|','
nl|'\n'
DECL|variable|headers
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'normalize_timestamp'
op|'('
name|'time'
op|'('
op|')'
op|')'
op|','
nl|'\n'
string|"'Content-Length'"
op|':'
string|"'4'"
op|','
string|"'Content-Type'"
op|':'
string|"'text/plain'"
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'499'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_bad_sinces
dedent|''
name|'def'
name|'test_bad_sinces'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'normalize_timestamp'
op|'('
name|'time'
op|'('
op|')'
op|')'
op|','
nl|'\n'
string|"'Content-Length'"
op|':'
string|"'4'"
op|','
string|"'Content-Type'"
op|':'
string|"'text/plain'"
op|'}'
op|','
nl|'\n'
name|'body'
op|'='
string|"'    '"
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'201'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'GET'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'If-Unmodified-Since'"
op|':'
string|"'Not a valid date'"
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'200'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'GET'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'If-Modified-Since'"
op|':'
string|"'Not a valid date'"
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'200'
op|')'
newline|'\n'
nl|'\n'
name|'too_big_date_list'
op|'='
name|'list'
op|'('
name|'datetime'
op|'.'
name|'datetime'
op|'.'
name|'max'
op|'.'
name|'timetuple'
op|'('
op|')'
op|')'
newline|'\n'
name|'too_big_date_list'
op|'['
number|'0'
op|']'
op|'+='
number|'1'
comment|'# bump up the year'
newline|'\n'
name|'too_big_date'
op|'='
name|'strftime'
op|'('
nl|'\n'
string|'"%a, %d %b %Y %H:%M:%S UTC"'
op|','
name|'struct_time'
op|'('
name|'too_big_date_list'
op|')'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'GET'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'If-Unmodified-Since'"
op|':'
name|'too_big_date'
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'200'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_content_encoding
dedent|''
name|'def'
name|'test_content_encoding'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'normalize_timestamp'
op|'('
name|'time'
op|'('
op|')'
op|')'
op|','
nl|'\n'
string|"'Content-Length'"
op|':'
string|"'4'"
op|','
string|"'Content-Type'"
op|':'
string|"'text/plain'"
op|','
nl|'\n'
string|"'Content-Encoding'"
op|':'
string|"'gzip'"
op|'}'
op|','
nl|'\n'
name|'body'
op|'='
string|"'    '"
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'201'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'GET'"
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'200'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'['
string|"'content-encoding'"
op|']'
op|','
string|"'gzip'"
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'HEAD'"
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'200'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'['
string|"'content-encoding'"
op|']'
op|','
string|"'gzip'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_async_update_http_connect
dedent|''
name|'def'
name|'test_async_update_http_connect'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'policy'
op|'='
name|'random'
op|'.'
name|'choice'
op|'('
name|'list'
op|'('
name|'POLICIES'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_stage_tmp_dir'
op|'('
name|'policy'
op|')'
newline|'\n'
name|'given_args'
op|'='
op|'['
op|']'
newline|'\n'
nl|'\n'
DECL|function|fake_http_connect
name|'def'
name|'fake_http_connect'
op|'('
op|'*'
name|'args'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'given_args'
op|'.'
name|'extend'
op|'('
name|'args'
op|')'
newline|'\n'
name|'raise'
name|'Exception'
op|'('
string|"'test'"
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'orig_http_connect'
op|'='
name|'object_server'
op|'.'
name|'http_connect'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'object_server'
op|'.'
name|'http_connect'
op|'='
name|'fake_http_connect'
newline|'\n'
name|'self'
op|'.'
name|'object_controller'
op|'.'
name|'async_update'
op|'('
nl|'\n'
string|"'PUT'"
op|','
string|"'a'"
op|','
string|"'c'"
op|','
string|"'o'"
op|','
string|"'127.0.0.1:1234'"
op|','
number|'1'
op|','
string|"'sdc1'"
op|','
nl|'\n'
op|'{'
string|"'x-timestamp'"
op|':'
string|"'1'"
op|','
string|"'x-out'"
op|':'
string|"'set'"
op|','
nl|'\n'
string|"'X-Backend-Storage-Policy-Index'"
op|':'
name|'int'
op|'('
name|'policy'
op|')'
op|'}'
op|','
string|"'sda1'"
op|','
nl|'\n'
name|'policy'
op|')'
newline|'\n'
dedent|''
name|'finally'
op|':'
newline|'\n'
indent|'            '
name|'object_server'
op|'.'
name|'http_connect'
op|'='
name|'orig_http_connect'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
nl|'\n'
name|'given_args'
op|','
nl|'\n'
op|'['
string|"'127.0.0.1'"
op|','
string|"'1234'"
op|','
string|"'sdc1'"
op|','
number|'1'
op|','
string|"'PUT'"
op|','
string|"'/a/c/o'"
op|','
op|'{'
nl|'\n'
string|"'x-timestamp'"
op|':'
string|"'1'"
op|','
string|"'x-out'"
op|':'
string|"'set'"
op|','
nl|'\n'
string|"'user-agent'"
op|':'
string|"'object-server %s'"
op|'%'
name|'os'
op|'.'
name|'getpid'
op|'('
op|')'
op|','
nl|'\n'
string|"'X-Backend-Storage-Policy-Index'"
op|':'
name|'int'
op|'('
name|'policy'
op|')'
op|'}'
op|']'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'patch_policies'
op|'('
op|'['
name|'StoragePolicy'
op|'('
number|'0'
op|','
string|"'zero'"
op|','
name|'True'
op|')'
op|','
nl|'\n'
name|'StoragePolicy'
op|'('
number|'1'
op|','
string|"'one'"
op|')'
op|','
nl|'\n'
name|'StoragePolicy'
op|'('
number|'37'
op|','
string|"'fantastico'"
op|')'
op|']'
op|')'
newline|'\n'
DECL|member|test_updating_multiple_delete_at_container_servers
name|'def'
name|'test_updating_multiple_delete_at_container_servers'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# update router post patch'
nl|'\n'
indent|'        '
name|'self'
op|'.'
name|'object_controller'
op|'.'
name|'_diskfile_router'
op|'='
name|'diskfile'
op|'.'
name|'DiskFileRouter'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'conf'
op|','
name|'self'
op|'.'
name|'object_controller'
op|'.'
name|'logger'
op|')'
newline|'\n'
name|'policy'
op|'='
name|'random'
op|'.'
name|'choice'
op|'('
name|'list'
op|'('
name|'POLICIES'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'object_controller'
op|'.'
name|'expiring_objects_account'
op|'='
string|"'exp'"
newline|'\n'
name|'self'
op|'.'
name|'object_controller'
op|'.'
name|'expiring_objects_container_divisor'
op|'='
number|'60'
newline|'\n'
nl|'\n'
name|'http_connect_args'
op|'='
op|'['
op|']'
newline|'\n'
nl|'\n'
DECL|function|fake_http_connect
name|'def'
name|'fake_http_connect'
op|'('
name|'ipaddr'
op|','
name|'port'
op|','
name|'device'
op|','
name|'partition'
op|','
name|'method'
op|','
name|'path'
op|','
nl|'\n'
name|'headers'
op|'='
name|'None'
op|','
name|'query_string'
op|'='
name|'None'
op|','
name|'ssl'
op|'='
name|'False'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|class|SuccessfulFakeConn
indent|'            '
name|'class'
name|'SuccessfulFakeConn'
op|'('
name|'object'
op|')'
op|':'
newline|'\n'
nl|'\n'
indent|'                '
op|'@'
name|'property'
newline|'\n'
DECL|member|status
name|'def'
name|'status'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'                    '
name|'return'
number|'200'
newline|'\n'
nl|'\n'
DECL|member|getresponse
dedent|''
name|'def'
name|'getresponse'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'                    '
name|'return'
name|'self'
newline|'\n'
nl|'\n'
DECL|member|read
dedent|''
name|'def'
name|'read'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'                    '
name|'return'
string|"''"
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'captured_args'
op|'='
op|'{'
string|"'ipaddr'"
op|':'
name|'ipaddr'
op|','
string|"'port'"
op|':'
name|'port'
op|','
nl|'\n'
string|"'device'"
op|':'
name|'device'
op|','
string|"'partition'"
op|':'
name|'partition'
op|','
nl|'\n'
string|"'method'"
op|':'
name|'method'
op|','
string|"'path'"
op|':'
name|'path'
op|','
string|"'ssl'"
op|':'
name|'ssl'
op|','
nl|'\n'
string|"'headers'"
op|':'
name|'headers'
op|','
string|"'query_string'"
op|':'
name|'query_string'
op|'}'
newline|'\n'
nl|'\n'
name|'http_connect_args'
op|'.'
name|'append'
op|'('
nl|'\n'
name|'dict'
op|'('
op|'('
name|'k'
op|','
name|'v'
op|')'
name|'for'
name|'k'
op|','
name|'v'
name|'in'
name|'captured_args'
op|'.'
name|'items'
op|'('
op|')'
nl|'\n'
name|'if'
name|'v'
name|'is'
name|'not'
name|'None'
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'return'
name|'SuccessfulFakeConn'
op|'('
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
string|"'12345'"
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'application/burrito'"
op|','
nl|'\n'
string|"'Content-Length'"
op|':'
string|"'0'"
op|','
nl|'\n'
string|"'X-Backend-Storage-Policy-Index'"
op|':'
name|'int'
op|'('
name|'policy'
op|')'
op|','
nl|'\n'
string|"'X-Container-Partition'"
op|':'
string|"'20'"
op|','
nl|'\n'
string|"'X-Container-Host'"
op|':'
string|"'1.2.3.4:5'"
op|','
nl|'\n'
string|"'X-Container-Device'"
op|':'
string|"'sdb1'"
op|','
nl|'\n'
string|"'X-Delete-At'"
op|':'
number|'9999999999'
op|','
nl|'\n'
string|"'X-Delete-At-Container'"
op|':'
string|"'9999999960'"
op|','
nl|'\n'
string|"'X-Delete-At-Host'"
op|':'
string|'"10.1.1.1:6001,10.2.2.2:6002"'
op|','
nl|'\n'
string|"'X-Delete-At-Partition'"
op|':'
string|"'6237'"
op|','
nl|'\n'
string|"'X-Delete-At-Device'"
op|':'
string|"'sdp,sdq'"
op|'}'
op|')'
newline|'\n'
nl|'\n'
name|'with'
name|'fake_spawn'
op|'('
op|')'
op|','
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
nl|'\n'
name|'object_server'
op|','
string|"'http_connect'"
op|','
name|'fake_http_connect'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'201'
op|')'
newline|'\n'
nl|'\n'
name|'http_connect_args'
op|'.'
name|'sort'
op|'('
name|'key'
op|'='
name|'operator'
op|'.'
name|'itemgetter'
op|'('
string|"'ipaddr'"
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'len'
op|'('
name|'http_connect_args'
op|')'
op|','
number|'3'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
nl|'\n'
name|'http_connect_args'
op|'['
number|'0'
op|']'
op|','
nl|'\n'
op|'{'
string|"'ipaddr'"
op|':'
string|"'1.2.3.4'"
op|','
nl|'\n'
string|"'port'"
op|':'
string|"'5'"
op|','
nl|'\n'
string|"'path'"
op|':'
string|"'/a/c/o'"
op|','
nl|'\n'
string|"'device'"
op|':'
string|"'sdb1'"
op|','
nl|'\n'
string|"'partition'"
op|':'
string|"'20'"
op|','
nl|'\n'
string|"'method'"
op|':'
string|"'PUT'"
op|','
nl|'\n'
string|"'ssl'"
op|':'
name|'False'
op|','
nl|'\n'
string|"'headers'"
op|':'
name|'HeaderKeyDict'
op|'('
op|'{'
nl|'\n'
string|"'x-content-type'"
op|':'
string|"'application/burrito'"
op|','
nl|'\n'
string|"'x-etag'"
op|':'
string|"'d41d8cd98f00b204e9800998ecf8427e'"
op|','
nl|'\n'
string|"'x-size'"
op|':'
string|"'0'"
op|','
nl|'\n'
string|"'x-timestamp'"
op|':'
name|'utils'
op|'.'
name|'Timestamp'
op|'('
string|"'12345'"
op|')'
op|'.'
name|'internal'
op|','
nl|'\n'
string|"'referer'"
op|':'
string|"'PUT http://localhost/sda1/p/a/c/o'"
op|','
nl|'\n'
string|"'user-agent'"
op|':'
string|"'object-server %d'"
op|'%'
name|'os'
op|'.'
name|'getpid'
op|'('
op|')'
op|','
nl|'\n'
string|"'X-Backend-Storage-Policy-Index'"
op|':'
name|'int'
op|'('
name|'policy'
op|')'
op|','
nl|'\n'
string|"'x-trans-id'"
op|':'
string|"'-'"
op|'}'
op|')'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
nl|'\n'
name|'http_connect_args'
op|'['
number|'1'
op|']'
op|','
nl|'\n'
op|'{'
string|"'ipaddr'"
op|':'
string|"'10.1.1.1'"
op|','
nl|'\n'
string|"'port'"
op|':'
string|"'6001'"
op|','
nl|'\n'
string|"'path'"
op|':'
string|"'/exp/9999999960/9999999999-a/c/o'"
op|','
nl|'\n'
string|"'device'"
op|':'
string|"'sdp'"
op|','
nl|'\n'
string|"'partition'"
op|':'
string|"'6237'"
op|','
nl|'\n'
string|"'method'"
op|':'
string|"'PUT'"
op|','
nl|'\n'
string|"'ssl'"
op|':'
name|'False'
op|','
nl|'\n'
string|"'headers'"
op|':'
name|'HeaderKeyDict'
op|'('
op|'{'
nl|'\n'
string|"'x-content-type'"
op|':'
string|"'text/plain'"
op|','
nl|'\n'
string|"'x-etag'"
op|':'
string|"'d41d8cd98f00b204e9800998ecf8427e'"
op|','
nl|'\n'
string|"'x-size'"
op|':'
string|"'0'"
op|','
nl|'\n'
string|"'x-timestamp'"
op|':'
name|'utils'
op|'.'
name|'Timestamp'
op|'('
string|"'12345'"
op|')'
op|'.'
name|'internal'
op|','
nl|'\n'
string|"'referer'"
op|':'
string|"'PUT http://localhost/sda1/p/a/c/o'"
op|','
nl|'\n'
string|"'user-agent'"
op|':'
string|"'object-server %d'"
op|'%'
name|'os'
op|'.'
name|'getpid'
op|'('
op|')'
op|','
nl|'\n'
comment|'# system account storage policy is 0'
nl|'\n'
string|"'X-Backend-Storage-Policy-Index'"
op|':'
number|'0'
op|','
nl|'\n'
string|"'x-trans-id'"
op|':'
string|"'-'"
op|'}'
op|')'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
nl|'\n'
name|'http_connect_args'
op|'['
number|'2'
op|']'
op|','
nl|'\n'
op|'{'
string|"'ipaddr'"
op|':'
string|"'10.2.2.2'"
op|','
nl|'\n'
string|"'port'"
op|':'
string|"'6002'"
op|','
nl|'\n'
string|"'path'"
op|':'
string|"'/exp/9999999960/9999999999-a/c/o'"
op|','
nl|'\n'
string|"'device'"
op|':'
string|"'sdq'"
op|','
nl|'\n'
string|"'partition'"
op|':'
string|"'6237'"
op|','
nl|'\n'
string|"'method'"
op|':'
string|"'PUT'"
op|','
nl|'\n'
string|"'ssl'"
op|':'
name|'False'
op|','
nl|'\n'
string|"'headers'"
op|':'
name|'HeaderKeyDict'
op|'('
op|'{'
nl|'\n'
string|"'x-content-type'"
op|':'
string|"'text/plain'"
op|','
nl|'\n'
string|"'x-etag'"
op|':'
string|"'d41d8cd98f00b204e9800998ecf8427e'"
op|','
nl|'\n'
string|"'x-size'"
op|':'
string|"'0'"
op|','
nl|'\n'
string|"'x-timestamp'"
op|':'
name|'utils'
op|'.'
name|'Timestamp'
op|'('
string|"'12345'"
op|')'
op|'.'
name|'internal'
op|','
nl|'\n'
string|"'referer'"
op|':'
string|"'PUT http://localhost/sda1/p/a/c/o'"
op|','
nl|'\n'
string|"'user-agent'"
op|':'
string|"'object-server %d'"
op|'%'
name|'os'
op|'.'
name|'getpid'
op|'('
op|')'
op|','
nl|'\n'
comment|'# system account storage policy is 0'
nl|'\n'
string|"'X-Backend-Storage-Policy-Index'"
op|':'
number|'0'
op|','
nl|'\n'
string|"'x-trans-id'"
op|':'
string|"'-'"
op|'}'
op|')'
op|'}'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'patch_policies'
op|'('
op|'['
name|'StoragePolicy'
op|'('
number|'0'
op|','
string|"'zero'"
op|','
name|'True'
op|')'
op|','
nl|'\n'
name|'StoragePolicy'
op|'('
number|'1'
op|','
string|"'one'"
op|')'
op|','
nl|'\n'
name|'StoragePolicy'
op|'('
number|'26'
op|','
string|"'twice-thirteen'"
op|')'
op|']'
op|')'
newline|'\n'
DECL|member|test_updating_multiple_container_servers
name|'def'
name|'test_updating_multiple_container_servers'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# update router post patch'
nl|'\n'
indent|'        '
name|'self'
op|'.'
name|'object_controller'
op|'.'
name|'_diskfile_router'
op|'='
name|'diskfile'
op|'.'
name|'DiskFileRouter'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'conf'
op|','
name|'self'
op|'.'
name|'object_controller'
op|'.'
name|'logger'
op|')'
newline|'\n'
name|'http_connect_args'
op|'='
op|'['
op|']'
newline|'\n'
nl|'\n'
DECL|function|fake_http_connect
name|'def'
name|'fake_http_connect'
op|'('
name|'ipaddr'
op|','
name|'port'
op|','
name|'device'
op|','
name|'partition'
op|','
name|'method'
op|','
name|'path'
op|','
nl|'\n'
name|'headers'
op|'='
name|'None'
op|','
name|'query_string'
op|'='
name|'None'
op|','
name|'ssl'
op|'='
name|'False'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|class|SuccessfulFakeConn
indent|'            '
name|'class'
name|'SuccessfulFakeConn'
op|'('
name|'object'
op|')'
op|':'
newline|'\n'
nl|'\n'
indent|'                '
op|'@'
name|'property'
newline|'\n'
DECL|member|status
name|'def'
name|'status'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'                    '
name|'return'
number|'200'
newline|'\n'
nl|'\n'
DECL|member|getresponse
dedent|''
name|'def'
name|'getresponse'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'                    '
name|'return'
name|'self'
newline|'\n'
nl|'\n'
DECL|member|read
dedent|''
name|'def'
name|'read'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'                    '
name|'return'
string|"''"
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'captured_args'
op|'='
op|'{'
string|"'ipaddr'"
op|':'
name|'ipaddr'
op|','
string|"'port'"
op|':'
name|'port'
op|','
nl|'\n'
string|"'device'"
op|':'
name|'device'
op|','
string|"'partition'"
op|':'
name|'partition'
op|','
nl|'\n'
string|"'method'"
op|':'
name|'method'
op|','
string|"'path'"
op|':'
name|'path'
op|','
string|"'ssl'"
op|':'
name|'ssl'
op|','
nl|'\n'
string|"'headers'"
op|':'
name|'headers'
op|','
string|"'query_string'"
op|':'
name|'query_string'
op|'}'
newline|'\n'
nl|'\n'
name|'http_connect_args'
op|'.'
name|'append'
op|'('
nl|'\n'
name|'dict'
op|'('
op|'('
name|'k'
op|','
name|'v'
op|')'
name|'for'
name|'k'
op|','
name|'v'
name|'in'
name|'captured_args'
op|'.'
name|'items'
op|'('
op|')'
nl|'\n'
name|'if'
name|'v'
name|'is'
name|'not'
name|'None'
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'return'
name|'SuccessfulFakeConn'
op|'('
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
string|"'12345'"
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'application/burrito'"
op|','
nl|'\n'
string|"'Content-Length'"
op|':'
string|"'0'"
op|','
nl|'\n'
string|"'X-Backend-Storage-Policy-Index'"
op|':'
string|"'26'"
op|','
nl|'\n'
string|"'X-Container-Partition'"
op|':'
string|"'20'"
op|','
nl|'\n'
string|"'X-Container-Host'"
op|':'
string|"'1.2.3.4:5, 6.7.8.9:10'"
op|','
nl|'\n'
string|"'X-Container-Device'"
op|':'
string|"'sdb1, sdf1'"
op|'}'
op|')'
newline|'\n'
nl|'\n'
name|'with'
name|'fake_spawn'
op|'('
op|')'
op|','
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
nl|'\n'
name|'object_server'
op|','
string|"'http_connect'"
op|','
name|'fake_http_connect'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'http_connect_args'
op|'.'
name|'sort'
op|'('
name|'key'
op|'='
name|'operator'
op|'.'
name|'itemgetter'
op|'('
string|"'ipaddr'"
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'len'
op|'('
name|'http_connect_args'
op|')'
op|','
number|'2'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
nl|'\n'
name|'http_connect_args'
op|'['
number|'0'
op|']'
op|','
nl|'\n'
op|'{'
string|"'ipaddr'"
op|':'
string|"'1.2.3.4'"
op|','
nl|'\n'
string|"'port'"
op|':'
string|"'5'"
op|','
nl|'\n'
string|"'path'"
op|':'
string|"'/a/c/o'"
op|','
nl|'\n'
string|"'device'"
op|':'
string|"'sdb1'"
op|','
nl|'\n'
string|"'partition'"
op|':'
string|"'20'"
op|','
nl|'\n'
string|"'method'"
op|':'
string|"'PUT'"
op|','
nl|'\n'
string|"'ssl'"
op|':'
name|'False'
op|','
nl|'\n'
string|"'headers'"
op|':'
name|'HeaderKeyDict'
op|'('
op|'{'
nl|'\n'
string|"'x-content-type'"
op|':'
string|"'application/burrito'"
op|','
nl|'\n'
string|"'x-etag'"
op|':'
string|"'d41d8cd98f00b204e9800998ecf8427e'"
op|','
nl|'\n'
string|"'x-size'"
op|':'
string|"'0'"
op|','
nl|'\n'
string|"'x-timestamp'"
op|':'
name|'utils'
op|'.'
name|'Timestamp'
op|'('
string|"'12345'"
op|')'
op|'.'
name|'internal'
op|','
nl|'\n'
string|"'X-Backend-Storage-Policy-Index'"
op|':'
string|"'26'"
op|','
nl|'\n'
string|"'referer'"
op|':'
string|"'PUT http://localhost/sda1/p/a/c/o'"
op|','
nl|'\n'
string|"'user-agent'"
op|':'
string|"'object-server %d'"
op|'%'
name|'os'
op|'.'
name|'getpid'
op|'('
op|')'
op|','
nl|'\n'
string|"'x-trans-id'"
op|':'
string|"'-'"
op|'}'
op|')'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
nl|'\n'
name|'http_connect_args'
op|'['
number|'1'
op|']'
op|','
nl|'\n'
op|'{'
string|"'ipaddr'"
op|':'
string|"'6.7.8.9'"
op|','
nl|'\n'
string|"'port'"
op|':'
string|"'10'"
op|','
nl|'\n'
string|"'path'"
op|':'
string|"'/a/c/o'"
op|','
nl|'\n'
string|"'device'"
op|':'
string|"'sdf1'"
op|','
nl|'\n'
string|"'partition'"
op|':'
string|"'20'"
op|','
nl|'\n'
string|"'method'"
op|':'
string|"'PUT'"
op|','
nl|'\n'
string|"'ssl'"
op|':'
name|'False'
op|','
nl|'\n'
string|"'headers'"
op|':'
name|'HeaderKeyDict'
op|'('
op|'{'
nl|'\n'
string|"'x-content-type'"
op|':'
string|"'application/burrito'"
op|','
nl|'\n'
string|"'x-etag'"
op|':'
string|"'d41d8cd98f00b204e9800998ecf8427e'"
op|','
nl|'\n'
string|"'x-size'"
op|':'
string|"'0'"
op|','
nl|'\n'
string|"'x-timestamp'"
op|':'
name|'utils'
op|'.'
name|'Timestamp'
op|'('
string|"'12345'"
op|')'
op|'.'
name|'internal'
op|','
nl|'\n'
string|"'X-Backend-Storage-Policy-Index'"
op|':'
string|"'26'"
op|','
nl|'\n'
string|"'referer'"
op|':'
string|"'PUT http://localhost/sda1/p/a/c/o'"
op|','
nl|'\n'
string|"'user-agent'"
op|':'
string|"'object-server %d'"
op|'%'
name|'os'
op|'.'
name|'getpid'
op|'('
op|')'
op|','
nl|'\n'
string|"'x-trans-id'"
op|':'
string|"'-'"
op|'}'
op|')'
op|'}'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_object_delete_at_async_update
dedent|''
name|'def'
name|'test_object_delete_at_async_update'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'policy'
op|'='
name|'random'
op|'.'
name|'choice'
op|'('
name|'list'
op|'('
name|'POLICIES'
op|')'
op|')'
newline|'\n'
name|'ts'
op|'='
op|'('
name|'utils'
op|'.'
name|'Timestamp'
op|'('
name|'t'
op|')'
name|'for'
name|'t'
name|'in'
nl|'\n'
name|'itertools'
op|'.'
name|'count'
op|'('
name|'int'
op|'('
name|'time'
op|'('
op|')'
op|')'
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'container_updates'
op|'='
op|'['
op|']'
newline|'\n'
nl|'\n'
DECL|function|capture_updates
name|'def'
name|'capture_updates'
op|'('
name|'ip'
op|','
name|'port'
op|','
name|'method'
op|','
name|'path'
op|','
name|'headers'
op|','
op|'*'
name|'args'
op|','
op|'**'
name|'kwargs'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'container_updates'
op|'.'
name|'append'
op|'('
op|'('
name|'ip'
op|','
name|'port'
op|','
name|'method'
op|','
name|'path'
op|','
name|'headers'
op|')'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'put_timestamp'
op|'='
name|'next'
op|'('
name|'ts'
op|')'
op|'.'
name|'internal'
newline|'\n'
name|'delete_at_timestamp'
op|'='
name|'utils'
op|'.'
name|'normalize_delete_at_timestamp'
op|'('
nl|'\n'
name|'next'
op|'('
name|'ts'
op|')'
op|'.'
name|'normal'
op|')'
newline|'\n'
name|'delete_at_container'
op|'='
op|'('
nl|'\n'
name|'int'
op|'('
name|'delete_at_timestamp'
op|')'
op|'/'
nl|'\n'
name|'self'
op|'.'
name|'object_controller'
op|'.'
name|'expiring_objects_container_divisor'
op|'*'
nl|'\n'
name|'self'
op|'.'
name|'object_controller'
op|'.'
name|'expiring_objects_container_divisor'
op|')'
newline|'\n'
name|'headers'
op|'='
op|'{'
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'text/plain'"
op|','
nl|'\n'
string|"'X-Timestamp'"
op|':'
name|'put_timestamp'
op|','
nl|'\n'
string|"'X-Container-Host'"
op|':'
string|"'10.0.0.1:6001'"
op|','
nl|'\n'
string|"'X-Container-Device'"
op|':'
string|"'sda1'"
op|','
nl|'\n'
string|"'X-Container-Partition'"
op|':'
string|"'p'"
op|','
nl|'\n'
string|"'X-Delete-At'"
op|':'
name|'delete_at_timestamp'
op|','
nl|'\n'
string|"'X-Delete-At-Container'"
op|':'
name|'delete_at_container'
op|','
nl|'\n'
string|"'X-Delete-At-Partition'"
op|':'
string|"'p'"
op|','
nl|'\n'
string|"'X-Delete-At-Host'"
op|':'
string|"'10.0.0.2:6002'"
op|','
nl|'\n'
string|"'X-Delete-At-Device'"
op|':'
string|"'sda1'"
op|','
nl|'\n'
string|"'X-Backend-Storage-Policy-Index'"
op|':'
name|'int'
op|'('
name|'policy'
op|')'
op|'}'
newline|'\n'
name|'if'
name|'policy'
op|'.'
name|'policy_type'
op|'=='
name|'EC_POLICY'
op|':'
newline|'\n'
indent|'            '
name|'headers'
op|'['
string|"'X-Object-Sysmeta-Ec-Frag-Index'"
op|']'
op|'='
string|"'2'"
newline|'\n'
dedent|''
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
name|'method'
op|'='
string|"'PUT'"
op|','
name|'body'
op|'='
string|"''"
op|','
name|'headers'
op|'='
name|'headers'
op|')'
newline|'\n'
name|'with'
name|'fake_spawn'
op|'('
op|')'
op|','
name|'mocked_http_conn'
op|'('
nl|'\n'
number|'500'
op|','
number|'500'
op|','
name|'give_connect'
op|'='
name|'capture_updates'
op|')'
name|'as'
name|'fake_conn'
op|':'
newline|'\n'
indent|'            '
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'StopIteration'
op|','
name|'fake_conn'
op|'.'
name|'code_iter'
op|'.'
name|'next'
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'201'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'2'
op|','
name|'len'
op|'('
name|'container_updates'
op|')'
op|')'
newline|'\n'
name|'delete_at_update'
op|','
name|'container_update'
op|'='
name|'container_updates'
newline|'\n'
comment|'# delete_at_update'
nl|'\n'
name|'ip'
op|','
name|'port'
op|','
name|'method'
op|','
name|'path'
op|','
name|'headers'
op|'='
name|'delete_at_update'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'ip'
op|','
string|"'10.0.0.2'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'port'
op|','
string|"'6002'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'method'
op|','
string|"'PUT'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'path'
op|','
string|"'/sda1/p/.expiring_objects/%s/%s-a/c/o'"
op|'%'
nl|'\n'
op|'('
name|'delete_at_container'
op|','
name|'delete_at_timestamp'
op|')'
op|')'
newline|'\n'
name|'expected'
op|'='
op|'{'
nl|'\n'
string|"'X-Timestamp'"
op|':'
name|'put_timestamp'
op|','
nl|'\n'
comment|'# system account storage policy is 0'
nl|'\n'
string|"'X-Backend-Storage-Policy-Index'"
op|':'
number|'0'
op|','
nl|'\n'
op|'}'
newline|'\n'
name|'for'
name|'key'
op|','
name|'value'
name|'in'
name|'expected'
op|'.'
name|'items'
op|'('
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'headers'
op|'['
name|'key'
op|']'
op|','
name|'str'
op|'('
name|'value'
op|')'
op|')'
newline|'\n'
comment|'# container_update'
nl|'\n'
dedent|''
name|'ip'
op|','
name|'port'
op|','
name|'method'
op|','
name|'path'
op|','
name|'headers'
op|'='
name|'container_update'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'ip'
op|','
string|"'10.0.0.1'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'port'
op|','
string|"'6001'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'method'
op|','
string|"'PUT'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'path'
op|','
string|"'/sda1/p/a/c/o'"
op|')'
newline|'\n'
name|'expected'
op|'='
op|'{'
nl|'\n'
string|"'X-Timestamp'"
op|':'
name|'put_timestamp'
op|','
nl|'\n'
string|"'X-Backend-Storage-Policy-Index'"
op|':'
name|'int'
op|'('
name|'policy'
op|')'
op|','
nl|'\n'
op|'}'
newline|'\n'
name|'for'
name|'key'
op|','
name|'value'
name|'in'
name|'expected'
op|'.'
name|'items'
op|'('
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'headers'
op|'['
name|'key'
op|']'
op|','
name|'str'
op|'('
name|'value'
op|')'
op|')'
newline|'\n'
comment|'# check async pendings'
nl|'\n'
dedent|''
name|'async_dir'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'self'
op|'.'
name|'testdir'
op|','
string|"'sda1'"
op|','
nl|'\n'
name|'diskfile'
op|'.'
name|'get_async_dir'
op|'('
name|'policy'
op|')'
op|')'
newline|'\n'
name|'found_files'
op|'='
op|'['
op|']'
newline|'\n'
name|'for'
name|'root'
op|','
name|'dirs'
op|','
name|'files'
name|'in'
name|'os'
op|'.'
name|'walk'
op|'('
name|'async_dir'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'for'
name|'f'
name|'in'
name|'files'
op|':'
newline|'\n'
indent|'                '
name|'async_file'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'root'
op|','
name|'f'
op|')'
newline|'\n'
name|'found_files'
op|'.'
name|'append'
op|'('
name|'async_file'
op|')'
newline|'\n'
name|'data'
op|'='
name|'pickle'
op|'.'
name|'load'
op|'('
name|'open'
op|'('
name|'async_file'
op|')'
op|')'
newline|'\n'
name|'if'
name|'data'
op|'['
string|"'account'"
op|']'
op|'=='
string|"'a'"
op|':'
newline|'\n'
indent|'                    '
name|'self'
op|'.'
name|'assertEqual'
op|'('
nl|'\n'
name|'int'
op|'('
name|'data'
op|'['
string|"'headers'"
op|']'
nl|'\n'
op|'['
string|"'X-Backend-Storage-Policy-Index'"
op|']'
op|')'
op|','
name|'int'
op|'('
name|'policy'
op|')'
op|')'
newline|'\n'
dedent|''
name|'elif'
name|'data'
op|'['
string|"'account'"
op|']'
op|'=='
string|"'.expiring_objects'"
op|':'
newline|'\n'
indent|'                    '
name|'self'
op|'.'
name|'assertEqual'
op|'('
nl|'\n'
name|'int'
op|'('
name|'data'
op|'['
string|"'headers'"
op|']'
nl|'\n'
op|'['
string|"'X-Backend-Storage-Policy-Index'"
op|']'
op|')'
op|','
number|'0'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                    '
name|'self'
op|'.'
name|'fail'
op|'('
string|"'unexpected async pending data'"
op|')'
newline|'\n'
dedent|''
dedent|''
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'2'
op|','
name|'len'
op|'('
name|'found_files'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_async_update_saves_on_exception
dedent|''
name|'def'
name|'test_async_update_saves_on_exception'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'policy'
op|'='
name|'random'
op|'.'
name|'choice'
op|'('
name|'list'
op|'('
name|'POLICIES'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_stage_tmp_dir'
op|'('
name|'policy'
op|')'
newline|'\n'
name|'_prefix'
op|'='
name|'utils'
op|'.'
name|'HASH_PATH_PREFIX'
newline|'\n'
name|'utils'
op|'.'
name|'HASH_PATH_PREFIX'
op|'='
string|"''"
newline|'\n'
nl|'\n'
DECL|function|fake_http_connect
name|'def'
name|'fake_http_connect'
op|'('
op|'*'
name|'args'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'Exception'
op|'('
string|"'test'"
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'orig_http_connect'
op|'='
name|'object_server'
op|'.'
name|'http_connect'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'object_server'
op|'.'
name|'http_connect'
op|'='
name|'fake_http_connect'
newline|'\n'
name|'self'
op|'.'
name|'object_controller'
op|'.'
name|'async_update'
op|'('
nl|'\n'
string|"'PUT'"
op|','
string|"'a'"
op|','
string|"'c'"
op|','
string|"'o'"
op|','
string|"'127.0.0.1:1234'"
op|','
number|'1'
op|','
string|"'sdc1'"
op|','
nl|'\n'
op|'{'
string|"'x-timestamp'"
op|':'
string|"'1'"
op|','
string|"'x-out'"
op|':'
string|"'set'"
op|','
nl|'\n'
string|"'X-Backend-Storage-Policy-Index'"
op|':'
name|'int'
op|'('
name|'policy'
op|')'
op|'}'
op|','
string|"'sda1'"
op|','
nl|'\n'
name|'policy'
op|')'
newline|'\n'
dedent|''
name|'finally'
op|':'
newline|'\n'
indent|'            '
name|'object_server'
op|'.'
name|'http_connect'
op|'='
name|'orig_http_connect'
newline|'\n'
name|'utils'
op|'.'
name|'HASH_PATH_PREFIX'
op|'='
name|'_prefix'
newline|'\n'
dedent|''
name|'async_dir'
op|'='
name|'diskfile'
op|'.'
name|'get_async_dir'
op|'('
name|'policy'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
nl|'\n'
name|'pickle'
op|'.'
name|'load'
op|'('
name|'open'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'testdir'
op|','
string|"'sda1'"
op|','
name|'async_dir'
op|','
string|"'a83'"
op|','
nl|'\n'
string|"'06fbf0b514e5199dfc4e00f42eb5ea83-%s'"
op|'%'
nl|'\n'
name|'utils'
op|'.'
name|'Timestamp'
op|'('
number|'1'
op|')'
op|'.'
name|'internal'
op|')'
op|')'
op|')'
op|','
nl|'\n'
op|'{'
string|"'headers'"
op|':'
op|'{'
string|"'x-timestamp'"
op|':'
string|"'1'"
op|','
string|"'x-out'"
op|':'
string|"'set'"
op|','
nl|'\n'
string|"'user-agent'"
op|':'
string|"'object-server %s'"
op|'%'
name|'os'
op|'.'
name|'getpid'
op|'('
op|')'
op|','
nl|'\n'
string|"'X-Backend-Storage-Policy-Index'"
op|':'
name|'int'
op|'('
name|'policy'
op|')'
op|'}'
op|','
nl|'\n'
string|"'account'"
op|':'
string|"'a'"
op|','
string|"'container'"
op|':'
string|"'c'"
op|','
string|"'obj'"
op|':'
string|"'o'"
op|','
string|"'op'"
op|':'
string|"'PUT'"
op|'}'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_async_update_saves_on_non_2xx
dedent|''
name|'def'
name|'test_async_update_saves_on_non_2xx'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'policy'
op|'='
name|'random'
op|'.'
name|'choice'
op|'('
name|'list'
op|'('
name|'POLICIES'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_stage_tmp_dir'
op|'('
name|'policy'
op|')'
newline|'\n'
name|'_prefix'
op|'='
name|'utils'
op|'.'
name|'HASH_PATH_PREFIX'
newline|'\n'
name|'utils'
op|'.'
name|'HASH_PATH_PREFIX'
op|'='
string|"''"
newline|'\n'
nl|'\n'
DECL|function|fake_http_connect
name|'def'
name|'fake_http_connect'
op|'('
name|'status'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|class|FakeConn
indent|'            '
name|'class'
name|'FakeConn'
op|'('
name|'object'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|member|__init__
indent|'                '
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'status'
op|')'
op|':'
newline|'\n'
indent|'                    '
name|'self'
op|'.'
name|'status'
op|'='
name|'status'
newline|'\n'
nl|'\n'
DECL|member|getresponse
dedent|''
name|'def'
name|'getresponse'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'                    '
name|'return'
name|'self'
newline|'\n'
nl|'\n'
DECL|member|read
dedent|''
name|'def'
name|'read'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'                    '
name|'return'
string|"''"
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'return'
name|'lambda'
op|'*'
name|'args'
op|':'
name|'FakeConn'
op|'('
name|'status'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'orig_http_connect'
op|'='
name|'object_server'
op|'.'
name|'http_connect'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'for'
name|'status'
name|'in'
op|'('
number|'199'
op|','
number|'300'
op|','
number|'503'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'object_server'
op|'.'
name|'http_connect'
op|'='
name|'fake_http_connect'
op|'('
name|'status'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'object_controller'
op|'.'
name|'async_update'
op|'('
nl|'\n'
string|"'PUT'"
op|','
string|"'a'"
op|','
string|"'c'"
op|','
string|"'o'"
op|','
string|"'127.0.0.1:1234'"
op|','
number|'1'
op|','
string|"'sdc1'"
op|','
nl|'\n'
op|'{'
string|"'x-timestamp'"
op|':'
string|"'1'"
op|','
string|"'x-out'"
op|':'
name|'str'
op|'('
name|'status'
op|')'
op|','
nl|'\n'
string|"'X-Backend-Storage-Policy-Index'"
op|':'
name|'int'
op|'('
name|'policy'
op|')'
op|'}'
op|','
string|"'sda1'"
op|','
nl|'\n'
name|'policy'
op|')'
newline|'\n'
DECL|variable|async_dir
name|'async_dir'
op|'='
name|'diskfile'
op|'.'
name|'get_async_dir'
op|'('
name|'policy'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
nl|'\n'
name|'pickle'
op|'.'
name|'load'
op|'('
name|'open'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'testdir'
op|','
string|"'sda1'"
op|','
name|'async_dir'
op|','
string|"'a83'"
op|','
nl|'\n'
string|"'06fbf0b514e5199dfc4e00f42eb5ea83-%s'"
op|'%'
nl|'\n'
name|'utils'
op|'.'
name|'Timestamp'
op|'('
number|'1'
op|')'
op|'.'
name|'internal'
op|')'
op|')'
op|')'
op|','
nl|'\n'
op|'{'
string|"'headers'"
op|':'
op|'{'
string|"'x-timestamp'"
op|':'
string|"'1'"
op|','
string|"'x-out'"
op|':'
name|'str'
op|'('
name|'status'
op|')'
op|','
nl|'\n'
string|"'user-agent'"
op|':'
nl|'\n'
string|"'object-server %s'"
op|'%'
name|'os'
op|'.'
name|'getpid'
op|'('
op|')'
op|','
nl|'\n'
string|"'X-Backend-Storage-Policy-Index'"
op|':'
nl|'\n'
name|'int'
op|'('
name|'policy'
op|')'
op|'}'
op|','
nl|'\n'
string|"'account'"
op|':'
string|"'a'"
op|','
string|"'container'"
op|':'
string|"'c'"
op|','
string|"'obj'"
op|':'
string|"'o'"
op|','
nl|'\n'
string|"'op'"
op|':'
string|"'PUT'"
op|'}'
op|')'
newline|'\n'
dedent|''
dedent|''
name|'finally'
op|':'
newline|'\n'
indent|'            '
name|'object_server'
op|'.'
name|'http_connect'
op|'='
name|'orig_http_connect'
newline|'\n'
name|'utils'
op|'.'
name|'HASH_PATH_PREFIX'
op|'='
name|'_prefix'
newline|'\n'
nl|'\n'
DECL|member|test_async_update_does_not_save_on_2xx
dedent|''
dedent|''
name|'def'
name|'test_async_update_does_not_save_on_2xx'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'_prefix'
op|'='
name|'utils'
op|'.'
name|'HASH_PATH_PREFIX'
newline|'\n'
name|'utils'
op|'.'
name|'HASH_PATH_PREFIX'
op|'='
string|"''"
newline|'\n'
nl|'\n'
DECL|function|fake_http_connect
name|'def'
name|'fake_http_connect'
op|'('
name|'status'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|class|FakeConn
indent|'            '
name|'class'
name|'FakeConn'
op|'('
name|'object'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|member|__init__
indent|'                '
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'status'
op|')'
op|':'
newline|'\n'
indent|'                    '
name|'self'
op|'.'
name|'status'
op|'='
name|'status'
newline|'\n'
nl|'\n'
DECL|member|getresponse
dedent|''
name|'def'
name|'getresponse'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'                    '
name|'return'
name|'self'
newline|'\n'
nl|'\n'
DECL|member|read
dedent|''
name|'def'
name|'read'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'                    '
name|'return'
string|"''"
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'return'
name|'lambda'
op|'*'
name|'args'
op|':'
name|'FakeConn'
op|'('
name|'status'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'orig_http_connect'
op|'='
name|'object_server'
op|'.'
name|'http_connect'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'for'
name|'status'
name|'in'
op|'('
number|'200'
op|','
number|'299'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'object_server'
op|'.'
name|'http_connect'
op|'='
name|'fake_http_connect'
op|'('
name|'status'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'object_controller'
op|'.'
name|'async_update'
op|'('
nl|'\n'
string|"'PUT'"
op|','
string|"'a'"
op|','
string|"'c'"
op|','
string|"'o'"
op|','
string|"'127.0.0.1:1234'"
op|','
number|'1'
op|','
string|"'sdc1'"
op|','
nl|'\n'
op|'{'
string|"'x-timestamp'"
op|':'
string|"'1'"
op|','
string|"'x-out'"
op|':'
name|'str'
op|'('
name|'status'
op|')'
op|'}'
op|','
string|"'sda1'"
op|','
number|'0'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
nl|'\n'
name|'os'
op|'.'
name|'path'
op|'.'
name|'exists'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'testdir'
op|','
string|"'sda1'"
op|','
string|"'async_pending'"
op|','
string|"'a83'"
op|','
nl|'\n'
string|"'06fbf0b514e5199dfc4e00f42eb5ea83-0000000001.00000'"
op|')'
op|')'
op|')'
newline|'\n'
dedent|''
dedent|''
name|'finally'
op|':'
newline|'\n'
indent|'            '
name|'object_server'
op|'.'
name|'http_connect'
op|'='
name|'orig_http_connect'
newline|'\n'
name|'utils'
op|'.'
name|'HASH_PATH_PREFIX'
op|'='
name|'_prefix'
newline|'\n'
nl|'\n'
DECL|member|test_async_update_saves_on_timeout
dedent|''
dedent|''
name|'def'
name|'test_async_update_saves_on_timeout'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'policy'
op|'='
name|'random'
op|'.'
name|'choice'
op|'('
name|'list'
op|'('
name|'POLICIES'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_stage_tmp_dir'
op|'('
name|'policy'
op|')'
newline|'\n'
name|'_prefix'
op|'='
name|'utils'
op|'.'
name|'HASH_PATH_PREFIX'
newline|'\n'
name|'utils'
op|'.'
name|'HASH_PATH_PREFIX'
op|'='
string|"''"
newline|'\n'
nl|'\n'
DECL|function|fake_http_connect
name|'def'
name|'fake_http_connect'
op|'('
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|class|FakeConn
indent|'            '
name|'class'
name|'FakeConn'
op|'('
name|'object'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|member|getresponse
indent|'                '
name|'def'
name|'getresponse'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'                    '
name|'return'
name|'sleep'
op|'('
number|'1'
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'return'
name|'lambda'
op|'*'
name|'args'
op|':'
name|'FakeConn'
op|'('
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'orig_http_connect'
op|'='
name|'object_server'
op|'.'
name|'http_connect'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'for'
name|'status'
name|'in'
op|'('
number|'200'
op|','
number|'299'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'object_server'
op|'.'
name|'http_connect'
op|'='
name|'fake_http_connect'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'object_controller'
op|'.'
name|'node_timeout'
op|'='
number|'0.001'
newline|'\n'
name|'self'
op|'.'
name|'object_controller'
op|'.'
name|'async_update'
op|'('
nl|'\n'
string|"'PUT'"
op|','
string|"'a'"
op|','
string|"'c'"
op|','
string|"'o'"
op|','
string|"'127.0.0.1:1234'"
op|','
number|'1'
op|','
string|"'sdc1'"
op|','
nl|'\n'
op|'{'
string|"'x-timestamp'"
op|':'
string|"'1'"
op|','
string|"'x-out'"
op|':'
name|'str'
op|'('
name|'status'
op|')'
op|'}'
op|','
string|"'sda1'"
op|','
nl|'\n'
name|'policy'
op|')'
newline|'\n'
DECL|variable|async_dir
name|'async_dir'
op|'='
name|'diskfile'
op|'.'
name|'get_async_dir'
op|'('
name|'policy'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
nl|'\n'
name|'os'
op|'.'
name|'path'
op|'.'
name|'exists'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'testdir'
op|','
string|"'sda1'"
op|','
name|'async_dir'
op|','
string|"'a83'"
op|','
nl|'\n'
string|"'06fbf0b514e5199dfc4e00f42eb5ea83-%s'"
op|'%'
nl|'\n'
name|'utils'
op|'.'
name|'Timestamp'
op|'('
number|'1'
op|')'
op|'.'
name|'internal'
op|')'
op|')'
op|')'
newline|'\n'
dedent|''
dedent|''
name|'finally'
op|':'
newline|'\n'
indent|'            '
name|'object_server'
op|'.'
name|'http_connect'
op|'='
name|'orig_http_connect'
newline|'\n'
name|'utils'
op|'.'
name|'HASH_PATH_PREFIX'
op|'='
name|'_prefix'
newline|'\n'
nl|'\n'
DECL|member|test_container_update_no_async_update
dedent|''
dedent|''
name|'def'
name|'test_container_update_no_async_update'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'policy'
op|'='
name|'random'
op|'.'
name|'choice'
op|'('
name|'list'
op|'('
name|'POLICIES'
op|')'
op|')'
newline|'\n'
name|'given_args'
op|'='
op|'['
op|']'
newline|'\n'
nl|'\n'
DECL|function|fake_async_update
name|'def'
name|'fake_async_update'
op|'('
op|'*'
name|'args'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'given_args'
op|'.'
name|'extend'
op|'('
name|'args'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'object_controller'
op|'.'
name|'async_update'
op|'='
name|'fake_async_update'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/v1/a/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
number|'1'
op|','
nl|'\n'
string|"'X-Trans-Id'"
op|':'
string|"'1234'"
op|','
nl|'\n'
string|"'X-Backend-Storage-Policy-Index'"
op|':'
name|'int'
op|'('
name|'policy'
op|')'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'object_controller'
op|'.'
name|'container_update'
op|'('
nl|'\n'
string|"'PUT'"
op|','
string|"'a'"
op|','
string|"'c'"
op|','
string|"'o'"
op|','
name|'req'
op|','
op|'{'
nl|'\n'
string|"'x-size'"
op|':'
string|"'0'"
op|','
string|"'x-etag'"
op|':'
string|"'d41d8cd98f00b204e9800998ecf8427e'"
op|','
nl|'\n'
string|"'x-content-type'"
op|':'
string|"'text/plain'"
op|','
string|"'x-timestamp'"
op|':'
string|"'1'"
op|'}'
op|','
nl|'\n'
string|"'sda1'"
op|','
name|'policy'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'given_args'
op|','
op|'['
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_container_update_success
dedent|''
name|'def'
name|'test_container_update_success'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'container_updates'
op|'='
op|'['
op|']'
newline|'\n'
nl|'\n'
DECL|function|capture_updates
name|'def'
name|'capture_updates'
op|'('
name|'ip'
op|','
name|'port'
op|','
name|'method'
op|','
name|'path'
op|','
name|'headers'
op|','
op|'*'
name|'args'
op|','
op|'**'
name|'kwargs'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'container_updates'
op|'.'
name|'append'
op|'('
op|'('
name|'ip'
op|','
name|'port'
op|','
name|'method'
op|','
name|'path'
op|','
name|'headers'
op|')'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/0/a/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
number|'1'
op|','
nl|'\n'
string|"'X-Trans-Id'"
op|':'
string|"'123'"
op|','
nl|'\n'
string|"'X-Container-Host'"
op|':'
string|"'chost:cport'"
op|','
nl|'\n'
string|"'X-Container-Partition'"
op|':'
string|"'cpartition'"
op|','
nl|'\n'
string|"'X-Container-Device'"
op|':'
string|"'cdevice'"
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'text/plain'"
op|'}'
op|','
name|'body'
op|'='
string|"''"
op|')'
newline|'\n'
name|'with'
name|'fake_spawn'
op|'('
op|')'
op|','
name|'mocked_http_conn'
op|'('
nl|'\n'
number|'200'
op|','
name|'give_connect'
op|'='
name|'capture_updates'
op|')'
name|'as'
name|'fake_conn'
op|':'
newline|'\n'
indent|'            '
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'StopIteration'
op|','
name|'fake_conn'
op|'.'
name|'code_iter'
op|'.'
name|'next'
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'201'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'len'
op|'('
name|'container_updates'
op|')'
op|','
number|'1'
op|')'
newline|'\n'
name|'ip'
op|','
name|'port'
op|','
name|'method'
op|','
name|'path'
op|','
name|'headers'
op|'='
name|'container_updates'
op|'['
number|'0'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'ip'
op|','
string|"'chost'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'port'
op|','
string|"'cport'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'method'
op|','
string|"'PUT'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'path'
op|','
string|"'/cdevice/cpartition/a/c/o'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'headers'
op|','
name|'HeaderKeyDict'
op|'('
op|'{'
nl|'\n'
string|"'user-agent'"
op|':'
string|"'object-server %s'"
op|'%'
name|'os'
op|'.'
name|'getpid'
op|'('
op|')'
op|','
nl|'\n'
string|"'x-size'"
op|':'
string|"'0'"
op|','
nl|'\n'
string|"'x-etag'"
op|':'
string|"'d41d8cd98f00b204e9800998ecf8427e'"
op|','
nl|'\n'
string|"'x-content-type'"
op|':'
string|"'text/plain'"
op|','
nl|'\n'
string|"'x-timestamp'"
op|':'
name|'utils'
op|'.'
name|'Timestamp'
op|'('
number|'1'
op|')'
op|'.'
name|'internal'
op|','
nl|'\n'
string|"'X-Backend-Storage-Policy-Index'"
op|':'
string|"'0'"
op|','
comment|'# default when not given'
nl|'\n'
string|"'x-trans-id'"
op|':'
string|"'123'"
op|','
nl|'\n'
string|"'referer'"
op|':'
string|"'PUT http://localhost/sda1/0/a/c/o'"
op|'}'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_container_update_overrides
dedent|''
name|'def'
name|'test_container_update_overrides'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'container_updates'
op|'='
op|'['
op|']'
newline|'\n'
nl|'\n'
DECL|function|capture_updates
name|'def'
name|'capture_updates'
op|'('
name|'ip'
op|','
name|'port'
op|','
name|'method'
op|','
name|'path'
op|','
name|'headers'
op|','
op|'*'
name|'args'
op|','
op|'**'
name|'kwargs'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'container_updates'
op|'.'
name|'append'
op|'('
op|'('
name|'ip'
op|','
name|'port'
op|','
name|'method'
op|','
name|'path'
op|','
name|'headers'
op|')'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'headers'
op|'='
op|'{'
nl|'\n'
string|"'X-Timestamp'"
op|':'
number|'1'
op|','
nl|'\n'
string|"'X-Trans-Id'"
op|':'
string|"'123'"
op|','
nl|'\n'
string|"'X-Container-Host'"
op|':'
string|"'chost:cport'"
op|','
nl|'\n'
string|"'X-Container-Partition'"
op|':'
string|"'cpartition'"
op|','
nl|'\n'
string|"'X-Container-Device'"
op|':'
string|"'cdevice'"
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'text/plain'"
op|','
nl|'\n'
string|"'X-Backend-Container-Update-Override-Etag'"
op|':'
string|"'override_etag'"
op|','
nl|'\n'
string|"'X-Backend-Container-Update-Override-Content-Type'"
op|':'
string|"'override_val'"
op|','
nl|'\n'
string|"'X-Backend-Container-Update-Override-Foo'"
op|':'
string|"'bar'"
op|','
nl|'\n'
string|"'X-Backend-Container-Ignored'"
op|':'
string|"'ignored'"
nl|'\n'
op|'}'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/0/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
name|'headers'
op|','
name|'body'
op|'='
string|"''"
op|')'
newline|'\n'
name|'with'
name|'fake_spawn'
op|'('
op|')'
op|','
name|'mocked_http_conn'
op|'('
nl|'\n'
number|'200'
op|','
name|'give_connect'
op|'='
name|'capture_updates'
op|')'
name|'as'
name|'fake_conn'
op|':'
newline|'\n'
indent|'            '
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'StopIteration'
op|','
name|'fake_conn'
op|'.'
name|'code_iter'
op|'.'
name|'next'
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'201'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'len'
op|'('
name|'container_updates'
op|')'
op|','
number|'1'
op|')'
newline|'\n'
name|'ip'
op|','
name|'port'
op|','
name|'method'
op|','
name|'path'
op|','
name|'headers'
op|'='
name|'container_updates'
op|'['
number|'0'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'ip'
op|','
string|"'chost'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'port'
op|','
string|"'cport'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'method'
op|','
string|"'PUT'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'path'
op|','
string|"'/cdevice/cpartition/a/c/o'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'headers'
op|','
name|'HeaderKeyDict'
op|'('
op|'{'
nl|'\n'
string|"'user-agent'"
op|':'
string|"'object-server %s'"
op|'%'
name|'os'
op|'.'
name|'getpid'
op|'('
op|')'
op|','
nl|'\n'
string|"'x-size'"
op|':'
string|"'0'"
op|','
nl|'\n'
string|"'x-etag'"
op|':'
string|"'override_etag'"
op|','
nl|'\n'
string|"'x-content-type'"
op|':'
string|"'override_val'"
op|','
nl|'\n'
string|"'x-timestamp'"
op|':'
name|'utils'
op|'.'
name|'Timestamp'
op|'('
number|'1'
op|')'
op|'.'
name|'internal'
op|','
nl|'\n'
string|"'X-Backend-Storage-Policy-Index'"
op|':'
string|"'0'"
op|','
comment|'# default when not given'
nl|'\n'
string|"'x-trans-id'"
op|':'
string|"'123'"
op|','
nl|'\n'
string|"'referer'"
op|':'
string|"'PUT http://localhost/sda1/0/a/c/o'"
op|','
nl|'\n'
string|"'x-foo'"
op|':'
string|"'bar'"
op|'}'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_container_update_async
dedent|''
name|'def'
name|'test_container_update_async'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'policy'
op|'='
name|'random'
op|'.'
name|'choice'
op|'('
name|'list'
op|'('
name|'POLICIES'
op|')'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/0/a/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
number|'1'
op|','
nl|'\n'
string|"'X-Trans-Id'"
op|':'
string|"'123'"
op|','
nl|'\n'
string|"'X-Container-Host'"
op|':'
string|"'chost:cport'"
op|','
nl|'\n'
string|"'X-Container-Partition'"
op|':'
string|"'cpartition'"
op|','
nl|'\n'
string|"'X-Container-Device'"
op|':'
string|"'cdevice'"
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'text/plain'"
op|','
nl|'\n'
string|"'X-Object-Sysmeta-Ec-Frag-Index'"
op|':'
number|'0'
op|','
nl|'\n'
string|"'X-Backend-Storage-Policy-Index'"
op|':'
name|'int'
op|'('
name|'policy'
op|')'
op|'}'
op|','
name|'body'
op|'='
string|"''"
op|')'
newline|'\n'
name|'given_args'
op|'='
op|'['
op|']'
newline|'\n'
nl|'\n'
DECL|function|fake_pickle_async_update
name|'def'
name|'fake_pickle_async_update'
op|'('
op|'*'
name|'args'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'given_args'
op|'['
op|':'
op|']'
op|'='
name|'args'
newline|'\n'
dedent|''
name|'diskfile_mgr'
op|'='
name|'self'
op|'.'
name|'object_controller'
op|'.'
name|'_diskfile_router'
op|'['
name|'policy'
op|']'
newline|'\n'
name|'diskfile_mgr'
op|'.'
name|'pickle_async_update'
op|'='
name|'fake_pickle_async_update'
newline|'\n'
name|'with'
name|'fake_spawn'
op|'('
op|')'
op|','
name|'mocked_http_conn'
op|'('
number|'500'
op|')'
name|'as'
name|'fake_conn'
op|':'
newline|'\n'
indent|'            '
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'StopIteration'
op|','
name|'fake_conn'
op|'.'
name|'code_iter'
op|'.'
name|'next'
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'201'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'len'
op|'('
name|'given_args'
op|')'
op|','
number|'7'
op|')'
newline|'\n'
op|'('
name|'objdevice'
op|','
name|'account'
op|','
name|'container'
op|','
name|'obj'
op|','
name|'data'
op|','
name|'timestamp'
op|','
nl|'\n'
name|'policy'
op|')'
op|'='
name|'given_args'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'objdevice'
op|','
string|"'sda1'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'account'
op|','
string|"'a'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'container'
op|','
string|"'c'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'obj'
op|','
string|"'o'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'timestamp'
op|','
name|'utils'
op|'.'
name|'Timestamp'
op|'('
number|'1'
op|')'
op|'.'
name|'internal'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'policy'
op|','
name|'policy'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'data'
op|','
op|'{'
nl|'\n'
string|"'headers'"
op|':'
name|'HeaderKeyDict'
op|'('
op|'{'
nl|'\n'
string|"'X-Size'"
op|':'
string|"'0'"
op|','
nl|'\n'
string|"'User-Agent'"
op|':'
string|"'object-server %s'"
op|'%'
name|'os'
op|'.'
name|'getpid'
op|'('
op|')'
op|','
nl|'\n'
string|"'X-Content-Type'"
op|':'
string|"'text/plain'"
op|','
nl|'\n'
string|"'X-Timestamp'"
op|':'
name|'utils'
op|'.'
name|'Timestamp'
op|'('
number|'1'
op|')'
op|'.'
name|'internal'
op|','
nl|'\n'
string|"'X-Trans-Id'"
op|':'
string|"'123'"
op|','
nl|'\n'
string|"'Referer'"
op|':'
string|"'PUT http://localhost/sda1/0/a/c/o'"
op|','
nl|'\n'
string|"'X-Backend-Storage-Policy-Index'"
op|':'
name|'int'
op|'('
name|'policy'
op|')'
op|','
nl|'\n'
string|"'X-Etag'"
op|':'
string|"'d41d8cd98f00b204e9800998ecf8427e'"
op|'}'
op|')'
op|','
nl|'\n'
string|"'obj'"
op|':'
string|"'o'"
op|','
nl|'\n'
string|"'account'"
op|':'
string|"'a'"
op|','
nl|'\n'
string|"'container'"
op|':'
string|"'c'"
op|','
nl|'\n'
string|"'op'"
op|':'
string|"'PUT'"
op|'}'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_container_update_as_greenthread
dedent|''
name|'def'
name|'test_container_update_as_greenthread'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'greenthreads'
op|'='
op|'['
op|']'
newline|'\n'
name|'saved_spawn_calls'
op|'='
op|'['
op|']'
newline|'\n'
name|'called_async_update_args'
op|'='
op|'['
op|']'
newline|'\n'
nl|'\n'
DECL|function|local_fake_spawn
name|'def'
name|'local_fake_spawn'
op|'('
name|'func'
op|','
op|'*'
name|'a'
op|','
op|'**'
name|'kw'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'saved_spawn_calls'
op|'.'
name|'append'
op|'('
op|'('
name|'func'
op|','
name|'a'
op|','
name|'kw'
op|')'
op|')'
newline|'\n'
name|'return'
name|'mock'
op|'.'
name|'MagicMock'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|function|local_fake_async_update
dedent|''
name|'def'
name|'local_fake_async_update'
op|'('
op|'*'
name|'a'
op|','
op|'**'
name|'kw'
op|')'
op|':'
newline|'\n'
comment|'# just capture the args to see that we would have called'
nl|'\n'
indent|'            '
name|'called_async_update_args'
op|'.'
name|'append'
op|'('
op|'['
name|'a'
op|','
name|'kw'
op|']'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
string|"'12345'"
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'application/burrito'"
op|','
nl|'\n'
string|"'Content-Length'"
op|':'
string|"'0'"
op|','
nl|'\n'
string|"'X-Backend-Storage-Policy-Index'"
op|':'
number|'0'
op|','
nl|'\n'
string|"'X-Container-Partition'"
op|':'
string|"'20'"
op|','
nl|'\n'
string|"'X-Container-Host'"
op|':'
string|"'1.2.3.4:5'"
op|','
nl|'\n'
string|"'X-Container-Device'"
op|':'
string|"'sdb1'"
op|'}'
op|')'
newline|'\n'
name|'with'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'object_server'
op|','
string|"'spawn'"
op|','
nl|'\n'
name|'local_fake_spawn'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'with'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|','
nl|'\n'
string|"'async_update'"
op|','
nl|'\n'
name|'local_fake_async_update'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
comment|'# check the response is completed and successful'
nl|'\n'
dedent|''
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'201'
op|')'
newline|'\n'
comment|"# check that async_update hasn't been called"
nl|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'len'
op|'('
name|'called_async_update_args'
op|')'
op|')'
newline|'\n'
comment|'# now do the work in greenthreads'
nl|'\n'
name|'for'
name|'func'
op|','
name|'a'
op|','
name|'kw'
name|'in'
name|'saved_spawn_calls'
op|':'
newline|'\n'
indent|'            '
name|'gt'
op|'='
name|'spawn'
op|'('
name|'func'
op|','
op|'*'
name|'a'
op|','
op|'**'
name|'kw'
op|')'
newline|'\n'
name|'greenthreads'
op|'.'
name|'append'
op|'('
name|'gt'
op|')'
newline|'\n'
comment|'# wait for the greenthreads to finish'
nl|'\n'
dedent|''
name|'for'
name|'gt'
name|'in'
name|'greenthreads'
op|':'
newline|'\n'
indent|'            '
name|'gt'
op|'.'
name|'wait'
op|'('
op|')'
newline|'\n'
comment|'# check that the calls to async_update have happened'
nl|'\n'
dedent|''
name|'headers_out'
op|'='
op|'{'
string|"'X-Size'"
op|':'
string|"'0'"
op|','
nl|'\n'
string|"'X-Content-Type'"
op|':'
string|"'application/burrito'"
op|','
nl|'\n'
string|"'X-Timestamp'"
op|':'
string|"'0000012345.00000'"
op|','
nl|'\n'
string|"'X-Trans-Id'"
op|':'
string|"'-'"
op|','
nl|'\n'
string|"'Referer'"
op|':'
string|"'PUT http://localhost/sda1/p/a/c/o'"
op|','
nl|'\n'
string|"'X-Backend-Storage-Policy-Index'"
op|':'
string|"'0'"
op|','
nl|'\n'
string|"'X-Etag'"
op|':'
string|"'d41d8cd98f00b204e9800998ecf8427e'"
op|'}'
newline|'\n'
name|'expected'
op|'='
op|'['
op|'('
string|"'PUT'"
op|','
string|"'a'"
op|','
string|"'c'"
op|','
string|"'o'"
op|','
string|"'1.2.3.4:5'"
op|','
string|"'20'"
op|','
string|"'sdb1'"
op|','
nl|'\n'
name|'headers_out'
op|','
string|"'sda1'"
op|','
name|'POLICIES'
op|'['
number|'0'
op|']'
op|')'
op|','
nl|'\n'
op|'{'
string|"'logger_thread_locals'"
op|':'
op|'('
name|'None'
op|','
name|'None'
op|')'
op|'}'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'called_async_update_args'
op|','
op|'['
name|'expected'
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_container_update_as_greenthread_with_timeout
dedent|''
name|'def'
name|'test_container_update_as_greenthread_with_timeout'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|"'''\n        give it one container to update (for only one greenthred)\n        fake the greenthred so it will raise a timeout\n        test that the right message is logged and the method returns None\n        '''"
newline|'\n'
name|'called_async_update_args'
op|'='
op|'['
op|']'
newline|'\n'
nl|'\n'
DECL|function|local_fake_spawn
name|'def'
name|'local_fake_spawn'
op|'('
name|'func'
op|','
op|'*'
name|'a'
op|','
op|'**'
name|'kw'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'m'
op|'='
name|'mock'
op|'.'
name|'MagicMock'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|function|wait_with_error
name|'def'
name|'wait_with_error'
op|'('
op|')'
op|':'
newline|'\n'
indent|'                '
name|'raise'
name|'Timeout'
op|'('
op|')'
newline|'\n'
dedent|''
name|'m'
op|'.'
name|'wait'
op|'='
name|'wait_with_error'
comment|"# because raise can't be in a lambda"
newline|'\n'
name|'return'
name|'m'
newline|'\n'
nl|'\n'
DECL|function|local_fake_async_update
dedent|''
name|'def'
name|'local_fake_async_update'
op|'('
op|'*'
name|'a'
op|','
op|'**'
name|'kw'
op|')'
op|':'
newline|'\n'
comment|'# just capture the args to see that we would have called'
nl|'\n'
indent|'            '
name|'called_async_update_args'
op|'.'
name|'append'
op|'('
op|'['
name|'a'
op|','
name|'kw'
op|']'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
string|"'12345'"
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'application/burrito'"
op|','
nl|'\n'
string|"'Content-Length'"
op|':'
string|"'0'"
op|','
nl|'\n'
string|"'X-Backend-Storage-Policy-Index'"
op|':'
number|'0'
op|','
nl|'\n'
string|"'X-Container-Partition'"
op|':'
string|"'20'"
op|','
nl|'\n'
string|"'X-Container-Host'"
op|':'
string|"'1.2.3.4:5'"
op|','
nl|'\n'
string|"'X-Container-Device'"
op|':'
string|"'sdb1'"
op|'}'
op|')'
newline|'\n'
name|'with'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'object_server'
op|','
string|"'spawn'"
op|','
nl|'\n'
name|'local_fake_spawn'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'with'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|','
nl|'\n'
string|"'container_update_timeout'"
op|','
nl|'\n'
number|'1.414213562'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
comment|'# check the response is completed and successful'
nl|'\n'
dedent|''
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'201'
op|')'
newline|'\n'
comment|'# check that the timeout was logged'
nl|'\n'
name|'expected_logged_error'
op|'='
string|'"Container update timeout (1.4142s) "'
string|'"waiting for [(\'1.2.3.4:5\', \'sdb1\')]"'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
nl|'\n'
name|'expected_logged_error'
name|'in'
nl|'\n'
name|'self'
op|'.'
name|'object_controller'
op|'.'
name|'logger'
op|'.'
name|'get_lines_for_level'
op|'('
string|"'debug'"
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_container_update_bad_args
dedent|''
name|'def'
name|'test_container_update_bad_args'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'policy'
op|'='
name|'random'
op|'.'
name|'choice'
op|'('
name|'list'
op|'('
name|'POLICIES'
op|')'
op|')'
newline|'\n'
name|'given_args'
op|'='
op|'['
op|']'
newline|'\n'
nl|'\n'
DECL|function|fake_async_update
name|'def'
name|'fake_async_update'
op|'('
op|'*'
name|'args'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'given_args'
op|'.'
name|'extend'
op|'('
name|'args'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/v1/a/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
number|'1'
op|','
nl|'\n'
string|"'X-Trans-Id'"
op|':'
string|"'123'"
op|','
nl|'\n'
string|"'X-Container-Host'"
op|':'
string|"'chost,badhost'"
op|','
nl|'\n'
string|"'X-Container-Partition'"
op|':'
string|"'cpartition'"
op|','
nl|'\n'
string|"'X-Container-Device'"
op|':'
string|"'cdevice'"
op|','
nl|'\n'
string|"'X-Backend-Storage-Policy-Index'"
op|':'
name|'int'
op|'('
name|'policy'
op|')'
op|'}'
op|')'
newline|'\n'
name|'with'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|','
string|"'async_update'"
op|','
nl|'\n'
name|'fake_async_update'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'object_controller'
op|'.'
name|'container_update'
op|'('
nl|'\n'
string|"'PUT'"
op|','
string|"'a'"
op|','
string|"'c'"
op|','
string|"'o'"
op|','
name|'req'
op|','
op|'{'
nl|'\n'
string|"'x-size'"
op|':'
string|"'0'"
op|','
nl|'\n'
string|"'x-etag'"
op|':'
string|"'d41d8cd98f00b204e9800998ecf8427e'"
op|','
nl|'\n'
string|"'x-content-type'"
op|':'
string|"'text/plain'"
op|','
string|"'x-timestamp'"
op|':'
string|"'1'"
op|'}'
op|','
nl|'\n'
string|"'sda1'"
op|','
name|'policy'
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'given_args'
op|','
op|'['
op|']'
op|')'
newline|'\n'
name|'errors'
op|'='
name|'self'
op|'.'
name|'object_controller'
op|'.'
name|'logger'
op|'.'
name|'get_lines_for_level'
op|'('
string|"'error'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'len'
op|'('
name|'errors'
op|')'
op|','
number|'1'
op|')'
newline|'\n'
name|'msg'
op|'='
name|'errors'
op|'['
number|'0'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
string|"'Container update failed'"
name|'in'
name|'msg'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
string|"'different numbers of hosts and devices'"
name|'in'
name|'msg'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
string|"'chost,badhost'"
name|'in'
name|'msg'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
string|"'cdevice'"
name|'in'
name|'msg'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_delete_at_update_on_put
dedent|''
name|'def'
name|'test_delete_at_update_on_put'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# Test how delete_at_update works when issued a delete for old'
nl|'\n'
comment|'# expiration info after a new put with no new expiration info.'
nl|'\n'
indent|'        '
name|'policy'
op|'='
name|'random'
op|'.'
name|'choice'
op|'('
name|'list'
op|'('
name|'POLICIES'
op|')'
op|')'
newline|'\n'
name|'given_args'
op|'='
op|'['
op|']'
newline|'\n'
nl|'\n'
DECL|function|fake_async_update
name|'def'
name|'fake_async_update'
op|'('
op|'*'
name|'args'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'given_args'
op|'.'
name|'extend'
op|'('
name|'args'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/v1/a/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
number|'1'
op|','
nl|'\n'
string|"'X-Trans-Id'"
op|':'
string|"'123'"
op|','
nl|'\n'
string|"'X-Backend-Storage-Policy-Index'"
op|':'
name|'int'
op|'('
name|'policy'
op|')'
op|'}'
op|')'
newline|'\n'
name|'with'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|','
string|"'async_update'"
op|','
nl|'\n'
name|'fake_async_update'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'object_controller'
op|'.'
name|'delete_at_update'
op|'('
nl|'\n'
string|"'DELETE'"
op|','
number|'2'
op|','
string|"'a'"
op|','
string|"'c'"
op|','
string|"'o'"
op|','
name|'req'
op|','
string|"'sda1'"
op|','
name|'policy'
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
nl|'\n'
name|'given_args'
op|','
op|'['
nl|'\n'
string|"'DELETE'"
op|','
string|"'.expiring_objects'"
op|','
string|"'0000000000'"
op|','
nl|'\n'
string|"'0000000002-a/c/o'"
op|','
name|'None'
op|','
name|'None'
op|','
name|'None'
op|','
nl|'\n'
name|'HeaderKeyDict'
op|'('
op|'{'
nl|'\n'
string|"'X-Backend-Storage-Policy-Index'"
op|':'
number|'0'
op|','
nl|'\n'
string|"'x-timestamp'"
op|':'
name|'utils'
op|'.'
name|'Timestamp'
op|'('
string|"'1'"
op|')'
op|'.'
name|'internal'
op|','
nl|'\n'
string|"'x-trans-id'"
op|':'
string|"'123'"
op|','
nl|'\n'
string|"'referer'"
op|':'
string|"'PUT http://localhost/v1/a/c/o'"
op|'}'
op|')'
op|','
nl|'\n'
string|"'sda1'"
op|','
name|'policy'
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_delete_at_negative
dedent|''
name|'def'
name|'test_delete_at_negative'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# Test how delete_at_update works when issued a delete for old'
nl|'\n'
comment|'# expiration info after a new put with no new expiration info.'
nl|'\n'
comment|'# Test negative is reset to 0'
nl|'\n'
indent|'        '
name|'policy'
op|'='
name|'random'
op|'.'
name|'choice'
op|'('
name|'list'
op|'('
name|'POLICIES'
op|')'
op|')'
newline|'\n'
name|'given_args'
op|'='
op|'['
op|']'
newline|'\n'
nl|'\n'
DECL|function|fake_async_update
name|'def'
name|'fake_async_update'
op|'('
op|'*'
name|'args'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'given_args'
op|'.'
name|'extend'
op|'('
name|'args'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'object_controller'
op|'.'
name|'async_update'
op|'='
name|'fake_async_update'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/v1/a/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
number|'1'
op|','
nl|'\n'
string|"'X-Trans-Id'"
op|':'
string|"'1234'"
op|','
string|"'X-Backend-Storage-Policy-Index'"
op|':'
nl|'\n'
name|'int'
op|'('
name|'policy'
op|')'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'object_controller'
op|'.'
name|'delete_at_update'
op|'('
nl|'\n'
string|"'DELETE'"
op|','
op|'-'
number|'2'
op|','
string|"'a'"
op|','
string|"'c'"
op|','
string|"'o'"
op|','
name|'req'
op|','
string|"'sda1'"
op|','
name|'policy'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'given_args'
op|','
op|'['
nl|'\n'
string|"'DELETE'"
op|','
string|"'.expiring_objects'"
op|','
string|"'0000000000'"
op|','
string|"'0000000000-a/c/o'"
op|','
nl|'\n'
name|'None'
op|','
name|'None'
op|','
name|'None'
op|','
nl|'\n'
name|'HeaderKeyDict'
op|'('
op|'{'
nl|'\n'
comment|'# the expiring objects account is always 0'
nl|'\n'
string|"'X-Backend-Storage-Policy-Index'"
op|':'
number|'0'
op|','
nl|'\n'
string|"'x-timestamp'"
op|':'
name|'utils'
op|'.'
name|'Timestamp'
op|'('
string|"'1'"
op|')'
op|'.'
name|'internal'
op|','
nl|'\n'
string|"'x-trans-id'"
op|':'
string|"'1234'"
op|','
nl|'\n'
string|"'referer'"
op|':'
string|"'PUT http://localhost/v1/a/c/o'"
op|'}'
op|')'
op|','
nl|'\n'
string|"'sda1'"
op|','
name|'policy'
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_delete_at_cap
dedent|''
name|'def'
name|'test_delete_at_cap'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# Test how delete_at_update works when issued a delete for old'
nl|'\n'
comment|'# expiration info after a new put with no new expiration info.'
nl|'\n'
comment|'# Test past cap is reset to cap'
nl|'\n'
indent|'        '
name|'policy'
op|'='
name|'random'
op|'.'
name|'choice'
op|'('
name|'list'
op|'('
name|'POLICIES'
op|')'
op|')'
newline|'\n'
name|'given_args'
op|'='
op|'['
op|']'
newline|'\n'
nl|'\n'
DECL|function|fake_async_update
name|'def'
name|'fake_async_update'
op|'('
op|'*'
name|'args'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'given_args'
op|'.'
name|'extend'
op|'('
name|'args'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'object_controller'
op|'.'
name|'async_update'
op|'='
name|'fake_async_update'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/v1/a/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
number|'1'
op|','
nl|'\n'
string|"'X-Trans-Id'"
op|':'
string|"'1234'"
op|','
nl|'\n'
string|"'X-Backend-Storage-Policy-Index'"
op|':'
name|'int'
op|'('
name|'policy'
op|')'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'object_controller'
op|'.'
name|'delete_at_update'
op|'('
nl|'\n'
string|"'DELETE'"
op|','
number|'12345678901'
op|','
string|"'a'"
op|','
string|"'c'"
op|','
string|"'o'"
op|','
name|'req'
op|','
string|"'sda1'"
op|','
name|'policy'
op|')'
newline|'\n'
name|'expiring_obj_container'
op|'='
name|'given_args'
op|'.'
name|'pop'
op|'('
number|'2'
op|')'
newline|'\n'
name|'expected_exp_cont'
op|'='
name|'utils'
op|'.'
name|'get_expirer_container'
op|'('
nl|'\n'
name|'utils'
op|'.'
name|'normalize_delete_at_timestamp'
op|'('
number|'12345678901'
op|')'
op|','
nl|'\n'
number|'86400'
op|','
string|"'a'"
op|','
string|"'c'"
op|','
string|"'o'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'expiring_obj_container'
op|','
name|'expected_exp_cont'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'given_args'
op|','
op|'['
nl|'\n'
string|"'DELETE'"
op|','
string|"'.expiring_objects'"
op|','
string|"'9999999999-a/c/o'"
op|','
nl|'\n'
name|'None'
op|','
name|'None'
op|','
name|'None'
op|','
nl|'\n'
name|'HeaderKeyDict'
op|'('
op|'{'
nl|'\n'
string|"'X-Backend-Storage-Policy-Index'"
op|':'
number|'0'
op|','
nl|'\n'
string|"'x-timestamp'"
op|':'
name|'utils'
op|'.'
name|'Timestamp'
op|'('
string|"'1'"
op|')'
op|'.'
name|'internal'
op|','
nl|'\n'
string|"'x-trans-id'"
op|':'
string|"'1234'"
op|','
nl|'\n'
string|"'referer'"
op|':'
string|"'PUT http://localhost/v1/a/c/o'"
op|'}'
op|')'
op|','
nl|'\n'
string|"'sda1'"
op|','
name|'policy'
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_delete_at_update_put_with_info
dedent|''
name|'def'
name|'test_delete_at_update_put_with_info'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# Keep next test,'
nl|'\n'
comment|'# test_delete_at_update_put_with_info_but_missing_container, in sync'
nl|'\n'
comment|'# with this one but just missing the X-Delete-At-Container header.'
nl|'\n'
indent|'        '
name|'policy'
op|'='
name|'random'
op|'.'
name|'choice'
op|'('
name|'list'
op|'('
name|'POLICIES'
op|')'
op|')'
newline|'\n'
name|'given_args'
op|'='
op|'['
op|']'
newline|'\n'
nl|'\n'
DECL|function|fake_async_update
name|'def'
name|'fake_async_update'
op|'('
op|'*'
name|'args'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'given_args'
op|'.'
name|'extend'
op|'('
name|'args'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'object_controller'
op|'.'
name|'async_update'
op|'='
name|'fake_async_update'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/v1/a/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
number|'1'
op|','
nl|'\n'
string|"'X-Trans-Id'"
op|':'
string|"'1234'"
op|','
nl|'\n'
string|"'X-Delete-At-Container'"
op|':'
string|"'0'"
op|','
nl|'\n'
string|"'X-Delete-At-Host'"
op|':'
string|"'127.0.0.1:1234'"
op|','
nl|'\n'
string|"'X-Delete-At-Partition'"
op|':'
string|"'3'"
op|','
nl|'\n'
string|"'X-Delete-At-Device'"
op|':'
string|"'sdc1'"
op|','
nl|'\n'
string|"'X-Backend-Storage-Policy-Index'"
op|':'
name|'int'
op|'('
name|'policy'
op|')'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'object_controller'
op|'.'
name|'delete_at_update'
op|'('
string|"'PUT'"
op|','
number|'2'
op|','
string|"'a'"
op|','
string|"'c'"
op|','
string|"'o'"
op|','
nl|'\n'
name|'req'
op|','
string|"'sda1'"
op|','
name|'policy'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
nl|'\n'
name|'given_args'
op|','
op|'['
nl|'\n'
string|"'PUT'"
op|','
string|"'.expiring_objects'"
op|','
string|"'0000000000'"
op|','
string|"'0000000002-a/c/o'"
op|','
nl|'\n'
string|"'127.0.0.1:1234'"
op|','
nl|'\n'
string|"'3'"
op|','
string|"'sdc1'"
op|','
name|'HeaderKeyDict'
op|'('
op|'{'
nl|'\n'
comment|'# the .expiring_objects account is always policy-0'
nl|'\n'
string|"'X-Backend-Storage-Policy-Index'"
op|':'
number|'0'
op|','
nl|'\n'
string|"'x-size'"
op|':'
string|"'0'"
op|','
nl|'\n'
string|"'x-etag'"
op|':'
string|"'d41d8cd98f00b204e9800998ecf8427e'"
op|','
nl|'\n'
string|"'x-content-type'"
op|':'
string|"'text/plain'"
op|','
nl|'\n'
string|"'x-timestamp'"
op|':'
name|'utils'
op|'.'
name|'Timestamp'
op|'('
string|"'1'"
op|')'
op|'.'
name|'internal'
op|','
nl|'\n'
string|"'x-trans-id'"
op|':'
string|"'1234'"
op|','
nl|'\n'
string|"'referer'"
op|':'
string|"'PUT http://localhost/v1/a/c/o'"
op|'}'
op|')'
op|','
nl|'\n'
string|"'sda1'"
op|','
name|'policy'
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_delete_at_update_put_with_info_but_missing_container
dedent|''
name|'def'
name|'test_delete_at_update_put_with_info_but_missing_container'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# Same as previous test, test_delete_at_update_put_with_info, but just'
nl|'\n'
comment|'# missing the X-Delete-At-Container header.'
nl|'\n'
indent|'        '
name|'policy'
op|'='
name|'random'
op|'.'
name|'choice'
op|'('
name|'list'
op|'('
name|'POLICIES'
op|')'
op|')'
newline|'\n'
name|'given_args'
op|'='
op|'['
op|']'
newline|'\n'
nl|'\n'
DECL|function|fake_async_update
name|'def'
name|'fake_async_update'
op|'('
op|'*'
name|'args'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'given_args'
op|'.'
name|'extend'
op|'('
name|'args'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'object_controller'
op|'.'
name|'async_update'
op|'='
name|'fake_async_update'
newline|'\n'
name|'self'
op|'.'
name|'object_controller'
op|'.'
name|'logger'
op|'='
name|'self'
op|'.'
name|'logger'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/v1/a/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
number|'1'
op|','
nl|'\n'
string|"'X-Trans-Id'"
op|':'
string|"'1234'"
op|','
nl|'\n'
string|"'X-Delete-At-Host'"
op|':'
string|"'127.0.0.1:1234'"
op|','
nl|'\n'
string|"'X-Delete-At-Partition'"
op|':'
string|"'3'"
op|','
nl|'\n'
string|"'X-Delete-At-Device'"
op|':'
string|"'sdc1'"
op|','
nl|'\n'
string|"'X-Backend-Storage-Policy-Index'"
op|':'
name|'int'
op|'('
name|'policy'
op|')'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'object_controller'
op|'.'
name|'delete_at_update'
op|'('
string|"'PUT'"
op|','
number|'2'
op|','
string|"'a'"
op|','
string|"'c'"
op|','
string|"'o'"
op|','
nl|'\n'
name|'req'
op|','
string|"'sda1'"
op|','
name|'policy'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'logger'
op|'.'
name|'get_lines_for_level'
op|'('
string|"'warning'"
op|')'
op|','
nl|'\n'
op|'['
string|"'X-Delete-At-Container header must be specified for expiring '"
nl|'\n'
string|"'objects background PUT to work properly. Making best guess as '"
nl|'\n'
string|"'to the container name for now.'"
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_delete_at_update_delete
dedent|''
name|'def'
name|'test_delete_at_update_delete'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'policy'
op|'='
name|'random'
op|'.'
name|'choice'
op|'('
name|'list'
op|'('
name|'POLICIES'
op|')'
op|')'
newline|'\n'
name|'given_args'
op|'='
op|'['
op|']'
newline|'\n'
nl|'\n'
DECL|function|fake_async_update
name|'def'
name|'fake_async_update'
op|'('
op|'*'
name|'args'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'given_args'
op|'.'
name|'extend'
op|'('
name|'args'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'object_controller'
op|'.'
name|'async_update'
op|'='
name|'fake_async_update'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/v1/a/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'DELETE'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
number|'1'
op|','
nl|'\n'
string|"'X-Trans-Id'"
op|':'
string|"'1234'"
op|','
nl|'\n'
string|"'X-Backend-Storage-Policy-Index'"
op|':'
name|'int'
op|'('
name|'policy'
op|')'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'object_controller'
op|'.'
name|'delete_at_update'
op|'('
string|"'DELETE'"
op|','
number|'2'
op|','
string|"'a'"
op|','
string|"'c'"
op|','
string|"'o'"
op|','
nl|'\n'
name|'req'
op|','
string|"'sda1'"
op|','
name|'policy'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
nl|'\n'
name|'given_args'
op|','
op|'['
nl|'\n'
string|"'DELETE'"
op|','
string|"'.expiring_objects'"
op|','
string|"'0000000000'"
op|','
nl|'\n'
string|"'0000000002-a/c/o'"
op|','
name|'None'
op|','
name|'None'
op|','
nl|'\n'
name|'None'
op|','
name|'HeaderKeyDict'
op|'('
op|'{'
nl|'\n'
string|"'X-Backend-Storage-Policy-Index'"
op|':'
number|'0'
op|','
nl|'\n'
string|"'x-timestamp'"
op|':'
name|'utils'
op|'.'
name|'Timestamp'
op|'('
string|"'1'"
op|')'
op|'.'
name|'internal'
op|','
nl|'\n'
string|"'x-trans-id'"
op|':'
string|"'1234'"
op|','
nl|'\n'
string|"'referer'"
op|':'
string|"'DELETE http://localhost/v1/a/c/o'"
op|'}'
op|')'
op|','
nl|'\n'
string|"'sda1'"
op|','
name|'policy'
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_delete_backend_replication
dedent|''
name|'def'
name|'test_delete_backend_replication'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# If X-Backend-Replication: True delete_at_update should completely'
nl|'\n'
comment|'# short-circuit.'
nl|'\n'
indent|'        '
name|'policy'
op|'='
name|'random'
op|'.'
name|'choice'
op|'('
name|'list'
op|'('
name|'POLICIES'
op|')'
op|')'
newline|'\n'
name|'given_args'
op|'='
op|'['
op|']'
newline|'\n'
nl|'\n'
DECL|function|fake_async_update
name|'def'
name|'fake_async_update'
op|'('
op|'*'
name|'args'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'given_args'
op|'.'
name|'extend'
op|'('
name|'args'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'object_controller'
op|'.'
name|'async_update'
op|'='
name|'fake_async_update'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/v1/a/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
number|'1'
op|','
nl|'\n'
string|"'X-Trans-Id'"
op|':'
string|"'1234'"
op|','
nl|'\n'
string|"'X-Backend-Replication'"
op|':'
string|"'True'"
op|','
nl|'\n'
string|"'X-Backend-Storage-Policy-Index'"
op|':'
name|'int'
op|'('
name|'policy'
op|')'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'object_controller'
op|'.'
name|'delete_at_update'
op|'('
nl|'\n'
string|"'DELETE'"
op|','
op|'-'
number|'2'
op|','
string|"'a'"
op|','
string|"'c'"
op|','
string|"'o'"
op|','
name|'req'
op|','
string|"'sda1'"
op|','
name|'policy'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'given_args'
op|','
op|'['
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_POST_calls_delete_at
dedent|''
name|'def'
name|'test_POST_calls_delete_at'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'policy'
op|'='
name|'random'
op|'.'
name|'choice'
op|'('
name|'list'
op|'('
name|'POLICIES'
op|')'
op|')'
newline|'\n'
name|'given_args'
op|'='
op|'['
op|']'
newline|'\n'
nl|'\n'
DECL|function|fake_delete_at_update
name|'def'
name|'fake_delete_at_update'
op|'('
op|'*'
name|'args'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'given_args'
op|'.'
name|'extend'
op|'('
name|'args'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'object_controller'
op|'.'
name|'delete_at_update'
op|'='
name|'fake_delete_at_update'
newline|'\n'
nl|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'normalize_timestamp'
op|'('
name|'time'
op|'('
op|')'
op|')'
op|','
nl|'\n'
string|"'Content-Length'"
op|':'
string|"'4'"
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'application/octet-stream'"
op|','
nl|'\n'
string|"'X-Backend-Storage-Policy-Index'"
op|':'
name|'int'
op|'('
name|'policy'
op|')'
op|','
nl|'\n'
string|"'X-Object-Sysmeta-Ec-Frag-Index'"
op|':'
number|'2'
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'body'
op|'='
string|"'TEST'"
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'201'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'given_args'
op|','
op|'['
op|']'
op|')'
newline|'\n'
nl|'\n'
name|'sleep'
op|'('
number|'.00001'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'POST'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'normalize_timestamp'
op|'('
name|'time'
op|'('
op|')'
op|')'
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'application/x-test'"
op|','
nl|'\n'
string|"'X-Backend-Storage-Policy-Index'"
op|':'
name|'int'
op|'('
name|'policy'
op|')'
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'202'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'given_args'
op|','
op|'['
op|']'
op|')'
newline|'\n'
nl|'\n'
name|'sleep'
op|'('
number|'.00001'
op|')'
newline|'\n'
name|'timestamp1'
op|'='
name|'normalize_timestamp'
op|'('
name|'time'
op|'('
op|')'
op|')'
newline|'\n'
name|'delete_at_timestamp1'
op|'='
name|'str'
op|'('
name|'int'
op|'('
name|'time'
op|'('
op|')'
op|'+'
number|'1000'
op|')'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'POST'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'timestamp1'
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'application/x-test'"
op|','
nl|'\n'
string|"'X-Delete-At'"
op|':'
name|'delete_at_timestamp1'
op|','
nl|'\n'
string|"'X-Backend-Storage-Policy-Index'"
op|':'
name|'int'
op|'('
name|'policy'
op|')'
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'202'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
nl|'\n'
name|'given_args'
op|','
op|'['
nl|'\n'
string|"'PUT'"
op|','
name|'int'
op|'('
name|'delete_at_timestamp1'
op|')'
op|','
string|"'a'"
op|','
string|"'c'"
op|','
string|"'o'"
op|','
nl|'\n'
name|'given_args'
op|'['
number|'5'
op|']'
op|','
string|"'sda1'"
op|','
name|'policy'
op|']'
op|')'
newline|'\n'
nl|'\n'
name|'while'
name|'given_args'
op|':'
newline|'\n'
indent|'            '
name|'given_args'
op|'.'
name|'pop'
op|'('
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'sleep'
op|'('
number|'.00001'
op|')'
newline|'\n'
name|'timestamp2'
op|'='
name|'normalize_timestamp'
op|'('
name|'time'
op|'('
op|')'
op|')'
newline|'\n'
name|'delete_at_timestamp2'
op|'='
name|'str'
op|'('
name|'int'
op|'('
name|'time'
op|'('
op|')'
op|'+'
number|'2000'
op|')'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'POST'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'timestamp2'
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'application/x-test'"
op|','
nl|'\n'
string|"'X-Delete-At'"
op|':'
name|'delete_at_timestamp2'
op|','
nl|'\n'
string|"'X-Backend-Storage-Policy-Index'"
op|':'
name|'int'
op|'('
name|'policy'
op|')'
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'202'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
nl|'\n'
name|'given_args'
op|','
op|'['
nl|'\n'
string|"'PUT'"
op|','
name|'int'
op|'('
name|'delete_at_timestamp2'
op|')'
op|','
string|"'a'"
op|','
string|"'c'"
op|','
string|"'o'"
op|','
nl|'\n'
name|'given_args'
op|'['
number|'5'
op|']'
op|','
string|"'sda1'"
op|','
name|'policy'
op|','
nl|'\n'
string|"'DELETE'"
op|','
name|'int'
op|'('
name|'delete_at_timestamp1'
op|')'
op|','
string|"'a'"
op|','
string|"'c'"
op|','
string|"'o'"
op|','
nl|'\n'
name|'given_args'
op|'['
number|'5'
op|']'
op|','
string|"'sda1'"
op|','
name|'policy'
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_PUT_calls_delete_at
dedent|''
name|'def'
name|'test_PUT_calls_delete_at'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'policy'
op|'='
name|'random'
op|'.'
name|'choice'
op|'('
name|'list'
op|'('
name|'POLICIES'
op|')'
op|')'
newline|'\n'
name|'given_args'
op|'='
op|'['
op|']'
newline|'\n'
nl|'\n'
DECL|function|fake_delete_at_update
name|'def'
name|'fake_delete_at_update'
op|'('
op|'*'
name|'args'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'given_args'
op|'.'
name|'extend'
op|'('
name|'args'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'object_controller'
op|'.'
name|'delete_at_update'
op|'='
name|'fake_delete_at_update'
newline|'\n'
nl|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'normalize_timestamp'
op|'('
name|'time'
op|'('
op|')'
op|')'
op|','
nl|'\n'
string|"'Content-Length'"
op|':'
string|"'4'"
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'application/octet-stream'"
op|','
nl|'\n'
string|"'X-Backend-Storage-Policy-Index'"
op|':'
name|'int'
op|'('
name|'policy'
op|')'
op|','
nl|'\n'
string|"'X-Object-Sysmeta-Ec-Frag-Index'"
op|':'
number|'4'
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'body'
op|'='
string|"'TEST'"
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'201'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'given_args'
op|','
op|'['
op|']'
op|')'
newline|'\n'
nl|'\n'
name|'sleep'
op|'('
number|'.00001'
op|')'
newline|'\n'
name|'timestamp1'
op|'='
name|'normalize_timestamp'
op|'('
name|'time'
op|'('
op|')'
op|')'
newline|'\n'
name|'delete_at_timestamp1'
op|'='
name|'str'
op|'('
name|'int'
op|'('
name|'time'
op|'('
op|')'
op|'+'
number|'1000'
op|')'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'timestamp1'
op|','
nl|'\n'
string|"'Content-Length'"
op|':'
string|"'4'"
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'application/octet-stream'"
op|','
nl|'\n'
string|"'X-Delete-At'"
op|':'
name|'delete_at_timestamp1'
op|','
nl|'\n'
string|"'X-Backend-Storage-Policy-Index'"
op|':'
name|'int'
op|'('
name|'policy'
op|')'
op|','
nl|'\n'
string|"'X-Object-Sysmeta-Ec-Frag-Index'"
op|':'
number|'3'
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'body'
op|'='
string|"'TEST'"
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'201'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
nl|'\n'
name|'given_args'
op|','
op|'['
nl|'\n'
string|"'PUT'"
op|','
name|'int'
op|'('
name|'delete_at_timestamp1'
op|')'
op|','
string|"'a'"
op|','
string|"'c'"
op|','
string|"'o'"
op|','
nl|'\n'
name|'given_args'
op|'['
number|'5'
op|']'
op|','
string|"'sda1'"
op|','
name|'policy'
op|']'
op|')'
newline|'\n'
nl|'\n'
name|'while'
name|'given_args'
op|':'
newline|'\n'
indent|'            '
name|'given_args'
op|'.'
name|'pop'
op|'('
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'sleep'
op|'('
number|'.00001'
op|')'
newline|'\n'
name|'timestamp2'
op|'='
name|'normalize_timestamp'
op|'('
name|'time'
op|'('
op|')'
op|')'
newline|'\n'
name|'delete_at_timestamp2'
op|'='
name|'str'
op|'('
name|'int'
op|'('
name|'time'
op|'('
op|')'
op|'+'
number|'2000'
op|')'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'timestamp2'
op|','
nl|'\n'
string|"'Content-Length'"
op|':'
string|"'4'"
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'application/octet-stream'"
op|','
nl|'\n'
string|"'X-Delete-At'"
op|':'
name|'delete_at_timestamp2'
op|','
nl|'\n'
string|"'X-Backend-Storage-Policy-Index'"
op|':'
name|'int'
op|'('
name|'policy'
op|')'
op|','
nl|'\n'
string|"'X-Object-Sysmeta-Ec-Frag-Index'"
op|':'
number|'3'
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'body'
op|'='
string|"'TEST'"
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'201'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
nl|'\n'
name|'given_args'
op|','
op|'['
nl|'\n'
string|"'PUT'"
op|','
name|'int'
op|'('
name|'delete_at_timestamp2'
op|')'
op|','
string|"'a'"
op|','
string|"'c'"
op|','
string|"'o'"
op|','
nl|'\n'
name|'given_args'
op|'['
number|'5'
op|']'
op|','
string|"'sda1'"
op|','
name|'policy'
op|','
nl|'\n'
string|"'DELETE'"
op|','
name|'int'
op|'('
name|'delete_at_timestamp1'
op|')'
op|','
string|"'a'"
op|','
string|"'c'"
op|','
string|"'o'"
op|','
nl|'\n'
name|'given_args'
op|'['
number|'5'
op|']'
op|','
string|"'sda1'"
op|','
name|'policy'
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_GET_but_expired
dedent|''
name|'def'
name|'test_GET_but_expired'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'test_time'
op|'='
name|'time'
op|'('
op|')'
op|'+'
number|'10000'
newline|'\n'
name|'delete_at_timestamp'
op|'='
name|'int'
op|'('
name|'test_time'
op|'+'
number|'100'
op|')'
newline|'\n'
name|'delete_at_container'
op|'='
name|'str'
op|'('
nl|'\n'
name|'delete_at_timestamp'
op|'/'
nl|'\n'
name|'self'
op|'.'
name|'object_controller'
op|'.'
name|'expiring_objects_container_divisor'
op|'*'
nl|'\n'
name|'self'
op|'.'
name|'object_controller'
op|'.'
name|'expiring_objects_container_divisor'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'normalize_timestamp'
op|'('
name|'test_time'
op|'-'
number|'2000'
op|')'
op|','
nl|'\n'
string|"'X-Delete-At'"
op|':'
name|'str'
op|'('
name|'delete_at_timestamp'
op|')'
op|','
nl|'\n'
string|"'X-Delete-At-Container'"
op|':'
name|'delete_at_container'
op|','
nl|'\n'
string|"'Content-Length'"
op|':'
string|"'4'"
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'application/octet-stream'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'body'
op|'='
string|"'TEST'"
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'201'
op|')'
newline|'\n'
nl|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'GET'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'normalize_timestamp'
op|'('
name|'test_time'
op|')'
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'200'
op|')'
newline|'\n'
nl|'\n'
name|'orig_time'
op|'='
name|'object_server'
op|'.'
name|'time'
op|'.'
name|'time'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'t'
op|'='
name|'time'
op|'('
op|')'
newline|'\n'
name|'object_server'
op|'.'
name|'time'
op|'.'
name|'time'
op|'='
name|'lambda'
op|':'
name|'t'
newline|'\n'
name|'delete_at_timestamp'
op|'='
name|'int'
op|'('
name|'t'
op|'+'
number|'1'
op|')'
newline|'\n'
name|'delete_at_container'
op|'='
name|'str'
op|'('
nl|'\n'
name|'delete_at_timestamp'
op|'/'
nl|'\n'
name|'self'
op|'.'
name|'object_controller'
op|'.'
name|'expiring_objects_container_divisor'
op|'*'
nl|'\n'
name|'self'
op|'.'
name|'object_controller'
op|'.'
name|'expiring_objects_container_divisor'
op|')'
newline|'\n'
name|'put_timestamp'
op|'='
name|'normalize_timestamp'
op|'('
name|'test_time'
op|'-'
number|'1000'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'put_timestamp'
op|','
nl|'\n'
string|"'X-Delete-At'"
op|':'
name|'str'
op|'('
name|'delete_at_timestamp'
op|')'
op|','
nl|'\n'
string|"'X-Delete-At-Container'"
op|':'
name|'delete_at_container'
op|','
nl|'\n'
string|"'Content-Length'"
op|':'
string|"'4'"
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'application/octet-stream'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'body'
op|'='
string|"'TEST'"
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'201'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'GET'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'normalize_timestamp'
op|'('
name|'test_time'
op|')'
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'200'
op|')'
newline|'\n'
dedent|''
name|'finally'
op|':'
newline|'\n'
indent|'            '
name|'object_server'
op|'.'
name|'time'
op|'.'
name|'time'
op|'='
name|'orig_time'
newline|'\n'
nl|'\n'
dedent|''
name|'orig_time'
op|'='
name|'object_server'
op|'.'
name|'time'
op|'.'
name|'time'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'t'
op|'='
name|'time'
op|'('
op|')'
op|'+'
number|'2'
newline|'\n'
name|'object_server'
op|'.'
name|'time'
op|'.'
name|'time'
op|'='
name|'lambda'
op|':'
name|'t'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'GET'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'normalize_timestamp'
op|'('
name|'t'
op|')'
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'404'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'['
string|"'X-Backend-Timestamp'"
op|']'
op|','
nl|'\n'
name|'utils'
op|'.'
name|'Timestamp'
op|'('
name|'put_timestamp'
op|')'
op|')'
newline|'\n'
dedent|''
name|'finally'
op|':'
newline|'\n'
indent|'            '
name|'object_server'
op|'.'
name|'time'
op|'.'
name|'time'
op|'='
name|'orig_time'
newline|'\n'
nl|'\n'
DECL|member|test_HEAD_but_expired
dedent|''
dedent|''
name|'def'
name|'test_HEAD_but_expired'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'test_time'
op|'='
name|'time'
op|'('
op|')'
op|'+'
number|'10000'
newline|'\n'
name|'delete_at_timestamp'
op|'='
name|'int'
op|'('
name|'test_time'
op|'+'
number|'100'
op|')'
newline|'\n'
name|'delete_at_container'
op|'='
name|'str'
op|'('
nl|'\n'
name|'delete_at_timestamp'
op|'/'
nl|'\n'
name|'self'
op|'.'
name|'object_controller'
op|'.'
name|'expiring_objects_container_divisor'
op|'*'
nl|'\n'
name|'self'
op|'.'
name|'object_controller'
op|'.'
name|'expiring_objects_container_divisor'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'normalize_timestamp'
op|'('
name|'test_time'
op|'-'
number|'2000'
op|')'
op|','
nl|'\n'
string|"'X-Delete-At'"
op|':'
name|'str'
op|'('
name|'delete_at_timestamp'
op|')'
op|','
nl|'\n'
string|"'X-Delete-At-Container'"
op|':'
name|'delete_at_container'
op|','
nl|'\n'
string|"'Content-Length'"
op|':'
string|"'4'"
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'application/octet-stream'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'body'
op|'='
string|"'TEST'"
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'201'
op|')'
newline|'\n'
nl|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'HEAD'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'normalize_timestamp'
op|'('
name|'test_time'
op|')'
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'200'
op|')'
newline|'\n'
nl|'\n'
name|'orig_time'
op|'='
name|'object_server'
op|'.'
name|'time'
op|'.'
name|'time'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'t'
op|'='
name|'time'
op|'('
op|')'
newline|'\n'
name|'delete_at_timestamp'
op|'='
name|'int'
op|'('
name|'t'
op|'+'
number|'1'
op|')'
newline|'\n'
name|'delete_at_container'
op|'='
name|'str'
op|'('
nl|'\n'
name|'delete_at_timestamp'
op|'/'
nl|'\n'
name|'self'
op|'.'
name|'object_controller'
op|'.'
name|'expiring_objects_container_divisor'
op|'*'
nl|'\n'
name|'self'
op|'.'
name|'object_controller'
op|'.'
name|'expiring_objects_container_divisor'
op|')'
newline|'\n'
name|'object_server'
op|'.'
name|'time'
op|'.'
name|'time'
op|'='
name|'lambda'
op|':'
name|'t'
newline|'\n'
name|'put_timestamp'
op|'='
name|'normalize_timestamp'
op|'('
name|'test_time'
op|'-'
number|'1000'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'put_timestamp'
op|','
nl|'\n'
string|"'X-Delete-At'"
op|':'
name|'str'
op|'('
name|'delete_at_timestamp'
op|')'
op|','
nl|'\n'
string|"'X-Delete-At-Container'"
op|':'
name|'delete_at_container'
op|','
nl|'\n'
string|"'Content-Length'"
op|':'
string|"'4'"
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'application/octet-stream'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'body'
op|'='
string|"'TEST'"
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'201'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'HEAD'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'normalize_timestamp'
op|'('
name|'test_time'
op|')'
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'200'
op|')'
newline|'\n'
dedent|''
name|'finally'
op|':'
newline|'\n'
indent|'            '
name|'object_server'
op|'.'
name|'time'
op|'.'
name|'time'
op|'='
name|'orig_time'
newline|'\n'
nl|'\n'
dedent|''
name|'orig_time'
op|'='
name|'object_server'
op|'.'
name|'time'
op|'.'
name|'time'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'t'
op|'='
name|'time'
op|'('
op|')'
op|'+'
number|'2'
newline|'\n'
name|'object_server'
op|'.'
name|'time'
op|'.'
name|'time'
op|'='
name|'lambda'
op|':'
name|'t'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'HEAD'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'normalize_timestamp'
op|'('
name|'time'
op|'('
op|')'
op|')'
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'404'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'['
string|"'X-Backend-Timestamp'"
op|']'
op|','
nl|'\n'
name|'utils'
op|'.'
name|'Timestamp'
op|'('
name|'put_timestamp'
op|')'
op|')'
newline|'\n'
dedent|''
name|'finally'
op|':'
newline|'\n'
indent|'            '
name|'object_server'
op|'.'
name|'time'
op|'.'
name|'time'
op|'='
name|'orig_time'
newline|'\n'
nl|'\n'
DECL|member|test_POST_but_expired
dedent|''
dedent|''
name|'def'
name|'test_POST_but_expired'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'test_time'
op|'='
name|'time'
op|'('
op|')'
op|'+'
number|'10000'
newline|'\n'
name|'delete_at_timestamp'
op|'='
name|'int'
op|'('
name|'test_time'
op|'+'
number|'100'
op|')'
newline|'\n'
name|'delete_at_container'
op|'='
name|'str'
op|'('
nl|'\n'
name|'delete_at_timestamp'
op|'/'
nl|'\n'
name|'self'
op|'.'
name|'object_controller'
op|'.'
name|'expiring_objects_container_divisor'
op|'*'
nl|'\n'
name|'self'
op|'.'
name|'object_controller'
op|'.'
name|'expiring_objects_container_divisor'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'normalize_timestamp'
op|'('
name|'test_time'
op|'-'
number|'2000'
op|')'
op|','
nl|'\n'
string|"'X-Delete-At'"
op|':'
name|'str'
op|'('
name|'delete_at_timestamp'
op|')'
op|','
nl|'\n'
string|"'X-Delete-At-Container'"
op|':'
name|'delete_at_container'
op|','
nl|'\n'
string|"'Content-Length'"
op|':'
string|"'4'"
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'application/octet-stream'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'body'
op|'='
string|"'TEST'"
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'201'
op|')'
newline|'\n'
nl|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'POST'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'normalize_timestamp'
op|'('
name|'test_time'
op|'-'
number|'1500'
op|')'
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'202'
op|')'
newline|'\n'
nl|'\n'
name|'delete_at_timestamp'
op|'='
name|'int'
op|'('
name|'time'
op|'('
op|')'
op|'+'
number|'1'
op|')'
newline|'\n'
name|'delete_at_container'
op|'='
name|'str'
op|'('
nl|'\n'
name|'delete_at_timestamp'
op|'/'
nl|'\n'
name|'self'
op|'.'
name|'object_controller'
op|'.'
name|'expiring_objects_container_divisor'
op|'*'
nl|'\n'
name|'self'
op|'.'
name|'object_controller'
op|'.'
name|'expiring_objects_container_divisor'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'normalize_timestamp'
op|'('
name|'test_time'
op|'-'
number|'1000'
op|')'
op|','
nl|'\n'
string|"'X-Delete-At'"
op|':'
name|'str'
op|'('
name|'delete_at_timestamp'
op|')'
op|','
nl|'\n'
string|"'X-Delete-At-Container'"
op|':'
name|'delete_at_container'
op|','
nl|'\n'
string|"'Content-Length'"
op|':'
string|"'4'"
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'application/octet-stream'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'body'
op|'='
string|"'TEST'"
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'201'
op|')'
newline|'\n'
nl|'\n'
name|'orig_time'
op|'='
name|'object_server'
op|'.'
name|'time'
op|'.'
name|'time'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'t'
op|'='
name|'time'
op|'('
op|')'
op|'+'
number|'2'
newline|'\n'
name|'object_server'
op|'.'
name|'time'
op|'.'
name|'time'
op|'='
name|'lambda'
op|':'
name|'t'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'POST'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'normalize_timestamp'
op|'('
name|'time'
op|'('
op|')'
op|')'
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'404'
op|')'
newline|'\n'
dedent|''
name|'finally'
op|':'
newline|'\n'
indent|'            '
name|'object_server'
op|'.'
name|'time'
op|'.'
name|'time'
op|'='
name|'orig_time'
newline|'\n'
nl|'\n'
DECL|member|test_DELETE_but_expired
dedent|''
dedent|''
name|'def'
name|'test_DELETE_but_expired'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'test_time'
op|'='
name|'time'
op|'('
op|')'
op|'+'
number|'10000'
newline|'\n'
name|'delete_at_timestamp'
op|'='
name|'int'
op|'('
name|'test_time'
op|'+'
number|'100'
op|')'
newline|'\n'
name|'delete_at_container'
op|'='
name|'str'
op|'('
nl|'\n'
name|'delete_at_timestamp'
op|'/'
nl|'\n'
name|'self'
op|'.'
name|'object_controller'
op|'.'
name|'expiring_objects_container_divisor'
op|'*'
nl|'\n'
name|'self'
op|'.'
name|'object_controller'
op|'.'
name|'expiring_objects_container_divisor'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'normalize_timestamp'
op|'('
name|'test_time'
op|'-'
number|'2000'
op|')'
op|','
nl|'\n'
string|"'X-Delete-At'"
op|':'
name|'str'
op|'('
name|'delete_at_timestamp'
op|')'
op|','
nl|'\n'
string|"'X-Delete-At-Container'"
op|':'
name|'delete_at_container'
op|','
nl|'\n'
string|"'Content-Length'"
op|':'
string|"'4'"
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'application/octet-stream'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'body'
op|'='
string|"'TEST'"
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'201'
op|')'
newline|'\n'
nl|'\n'
name|'orig_time'
op|'='
name|'object_server'
op|'.'
name|'time'
op|'.'
name|'time'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'t'
op|'='
name|'test_time'
op|'+'
number|'100'
newline|'\n'
name|'object_server'
op|'.'
name|'time'
op|'.'
name|'time'
op|'='
name|'lambda'
op|':'
name|'float'
op|'('
name|'t'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'DELETE'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'normalize_timestamp'
op|'('
name|'time'
op|'('
op|')'
op|')'
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'404'
op|')'
newline|'\n'
dedent|''
name|'finally'
op|':'
newline|'\n'
indent|'            '
name|'object_server'
op|'.'
name|'time'
op|'.'
name|'time'
op|'='
name|'orig_time'
newline|'\n'
nl|'\n'
DECL|member|test_DELETE_if_delete_at_expired_still_deletes
dedent|''
dedent|''
name|'def'
name|'test_DELETE_if_delete_at_expired_still_deletes'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'test_time'
op|'='
name|'time'
op|'('
op|')'
op|'+'
number|'10'
newline|'\n'
name|'test_timestamp'
op|'='
name|'normalize_timestamp'
op|'('
name|'test_time'
op|')'
newline|'\n'
name|'delete_at_time'
op|'='
name|'int'
op|'('
name|'test_time'
op|'+'
number|'10'
op|')'
newline|'\n'
name|'delete_at_timestamp'
op|'='
name|'str'
op|'('
name|'delete_at_time'
op|')'
newline|'\n'
name|'delete_at_container'
op|'='
name|'str'
op|'('
nl|'\n'
name|'delete_at_time'
op|'/'
nl|'\n'
name|'self'
op|'.'
name|'object_controller'
op|'.'
name|'expiring_objects_container_divisor'
op|'*'
nl|'\n'
name|'self'
op|'.'
name|'object_controller'
op|'.'
name|'expiring_objects_container_divisor'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'test_timestamp'
op|','
nl|'\n'
string|"'X-Delete-At'"
op|':'
name|'delete_at_timestamp'
op|','
nl|'\n'
string|"'X-Delete-At-Container'"
op|':'
name|'delete_at_container'
op|','
nl|'\n'
string|"'Content-Length'"
op|':'
string|"'4'"
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'application/octet-stream'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'body'
op|'='
string|"'TEST'"
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'201'
op|')'
newline|'\n'
nl|'\n'
comment|'# sanity'
nl|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'GET'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'test_timestamp'
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'200'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'body'
op|','
string|"'TEST'"
op|')'
newline|'\n'
name|'objfile'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'testdir'
op|','
string|"'sda1'"
op|','
nl|'\n'
name|'storage_directory'
op|'('
name|'diskfile'
op|'.'
name|'get_data_dir'
op|'('
name|'POLICIES'
op|'['
number|'0'
op|']'
op|')'
op|','
string|"'p'"
op|','
nl|'\n'
name|'hash_path'
op|'('
string|"'a'"
op|','
string|"'c'"
op|','
string|"'o'"
op|')'
op|')'
op|','
nl|'\n'
name|'utils'
op|'.'
name|'Timestamp'
op|'('
name|'test_timestamp'
op|')'
op|'.'
name|'internal'
op|'+'
string|"'.data'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'isfile'
op|'('
name|'objfile'
op|')'
op|')'
newline|'\n'
nl|'\n'
comment|'# move time past expirery'
nl|'\n'
name|'with'
name|'mock'
op|'.'
name|'patch'
op|'('
string|"'swift.obj.diskfile.time'"
op|')'
name|'as'
name|'mock_time'
op|':'
newline|'\n'
indent|'            '
name|'mock_time'
op|'.'
name|'time'
op|'.'
name|'return_value'
op|'='
name|'test_time'
op|'+'
number|'100'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'GET'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'test_timestamp'
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
comment|'# request will 404'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'404'
op|')'
newline|'\n'
comment|'# but file still exists'
nl|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'isfile'
op|'('
name|'objfile'
op|')'
op|')'
newline|'\n'
nl|'\n'
comment|'# make the x-if-delete-at with some wrong bits'
nl|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'DELETE'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'delete_at_timestamp'
op|','
nl|'\n'
string|"'X-If-Delete-At'"
op|':'
name|'int'
op|'('
name|'time'
op|'('
op|')'
op|'+'
number|'1'
op|')'
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'412'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'isfile'
op|'('
name|'objfile'
op|')'
op|')'
newline|'\n'
nl|'\n'
comment|'# make the x-if-delete-at with all the right bits'
nl|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'DELETE'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'delete_at_timestamp'
op|','
nl|'\n'
string|"'X-If-Delete-At'"
op|':'
name|'delete_at_timestamp'
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'204'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'isfile'
op|'('
name|'objfile'
op|')'
op|')'
newline|'\n'
nl|'\n'
comment|'# make the x-if-delete-at with all the right bits (again)'
nl|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'DELETE'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'delete_at_timestamp'
op|','
nl|'\n'
string|"'X-If-Delete-At'"
op|':'
name|'delete_at_timestamp'
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'412'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'isfile'
op|'('
name|'objfile'
op|')'
op|')'
newline|'\n'
nl|'\n'
comment|'# make the x-if-delete-at for some not found'
nl|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o-not-found'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'DELETE'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'delete_at_timestamp'
op|','
nl|'\n'
string|"'X-If-Delete-At'"
op|':'
name|'delete_at_timestamp'
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'404'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_DELETE_if_delete_at
dedent|''
dedent|''
name|'def'
name|'test_DELETE_if_delete_at'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'test_time'
op|'='
name|'time'
op|'('
op|')'
op|'+'
number|'10000'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'normalize_timestamp'
op|'('
name|'test_time'
op|'-'
number|'99'
op|')'
op|','
nl|'\n'
string|"'Content-Length'"
op|':'
string|"'4'"
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'application/octet-stream'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'body'
op|'='
string|"'TEST'"
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'201'
op|')'
newline|'\n'
nl|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'DELETE'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'normalize_timestamp'
op|'('
name|'test_time'
op|'-'
number|'98'
op|')'
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'204'
op|')'
newline|'\n'
nl|'\n'
name|'delete_at_timestamp'
op|'='
name|'int'
op|'('
name|'test_time'
op|'-'
number|'1'
op|')'
newline|'\n'
name|'delete_at_container'
op|'='
name|'str'
op|'('
nl|'\n'
name|'delete_at_timestamp'
op|'/'
nl|'\n'
name|'self'
op|'.'
name|'object_controller'
op|'.'
name|'expiring_objects_container_divisor'
op|'*'
nl|'\n'
name|'self'
op|'.'
name|'object_controller'
op|'.'
name|'expiring_objects_container_divisor'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'normalize_timestamp'
op|'('
name|'test_time'
op|'-'
number|'97'
op|')'
op|','
nl|'\n'
string|"'X-Delete-At'"
op|':'
name|'str'
op|'('
name|'delete_at_timestamp'
op|')'
op|','
nl|'\n'
string|"'X-Delete-At-Container'"
op|':'
name|'delete_at_container'
op|','
nl|'\n'
string|"'Content-Length'"
op|':'
string|"'4'"
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'application/octet-stream'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'body'
op|'='
string|"'TEST'"
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'201'
op|')'
newline|'\n'
nl|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'DELETE'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'normalize_timestamp'
op|'('
name|'test_time'
op|'-'
number|'95'
op|')'
op|','
nl|'\n'
string|"'X-If-Delete-At'"
op|':'
name|'str'
op|'('
name|'int'
op|'('
name|'test_time'
op|')'
op|')'
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'412'
op|')'
newline|'\n'
nl|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'DELETE'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'normalize_timestamp'
op|'('
name|'test_time'
op|'-'
number|'95'
op|')'
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'204'
op|')'
newline|'\n'
nl|'\n'
name|'delete_at_timestamp'
op|'='
name|'int'
op|'('
name|'test_time'
op|'-'
number|'1'
op|')'
newline|'\n'
name|'delete_at_container'
op|'='
name|'str'
op|'('
nl|'\n'
name|'delete_at_timestamp'
op|'/'
nl|'\n'
name|'self'
op|'.'
name|'object_controller'
op|'.'
name|'expiring_objects_container_divisor'
op|'*'
nl|'\n'
name|'self'
op|'.'
name|'object_controller'
op|'.'
name|'expiring_objects_container_divisor'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'normalize_timestamp'
op|'('
name|'test_time'
op|'-'
number|'94'
op|')'
op|','
nl|'\n'
string|"'X-Delete-At'"
op|':'
name|'str'
op|'('
name|'delete_at_timestamp'
op|')'
op|','
nl|'\n'
string|"'X-Delete-At-Container'"
op|':'
name|'delete_at_container'
op|','
nl|'\n'
string|"'Content-Length'"
op|':'
string|"'4'"
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'application/octet-stream'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'body'
op|'='
string|"'TEST'"
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'201'
op|')'
newline|'\n'
nl|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'DELETE'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'normalize_timestamp'
op|'('
name|'test_time'
op|'-'
number|'92'
op|')'
op|','
nl|'\n'
string|"'X-If-Delete-At'"
op|':'
name|'str'
op|'('
name|'int'
op|'('
name|'test_time'
op|')'
op|')'
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'412'
op|')'
newline|'\n'
nl|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'DELETE'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'normalize_timestamp'
op|'('
name|'test_time'
op|'-'
number|'92'
op|')'
op|','
nl|'\n'
string|"'X-If-Delete-At'"
op|':'
name|'delete_at_timestamp'
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'204'
op|')'
newline|'\n'
nl|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'DELETE'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'normalize_timestamp'
op|'('
name|'test_time'
op|'-'
number|'92'
op|')'
op|','
nl|'\n'
string|"'X-If-Delete-At'"
op|':'
string|"'abc'"
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'400'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_DELETE_calls_delete_at
dedent|''
name|'def'
name|'test_DELETE_calls_delete_at'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'given_args'
op|'='
op|'['
op|']'
newline|'\n'
nl|'\n'
DECL|function|fake_delete_at_update
name|'def'
name|'fake_delete_at_update'
op|'('
op|'*'
name|'args'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'given_args'
op|'.'
name|'extend'
op|'('
name|'args'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'object_controller'
op|'.'
name|'delete_at_update'
op|'='
name|'fake_delete_at_update'
newline|'\n'
name|'timestamp1'
op|'='
name|'normalize_timestamp'
op|'('
name|'time'
op|'('
op|')'
op|')'
newline|'\n'
name|'delete_at_timestamp1'
op|'='
name|'int'
op|'('
name|'time'
op|'('
op|')'
op|'+'
number|'1000'
op|')'
newline|'\n'
name|'delete_at_container1'
op|'='
name|'str'
op|'('
nl|'\n'
name|'delete_at_timestamp1'
op|'/'
nl|'\n'
name|'self'
op|'.'
name|'object_controller'
op|'.'
name|'expiring_objects_container_divisor'
op|'*'
nl|'\n'
name|'self'
op|'.'
name|'object_controller'
op|'.'
name|'expiring_objects_container_divisor'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'timestamp1'
op|','
nl|'\n'
string|"'Content-Length'"
op|':'
string|"'4'"
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'application/octet-stream'"
op|','
nl|'\n'
string|"'X-Delete-At'"
op|':'
name|'str'
op|'('
name|'delete_at_timestamp1'
op|')'
op|','
nl|'\n'
string|"'X-Delete-At-Container'"
op|':'
name|'delete_at_container1'
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'body'
op|'='
string|"'TEST'"
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'201'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'given_args'
op|','
op|'['
nl|'\n'
string|"'PUT'"
op|','
name|'int'
op|'('
name|'delete_at_timestamp1'
op|')'
op|','
string|"'a'"
op|','
string|"'c'"
op|','
string|"'o'"
op|','
nl|'\n'
name|'given_args'
op|'['
number|'5'
op|']'
op|','
string|"'sda1'"
op|','
name|'POLICIES'
op|'['
number|'0'
op|']'
op|']'
op|')'
newline|'\n'
nl|'\n'
name|'while'
name|'given_args'
op|':'
newline|'\n'
indent|'            '
name|'given_args'
op|'.'
name|'pop'
op|'('
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'sleep'
op|'('
number|'.00001'
op|')'
newline|'\n'
name|'timestamp2'
op|'='
name|'normalize_timestamp'
op|'('
name|'time'
op|'('
op|')'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'DELETE'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'timestamp2'
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'application/octet-stream'"
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'204'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'given_args'
op|','
op|'['
nl|'\n'
string|"'DELETE'"
op|','
name|'int'
op|'('
name|'delete_at_timestamp1'
op|')'
op|','
string|"'a'"
op|','
string|"'c'"
op|','
string|"'o'"
op|','
nl|'\n'
name|'given_args'
op|'['
number|'5'
op|']'
op|','
string|"'sda1'"
op|','
name|'POLICIES'
op|'['
number|'0'
op|']'
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_PUT_delete_at_in_past
dedent|''
name|'def'
name|'test_PUT_delete_at_in_past'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'normalize_timestamp'
op|'('
name|'time'
op|'('
op|')'
op|')'
op|','
nl|'\n'
string|"'X-Delete-At'"
op|':'
name|'str'
op|'('
name|'int'
op|'('
name|'time'
op|'('
op|')'
op|'-'
number|'1'
op|')'
op|')'
op|','
nl|'\n'
string|"'Content-Length'"
op|':'
string|"'4'"
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'application/octet-stream'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'body'
op|'='
string|"'TEST'"
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'400'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
string|"'X-Delete-At in past'"
name|'in'
name|'resp'
op|'.'
name|'body'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_POST_delete_at_in_past
dedent|''
name|'def'
name|'test_POST_delete_at_in_past'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'normalize_timestamp'
op|'('
name|'time'
op|'('
op|')'
op|')'
op|','
nl|'\n'
string|"'Content-Length'"
op|':'
string|"'4'"
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'application/octet-stream'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'body'
op|'='
string|"'TEST'"
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'201'
op|')'
newline|'\n'
nl|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'POST'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'normalize_timestamp'
op|'('
name|'time'
op|'('
op|')'
op|'+'
number|'1'
op|')'
op|','
nl|'\n'
string|"'X-Delete-At'"
op|':'
name|'str'
op|'('
name|'int'
op|'('
name|'time'
op|'('
op|')'
op|'-'
number|'1'
op|')'
op|')'
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'400'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
string|"'X-Delete-At in past'"
name|'in'
name|'resp'
op|'.'
name|'body'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_REPLICATE_works
dedent|''
name|'def'
name|'test_REPLICATE_works'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|function|fake_get_hashes
indent|'        '
name|'def'
name|'fake_get_hashes'
op|'('
op|'*'
name|'args'
op|','
op|'**'
name|'kwargs'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'return'
number|'0'
op|','
op|'{'
number|'1'
op|':'
number|'2'
op|'}'
newline|'\n'
nl|'\n'
DECL|function|my_tpool_execute
dedent|''
name|'def'
name|'my_tpool_execute'
op|'('
name|'func'
op|','
op|'*'
name|'args'
op|','
op|'**'
name|'kwargs'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'return'
name|'func'
op|'('
op|'*'
name|'args'
op|','
op|'**'
name|'kwargs'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'was_get_hashes'
op|'='
name|'diskfile'
op|'.'
name|'DiskFileManager'
op|'.'
name|'_get_hashes'
newline|'\n'
name|'was_tpool_exe'
op|'='
name|'tpool'
op|'.'
name|'execute'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'diskfile'
op|'.'
name|'DiskFileManager'
op|'.'
name|'_get_hashes'
op|'='
name|'fake_get_hashes'
newline|'\n'
name|'tpool'
op|'.'
name|'execute'
op|'='
name|'my_tpool_execute'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/suff'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'REPLICATE'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'200'
op|')'
newline|'\n'
name|'p_data'
op|'='
name|'pickle'
op|'.'
name|'loads'
op|'('
name|'resp'
op|'.'
name|'body'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'p_data'
op|','
op|'{'
number|'1'
op|':'
number|'2'
op|'}'
op|')'
newline|'\n'
dedent|''
name|'finally'
op|':'
newline|'\n'
indent|'            '
name|'tpool'
op|'.'
name|'execute'
op|'='
name|'was_tpool_exe'
newline|'\n'
name|'diskfile'
op|'.'
name|'DiskFileManager'
op|'.'
name|'_get_hashes'
op|'='
name|'was_get_hashes'
newline|'\n'
nl|'\n'
DECL|member|test_REPLICATE_timeout
dedent|''
dedent|''
name|'def'
name|'test_REPLICATE_timeout'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|function|fake_get_hashes
indent|'        '
name|'def'
name|'fake_get_hashes'
op|'('
op|'*'
name|'args'
op|','
op|'**'
name|'kwargs'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'Timeout'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|function|my_tpool_execute
dedent|''
name|'def'
name|'my_tpool_execute'
op|'('
name|'func'
op|','
op|'*'
name|'args'
op|','
op|'**'
name|'kwargs'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'return'
name|'func'
op|'('
op|'*'
name|'args'
op|','
op|'**'
name|'kwargs'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'was_get_hashes'
op|'='
name|'diskfile'
op|'.'
name|'DiskFileManager'
op|'.'
name|'_get_hashes'
newline|'\n'
name|'was_tpool_exe'
op|'='
name|'tpool'
op|'.'
name|'execute'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'diskfile'
op|'.'
name|'DiskFileManager'
op|'.'
name|'_get_hashes'
op|'='
name|'fake_get_hashes'
newline|'\n'
name|'tpool'
op|'.'
name|'execute'
op|'='
name|'my_tpool_execute'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/suff'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'REPLICATE'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'Timeout'
op|','
name|'self'
op|'.'
name|'object_controller'
op|'.'
name|'REPLICATE'
op|','
name|'req'
op|')'
newline|'\n'
dedent|''
name|'finally'
op|':'
newline|'\n'
indent|'            '
name|'tpool'
op|'.'
name|'execute'
op|'='
name|'was_tpool_exe'
newline|'\n'
name|'diskfile'
op|'.'
name|'DiskFileManager'
op|'.'
name|'_get_hashes'
op|'='
name|'was_get_hashes'
newline|'\n'
nl|'\n'
DECL|member|test_REPLICATE_insufficient_storage
dedent|''
dedent|''
name|'def'
name|'test_REPLICATE_insufficient_storage'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'conf'
op|'='
op|'{'
string|"'devices'"
op|':'
name|'self'
op|'.'
name|'testdir'
op|','
string|"'mount_check'"
op|':'
string|"'true'"
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'object_controller'
op|'='
name|'object_server'
op|'.'
name|'ObjectController'
op|'('
nl|'\n'
name|'conf'
op|','
name|'logger'
op|'='
name|'debug_logger'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'object_controller'
op|'.'
name|'bytes_per_sync'
op|'='
number|'1'
newline|'\n'
nl|'\n'
DECL|function|fake_check_mount
name|'def'
name|'fake_check_mount'
op|'('
op|'*'
name|'args'
op|','
op|'**'
name|'kwargs'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'return'
name|'False'
newline|'\n'
nl|'\n'
dedent|''
name|'with'
name|'mock'
op|'.'
name|'patch'
op|'('
string|'"swift.obj.diskfile.check_mount"'
op|','
name|'fake_check_mount'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/suff'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'REPLICATE'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'507'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_SSYNC_can_be_called
dedent|''
name|'def'
name|'test_SSYNC_can_be_called'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/0'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'SSYNC'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'200'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_PUT_with_full_drive
dedent|''
name|'def'
name|'test_PUT_with_full_drive'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|class|IgnoredBody
indent|'        '
name|'class'
name|'IgnoredBody'
op|'('
name|'object'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|member|__init__
indent|'            '
name|'def'
name|'__init__'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'read_called'
op|'='
name|'False'
newline|'\n'
nl|'\n'
DECL|member|read
dedent|''
name|'def'
name|'read'
op|'('
name|'self'
op|','
name|'size'
op|'='
op|'-'
number|'1'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'if'
name|'not'
name|'self'
op|'.'
name|'read_called'
op|':'
newline|'\n'
indent|'                    '
name|'self'
op|'.'
name|'read_called'
op|'='
name|'True'
newline|'\n'
name|'return'
string|"'VERIFY'"
newline|'\n'
dedent|''
name|'return'
string|"''"
newline|'\n'
nl|'\n'
DECL|function|fake_fallocate
dedent|''
dedent|''
name|'def'
name|'fake_fallocate'
op|'('
name|'fd'
op|','
name|'size'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'OSError'
op|'('
name|'errno'
op|'.'
name|'ENOSPC'
op|','
name|'os'
op|'.'
name|'strerror'
op|'('
name|'errno'
op|'.'
name|'ENOSPC'
op|')'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'orig_fallocate'
op|'='
name|'diskfile'
op|'.'
name|'fallocate'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'diskfile'
op|'.'
name|'fallocate'
op|'='
name|'fake_fallocate'
newline|'\n'
name|'timestamp'
op|'='
name|'normalize_timestamp'
op|'('
name|'time'
op|'('
op|')'
op|')'
newline|'\n'
name|'body_reader'
op|'='
name|'IgnoredBody'
op|'('
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|','
nl|'\n'
string|"'wsgi.input'"
op|':'
name|'body_reader'
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'timestamp'
op|','
nl|'\n'
string|"'Content-Length'"
op|':'
string|"'6'"
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'application/octet-stream'"
op|','
nl|'\n'
string|"'Expect'"
op|':'
string|"'100-continue'"
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'507'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'body_reader'
op|'.'
name|'read_called'
op|')'
newline|'\n'
dedent|''
name|'finally'
op|':'
newline|'\n'
indent|'            '
name|'diskfile'
op|'.'
name|'fallocate'
op|'='
name|'orig_fallocate'
newline|'\n'
nl|'\n'
DECL|member|test_global_conf_callback_does_nothing
dedent|''
dedent|''
name|'def'
name|'test_global_conf_callback_does_nothing'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'preloaded_app_conf'
op|'='
op|'{'
op|'}'
newline|'\n'
name|'global_conf'
op|'='
op|'{'
op|'}'
newline|'\n'
name|'object_server'
op|'.'
name|'global_conf_callback'
op|'('
name|'preloaded_app_conf'
op|','
name|'global_conf'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'preloaded_app_conf'
op|','
op|'{'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'global_conf'
op|'.'
name|'keys'
op|'('
op|')'
op|','
op|'['
string|"'replication_semaphore'"
op|']'
op|')'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'value'
op|'='
name|'global_conf'
op|'['
string|"'replication_semaphore'"
op|']'
op|'['
number|'0'
op|']'
op|'.'
name|'get_value'
op|'('
op|')'
newline|'\n'
dedent|''
name|'except'
name|'NotImplementedError'
op|':'
newline|'\n'
comment|"# On some operating systems (at a minimum, OS X) it's not possible"
nl|'\n'
comment|'# to introspect the value of a semaphore'
nl|'\n'
indent|'            '
name|'raise'
name|'SkipTest'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'value'
op|','
number|'4'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_global_conf_callback_replication_semaphore
dedent|''
dedent|''
name|'def'
name|'test_global_conf_callback_replication_semaphore'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'preloaded_app_conf'
op|'='
op|'{'
string|"'replication_concurrency'"
op|':'
number|'123'
op|'}'
newline|'\n'
name|'global_conf'
op|'='
op|'{'
op|'}'
newline|'\n'
name|'with'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
nl|'\n'
name|'object_server'
op|'.'
name|'multiprocessing'
op|','
string|"'BoundedSemaphore'"
op|','
nl|'\n'
name|'return_value'
op|'='
string|"'test1'"
op|')'
name|'as'
name|'mocked_Semaphore'
op|':'
newline|'\n'
indent|'            '
name|'object_server'
op|'.'
name|'global_conf_callback'
op|'('
name|'preloaded_app_conf'
op|','
name|'global_conf'
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'preloaded_app_conf'
op|','
op|'{'
string|"'replication_concurrency'"
op|':'
number|'123'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'global_conf'
op|','
op|'{'
string|"'replication_semaphore'"
op|':'
op|'['
string|"'test1'"
op|']'
op|'}'
op|')'
newline|'\n'
name|'mocked_Semaphore'
op|'.'
name|'assert_called_once_with'
op|'('
number|'123'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_handling_of_replication_semaphore_config
dedent|''
name|'def'
name|'test_handling_of_replication_semaphore_config'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'conf'
op|'='
op|'{'
string|"'devices'"
op|':'
name|'self'
op|'.'
name|'testdir'
op|','
string|"'mount_check'"
op|':'
string|"'false'"
op|'}'
newline|'\n'
name|'objsrv'
op|'='
name|'object_server'
op|'.'
name|'ObjectController'
op|'('
name|'conf'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'objsrv'
op|'.'
name|'replication_semaphore'
name|'is'
name|'None'
op|')'
newline|'\n'
name|'conf'
op|'['
string|"'replication_semaphore'"
op|']'
op|'='
op|'['
string|"'sema'"
op|']'
newline|'\n'
name|'objsrv'
op|'='
name|'object_server'
op|'.'
name|'ObjectController'
op|'('
name|'conf'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'objsrv'
op|'.'
name|'replication_semaphore'
op|','
string|"'sema'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_serv_reserv
dedent|''
name|'def'
name|'test_serv_reserv'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# Test replication_server flag was set from configuration file.'
nl|'\n'
indent|'        '
name|'conf'
op|'='
op|'{'
string|"'devices'"
op|':'
name|'self'
op|'.'
name|'testdir'
op|','
string|"'mount_check'"
op|':'
string|"'false'"
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
nl|'\n'
name|'object_server'
op|'.'
name|'ObjectController'
op|'('
name|'conf'
op|')'
op|'.'
name|'replication_server'
op|','
name|'None'
op|')'
newline|'\n'
name|'for'
name|'val'
name|'in'
op|'['
name|'True'
op|','
string|"'1'"
op|','
string|"'True'"
op|','
string|"'true'"
op|']'
op|':'
newline|'\n'
indent|'            '
name|'conf'
op|'['
string|"'replication_server'"
op|']'
op|'='
name|'val'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
nl|'\n'
name|'object_server'
op|'.'
name|'ObjectController'
op|'('
name|'conf'
op|')'
op|'.'
name|'replication_server'
op|')'
newline|'\n'
dedent|''
name|'for'
name|'val'
name|'in'
op|'['
name|'False'
op|','
number|'0'
op|','
string|"'0'"
op|','
string|"'False'"
op|','
string|"'false'"
op|','
string|"'test_string'"
op|']'
op|':'
newline|'\n'
indent|'            '
name|'conf'
op|'['
string|"'replication_server'"
op|']'
op|'='
name|'val'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
nl|'\n'
name|'object_server'
op|'.'
name|'ObjectController'
op|'('
name|'conf'
op|')'
op|'.'
name|'replication_server'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_list_allowed_methods
dedent|''
dedent|''
name|'def'
name|'test_list_allowed_methods'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# Test list of allowed_methods'
nl|'\n'
indent|'        '
name|'obj_methods'
op|'='
op|'['
string|"'DELETE'"
op|','
string|"'PUT'"
op|','
string|"'HEAD'"
op|','
string|"'GET'"
op|','
string|"'POST'"
op|']'
newline|'\n'
name|'repl_methods'
op|'='
op|'['
string|"'REPLICATE'"
op|','
string|"'SSYNC'"
op|']'
newline|'\n'
name|'for'
name|'method_name'
name|'in'
name|'obj_methods'
op|':'
newline|'\n'
indent|'            '
name|'method'
op|'='
name|'getattr'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|','
name|'method_name'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'hasattr'
op|'('
name|'method'
op|','
string|"'replication'"
op|')'
op|')'
newline|'\n'
dedent|''
name|'for'
name|'method_name'
name|'in'
name|'repl_methods'
op|':'
newline|'\n'
indent|'            '
name|'method'
op|'='
name|'getattr'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|','
name|'method_name'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'method'
op|'.'
name|'replication'
op|','
name|'True'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_correct_allowed_method
dedent|''
dedent|''
name|'def'
name|'test_correct_allowed_method'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# Test correct work for allowed method using'
nl|'\n'
comment|'# swift.obj.server.ObjectController.__call__'
nl|'\n'
indent|'        '
name|'inbuf'
op|'='
name|'WsgiBytesIO'
op|'('
op|')'
newline|'\n'
name|'errbuf'
op|'='
name|'StringIO'
op|'('
op|')'
newline|'\n'
name|'outbuf'
op|'='
name|'StringIO'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'object_controller'
op|'='
name|'object_server'
op|'.'
name|'app_factory'
op|'('
nl|'\n'
op|'{'
string|"'devices'"
op|':'
name|'self'
op|'.'
name|'testdir'
op|','
string|"'mount_check'"
op|':'
string|"'false'"
op|','
nl|'\n'
string|"'replication_server'"
op|':'
string|"'false'"
op|'}'
op|')'
newline|'\n'
nl|'\n'
DECL|function|start_response
name|'def'
name|'start_response'
op|'('
op|'*'
name|'args'
op|')'
op|':'
newline|'\n'
comment|'# Sends args to outbuf'
nl|'\n'
indent|'            '
name|'outbuf'
op|'.'
name|'writelines'
op|'('
name|'args'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'method'
op|'='
string|"'PUT'"
newline|'\n'
name|'env'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
name|'method'
op|','
nl|'\n'
string|"'SCRIPT_NAME'"
op|':'
string|"''"
op|','
nl|'\n'
string|"'PATH_INFO'"
op|':'
string|"'/sda1/p/a/c/o'"
op|','
nl|'\n'
string|"'SERVER_NAME'"
op|':'
string|"'127.0.0.1'"
op|','
nl|'\n'
string|"'SERVER_PORT'"
op|':'
string|"'8080'"
op|','
nl|'\n'
string|"'SERVER_PROTOCOL'"
op|':'
string|"'HTTP/1.0'"
op|','
nl|'\n'
string|"'CONTENT_LENGTH'"
op|':'
string|"'0'"
op|','
nl|'\n'
string|"'wsgi.version'"
op|':'
op|'('
number|'1'
op|','
number|'0'
op|')'
op|','
nl|'\n'
string|"'wsgi.url_scheme'"
op|':'
string|"'http'"
op|','
nl|'\n'
string|"'wsgi.input'"
op|':'
name|'inbuf'
op|','
nl|'\n'
string|"'wsgi.errors'"
op|':'
name|'errbuf'
op|','
nl|'\n'
string|"'wsgi.multithread'"
op|':'
name|'False'
op|','
nl|'\n'
string|"'wsgi.multiprocess'"
op|':'
name|'False'
op|','
nl|'\n'
string|"'wsgi.run_once'"
op|':'
name|'False'
op|'}'
newline|'\n'
nl|'\n'
name|'method_res'
op|'='
name|'mock'
op|'.'
name|'MagicMock'
op|'('
op|')'
newline|'\n'
name|'mock_method'
op|'='
name|'public'
op|'('
name|'lambda'
name|'x'
op|':'
nl|'\n'
name|'mock'
op|'.'
name|'MagicMock'
op|'('
name|'return_value'
op|'='
name|'method_res'
op|')'
op|')'
newline|'\n'
name|'with'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|','
name|'method'
op|','
nl|'\n'
name|'new'
op|'='
name|'mock_method'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'response'
op|'='
name|'self'
op|'.'
name|'object_controller'
op|'('
name|'env'
op|','
name|'start_response'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'response'
op|','
name|'method_res'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_not_allowed_method
dedent|''
dedent|''
name|'def'
name|'test_not_allowed_method'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# Test correct work for NOT allowed method using'
nl|'\n'
comment|'# swift.obj.server.ObjectController.__call__'
nl|'\n'
indent|'        '
name|'inbuf'
op|'='
name|'WsgiBytesIO'
op|'('
op|')'
newline|'\n'
name|'errbuf'
op|'='
name|'StringIO'
op|'('
op|')'
newline|'\n'
name|'outbuf'
op|'='
name|'StringIO'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'object_controller'
op|'='
name|'object_server'
op|'.'
name|'ObjectController'
op|'('
nl|'\n'
op|'{'
string|"'devices'"
op|':'
name|'self'
op|'.'
name|'testdir'
op|','
string|"'mount_check'"
op|':'
string|"'false'"
op|','
nl|'\n'
string|"'replication_server'"
op|':'
string|"'false'"
op|'}'
op|','
name|'logger'
op|'='
name|'self'
op|'.'
name|'logger'
op|')'
newline|'\n'
nl|'\n'
DECL|function|start_response
name|'def'
name|'start_response'
op|'('
op|'*'
name|'args'
op|')'
op|':'
newline|'\n'
comment|'# Sends args to outbuf'
nl|'\n'
indent|'            '
name|'outbuf'
op|'.'
name|'writelines'
op|'('
name|'args'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'method'
op|'='
string|"'PUT'"
newline|'\n'
nl|'\n'
name|'env'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
name|'method'
op|','
nl|'\n'
string|"'SCRIPT_NAME'"
op|':'
string|"''"
op|','
nl|'\n'
string|"'PATH_INFO'"
op|':'
string|"'/sda1/p/a/c/o'"
op|','
nl|'\n'
string|"'SERVER_NAME'"
op|':'
string|"'127.0.0.1'"
op|','
nl|'\n'
string|"'SERVER_PORT'"
op|':'
string|"'8080'"
op|','
nl|'\n'
string|"'SERVER_PROTOCOL'"
op|':'
string|"'HTTP/1.0'"
op|','
nl|'\n'
string|"'CONTENT_LENGTH'"
op|':'
string|"'0'"
op|','
nl|'\n'
string|"'wsgi.version'"
op|':'
op|'('
number|'1'
op|','
number|'0'
op|')'
op|','
nl|'\n'
string|"'wsgi.url_scheme'"
op|':'
string|"'http'"
op|','
nl|'\n'
string|"'wsgi.input'"
op|':'
name|'inbuf'
op|','
nl|'\n'
string|"'wsgi.errors'"
op|':'
name|'errbuf'
op|','
nl|'\n'
string|"'wsgi.multithread'"
op|':'
name|'False'
op|','
nl|'\n'
string|"'wsgi.multiprocess'"
op|':'
name|'False'
op|','
nl|'\n'
string|"'wsgi.run_once'"
op|':'
name|'False'
op|'}'
newline|'\n'
nl|'\n'
name|'answer'
op|'='
op|'['
string|"'<html><h1>Method Not Allowed</h1><p>The method is not '"
nl|'\n'
string|"'allowed for this resource.</p></html>'"
op|']'
newline|'\n'
name|'mock_method'
op|'='
name|'replication'
op|'('
name|'public'
op|'('
name|'lambda'
name|'x'
op|':'
name|'mock'
op|'.'
name|'MagicMock'
op|'('
op|')'
op|')'
op|')'
newline|'\n'
name|'with'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|','
name|'method'
op|','
nl|'\n'
name|'new'
op|'='
name|'mock_method'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'mock_method'
op|'.'
name|'replication'
op|'='
name|'True'
newline|'\n'
name|'with'
name|'mock'
op|'.'
name|'patch'
op|'('
string|"'time.gmtime'"
op|','
nl|'\n'
name|'mock'
op|'.'
name|'MagicMock'
op|'('
name|'side_effect'
op|'='
op|'['
name|'gmtime'
op|'('
number|'10001.0'
op|')'
op|']'
op|')'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'with'
name|'mock'
op|'.'
name|'patch'
op|'('
string|"'time.time'"
op|','
nl|'\n'
name|'mock'
op|'.'
name|'MagicMock'
op|'('
name|'side_effect'
op|'='
op|'['
number|'10000.0'
op|','
nl|'\n'
number|'10001.0'
op|']'
op|')'
op|')'
op|':'
newline|'\n'
indent|'                    '
name|'with'
name|'mock'
op|'.'
name|'patch'
op|'('
string|"'os.getpid'"
op|','
nl|'\n'
name|'mock'
op|'.'
name|'MagicMock'
op|'('
name|'return_value'
op|'='
number|'1234'
op|')'
op|')'
op|':'
newline|'\n'
indent|'                        '
name|'response'
op|'='
name|'self'
op|'.'
name|'object_controller'
op|'.'
name|'__call__'
op|'('
nl|'\n'
name|'env'
op|','
name|'start_response'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'response'
op|','
name|'answer'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'logger'
op|'.'
name|'get_lines_for_level'
op|'('
string|"'info'"
op|')'
op|','
nl|'\n'
op|'['
string|'\'None - - [01/Jan/1970:02:46:41 +0000] "PUT\''
nl|'\n'
string|'\' /sda1/p/a/c/o" 405 - "-" "-" "-" 1.0000 "-"\''
nl|'\n'
string|"' 1234 -'"
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_call_incorrect_replication_method
dedent|''
dedent|''
dedent|''
dedent|''
dedent|''
name|'def'
name|'test_call_incorrect_replication_method'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'inbuf'
op|'='
name|'StringIO'
op|'('
op|')'
newline|'\n'
name|'errbuf'
op|'='
name|'StringIO'
op|'('
op|')'
newline|'\n'
name|'outbuf'
op|'='
name|'StringIO'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'object_controller'
op|'='
name|'object_server'
op|'.'
name|'ObjectController'
op|'('
nl|'\n'
op|'{'
string|"'devices'"
op|':'
name|'self'
op|'.'
name|'testdir'
op|','
string|"'mount_check'"
op|':'
string|"'false'"
op|','
nl|'\n'
string|"'replication_server'"
op|':'
string|"'true'"
op|'}'
op|','
name|'logger'
op|'='
name|'FakeLogger'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|function|start_response
name|'def'
name|'start_response'
op|'('
op|'*'
name|'args'
op|')'
op|':'
newline|'\n'
indent|'            '
string|'"""Sends args to outbuf"""'
newline|'\n'
name|'outbuf'
op|'.'
name|'writelines'
op|'('
name|'args'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'obj_methods'
op|'='
op|'['
string|"'DELETE'"
op|','
string|"'PUT'"
op|','
string|"'HEAD'"
op|','
string|"'GET'"
op|','
string|"'POST'"
op|','
string|"'OPTIONS'"
op|']'
newline|'\n'
name|'for'
name|'method'
name|'in'
name|'obj_methods'
op|':'
newline|'\n'
indent|'            '
name|'env'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
name|'method'
op|','
nl|'\n'
string|"'SCRIPT_NAME'"
op|':'
string|"''"
op|','
nl|'\n'
string|"'PATH_INFO'"
op|':'
string|"'/sda1/p/a/c'"
op|','
nl|'\n'
string|"'SERVER_NAME'"
op|':'
string|"'127.0.0.1'"
op|','
nl|'\n'
string|"'SERVER_PORT'"
op|':'
string|"'8080'"
op|','
nl|'\n'
string|"'SERVER_PROTOCOL'"
op|':'
string|"'HTTP/1.0'"
op|','
nl|'\n'
string|"'CONTENT_LENGTH'"
op|':'
string|"'0'"
op|','
nl|'\n'
string|"'wsgi.version'"
op|':'
op|'('
number|'1'
op|','
number|'0'
op|')'
op|','
nl|'\n'
string|"'wsgi.url_scheme'"
op|':'
string|"'http'"
op|','
nl|'\n'
string|"'wsgi.input'"
op|':'
name|'inbuf'
op|','
nl|'\n'
string|"'wsgi.errors'"
op|':'
name|'errbuf'
op|','
nl|'\n'
string|"'wsgi.multithread'"
op|':'
name|'False'
op|','
nl|'\n'
string|"'wsgi.multiprocess'"
op|':'
name|'False'
op|','
nl|'\n'
string|"'wsgi.run_once'"
op|':'
name|'False'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'object_controller'
op|'('
name|'env'
op|','
name|'start_response'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'errbuf'
op|'.'
name|'getvalue'
op|'('
op|')'
op|','
string|"''"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'outbuf'
op|'.'
name|'getvalue'
op|'('
op|')'
op|'['
op|':'
number|'4'
op|']'
op|','
string|"'405 '"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_not_utf8_and_not_logging_requests
dedent|''
dedent|''
name|'def'
name|'test_not_utf8_and_not_logging_requests'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'inbuf'
op|'='
name|'WsgiBytesIO'
op|'('
op|')'
newline|'\n'
name|'errbuf'
op|'='
name|'StringIO'
op|'('
op|')'
newline|'\n'
name|'outbuf'
op|'='
name|'StringIO'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'object_controller'
op|'='
name|'object_server'
op|'.'
name|'ObjectController'
op|'('
nl|'\n'
op|'{'
string|"'devices'"
op|':'
name|'self'
op|'.'
name|'testdir'
op|','
string|"'mount_check'"
op|':'
string|"'false'"
op|','
nl|'\n'
string|"'replication_server'"
op|':'
string|"'false'"
op|','
string|"'log_requests'"
op|':'
string|"'false'"
op|'}'
op|','
nl|'\n'
name|'logger'
op|'='
name|'FakeLogger'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|function|start_response
name|'def'
name|'start_response'
op|'('
op|'*'
name|'args'
op|')'
op|':'
newline|'\n'
comment|'# Sends args to outbuf'
nl|'\n'
indent|'            '
name|'outbuf'
op|'.'
name|'writelines'
op|'('
name|'args'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'method'
op|'='
string|"'PUT'"
newline|'\n'
nl|'\n'
name|'env'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
name|'method'
op|','
nl|'\n'
string|"'SCRIPT_NAME'"
op|':'
string|"''"
op|','
nl|'\n'
string|"'PATH_INFO'"
op|':'
string|"'/sda1/p/a/c/\\x00%20/%'"
op|','
nl|'\n'
string|"'SERVER_NAME'"
op|':'
string|"'127.0.0.1'"
op|','
nl|'\n'
string|"'SERVER_PORT'"
op|':'
string|"'8080'"
op|','
nl|'\n'
string|"'SERVER_PROTOCOL'"
op|':'
string|"'HTTP/1.0'"
op|','
nl|'\n'
string|"'CONTENT_LENGTH'"
op|':'
string|"'0'"
op|','
nl|'\n'
string|"'wsgi.version'"
op|':'
op|'('
number|'1'
op|','
number|'0'
op|')'
op|','
nl|'\n'
string|"'wsgi.url_scheme'"
op|':'
string|"'http'"
op|','
nl|'\n'
string|"'wsgi.input'"
op|':'
name|'inbuf'
op|','
nl|'\n'
string|"'wsgi.errors'"
op|':'
name|'errbuf'
op|','
nl|'\n'
string|"'wsgi.multithread'"
op|':'
name|'False'
op|','
nl|'\n'
string|"'wsgi.multiprocess'"
op|':'
name|'False'
op|','
nl|'\n'
string|"'wsgi.run_once'"
op|':'
name|'False'
op|'}'
newline|'\n'
nl|'\n'
name|'answer'
op|'='
op|'['
string|"'Invalid UTF8 or contains NULL'"
op|']'
newline|'\n'
name|'mock_method'
op|'='
name|'public'
op|'('
name|'lambda'
name|'x'
op|':'
name|'mock'
op|'.'
name|'MagicMock'
op|'('
op|')'
op|')'
newline|'\n'
name|'with'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|','
name|'method'
op|','
nl|'\n'
name|'new'
op|'='
name|'mock_method'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'response'
op|'='
name|'self'
op|'.'
name|'object_controller'
op|'.'
name|'__call__'
op|'('
name|'env'
op|','
name|'start_response'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'response'
op|','
name|'answer'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'self'
op|'.'
name|'logger'
op|'.'
name|'get_lines_for_level'
op|'('
string|"'info'"
op|')'
op|','
op|'['
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test__call__returns_500
dedent|''
dedent|''
name|'def'
name|'test__call__returns_500'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'inbuf'
op|'='
name|'WsgiBytesIO'
op|'('
op|')'
newline|'\n'
name|'errbuf'
op|'='
name|'StringIO'
op|'('
op|')'
newline|'\n'
name|'outbuf'
op|'='
name|'StringIO'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'logger'
op|'='
name|'debug_logger'
op|'('
string|"'test'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'object_controller'
op|'='
name|'object_server'
op|'.'
name|'ObjectController'
op|'('
nl|'\n'
op|'{'
string|"'devices'"
op|':'
name|'self'
op|'.'
name|'testdir'
op|','
string|"'mount_check'"
op|':'
string|"'false'"
op|','
nl|'\n'
string|"'replication_server'"
op|':'
string|"'false'"
op|','
string|"'log_requests'"
op|':'
string|"'false'"
op|'}'
op|','
nl|'\n'
name|'logger'
op|'='
name|'self'
op|'.'
name|'logger'
op|')'
newline|'\n'
nl|'\n'
DECL|function|start_response
name|'def'
name|'start_response'
op|'('
op|'*'
name|'args'
op|')'
op|':'
newline|'\n'
comment|'# Sends args to outbuf'
nl|'\n'
indent|'            '
name|'outbuf'
op|'.'
name|'writelines'
op|'('
name|'args'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'method'
op|'='
string|"'PUT'"
newline|'\n'
nl|'\n'
name|'env'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
name|'method'
op|','
nl|'\n'
string|"'SCRIPT_NAME'"
op|':'
string|"''"
op|','
nl|'\n'
string|"'PATH_INFO'"
op|':'
string|"'/sda1/p/a/c/o'"
op|','
nl|'\n'
string|"'SERVER_NAME'"
op|':'
string|"'127.0.0.1'"
op|','
nl|'\n'
string|"'SERVER_PORT'"
op|':'
string|"'8080'"
op|','
nl|'\n'
string|"'SERVER_PROTOCOL'"
op|':'
string|"'HTTP/1.0'"
op|','
nl|'\n'
string|"'CONTENT_LENGTH'"
op|':'
string|"'0'"
op|','
nl|'\n'
string|"'wsgi.version'"
op|':'
op|'('
number|'1'
op|','
number|'0'
op|')'
op|','
nl|'\n'
string|"'wsgi.url_scheme'"
op|':'
string|"'http'"
op|','
nl|'\n'
string|"'wsgi.input'"
op|':'
name|'inbuf'
op|','
nl|'\n'
string|"'wsgi.errors'"
op|':'
name|'errbuf'
op|','
nl|'\n'
string|"'wsgi.multithread'"
op|':'
name|'False'
op|','
nl|'\n'
string|"'wsgi.multiprocess'"
op|':'
name|'False'
op|','
nl|'\n'
string|"'wsgi.run_once'"
op|':'
name|'False'
op|'}'
newline|'\n'
nl|'\n'
op|'@'
name|'public'
newline|'\n'
DECL|function|mock_put_method
name|'def'
name|'mock_put_method'
op|'('
op|'*'
name|'args'
op|','
op|'**'
name|'kwargs'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'Exception'
op|'('
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'with'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|','
name|'method'
op|','
nl|'\n'
name|'new'
op|'='
name|'mock_put_method'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'response'
op|'='
name|'self'
op|'.'
name|'object_controller'
op|'.'
name|'__call__'
op|'('
name|'env'
op|','
name|'start_response'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'response'
op|'['
number|'0'
op|']'
op|'.'
name|'startswith'
op|'('
nl|'\n'
string|"'Traceback (most recent call last):'"
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'self'
op|'.'
name|'logger'
op|'.'
name|'get_lines_for_level'
op|'('
string|"'error'"
op|')'
op|','
op|'['
nl|'\n'
string|"'ERROR __call__ error with %(method)s %(path)s : '"
op|'%'
op|'{'
nl|'\n'
string|"'method'"
op|':'
string|"'PUT'"
op|','
string|"'path'"
op|':'
string|"'/sda1/p/a/c/o'"
op|'}'
op|','
nl|'\n'
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'self'
op|'.'
name|'logger'
op|'.'
name|'get_lines_for_level'
op|'('
string|"'info'"
op|')'
op|','
op|'['
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_PUT_slow
dedent|''
dedent|''
name|'def'
name|'test_PUT_slow'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'inbuf'
op|'='
name|'WsgiBytesIO'
op|'('
op|')'
newline|'\n'
name|'errbuf'
op|'='
name|'StringIO'
op|'('
op|')'
newline|'\n'
name|'outbuf'
op|'='
name|'StringIO'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'object_controller'
op|'='
name|'object_server'
op|'.'
name|'ObjectController'
op|'('
nl|'\n'
op|'{'
string|"'devices'"
op|':'
name|'self'
op|'.'
name|'testdir'
op|','
string|"'mount_check'"
op|':'
string|"'false'"
op|','
nl|'\n'
string|"'replication_server'"
op|':'
string|"'false'"
op|','
string|"'log_requests'"
op|':'
string|"'false'"
op|','
nl|'\n'
string|"'slow'"
op|':'
string|"'10'"
op|'}'
op|','
nl|'\n'
name|'logger'
op|'='
name|'self'
op|'.'
name|'logger'
op|')'
newline|'\n'
nl|'\n'
DECL|function|start_response
name|'def'
name|'start_response'
op|'('
op|'*'
name|'args'
op|')'
op|':'
newline|'\n'
comment|'# Sends args to outbuf'
nl|'\n'
indent|'            '
name|'outbuf'
op|'.'
name|'writelines'
op|'('
name|'args'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'method'
op|'='
string|"'PUT'"
newline|'\n'
nl|'\n'
name|'env'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
name|'method'
op|','
nl|'\n'
string|"'SCRIPT_NAME'"
op|':'
string|"''"
op|','
nl|'\n'
string|"'PATH_INFO'"
op|':'
string|"'/sda1/p/a/c/o'"
op|','
nl|'\n'
string|"'SERVER_NAME'"
op|':'
string|"'127.0.0.1'"
op|','
nl|'\n'
string|"'SERVER_PORT'"
op|':'
string|"'8080'"
op|','
nl|'\n'
string|"'SERVER_PROTOCOL'"
op|':'
string|"'HTTP/1.0'"
op|','
nl|'\n'
string|"'CONTENT_LENGTH'"
op|':'
string|"'0'"
op|','
nl|'\n'
string|"'wsgi.version'"
op|':'
op|'('
number|'1'
op|','
number|'0'
op|')'
op|','
nl|'\n'
string|"'wsgi.url_scheme'"
op|':'
string|"'http'"
op|','
nl|'\n'
string|"'wsgi.input'"
op|':'
name|'inbuf'
op|','
nl|'\n'
string|"'wsgi.errors'"
op|':'
name|'errbuf'
op|','
nl|'\n'
string|"'wsgi.multithread'"
op|':'
name|'False'
op|','
nl|'\n'
string|"'wsgi.multiprocess'"
op|':'
name|'False'
op|','
nl|'\n'
string|"'wsgi.run_once'"
op|':'
name|'False'
op|'}'
newline|'\n'
nl|'\n'
name|'mock_method'
op|'='
name|'public'
op|'('
name|'lambda'
name|'x'
op|':'
name|'mock'
op|'.'
name|'MagicMock'
op|'('
op|')'
op|')'
newline|'\n'
name|'with'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|','
name|'method'
op|','
nl|'\n'
name|'new'
op|'='
name|'mock_method'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'with'
name|'mock'
op|'.'
name|'patch'
op|'('
string|"'time.time'"
op|','
nl|'\n'
name|'mock'
op|'.'
name|'MagicMock'
op|'('
name|'side_effect'
op|'='
op|'['
number|'10000.0'
op|','
nl|'\n'
number|'10001.0'
op|']'
op|')'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'with'
name|'mock'
op|'.'
name|'patch'
op|'('
string|"'swift.obj.server.sleep'"
op|','
nl|'\n'
name|'mock'
op|'.'
name|'MagicMock'
op|'('
op|')'
op|')'
name|'as'
name|'ms'
op|':'
newline|'\n'
indent|'                    '
name|'self'
op|'.'
name|'object_controller'
op|'.'
name|'__call__'
op|'('
name|'env'
op|','
name|'start_response'
op|')'
newline|'\n'
name|'ms'
op|'.'
name|'assert_called_with'
op|'('
number|'9'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'self'
op|'.'
name|'logger'
op|'.'
name|'get_lines_for_level'
op|'('
string|"'info'"
op|')'
op|','
nl|'\n'
op|'['
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_log_line_format
dedent|''
dedent|''
dedent|''
dedent|''
name|'def'
name|'test_log_line_format'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'HEAD'"
op|','
string|"'REMOTE_ADDR'"
op|':'
string|"'1.2.3.4'"
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'object_controller'
op|'.'
name|'logger'
op|'='
name|'self'
op|'.'
name|'logger'
newline|'\n'
name|'with'
name|'mock'
op|'.'
name|'patch'
op|'('
nl|'\n'
string|"'time.gmtime'"
op|','
name|'mock'
op|'.'
name|'MagicMock'
op|'('
name|'side_effect'
op|'='
op|'['
name|'gmtime'
op|'('
number|'10001.0'
op|')'
op|']'
op|')'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'with'
name|'mock'
op|'.'
name|'patch'
op|'('
nl|'\n'
string|"'time.time'"
op|','
nl|'\n'
name|'mock'
op|'.'
name|'MagicMock'
op|'('
name|'side_effect'
op|'='
op|'['
number|'10000.0'
op|','
number|'10001.0'
op|','
number|'10002.0'
op|']'
op|')'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'with'
name|'mock'
op|'.'
name|'patch'
op|'('
nl|'\n'
string|"'os.getpid'"
op|','
name|'mock'
op|'.'
name|'MagicMock'
op|'('
name|'return_value'
op|'='
number|'1234'
op|')'
op|')'
op|':'
newline|'\n'
indent|'                    '
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
dedent|''
dedent|''
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'logger'
op|'.'
name|'get_lines_for_level'
op|'('
string|"'info'"
op|')'
op|','
nl|'\n'
op|'['
string|'\'1.2.3.4 - - [01/Jan/1970:02:46:41 +0000] "HEAD /sda1/p/a/c/o" \''
nl|'\n'
string|'\'404 - "-" "-" "-" 2.0000 "-" 1234 -\''
op|']'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'patch_policies'
op|'('
op|'['
name|'StoragePolicy'
op|'('
number|'0'
op|','
string|"'zero'"
op|','
name|'True'
op|')'
op|','
nl|'\n'
name|'StoragePolicy'
op|'('
number|'1'
op|','
string|"'one'"
op|','
name|'False'
op|')'
op|']'
op|')'
newline|'\n'
DECL|member|test_dynamic_datadir
name|'def'
name|'test_dynamic_datadir'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# update router post patch'
nl|'\n'
indent|'        '
name|'self'
op|'.'
name|'object_controller'
op|'.'
name|'_diskfile_router'
op|'='
name|'diskfile'
op|'.'
name|'DiskFileRouter'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'conf'
op|','
name|'self'
op|'.'
name|'object_controller'
op|'.'
name|'logger'
op|')'
newline|'\n'
name|'timestamp'
op|'='
name|'normalize_timestamp'
op|'('
name|'time'
op|'('
op|')'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'timestamp'
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'application/x-test'"
op|','
nl|'\n'
string|"'Foo'"
op|':'
string|"'fooheader'"
op|','
nl|'\n'
string|"'Baz'"
op|':'
string|"'bazheader'"
op|','
nl|'\n'
string|"'X-Backend-Storage-Policy-Index'"
op|':'
number|'1'
op|','
nl|'\n'
string|"'X-Object-Meta-1'"
op|':'
string|"'One'"
op|','
nl|'\n'
string|"'X-Object-Meta-Two'"
op|':'
string|"'Two'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'body'
op|'='
string|"'VERIFY'"
newline|'\n'
name|'object_dir'
op|'='
name|'self'
op|'.'
name|'testdir'
op|'+'
string|'"/sda1/objects-1"'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'isdir'
op|'('
name|'object_dir'
op|')'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'201'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'isdir'
op|'('
name|'object_dir'
op|')'
op|')'
newline|'\n'
nl|'\n'
comment|'# make sure no idx in header uses policy 0 data_dir'
nl|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'timestamp'
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'application/x-test'"
op|','
nl|'\n'
string|"'Foo'"
op|':'
string|"'fooheader'"
op|','
nl|'\n'
string|"'Baz'"
op|':'
string|"'bazheader'"
op|','
nl|'\n'
string|"'X-Object-Meta-1'"
op|':'
string|"'One'"
op|','
nl|'\n'
string|"'X-Object-Meta-Two'"
op|':'
string|"'Two'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'body'
op|'='
string|"'VERIFY'"
newline|'\n'
name|'object_dir'
op|'='
name|'self'
op|'.'
name|'testdir'
op|'+'
string|'"/sda1/objects"'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'isdir'
op|'('
name|'object_dir'
op|')'
op|')'
newline|'\n'
name|'with'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'POLICIES'
op|','
string|"'get_by_index'"
op|','
nl|'\n'
name|'lambda'
name|'_'
op|':'
name|'True'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'201'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'isdir'
op|'('
name|'object_dir'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_storage_policy_index_is_validated
dedent|''
name|'def'
name|'test_storage_policy_index_is_validated'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# sanity check that index for existing policy is ok'
nl|'\n'
indent|'        '
name|'ts'
op|'='
op|'('
name|'utils'
op|'.'
name|'Timestamp'
op|'('
name|'t'
op|')'
op|'.'
name|'internal'
name|'for'
name|'t'
name|'in'
nl|'\n'
name|'itertools'
op|'.'
name|'count'
op|'('
name|'int'
op|'('
name|'time'
op|'('
op|')'
op|')'
op|')'
op|')'
newline|'\n'
name|'methods'
op|'='
op|'('
string|"'PUT'"
op|','
string|"'POST'"
op|','
string|"'GET'"
op|','
string|"'HEAD'"
op|','
string|"'REPLICATE'"
op|','
string|"'DELETE'"
op|')'
newline|'\n'
name|'valid_indices'
op|'='
name|'sorted'
op|'('
op|'['
name|'int'
op|'('
name|'policy'
op|')'
name|'for'
name|'policy'
name|'in'
name|'POLICIES'
op|']'
op|')'
newline|'\n'
name|'for'
name|'index'
name|'in'
name|'valid_indices'
op|':'
newline|'\n'
indent|'            '
name|'object_dir'
op|'='
name|'self'
op|'.'
name|'testdir'
op|'+'
string|'"/sda1/objects"'
newline|'\n'
name|'if'
name|'index'
op|'>'
number|'0'
op|':'
newline|'\n'
indent|'                '
name|'object_dir'
op|'='
string|'"%s-%s"'
op|'%'
op|'('
name|'object_dir'
op|','
name|'index'
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'isdir'
op|'('
name|'object_dir'
op|')'
op|')'
newline|'\n'
name|'for'
name|'method'
name|'in'
name|'methods'
op|':'
newline|'\n'
indent|'                '
name|'headers'
op|'='
op|'{'
nl|'\n'
string|"'X-Timestamp'"
op|':'
name|'next'
op|'('
name|'ts'
op|')'
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'application/x-test'"
op|','
nl|'\n'
string|"'X-Backend-Storage-Policy-Index'"
op|':'
name|'index'
op|'}'
newline|'\n'
name|'if'
name|'POLICIES'
op|'['
name|'index'
op|']'
op|'.'
name|'policy_type'
op|'=='
name|'EC_POLICY'
op|':'
newline|'\n'
indent|'                    '
name|'headers'
op|'['
string|"'X-Object-Sysmeta-Ec-Frag-Index'"
op|']'
op|'='
string|"'2'"
newline|'\n'
dedent|''
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
name|'method'
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
name|'headers'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'body'
op|'='
string|"'VERIFY'"
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'is_success'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|')'
op|','
nl|'\n'
string|"'%s method failed: %r'"
op|'%'
op|'('
name|'method'
op|','
name|'resp'
op|'.'
name|'status'
op|')'
op|')'
newline|'\n'
nl|'\n'
comment|'# index for non-existent policy should return 503'
nl|'\n'
dedent|''
dedent|''
name|'index'
op|'='
name|'valid_indices'
op|'['
op|'-'
number|'1'
op|']'
op|'+'
number|'1'
newline|'\n'
name|'for'
name|'method'
name|'in'
name|'methods'
op|':'
newline|'\n'
indent|'            '
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
name|'method'
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
nl|'\n'
string|"'X-Timestamp'"
op|':'
name|'next'
op|'('
name|'ts'
op|')'
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'application/x-test'"
op|','
nl|'\n'
string|"'X-Backend-Storage-Policy-Index'"
op|':'
name|'index'
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'body'
op|'='
string|"'VERIFY'"
newline|'\n'
name|'object_dir'
op|'='
name|'self'
op|'.'
name|'testdir'
op|'+'
string|'"/sda1/objects-%s"'
op|'%'
name|'index'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'503'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'isdir'
op|'('
name|'object_dir'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_race_doesnt_quarantine
dedent|''
dedent|''
name|'def'
name|'test_race_doesnt_quarantine'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'existing_timestamp'
op|'='
name|'normalize_timestamp'
op|'('
name|'time'
op|'('
op|')'
op|')'
newline|'\n'
name|'delete_timestamp'
op|'='
name|'normalize_timestamp'
op|'('
name|'time'
op|'('
op|')'
op|'+'
number|'1'
op|')'
newline|'\n'
name|'put_timestamp'
op|'='
name|'normalize_timestamp'
op|'('
name|'time'
op|'('
op|')'
op|'+'
number|'2'
op|')'
newline|'\n'
nl|'\n'
comment|'# make a .ts'
nl|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'DELETE'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'existing_timestamp'
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
nl|'\n'
comment|'# force a PUT between the listdir and read_metadata of a DELETE'
nl|'\n'
name|'put_once'
op|'='
op|'['
name|'False'
op|']'
newline|'\n'
name|'orig_listdir'
op|'='
name|'os'
op|'.'
name|'listdir'
newline|'\n'
nl|'\n'
DECL|function|mock_listdir
name|'def'
name|'mock_listdir'
op|'('
name|'path'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'listing'
op|'='
name|'orig_listdir'
op|'('
name|'path'
op|')'
newline|'\n'
name|'if'
name|'not'
name|'put_once'
op|'['
number|'0'
op|']'
op|':'
newline|'\n'
indent|'                '
name|'put_once'
op|'['
number|'0'
op|']'
op|'='
name|'True'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'put_timestamp'
op|','
nl|'\n'
string|"'Content-Length'"
op|':'
string|"'9'"
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'application/octet-stream'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'body'
op|'='
string|"'some data'"
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'201'
op|')'
newline|'\n'
dedent|''
name|'return'
name|'listing'
newline|'\n'
nl|'\n'
dedent|''
name|'with'
name|'mock'
op|'.'
name|'patch'
op|'('
string|"'os.listdir'"
op|','
name|'mock_listdir'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/sda1/p/a/c/o'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'DELETE'"
op|'}'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Timestamp'"
op|':'
name|'delete_timestamp'
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'404'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'qdir'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'self'
op|'.'
name|'testdir'
op|','
string|"'sda1'"
op|','
string|"'quarantined'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'exists'
op|'('
name|'qdir'
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/sda1/p/a/c/o'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'HEAD'"
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'object_controller'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'200'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'['
string|"'X-Timestamp'"
op|']'
op|','
name|'put_timestamp'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_multiphase_put_draining
dedent|''
name|'def'
name|'test_multiphase_put_draining'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# We want to ensure that we read the whole response body even if'
nl|'\n'
comment|"# it's multipart MIME and there's document parts that we don't"
nl|'\n'
comment|"# expect or understand. This'll help save our bacon if we ever jam"
nl|'\n'
comment|'# more stuff in there.'
nl|'\n'
indent|'        '
name|'in_a_timeout'
op|'='
op|'['
name|'False'
op|']'
newline|'\n'
nl|'\n'
comment|'# inherit from BaseException so we get a stack trace when the test'
nl|'\n'
comment|'# fails instead of just a 500'
nl|'\n'
DECL|class|NotInATimeout
name|'class'
name|'NotInATimeout'
op|'('
name|'BaseException'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'pass'
newline|'\n'
nl|'\n'
DECL|class|FakeTimeout
dedent|''
name|'class'
name|'FakeTimeout'
op|'('
name|'BaseException'
op|')'
op|':'
newline|'\n'
DECL|member|__enter__
indent|'            '
name|'def'
name|'__enter__'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'in_a_timeout'
op|'['
number|'0'
op|']'
op|'='
name|'True'
newline|'\n'
nl|'\n'
DECL|member|__exit__
dedent|''
name|'def'
name|'__exit__'
op|'('
name|'self'
op|','
name|'typ'
op|','
name|'value'
op|','
name|'tb'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'in_a_timeout'
op|'['
number|'0'
op|']'
op|'='
name|'False'
newline|'\n'
nl|'\n'
DECL|class|PickyWsgiBytesIO
dedent|''
dedent|''
name|'class'
name|'PickyWsgiBytesIO'
op|'('
name|'WsgiBytesIO'
op|')'
op|':'
newline|'\n'
DECL|member|read
indent|'            '
name|'def'
name|'read'
op|'('
name|'self'
op|','
op|'*'
name|'a'
op|','
op|'**'
name|'kw'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'if'
name|'not'
name|'in_a_timeout'
op|'['
number|'0'
op|']'
op|':'
newline|'\n'
indent|'                    '
name|'raise'
name|'NotInATimeout'
op|'('
op|')'
newline|'\n'
dedent|''
name|'return'
name|'WsgiBytesIO'
op|'.'
name|'read'
op|'('
name|'self'
op|','
op|'*'
name|'a'
op|','
op|'**'
name|'kw'
op|')'
newline|'\n'
nl|'\n'
DECL|member|readline
dedent|''
name|'def'
name|'readline'
op|'('
name|'self'
op|','
op|'*'
name|'a'
op|','
op|'**'
name|'kw'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'if'
name|'not'
name|'in_a_timeout'
op|'['
number|'0'
op|']'
op|':'
newline|'\n'
indent|'                    '
name|'raise'
name|'NotInATimeout'
op|'('
op|')'
newline|'\n'
dedent|''
name|'return'
name|'WsgiBytesIO'
op|'.'
name|'readline'
op|'('
name|'self'
op|','
op|'*'
name|'a'
op|','
op|'**'
name|'kw'
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'test_data'
op|'='
string|"'obj data'"
newline|'\n'
name|'footer_meta'
op|'='
op|'{'
nl|'\n'
string|'"X-Object-Sysmeta-Ec-Frag-Index"'
op|':'
string|'"7"'
op|','
nl|'\n'
string|'"Etag"'
op|':'
name|'md5'
op|'('
name|'test_data'
op|')'
op|'.'
name|'hexdigest'
op|'('
op|')'
op|','
nl|'\n'
op|'}'
newline|'\n'
name|'footer_json'
op|'='
name|'json'
op|'.'
name|'dumps'
op|'('
name|'footer_meta'
op|')'
newline|'\n'
name|'footer_meta_cksum'
op|'='
name|'md5'
op|'('
name|'footer_json'
op|')'
op|'.'
name|'hexdigest'
op|'('
op|')'
newline|'\n'
name|'test_doc'
op|'='
string|'"\\r\\n"'
op|'.'
name|'join'
op|'('
op|'('
nl|'\n'
string|'"--boundary123"'
op|','
nl|'\n'
string|'"X-Document: object body"'
op|','
nl|'\n'
string|'""'
op|','
nl|'\n'
name|'test_data'
op|','
nl|'\n'
string|'"--boundary123"'
op|','
nl|'\n'
string|'"X-Document: object metadata"'
op|','
nl|'\n'
string|'"Content-MD5: "'
op|'+'
name|'footer_meta_cksum'
op|','
nl|'\n'
string|'""'
op|','
nl|'\n'
name|'footer_json'
op|','
nl|'\n'
string|'"--boundary123"'
op|','
nl|'\n'
string|'"X-Document: we got cleverer"'
op|','
nl|'\n'
string|'""'
op|','
nl|'\n'
string|'"stuff stuff meaningless stuuuuuuuuuuff"'
op|','
nl|'\n'
string|'"--boundary123"'
op|','
nl|'\n'
string|'"X-Document: we got even cleverer; can you believe it?"'
op|','
nl|'\n'
string|'"Waneshaft: ambifacient lunar"'
op|','
nl|'\n'
string|'"Casing: malleable logarithmic"'
op|','
nl|'\n'
string|'""'
op|','
nl|'\n'
string|'"potato potato potato potato potato potato potato"'
op|','
nl|'\n'
string|'"--boundary123--"'
nl|'\n'
op|')'
op|')'
newline|'\n'
name|'if'
name|'six'
op|'.'
name|'PY3'
op|':'
newline|'\n'
DECL|variable|test_doc
indent|'            '
name|'test_doc'
op|'='
name|'test_doc'
op|'.'
name|'encode'
op|'('
string|"'utf-8'"
op|')'
newline|'\n'
nl|'\n'
comment|'# phase1 - PUT request with object metadata in footer and'
nl|'\n'
comment|'# multiphase commit conversation'
nl|'\n'
dedent|''
name|'put_timestamp'
op|'='
name|'utils'
op|'.'
name|'Timestamp'
op|'('
name|'time'
op|'('
op|')'
op|')'
op|'.'
name|'internal'
newline|'\n'
name|'headers'
op|'='
op|'{'
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'text/plain'"
op|','
nl|'\n'
string|"'X-Timestamp'"
op|':'
name|'put_timestamp'
op|','
nl|'\n'
string|"'Transfer-Encoding'"
op|':'
string|"'chunked'"
op|','
nl|'\n'
string|"'Expect'"
op|':'
string|"'100-continue'"
op|','
nl|'\n'
string|"'X-Backend-Storage-Policy-Index'"
op|':'
string|"'1'"
op|','
nl|'\n'
string|"'X-Backend-Obj-Content-Length'"
op|':'
name|'len'
op|'('
name|'test_data'
op|')'
op|','
nl|'\n'
string|"'X-Backend-Obj-Metadata-Footer'"
op|':'
string|"'yes'"
op|','
nl|'\n'
string|"'X-Backend-Obj-Multipart-Mime-Boundary'"
op|':'
string|"'boundary123'"
op|','
nl|'\n'
op|'}'
newline|'\n'
name|'wsgi_input'
op|'='
name|'PickyWsgiBytesIO'
op|'('
name|'test_doc'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|'"/sda1/0/a/c/o"'
op|','
nl|'\n'
DECL|variable|environ
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|','
string|"'wsgi.input'"
op|':'
name|'wsgi_input'
op|'}'
op|','
nl|'\n'
DECL|variable|headers
name|'headers'
op|'='
name|'headers'
op|')'
newline|'\n'
nl|'\n'
name|'app'
op|'='
name|'object_server'
op|'.'
name|'ObjectController'
op|'('
name|'self'
op|'.'
name|'conf'
op|','
name|'logger'
op|'='
name|'self'
op|'.'
name|'logger'
op|')'
newline|'\n'
name|'with'
name|'mock'
op|'.'
name|'patch'
op|'('
string|"'swift.obj.server.ChunkReadTimeout'"
op|','
name|'FakeTimeout'
op|')'
op|':'
newline|'\n'
DECL|variable|resp
indent|'            '
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'app'
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'201'
op|')'
comment|'# sanity check'
newline|'\n'
nl|'\n'
name|'in_a_timeout'
op|'['
number|'0'
op|']'
op|'='
name|'True'
comment|'# so we can check without an exception'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'wsgi_input'
op|'.'
name|'read'
op|'('
op|')'
op|','
string|"''"
op|')'
comment|'# we read all the bytes'
newline|'\n'
nl|'\n'
nl|'\n'
dedent|''
dedent|''
op|'@'
name|'patch_policies'
op|'('
name|'test_policies'
op|')'
newline|'\n'
DECL|class|TestObjectServer
name|'class'
name|'TestObjectServer'
op|'('
name|'unittest'
op|'.'
name|'TestCase'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|member|setUp
indent|'    '
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# dirs'
nl|'\n'
indent|'        '
name|'self'
op|'.'
name|'tmpdir'
op|'='
name|'tempfile'
op|'.'
name|'mkdtemp'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'tempdir'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'self'
op|'.'
name|'tmpdir'
op|','
string|"'tmp_test_obj_server'"
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'devices'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'self'
op|'.'
name|'tempdir'
op|','
string|"'srv/node'"
op|')'
newline|'\n'
name|'for'
name|'device'
name|'in'
op|'('
string|"'sda1'"
op|','
string|"'sdb1'"
op|')'
op|':'
newline|'\n'
indent|'            '
name|'os'
op|'.'
name|'makedirs'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'self'
op|'.'
name|'devices'
op|','
name|'device'
op|')'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'conf'
op|'='
op|'{'
nl|'\n'
string|"'devices'"
op|':'
name|'self'
op|'.'
name|'devices'
op|','
nl|'\n'
string|"'swift_dir'"
op|':'
name|'self'
op|'.'
name|'tempdir'
op|','
nl|'\n'
string|"'mount_check'"
op|':'
string|"'false'"
op|','
nl|'\n'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'logger'
op|'='
name|'debug_logger'
op|'('
string|"'test-object-server'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'app'
op|'='
name|'object_server'
op|'.'
name|'ObjectController'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'conf'
op|','
name|'logger'
op|'='
name|'self'
op|'.'
name|'logger'
op|')'
newline|'\n'
name|'sock'
op|'='
name|'listen'
op|'('
op|'('
string|"'127.0.0.1'"
op|','
number|'0'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'server'
op|'='
name|'spawn'
op|'('
name|'wsgi'
op|'.'
name|'server'
op|','
name|'sock'
op|','
name|'self'
op|'.'
name|'app'
op|','
name|'utils'
op|'.'
name|'NullLogger'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'port'
op|'='
name|'sock'
op|'.'
name|'getsockname'
op|'('
op|')'
op|'['
number|'1'
op|']'
newline|'\n'
nl|'\n'
DECL|member|tearDown
dedent|''
name|'def'
name|'tearDown'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'rmtree'
op|'('
name|'self'
op|'.'
name|'tmpdir'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_not_found
dedent|''
name|'def'
name|'test_not_found'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'conn'
op|'='
name|'bufferedhttp'
op|'.'
name|'http_connect'
op|'('
string|"'127.0.0.1'"
op|','
name|'self'
op|'.'
name|'port'
op|','
string|"'sda1'"
op|','
string|"'0'"
op|','
nl|'\n'
string|"'GET'"
op|','
string|"'/a/c/o'"
op|')'
newline|'\n'
name|'resp'
op|'='
name|'conn'
op|'.'
name|'getresponse'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'404'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'close'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_expect_on_put
dedent|''
name|'def'
name|'test_expect_on_put'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'test_body'
op|'='
string|"'test'"
newline|'\n'
name|'headers'
op|'='
op|'{'
nl|'\n'
string|"'Expect'"
op|':'
string|"'100-continue'"
op|','
nl|'\n'
string|"'Content-Length'"
op|':'
name|'len'
op|'('
name|'test_body'
op|')'
op|','
nl|'\n'
string|"'X-Timestamp'"
op|':'
name|'utils'
op|'.'
name|'Timestamp'
op|'('
name|'time'
op|'('
op|')'
op|')'
op|'.'
name|'internal'
op|','
nl|'\n'
op|'}'
newline|'\n'
name|'conn'
op|'='
name|'bufferedhttp'
op|'.'
name|'http_connect'
op|'('
string|"'127.0.0.1'"
op|','
name|'self'
op|'.'
name|'port'
op|','
string|"'sda1'"
op|','
string|"'0'"
op|','
nl|'\n'
string|"'PUT'"
op|','
string|"'/a/c/o'"
op|','
name|'headers'
op|'='
name|'headers'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'conn'
op|'.'
name|'getexpect'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'100'
op|')'
newline|'\n'
name|'conn'
op|'.'
name|'send'
op|'('
name|'test_body'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'conn'
op|'.'
name|'getresponse'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'201'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'close'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_expect_on_put_footer
dedent|''
name|'def'
name|'test_expect_on_put_footer'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'test_body'
op|'='
string|"'test'"
newline|'\n'
name|'headers'
op|'='
op|'{'
nl|'\n'
string|"'Expect'"
op|':'
string|"'100-continue'"
op|','
nl|'\n'
string|"'Content-Length'"
op|':'
name|'len'
op|'('
name|'test_body'
op|')'
op|','
nl|'\n'
string|"'X-Timestamp'"
op|':'
name|'utils'
op|'.'
name|'Timestamp'
op|'('
name|'time'
op|'('
op|')'
op|')'
op|'.'
name|'internal'
op|','
nl|'\n'
string|"'X-Backend-Obj-Metadata-Footer'"
op|':'
string|"'yes'"
op|','
nl|'\n'
string|"'X-Backend-Obj-Multipart-Mime-Boundary'"
op|':'
string|"'boundary123'"
op|','
nl|'\n'
op|'}'
newline|'\n'
name|'conn'
op|'='
name|'bufferedhttp'
op|'.'
name|'http_connect'
op|'('
string|"'127.0.0.1'"
op|','
name|'self'
op|'.'
name|'port'
op|','
string|"'sda1'"
op|','
string|"'0'"
op|','
nl|'\n'
string|"'PUT'"
op|','
string|"'/a/c/o'"
op|','
name|'headers'
op|'='
name|'headers'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'conn'
op|'.'
name|'getexpect'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'100'
op|')'
newline|'\n'
name|'headers'
op|'='
name|'HeaderKeyDict'
op|'('
name|'resp'
op|'.'
name|'getheaders'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'headers'
op|'['
string|"'X-Obj-Metadata-Footer'"
op|']'
op|','
string|"'yes'"
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'close'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_expect_on_put_conflict
dedent|''
name|'def'
name|'test_expect_on_put_conflict'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'test_body'
op|'='
string|"'test'"
newline|'\n'
name|'put_timestamp'
op|'='
name|'utils'
op|'.'
name|'Timestamp'
op|'('
name|'time'
op|'('
op|')'
op|')'
newline|'\n'
name|'headers'
op|'='
op|'{'
nl|'\n'
string|"'Expect'"
op|':'
string|"'100-continue'"
op|','
nl|'\n'
string|"'Content-Length'"
op|':'
name|'len'
op|'('
name|'test_body'
op|')'
op|','
nl|'\n'
string|"'X-Timestamp'"
op|':'
name|'put_timestamp'
op|'.'
name|'internal'
op|','
nl|'\n'
op|'}'
newline|'\n'
name|'conn'
op|'='
name|'bufferedhttp'
op|'.'
name|'http_connect'
op|'('
string|"'127.0.0.1'"
op|','
name|'self'
op|'.'
name|'port'
op|','
string|"'sda1'"
op|','
string|"'0'"
op|','
nl|'\n'
string|"'PUT'"
op|','
string|"'/a/c/o'"
op|','
name|'headers'
op|'='
name|'headers'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'conn'
op|'.'
name|'getexpect'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'100'
op|')'
newline|'\n'
name|'conn'
op|'.'
name|'send'
op|'('
name|'test_body'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'conn'
op|'.'
name|'getresponse'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'201'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'close'
op|'('
op|')'
newline|'\n'
nl|'\n'
comment|'# and again with same timestamp'
nl|'\n'
name|'conn'
op|'='
name|'bufferedhttp'
op|'.'
name|'http_connect'
op|'('
string|"'127.0.0.1'"
op|','
name|'self'
op|'.'
name|'port'
op|','
string|"'sda1'"
op|','
string|"'0'"
op|','
nl|'\n'
string|"'PUT'"
op|','
string|"'/a/c/o'"
op|','
name|'headers'
op|'='
name|'headers'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'conn'
op|'.'
name|'getexpect'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'409'
op|')'
newline|'\n'
name|'headers'
op|'='
name|'HeaderKeyDict'
op|'('
name|'resp'
op|'.'
name|'getheaders'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'headers'
op|'['
string|"'X-Backend-Timestamp'"
op|']'
op|','
name|'put_timestamp'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'close'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_multiphase_put_no_mime_boundary
dedent|''
name|'def'
name|'test_multiphase_put_no_mime_boundary'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'test_data'
op|'='
string|"'obj data'"
newline|'\n'
name|'put_timestamp'
op|'='
name|'utils'
op|'.'
name|'Timestamp'
op|'('
name|'time'
op|'('
op|')'
op|')'
op|'.'
name|'internal'
newline|'\n'
name|'headers'
op|'='
op|'{'
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'text/plain'"
op|','
nl|'\n'
string|"'X-Timestamp'"
op|':'
name|'put_timestamp'
op|','
nl|'\n'
string|"'Transfer-Encoding'"
op|':'
string|"'chunked'"
op|','
nl|'\n'
string|"'Expect'"
op|':'
string|"'100-continue'"
op|','
nl|'\n'
string|"'X-Backend-Obj-Content-Length'"
op|':'
name|'len'
op|'('
name|'test_data'
op|')'
op|','
nl|'\n'
string|"'X-Backend-Obj-Multiphase-Commit'"
op|':'
string|"'yes'"
op|','
nl|'\n'
op|'}'
newline|'\n'
name|'conn'
op|'='
name|'bufferedhttp'
op|'.'
name|'http_connect'
op|'('
string|"'127.0.0.1'"
op|','
name|'self'
op|'.'
name|'port'
op|','
string|"'sda1'"
op|','
string|"'0'"
op|','
nl|'\n'
string|"'PUT'"
op|','
string|"'/a/c/o'"
op|','
name|'headers'
op|'='
name|'headers'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'conn'
op|'.'
name|'getexpect'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'400'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'close'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_expect_on_multiphase_put_diconnect
dedent|''
name|'def'
name|'test_expect_on_multiphase_put_diconnect'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'put_timestamp'
op|'='
name|'utils'
op|'.'
name|'Timestamp'
op|'('
name|'time'
op|'('
op|')'
op|')'
op|'.'
name|'internal'
newline|'\n'
name|'headers'
op|'='
op|'{'
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'text/plain'"
op|','
nl|'\n'
string|"'X-Timestamp'"
op|':'
name|'put_timestamp'
op|','
nl|'\n'
string|"'Transfer-Encoding'"
op|':'
string|"'chunked'"
op|','
nl|'\n'
string|"'Expect'"
op|':'
string|"'100-continue'"
op|','
nl|'\n'
string|"'X-Backend-Obj-Content-Length'"
op|':'
number|'0'
op|','
nl|'\n'
string|"'X-Backend-Obj-Multipart-Mime-Boundary'"
op|':'
string|"'boundary123'"
op|','
nl|'\n'
string|"'X-Backend-Obj-Multiphase-Commit'"
op|':'
string|"'yes'"
op|','
nl|'\n'
op|'}'
newline|'\n'
name|'conn'
op|'='
name|'bufferedhttp'
op|'.'
name|'http_connect'
op|'('
string|"'127.0.0.1'"
op|','
name|'self'
op|'.'
name|'port'
op|','
string|"'sda1'"
op|','
string|"'0'"
op|','
nl|'\n'
string|"'PUT'"
op|','
string|"'/a/c/o'"
op|','
name|'headers'
op|'='
name|'headers'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'conn'
op|'.'
name|'getexpect'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'100'
op|')'
newline|'\n'
name|'headers'
op|'='
name|'HeaderKeyDict'
op|'('
name|'resp'
op|'.'
name|'getheaders'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'headers'
op|'['
string|"'X-Obj-Multiphase-Commit'"
op|']'
op|','
string|"'yes'"
op|')'
newline|'\n'
nl|'\n'
name|'conn'
op|'.'
name|'send'
op|'('
string|"'c\\r\\n--boundary123\\r\\n'"
op|')'
newline|'\n'
nl|'\n'
comment|'# disconnect client'
nl|'\n'
name|'conn'
op|'.'
name|'sock'
op|'.'
name|'fd'
op|'.'
name|'_sock'
op|'.'
name|'close'
op|'('
op|')'
newline|'\n'
name|'for'
name|'i'
name|'in'
name|'range'
op|'('
number|'2'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'sleep'
op|'('
number|'0'
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'self'
op|'.'
name|'logger'
op|'.'
name|'get_lines_for_level'
op|'('
string|"'error'"
op|')'
op|')'
newline|'\n'
name|'for'
name|'line'
name|'in'
name|'self'
op|'.'
name|'logger'
op|'.'
name|'get_lines_for_level'
op|'('
string|"'info'"
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertIn'
op|'('
string|"' 499 '"
op|','
name|'line'
op|')'
newline|'\n'
nl|'\n'
DECL|member|find_files
dedent|''
dedent|''
name|'def'
name|'find_files'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'found_files'
op|'='
name|'defaultdict'
op|'('
name|'list'
op|')'
newline|'\n'
name|'for'
name|'root'
op|','
name|'dirs'
op|','
name|'files'
name|'in'
name|'os'
op|'.'
name|'walk'
op|'('
name|'self'
op|'.'
name|'devices'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'for'
name|'filename'
name|'in'
name|'files'
op|':'
newline|'\n'
indent|'                '
name|'_name'
op|','
name|'ext'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'splitext'
op|'('
name|'filename'
op|')'
newline|'\n'
name|'file_path'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'root'
op|','
name|'filename'
op|')'
newline|'\n'
name|'found_files'
op|'['
name|'ext'
op|']'
op|'.'
name|'append'
op|'('
name|'file_path'
op|')'
newline|'\n'
dedent|''
dedent|''
name|'return'
name|'found_files'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'contextmanager'
newline|'\n'
DECL|member|_check_multiphase_put_commit_handling
name|'def'
name|'_check_multiphase_put_commit_handling'
op|'('
name|'self'
op|','
nl|'\n'
name|'test_doc'
op|'='
name|'None'
op|','
nl|'\n'
name|'headers'
op|'='
name|'None'
op|','
nl|'\n'
name|'finish_body'
op|'='
name|'True'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        This helper will setup a multiphase chunked PUT request and yield at\n        the context at the commit phase (after getting the second expect-100\n        continue response.\n\n        It can setup a resonable stub request, but you can over-ride some\n        characteristics of the request via kwargs.\n\n        :param test_doc: first part of the mime conversation before the object\n                         server will send the 100-continue, this includes the\n                         object body\n        :param headers: headers to send along with the initial request; some\n                        object-metadata (e.g.  X-Backend-Obj-Content-Length)\n                        is generally expected tomatch the test_doc)\n        :param finish_body: boolean, if true send "0\\r\\n\\r\\n" after test_doc\n                            and wait for 100-continue before yielding context\n        """'
newline|'\n'
name|'test_data'
op|'='
string|"'obj data'"
newline|'\n'
name|'footer_meta'
op|'='
op|'{'
nl|'\n'
string|'"X-Object-Sysmeta-Ec-Frag-Index"'
op|':'
string|'"2"'
op|','
nl|'\n'
string|'"Etag"'
op|':'
name|'md5'
op|'('
name|'test_data'
op|')'
op|'.'
name|'hexdigest'
op|'('
op|')'
op|','
nl|'\n'
op|'}'
newline|'\n'
name|'footer_json'
op|'='
name|'json'
op|'.'
name|'dumps'
op|'('
name|'footer_meta'
op|')'
newline|'\n'
name|'footer_meta_cksum'
op|'='
name|'md5'
op|'('
name|'footer_json'
op|')'
op|'.'
name|'hexdigest'
op|'('
op|')'
newline|'\n'
name|'test_doc'
op|'='
name|'test_doc'
name|'or'
string|'"\\r\\n"'
op|'.'
name|'join'
op|'('
op|'('
nl|'\n'
string|'"--boundary123"'
op|','
nl|'\n'
string|'"X-Document: object body"'
op|','
nl|'\n'
string|'""'
op|','
nl|'\n'
name|'test_data'
op|','
nl|'\n'
string|'"--boundary123"'
op|','
nl|'\n'
string|'"X-Document: object metadata"'
op|','
nl|'\n'
string|'"Content-MD5: "'
op|'+'
name|'footer_meta_cksum'
op|','
nl|'\n'
string|'""'
op|','
nl|'\n'
name|'footer_json'
op|','
nl|'\n'
string|'"--boundary123"'
op|','
nl|'\n'
op|')'
op|')'
newline|'\n'
nl|'\n'
comment|'# phase1 - PUT request with object metadata in footer and'
nl|'\n'
comment|'# multiphase commit conversation'
nl|'\n'
name|'put_timestamp'
op|'='
name|'utils'
op|'.'
name|'Timestamp'
op|'('
name|'time'
op|'('
op|')'
op|')'
newline|'\n'
name|'headers'
op|'='
name|'headers'
name|'or'
op|'{'
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'text/plain'"
op|','
nl|'\n'
string|"'Transfer-Encoding'"
op|':'
string|"'chunked'"
op|','
nl|'\n'
string|"'Expect'"
op|':'
string|"'100-continue'"
op|','
nl|'\n'
string|"'X-Backend-Storage-Policy-Index'"
op|':'
string|"'1'"
op|','
nl|'\n'
string|"'X-Backend-Obj-Content-Length'"
op|':'
name|'len'
op|'('
name|'test_data'
op|')'
op|','
nl|'\n'
string|"'X-Backend-Obj-Metadata-Footer'"
op|':'
string|"'yes'"
op|','
nl|'\n'
string|"'X-Backend-Obj-Multipart-Mime-Boundary'"
op|':'
string|"'boundary123'"
op|','
nl|'\n'
string|"'X-Backend-Obj-Multiphase-Commit'"
op|':'
string|"'yes'"
op|','
nl|'\n'
op|'}'
newline|'\n'
name|'put_timestamp'
op|'='
name|'utils'
op|'.'
name|'Timestamp'
op|'('
name|'headers'
op|'.'
name|'setdefault'
op|'('
nl|'\n'
string|"'X-Timestamp'"
op|','
name|'utils'
op|'.'
name|'Timestamp'
op|'('
name|'time'
op|'('
op|')'
op|')'
op|'.'
name|'internal'
op|')'
op|')'
newline|'\n'
name|'container_update'
op|'='
string|"'swift.obj.server.ObjectController.container_update'"
newline|'\n'
name|'with'
name|'mock'
op|'.'
name|'patch'
op|'('
name|'container_update'
op|')'
name|'as'
name|'_container_update'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'='
name|'bufferedhttp'
op|'.'
name|'http_connect'
op|'('
nl|'\n'
string|"'127.0.0.1'"
op|','
name|'self'
op|'.'
name|'port'
op|','
string|"'sda1'"
op|','
string|"'0'"
op|','
nl|'\n'
string|"'PUT'"
op|','
string|"'/a/c/o'"
op|','
name|'headers'
op|'='
name|'headers'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'conn'
op|'.'
name|'getexpect'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'100'
op|')'
newline|'\n'
name|'expect_headers'
op|'='
name|'HeaderKeyDict'
op|'('
name|'resp'
op|'.'
name|'getheaders'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'to_send'
op|'='
string|'"%x\\r\\n%s\\r\\n"'
op|'%'
op|'('
name|'len'
op|'('
name|'test_doc'
op|')'
op|','
name|'test_doc'
op|')'
newline|'\n'
name|'conn'
op|'.'
name|'send'
op|'('
name|'to_send'
op|')'
newline|'\n'
name|'if'
name|'finish_body'
op|':'
newline|'\n'
indent|'                '
name|'conn'
op|'.'
name|'send'
op|'('
string|'"0\\r\\n\\r\\n"'
op|')'
newline|'\n'
comment|'# verify 100-continue response to mark end of phase1'
nl|'\n'
name|'resp'
op|'='
name|'conn'
op|'.'
name|'getexpect'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'100'
op|')'
newline|'\n'
nl|'\n'
comment|'# yield relevant context for test'
nl|'\n'
dedent|''
name|'yield'
op|'{'
nl|'\n'
string|"'conn'"
op|':'
name|'conn'
op|','
nl|'\n'
string|"'expect_headers'"
op|':'
name|'expect_headers'
op|','
nl|'\n'
string|"'put_timestamp'"
op|':'
name|'put_timestamp'
op|','
nl|'\n'
string|"'mock_container_update'"
op|':'
name|'_container_update'
op|','
nl|'\n'
op|'}'
newline|'\n'
nl|'\n'
comment|'# give the object server a little time to trampoline enough to'
nl|'\n'
comment|'# recognize request has finished, or socket has closed or whatever'
nl|'\n'
dedent|''
name|'sleep'
op|'('
number|'0.1'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_multiphase_put_client_disconnect_right_before_commit
dedent|''
name|'def'
name|'test_multiphase_put_client_disconnect_right_before_commit'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'with'
name|'self'
op|'.'
name|'_check_multiphase_put_commit_handling'
op|'('
op|')'
name|'as'
name|'context'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'='
name|'context'
op|'['
string|"'conn'"
op|']'
newline|'\n'
comment|'# just bail stright out'
nl|'\n'
name|'conn'
op|'.'
name|'sock'
op|'.'
name|'fd'
op|'.'
name|'_sock'
op|'.'
name|'close'
op|'('
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'put_timestamp'
op|'='
name|'context'
op|'['
string|"'put_timestamp'"
op|']'
newline|'\n'
name|'_container_update'
op|'='
name|'context'
op|'['
string|"'mock_container_update'"
op|']'
newline|'\n'
nl|'\n'
comment|'# and make sure it demonstrates the client disconnect'
nl|'\n'
name|'log_lines'
op|'='
name|'self'
op|'.'
name|'logger'
op|'.'
name|'get_lines_for_level'
op|'('
string|"'info'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'len'
op|'('
name|'log_lines'
op|')'
op|','
number|'1'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertIn'
op|'('
string|"' 499 '"
op|','
name|'log_lines'
op|'['
number|'0'
op|']'
op|')'
newline|'\n'
nl|'\n'
comment|'# verify successful object data and durable state file write'
nl|'\n'
name|'found_files'
op|'='
name|'self'
op|'.'
name|'find_files'
op|'('
op|')'
newline|'\n'
comment|'# .data file is there'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'len'
op|'('
name|'found_files'
op|'['
string|"'.data'"
op|']'
op|')'
op|','
number|'1'
op|')'
newline|'\n'
name|'obj_datafile'
op|'='
name|'found_files'
op|'['
string|"'.data'"
op|']'
op|'['
number|'0'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|'"%s#2.data"'
op|'%'
name|'put_timestamp'
op|'.'
name|'internal'
op|','
nl|'\n'
name|'os'
op|'.'
name|'path'
op|'.'
name|'basename'
op|'('
name|'obj_datafile'
op|')'
op|')'
newline|'\n'
comment|"# but .durable isn't"
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'found_files'
op|'['
string|"'.durable'"
op|']'
op|','
op|'['
op|']'
op|')'
newline|'\n'
comment|'# And no container update'
nl|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'_container_update'
op|'.'
name|'called'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_multiphase_put_client_disconnect_in_the_middle_of_commit
dedent|''
name|'def'
name|'test_multiphase_put_client_disconnect_in_the_middle_of_commit'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'with'
name|'self'
op|'.'
name|'_check_multiphase_put_commit_handling'
op|'('
op|')'
name|'as'
name|'context'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'='
name|'context'
op|'['
string|"'conn'"
op|']'
newline|'\n'
comment|'# start commit confirmation to start phase2'
nl|'\n'
name|'commit_confirmation_doc'
op|'='
string|'"\\r\\n"'
op|'.'
name|'join'
op|'('
op|'('
nl|'\n'
string|'"X-Document: put commit"'
op|','
nl|'\n'
string|'""'
op|','
nl|'\n'
string|'"commit_confirmation"'
op|','
nl|'\n'
string|'"--boundary123--"'
op|','
nl|'\n'
op|')'
op|')'
newline|'\n'
comment|"# but don't quite the commit body"
nl|'\n'
name|'to_send'
op|'='
string|'"%x\\r\\n%s"'
op|'%'
op|'('
name|'len'
op|'('
name|'commit_confirmation_doc'
op|')'
op|','
name|'commit_confirmation_doc'
op|'['
op|':'
op|'-'
number|'1'
op|']'
op|')'
newline|'\n'
name|'conn'
op|'.'
name|'send'
op|'('
name|'to_send'
op|')'
newline|'\n'
nl|'\n'
comment|'# and then bail out'
nl|'\n'
name|'conn'
op|'.'
name|'sock'
op|'.'
name|'fd'
op|'.'
name|'_sock'
op|'.'
name|'close'
op|'('
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'put_timestamp'
op|'='
name|'context'
op|'['
string|"'put_timestamp'"
op|']'
newline|'\n'
name|'_container_update'
op|'='
name|'context'
op|'['
string|"'mock_container_update'"
op|']'
newline|'\n'
nl|'\n'
comment|'# and make sure it demonstrates the client disconnect'
nl|'\n'
name|'log_lines'
op|'='
name|'self'
op|'.'
name|'logger'
op|'.'
name|'get_lines_for_level'
op|'('
string|"'info'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'len'
op|'('
name|'log_lines'
op|')'
op|','
number|'1'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertIn'
op|'('
string|"' 499 '"
op|','
name|'log_lines'
op|'['
number|'0'
op|']'
op|')'
newline|'\n'
nl|'\n'
comment|'# verify successful object data and durable state file write'
nl|'\n'
name|'found_files'
op|'='
name|'self'
op|'.'
name|'find_files'
op|'('
op|')'
newline|'\n'
comment|'# .data file is there'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'len'
op|'('
name|'found_files'
op|'['
string|"'.data'"
op|']'
op|')'
op|','
number|'1'
op|')'
newline|'\n'
name|'obj_datafile'
op|'='
name|'found_files'
op|'['
string|"'.data'"
op|']'
op|'['
number|'0'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|'"%s#2.data"'
op|'%'
name|'put_timestamp'
op|'.'
name|'internal'
op|','
nl|'\n'
name|'os'
op|'.'
name|'path'
op|'.'
name|'basename'
op|'('
name|'obj_datafile'
op|')'
op|')'
newline|'\n'
comment|"# but .durable isn't"
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'found_files'
op|'['
string|"'.durable'"
op|']'
op|','
op|'['
op|']'
op|')'
newline|'\n'
comment|'# And no container update'
nl|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'_container_update'
op|'.'
name|'called'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_multiphase_put_no_metadata_replicated
dedent|''
name|'def'
name|'test_multiphase_put_no_metadata_replicated'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'test_data'
op|'='
string|"'obj data'"
newline|'\n'
name|'test_doc'
op|'='
string|'"\\r\\n"'
op|'.'
name|'join'
op|'('
op|'('
nl|'\n'
string|'"--boundary123"'
op|','
nl|'\n'
string|'"X-Document: object body"'
op|','
nl|'\n'
string|'""'
op|','
nl|'\n'
name|'test_data'
op|','
nl|'\n'
string|'"--boundary123"'
op|','
nl|'\n'
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'put_timestamp'
op|'='
name|'utils'
op|'.'
name|'Timestamp'
op|'('
name|'time'
op|'('
op|')'
op|')'
op|'.'
name|'internal'
newline|'\n'
name|'headers'
op|'='
op|'{'
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'text/plain'"
op|','
nl|'\n'
string|"'X-Timestamp'"
op|':'
name|'put_timestamp'
op|','
nl|'\n'
string|"'Transfer-Encoding'"
op|':'
string|"'chunked'"
op|','
nl|'\n'
string|"'Expect'"
op|':'
string|"'100-continue'"
op|','
nl|'\n'
string|"'X-Backend-Obj-Content-Length'"
op|':'
name|'len'
op|'('
name|'test_data'
op|')'
op|','
nl|'\n'
string|"'X-Backend-Obj-Multipart-Mime-Boundary'"
op|':'
string|"'boundary123'"
op|','
nl|'\n'
string|"'X-Backend-Obj-Multiphase-Commit'"
op|':'
string|"'yes'"
op|','
nl|'\n'
op|'}'
newline|'\n'
name|'with'
name|'self'
op|'.'
name|'_check_multiphase_put_commit_handling'
op|'('
nl|'\n'
name|'test_doc'
op|'='
name|'test_doc'
op|','
name|'headers'
op|'='
name|'headers'
op|')'
name|'as'
name|'context'
op|':'
newline|'\n'
indent|'            '
name|'expect_headers'
op|'='
name|'context'
op|'['
string|"'expect_headers'"
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'expect_headers'
op|'['
string|"'X-Obj-Multiphase-Commit'"
op|']'
op|','
string|"'yes'"
op|')'
newline|'\n'
comment|'# N.B. no X-Obj-Metadata-Footer header'
nl|'\n'
name|'self'
op|'.'
name|'assertNotIn'
op|'('
string|"'X-Obj-Metadata-Footer'"
op|','
name|'expect_headers'
op|')'
newline|'\n'
nl|'\n'
name|'conn'
op|'='
name|'context'
op|'['
string|"'conn'"
op|']'
newline|'\n'
comment|'# send commit confirmation to start phase2'
nl|'\n'
name|'commit_confirmation_doc'
op|'='
string|'"\\r\\n"'
op|'.'
name|'join'
op|'('
op|'('
nl|'\n'
string|'"X-Document: put commit"'
op|','
nl|'\n'
string|'""'
op|','
nl|'\n'
string|'"commit_confirmation"'
op|','
nl|'\n'
string|'"--boundary123--"'
op|','
nl|'\n'
op|')'
op|')'
newline|'\n'
name|'to_send'
op|'='
string|'"%x\\r\\n%s\\r\\n0\\r\\n\\r\\n"'
op|'%'
op|'('
name|'len'
op|'('
name|'commit_confirmation_doc'
op|')'
op|','
name|'commit_confirmation_doc'
op|')'
newline|'\n'
name|'conn'
op|'.'
name|'send'
op|'('
name|'to_send'
op|')'
newline|'\n'
nl|'\n'
comment|'# verify success (2xx) to make end of phase2'
nl|'\n'
name|'resp'
op|'='
name|'conn'
op|'.'
name|'getresponse'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'201'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'close'
op|'('
op|')'
newline|'\n'
nl|'\n'
comment|'# verify successful object data and durable state file write'
nl|'\n'
dedent|''
name|'put_timestamp'
op|'='
name|'context'
op|'['
string|"'put_timestamp'"
op|']'
newline|'\n'
name|'found_files'
op|'='
name|'self'
op|'.'
name|'find_files'
op|'('
op|')'
newline|'\n'
comment|'# .data file is there'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'len'
op|'('
name|'found_files'
op|'['
string|"'.data'"
op|']'
op|')'
op|','
number|'1'
op|')'
newline|'\n'
name|'obj_datafile'
op|'='
name|'found_files'
op|'['
string|"'.data'"
op|']'
op|'['
number|'0'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|'"%s.data"'
op|'%'
name|'put_timestamp'
op|'.'
name|'internal'
op|','
nl|'\n'
name|'os'
op|'.'
name|'path'
op|'.'
name|'basename'
op|'('
name|'obj_datafile'
op|')'
op|')'
newline|'\n'
comment|'# replicated objects do not have a .durable file'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'found_files'
op|'['
string|"'.durable'"
op|']'
op|','
op|'['
op|']'
op|')'
newline|'\n'
comment|'# And container update was called'
nl|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'context'
op|'['
string|"'mock_container_update'"
op|']'
op|'.'
name|'called'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_multiphase_put_metadata_footer
dedent|''
name|'def'
name|'test_multiphase_put_metadata_footer'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'with'
name|'self'
op|'.'
name|'_check_multiphase_put_commit_handling'
op|'('
op|')'
name|'as'
name|'context'
op|':'
newline|'\n'
indent|'            '
name|'expect_headers'
op|'='
name|'context'
op|'['
string|"'expect_headers'"
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'expect_headers'
op|'['
string|"'X-Obj-Multiphase-Commit'"
op|']'
op|','
string|"'yes'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'expect_headers'
op|'['
string|"'X-Obj-Metadata-Footer'"
op|']'
op|','
string|"'yes'"
op|')'
newline|'\n'
nl|'\n'
name|'conn'
op|'='
name|'context'
op|'['
string|"'conn'"
op|']'
newline|'\n'
comment|'# send commit confirmation to start phase2'
nl|'\n'
name|'commit_confirmation_doc'
op|'='
string|'"\\r\\n"'
op|'.'
name|'join'
op|'('
op|'('
nl|'\n'
string|'"X-Document: put commit"'
op|','
nl|'\n'
string|'""'
op|','
nl|'\n'
string|'"commit_confirmation"'
op|','
nl|'\n'
string|'"--boundary123--"'
op|','
nl|'\n'
op|')'
op|')'
newline|'\n'
name|'to_send'
op|'='
string|'"%x\\r\\n%s\\r\\n0\\r\\n\\r\\n"'
op|'%'
op|'('
name|'len'
op|'('
name|'commit_confirmation_doc'
op|')'
op|','
name|'commit_confirmation_doc'
op|')'
newline|'\n'
name|'conn'
op|'.'
name|'send'
op|'('
name|'to_send'
op|')'
newline|'\n'
nl|'\n'
comment|'# verify success (2xx) to make end of phase2'
nl|'\n'
name|'resp'
op|'='
name|'conn'
op|'.'
name|'getresponse'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'201'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'close'
op|'('
op|')'
newline|'\n'
nl|'\n'
comment|'# verify successful object data and durable state file write'
nl|'\n'
dedent|''
name|'put_timestamp'
op|'='
name|'context'
op|'['
string|"'put_timestamp'"
op|']'
newline|'\n'
name|'found_files'
op|'='
name|'self'
op|'.'
name|'find_files'
op|'('
op|')'
newline|'\n'
comment|'# .data file is there'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'len'
op|'('
name|'found_files'
op|'['
string|"'.data'"
op|']'
op|')'
op|','
number|'1'
op|')'
newline|'\n'
name|'obj_datafile'
op|'='
name|'found_files'
op|'['
string|"'.data'"
op|']'
op|'['
number|'0'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|'"%s#2.data"'
op|'%'
name|'put_timestamp'
op|'.'
name|'internal'
op|','
nl|'\n'
name|'os'
op|'.'
name|'path'
op|'.'
name|'basename'
op|'('
name|'obj_datafile'
op|')'
op|')'
newline|'\n'
comment|'# .durable file is there'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'len'
op|'('
name|'found_files'
op|'['
string|"'.durable'"
op|']'
op|')'
op|','
number|'1'
op|')'
newline|'\n'
name|'durable_file'
op|'='
name|'found_files'
op|'['
string|"'.durable'"
op|']'
op|'['
number|'0'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|'"%s.durable"'
op|'%'
name|'put_timestamp'
op|'.'
name|'internal'
op|','
nl|'\n'
name|'os'
op|'.'
name|'path'
op|'.'
name|'basename'
op|'('
name|'durable_file'
op|')'
op|')'
newline|'\n'
comment|'# And container update was called'
nl|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'context'
op|'['
string|"'mock_container_update'"
op|']'
op|'.'
name|'called'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_multiphase_put_metadata_footer_disconnect
dedent|''
name|'def'
name|'test_multiphase_put_metadata_footer_disconnect'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'test_data'
op|'='
string|"'obj data'"
newline|'\n'
name|'test_doc'
op|'='
string|'"\\r\\n"'
op|'.'
name|'join'
op|'('
op|'('
nl|'\n'
string|'"--boundary123"'
op|','
nl|'\n'
string|'"X-Document: object body"'
op|','
nl|'\n'
string|'""'
op|','
nl|'\n'
name|'test_data'
op|','
nl|'\n'
string|'"--boundary123"'
op|','
nl|'\n'
op|')'
op|')'
newline|'\n'
comment|"# eventlet.wsgi won't return < network_chunk_size from a chunked read"
nl|'\n'
name|'self'
op|'.'
name|'app'
op|'.'
name|'network_chunk_size'
op|'='
number|'16'
newline|'\n'
name|'with'
name|'self'
op|'.'
name|'_check_multiphase_put_commit_handling'
op|'('
nl|'\n'
name|'test_doc'
op|'='
name|'test_doc'
op|','
name|'finish_body'
op|'='
name|'False'
op|')'
name|'as'
name|'context'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'='
name|'context'
op|'['
string|"'conn'"
op|']'
newline|'\n'
nl|'\n'
comment|'# make footer doc'
nl|'\n'
name|'footer_meta'
op|'='
op|'{'
nl|'\n'
string|'"X-Object-Sysmeta-Ec-Frag-Index"'
op|':'
string|'"2"'
op|','
nl|'\n'
string|'"Etag"'
op|':'
name|'md5'
op|'('
name|'test_data'
op|')'
op|'.'
name|'hexdigest'
op|'('
op|')'
op|','
nl|'\n'
op|'}'
newline|'\n'
name|'footer_json'
op|'='
name|'json'
op|'.'
name|'dumps'
op|'('
name|'footer_meta'
op|')'
newline|'\n'
name|'footer_meta_cksum'
op|'='
name|'md5'
op|'('
name|'footer_json'
op|')'
op|'.'
name|'hexdigest'
op|'('
op|')'
newline|'\n'
nl|'\n'
comment|'# send most of the footer doc'
nl|'\n'
name|'footer_doc'
op|'='
string|'"\\r\\n"'
op|'.'
name|'join'
op|'('
op|'('
nl|'\n'
string|'"X-Document: object metadata"'
op|','
nl|'\n'
string|'"Content-MD5: "'
op|'+'
name|'footer_meta_cksum'
op|','
nl|'\n'
string|'""'
op|','
nl|'\n'
name|'footer_json'
op|','
nl|'\n'
op|')'
op|')'
newline|'\n'
nl|'\n'
comment|"# but don't send final boundary nor last chunk"
nl|'\n'
name|'to_send'
op|'='
string|'"%x\\r\\n%s\\r\\n"'
op|'%'
op|'('
name|'len'
op|'('
name|'footer_doc'
op|')'
op|','
name|'footer_doc'
op|')'
newline|'\n'
name|'conn'
op|'.'
name|'send'
op|'('
name|'to_send'
op|')'
newline|'\n'
nl|'\n'
comment|'# and then bail out'
nl|'\n'
name|'conn'
op|'.'
name|'sock'
op|'.'
name|'fd'
op|'.'
name|'_sock'
op|'.'
name|'close'
op|'('
op|')'
newline|'\n'
nl|'\n'
comment|'# and make sure it demonstrates the client disconnect'
nl|'\n'
dedent|''
name|'log_lines'
op|'='
name|'self'
op|'.'
name|'logger'
op|'.'
name|'get_lines_for_level'
op|'('
string|"'info'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'len'
op|'('
name|'log_lines'
op|')'
op|','
number|'1'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertIn'
op|'('
string|"' 499 '"
op|','
name|'log_lines'
op|'['
number|'0'
op|']'
op|')'
newline|'\n'
nl|'\n'
comment|'# no artifacts left on disk'
nl|'\n'
name|'found_files'
op|'='
name|'self'
op|'.'
name|'find_files'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'len'
op|'('
name|'found_files'
op|'['
string|"'.data'"
op|']'
op|')'
op|','
number|'0'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'len'
op|'('
name|'found_files'
op|'['
string|"'.durable'"
op|']'
op|')'
op|','
number|'0'
op|')'
newline|'\n'
comment|'# ... and no container update'
nl|'\n'
name|'_container_update'
op|'='
name|'context'
op|'['
string|"'mock_container_update'"
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'_container_update'
op|'.'
name|'called'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_multiphase_put_ec_fragment_in_headers_no_footers
dedent|''
name|'def'
name|'test_multiphase_put_ec_fragment_in_headers_no_footers'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'test_data'
op|'='
string|"'obj data'"
newline|'\n'
name|'test_doc'
op|'='
string|'"\\r\\n"'
op|'.'
name|'join'
op|'('
op|'('
nl|'\n'
string|'"--boundary123"'
op|','
nl|'\n'
string|'"X-Document: object body"'
op|','
nl|'\n'
string|'""'
op|','
nl|'\n'
name|'test_data'
op|','
nl|'\n'
string|'"--boundary123"'
op|','
nl|'\n'
op|')'
op|')'
newline|'\n'
nl|'\n'
comment|'# phase1 - PUT request with multiphase commit conversation'
nl|'\n'
comment|'# no object metadata in footer'
nl|'\n'
name|'put_timestamp'
op|'='
name|'utils'
op|'.'
name|'Timestamp'
op|'('
name|'time'
op|'('
op|')'
op|')'
op|'.'
name|'internal'
newline|'\n'
name|'headers'
op|'='
op|'{'
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'text/plain'"
op|','
nl|'\n'
string|"'X-Timestamp'"
op|':'
name|'put_timestamp'
op|','
nl|'\n'
string|"'Transfer-Encoding'"
op|':'
string|"'chunked'"
op|','
nl|'\n'
string|"'Expect'"
op|':'
string|"'100-continue'"
op|','
nl|'\n'
comment|'# normally the frag index gets sent in the MIME footer (which this'
nl|'\n'
comment|"# test doesn't have, see `test_multiphase_put_metadata_footer`),"
nl|'\n'
comment|'# but the proxy *could* send the frag index in the headers and'
nl|'\n'
comment|'# this test verifies that would work.'
nl|'\n'
string|"'X-Object-Sysmeta-Ec-Frag-Index'"
op|':'
string|"'2'"
op|','
nl|'\n'
string|"'X-Backend-Storage-Policy-Index'"
op|':'
string|"'1'"
op|','
nl|'\n'
string|"'X-Backend-Obj-Content-Length'"
op|':'
name|'len'
op|'('
name|'test_data'
op|')'
op|','
nl|'\n'
string|"'X-Backend-Obj-Multipart-Mime-Boundary'"
op|':'
string|"'boundary123'"
op|','
nl|'\n'
string|"'X-Backend-Obj-Multiphase-Commit'"
op|':'
string|"'yes'"
op|','
nl|'\n'
op|'}'
newline|'\n'
name|'with'
name|'self'
op|'.'
name|'_check_multiphase_put_commit_handling'
op|'('
nl|'\n'
name|'test_doc'
op|'='
name|'test_doc'
op|','
name|'headers'
op|'='
name|'headers'
op|')'
name|'as'
name|'context'
op|':'
newline|'\n'
indent|'            '
name|'expect_headers'
op|'='
name|'context'
op|'['
string|"'expect_headers'"
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'expect_headers'
op|'['
string|"'X-Obj-Multiphase-Commit'"
op|']'
op|','
string|"'yes'"
op|')'
newline|'\n'
comment|'# N.B. no X-Obj-Metadata-Footer header'
nl|'\n'
name|'self'
op|'.'
name|'assertNotIn'
op|'('
string|"'X-Obj-Metadata-Footer'"
op|','
name|'expect_headers'
op|')'
newline|'\n'
nl|'\n'
name|'conn'
op|'='
name|'context'
op|'['
string|"'conn'"
op|']'
newline|'\n'
comment|'# send commit confirmation to start phase2'
nl|'\n'
name|'commit_confirmation_doc'
op|'='
string|'"\\r\\n"'
op|'.'
name|'join'
op|'('
op|'('
nl|'\n'
string|'"X-Document: put commit"'
op|','
nl|'\n'
string|'""'
op|','
nl|'\n'
string|'"commit_confirmation"'
op|','
nl|'\n'
string|'"--boundary123--"'
op|','
nl|'\n'
op|')'
op|')'
newline|'\n'
name|'to_send'
op|'='
string|'"%x\\r\\n%s\\r\\n0\\r\\n\\r\\n"'
op|'%'
op|'('
name|'len'
op|'('
name|'commit_confirmation_doc'
op|')'
op|','
name|'commit_confirmation_doc'
op|')'
newline|'\n'
name|'conn'
op|'.'
name|'send'
op|'('
name|'to_send'
op|')'
newline|'\n'
nl|'\n'
comment|'# verify success (2xx) to make end of phase2'
nl|'\n'
name|'resp'
op|'='
name|'conn'
op|'.'
name|'getresponse'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'201'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'close'
op|'('
op|')'
newline|'\n'
nl|'\n'
comment|'# verify successful object data and durable state file write'
nl|'\n'
dedent|''
name|'put_timestamp'
op|'='
name|'context'
op|'['
string|"'put_timestamp'"
op|']'
newline|'\n'
name|'found_files'
op|'='
name|'self'
op|'.'
name|'find_files'
op|'('
op|')'
newline|'\n'
comment|'# .data file is there'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'len'
op|'('
name|'found_files'
op|'['
string|"'.data'"
op|']'
op|')'
op|','
number|'1'
op|')'
newline|'\n'
name|'obj_datafile'
op|'='
name|'found_files'
op|'['
string|"'.data'"
op|']'
op|'['
number|'0'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|'"%s#2.data"'
op|'%'
name|'put_timestamp'
op|'.'
name|'internal'
op|','
nl|'\n'
name|'os'
op|'.'
name|'path'
op|'.'
name|'basename'
op|'('
name|'obj_datafile'
op|')'
op|')'
newline|'\n'
comment|'# .durable file is there'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'len'
op|'('
name|'found_files'
op|'['
string|"'.durable'"
op|']'
op|')'
op|','
number|'1'
op|')'
newline|'\n'
name|'durable_file'
op|'='
name|'found_files'
op|'['
string|"'.durable'"
op|']'
op|'['
number|'0'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|'"%s.durable"'
op|'%'
name|'put_timestamp'
op|'.'
name|'internal'
op|','
nl|'\n'
name|'os'
op|'.'
name|'path'
op|'.'
name|'basename'
op|'('
name|'durable_file'
op|')'
op|')'
newline|'\n'
comment|'# And container update was called'
nl|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'context'
op|'['
string|"'mock_container_update'"
op|']'
op|'.'
name|'called'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_multiphase_put_bad_commit_message
dedent|''
name|'def'
name|'test_multiphase_put_bad_commit_message'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'with'
name|'self'
op|'.'
name|'_check_multiphase_put_commit_handling'
op|'('
op|')'
name|'as'
name|'context'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'='
name|'context'
op|'['
string|"'conn'"
op|']'
newline|'\n'
comment|'# send commit confirmation to start phase2'
nl|'\n'
name|'commit_confirmation_doc'
op|'='
string|'"\\r\\n"'
op|'.'
name|'join'
op|'('
op|'('
nl|'\n'
string|'"junkjunk"'
op|','
nl|'\n'
string|'"--boundary123--"'
op|','
nl|'\n'
op|')'
op|')'
newline|'\n'
name|'to_send'
op|'='
string|'"%x\\r\\n%s\\r\\n0\\r\\n\\r\\n"'
op|'%'
op|'('
name|'len'
op|'('
name|'commit_confirmation_doc'
op|')'
op|','
name|'commit_confirmation_doc'
op|')'
newline|'\n'
name|'conn'
op|'.'
name|'send'
op|'('
name|'to_send'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'conn'
op|'.'
name|'getresponse'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'500'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'close'
op|'('
op|')'
newline|'\n'
dedent|''
name|'put_timestamp'
op|'='
name|'context'
op|'['
string|"'put_timestamp'"
op|']'
newline|'\n'
name|'_container_update'
op|'='
name|'context'
op|'['
string|"'mock_container_update'"
op|']'
newline|'\n'
comment|'# verify that durable file was NOT created'
nl|'\n'
name|'found_files'
op|'='
name|'self'
op|'.'
name|'find_files'
op|'('
op|')'
newline|'\n'
comment|'# .data file is there'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'len'
op|'('
name|'found_files'
op|'['
string|"'.data'"
op|']'
op|')'
op|','
number|'1'
op|')'
newline|'\n'
name|'obj_datafile'
op|'='
name|'found_files'
op|'['
string|"'.data'"
op|']'
op|'['
number|'0'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|'"%s#2.data"'
op|'%'
name|'put_timestamp'
op|'.'
name|'internal'
op|','
nl|'\n'
name|'os'
op|'.'
name|'path'
op|'.'
name|'basename'
op|'('
name|'obj_datafile'
op|')'
op|')'
newline|'\n'
comment|"# but .durable isn't"
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'found_files'
op|'['
string|"'.durable'"
op|']'
op|','
op|'['
op|']'
op|')'
newline|'\n'
comment|'# And no container update'
nl|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'_container_update'
op|'.'
name|'called'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_multiphase_put_drains_extra_commit_junk
dedent|''
name|'def'
name|'test_multiphase_put_drains_extra_commit_junk'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'with'
name|'self'
op|'.'
name|'_check_multiphase_put_commit_handling'
op|'('
op|')'
name|'as'
name|'context'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'='
name|'context'
op|'['
string|"'conn'"
op|']'
newline|'\n'
comment|'# send commit confirmation to start phase2'
nl|'\n'
name|'commit_confirmation_doc'
op|'='
string|'"\\r\\n"'
op|'.'
name|'join'
op|'('
op|'('
nl|'\n'
string|'"X-Document: put commit"'
op|','
nl|'\n'
string|'""'
op|','
nl|'\n'
string|'"commit_confirmation"'
op|','
nl|'\n'
string|'"--boundary123"'
op|','
nl|'\n'
string|'"X-Document: we got cleverer"'
op|','
nl|'\n'
string|'""'
op|','
nl|'\n'
string|'"stuff stuff meaningless stuuuuuuuuuuff"'
op|','
nl|'\n'
string|'"--boundary123"'
op|','
nl|'\n'
string|'"X-Document: we got even cleverer; can you believe it?"'
op|','
nl|'\n'
string|'"Waneshaft: ambifacient lunar"'
op|','
nl|'\n'
string|'"Casing: malleable logarithmic"'
op|','
nl|'\n'
string|'""'
op|','
nl|'\n'
string|'"potato potato potato potato potato potato potato"'
op|','
nl|'\n'
string|'"--boundary123--"'
op|','
nl|'\n'
op|')'
op|')'
newline|'\n'
name|'to_send'
op|'='
string|'"%x\\r\\n%s\\r\\n0\\r\\n\\r\\n"'
op|'%'
op|'('
name|'len'
op|'('
name|'commit_confirmation_doc'
op|')'
op|','
name|'commit_confirmation_doc'
op|')'
newline|'\n'
name|'conn'
op|'.'
name|'send'
op|'('
name|'to_send'
op|')'
newline|'\n'
nl|'\n'
comment|'# verify success (2xx) to make end of phase2'
nl|'\n'
name|'resp'
op|'='
name|'conn'
op|'.'
name|'getresponse'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'201'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
nl|'\n'
comment|'# make another request to validate the HTTP protocol state'
nl|'\n'
name|'conn'
op|'.'
name|'putrequest'
op|'('
string|"'GET'"
op|','
string|"'/sda1/0/a/c/o'"
op|')'
newline|'\n'
name|'conn'
op|'.'
name|'putheader'
op|'('
string|"'X-Backend-Storage-Policy-Index'"
op|','
string|"'1'"
op|')'
newline|'\n'
name|'conn'
op|'.'
name|'endheaders'
op|'('
op|')'
newline|'\n'
name|'resp'
op|'='
name|'conn'
op|'.'
name|'getresponse'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status'
op|','
number|'200'
op|')'
newline|'\n'
name|'resp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'resp'
op|'.'
name|'close'
op|'('
op|')'
newline|'\n'
nl|'\n'
comment|'# verify successful object data and durable state file write'
nl|'\n'
dedent|''
name|'put_timestamp'
op|'='
name|'context'
op|'['
string|"'put_timestamp'"
op|']'
newline|'\n'
name|'found_files'
op|'='
name|'self'
op|'.'
name|'find_files'
op|'('
op|')'
newline|'\n'
comment|'# .data file is there'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'len'
op|'('
name|'found_files'
op|'['
string|"'.data'"
op|']'
op|')'
op|','
number|'1'
op|')'
newline|'\n'
name|'obj_datafile'
op|'='
name|'found_files'
op|'['
string|"'.data'"
op|']'
op|'['
number|'0'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|'"%s#2.data"'
op|'%'
name|'put_timestamp'
op|'.'
name|'internal'
op|','
nl|'\n'
name|'os'
op|'.'
name|'path'
op|'.'
name|'basename'
op|'('
name|'obj_datafile'
op|')'
op|')'
newline|'\n'
comment|'# .durable file is there'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'len'
op|'('
name|'found_files'
op|'['
string|"'.durable'"
op|']'
op|')'
op|','
number|'1'
op|')'
newline|'\n'
name|'durable_file'
op|'='
name|'found_files'
op|'['
string|"'.durable'"
op|']'
op|'['
number|'0'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|'"%s.durable"'
op|'%'
name|'put_timestamp'
op|'.'
name|'internal'
op|','
nl|'\n'
name|'os'
op|'.'
name|'path'
op|'.'
name|'basename'
op|'('
name|'durable_file'
op|')'
op|')'
newline|'\n'
comment|'# And container update was called'
nl|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'context'
op|'['
string|"'mock_container_update'"
op|']'
op|'.'
name|'called'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_multiphase_put_drains_extra_commit_junk_disconnect
dedent|''
name|'def'
name|'test_multiphase_put_drains_extra_commit_junk_disconnect'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'commit_confirmation_doc'
op|'='
string|'"\\r\\n"'
op|'.'
name|'join'
op|'('
op|'('
nl|'\n'
string|'"X-Document: put commit"'
op|','
nl|'\n'
string|'""'
op|','
nl|'\n'
string|'"commit_confirmation"'
op|','
nl|'\n'
string|'"--boundary123"'
op|','
nl|'\n'
string|'"X-Document: we got cleverer"'
op|','
nl|'\n'
string|'""'
op|','
nl|'\n'
string|'"stuff stuff meaningless stuuuuuuuuuuff"'
op|','
nl|'\n'
string|'"--boundary123"'
op|','
nl|'\n'
string|'"X-Document: we got even cleverer; can you believe it?"'
op|','
nl|'\n'
string|'"Waneshaft: ambifacient lunar"'
op|','
nl|'\n'
string|'"Casing: malleable logarithmic"'
op|','
nl|'\n'
string|'""'
op|','
nl|'\n'
string|'"potato potato potato potato potato potato potato"'
op|','
nl|'\n'
op|')'
op|')'
newline|'\n'
comment|"# eventlet.wsgi won't return < network_chunk_size from a chunked read"
nl|'\n'
name|'self'
op|'.'
name|'app'
op|'.'
name|'network_chunk_size'
op|'='
number|'16'
newline|'\n'
name|'with'
name|'self'
op|'.'
name|'_check_multiphase_put_commit_handling'
op|'('
op|')'
name|'as'
name|'context'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'='
name|'context'
op|'['
string|"'conn'"
op|']'
newline|'\n'
comment|'# send commit confirmation and some other stuff'
nl|'\n'
comment|"# but don't send final boundary or last chunk"
nl|'\n'
name|'to_send'
op|'='
string|'"%x\\r\\n%s\\r\\n"'
op|'%'
op|'('
name|'len'
op|'('
name|'commit_confirmation_doc'
op|')'
op|','
name|'commit_confirmation_doc'
op|')'
newline|'\n'
name|'conn'
op|'.'
name|'send'
op|'('
name|'to_send'
op|')'
newline|'\n'
nl|'\n'
comment|'# and then bail out'
nl|'\n'
name|'conn'
op|'.'
name|'sock'
op|'.'
name|'fd'
op|'.'
name|'_sock'
op|'.'
name|'close'
op|'('
op|')'
newline|'\n'
nl|'\n'
comment|'# and make sure it demonstrates the client disconnect'
nl|'\n'
dedent|''
name|'log_lines'
op|'='
name|'self'
op|'.'
name|'logger'
op|'.'
name|'get_lines_for_level'
op|'('
string|"'info'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'len'
op|'('
name|'log_lines'
op|')'
op|','
number|'1'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertIn'
op|'('
string|"' 499 '"
op|','
name|'log_lines'
op|'['
number|'0'
op|']'
op|')'
newline|'\n'
nl|'\n'
comment|'# verify successful object data and durable state file write'
nl|'\n'
name|'put_timestamp'
op|'='
name|'context'
op|'['
string|"'put_timestamp'"
op|']'
newline|'\n'
name|'found_files'
op|'='
name|'self'
op|'.'
name|'find_files'
op|'('
op|')'
newline|'\n'
comment|'# .data file is there'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'len'
op|'('
name|'found_files'
op|'['
string|"'.data'"
op|']'
op|')'
op|','
number|'1'
op|')'
newline|'\n'
name|'obj_datafile'
op|'='
name|'found_files'
op|'['
string|"'.data'"
op|']'
op|'['
number|'0'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|'"%s#2.data"'
op|'%'
name|'put_timestamp'
op|'.'
name|'internal'
op|','
nl|'\n'
name|'os'
op|'.'
name|'path'
op|'.'
name|'basename'
op|'('
name|'obj_datafile'
op|')'
op|')'
newline|'\n'
comment|'# ... and .durable is there'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'len'
op|'('
name|'found_files'
op|'['
string|"'.durable'"
op|']'
op|')'
op|','
number|'1'
op|')'
newline|'\n'
name|'durable_file'
op|'='
name|'found_files'
op|'['
string|"'.durable'"
op|']'
op|'['
number|'0'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|'"%s.durable"'
op|'%'
name|'put_timestamp'
op|'.'
name|'internal'
op|','
nl|'\n'
name|'os'
op|'.'
name|'path'
op|'.'
name|'basename'
op|'('
name|'durable_file'
op|')'
op|')'
newline|'\n'
comment|'# but no container update'
nl|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'context'
op|'['
string|"'mock_container_update'"
op|']'
op|'.'
name|'called'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
dedent|''
dedent|''
op|'@'
name|'patch_policies'
newline|'\n'
DECL|class|TestZeroCopy
name|'class'
name|'TestZeroCopy'
op|'('
name|'unittest'
op|'.'
name|'TestCase'
op|')'
op|':'
newline|'\n'
indent|'    '
string|'"""Test the object server\'s zero-copy functionality"""'
newline|'\n'
nl|'\n'
DECL|member|_system_can_zero_copy
name|'def'
name|'_system_can_zero_copy'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'not'
name|'splice'
op|'.'
name|'available'
op|':'
newline|'\n'
indent|'            '
name|'return'
name|'False'
newline|'\n'
nl|'\n'
dedent|''
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'utils'
op|'.'
name|'get_md5_socket'
op|'('
op|')'
newline|'\n'
dedent|''
name|'except'
name|'IOError'
op|':'
newline|'\n'
indent|'            '
name|'return'
name|'False'
newline|'\n'
nl|'\n'
dedent|''
name|'return'
name|'True'
newline|'\n'
nl|'\n'
DECL|member|setUp
dedent|''
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'not'
name|'self'
op|'.'
name|'_system_can_zero_copy'
op|'('
op|')'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'SkipTest'
op|'('
string|'"zero-copy support is missing"'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'testdir'
op|'='
name|'mkdtemp'
op|'('
name|'suffix'
op|'='
string|'"obj_server_zero_copy"'
op|')'
newline|'\n'
name|'mkdirs'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'self'
op|'.'
name|'testdir'
op|','
string|"'sda1'"
op|','
string|"'tmp'"
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'conf'
op|'='
op|'{'
string|"'devices'"
op|':'
name|'self'
op|'.'
name|'testdir'
op|','
nl|'\n'
string|"'mount_check'"
op|':'
string|"'false'"
op|','
nl|'\n'
string|"'splice'"
op|':'
string|"'yes'"
op|','
nl|'\n'
string|"'disk_chunk_size'"
op|':'
string|"'4096'"
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'object_controller'
op|'='
name|'object_server'
op|'.'
name|'ObjectController'
op|'('
nl|'\n'
name|'conf'
op|','
name|'logger'
op|'='
name|'debug_logger'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'df_mgr'
op|'='
name|'diskfile'
op|'.'
name|'DiskFileManager'
op|'('
nl|'\n'
name|'conf'
op|','
name|'self'
op|'.'
name|'object_controller'
op|'.'
name|'logger'
op|')'
newline|'\n'
nl|'\n'
name|'listener'
op|'='
name|'listen'
op|'('
op|'('
string|"'localhost'"
op|','
number|'0'
op|')'
op|')'
newline|'\n'
name|'port'
op|'='
name|'listener'
op|'.'
name|'getsockname'
op|'('
op|')'
op|'['
number|'1'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'wsgi_greenlet'
op|'='
name|'spawn'
op|'('
nl|'\n'
name|'wsgi'
op|'.'
name|'server'
op|','
name|'listener'
op|','
name|'self'
op|'.'
name|'object_controller'
op|','
name|'NullLogger'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'http_conn'
op|'='
name|'httplib'
op|'.'
name|'HTTPConnection'
op|'('
string|"'127.0.0.1'"
op|','
name|'port'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'http_conn'
op|'.'
name|'connect'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|tearDown
dedent|''
name|'def'
name|'tearDown'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Tear down for testing swift.object.server.ObjectController"""'
newline|'\n'
name|'self'
op|'.'
name|'wsgi_greenlet'
op|'.'
name|'kill'
op|'('
op|')'
newline|'\n'
name|'rmtree'
op|'('
name|'self'
op|'.'
name|'testdir'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_GET
dedent|''
name|'def'
name|'test_GET'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'url_path'
op|'='
string|"'/sda1/2100/a/c/o'"
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'http_conn'
op|'.'
name|'request'
op|'('
string|"'PUT'"
op|','
name|'url_path'
op|','
string|"'obj contents'"
op|','
nl|'\n'
op|'{'
string|"'X-Timestamp'"
op|':'
string|"'127082564.24709'"
op|'}'
op|')'
newline|'\n'
name|'response'
op|'='
name|'self'
op|'.'
name|'http_conn'
op|'.'
name|'getresponse'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'response'
op|'.'
name|'status'
op|','
number|'201'
op|')'
newline|'\n'
name|'response'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'http_conn'
op|'.'
name|'request'
op|'('
string|"'GET'"
op|','
name|'url_path'
op|')'
newline|'\n'
name|'response'
op|'='
name|'self'
op|'.'
name|'http_conn'
op|'.'
name|'getresponse'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'response'
op|'.'
name|'status'
op|','
number|'200'
op|')'
newline|'\n'
name|'contents'
op|'='
name|'response'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'contents'
op|','
string|"'obj contents'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_GET_big
dedent|''
name|'def'
name|'test_GET_big'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# Test with a large-ish object to make sure we handle full socket'
nl|'\n'
comment|'# buffers correctly.'
nl|'\n'
indent|'        '
name|'obj_contents'
op|'='
string|"'A'"
op|'*'
number|'4'
op|'*'
number|'1024'
op|'*'
number|'1024'
comment|'# 4 MiB'
newline|'\n'
name|'url_path'
op|'='
string|"'/sda1/2100/a/c/o'"
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'http_conn'
op|'.'
name|'request'
op|'('
string|"'PUT'"
op|','
name|'url_path'
op|','
name|'obj_contents'
op|','
nl|'\n'
op|'{'
string|"'X-Timestamp'"
op|':'
string|"'1402600322.52126'"
op|'}'
op|')'
newline|'\n'
name|'response'
op|'='
name|'self'
op|'.'
name|'http_conn'
op|'.'
name|'getresponse'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'response'
op|'.'
name|'status'
op|','
number|'201'
op|')'
newline|'\n'
name|'response'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'http_conn'
op|'.'
name|'request'
op|'('
string|"'GET'"
op|','
name|'url_path'
op|')'
newline|'\n'
name|'response'
op|'='
name|'self'
op|'.'
name|'http_conn'
op|'.'
name|'getresponse'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'response'
op|'.'
name|'status'
op|','
number|'200'
op|')'
newline|'\n'
name|'contents'
op|'='
name|'response'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'contents'
op|','
name|'obj_contents'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_quarantine
dedent|''
name|'def'
name|'test_quarantine'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'obj_hash'
op|'='
name|'hash_path'
op|'('
string|"'a'"
op|','
string|"'c'"
op|','
string|"'o'"
op|')'
newline|'\n'
name|'url_path'
op|'='
string|"'/sda1/2100/a/c/o'"
newline|'\n'
name|'ts'
op|'='
string|"'1402601849.47475'"
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'http_conn'
op|'.'
name|'request'
op|'('
string|"'PUT'"
op|','
name|'url_path'
op|','
string|"'obj contents'"
op|','
nl|'\n'
op|'{'
string|"'X-Timestamp'"
op|':'
name|'ts'
op|'}'
op|')'
newline|'\n'
name|'response'
op|'='
name|'self'
op|'.'
name|'http_conn'
op|'.'
name|'getresponse'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'response'
op|'.'
name|'status'
op|','
number|'201'
op|')'
newline|'\n'
name|'response'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
nl|'\n'
comment|'# go goof up the file on disk'
nl|'\n'
name|'fname'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'self'
op|'.'
name|'testdir'
op|','
string|"'sda1'"
op|','
string|"'objects'"
op|','
string|"'2100'"
op|','
nl|'\n'
name|'obj_hash'
op|'['
op|'-'
number|'3'
op|':'
op|']'
op|','
name|'obj_hash'
op|','
name|'ts'
op|'+'
string|"'.data'"
op|')'
newline|'\n'
nl|'\n'
name|'with'
name|'open'
op|'('
name|'fname'
op|','
string|"'rb+'"
op|')'
name|'as'
name|'fh'
op|':'
newline|'\n'
indent|'            '
name|'fh'
op|'.'
name|'write'
op|'('
string|"'XYZ'"
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'http_conn'
op|'.'
name|'request'
op|'('
string|"'GET'"
op|','
name|'url_path'
op|')'
newline|'\n'
name|'response'
op|'='
name|'self'
op|'.'
name|'http_conn'
op|'.'
name|'getresponse'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'response'
op|'.'
name|'status'
op|','
number|'200'
op|')'
newline|'\n'
name|'contents'
op|'='
name|'response'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'contents'
op|','
string|"'XYZ contents'"
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'http_conn'
op|'.'
name|'request'
op|'('
string|"'GET'"
op|','
name|'url_path'
op|')'
newline|'\n'
name|'response'
op|'='
name|'self'
op|'.'
name|'http_conn'
op|'.'
name|'getresponse'
op|'('
op|')'
newline|'\n'
comment|'# it was quarantined by the previous request'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'response'
op|'.'
name|'status'
op|','
number|'404'
op|')'
newline|'\n'
name|'response'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_quarantine_on_well_formed_zero_byte_file
dedent|''
name|'def'
name|'test_quarantine_on_well_formed_zero_byte_file'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|"# Make sure we work around an oddity in Linux's hash sockets"
nl|'\n'
indent|'        '
name|'url_path'
op|'='
string|"'/sda1/2100/a/c/o'"
newline|'\n'
name|'ts'
op|'='
string|"'1402700497.71333'"
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'http_conn'
op|'.'
name|'request'
op|'('
nl|'\n'
string|"'PUT'"
op|','
name|'url_path'
op|','
string|"''"
op|','
nl|'\n'
op|'{'
string|"'X-Timestamp'"
op|':'
name|'ts'
op|','
string|"'Content-Length'"
op|':'
string|"'0'"
op|'}'
op|')'
newline|'\n'
name|'response'
op|'='
name|'self'
op|'.'
name|'http_conn'
op|'.'
name|'getresponse'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'response'
op|'.'
name|'status'
op|','
number|'201'
op|')'
newline|'\n'
name|'response'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'http_conn'
op|'.'
name|'request'
op|'('
string|"'GET'"
op|','
name|'url_path'
op|')'
newline|'\n'
name|'response'
op|'='
name|'self'
op|'.'
name|'http_conn'
op|'.'
name|'getresponse'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'response'
op|'.'
name|'status'
op|','
number|'200'
op|')'
newline|'\n'
name|'contents'
op|'='
name|'response'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'contents'
op|','
string|"''"
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'http_conn'
op|'.'
name|'request'
op|'('
string|"'GET'"
op|','
name|'url_path'
op|')'
newline|'\n'
name|'response'
op|'='
name|'self'
op|'.'
name|'http_conn'
op|'.'
name|'getresponse'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'response'
op|'.'
name|'status'
op|','
number|'200'
op|')'
comment|'# still there'
newline|'\n'
name|'contents'
op|'='
name|'response'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'contents'
op|','
string|"''"
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
dedent|''
dedent|''
name|'if'
name|'__name__'
op|'=='
string|"'__main__'"
op|':'
newline|'\n'
indent|'    '
name|'unittest'
op|'.'
name|'main'
op|'('
op|')'
newline|'\n'
dedent|''
endmarker|''
end_unit
