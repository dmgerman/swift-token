begin_unit
comment|'# Copyright (c) 2011 OpenStack Foundation'
nl|'\n'
comment|'#'
nl|'\n'
comment|'# Licensed under the Apache License, Version 2.0 (the "License");'
nl|'\n'
comment|'# you may not use this file except in compliance with the License.'
nl|'\n'
comment|'# You may obtain a copy of the License at'
nl|'\n'
comment|'#'
nl|'\n'
comment|'#    http://www.apache.org/licenses/LICENSE-2.0'
nl|'\n'
comment|'#'
nl|'\n'
comment|'# Unless required by applicable law or agreed to in writing, software'
nl|'\n'
comment|'# distributed under the License is distributed on an "AS IS" BASIS,'
nl|'\n'
comment|'# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or'
nl|'\n'
comment|'# implied.'
nl|'\n'
comment|'# See the License for the specific language governing permissions and'
nl|'\n'
comment|'# limitations under the License.'
nl|'\n'
nl|'\n'
name|'from'
name|'time'
name|'import'
name|'time'
newline|'\n'
name|'from'
name|'unittest'
name|'import'
name|'main'
op|','
name|'TestCase'
newline|'\n'
name|'from'
name|'test'
op|'.'
name|'unit'
name|'import'
name|'FakeRing'
op|','
name|'mocked_http_conn'
op|','
name|'debug_logger'
newline|'\n'
name|'from'
name|'copy'
name|'import'
name|'deepcopy'
newline|'\n'
name|'from'
name|'tempfile'
name|'import'
name|'mkdtemp'
newline|'\n'
name|'from'
name|'shutil'
name|'import'
name|'rmtree'
newline|'\n'
nl|'\n'
name|'import'
name|'mock'
newline|'\n'
name|'import'
name|'six'
newline|'\n'
name|'from'
name|'six'
op|'.'
name|'moves'
name|'import'
name|'urllib'
newline|'\n'
nl|'\n'
name|'from'
name|'swift'
op|'.'
name|'common'
name|'import'
name|'internal_client'
op|','
name|'utils'
newline|'\n'
name|'from'
name|'swift'
op|'.'
name|'obj'
name|'import'
name|'expirer'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|function|not_random
name|'def'
name|'not_random'
op|'('
op|')'
op|':'
newline|'\n'
indent|'    '
name|'return'
number|'0.5'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|variable|last_not_sleep
dedent|''
name|'last_not_sleep'
op|'='
number|'0'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|function|not_sleep
name|'def'
name|'not_sleep'
op|'('
name|'seconds'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'global'
name|'last_not_sleep'
newline|'\n'
name|'last_not_sleep'
op|'='
name|'seconds'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|TestObjectExpirer
dedent|''
name|'class'
name|'TestObjectExpirer'
op|'('
name|'TestCase'
op|')'
op|':'
newline|'\n'
DECL|variable|maxDiff
indent|'    '
name|'maxDiff'
op|'='
name|'None'
newline|'\n'
DECL|variable|internal_client
name|'internal_client'
op|'='
name|'None'
newline|'\n'
nl|'\n'
DECL|member|setUp
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'global'
name|'not_sleep'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'old_loadapp'
op|'='
name|'internal_client'
op|'.'
name|'loadapp'
newline|'\n'
name|'self'
op|'.'
name|'old_sleep'
op|'='
name|'internal_client'
op|'.'
name|'sleep'
newline|'\n'
nl|'\n'
name|'internal_client'
op|'.'
name|'loadapp'
op|'='
name|'lambda'
op|'*'
name|'a'
op|','
op|'**'
name|'kw'
op|':'
name|'None'
newline|'\n'
name|'internal_client'
op|'.'
name|'sleep'
op|'='
name|'not_sleep'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'rcache'
op|'='
name|'mkdtemp'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'conf'
op|'='
op|'{'
string|"'recon_cache_path'"
op|':'
name|'self'
op|'.'
name|'rcache'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'logger'
op|'='
name|'debug_logger'
op|'('
string|"'test-recon'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|tearDown
dedent|''
name|'def'
name|'tearDown'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'rmtree'
op|'('
name|'self'
op|'.'
name|'rcache'
op|')'
newline|'\n'
name|'internal_client'
op|'.'
name|'sleep'
op|'='
name|'self'
op|'.'
name|'old_sleep'
newline|'\n'
name|'internal_client'
op|'.'
name|'loadapp'
op|'='
name|'self'
op|'.'
name|'old_loadapp'
newline|'\n'
nl|'\n'
DECL|member|test_get_process_values_from_kwargs
dedent|''
name|'def'
name|'test_get_process_values_from_kwargs'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'x'
op|'='
name|'expirer'
op|'.'
name|'ObjectExpirer'
op|'('
op|'{'
op|'}'
op|')'
newline|'\n'
name|'vals'
op|'='
op|'{'
nl|'\n'
string|"'processes'"
op|':'
number|'5'
op|','
nl|'\n'
string|"'process'"
op|':'
number|'1'
op|','
nl|'\n'
op|'}'
newline|'\n'
name|'x'
op|'.'
name|'get_process_values'
op|'('
name|'vals'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'x'
op|'.'
name|'processes'
op|','
number|'5'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'x'
op|'.'
name|'process'
op|','
number|'1'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_process_values_from_config
dedent|''
name|'def'
name|'test_get_process_values_from_config'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'vals'
op|'='
op|'{'
nl|'\n'
string|"'processes'"
op|':'
number|'5'
op|','
nl|'\n'
string|"'process'"
op|':'
number|'1'
op|','
nl|'\n'
op|'}'
newline|'\n'
name|'x'
op|'='
name|'expirer'
op|'.'
name|'ObjectExpirer'
op|'('
name|'vals'
op|')'
newline|'\n'
name|'x'
op|'.'
name|'get_process_values'
op|'('
op|'{'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'x'
op|'.'
name|'processes'
op|','
number|'5'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'x'
op|'.'
name|'process'
op|','
number|'1'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_process_values_negative_process
dedent|''
name|'def'
name|'test_get_process_values_negative_process'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'vals'
op|'='
op|'{'
nl|'\n'
string|"'processes'"
op|':'
number|'5'
op|','
nl|'\n'
string|"'process'"
op|':'
op|'-'
number|'1'
op|','
nl|'\n'
op|'}'
newline|'\n'
comment|'# from config'
nl|'\n'
name|'x'
op|'='
name|'expirer'
op|'.'
name|'ObjectExpirer'
op|'('
name|'vals'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ValueError'
op|','
name|'x'
op|'.'
name|'get_process_values'
op|','
op|'{'
op|'}'
op|')'
newline|'\n'
comment|'# from kwargs'
nl|'\n'
name|'x'
op|'='
name|'expirer'
op|'.'
name|'ObjectExpirer'
op|'('
op|'{'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ValueError'
op|','
name|'x'
op|'.'
name|'get_process_values'
op|','
name|'vals'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_process_values_negative_processes
dedent|''
name|'def'
name|'test_get_process_values_negative_processes'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'vals'
op|'='
op|'{'
nl|'\n'
string|"'processes'"
op|':'
op|'-'
number|'5'
op|','
nl|'\n'
string|"'process'"
op|':'
number|'1'
op|','
nl|'\n'
op|'}'
newline|'\n'
comment|'# from config'
nl|'\n'
name|'x'
op|'='
name|'expirer'
op|'.'
name|'ObjectExpirer'
op|'('
name|'vals'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ValueError'
op|','
name|'x'
op|'.'
name|'get_process_values'
op|','
op|'{'
op|'}'
op|')'
newline|'\n'
comment|'# from kwargs'
nl|'\n'
name|'x'
op|'='
name|'expirer'
op|'.'
name|'ObjectExpirer'
op|'('
op|'{'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ValueError'
op|','
name|'x'
op|'.'
name|'get_process_values'
op|','
name|'vals'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_process_values_process_greater_than_processes
dedent|''
name|'def'
name|'test_get_process_values_process_greater_than_processes'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'vals'
op|'='
op|'{'
nl|'\n'
string|"'processes'"
op|':'
number|'5'
op|','
nl|'\n'
string|"'process'"
op|':'
number|'7'
op|','
nl|'\n'
op|'}'
newline|'\n'
comment|'# from config'
nl|'\n'
name|'x'
op|'='
name|'expirer'
op|'.'
name|'ObjectExpirer'
op|'('
name|'vals'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ValueError'
op|','
name|'x'
op|'.'
name|'get_process_values'
op|','
op|'{'
op|'}'
op|')'
newline|'\n'
comment|'# from kwargs'
nl|'\n'
name|'x'
op|'='
name|'expirer'
op|'.'
name|'ObjectExpirer'
op|'('
op|'{'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ValueError'
op|','
name|'x'
op|'.'
name|'get_process_values'
op|','
name|'vals'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_init_concurrency_too_small
dedent|''
name|'def'
name|'test_init_concurrency_too_small'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'conf'
op|'='
op|'{'
nl|'\n'
string|"'concurrency'"
op|':'
number|'0'
op|','
nl|'\n'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ValueError'
op|','
name|'expirer'
op|'.'
name|'ObjectExpirer'
op|','
name|'conf'
op|')'
newline|'\n'
name|'conf'
op|'='
op|'{'
nl|'\n'
string|"'concurrency'"
op|':'
op|'-'
number|'1'
op|','
nl|'\n'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ValueError'
op|','
name|'expirer'
op|'.'
name|'ObjectExpirer'
op|','
name|'conf'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_process_based_concurrency
dedent|''
name|'def'
name|'test_process_based_concurrency'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|class|ObjectExpirer
indent|'        '
name|'class'
name|'ObjectExpirer'
op|'('
name|'expirer'
op|'.'
name|'ObjectExpirer'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|member|__init__
indent|'            '
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'conf'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'super'
op|'('
name|'ObjectExpirer'
op|','
name|'self'
op|')'
op|'.'
name|'__init__'
op|'('
name|'conf'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'processes'
op|'='
number|'3'
newline|'\n'
name|'self'
op|'.'
name|'deleted_objects'
op|'='
op|'{'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'obj_containers_in_order'
op|'='
op|'['
op|']'
newline|'\n'
nl|'\n'
DECL|member|delete_object
dedent|''
name|'def'
name|'delete_object'
op|'('
name|'self'
op|','
name|'actual_obj'
op|','
name|'timestamp'
op|','
name|'container'
op|','
name|'obj'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'if'
name|'container'
name|'not'
name|'in'
name|'self'
op|'.'
name|'deleted_objects'
op|':'
newline|'\n'
indent|'                    '
name|'self'
op|'.'
name|'deleted_objects'
op|'['
name|'container'
op|']'
op|'='
name|'set'
op|'('
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'deleted_objects'
op|'['
name|'container'
op|']'
op|'.'
name|'add'
op|'('
name|'obj'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'obj_containers_in_order'
op|'.'
name|'append'
op|'('
name|'container'
op|')'
newline|'\n'
nl|'\n'
DECL|class|InternalClient
dedent|''
dedent|''
name|'class'
name|'InternalClient'
op|'('
name|'object'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|member|__init__
indent|'            '
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'containers'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'containers'
op|'='
name|'containers'
newline|'\n'
nl|'\n'
DECL|member|get_account_info
dedent|''
name|'def'
name|'get_account_info'
op|'('
name|'self'
op|','
op|'*'
name|'a'
op|','
op|'**'
name|'kw'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'return'
name|'len'
op|'('
name|'self'
op|'.'
name|'containers'
op|'.'
name|'keys'
op|'('
op|')'
op|')'
op|','
name|'sum'
op|'('
op|'['
name|'len'
op|'('
name|'self'
op|'.'
name|'containers'
op|'['
name|'x'
op|']'
op|')'
name|'for'
name|'x'
name|'in'
name|'self'
op|'.'
name|'containers'
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|iter_containers
dedent|''
name|'def'
name|'iter_containers'
op|'('
name|'self'
op|','
op|'*'
name|'a'
op|','
op|'**'
name|'kw'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'return'
op|'['
op|'{'
string|"'name'"
op|':'
name|'six'
op|'.'
name|'text_type'
op|'('
name|'x'
op|')'
op|'}'
nl|'\n'
name|'for'
name|'x'
name|'in'
name|'self'
op|'.'
name|'containers'
op|'.'
name|'keys'
op|'('
op|')'
op|']'
newline|'\n'
nl|'\n'
DECL|member|iter_objects
dedent|''
name|'def'
name|'iter_objects'
op|'('
name|'self'
op|','
name|'account'
op|','
name|'container'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'return'
op|'['
op|'{'
string|"'name'"
op|':'
name|'six'
op|'.'
name|'text_type'
op|'('
name|'x'
op|')'
op|'}'
nl|'\n'
name|'for'
name|'x'
name|'in'
name|'self'
op|'.'
name|'containers'
op|'['
name|'container'
op|']'
op|']'
newline|'\n'
nl|'\n'
DECL|member|delete_container
dedent|''
name|'def'
name|'delete_container'
op|'('
op|'*'
name|'a'
op|','
op|'**'
name|'kw'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'pass'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'containers'
op|'='
op|'{'
nl|'\n'
string|"'0'"
op|':'
name|'set'
op|'('
string|"'1-one 2-two 3-three'"
op|'.'
name|'split'
op|'('
op|')'
op|')'
op|','
nl|'\n'
string|"'1'"
op|':'
name|'set'
op|'('
string|"'2-two 3-three 4-four'"
op|'.'
name|'split'
op|'('
op|')'
op|')'
op|','
nl|'\n'
string|"'2'"
op|':'
name|'set'
op|'('
string|"'5-five 6-six'"
op|'.'
name|'split'
op|'('
op|')'
op|')'
op|','
nl|'\n'
string|"'3'"
op|':'
name|'set'
op|'('
string|"u'7-seven\\u2661'"
op|'.'
name|'split'
op|'('
op|')'
op|')'
op|','
nl|'\n'
op|'}'
newline|'\n'
name|'x'
op|'='
name|'ObjectExpirer'
op|'('
name|'self'
op|'.'
name|'conf'
op|')'
newline|'\n'
name|'x'
op|'.'
name|'swift'
op|'='
name|'InternalClient'
op|'('
name|'containers'
op|')'
newline|'\n'
nl|'\n'
name|'deleted_objects'
op|'='
op|'{'
op|'}'
newline|'\n'
name|'for'
name|'i'
name|'in'
name|'range'
op|'('
number|'3'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'x'
op|'.'
name|'process'
op|'='
name|'i'
newline|'\n'
name|'x'
op|'.'
name|'run_once'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertNotEqual'
op|'('
name|'deleted_objects'
op|','
name|'x'
op|'.'
name|'deleted_objects'
op|')'
newline|'\n'
DECL|variable|deleted_objects
name|'deleted_objects'
op|'='
name|'deepcopy'
op|'('
name|'x'
op|'.'
name|'deleted_objects'
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'containers'
op|'['
string|"'3'"
op|']'
op|'.'
name|'pop'
op|'('
op|')'
op|','
nl|'\n'
name|'deleted_objects'
op|'['
string|"'3'"
op|']'
op|'.'
name|'pop'
op|'('
op|')'
op|'.'
name|'decode'
op|'('
string|"'utf8'"
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'containers'
op|','
name|'deleted_objects'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'len'
op|'('
name|'set'
op|'('
name|'x'
op|'.'
name|'obj_containers_in_order'
op|'['
op|':'
number|'4'
op|']'
op|')'
op|')'
op|','
number|'4'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_delete_object
dedent|''
name|'def'
name|'test_delete_object'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
DECL|class|InternalClient
indent|'        '
name|'class'
name|'InternalClient'
op|'('
name|'object'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|variable|container_ring
indent|'            '
name|'container_ring'
op|'='
name|'None'
newline|'\n'
nl|'\n'
DECL|member|__init__
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'test'
op|','
name|'account'
op|','
name|'container'
op|','
name|'obj'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'test'
op|'='
name|'test'
newline|'\n'
name|'self'
op|'.'
name|'account'
op|'='
name|'account'
newline|'\n'
name|'self'
op|'.'
name|'container'
op|'='
name|'container'
newline|'\n'
name|'self'
op|'.'
name|'obj'
op|'='
name|'obj'
newline|'\n'
name|'self'
op|'.'
name|'delete_object_called'
op|'='
name|'False'
newline|'\n'
nl|'\n'
DECL|class|DeleteActualObject
dedent|''
dedent|''
name|'class'
name|'DeleteActualObject'
op|'('
name|'object'
op|')'
op|':'
newline|'\n'
DECL|member|__init__
indent|'            '
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'test'
op|','
name|'actual_obj'
op|','
name|'timestamp'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'test'
op|'='
name|'test'
newline|'\n'
name|'self'
op|'.'
name|'actual_obj'
op|'='
name|'actual_obj'
newline|'\n'
name|'self'
op|'.'
name|'timestamp'
op|'='
name|'timestamp'
newline|'\n'
name|'self'
op|'.'
name|'called'
op|'='
name|'False'
newline|'\n'
nl|'\n'
DECL|member|__call__
dedent|''
name|'def'
name|'__call__'
op|'('
name|'self'
op|','
name|'actual_obj'
op|','
name|'timestamp'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'test'
op|'.'
name|'assertEqual'
op|'('
name|'self'
op|'.'
name|'actual_obj'
op|','
name|'actual_obj'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'test'
op|'.'
name|'assertEqual'
op|'('
name|'self'
op|'.'
name|'timestamp'
op|','
name|'timestamp'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'called'
op|'='
name|'True'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'container'
op|'='
string|"'container'"
newline|'\n'
name|'obj'
op|'='
string|"'obj'"
newline|'\n'
name|'actual_obj'
op|'='
string|"'actual_obj'"
newline|'\n'
name|'timestamp'
op|'='
string|"'timestamp'"
newline|'\n'
nl|'\n'
name|'x'
op|'='
name|'expirer'
op|'.'
name|'ObjectExpirer'
op|'('
op|'{'
op|'}'
op|','
name|'logger'
op|'='
name|'self'
op|'.'
name|'logger'
op|')'
newline|'\n'
name|'x'
op|'.'
name|'swift'
op|'='
name|'InternalClient'
op|'('
name|'self'
op|','
name|'x'
op|'.'
name|'expiring_objects_account'
op|','
name|'container'
op|','
name|'obj'
op|')'
newline|'\n'
name|'x'
op|'.'
name|'delete_actual_object'
op|'='
name|'DeleteActualObject'
op|'('
name|'self'
op|','
name|'actual_obj'
op|','
name|'timestamp'
op|')'
newline|'\n'
nl|'\n'
name|'delete_object_called'
op|'='
op|'['
op|']'
newline|'\n'
nl|'\n'
DECL|function|pop_queue
name|'def'
name|'pop_queue'
op|'('
name|'c'
op|','
name|'o'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'container'
op|','
name|'c'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'obj'
op|','
name|'o'
op|')'
newline|'\n'
name|'delete_object_called'
op|'['
op|':'
op|']'
op|'='
op|'['
name|'True'
op|']'
newline|'\n'
nl|'\n'
dedent|''
name|'x'
op|'.'
name|'pop_queue'
op|'='
name|'pop_queue'
newline|'\n'
nl|'\n'
name|'x'
op|'.'
name|'delete_object'
op|'('
name|'actual_obj'
op|','
name|'timestamp'
op|','
name|'container'
op|','
name|'obj'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'delete_object_called'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'x'
op|'.'
name|'delete_actual_object'
op|'.'
name|'called'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_report
dedent|''
name|'def'
name|'test_report'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'x'
op|'='
name|'expirer'
op|'.'
name|'ObjectExpirer'
op|'('
op|'{'
op|'}'
op|','
name|'logger'
op|'='
name|'self'
op|'.'
name|'logger'
op|')'
newline|'\n'
nl|'\n'
name|'x'
op|'.'
name|'report'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'x'
op|'.'
name|'logger'
op|'.'
name|'get_lines_for_level'
op|'('
string|"'info'"
op|')'
op|','
op|'['
op|']'
op|')'
newline|'\n'
nl|'\n'
name|'x'
op|'.'
name|'logger'
op|'.'
name|'_clear'
op|'('
op|')'
newline|'\n'
name|'x'
op|'.'
name|'report'
op|'('
name|'final'
op|'='
name|'True'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
nl|'\n'
string|"'completed'"
name|'in'
name|'str'
op|'('
name|'x'
op|'.'
name|'logger'
op|'.'
name|'get_lines_for_level'
op|'('
string|"'info'"
op|')'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
nl|'\n'
string|"'so far'"
name|'not'
name|'in'
name|'str'
op|'('
name|'x'
op|'.'
name|'logger'
op|'.'
name|'get_lines_for_level'
op|'('
string|"'info'"
op|')'
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'x'
op|'.'
name|'logger'
op|'.'
name|'_clear'
op|'('
op|')'
newline|'\n'
name|'x'
op|'.'
name|'report_last_time'
op|'='
name|'time'
op|'('
op|')'
op|'-'
name|'x'
op|'.'
name|'report_interval'
newline|'\n'
name|'x'
op|'.'
name|'report'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
nl|'\n'
string|"'completed'"
name|'not'
name|'in'
name|'str'
op|'('
name|'x'
op|'.'
name|'logger'
op|'.'
name|'get_lines_for_level'
op|'('
string|"'info'"
op|')'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
nl|'\n'
string|"'so far'"
name|'in'
name|'str'
op|'('
name|'x'
op|'.'
name|'logger'
op|'.'
name|'get_lines_for_level'
op|'('
string|"'info'"
op|')'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_run_once_nothing_to_do
dedent|''
name|'def'
name|'test_run_once_nothing_to_do'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'x'
op|'='
name|'expirer'
op|'.'
name|'ObjectExpirer'
op|'('
name|'self'
op|'.'
name|'conf'
op|','
name|'logger'
op|'='
name|'self'
op|'.'
name|'logger'
op|')'
newline|'\n'
name|'x'
op|'.'
name|'swift'
op|'='
string|"'throw error because a string does not have needed methods'"
newline|'\n'
name|'x'
op|'.'
name|'run_once'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'x'
op|'.'
name|'logger'
op|'.'
name|'get_lines_for_level'
op|'('
string|"'error'"
op|')'
op|','
nl|'\n'
op|'['
string|'"Unhandled exception: "'
op|']'
op|')'
newline|'\n'
name|'log_args'
op|','
name|'log_kwargs'
op|'='
name|'x'
op|'.'
name|'logger'
op|'.'
name|'log_dict'
op|'['
string|"'error'"
op|']'
op|'['
number|'0'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'str'
op|'('
name|'log_kwargs'
op|'['
string|"'exc_info'"
op|']'
op|'['
number|'1'
op|']'
op|')'
op|','
nl|'\n'
string|'"\'str\' object has no attribute \'get_account_info\'"'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_run_once_calls_report
dedent|''
name|'def'
name|'test_run_once_calls_report'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
DECL|class|InternalClient
indent|'        '
name|'class'
name|'InternalClient'
op|'('
name|'object'
op|')'
op|':'
newline|'\n'
DECL|member|get_account_info
indent|'            '
name|'def'
name|'get_account_info'
op|'('
op|'*'
name|'a'
op|','
op|'**'
name|'kw'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'return'
number|'1'
op|','
number|'2'
newline|'\n'
nl|'\n'
DECL|member|iter_containers
dedent|''
name|'def'
name|'iter_containers'
op|'('
op|'*'
name|'a'
op|','
op|'**'
name|'kw'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'return'
op|'['
op|']'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'x'
op|'='
name|'expirer'
op|'.'
name|'ObjectExpirer'
op|'('
name|'self'
op|'.'
name|'conf'
op|','
name|'logger'
op|'='
name|'self'
op|'.'
name|'logger'
op|')'
newline|'\n'
name|'x'
op|'.'
name|'swift'
op|'='
name|'InternalClient'
op|'('
op|')'
newline|'\n'
name|'x'
op|'.'
name|'run_once'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
nl|'\n'
name|'x'
op|'.'
name|'logger'
op|'.'
name|'get_lines_for_level'
op|'('
string|"'info'"
op|')'
op|','
op|'['
nl|'\n'
string|"'Pass beginning; 1 possible containers; 2 possible objects'"
op|','
nl|'\n'
string|"'Pass completed in 0s; 0 objects expired'"
op|','
nl|'\n'
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_run_once_unicode_problem
dedent|''
name|'def'
name|'test_run_once_unicode_problem'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
DECL|class|InternalClient
indent|'        '
name|'class'
name|'InternalClient'
op|'('
name|'object'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|variable|container_ring
indent|'            '
name|'container_ring'
op|'='
name|'FakeRing'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|get_account_info
name|'def'
name|'get_account_info'
op|'('
op|'*'
name|'a'
op|','
op|'**'
name|'kw'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'return'
number|'1'
op|','
number|'2'
newline|'\n'
nl|'\n'
DECL|member|iter_containers
dedent|''
name|'def'
name|'iter_containers'
op|'('
op|'*'
name|'a'
op|','
op|'**'
name|'kw'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'return'
op|'['
op|'{'
string|"'name'"
op|':'
string|"u'1234'"
op|'}'
op|']'
newline|'\n'
nl|'\n'
DECL|member|iter_objects
dedent|''
name|'def'
name|'iter_objects'
op|'('
op|'*'
name|'a'
op|','
op|'**'
name|'kw'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'return'
op|'['
op|'{'
string|"'name'"
op|':'
string|"u'1234-troms\\xf8'"
op|'}'
op|']'
newline|'\n'
nl|'\n'
DECL|member|make_request
dedent|''
name|'def'
name|'make_request'
op|'('
op|'*'
name|'a'
op|','
op|'**'
name|'kw'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'pass'
newline|'\n'
nl|'\n'
DECL|member|delete_container
dedent|''
name|'def'
name|'delete_container'
op|'('
op|'*'
name|'a'
op|','
op|'**'
name|'kw'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'pass'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'x'
op|'='
name|'expirer'
op|'.'
name|'ObjectExpirer'
op|'('
name|'self'
op|'.'
name|'conf'
op|','
name|'logger'
op|'='
name|'self'
op|'.'
name|'logger'
op|')'
newline|'\n'
name|'x'
op|'.'
name|'swift'
op|'='
name|'InternalClient'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'requests'
op|'='
op|'['
op|']'
newline|'\n'
nl|'\n'
DECL|function|capture_requests
name|'def'
name|'capture_requests'
op|'('
name|'ipaddr'
op|','
name|'port'
op|','
name|'method'
op|','
name|'path'
op|','
op|'*'
name|'args'
op|','
op|'**'
name|'kwargs'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'requests'
op|'.'
name|'append'
op|'('
op|'('
name|'method'
op|','
name|'path'
op|')'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'with'
name|'mocked_http_conn'
op|'('
nl|'\n'
number|'200'
op|','
number|'200'
op|','
number|'200'
op|','
name|'give_connect'
op|'='
name|'capture_requests'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'x'
op|'.'
name|'run_once'
op|'('
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'len'
op|'('
name|'requests'
op|')'
op|','
number|'3'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_container_timestamp_break
dedent|''
name|'def'
name|'test_container_timestamp_break'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
DECL|class|InternalClient
indent|'        '
name|'class'
name|'InternalClient'
op|'('
name|'object'
op|')'
op|':'
newline|'\n'
DECL|member|__init__
indent|'            '
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'containers'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'containers'
op|'='
name|'containers'
newline|'\n'
nl|'\n'
DECL|member|get_account_info
dedent|''
name|'def'
name|'get_account_info'
op|'('
op|'*'
name|'a'
op|','
op|'**'
name|'kw'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'return'
number|'1'
op|','
number|'2'
newline|'\n'
nl|'\n'
DECL|member|iter_containers
dedent|''
name|'def'
name|'iter_containers'
op|'('
name|'self'
op|','
op|'*'
name|'a'
op|','
op|'**'
name|'kw'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'return'
name|'self'
op|'.'
name|'containers'
newline|'\n'
nl|'\n'
DECL|member|iter_objects
dedent|''
name|'def'
name|'iter_objects'
op|'('
op|'*'
name|'a'
op|','
op|'**'
name|'kw'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'raise'
name|'Exception'
op|'('
string|"'This should not have been called'"
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'x'
op|'='
name|'expirer'
op|'.'
name|'ObjectExpirer'
op|'('
name|'self'
op|'.'
name|'conf'
op|','
nl|'\n'
name|'logger'
op|'='
name|'self'
op|'.'
name|'logger'
op|')'
newline|'\n'
name|'x'
op|'.'
name|'swift'
op|'='
name|'InternalClient'
op|'('
op|'['
op|'{'
string|"'name'"
op|':'
name|'str'
op|'('
name|'int'
op|'('
name|'time'
op|'('
op|')'
op|'+'
number|'86400'
op|')'
op|')'
op|'}'
op|']'
op|')'
newline|'\n'
name|'x'
op|'.'
name|'run_once'
op|'('
op|')'
newline|'\n'
name|'logs'
op|'='
name|'x'
op|'.'
name|'logger'
op|'.'
name|'all_log_lines'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'logs'
op|'['
string|"'info'"
op|']'
op|','
op|'['
nl|'\n'
string|"'Pass beginning; 1 possible containers; 2 possible objects'"
op|','
nl|'\n'
string|"'Pass completed in 0s; 0 objects expired'"
op|','
nl|'\n'
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
string|"'error'"
name|'not'
name|'in'
name|'logs'
op|')'
newline|'\n'
nl|'\n'
comment|'# Reverse test to be sure it still would blow up the way expected.'
nl|'\n'
name|'fake_swift'
op|'='
name|'InternalClient'
op|'('
op|'['
op|'{'
string|"'name'"
op|':'
name|'str'
op|'('
name|'int'
op|'('
name|'time'
op|'('
op|')'
op|'-'
number|'86400'
op|')'
op|')'
op|'}'
op|']'
op|')'
newline|'\n'
name|'x'
op|'='
name|'expirer'
op|'.'
name|'ObjectExpirer'
op|'('
name|'self'
op|'.'
name|'conf'
op|','
name|'logger'
op|'='
name|'self'
op|'.'
name|'logger'
op|','
nl|'\n'
name|'swift'
op|'='
name|'fake_swift'
op|')'
newline|'\n'
name|'x'
op|'.'
name|'run_once'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
nl|'\n'
name|'x'
op|'.'
name|'logger'
op|'.'
name|'get_lines_for_level'
op|'('
string|"'error'"
op|')'
op|','
op|'['
nl|'\n'
string|"'Unhandled exception: '"
op|']'
op|')'
newline|'\n'
name|'log_args'
op|','
name|'log_kwargs'
op|'='
name|'x'
op|'.'
name|'logger'
op|'.'
name|'log_dict'
op|'['
string|"'error'"
op|']'
op|'['
op|'-'
number|'1'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'str'
op|'('
name|'log_kwargs'
op|'['
string|"'exc_info'"
op|']'
op|'['
number|'1'
op|']'
op|')'
op|','
nl|'\n'
string|"'This should not have been called'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_object_timestamp_break
dedent|''
name|'def'
name|'test_object_timestamp_break'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
DECL|class|InternalClient
indent|'        '
name|'class'
name|'InternalClient'
op|'('
name|'object'
op|')'
op|':'
newline|'\n'
DECL|member|__init__
indent|'            '
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'containers'
op|','
name|'objects'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'containers'
op|'='
name|'containers'
newline|'\n'
name|'self'
op|'.'
name|'objects'
op|'='
name|'objects'
newline|'\n'
nl|'\n'
DECL|member|get_account_info
dedent|''
name|'def'
name|'get_account_info'
op|'('
op|'*'
name|'a'
op|','
op|'**'
name|'kw'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'return'
number|'1'
op|','
number|'2'
newline|'\n'
nl|'\n'
DECL|member|iter_containers
dedent|''
name|'def'
name|'iter_containers'
op|'('
name|'self'
op|','
op|'*'
name|'a'
op|','
op|'**'
name|'kw'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'return'
name|'self'
op|'.'
name|'containers'
newline|'\n'
nl|'\n'
DECL|member|delete_container
dedent|''
name|'def'
name|'delete_container'
op|'('
op|'*'
name|'a'
op|','
op|'**'
name|'kw'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'pass'
newline|'\n'
nl|'\n'
DECL|member|iter_objects
dedent|''
name|'def'
name|'iter_objects'
op|'('
name|'self'
op|','
op|'*'
name|'a'
op|','
op|'**'
name|'kw'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'return'
name|'self'
op|'.'
name|'objects'
newline|'\n'
nl|'\n'
DECL|function|should_not_be_called
dedent|''
dedent|''
name|'def'
name|'should_not_be_called'
op|'('
op|'*'
name|'a'
op|','
op|'**'
name|'kw'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'Exception'
op|'('
string|"'This should not have been called'"
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'fake_swift'
op|'='
name|'InternalClient'
op|'('
nl|'\n'
op|'['
op|'{'
string|"'name'"
op|':'
name|'str'
op|'('
name|'int'
op|'('
name|'time'
op|'('
op|')'
op|'-'
number|'86400'
op|')'
op|')'
op|'}'
op|']'
op|','
nl|'\n'
op|'['
op|'{'
string|"'name'"
op|':'
string|"'%d-actual-obj'"
op|'%'
name|'int'
op|'('
name|'time'
op|'('
op|')'
op|'+'
number|'86400'
op|')'
op|'}'
op|']'
op|')'
newline|'\n'
name|'x'
op|'='
name|'expirer'
op|'.'
name|'ObjectExpirer'
op|'('
name|'self'
op|'.'
name|'conf'
op|','
name|'logger'
op|'='
name|'self'
op|'.'
name|'logger'
op|','
nl|'\n'
name|'swift'
op|'='
name|'fake_swift'
op|')'
newline|'\n'
name|'x'
op|'.'
name|'run_once'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
string|"'error'"
name|'not'
name|'in'
name|'x'
op|'.'
name|'logger'
op|'.'
name|'all_log_lines'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'x'
op|'.'
name|'logger'
op|'.'
name|'get_lines_for_level'
op|'('
string|"'info'"
op|')'
op|','
op|'['
nl|'\n'
string|"'Pass beginning; 1 possible containers; 2 possible objects'"
op|','
nl|'\n'
string|"'Pass completed in 0s; 0 objects expired'"
op|','
nl|'\n'
op|']'
op|')'
newline|'\n'
comment|'# Reverse test to be sure it still would blow up the way expected.'
nl|'\n'
name|'ts'
op|'='
name|'int'
op|'('
name|'time'
op|'('
op|')'
op|'-'
number|'86400'
op|')'
newline|'\n'
name|'fake_swift'
op|'='
name|'InternalClient'
op|'('
nl|'\n'
op|'['
op|'{'
string|"'name'"
op|':'
name|'str'
op|'('
name|'int'
op|'('
name|'time'
op|'('
op|')'
op|'-'
number|'86400'
op|')'
op|')'
op|'}'
op|']'
op|','
nl|'\n'
op|'['
op|'{'
string|"'name'"
op|':'
string|"'%d-actual-obj'"
op|'%'
name|'ts'
op|'}'
op|']'
op|')'
newline|'\n'
name|'x'
op|'='
name|'expirer'
op|'.'
name|'ObjectExpirer'
op|'('
name|'self'
op|'.'
name|'conf'
op|','
name|'logger'
op|'='
name|'self'
op|'.'
name|'logger'
op|','
nl|'\n'
name|'swift'
op|'='
name|'fake_swift'
op|')'
newline|'\n'
name|'x'
op|'.'
name|'delete_actual_object'
op|'='
name|'should_not_be_called'
newline|'\n'
name|'x'
op|'.'
name|'run_once'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
nl|'\n'
name|'x'
op|'.'
name|'logger'
op|'.'
name|'get_lines_for_level'
op|'('
string|"'error'"
op|')'
op|','
nl|'\n'
op|'['
string|"'Exception while deleting object %d %d-actual-obj '"
nl|'\n'
string|"'This should not have been called: '"
op|'%'
op|'('
name|'ts'
op|','
name|'ts'
op|')'
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_failed_delete_keeps_entry
dedent|''
name|'def'
name|'test_failed_delete_keeps_entry'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
DECL|class|InternalClient
indent|'        '
name|'class'
name|'InternalClient'
op|'('
name|'object'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|variable|container_ring
indent|'            '
name|'container_ring'
op|'='
name|'None'
newline|'\n'
nl|'\n'
DECL|member|__init__
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'containers'
op|','
name|'objects'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'containers'
op|'='
name|'containers'
newline|'\n'
name|'self'
op|'.'
name|'objects'
op|'='
name|'objects'
newline|'\n'
nl|'\n'
DECL|member|get_account_info
dedent|''
name|'def'
name|'get_account_info'
op|'('
op|'*'
name|'a'
op|','
op|'**'
name|'kw'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'return'
number|'1'
op|','
number|'2'
newline|'\n'
nl|'\n'
DECL|member|iter_containers
dedent|''
name|'def'
name|'iter_containers'
op|'('
name|'self'
op|','
op|'*'
name|'a'
op|','
op|'**'
name|'kw'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'return'
name|'self'
op|'.'
name|'containers'
newline|'\n'
nl|'\n'
DECL|member|delete_container
dedent|''
name|'def'
name|'delete_container'
op|'('
op|'*'
name|'a'
op|','
op|'**'
name|'kw'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'pass'
newline|'\n'
nl|'\n'
DECL|member|iter_objects
dedent|''
name|'def'
name|'iter_objects'
op|'('
name|'self'
op|','
op|'*'
name|'a'
op|','
op|'**'
name|'kw'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'return'
name|'self'
op|'.'
name|'objects'
newline|'\n'
nl|'\n'
DECL|function|deliberately_blow_up
dedent|''
dedent|''
name|'def'
name|'deliberately_blow_up'
op|'('
name|'actual_obj'
op|','
name|'timestamp'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'Exception'
op|'('
string|"'failed to delete actual object'"
op|')'
newline|'\n'
nl|'\n'
DECL|function|should_not_get_called
dedent|''
name|'def'
name|'should_not_get_called'
op|'('
name|'container'
op|','
name|'obj'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'Exception'
op|'('
string|"'This should not have been called'"
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'ts'
op|'='
name|'int'
op|'('
name|'time'
op|'('
op|')'
op|'-'
number|'86400'
op|')'
newline|'\n'
name|'fake_swift'
op|'='
name|'InternalClient'
op|'('
nl|'\n'
op|'['
op|'{'
string|"'name'"
op|':'
name|'str'
op|'('
name|'int'
op|'('
name|'time'
op|'('
op|')'
op|'-'
number|'86400'
op|')'
op|')'
op|'}'
op|']'
op|','
nl|'\n'
op|'['
op|'{'
string|"'name'"
op|':'
string|"'%d-actual-obj'"
op|'%'
name|'ts'
op|'}'
op|']'
op|')'
newline|'\n'
name|'x'
op|'='
name|'expirer'
op|'.'
name|'ObjectExpirer'
op|'('
name|'self'
op|'.'
name|'conf'
op|','
name|'logger'
op|'='
name|'self'
op|'.'
name|'logger'
op|','
nl|'\n'
name|'swift'
op|'='
name|'fake_swift'
op|')'
newline|'\n'
name|'x'
op|'.'
name|'iter_containers'
op|'='
name|'lambda'
op|':'
op|'['
name|'str'
op|'('
name|'int'
op|'('
name|'time'
op|'('
op|')'
op|'-'
number|'86400'
op|')'
op|')'
op|']'
newline|'\n'
name|'x'
op|'.'
name|'delete_actual_object'
op|'='
name|'deliberately_blow_up'
newline|'\n'
name|'x'
op|'.'
name|'pop_queue'
op|'='
name|'should_not_get_called'
newline|'\n'
name|'x'
op|'.'
name|'run_once'
op|'('
op|')'
newline|'\n'
name|'error_lines'
op|'='
name|'x'
op|'.'
name|'logger'
op|'.'
name|'get_lines_for_level'
op|'('
string|"'error'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
nl|'\n'
name|'error_lines'
op|','
nl|'\n'
op|'['
string|"'Exception while deleting object %d %d-actual-obj '"
nl|'\n'
string|"'failed to delete actual object: '"
op|'%'
op|'('
name|'ts'
op|','
name|'ts'
op|')'
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
nl|'\n'
name|'x'
op|'.'
name|'logger'
op|'.'
name|'get_lines_for_level'
op|'('
string|"'info'"
op|')'
op|','
op|'['
nl|'\n'
string|"'Pass beginning; 1 possible containers; 2 possible objects'"
op|','
nl|'\n'
string|"'Pass completed in 0s; 0 objects expired'"
op|','
nl|'\n'
op|']'
op|')'
newline|'\n'
nl|'\n'
comment|'# Reverse test to be sure it still would blow up the way expected.'
nl|'\n'
name|'ts'
op|'='
name|'int'
op|'('
name|'time'
op|'('
op|')'
op|'-'
number|'86400'
op|')'
newline|'\n'
name|'fake_swift'
op|'='
name|'InternalClient'
op|'('
nl|'\n'
op|'['
op|'{'
string|"'name'"
op|':'
name|'str'
op|'('
name|'int'
op|'('
name|'time'
op|'('
op|')'
op|'-'
number|'86400'
op|')'
op|')'
op|'}'
op|']'
op|','
nl|'\n'
op|'['
op|'{'
string|"'name'"
op|':'
string|"'%d-actual-obj'"
op|'%'
name|'ts'
op|'}'
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'logger'
op|'.'
name|'_clear'
op|'('
op|')'
newline|'\n'
name|'x'
op|'='
name|'expirer'
op|'.'
name|'ObjectExpirer'
op|'('
name|'self'
op|'.'
name|'conf'
op|','
name|'logger'
op|'='
name|'self'
op|'.'
name|'logger'
op|','
nl|'\n'
name|'swift'
op|'='
name|'fake_swift'
op|')'
newline|'\n'
name|'x'
op|'.'
name|'delete_actual_object'
op|'='
name|'lambda'
name|'o'
op|','
name|'t'
op|':'
name|'None'
newline|'\n'
name|'x'
op|'.'
name|'pop_queue'
op|'='
name|'should_not_get_called'
newline|'\n'
name|'x'
op|'.'
name|'run_once'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'logger'
op|'.'
name|'get_lines_for_level'
op|'('
string|"'error'"
op|')'
op|','
nl|'\n'
op|'['
string|"'Exception while deleting object %d %d-actual-obj This should '"
nl|'\n'
string|"'not have been called: '"
op|'%'
op|'('
name|'ts'
op|','
name|'ts'
op|')'
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_success_gets_counted
dedent|''
name|'def'
name|'test_success_gets_counted'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
DECL|class|InternalClient
indent|'        '
name|'class'
name|'InternalClient'
op|'('
name|'object'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|variable|container_ring
indent|'            '
name|'container_ring'
op|'='
name|'None'
newline|'\n'
nl|'\n'
DECL|member|__init__
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'containers'
op|','
name|'objects'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'containers'
op|'='
name|'containers'
newline|'\n'
name|'self'
op|'.'
name|'objects'
op|'='
name|'objects'
newline|'\n'
nl|'\n'
DECL|member|get_account_info
dedent|''
name|'def'
name|'get_account_info'
op|'('
op|'*'
name|'a'
op|','
op|'**'
name|'kw'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'return'
number|'1'
op|','
number|'2'
newline|'\n'
nl|'\n'
DECL|member|iter_containers
dedent|''
name|'def'
name|'iter_containers'
op|'('
name|'self'
op|','
op|'*'
name|'a'
op|','
op|'**'
name|'kw'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'return'
name|'self'
op|'.'
name|'containers'
newline|'\n'
nl|'\n'
DECL|member|delete_container
dedent|''
name|'def'
name|'delete_container'
op|'('
op|'*'
name|'a'
op|','
op|'**'
name|'kw'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'pass'
newline|'\n'
nl|'\n'
DECL|member|delete_object
dedent|''
name|'def'
name|'delete_object'
op|'('
op|'*'
name|'a'
op|','
op|'**'
name|'kw'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'pass'
newline|'\n'
nl|'\n'
DECL|member|iter_objects
dedent|''
name|'def'
name|'iter_objects'
op|'('
name|'self'
op|','
op|'*'
name|'a'
op|','
op|'**'
name|'kw'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'return'
name|'self'
op|'.'
name|'objects'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'fake_swift'
op|'='
name|'InternalClient'
op|'('
nl|'\n'
op|'['
op|'{'
string|"'name'"
op|':'
name|'str'
op|'('
name|'int'
op|'('
name|'time'
op|'('
op|')'
op|'-'
number|'86400'
op|')'
op|')'
op|'}'
op|']'
op|','
nl|'\n'
op|'['
op|'{'
string|"'name'"
op|':'
string|"'%d-acc/c/actual-obj'"
op|'%'
name|'int'
op|'('
name|'time'
op|'('
op|')'
op|'-'
number|'86400'
op|')'
op|'}'
op|']'
op|')'
newline|'\n'
name|'x'
op|'='
name|'expirer'
op|'.'
name|'ObjectExpirer'
op|'('
name|'self'
op|'.'
name|'conf'
op|','
name|'logger'
op|'='
name|'self'
op|'.'
name|'logger'
op|','
nl|'\n'
name|'swift'
op|'='
name|'fake_swift'
op|')'
newline|'\n'
name|'x'
op|'.'
name|'delete_actual_object'
op|'='
name|'lambda'
name|'o'
op|','
name|'t'
op|':'
name|'None'
newline|'\n'
name|'x'
op|'.'
name|'pop_queue'
op|'='
name|'lambda'
name|'c'
op|','
name|'o'
op|':'
name|'None'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'x'
op|'.'
name|'report_objects'
op|','
number|'0'
op|')'
newline|'\n'
name|'with'
name|'mock'
op|'.'
name|'patch'
op|'('
string|"'swift.obj.expirer.MAX_OBJECTS_TO_CACHE'"
op|','
number|'0'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'x'
op|'.'
name|'run_once'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'x'
op|'.'
name|'report_objects'
op|','
number|'1'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
nl|'\n'
name|'x'
op|'.'
name|'logger'
op|'.'
name|'get_lines_for_level'
op|'('
string|"'info'"
op|')'
op|','
nl|'\n'
op|'['
string|"'Pass beginning; 1 possible containers; 2 possible objects'"
op|','
nl|'\n'
string|"'Pass completed in 0s; 1 objects expired'"
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_delete_actual_object_does_not_get_unicode
dedent|''
dedent|''
name|'def'
name|'test_delete_actual_object_does_not_get_unicode'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
DECL|class|InternalClient
indent|'        '
name|'class'
name|'InternalClient'
op|'('
name|'object'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|variable|container_ring
indent|'            '
name|'container_ring'
op|'='
name|'None'
newline|'\n'
nl|'\n'
DECL|member|__init__
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'containers'
op|','
name|'objects'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'containers'
op|'='
name|'containers'
newline|'\n'
name|'self'
op|'.'
name|'objects'
op|'='
name|'objects'
newline|'\n'
nl|'\n'
DECL|member|get_account_info
dedent|''
name|'def'
name|'get_account_info'
op|'('
op|'*'
name|'a'
op|','
op|'**'
name|'kw'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'return'
number|'1'
op|','
number|'2'
newline|'\n'
nl|'\n'
DECL|member|iter_containers
dedent|''
name|'def'
name|'iter_containers'
op|'('
name|'self'
op|','
op|'*'
name|'a'
op|','
op|'**'
name|'kw'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'return'
name|'self'
op|'.'
name|'containers'
newline|'\n'
nl|'\n'
DECL|member|delete_container
dedent|''
name|'def'
name|'delete_container'
op|'('
op|'*'
name|'a'
op|','
op|'**'
name|'kw'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'pass'
newline|'\n'
nl|'\n'
DECL|member|delete_object
dedent|''
name|'def'
name|'delete_object'
op|'('
op|'*'
name|'a'
op|','
op|'**'
name|'kw'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'pass'
newline|'\n'
nl|'\n'
DECL|member|iter_objects
dedent|''
name|'def'
name|'iter_objects'
op|'('
name|'self'
op|','
op|'*'
name|'a'
op|','
op|'**'
name|'kw'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'return'
name|'self'
op|'.'
name|'objects'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'got_unicode'
op|'='
op|'['
name|'False'
op|']'
newline|'\n'
nl|'\n'
DECL|function|delete_actual_object_test_for_unicode
name|'def'
name|'delete_actual_object_test_for_unicode'
op|'('
name|'actual_obj'
op|','
name|'timestamp'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'isinstance'
op|'('
name|'actual_obj'
op|','
name|'six'
op|'.'
name|'text_type'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'got_unicode'
op|'['
number|'0'
op|']'
op|'='
name|'True'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'fake_swift'
op|'='
name|'InternalClient'
op|'('
nl|'\n'
op|'['
op|'{'
string|"'name'"
op|':'
name|'str'
op|'('
name|'int'
op|'('
name|'time'
op|'('
op|')'
op|'-'
number|'86400'
op|')'
op|')'
op|'}'
op|']'
op|','
nl|'\n'
op|'['
op|'{'
string|"'name'"
op|':'
string|"u'%d-actual-obj'"
op|'%'
name|'int'
op|'('
name|'time'
op|'('
op|')'
op|'-'
number|'86400'
op|')'
op|'}'
op|']'
op|')'
newline|'\n'
name|'x'
op|'='
name|'expirer'
op|'.'
name|'ObjectExpirer'
op|'('
name|'self'
op|'.'
name|'conf'
op|','
name|'logger'
op|'='
name|'self'
op|'.'
name|'logger'
op|','
nl|'\n'
name|'swift'
op|'='
name|'fake_swift'
op|')'
newline|'\n'
name|'x'
op|'.'
name|'delete_actual_object'
op|'='
name|'delete_actual_object_test_for_unicode'
newline|'\n'
name|'x'
op|'.'
name|'pop_queue'
op|'='
name|'lambda'
name|'c'
op|','
name|'o'
op|':'
name|'None'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'x'
op|'.'
name|'report_objects'
op|','
number|'0'
op|')'
newline|'\n'
name|'x'
op|'.'
name|'run_once'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'x'
op|'.'
name|'report_objects'
op|','
number|'1'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
nl|'\n'
name|'x'
op|'.'
name|'logger'
op|'.'
name|'get_lines_for_level'
op|'('
string|"'info'"
op|')'
op|','
op|'['
nl|'\n'
string|"'Pass beginning; 1 possible containers; 2 possible objects'"
op|','
nl|'\n'
string|"'Pass completed in 0s; 1 objects expired'"
op|','
nl|'\n'
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'got_unicode'
op|'['
number|'0'
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_failed_delete_continues_on
dedent|''
name|'def'
name|'test_failed_delete_continues_on'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
DECL|class|InternalClient
indent|'        '
name|'class'
name|'InternalClient'
op|'('
name|'object'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|variable|container_ring
indent|'            '
name|'container_ring'
op|'='
name|'None'
newline|'\n'
nl|'\n'
DECL|member|__init__
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'containers'
op|','
name|'objects'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'containers'
op|'='
name|'containers'
newline|'\n'
name|'self'
op|'.'
name|'objects'
op|'='
name|'objects'
newline|'\n'
nl|'\n'
DECL|member|get_account_info
dedent|''
name|'def'
name|'get_account_info'
op|'('
op|'*'
name|'a'
op|','
op|'**'
name|'kw'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'return'
number|'1'
op|','
number|'2'
newline|'\n'
nl|'\n'
DECL|member|iter_containers
dedent|''
name|'def'
name|'iter_containers'
op|'('
name|'self'
op|','
op|'*'
name|'a'
op|','
op|'**'
name|'kw'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'return'
name|'self'
op|'.'
name|'containers'
newline|'\n'
nl|'\n'
DECL|member|delete_container
dedent|''
name|'def'
name|'delete_container'
op|'('
op|'*'
name|'a'
op|','
op|'**'
name|'kw'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'raise'
name|'Exception'
op|'('
string|"'failed to delete container'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|delete_object
dedent|''
name|'def'
name|'delete_object'
op|'('
op|'*'
name|'a'
op|','
op|'**'
name|'kw'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'pass'
newline|'\n'
nl|'\n'
DECL|member|iter_objects
dedent|''
name|'def'
name|'iter_objects'
op|'('
name|'self'
op|','
op|'*'
name|'a'
op|','
op|'**'
name|'kw'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'return'
name|'self'
op|'.'
name|'objects'
newline|'\n'
nl|'\n'
DECL|function|fail_delete_actual_object
dedent|''
dedent|''
name|'def'
name|'fail_delete_actual_object'
op|'('
name|'actual_obj'
op|','
name|'timestamp'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'Exception'
op|'('
string|"'failed to delete actual object'"
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'x'
op|'='
name|'expirer'
op|'.'
name|'ObjectExpirer'
op|'('
name|'self'
op|'.'
name|'conf'
op|','
name|'logger'
op|'='
name|'self'
op|'.'
name|'logger'
op|')'
newline|'\n'
nl|'\n'
name|'cts'
op|'='
name|'int'
op|'('
name|'time'
op|'('
op|')'
op|'-'
number|'86400'
op|')'
newline|'\n'
name|'ots'
op|'='
name|'int'
op|'('
name|'time'
op|'('
op|')'
op|'-'
number|'86400'
op|')'
newline|'\n'
nl|'\n'
name|'containers'
op|'='
op|'['
nl|'\n'
op|'{'
string|"'name'"
op|':'
name|'str'
op|'('
name|'cts'
op|')'
op|'}'
op|','
nl|'\n'
op|'{'
string|"'name'"
op|':'
name|'str'
op|'('
name|'cts'
op|'+'
number|'1'
op|')'
op|'}'
op|','
nl|'\n'
op|']'
newline|'\n'
nl|'\n'
name|'objects'
op|'='
op|'['
nl|'\n'
op|'{'
string|"'name'"
op|':'
string|"'%d-actual-obj'"
op|'%'
name|'ots'
op|'}'
op|','
nl|'\n'
op|'{'
string|"'name'"
op|':'
string|"'%d-next-obj'"
op|'%'
name|'ots'
op|'}'
nl|'\n'
op|']'
newline|'\n'
nl|'\n'
name|'x'
op|'.'
name|'swift'
op|'='
name|'InternalClient'
op|'('
name|'containers'
op|','
name|'objects'
op|')'
newline|'\n'
name|'x'
op|'.'
name|'delete_actual_object'
op|'='
name|'fail_delete_actual_object'
newline|'\n'
name|'x'
op|'.'
name|'run_once'
op|'('
op|')'
newline|'\n'
name|'error_lines'
op|'='
name|'x'
op|'.'
name|'logger'
op|'.'
name|'get_lines_for_level'
op|'('
string|"'error'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'sorted'
op|'('
name|'error_lines'
op|')'
op|','
name|'sorted'
op|'('
op|'['
nl|'\n'
string|"'Exception while deleting object %d %d-actual-obj failed to '"
nl|'\n'
string|"'delete actual object: '"
op|'%'
op|'('
name|'cts'
op|','
name|'ots'
op|')'
op|','
nl|'\n'
string|"'Exception while deleting object %d %d-next-obj failed to '"
nl|'\n'
string|"'delete actual object: '"
op|'%'
op|'('
name|'cts'
op|','
name|'ots'
op|')'
op|','
nl|'\n'
string|"'Exception while deleting object %d %d-actual-obj failed to '"
nl|'\n'
string|"'delete actual object: '"
op|'%'
op|'('
name|'cts'
op|'+'
number|'1'
op|','
name|'ots'
op|')'
op|','
nl|'\n'
string|"'Exception while deleting object %d %d-next-obj failed to '"
nl|'\n'
string|"'delete actual object: '"
op|'%'
op|'('
name|'cts'
op|'+'
number|'1'
op|','
name|'ots'
op|')'
op|','
nl|'\n'
string|"'Exception while deleting container %d failed to delete '"
nl|'\n'
string|"'container: '"
op|'%'
op|'('
name|'cts'
op|','
op|')'
op|','
nl|'\n'
string|"'Exception while deleting container %d failed to delete '"
nl|'\n'
string|"'container: '"
op|'%'
op|'('
name|'cts'
op|'+'
number|'1'
op|','
op|')'
op|']'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'x'
op|'.'
name|'logger'
op|'.'
name|'get_lines_for_level'
op|'('
string|"'info'"
op|')'
op|','
op|'['
nl|'\n'
string|"'Pass beginning; 1 possible containers; 2 possible objects'"
op|','
nl|'\n'
string|"'Pass completed in 0s; 0 objects expired'"
op|','
nl|'\n'
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_run_forever_initial_sleep_random
dedent|''
name|'def'
name|'test_run_forever_initial_sleep_random'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'global'
name|'last_not_sleep'
newline|'\n'
nl|'\n'
DECL|function|raise_system_exit
name|'def'
name|'raise_system_exit'
op|'('
op|')'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'SystemExit'
op|'('
string|"'test_run_forever'"
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'interval'
op|'='
number|'1234'
newline|'\n'
name|'x'
op|'='
name|'expirer'
op|'.'
name|'ObjectExpirer'
op|'('
op|'{'
string|"'__file__'"
op|':'
string|"'unit_test'"
op|','
nl|'\n'
string|"'interval'"
op|':'
name|'interval'
op|'}'
op|')'
newline|'\n'
name|'orig_random'
op|'='
name|'expirer'
op|'.'
name|'random'
newline|'\n'
name|'orig_sleep'
op|'='
name|'expirer'
op|'.'
name|'sleep'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'expirer'
op|'.'
name|'random'
op|'='
name|'not_random'
newline|'\n'
name|'expirer'
op|'.'
name|'sleep'
op|'='
name|'not_sleep'
newline|'\n'
name|'x'
op|'.'
name|'run_once'
op|'='
name|'raise_system_exit'
newline|'\n'
name|'x'
op|'.'
name|'run_forever'
op|'('
op|')'
newline|'\n'
dedent|''
name|'except'
name|'SystemExit'
name|'as'
name|'err'
op|':'
newline|'\n'
indent|'            '
name|'pass'
newline|'\n'
dedent|''
name|'finally'
op|':'
newline|'\n'
indent|'            '
name|'expirer'
op|'.'
name|'random'
op|'='
name|'orig_random'
newline|'\n'
name|'expirer'
op|'.'
name|'sleep'
op|'='
name|'orig_sleep'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'str'
op|'('
name|'err'
op|')'
op|','
string|"'test_run_forever'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'last_not_sleep'
op|','
number|'0.5'
op|'*'
name|'interval'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_run_forever_catches_usual_exceptions
dedent|''
name|'def'
name|'test_run_forever_catches_usual_exceptions'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'raises'
op|'='
op|'['
number|'0'
op|']'
newline|'\n'
nl|'\n'
DECL|function|raise_exceptions
name|'def'
name|'raise_exceptions'
op|'('
op|')'
op|':'
newline|'\n'
indent|'            '
name|'raises'
op|'['
number|'0'
op|']'
op|'+='
number|'1'
newline|'\n'
name|'if'
name|'raises'
op|'['
number|'0'
op|']'
op|'<'
number|'2'
op|':'
newline|'\n'
indent|'                '
name|'raise'
name|'Exception'
op|'('
string|"'exception %d'"
op|'%'
name|'raises'
op|'['
number|'0'
op|']'
op|')'
newline|'\n'
dedent|''
name|'raise'
name|'SystemExit'
op|'('
string|"'exiting exception %d'"
op|'%'
name|'raises'
op|'['
number|'0'
op|']'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'x'
op|'='
name|'expirer'
op|'.'
name|'ObjectExpirer'
op|'('
op|'{'
op|'}'
op|','
name|'logger'
op|'='
name|'self'
op|'.'
name|'logger'
op|')'
newline|'\n'
name|'orig_sleep'
op|'='
name|'expirer'
op|'.'
name|'sleep'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'expirer'
op|'.'
name|'sleep'
op|'='
name|'not_sleep'
newline|'\n'
name|'x'
op|'.'
name|'run_once'
op|'='
name|'raise_exceptions'
newline|'\n'
name|'x'
op|'.'
name|'run_forever'
op|'('
op|')'
newline|'\n'
dedent|''
name|'except'
name|'SystemExit'
name|'as'
name|'err'
op|':'
newline|'\n'
indent|'            '
name|'pass'
newline|'\n'
dedent|''
name|'finally'
op|':'
newline|'\n'
indent|'            '
name|'expirer'
op|'.'
name|'sleep'
op|'='
name|'orig_sleep'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'str'
op|'('
name|'err'
op|')'
op|','
string|"'exiting exception 2'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'x'
op|'.'
name|'logger'
op|'.'
name|'get_lines_for_level'
op|'('
string|"'error'"
op|')'
op|','
nl|'\n'
op|'['
string|"'Unhandled exception: '"
op|']'
op|')'
newline|'\n'
name|'log_args'
op|','
name|'log_kwargs'
op|'='
name|'x'
op|'.'
name|'logger'
op|'.'
name|'log_dict'
op|'['
string|"'error'"
op|']'
op|'['
number|'0'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'str'
op|'('
name|'log_kwargs'
op|'['
string|"'exc_info'"
op|']'
op|'['
number|'1'
op|']'
op|')'
op|','
nl|'\n'
string|"'exception 1'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_delete_actual_object
dedent|''
name|'def'
name|'test_delete_actual_object'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'got_env'
op|'='
op|'['
name|'None'
op|']'
newline|'\n'
nl|'\n'
DECL|function|fake_app
name|'def'
name|'fake_app'
op|'('
name|'env'
op|','
name|'start_response'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'got_env'
op|'['
number|'0'
op|']'
op|'='
name|'env'
newline|'\n'
name|'start_response'
op|'('
string|"'204 No Content'"
op|','
op|'['
op|'('
string|"'Content-Length'"
op|','
string|"'0'"
op|')'
op|']'
op|')'
newline|'\n'
name|'return'
op|'['
op|']'
newline|'\n'
nl|'\n'
dedent|''
name|'internal_client'
op|'.'
name|'loadapp'
op|'='
name|'lambda'
op|'*'
name|'a'
op|','
op|'**'
name|'kw'
op|':'
name|'fake_app'
newline|'\n'
nl|'\n'
name|'x'
op|'='
name|'expirer'
op|'.'
name|'ObjectExpirer'
op|'('
op|'{'
op|'}'
op|')'
newline|'\n'
name|'ts'
op|'='
string|"'1234'"
newline|'\n'
name|'x'
op|'.'
name|'delete_actual_object'
op|'('
string|"'/path/to/object'"
op|','
name|'ts'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'got_env'
op|'['
number|'0'
op|']'
op|'['
string|"'HTTP_X_IF_DELETE_AT'"
op|']'
op|','
name|'ts'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'got_env'
op|'['
number|'0'
op|']'
op|'['
string|"'HTTP_X_TIMESTAMP'"
op|']'
op|','
nl|'\n'
name|'got_env'
op|'['
number|'0'
op|']'
op|'['
string|"'HTTP_X_IF_DELETE_AT'"
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_delete_actual_object_nourlquoting
dedent|''
name|'def'
name|'test_delete_actual_object_nourlquoting'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# delete_actual_object should not do its own url quoting because'
nl|'\n'
comment|"# internal client's make_request handles that."
nl|'\n'
indent|'        '
name|'got_env'
op|'='
op|'['
name|'None'
op|']'
newline|'\n'
nl|'\n'
DECL|function|fake_app
name|'def'
name|'fake_app'
op|'('
name|'env'
op|','
name|'start_response'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'got_env'
op|'['
number|'0'
op|']'
op|'='
name|'env'
newline|'\n'
name|'start_response'
op|'('
string|"'204 No Content'"
op|','
op|'['
op|'('
string|"'Content-Length'"
op|','
string|"'0'"
op|')'
op|']'
op|')'
newline|'\n'
name|'return'
op|'['
op|']'
newline|'\n'
nl|'\n'
dedent|''
name|'internal_client'
op|'.'
name|'loadapp'
op|'='
name|'lambda'
op|'*'
name|'a'
op|','
op|'**'
name|'kw'
op|':'
name|'fake_app'
newline|'\n'
nl|'\n'
name|'x'
op|'='
name|'expirer'
op|'.'
name|'ObjectExpirer'
op|'('
op|'{'
op|'}'
op|')'
newline|'\n'
name|'ts'
op|'='
string|"'1234'"
newline|'\n'
name|'x'
op|'.'
name|'delete_actual_object'
op|'('
string|"'/path/to/object name'"
op|','
name|'ts'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'got_env'
op|'['
number|'0'
op|']'
op|'['
string|"'HTTP_X_IF_DELETE_AT'"
op|']'
op|','
name|'ts'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'got_env'
op|'['
number|'0'
op|']'
op|'['
string|"'HTTP_X_TIMESTAMP'"
op|']'
op|','
nl|'\n'
name|'got_env'
op|'['
number|'0'
op|']'
op|'['
string|"'HTTP_X_IF_DELETE_AT'"
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'got_env'
op|'['
number|'0'
op|']'
op|'['
string|"'PATH_INFO'"
op|']'
op|','
string|"'/v1/path/to/object name'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_delete_actual_object_raises_404
dedent|''
name|'def'
name|'test_delete_actual_object_raises_404'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|function|fake_app
indent|'        '
name|'def'
name|'fake_app'
op|'('
name|'env'
op|','
name|'start_response'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'start_response'
op|'('
string|"'404 Not Found'"
op|','
op|'['
op|'('
string|"'Content-Length'"
op|','
string|"'0'"
op|')'
op|']'
op|')'
newline|'\n'
name|'return'
op|'['
op|']'
newline|'\n'
nl|'\n'
dedent|''
name|'internal_client'
op|'.'
name|'loadapp'
op|'='
name|'lambda'
op|'*'
name|'a'
op|','
op|'**'
name|'kw'
op|':'
name|'fake_app'
newline|'\n'
nl|'\n'
name|'x'
op|'='
name|'expirer'
op|'.'
name|'ObjectExpirer'
op|'('
op|'{'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'internal_client'
op|'.'
name|'UnexpectedResponse'
op|','
nl|'\n'
name|'x'
op|'.'
name|'delete_actual_object'
op|','
string|"'/path/to/object'"
op|','
string|"'1234'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_delete_actual_object_handles_412
dedent|''
name|'def'
name|'test_delete_actual_object_handles_412'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|function|fake_app
indent|'        '
name|'def'
name|'fake_app'
op|'('
name|'env'
op|','
name|'start_response'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'start_response'
op|'('
string|"'412 Precondition Failed'"
op|','
nl|'\n'
op|'['
op|'('
string|"'Content-Length'"
op|','
string|"'0'"
op|')'
op|']'
op|')'
newline|'\n'
name|'return'
op|'['
op|']'
newline|'\n'
nl|'\n'
dedent|''
name|'internal_client'
op|'.'
name|'loadapp'
op|'='
name|'lambda'
op|'*'
name|'a'
op|','
op|'**'
name|'kw'
op|':'
name|'fake_app'
newline|'\n'
nl|'\n'
name|'x'
op|'='
name|'expirer'
op|'.'
name|'ObjectExpirer'
op|'('
op|'{'
op|'}'
op|')'
newline|'\n'
name|'x'
op|'.'
name|'delete_actual_object'
op|'('
string|"'/path/to/object'"
op|','
string|"'1234'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_delete_actual_object_does_not_handle_odd_stuff
dedent|''
name|'def'
name|'test_delete_actual_object_does_not_handle_odd_stuff'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|function|fake_app
indent|'        '
name|'def'
name|'fake_app'
op|'('
name|'env'
op|','
name|'start_response'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'start_response'
op|'('
nl|'\n'
string|"'503 Internal Server Error'"
op|','
nl|'\n'
op|'['
op|'('
string|"'Content-Length'"
op|','
string|"'0'"
op|')'
op|']'
op|')'
newline|'\n'
name|'return'
op|'['
op|']'
newline|'\n'
nl|'\n'
dedent|''
name|'internal_client'
op|'.'
name|'loadapp'
op|'='
name|'lambda'
op|'*'
name|'a'
op|','
op|'**'
name|'kw'
op|':'
name|'fake_app'
newline|'\n'
nl|'\n'
name|'x'
op|'='
name|'expirer'
op|'.'
name|'ObjectExpirer'
op|'('
op|'{'
op|'}'
op|')'
newline|'\n'
name|'exc'
op|'='
name|'None'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'x'
op|'.'
name|'delete_actual_object'
op|'('
string|"'/path/to/object'"
op|','
string|"'1234'"
op|')'
newline|'\n'
dedent|''
name|'except'
name|'Exception'
name|'as'
name|'err'
op|':'
newline|'\n'
indent|'            '
name|'exc'
op|'='
name|'err'
newline|'\n'
dedent|''
name|'finally'
op|':'
newline|'\n'
indent|'            '
name|'pass'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'503'
op|','
name|'exc'
op|'.'
name|'resp'
op|'.'
name|'status_int'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_delete_actual_object_quotes
dedent|''
name|'def'
name|'test_delete_actual_object_quotes'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'name'
op|'='
string|"'this name should get quoted'"
newline|'\n'
name|'timestamp'
op|'='
string|"'1366063156.863045'"
newline|'\n'
name|'x'
op|'='
name|'expirer'
op|'.'
name|'ObjectExpirer'
op|'('
op|'{'
op|'}'
op|')'
newline|'\n'
name|'x'
op|'.'
name|'swift'
op|'.'
name|'make_request'
op|'='
name|'mock'
op|'.'
name|'MagicMock'
op|'('
op|')'
newline|'\n'
name|'x'
op|'.'
name|'delete_actual_object'
op|'('
name|'name'
op|','
name|'timestamp'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'x'
op|'.'
name|'swift'
op|'.'
name|'make_request'
op|'.'
name|'call_count'
op|','
number|'1'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'x'
op|'.'
name|'swift'
op|'.'
name|'make_request'
op|'.'
name|'call_args'
op|'['
number|'0'
op|']'
op|'['
number|'1'
op|']'
op|','
nl|'\n'
string|"'/v1/'"
op|'+'
name|'urllib'
op|'.'
name|'parse'
op|'.'
name|'quote'
op|'('
name|'name'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_pop_queue
dedent|''
name|'def'
name|'test_pop_queue'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
DECL|class|InternalClient
indent|'        '
name|'class'
name|'InternalClient'
op|'('
name|'object'
op|')'
op|':'
newline|'\n'
DECL|variable|container_ring
indent|'            '
name|'container_ring'
op|'='
name|'FakeRing'
op|'('
op|')'
newline|'\n'
dedent|''
name|'x'
op|'='
name|'expirer'
op|'.'
name|'ObjectExpirer'
op|'('
op|'{'
op|'}'
op|','
name|'logger'
op|'='
name|'self'
op|'.'
name|'logger'
op|','
nl|'\n'
DECL|variable|swift
name|'swift'
op|'='
name|'InternalClient'
op|'('
op|')'
op|')'
newline|'\n'
name|'requests'
op|'='
op|'['
op|']'
newline|'\n'
nl|'\n'
DECL|function|capture_requests
name|'def'
name|'capture_requests'
op|'('
name|'ipaddr'
op|','
name|'port'
op|','
name|'method'
op|','
name|'path'
op|','
op|'*'
name|'args'
op|','
op|'**'
name|'kwargs'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'requests'
op|'.'
name|'append'
op|'('
op|'('
name|'method'
op|','
name|'path'
op|')'
op|')'
newline|'\n'
dedent|''
name|'with'
name|'mocked_http_conn'
op|'('
nl|'\n'
number|'200'
op|','
number|'200'
op|','
number|'200'
op|','
name|'give_connect'
op|'='
name|'capture_requests'
op|')'
name|'as'
name|'fake_conn'
op|':'
newline|'\n'
indent|'            '
name|'x'
op|'.'
name|'pop_queue'
op|'('
string|"'c'"
op|','
string|"'o'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'StopIteration'
op|','
name|'fake_conn'
op|'.'
name|'code_iter'
op|'.'
name|'next'
op|')'
newline|'\n'
dedent|''
name|'for'
name|'method'
op|','
name|'path'
name|'in'
name|'requests'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'method'
op|','
string|"'DELETE'"
op|')'
newline|'\n'
name|'device'
op|','
name|'part'
op|','
name|'account'
op|','
name|'container'
op|','
name|'obj'
op|'='
name|'utils'
op|'.'
name|'split_path'
op|'('
nl|'\n'
name|'path'
op|','
number|'5'
op|','
number|'5'
op|','
name|'True'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'account'
op|','
string|"'.expiring_objects'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'container'
op|','
string|"'c'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'obj'
op|','
string|"'o'"
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
dedent|''
dedent|''
dedent|''
name|'if'
name|'__name__'
op|'=='
string|"'__main__'"
op|':'
newline|'\n'
indent|'    '
name|'main'
op|'('
op|')'
newline|'\n'
dedent|''
endmarker|''
end_unit
