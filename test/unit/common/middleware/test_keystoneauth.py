begin_unit
comment|'# Copyright (c) 2012 OpenStack Foundation'
nl|'\n'
comment|'#'
nl|'\n'
comment|'# Licensed under the Apache License, Version 2.0 (the "License");'
nl|'\n'
comment|'# you may not use this file except in compliance with the License.'
nl|'\n'
comment|'# You may obtain a copy of the License at'
nl|'\n'
comment|'#'
nl|'\n'
comment|'#    http://www.apache.org/licenses/LICENSE-2.0'
nl|'\n'
comment|'#'
nl|'\n'
comment|'# Unless required by applicable law or agreed to in writing, software'
nl|'\n'
comment|'# distributed under the License is distributed on an "AS IS" BASIS,'
nl|'\n'
comment|'# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or'
nl|'\n'
comment|'# implied.'
nl|'\n'
comment|'# See the License for the specific language governing permissions and'
nl|'\n'
comment|'# limitations under the License.'
nl|'\n'
nl|'\n'
name|'import'
name|'unittest'
newline|'\n'
nl|'\n'
name|'from'
name|'swift'
op|'.'
name|'common'
op|'.'
name|'middleware'
name|'import'
name|'keystoneauth'
newline|'\n'
name|'from'
name|'swift'
op|'.'
name|'common'
op|'.'
name|'swob'
name|'import'
name|'Request'
op|','
name|'Response'
newline|'\n'
name|'from'
name|'swift'
op|'.'
name|'common'
op|'.'
name|'http'
name|'import'
name|'HTTP_FORBIDDEN'
newline|'\n'
name|'from'
name|'swift'
op|'.'
name|'proxy'
op|'.'
name|'controllers'
op|'.'
name|'base'
name|'import'
name|'_get_cache_key'
newline|'\n'
name|'from'
name|'test'
op|'.'
name|'unit'
name|'import'
name|'FakeLogger'
newline|'\n'
nl|'\n'
DECL|variable|UNKNOWN_ID
name|'UNKNOWN_ID'
op|'='
name|'keystoneauth'
op|'.'
name|'UNKNOWN_ID'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|function|_fake_token_info
name|'def'
name|'_fake_token_info'
op|'('
name|'version'
op|'='
string|"'2'"
op|')'
op|':'
newline|'\n'
indent|'    '
name|'if'
name|'version'
op|'=='
string|"'2'"
op|':'
newline|'\n'
indent|'        '
name|'return'
op|'{'
string|"'access'"
op|':'
string|"'fake_value'"
op|'}'
newline|'\n'
dedent|''
name|'if'
name|'version'
op|'=='
string|"'3'"
op|':'
newline|'\n'
indent|'        '
name|'return'
op|'{'
string|"'token'"
op|':'
string|"'fake_value'"
op|'}'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|FakeApp
dedent|''
dedent|''
name|'class'
name|'FakeApp'
op|'('
name|'object'
op|')'
op|':'
newline|'\n'
DECL|member|__init__
indent|'    '
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'status_headers_body_iter'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'calls'
op|'='
number|'0'
newline|'\n'
name|'self'
op|'.'
name|'call_contexts'
op|'='
op|'['
op|']'
newline|'\n'
name|'self'
op|'.'
name|'status_headers_body_iter'
op|'='
name|'status_headers_body_iter'
newline|'\n'
name|'if'
name|'not'
name|'self'
op|'.'
name|'status_headers_body_iter'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'status_headers_body_iter'
op|'='
name|'iter'
op|'('
op|'['
op|'('
string|"'404 Not Found'"
op|','
op|'{'
op|'}'
op|','
string|"''"
op|')'
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|__call__
dedent|''
dedent|''
name|'def'
name|'__call__'
op|'('
name|'self'
op|','
name|'env'
op|','
name|'start_response'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'calls'
op|'+='
number|'1'
newline|'\n'
name|'self'
op|'.'
name|'request'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"''"
op|','
name|'environ'
op|'='
name|'env'
op|')'
newline|'\n'
name|'if'
string|"'swift.authorize'"
name|'in'
name|'env'
op|':'
newline|'\n'
indent|'            '
name|'resp'
op|'='
name|'env'
op|'['
string|"'swift.authorize'"
op|']'
op|'('
name|'self'
op|'.'
name|'request'
op|')'
newline|'\n'
name|'if'
name|'resp'
op|':'
newline|'\n'
indent|'                '
name|'return'
name|'resp'
op|'('
name|'env'
op|','
name|'start_response'
op|')'
newline|'\n'
dedent|''
dedent|''
name|'context'
op|'='
op|'{'
string|"'method'"
op|':'
name|'self'
op|'.'
name|'request'
op|'.'
name|'method'
op|','
nl|'\n'
string|"'headers'"
op|':'
name|'self'
op|'.'
name|'request'
op|'.'
name|'headers'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'call_contexts'
op|'.'
name|'append'
op|'('
name|'context'
op|')'
newline|'\n'
name|'status'
op|','
name|'headers'
op|','
name|'body'
op|'='
name|'self'
op|'.'
name|'status_headers_body_iter'
op|'.'
name|'next'
op|'('
op|')'
newline|'\n'
name|'return'
name|'Response'
op|'('
name|'status'
op|'='
name|'status'
op|','
name|'headers'
op|'='
name|'headers'
op|','
nl|'\n'
name|'body'
op|'='
name|'body'
op|')'
op|'('
name|'env'
op|','
name|'start_response'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|SwiftAuth
dedent|''
dedent|''
name|'class'
name|'SwiftAuth'
op|'('
name|'unittest'
op|'.'
name|'TestCase'
op|')'
op|':'
newline|'\n'
DECL|member|setUp
indent|'    '
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'test_auth'
op|'='
name|'keystoneauth'
op|'.'
name|'filter_factory'
op|'('
op|'{'
op|'}'
op|')'
op|'('
name|'FakeApp'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'logger'
op|'='
name|'FakeLogger'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|_make_request
dedent|''
name|'def'
name|'_make_request'
op|'('
name|'self'
op|','
name|'path'
op|'='
name|'None'
op|','
name|'headers'
op|'='
name|'None'
op|','
op|'**'
name|'kwargs'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'not'
name|'path'
op|':'
newline|'\n'
indent|'            '
name|'path'
op|'='
string|"'/v1/%s/c/o'"
op|'%'
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'_get_account_for_tenant'
op|'('
string|"'foo'"
op|')'
newline|'\n'
dedent|''
name|'return'
name|'Request'
op|'.'
name|'blank'
op|'('
name|'path'
op|','
name|'headers'
op|'='
name|'headers'
op|','
op|'**'
name|'kwargs'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_get_identity_headers
dedent|''
name|'def'
name|'_get_identity_headers'
op|'('
name|'self'
op|','
name|'status'
op|'='
string|"'Confirmed'"
op|','
name|'tenant_id'
op|'='
string|"'1'"
op|','
nl|'\n'
name|'tenant_name'
op|'='
string|"'acct'"
op|','
name|'project_domain_name'
op|'='
string|"'domA'"
op|','
nl|'\n'
name|'project_domain_id'
op|'='
string|"'99'"
op|','
nl|'\n'
name|'user_name'
op|'='
string|"'usr'"
op|','
name|'user_id'
op|'='
string|"'42'"
op|','
nl|'\n'
name|'user_domain_name'
op|'='
string|"'domA'"
op|','
name|'user_domain_id'
op|'='
string|"'99'"
op|','
nl|'\n'
name|'role'
op|'='
string|"'admin'"
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'dict'
op|'('
name|'X_IDENTITY_STATUS'
op|'='
name|'status'
op|','
nl|'\n'
name|'X_TENANT_ID'
op|'='
name|'tenant_id'
op|','
nl|'\n'
name|'X_TENANT_NAME'
op|'='
name|'tenant_name'
op|','
nl|'\n'
name|'X_PROJECT_ID'
op|'='
name|'tenant_id'
op|','
nl|'\n'
name|'X_PROJECT_NAME'
op|'='
name|'tenant_name'
op|','
nl|'\n'
name|'X_PROJECT_DOMAIN_ID'
op|'='
name|'project_domain_id'
op|','
nl|'\n'
name|'X_PROJECT_DOMAIN_NAME'
op|'='
name|'project_domain_name'
op|','
nl|'\n'
name|'X_ROLES'
op|'='
name|'role'
op|','
nl|'\n'
name|'X_USER_NAME'
op|'='
name|'user_name'
op|','
nl|'\n'
name|'X_USER_ID'
op|'='
name|'user_id'
op|','
nl|'\n'
name|'X_USER_DOMAIN_NAME'
op|'='
name|'user_domain_name'
op|','
nl|'\n'
name|'X_USER_DOMAIN_ID'
op|'='
name|'user_domain_id'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_get_successful_middleware
dedent|''
name|'def'
name|'_get_successful_middleware'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'response_iter'
op|'='
name|'iter'
op|'('
op|'['
op|'('
string|"'200 OK'"
op|','
op|'{'
op|'}'
op|','
string|"''"
op|')'
op|']'
op|')'
newline|'\n'
name|'return'
name|'keystoneauth'
op|'.'
name|'filter_factory'
op|'('
op|'{'
op|'}'
op|')'
op|'('
name|'FakeApp'
op|'('
name|'response_iter'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_invalid_request_authorized
dedent|''
name|'def'
name|'test_invalid_request_authorized'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'role'
op|'='
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'reseller_admin_role'
newline|'\n'
name|'headers'
op|'='
name|'self'
op|'.'
name|'_get_identity_headers'
op|'('
name|'role'
op|'='
name|'role'
op|')'
newline|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/'"
op|','
name|'headers'
op|'='
name|'headers'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'_get_successful_middleware'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'404'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_invalid_request_non_authorized
dedent|''
name|'def'
name|'test_invalid_request_non_authorized'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/'"
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'_get_successful_middleware'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'404'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_confirmed_identity_is_authorized
dedent|''
name|'def'
name|'test_confirmed_identity_is_authorized'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'role'
op|'='
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'reseller_admin_role'
newline|'\n'
name|'headers'
op|'='
name|'self'
op|'.'
name|'_get_identity_headers'
op|'('
name|'role'
op|'='
name|'role'
op|')'
newline|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/v1/AUTH_acct/c'"
op|','
name|'headers'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'_get_successful_middleware'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'200'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_detect_reseller_request
dedent|''
name|'def'
name|'test_detect_reseller_request'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'role'
op|'='
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'reseller_admin_role'
newline|'\n'
name|'headers'
op|'='
name|'self'
op|'.'
name|'_get_identity_headers'
op|'('
name|'role'
op|'='
name|'role'
op|')'
newline|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/v1/AUTH_acct/c'"
op|','
name|'headers'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'_get_successful_middleware'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'req'
op|'.'
name|'environ'
op|'.'
name|'get'
op|'('
string|"'reseller_request'"
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_confirmed_identity_is_not_authorized
dedent|''
name|'def'
name|'test_confirmed_identity_is_not_authorized'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'headers'
op|'='
name|'self'
op|'.'
name|'_get_identity_headers'
op|'('
op|')'
newline|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/v1/AUTH_acct/c'"
op|','
name|'headers'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'403'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_anonymous_is_authorized_for_permitted_referrer
dedent|''
name|'def'
name|'test_anonymous_is_authorized_for_permitted_referrer'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
name|'headers'
op|'='
op|'{'
string|"'X_IDENTITY_STATUS'"
op|':'
string|"'Invalid'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'acl'
op|'='
string|"'.r:*'"
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'_get_successful_middleware'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'200'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_anonymous_with_validtoken_authorized_for_permitted_referrer
dedent|''
name|'def'
name|'test_anonymous_with_validtoken_authorized_for_permitted_referrer'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
name|'headers'
op|'='
op|'{'
string|"'X_IDENTITY_STATUS'"
op|':'
string|"'Confirmed'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'acl'
op|'='
string|"'.r:*'"
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'_get_successful_middleware'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'200'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_anonymous_is_not_authorized_for_unknown_reseller_prefix
dedent|''
name|'def'
name|'test_anonymous_is_not_authorized_for_unknown_reseller_prefix'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
name|'path'
op|'='
string|"'/v1/BLAH_foo/c/o'"
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X_IDENTITY_STATUS'"
op|':'
string|"'Invalid'"
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'401'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_blank_reseller_prefix
dedent|''
name|'def'
name|'test_blank_reseller_prefix'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'conf'
op|'='
op|'{'
string|"'reseller_prefix'"
op|':'
string|"''"
op|'}'
newline|'\n'
name|'test_auth'
op|'='
name|'keystoneauth'
op|'.'
name|'filter_factory'
op|'('
name|'conf'
op|')'
op|'('
name|'FakeApp'
op|'('
op|')'
op|')'
newline|'\n'
name|'account'
op|'='
name|'tenant_id'
op|'='
string|"'foo'"
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'test_auth'
op|'.'
name|'_reseller_check'
op|'('
name|'account'
op|','
name|'tenant_id'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_reseller_prefix_added_underscore
dedent|''
name|'def'
name|'test_reseller_prefix_added_underscore'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'conf'
op|'='
op|'{'
string|"'reseller_prefix'"
op|':'
string|"'AUTH'"
op|'}'
newline|'\n'
name|'test_auth'
op|'='
name|'keystoneauth'
op|'.'
name|'filter_factory'
op|'('
name|'conf'
op|')'
op|'('
name|'FakeApp'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'test_auth'
op|'.'
name|'reseller_prefix'
op|','
string|'"AUTH_"'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_reseller_prefix_not_added_double_underscores
dedent|''
name|'def'
name|'test_reseller_prefix_not_added_double_underscores'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'conf'
op|'='
op|'{'
string|"'reseller_prefix'"
op|':'
string|"'AUTH_'"
op|'}'
newline|'\n'
name|'test_auth'
op|'='
name|'keystoneauth'
op|'.'
name|'filter_factory'
op|'('
name|'conf'
op|')'
op|'('
name|'FakeApp'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'test_auth'
op|'.'
name|'reseller_prefix'
op|','
string|'"AUTH_"'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_override_asked_for_but_not_allowed
dedent|''
name|'def'
name|'test_override_asked_for_but_not_allowed'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'conf'
op|'='
op|'{'
string|"'allow_overrides'"
op|':'
string|"'false'"
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'test_auth'
op|'='
name|'keystoneauth'
op|'.'
name|'filter_factory'
op|'('
name|'conf'
op|')'
op|'('
name|'FakeApp'
op|'('
op|')'
op|')'
newline|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/v1/AUTH_account'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'swift.authorize_override'"
op|':'
name|'True'
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'401'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_override_asked_for_and_allowed
dedent|''
name|'def'
name|'test_override_asked_for_and_allowed'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'conf'
op|'='
op|'{'
string|"'allow_overrides'"
op|':'
string|"'true'"
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'test_auth'
op|'='
name|'keystoneauth'
op|'.'
name|'filter_factory'
op|'('
name|'conf'
op|')'
op|'('
name|'FakeApp'
op|'('
op|')'
op|')'
newline|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/v1/AUTH_account'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'swift.authorize_override'"
op|':'
name|'True'
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'404'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_override_default_allowed
dedent|''
name|'def'
name|'test_override_default_allowed'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/v1/AUTH_account'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'swift.authorize_override'"
op|':'
name|'True'
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'404'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_anonymous_options_allowed
dedent|''
name|'def'
name|'test_anonymous_options_allowed'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/v1/AUTH_account'"
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'OPTIONS'"
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'_get_successful_middleware'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'200'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_identified_options_allowed
dedent|''
name|'def'
name|'test_identified_options_allowed'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'headers'
op|'='
name|'self'
op|'.'
name|'_get_identity_headers'
op|'('
op|')'
newline|'\n'
name|'headers'
op|'['
string|"'REQUEST_METHOD'"
op|']'
op|'='
string|"'OPTIONS'"
newline|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'/v1/AUTH_account'"
op|','
nl|'\n'
name|'headers'
op|'='
name|'self'
op|'.'
name|'_get_identity_headers'
op|'('
op|')'
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'OPTIONS'"
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'_get_successful_middleware'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'200'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_auth_scheme
dedent|''
name|'def'
name|'test_auth_scheme'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
name|'path'
op|'='
string|"'/v1/BLAH_foo/c/o'"
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X_IDENTITY_STATUS'"
op|':'
string|"'Invalid'"
op|'}'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'401'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
string|"'Www-Authenticate'"
name|'in'
name|'resp'
op|'.'
name|'headers'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_project_domain_id_sysmeta_set
dedent|''
name|'def'
name|'test_project_domain_id_sysmeta_set'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'proj_id'
op|'='
string|"'12345678'"
newline|'\n'
name|'proj_domain_id'
op|'='
string|"'13'"
newline|'\n'
name|'headers'
op|'='
name|'self'
op|'.'
name|'_get_identity_headers'
op|'('
name|'tenant_id'
op|'='
name|'proj_id'
op|','
nl|'\n'
name|'project_domain_id'
op|'='
name|'proj_domain_id'
op|')'
newline|'\n'
name|'account'
op|'='
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'_get_account_for_tenant'
op|'('
name|'proj_id'
op|')'
newline|'\n'
name|'path'
op|'='
string|"'/v1/'"
op|'+'
name|'account'
newline|'\n'
comment|'# fake cached account info'
nl|'\n'
name|'_'
op|','
name|'info_key'
op|'='
name|'_get_cache_key'
op|'('
name|'account'
op|','
name|'None'
op|')'
newline|'\n'
name|'env'
op|'='
op|'{'
name|'info_key'
op|':'
op|'{'
string|"'status'"
op|':'
number|'0'
op|','
string|"'sysmeta'"
op|':'
op|'{'
op|'}'
op|'}'
op|','
nl|'\n'
string|"'keystone.token_info'"
op|':'
name|'_fake_token_info'
op|'('
name|'version'
op|'='
string|"'3'"
op|')'
op|'}'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
name|'path'
op|','
name|'environ'
op|'='
name|'env'
op|','
name|'headers'
op|'='
name|'headers'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'method'
op|'='
string|"'POST'"
newline|'\n'
name|'headers_out'
op|'='
op|'{'
string|"'X-Account-Sysmeta-Project-Domain-Id'"
op|':'
name|'proj_domain_id'
op|'}'
newline|'\n'
name|'fake_app'
op|'='
name|'FakeApp'
op|'('
name|'iter'
op|'('
op|'['
op|'('
string|"'200 OK'"
op|','
name|'headers_out'
op|','
string|"''"
op|')'
op|']'
op|')'
op|')'
newline|'\n'
name|'test_auth'
op|'='
name|'keystoneauth'
op|'.'
name|'filter_factory'
op|'('
op|'{'
op|'}'
op|')'
op|'('
name|'fake_app'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'200'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'len'
op|'('
name|'fake_app'
op|'.'
name|'call_contexts'
op|')'
op|','
number|'1'
op|')'
newline|'\n'
name|'headers_sent'
op|'='
name|'fake_app'
op|'.'
name|'call_contexts'
op|'['
number|'0'
op|']'
op|'['
string|"'headers'"
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
string|"'X-Account-Sysmeta-Project-Domain-Id'"
name|'in'
name|'headers_sent'
op|','
nl|'\n'
name|'headers_sent'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'headers_sent'
op|'['
string|"'X-Account-Sysmeta-Project-Domain-Id'"
op|']'
op|','
nl|'\n'
name|'proj_domain_id'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
string|"'X-Account-Project-Domain-Id'"
name|'in'
name|'resp'
op|'.'
name|'headers'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'['
string|"'X-Account-Project-Domain-Id'"
op|']'
op|','
nl|'\n'
name|'proj_domain_id'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_project_domain_id_sysmeta_set_to_unknown
dedent|''
name|'def'
name|'test_project_domain_id_sysmeta_set_to_unknown'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'proj_id'
op|'='
string|"'12345678'"
newline|'\n'
comment|'# token scoped to a different project'
nl|'\n'
name|'headers'
op|'='
name|'self'
op|'.'
name|'_get_identity_headers'
op|'('
name|'tenant_id'
op|'='
string|"'87654321'"
op|','
nl|'\n'
name|'project_domain_id'
op|'='
string|"'default'"
op|','
nl|'\n'
name|'role'
op|'='
string|"'reselleradmin'"
op|')'
newline|'\n'
name|'account'
op|'='
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'_get_account_for_tenant'
op|'('
name|'proj_id'
op|')'
newline|'\n'
name|'path'
op|'='
string|"'/v1/'"
op|'+'
name|'account'
newline|'\n'
comment|'# fake cached account info'
nl|'\n'
name|'_'
op|','
name|'info_key'
op|'='
name|'_get_cache_key'
op|'('
name|'account'
op|','
name|'None'
op|')'
newline|'\n'
name|'env'
op|'='
op|'{'
name|'info_key'
op|':'
op|'{'
string|"'status'"
op|':'
number|'0'
op|','
string|"'sysmeta'"
op|':'
op|'{'
op|'}'
op|'}'
op|','
nl|'\n'
string|"'keystone.token_info'"
op|':'
name|'_fake_token_info'
op|'('
name|'version'
op|'='
string|"'3'"
op|')'
op|'}'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
name|'path'
op|','
name|'environ'
op|'='
name|'env'
op|','
name|'headers'
op|'='
name|'headers'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'method'
op|'='
string|"'POST'"
newline|'\n'
name|'fake_app'
op|'='
name|'FakeApp'
op|'('
name|'iter'
op|'('
op|'['
op|'('
string|"'200 OK'"
op|','
op|'{'
op|'}'
op|','
string|"''"
op|')'
op|']'
op|')'
op|')'
newline|'\n'
name|'test_auth'
op|'='
name|'keystoneauth'
op|'.'
name|'filter_factory'
op|'('
op|'{'
op|'}'
op|')'
op|'('
name|'fake_app'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'200'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'len'
op|'('
name|'fake_app'
op|'.'
name|'call_contexts'
op|')'
op|','
number|'1'
op|')'
newline|'\n'
name|'headers_sent'
op|'='
name|'fake_app'
op|'.'
name|'call_contexts'
op|'['
number|'0'
op|']'
op|'['
string|"'headers'"
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
string|"'X-Account-Sysmeta-Project-Domain-Id'"
name|'in'
name|'headers_sent'
op|','
nl|'\n'
name|'headers_sent'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'headers_sent'
op|'['
string|"'X-Account-Sysmeta-Project-Domain-Id'"
op|']'
op|','
nl|'\n'
name|'UNKNOWN_ID'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_project_domain_id_sysmeta_not_set
dedent|''
name|'def'
name|'test_project_domain_id_sysmeta_not_set'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'proj_id'
op|'='
string|"'12345678'"
newline|'\n'
name|'headers'
op|'='
name|'self'
op|'.'
name|'_get_identity_headers'
op|'('
name|'tenant_id'
op|'='
name|'proj_id'
op|','
name|'role'
op|'='
string|"'admin'"
op|')'
newline|'\n'
name|'account'
op|'='
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'_get_account_for_tenant'
op|'('
name|'proj_id'
op|')'
newline|'\n'
name|'path'
op|'='
string|"'/v1/'"
op|'+'
name|'account'
newline|'\n'
name|'_'
op|','
name|'info_key'
op|'='
name|'_get_cache_key'
op|'('
name|'account'
op|','
name|'None'
op|')'
newline|'\n'
comment|'# v2 token'
nl|'\n'
name|'env'
op|'='
op|'{'
name|'info_key'
op|':'
op|'{'
string|"'status'"
op|':'
number|'0'
op|','
string|"'sysmeta'"
op|':'
op|'{'
op|'}'
op|'}'
op|','
nl|'\n'
string|"'keystone.token_info'"
op|':'
name|'_fake_token_info'
op|'('
name|'version'
op|'='
string|"'2'"
op|')'
op|'}'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
name|'path'
op|','
name|'environ'
op|'='
name|'env'
op|','
name|'headers'
op|'='
name|'headers'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'method'
op|'='
string|"'POST'"
newline|'\n'
name|'fake_app'
op|'='
name|'FakeApp'
op|'('
name|'iter'
op|'('
op|'['
op|'('
string|"'200 OK'"
op|','
op|'{'
op|'}'
op|','
string|"''"
op|')'
op|']'
op|')'
op|')'
newline|'\n'
name|'test_auth'
op|'='
name|'keystoneauth'
op|'.'
name|'filter_factory'
op|'('
op|'{'
op|'}'
op|')'
op|'('
name|'fake_app'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'200'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'len'
op|'('
name|'fake_app'
op|'.'
name|'call_contexts'
op|')'
op|','
number|'1'
op|')'
newline|'\n'
name|'headers_sent'
op|'='
name|'fake_app'
op|'.'
name|'call_contexts'
op|'['
number|'0'
op|']'
op|'['
string|"'headers'"
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
string|"'X-Account-Sysmeta-Project-Domain-Id'"
name|'in'
name|'headers_sent'
op|','
nl|'\n'
name|'headers_sent'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_project_domain_id_sysmeta_set_unknown_with_v2
dedent|''
name|'def'
name|'test_project_domain_id_sysmeta_set_unknown_with_v2'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'proj_id'
op|'='
string|"'12345678'"
newline|'\n'
comment|'# token scoped to a different project'
nl|'\n'
name|'headers'
op|'='
name|'self'
op|'.'
name|'_get_identity_headers'
op|'('
name|'tenant_id'
op|'='
string|"'87654321'"
op|','
nl|'\n'
name|'role'
op|'='
string|"'reselleradmin'"
op|')'
newline|'\n'
name|'account'
op|'='
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'_get_account_for_tenant'
op|'('
name|'proj_id'
op|')'
newline|'\n'
name|'path'
op|'='
string|"'/v1/'"
op|'+'
name|'account'
newline|'\n'
name|'_'
op|','
name|'info_key'
op|'='
name|'_get_cache_key'
op|'('
name|'account'
op|','
name|'None'
op|')'
newline|'\n'
comment|'# v2 token'
nl|'\n'
name|'env'
op|'='
op|'{'
name|'info_key'
op|':'
op|'{'
string|"'status'"
op|':'
number|'0'
op|','
string|"'sysmeta'"
op|':'
op|'{'
op|'}'
op|'}'
op|','
nl|'\n'
string|"'keystone.token_info'"
op|':'
name|'_fake_token_info'
op|'('
name|'version'
op|'='
string|"'2'"
op|')'
op|'}'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
name|'path'
op|','
name|'environ'
op|'='
name|'env'
op|','
name|'headers'
op|'='
name|'headers'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'method'
op|'='
string|"'POST'"
newline|'\n'
name|'fake_app'
op|'='
name|'FakeApp'
op|'('
name|'iter'
op|'('
op|'['
op|'('
string|"'200 OK'"
op|','
op|'{'
op|'}'
op|','
string|"''"
op|')'
op|']'
op|')'
op|')'
newline|'\n'
name|'test_auth'
op|'='
name|'keystoneauth'
op|'.'
name|'filter_factory'
op|'('
op|'{'
op|'}'
op|')'
op|'('
name|'fake_app'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'200'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'len'
op|'('
name|'fake_app'
op|'.'
name|'call_contexts'
op|')'
op|','
number|'1'
op|')'
newline|'\n'
name|'headers_sent'
op|'='
name|'fake_app'
op|'.'
name|'call_contexts'
op|'['
number|'0'
op|']'
op|'['
string|"'headers'"
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
string|"'X-Account-Sysmeta-Project-Domain-Id'"
name|'in'
name|'headers_sent'
op|','
nl|'\n'
name|'headers_sent'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'headers_sent'
op|'['
string|"'X-Account-Sysmeta-Project-Domain-Id'"
op|']'
op|','
nl|'\n'
name|'UNKNOWN_ID'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|BaseTestAuthorize
dedent|''
dedent|''
name|'class'
name|'BaseTestAuthorize'
op|'('
name|'unittest'
op|'.'
name|'TestCase'
op|')'
op|':'
newline|'\n'
DECL|member|setUp
indent|'    '
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'test_auth'
op|'='
name|'keystoneauth'
op|'.'
name|'filter_factory'
op|'('
op|'{'
op|'}'
op|')'
op|'('
name|'FakeApp'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'logger'
op|'='
name|'FakeLogger'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|_make_request
dedent|''
name|'def'
name|'_make_request'
op|'('
name|'self'
op|','
name|'path'
op|','
op|'**'
name|'kwargs'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'Request'
op|'.'
name|'blank'
op|'('
name|'path'
op|','
op|'**'
name|'kwargs'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_get_account
dedent|''
name|'def'
name|'_get_account'
op|'('
name|'self'
op|','
name|'identity'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'not'
name|'identity'
op|':'
newline|'\n'
indent|'            '
name|'identity'
op|'='
name|'self'
op|'.'
name|'_get_identity'
op|'('
op|')'
newline|'\n'
dedent|''
name|'return'
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'_get_account_for_tenant'
op|'('
nl|'\n'
name|'identity'
op|'['
string|"'HTTP_X_TENANT_ID'"
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_get_identity
dedent|''
name|'def'
name|'_get_identity'
op|'('
name|'self'
op|','
name|'tenant_id'
op|'='
string|"'tenant_id'"
op|','
name|'tenant_name'
op|'='
string|"'tenant_name'"
op|','
nl|'\n'
name|'user_id'
op|'='
string|"'user_id'"
op|','
name|'user_name'
op|'='
string|"'user_name'"
op|','
name|'roles'
op|'='
name|'None'
op|','
nl|'\n'
name|'project_domain_name'
op|'='
string|"'domA'"
op|','
name|'project_domain_id'
op|'='
string|"'foo'"
op|','
nl|'\n'
name|'user_domain_name'
op|'='
string|"'domA'"
op|','
name|'user_domain_id'
op|'='
string|"'foo'"
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'roles'
name|'is'
name|'None'
op|':'
newline|'\n'
indent|'            '
name|'roles'
op|'='
op|'['
op|']'
newline|'\n'
dedent|''
name|'if'
name|'isinstance'
op|'('
name|'roles'
op|','
name|'list'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'roles'
op|'='
string|"','"
op|'.'
name|'join'
op|'('
name|'roles'
op|')'
newline|'\n'
dedent|''
name|'return'
op|'{'
string|"'HTTP_X_USER_ID'"
op|':'
name|'user_id'
op|','
nl|'\n'
string|"'HTTP_X_USER_NAME'"
op|':'
name|'user_name'
op|','
nl|'\n'
string|"'HTTP_X_USER_DOMAIN_NAME'"
op|':'
name|'user_domain_name'
op|','
nl|'\n'
string|"'HTTP_X_USER_DOMAIN_ID'"
op|':'
name|'user_domain_id'
op|','
nl|'\n'
string|"'HTTP_X_TENANT_ID'"
op|':'
name|'tenant_id'
op|','
nl|'\n'
string|"'HTTP_X_TENANT_NAME'"
op|':'
name|'tenant_name'
op|','
nl|'\n'
string|"'HTTP_X_PROJECT_DOMAIN_ID'"
op|':'
name|'project_domain_id'
op|','
nl|'\n'
string|"'HTTP_X_PROJECT_DOMAIN_NAME'"
op|':'
name|'project_domain_name'
op|','
nl|'\n'
string|"'HTTP_X_ROLES'"
op|':'
name|'roles'
op|','
nl|'\n'
string|"'HTTP_X_IDENTITY_STATUS'"
op|':'
string|"'Confirmed'"
op|'}'
newline|'\n'
nl|'\n'
DECL|member|_get_env_id
dedent|''
name|'def'
name|'_get_env_id'
op|'('
name|'self'
op|','
name|'tenant_id'
op|'='
string|"'tenant_id'"
op|','
name|'tenant_name'
op|'='
string|"'tenant_name'"
op|','
nl|'\n'
name|'user_id'
op|'='
string|"'user_id'"
op|','
name|'user_name'
op|'='
string|"'user_name'"
op|','
name|'roles'
op|'='
op|'['
op|']'
op|','
nl|'\n'
name|'project_domain_name'
op|'='
string|"'domA'"
op|','
name|'project_domain_id'
op|'='
string|"'99'"
op|','
nl|'\n'
name|'user_domain_name'
op|'='
string|"'domA'"
op|','
name|'user_domain_id'
op|'='
string|"'99'"
op|','
nl|'\n'
name|'auth_version'
op|'='
string|"'3'"
op|')'
op|':'
newline|'\n'
indent|'        '
name|'env'
op|'='
name|'self'
op|'.'
name|'_get_identity'
op|'('
name|'tenant_id'
op|','
name|'tenant_name'
op|','
name|'user_id'
op|','
name|'user_name'
op|','
nl|'\n'
name|'roles'
op|','
name|'project_domain_name'
op|','
nl|'\n'
name|'project_domain_id'
op|','
name|'user_domain_name'
op|','
nl|'\n'
name|'user_domain_id'
op|')'
newline|'\n'
name|'token_info'
op|'='
name|'_fake_token_info'
op|'('
name|'version'
op|'='
name|'auth_version'
op|')'
newline|'\n'
name|'env'
op|'.'
name|'update'
op|'('
op|'{'
string|"'keystone.token_info'"
op|':'
name|'token_info'
op|'}'
op|')'
newline|'\n'
name|'return'
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'_integral_keystone_identity'
op|'('
name|'env'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|TestAuthorize
dedent|''
dedent|''
name|'class'
name|'TestAuthorize'
op|'('
name|'BaseTestAuthorize'
op|')'
op|':'
newline|'\n'
DECL|member|_check_authenticate
indent|'    '
name|'def'
name|'_check_authenticate'
op|'('
name|'self'
op|','
name|'account'
op|'='
name|'None'
op|','
name|'identity'
op|'='
name|'None'
op|','
name|'headers'
op|'='
name|'None'
op|','
nl|'\n'
name|'exception'
op|'='
name|'None'
op|','
name|'acl'
op|'='
name|'None'
op|','
name|'env'
op|'='
name|'None'
op|','
name|'path'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'not'
name|'identity'
op|':'
newline|'\n'
indent|'            '
name|'identity'
op|'='
name|'self'
op|'.'
name|'_get_identity'
op|'('
op|')'
newline|'\n'
dedent|''
name|'if'
name|'not'
name|'account'
op|':'
newline|'\n'
indent|'            '
name|'account'
op|'='
name|'self'
op|'.'
name|'_get_account'
op|'('
name|'identity'
op|')'
newline|'\n'
dedent|''
name|'if'
name|'not'
name|'path'
op|':'
newline|'\n'
indent|'            '
name|'path'
op|'='
string|"'/v1/%s/c'"
op|'%'
name|'account'
newline|'\n'
comment|'# fake cached account info'
nl|'\n'
dedent|''
name|'_'
op|','
name|'info_key'
op|'='
name|'_get_cache_key'
op|'('
name|'account'
op|','
name|'None'
op|')'
newline|'\n'
name|'default_env'
op|'='
op|'{'
string|"'REMOTE_USER'"
op|':'
name|'identity'
op|'['
string|"'HTTP_X_TENANT_ID'"
op|']'
op|','
nl|'\n'
name|'info_key'
op|':'
op|'{'
string|"'status'"
op|':'
number|'200'
op|','
string|"'sysmeta'"
op|':'
op|'{'
op|'}'
op|'}'
op|'}'
newline|'\n'
name|'default_env'
op|'.'
name|'update'
op|'('
name|'identity'
op|')'
newline|'\n'
name|'if'
name|'env'
op|':'
newline|'\n'
indent|'            '
name|'default_env'
op|'.'
name|'update'
op|'('
name|'env'
op|')'
newline|'\n'
dedent|''
name|'req'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
name|'path'
op|','
name|'headers'
op|'='
name|'headers'
op|','
name|'environ'
op|'='
name|'default_env'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'acl'
op|'='
name|'acl'
newline|'\n'
nl|'\n'
name|'env_identity'
op|'='
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'_integral_keystone_identity'
op|'('
name|'req'
op|'.'
name|'environ'
op|')'
newline|'\n'
name|'result'
op|'='
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'authorize'
op|'('
name|'env_identity'
op|','
name|'req'
op|')'
newline|'\n'
nl|'\n'
comment|'# if we have requested an exception but nothing came back then'
nl|'\n'
name|'if'
name|'exception'
name|'and'
name|'not'
name|'result'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'fail'
op|'('
string|'"error %s was not returned"'
op|'%'
op|'('
name|'str'
op|'('
name|'exception'
op|')'
op|')'
op|')'
newline|'\n'
dedent|''
name|'elif'
name|'exception'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'result'
op|'.'
name|'status_int'
op|','
name|'exception'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'result'
name|'is'
name|'None'
op|')'
newline|'\n'
dedent|''
name|'return'
name|'req'
newline|'\n'
nl|'\n'
DECL|member|test_authorize_fails_for_unauthorized_user
dedent|''
name|'def'
name|'test_authorize_fails_for_unauthorized_user'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_check_authenticate'
op|'('
name|'exception'
op|'='
name|'HTTP_FORBIDDEN'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_authorize_fails_for_invalid_reseller_prefix
dedent|''
name|'def'
name|'test_authorize_fails_for_invalid_reseller_prefix'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_check_authenticate'
op|'('
name|'account'
op|'='
string|"'BLAN_a'"
op|','
nl|'\n'
name|'exception'
op|'='
name|'HTTP_FORBIDDEN'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_authorize_succeeds_for_reseller_admin
dedent|''
name|'def'
name|'test_authorize_succeeds_for_reseller_admin'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'roles'
op|'='
op|'['
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'reseller_admin_role'
op|']'
newline|'\n'
name|'identity'
op|'='
name|'self'
op|'.'
name|'_get_identity'
op|'('
name|'roles'
op|'='
name|'roles'
op|')'
newline|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_check_authenticate'
op|'('
name|'identity'
op|'='
name|'identity'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'req'
op|'.'
name|'environ'
op|'.'
name|'get'
op|'('
string|"'swift_owner'"
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_authorize_succeeds_for_insensitive_reseller_admin
dedent|''
name|'def'
name|'test_authorize_succeeds_for_insensitive_reseller_admin'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'roles'
op|'='
op|'['
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'reseller_admin_role'
op|'.'
name|'upper'
op|'('
op|')'
op|']'
newline|'\n'
name|'identity'
op|'='
name|'self'
op|'.'
name|'_get_identity'
op|'('
name|'roles'
op|'='
name|'roles'
op|')'
newline|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_check_authenticate'
op|'('
name|'identity'
op|'='
name|'identity'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'req'
op|'.'
name|'environ'
op|'.'
name|'get'
op|'('
string|"'swift_owner'"
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_authorize_succeeds_as_owner_for_operator_role
dedent|''
name|'def'
name|'test_authorize_succeeds_as_owner_for_operator_role'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'roles'
op|'='
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'operator_roles'
op|'.'
name|'split'
op|'('
string|"','"
op|')'
newline|'\n'
name|'identity'
op|'='
name|'self'
op|'.'
name|'_get_identity'
op|'('
name|'roles'
op|'='
name|'roles'
op|')'
newline|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_check_authenticate'
op|'('
name|'identity'
op|'='
name|'identity'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'req'
op|'.'
name|'environ'
op|'.'
name|'get'
op|'('
string|"'swift_owner'"
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_authorize_succeeds_as_owner_for_insensitive_operator_role
dedent|''
name|'def'
name|'test_authorize_succeeds_as_owner_for_insensitive_operator_role'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'roles'
op|'='
op|'['
name|'r'
op|'.'
name|'upper'
op|'('
op|')'
name|'for'
name|'r'
name|'in'
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'operator_roles'
op|'.'
name|'split'
op|'('
string|"','"
op|')'
op|']'
newline|'\n'
name|'identity'
op|'='
name|'self'
op|'.'
name|'_get_identity'
op|'('
name|'roles'
op|'='
name|'roles'
op|')'
newline|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_check_authenticate'
op|'('
name|'identity'
op|'='
name|'identity'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'req'
op|'.'
name|'environ'
op|'.'
name|'get'
op|'('
string|"'swift_owner'"
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_check_authorize_for_tenant_owner_match
dedent|''
name|'def'
name|'_check_authorize_for_tenant_owner_match'
op|'('
name|'self'
op|','
name|'exception'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'identity'
op|'='
name|'self'
op|'.'
name|'_get_identity'
op|'('
name|'user_name'
op|'='
string|"'same_name'"
op|','
nl|'\n'
name|'tenant_name'
op|'='
string|"'same_name'"
op|')'
newline|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_check_authenticate'
op|'('
name|'identity'
op|'='
name|'identity'
op|','
name|'exception'
op|'='
name|'exception'
op|')'
newline|'\n'
name|'expected'
op|'='
name|'bool'
op|'('
name|'exception'
name|'is'
name|'None'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'bool'
op|'('
name|'req'
op|'.'
name|'environ'
op|'.'
name|'get'
op|'('
string|"'swift_owner'"
op|')'
op|')'
op|','
name|'expected'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_authorize_succeeds_as_owner_for_tenant_owner_match
dedent|''
name|'def'
name|'test_authorize_succeeds_as_owner_for_tenant_owner_match'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'is_admin'
op|'='
name|'True'
newline|'\n'
name|'self'
op|'.'
name|'_check_authorize_for_tenant_owner_match'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_authorize_fails_as_owner_for_tenant_owner_match
dedent|''
name|'def'
name|'test_authorize_fails_as_owner_for_tenant_owner_match'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'is_admin'
op|'='
name|'False'
newline|'\n'
name|'self'
op|'.'
name|'_check_authorize_for_tenant_owner_match'
op|'('
nl|'\n'
name|'exception'
op|'='
name|'HTTP_FORBIDDEN'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_authorize_succeeds_for_container_sync
dedent|''
name|'def'
name|'test_authorize_succeeds_for_container_sync'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'env'
op|'='
op|'{'
string|"'swift_sync_key'"
op|':'
string|"'foo'"
op|','
string|"'REMOTE_ADDR'"
op|':'
string|"'127.0.0.1'"
op|'}'
newline|'\n'
name|'headers'
op|'='
op|'{'
string|"'x-container-sync-key'"
op|':'
string|"'foo'"
op|','
string|"'x-timestamp'"
op|':'
string|"'1'"
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'_check_authenticate'
op|'('
name|'env'
op|'='
name|'env'
op|','
name|'headers'
op|'='
name|'headers'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_authorize_fails_for_invalid_referrer
dedent|''
name|'def'
name|'test_authorize_fails_for_invalid_referrer'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'env'
op|'='
op|'{'
string|"'HTTP_REFERER'"
op|':'
string|"'http://invalid.com/index.html'"
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'_check_authenticate'
op|'('
name|'acl'
op|'='
string|"'.r:example.com'"
op|','
name|'env'
op|'='
name|'env'
op|','
nl|'\n'
name|'exception'
op|'='
name|'HTTP_FORBIDDEN'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_authorize_fails_for_referrer_without_rlistings
dedent|''
name|'def'
name|'test_authorize_fails_for_referrer_without_rlistings'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'env'
op|'='
op|'{'
string|"'HTTP_REFERER'"
op|':'
string|"'http://example.com/index.html'"
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'_check_authenticate'
op|'('
name|'acl'
op|'='
string|"'.r:example.com'"
op|','
name|'env'
op|'='
name|'env'
op|','
nl|'\n'
name|'exception'
op|'='
name|'HTTP_FORBIDDEN'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_authorize_succeeds_for_referrer_with_rlistings
dedent|''
name|'def'
name|'test_authorize_succeeds_for_referrer_with_rlistings'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'env'
op|'='
op|'{'
string|"'HTTP_REFERER'"
op|':'
string|"'http://example.com/index.html'"
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'_check_authenticate'
op|'('
name|'acl'
op|'='
string|"'.r:example.com,.rlistings'"
op|','
name|'env'
op|'='
name|'env'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_authorize_succeeds_for_referrer_with_obj
dedent|''
name|'def'
name|'test_authorize_succeeds_for_referrer_with_obj'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'path'
op|'='
string|"'/v1/%s/c/o'"
op|'%'
name|'self'
op|'.'
name|'_get_account'
op|'('
op|')'
newline|'\n'
name|'env'
op|'='
op|'{'
string|"'HTTP_REFERER'"
op|':'
string|"'http://example.com/index.html'"
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'_check_authenticate'
op|'('
name|'acl'
op|'='
string|"'.r:example.com'"
op|','
name|'env'
op|'='
name|'env'
op|','
name|'path'
op|'='
name|'path'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_authorize_succeeds_for_user_role_in_roles
dedent|''
name|'def'
name|'test_authorize_succeeds_for_user_role_in_roles'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'acl'
op|'='
string|"'allowme'"
newline|'\n'
name|'identity'
op|'='
name|'self'
op|'.'
name|'_get_identity'
op|'('
name|'roles'
op|'='
op|'['
name|'acl'
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_check_authenticate'
op|'('
name|'identity'
op|'='
name|'identity'
op|','
name|'acl'
op|'='
name|'acl'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_authorize_succeeds_for_tenant_name_user_in_roles
dedent|''
name|'def'
name|'test_authorize_succeeds_for_tenant_name_user_in_roles'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'identity'
op|'='
name|'self'
op|'.'
name|'_get_identity'
op|'('
op|')'
newline|'\n'
name|'user_name'
op|'='
name|'identity'
op|'['
string|"'HTTP_X_USER_NAME'"
op|']'
newline|'\n'
name|'user_id'
op|'='
name|'identity'
op|'['
string|"'HTTP_X_USER_ID'"
op|']'
newline|'\n'
name|'tenant_id'
op|'='
name|'identity'
op|'['
string|"'HTTP_X_TENANT_ID'"
op|']'
newline|'\n'
name|'for'
name|'user'
name|'in'
op|'['
name|'user_id'
op|','
name|'user_name'
op|','
string|"'*'"
op|']'
op|':'
newline|'\n'
indent|'            '
name|'acl'
op|'='
string|"'%s:%s'"
op|'%'
op|'('
name|'tenant_id'
op|','
name|'user'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_check_authenticate'
op|'('
name|'identity'
op|'='
name|'identity'
op|','
name|'acl'
op|'='
name|'acl'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_authorize_succeeds_for_tenant_id_user_in_roles
dedent|''
dedent|''
name|'def'
name|'test_authorize_succeeds_for_tenant_id_user_in_roles'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'identity'
op|'='
name|'self'
op|'.'
name|'_get_identity'
op|'('
op|')'
newline|'\n'
name|'user_name'
op|'='
name|'identity'
op|'['
string|"'HTTP_X_USER_NAME'"
op|']'
newline|'\n'
name|'user_id'
op|'='
name|'identity'
op|'['
string|"'HTTP_X_USER_ID'"
op|']'
newline|'\n'
name|'tenant_name'
op|'='
name|'identity'
op|'['
string|"'HTTP_X_TENANT_NAME'"
op|']'
newline|'\n'
name|'for'
name|'user'
name|'in'
op|'['
name|'user_id'
op|','
name|'user_name'
op|','
string|"'*'"
op|']'
op|':'
newline|'\n'
indent|'            '
name|'acl'
op|'='
string|"'%s:%s'"
op|'%'
op|'('
name|'tenant_name'
op|','
name|'user'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_check_authenticate'
op|'('
name|'identity'
op|'='
name|'identity'
op|','
name|'acl'
op|'='
name|'acl'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_authorize_succeeds_for_wildcard_tenant_user_in_roles
dedent|''
dedent|''
name|'def'
name|'test_authorize_succeeds_for_wildcard_tenant_user_in_roles'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'identity'
op|'='
name|'self'
op|'.'
name|'_get_identity'
op|'('
op|')'
newline|'\n'
name|'user_name'
op|'='
name|'identity'
op|'['
string|"'HTTP_X_USER_NAME'"
op|']'
newline|'\n'
name|'user_id'
op|'='
name|'identity'
op|'['
string|"'HTTP_X_USER_ID'"
op|']'
newline|'\n'
name|'for'
name|'user'
name|'in'
op|'['
name|'user_id'
op|','
name|'user_name'
op|','
string|"'*'"
op|']'
op|':'
newline|'\n'
indent|'            '
name|'acl'
op|'='
string|"'*:%s'"
op|'%'
name|'user'
newline|'\n'
name|'self'
op|'.'
name|'_check_authenticate'
op|'('
name|'identity'
op|'='
name|'identity'
op|','
name|'acl'
op|'='
name|'acl'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_cross_tenant_authorization_success
dedent|''
dedent|''
name|'def'
name|'test_cross_tenant_authorization_success'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'assertEqual'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'_authorize_cross_tenant'
op|'('
nl|'\n'
string|"'userID'"
op|','
string|"'userA'"
op|','
string|"'tenantID'"
op|','
string|"'tenantNAME'"
op|','
nl|'\n'
op|'['
string|"'tenantID:userA'"
op|']'
op|')'
op|','
nl|'\n'
string|"'tenantID:userA'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'_authorize_cross_tenant'
op|'('
nl|'\n'
string|"'userID'"
op|','
string|"'userA'"
op|','
string|"'tenantID'"
op|','
string|"'tenantNAME'"
op|','
nl|'\n'
op|'['
string|"'tenantNAME:userA'"
op|']'
op|')'
op|','
nl|'\n'
string|"'tenantNAME:userA'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'_authorize_cross_tenant'
op|'('
nl|'\n'
string|"'userID'"
op|','
string|"'userA'"
op|','
string|"'tenantID'"
op|','
string|"'tenantNAME'"
op|','
op|'['
string|"'*:userA'"
op|']'
op|')'
op|','
nl|'\n'
string|"'*:userA'"
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'_authorize_cross_tenant'
op|'('
nl|'\n'
string|"'userID'"
op|','
string|"'userA'"
op|','
string|"'tenantID'"
op|','
string|"'tenantNAME'"
op|','
nl|'\n'
op|'['
string|"'tenantID:userID'"
op|']'
op|')'
op|','
nl|'\n'
string|"'tenantID:userID'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'_authorize_cross_tenant'
op|'('
nl|'\n'
string|"'userID'"
op|','
string|"'userA'"
op|','
string|"'tenantID'"
op|','
string|"'tenantNAME'"
op|','
nl|'\n'
op|'['
string|"'tenantNAME:userID'"
op|']'
op|')'
op|','
nl|'\n'
string|"'tenantNAME:userID'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'_authorize_cross_tenant'
op|'('
nl|'\n'
string|"'userID'"
op|','
string|"'userA'"
op|','
string|"'tenantID'"
op|','
string|"'tenantNAME'"
op|','
op|'['
string|"'*:userID'"
op|']'
op|')'
op|','
nl|'\n'
string|"'*:userID'"
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'_authorize_cross_tenant'
op|'('
nl|'\n'
string|"'userID'"
op|','
string|"'userA'"
op|','
string|"'tenantID'"
op|','
string|"'tenantNAME'"
op|','
op|'['
string|"'tenantID:*'"
op|']'
op|')'
op|','
nl|'\n'
string|"'tenantID:*'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'_authorize_cross_tenant'
op|'('
nl|'\n'
string|"'userID'"
op|','
string|"'userA'"
op|','
string|"'tenantID'"
op|','
string|"'tenantNAME'"
op|','
op|'['
string|"'tenantNAME:*'"
op|']'
op|')'
op|','
nl|'\n'
string|"'tenantNAME:*'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'_authorize_cross_tenant'
op|'('
nl|'\n'
string|"'userID'"
op|','
string|"'userA'"
op|','
string|"'tenantID'"
op|','
string|"'tenantNAME'"
op|','
op|'['
string|"'*:*'"
op|']'
op|')'
op|','
nl|'\n'
string|"'*:*'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_cross_tenant_authorization_failure
dedent|''
name|'def'
name|'test_cross_tenant_authorization_failure'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'assertEqual'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'_authorize_cross_tenant'
op|'('
nl|'\n'
string|"'userID'"
op|','
string|"'userA'"
op|','
string|"'tenantID'"
op|','
string|"'tenantNAME'"
op|','
nl|'\n'
op|'['
string|"'tenantXYZ:userA'"
op|']'
op|')'
op|','
nl|'\n'
name|'None'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_cross_tenant_authorization_allow_names
dedent|''
name|'def'
name|'test_cross_tenant_authorization_allow_names'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# tests that the allow_names arg does the right thing'
nl|'\n'
indent|'        '
name|'self'
op|'.'
name|'assertEqual'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'_authorize_cross_tenant'
op|'('
nl|'\n'
string|"'userID'"
op|','
string|"'userA'"
op|','
string|"'tenantID'"
op|','
string|"'tenantNAME'"
op|','
nl|'\n'
op|'['
string|"'tenantNAME:userA'"
op|']'
op|','
name|'allow_names'
op|'='
name|'True'
op|')'
op|','
nl|'\n'
string|"'tenantNAME:userA'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'_authorize_cross_tenant'
op|'('
nl|'\n'
string|"'userID'"
op|','
string|"'userA'"
op|','
string|"'tenantID'"
op|','
string|"'tenantNAME'"
op|','
nl|'\n'
op|'['
string|"'tenantNAME:userID'"
op|']'
op|','
name|'allow_names'
op|'='
name|'True'
op|')'
op|','
nl|'\n'
string|"'tenantNAME:userID'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'_authorize_cross_tenant'
op|'('
nl|'\n'
string|"'userID'"
op|','
string|"'userA'"
op|','
string|"'tenantID'"
op|','
string|"'tenantNAME'"
op|','
nl|'\n'
op|'['
string|"'tenantID:userA'"
op|']'
op|','
name|'allow_names'
op|'='
name|'True'
op|')'
op|','
nl|'\n'
string|"'tenantID:userA'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'_authorize_cross_tenant'
op|'('
nl|'\n'
string|"'userID'"
op|','
string|"'userA'"
op|','
string|"'tenantID'"
op|','
string|"'tenantNAME'"
op|','
nl|'\n'
op|'['
string|"'tenantID:userID'"
op|']'
op|','
name|'allow_names'
op|'='
name|'True'
op|')'
op|','
nl|'\n'
string|"'tenantID:userID'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'_authorize_cross_tenant'
op|'('
nl|'\n'
string|"'userID'"
op|','
string|"'userA'"
op|','
string|"'tenantID'"
op|','
string|"'tenantNAME'"
op|','
nl|'\n'
op|'['
string|"'tenantNAME:userA'"
op|']'
op|','
name|'allow_names'
op|'='
name|'False'
op|')'
op|','
nl|'\n'
name|'None'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'_authorize_cross_tenant'
op|'('
nl|'\n'
string|"'userID'"
op|','
string|"'userA'"
op|','
string|"'tenantID'"
op|','
string|"'tenantNAME'"
op|','
nl|'\n'
op|'['
string|"'tenantID:userA'"
op|']'
op|','
name|'allow_names'
op|'='
name|'False'
op|')'
op|','
nl|'\n'
name|'None'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'_authorize_cross_tenant'
op|'('
nl|'\n'
string|"'userID'"
op|','
string|"'userA'"
op|','
string|"'tenantID'"
op|','
string|"'tenantNAME'"
op|','
nl|'\n'
op|'['
string|"'tenantNAME:userID'"
op|']'
op|','
name|'allow_names'
op|'='
name|'False'
op|')'
op|','
nl|'\n'
name|'None'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'_authorize_cross_tenant'
op|'('
nl|'\n'
string|"'userID'"
op|','
string|"'userA'"
op|','
string|"'tenantID'"
op|','
string|"'tenantNAME'"
op|','
nl|'\n'
op|'['
string|"'tenantID:userID'"
op|']'
op|','
name|'allow_names'
op|'='
name|'False'
op|')'
op|','
nl|'\n'
string|"'tenantID:userID'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_delete_own_account_not_allowed
dedent|''
name|'def'
name|'test_delete_own_account_not_allowed'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'roles'
op|'='
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'operator_roles'
op|'.'
name|'split'
op|'('
string|"','"
op|')'
newline|'\n'
name|'identity'
op|'='
name|'self'
op|'.'
name|'_get_identity'
op|'('
name|'roles'
op|'='
name|'roles'
op|')'
newline|'\n'
name|'account'
op|'='
name|'self'
op|'.'
name|'_get_account'
op|'('
name|'identity'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_check_authenticate'
op|'('
name|'account'
op|'='
name|'account'
op|','
nl|'\n'
name|'identity'
op|'='
name|'identity'
op|','
nl|'\n'
name|'exception'
op|'='
name|'HTTP_FORBIDDEN'
op|','
nl|'\n'
name|'path'
op|'='
string|"'/v1/'"
op|'+'
name|'account'
op|','
nl|'\n'
name|'env'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'DELETE'"
op|'}'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_delete_own_account_when_reseller_allowed
dedent|''
name|'def'
name|'test_delete_own_account_when_reseller_allowed'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'roles'
op|'='
op|'['
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'reseller_admin_role'
op|']'
newline|'\n'
name|'identity'
op|'='
name|'self'
op|'.'
name|'_get_identity'
op|'('
name|'roles'
op|'='
name|'roles'
op|')'
newline|'\n'
name|'account'
op|'='
name|'self'
op|'.'
name|'_get_account'
op|'('
name|'identity'
op|')'
newline|'\n'
name|'req'
op|'='
name|'self'
op|'.'
name|'_check_authenticate'
op|'('
name|'account'
op|'='
name|'account'
op|','
nl|'\n'
name|'identity'
op|'='
name|'identity'
op|','
nl|'\n'
name|'path'
op|'='
string|"'/v1/'"
op|'+'
name|'account'
op|','
nl|'\n'
name|'env'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'DELETE'"
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'bool'
op|'('
name|'req'
op|'.'
name|'environ'
op|'.'
name|'get'
op|'('
string|"'swift_owner'"
op|')'
op|')'
op|','
name|'True'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_identity_set_up_at_call
dedent|''
name|'def'
name|'test_identity_set_up_at_call'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
DECL|function|fake_start_response
indent|'        '
name|'def'
name|'fake_start_response'
op|'('
op|'*'
name|'args'
op|','
op|'**'
name|'kwargs'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'pass'
newline|'\n'
dedent|''
name|'the_env'
op|'='
name|'self'
op|'.'
name|'_get_identity'
op|'('
nl|'\n'
name|'tenant_id'
op|'='
string|"'test'"
op|','
name|'roles'
op|'='
op|'['
string|"'reselleradmin'"
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'test_auth'
op|'('
name|'the_env'
op|','
name|'fake_start_response'
op|')'
newline|'\n'
nl|'\n'
name|'subreq'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
nl|'\n'
string|"'/v1/%s/c/o'"
op|'%'
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'_get_account_for_tenant'
op|'('
string|"'test'"
op|')'
op|')'
newline|'\n'
name|'subreq'
op|'.'
name|'environ'
op|'.'
name|'update'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'_get_identity'
op|'('
name|'tenant_id'
op|'='
string|"'test'"
op|','
name|'roles'
op|'='
op|'['
string|"'got_erased'"
op|']'
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'authorize_resp'
op|'='
name|'the_env'
op|'['
string|"'swift.authorize'"
op|']'
op|'('
name|'subreq'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'authorize_resp'
op|','
name|'None'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_names_disallowed_in_acls_outside_default_domain
dedent|''
name|'def'
name|'test_names_disallowed_in_acls_outside_default_domain'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'id'
op|'='
name|'self'
op|'.'
name|'_get_identity'
op|'('
name|'user_domain_id'
op|'='
string|"'non-default'"
op|','
nl|'\n'
name|'project_domain_id'
op|'='
string|"'non-default'"
op|')'
newline|'\n'
name|'env'
op|'='
op|'{'
string|"'keystone.token_info'"
op|':'
name|'_fake_token_info'
op|'('
name|'version'
op|'='
string|"'3'"
op|')'
op|'}'
newline|'\n'
name|'acl'
op|'='
string|"'%s:%s'"
op|'%'
op|'('
name|'id'
op|'['
string|"'HTTP_X_TENANT_NAME'"
op|']'
op|','
name|'id'
op|'['
string|"'HTTP_X_USER_NAME'"
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_check_authenticate'
op|'('
name|'acl'
op|'='
name|'acl'
op|','
name|'identity'
op|'='
name|'id'
op|','
name|'env'
op|'='
name|'env'
op|','
nl|'\n'
name|'exception'
op|'='
name|'HTTP_FORBIDDEN'
op|')'
newline|'\n'
name|'acl'
op|'='
string|"'%s:%s'"
op|'%'
op|'('
name|'id'
op|'['
string|"'HTTP_X_TENANT_NAME'"
op|']'
op|','
name|'id'
op|'['
string|"'HTTP_X_USER_ID'"
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_check_authenticate'
op|'('
name|'acl'
op|'='
name|'acl'
op|','
name|'identity'
op|'='
name|'id'
op|','
name|'env'
op|'='
name|'env'
op|','
nl|'\n'
name|'exception'
op|'='
name|'HTTP_FORBIDDEN'
op|')'
newline|'\n'
name|'acl'
op|'='
string|"'%s:%s'"
op|'%'
op|'('
name|'id'
op|'['
string|"'HTTP_X_TENANT_ID'"
op|']'
op|','
name|'id'
op|'['
string|"'HTTP_X_USER_NAME'"
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_check_authenticate'
op|'('
name|'acl'
op|'='
name|'acl'
op|','
name|'identity'
op|'='
name|'id'
op|','
name|'env'
op|'='
name|'env'
op|','
nl|'\n'
name|'exception'
op|'='
name|'HTTP_FORBIDDEN'
op|')'
newline|'\n'
name|'acl'
op|'='
string|"'%s:%s'"
op|'%'
op|'('
name|'id'
op|'['
string|"'HTTP_X_TENANT_ID'"
op|']'
op|','
name|'id'
op|'['
string|"'HTTP_X_USER_ID'"
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_check_authenticate'
op|'('
name|'acl'
op|'='
name|'acl'
op|','
name|'identity'
op|'='
name|'id'
op|','
name|'env'
op|'='
name|'env'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_names_allowed_in_acls_inside_default_domain
dedent|''
name|'def'
name|'test_names_allowed_in_acls_inside_default_domain'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'id'
op|'='
name|'self'
op|'.'
name|'_get_identity'
op|'('
name|'user_domain_id'
op|'='
string|"'default'"
op|','
nl|'\n'
name|'project_domain_id'
op|'='
string|"'default'"
op|')'
newline|'\n'
name|'env'
op|'='
op|'{'
string|"'keystone.token_info'"
op|':'
name|'_fake_token_info'
op|'('
name|'version'
op|'='
string|"'3'"
op|')'
op|'}'
newline|'\n'
name|'acl'
op|'='
string|"'%s:%s'"
op|'%'
op|'('
name|'id'
op|'['
string|"'HTTP_X_TENANT_NAME'"
op|']'
op|','
name|'id'
op|'['
string|"'HTTP_X_USER_NAME'"
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_check_authenticate'
op|'('
name|'acl'
op|'='
name|'acl'
op|','
name|'identity'
op|'='
name|'id'
op|','
name|'env'
op|'='
name|'env'
op|')'
newline|'\n'
name|'acl'
op|'='
string|"'%s:%s'"
op|'%'
op|'('
name|'id'
op|'['
string|"'HTTP_X_TENANT_NAME'"
op|']'
op|','
name|'id'
op|'['
string|"'HTTP_X_USER_ID'"
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_check_authenticate'
op|'('
name|'acl'
op|'='
name|'acl'
op|','
name|'identity'
op|'='
name|'id'
op|','
name|'env'
op|'='
name|'env'
op|')'
newline|'\n'
name|'acl'
op|'='
string|"'%s:%s'"
op|'%'
op|'('
name|'id'
op|'['
string|"'HTTP_X_TENANT_ID'"
op|']'
op|','
name|'id'
op|'['
string|"'HTTP_X_USER_NAME'"
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_check_authenticate'
op|'('
name|'acl'
op|'='
name|'acl'
op|','
name|'identity'
op|'='
name|'id'
op|','
name|'env'
op|'='
name|'env'
op|')'
newline|'\n'
name|'acl'
op|'='
string|"'%s:%s'"
op|'%'
op|'('
name|'id'
op|'['
string|"'HTTP_X_TENANT_ID'"
op|']'
op|','
name|'id'
op|'['
string|"'HTTP_X_USER_ID'"
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_check_authenticate'
op|'('
name|'acl'
op|'='
name|'acl'
op|','
name|'identity'
op|'='
name|'id'
op|','
name|'env'
op|'='
name|'env'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_names_allowed_in_acls_inside_default_domain_with_config
dedent|''
name|'def'
name|'test_names_allowed_in_acls_inside_default_domain_with_config'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'conf'
op|'='
op|'{'
string|"'allow_names_in_acls'"
op|':'
string|"'yes'"
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'test_auth'
op|'='
name|'keystoneauth'
op|'.'
name|'filter_factory'
op|'('
name|'conf'
op|')'
op|'('
name|'FakeApp'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'logger'
op|'='
name|'FakeLogger'
op|'('
op|')'
newline|'\n'
name|'id'
op|'='
name|'self'
op|'.'
name|'_get_identity'
op|'('
name|'user_domain_id'
op|'='
string|"'default'"
op|','
nl|'\n'
name|'project_domain_id'
op|'='
string|"'default'"
op|')'
newline|'\n'
name|'env'
op|'='
op|'{'
string|"'keystone.token_info'"
op|':'
name|'_fake_token_info'
op|'('
name|'version'
op|'='
string|"'3'"
op|')'
op|'}'
newline|'\n'
name|'acl'
op|'='
string|"'%s:%s'"
op|'%'
op|'('
name|'id'
op|'['
string|"'HTTP_X_TENANT_NAME'"
op|']'
op|','
name|'id'
op|'['
string|"'HTTP_X_USER_NAME'"
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_check_authenticate'
op|'('
name|'acl'
op|'='
name|'acl'
op|','
name|'identity'
op|'='
name|'id'
op|','
name|'env'
op|'='
name|'env'
op|')'
newline|'\n'
name|'acl'
op|'='
string|"'%s:%s'"
op|'%'
op|'('
name|'id'
op|'['
string|"'HTTP_X_TENANT_NAME'"
op|']'
op|','
name|'id'
op|'['
string|"'HTTP_X_USER_ID'"
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_check_authenticate'
op|'('
name|'acl'
op|'='
name|'acl'
op|','
name|'identity'
op|'='
name|'id'
op|','
name|'env'
op|'='
name|'env'
op|')'
newline|'\n'
name|'acl'
op|'='
string|"'%s:%s'"
op|'%'
op|'('
name|'id'
op|'['
string|"'HTTP_X_TENANT_ID'"
op|']'
op|','
name|'id'
op|'['
string|"'HTTP_X_USER_NAME'"
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_check_authenticate'
op|'('
name|'acl'
op|'='
name|'acl'
op|','
name|'identity'
op|'='
name|'id'
op|','
name|'env'
op|'='
name|'env'
op|')'
newline|'\n'
name|'acl'
op|'='
string|"'%s:%s'"
op|'%'
op|'('
name|'id'
op|'['
string|"'HTTP_X_TENANT_ID'"
op|']'
op|','
name|'id'
op|'['
string|"'HTTP_X_USER_ID'"
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_check_authenticate'
op|'('
name|'acl'
op|'='
name|'acl'
op|','
name|'identity'
op|'='
name|'id'
op|','
name|'env'
op|'='
name|'env'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_names_disallowed_in_acls_inside_default_domain
dedent|''
name|'def'
name|'test_names_disallowed_in_acls_inside_default_domain'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'conf'
op|'='
op|'{'
string|"'allow_names_in_acls'"
op|':'
string|"'false'"
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'test_auth'
op|'='
name|'keystoneauth'
op|'.'
name|'filter_factory'
op|'('
name|'conf'
op|')'
op|'('
name|'FakeApp'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'logger'
op|'='
name|'FakeLogger'
op|'('
op|')'
newline|'\n'
name|'id'
op|'='
name|'self'
op|'.'
name|'_get_identity'
op|'('
name|'user_domain_id'
op|'='
string|"'default'"
op|','
nl|'\n'
name|'project_domain_id'
op|'='
string|"'default'"
op|')'
newline|'\n'
name|'env'
op|'='
op|'{'
string|"'keystone.token_info'"
op|':'
name|'_fake_token_info'
op|'('
name|'version'
op|'='
string|"'3'"
op|')'
op|'}'
newline|'\n'
name|'acl'
op|'='
string|"'%s:%s'"
op|'%'
op|'('
name|'id'
op|'['
string|"'HTTP_X_TENANT_NAME'"
op|']'
op|','
name|'id'
op|'['
string|"'HTTP_X_USER_NAME'"
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_check_authenticate'
op|'('
name|'acl'
op|'='
name|'acl'
op|','
name|'identity'
op|'='
name|'id'
op|','
name|'env'
op|'='
name|'env'
op|','
nl|'\n'
name|'exception'
op|'='
name|'HTTP_FORBIDDEN'
op|')'
newline|'\n'
name|'acl'
op|'='
string|"'%s:%s'"
op|'%'
op|'('
name|'id'
op|'['
string|"'HTTP_X_TENANT_NAME'"
op|']'
op|','
name|'id'
op|'['
string|"'HTTP_X_USER_ID'"
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_check_authenticate'
op|'('
name|'acl'
op|'='
name|'acl'
op|','
name|'identity'
op|'='
name|'id'
op|','
name|'env'
op|'='
name|'env'
op|','
nl|'\n'
name|'exception'
op|'='
name|'HTTP_FORBIDDEN'
op|')'
newline|'\n'
name|'acl'
op|'='
string|"'%s:%s'"
op|'%'
op|'('
name|'id'
op|'['
string|"'HTTP_X_TENANT_ID'"
op|']'
op|','
name|'id'
op|'['
string|"'HTTP_X_USER_NAME'"
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_check_authenticate'
op|'('
name|'acl'
op|'='
name|'acl'
op|','
name|'identity'
op|'='
name|'id'
op|','
name|'env'
op|'='
name|'env'
op|','
nl|'\n'
name|'exception'
op|'='
name|'HTTP_FORBIDDEN'
op|')'
newline|'\n'
name|'acl'
op|'='
string|"'%s:%s'"
op|'%'
op|'('
name|'id'
op|'['
string|"'HTTP_X_TENANT_ID'"
op|']'
op|','
name|'id'
op|'['
string|"'HTTP_X_USER_ID'"
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_check_authenticate'
op|'('
name|'acl'
op|'='
name|'acl'
op|','
name|'identity'
op|'='
name|'id'
op|','
name|'env'
op|'='
name|'env'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_integral_keystone_identity
dedent|''
name|'def'
name|'test_integral_keystone_identity'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'user'
op|'='
op|'('
string|"'U_ID'"
op|','
string|"'U_NAME'"
op|')'
newline|'\n'
name|'roles'
op|'='
op|'('
string|"'ROLE1'"
op|','
string|"'ROLE2'"
op|')'
newline|'\n'
name|'project'
op|'='
op|'('
string|"'P_ID'"
op|','
string|"'P_NAME'"
op|')'
newline|'\n'
name|'user_domain'
op|'='
op|'('
string|"'UD_ID'"
op|','
string|"'UD_NAME'"
op|')'
newline|'\n'
name|'project_domain'
op|'='
op|'('
string|"'PD_ID'"
op|','
string|"'PD_NAME'"
op|')'
newline|'\n'
nl|'\n'
comment|'# no valid identity info in headers'
nl|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/v/a/c/o'"
op|')'
newline|'\n'
name|'data'
op|'='
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'_integral_keystone_identity'
op|'('
name|'req'
op|'.'
name|'environ'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'None'
op|','
name|'data'
op|')'
newline|'\n'
nl|'\n'
comment|'# valid identity info in headers, but status unconfirmed'
nl|'\n'
name|'req'
op|'.'
name|'headers'
op|'.'
name|'update'
op|'('
op|'{'
string|"'X-Identity-Status'"
op|':'
string|"'Blah'"
op|','
nl|'\n'
string|"'X-Roles'"
op|':'
string|"'%s,%s'"
op|'%'
name|'roles'
op|','
nl|'\n'
string|"'X-User-Id'"
op|':'
name|'user'
op|'['
number|'0'
op|']'
op|','
nl|'\n'
string|"'X-User-Name'"
op|':'
name|'user'
op|'['
number|'1'
op|']'
op|','
nl|'\n'
string|"'X-Tenant-Id'"
op|':'
name|'project'
op|'['
number|'0'
op|']'
op|','
nl|'\n'
string|"'X-Tenant-Name'"
op|':'
name|'project'
op|'['
number|'1'
op|']'
op|','
nl|'\n'
string|"'X-User-Domain-Id'"
op|':'
name|'user_domain'
op|'['
number|'0'
op|']'
op|','
nl|'\n'
string|"'X-User-Domain-Name'"
op|':'
name|'user_domain'
op|'['
number|'1'
op|']'
op|','
nl|'\n'
string|"'X-Project-Domain-Id'"
op|':'
name|'project_domain'
op|'['
number|'0'
op|']'
op|','
nl|'\n'
string|"'X-Project-Domain-Name'"
op|':'
name|'project_domain'
op|'['
number|'1'
op|']'
op|'}'
op|')'
newline|'\n'
name|'data'
op|'='
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'_integral_keystone_identity'
op|'('
name|'req'
op|'.'
name|'environ'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'None'
op|','
name|'data'
op|')'
newline|'\n'
nl|'\n'
comment|'# valid identity info in headers, no token info in environ'
nl|'\n'
name|'req'
op|'.'
name|'headers'
op|'.'
name|'update'
op|'('
op|'{'
string|"'X-Identity-Status'"
op|':'
string|"'Confirmed'"
op|'}'
op|')'
newline|'\n'
name|'expected'
op|'='
op|'{'
string|"'user'"
op|':'
name|'user'
op|','
nl|'\n'
string|"'tenant'"
op|':'
name|'project'
op|','
nl|'\n'
string|"'roles'"
op|':'
name|'list'
op|'('
name|'roles'
op|')'
op|','
nl|'\n'
string|"'user_domain'"
op|':'
op|'('
name|'None'
op|','
name|'None'
op|')'
op|','
nl|'\n'
string|"'project_domain'"
op|':'
op|'('
name|'None'
op|','
name|'None'
op|')'
op|','
nl|'\n'
string|"'auth_version'"
op|':'
number|'0'
op|'}'
newline|'\n'
name|'data'
op|'='
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'_integral_keystone_identity'
op|'('
name|'req'
op|'.'
name|'environ'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'expected'
op|','
name|'data'
op|')'
newline|'\n'
nl|'\n'
comment|'# v2 token info in environ'
nl|'\n'
name|'req'
op|'.'
name|'environ'
op|'['
string|"'keystone.token_info'"
op|']'
op|'='
name|'_fake_token_info'
op|'('
name|'version'
op|'='
string|"'2'"
op|')'
newline|'\n'
name|'expected'
op|'='
op|'{'
string|"'user'"
op|':'
name|'user'
op|','
nl|'\n'
string|"'tenant'"
op|':'
name|'project'
op|','
nl|'\n'
string|"'roles'"
op|':'
name|'list'
op|'('
name|'roles'
op|')'
op|','
nl|'\n'
string|"'user_domain'"
op|':'
op|'('
name|'None'
op|','
name|'None'
op|')'
op|','
nl|'\n'
string|"'project_domain'"
op|':'
op|'('
name|'None'
op|','
name|'None'
op|')'
op|','
nl|'\n'
string|"'auth_version'"
op|':'
number|'2'
op|'}'
newline|'\n'
name|'data'
op|'='
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'_integral_keystone_identity'
op|'('
name|'req'
op|'.'
name|'environ'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'expected'
op|','
name|'data'
op|')'
newline|'\n'
nl|'\n'
comment|'# v3 token info in environ'
nl|'\n'
name|'req'
op|'.'
name|'environ'
op|'['
string|"'keystone.token_info'"
op|']'
op|'='
name|'_fake_token_info'
op|'('
name|'version'
op|'='
string|"'3'"
op|')'
newline|'\n'
name|'expected'
op|'='
op|'{'
string|"'user'"
op|':'
name|'user'
op|','
nl|'\n'
string|"'tenant'"
op|':'
name|'project'
op|','
nl|'\n'
string|"'roles'"
op|':'
name|'list'
op|'('
name|'roles'
op|')'
op|','
nl|'\n'
string|"'user_domain'"
op|':'
name|'user_domain'
op|','
nl|'\n'
string|"'project_domain'"
op|':'
name|'project_domain'
op|','
nl|'\n'
string|"'auth_version'"
op|':'
number|'3'
op|'}'
newline|'\n'
name|'data'
op|'='
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'_integral_keystone_identity'
op|'('
name|'req'
op|'.'
name|'environ'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'expected'
op|','
name|'data'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_project_domain_id
dedent|''
name|'def'
name|'test_get_project_domain_id'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'sysmeta'
op|'='
op|'{'
op|'}'
newline|'\n'
name|'info'
op|'='
op|'{'
string|"'sysmeta'"
op|':'
name|'sysmeta'
op|'}'
newline|'\n'
name|'_'
op|','
name|'info_key'
op|'='
name|'_get_cache_key'
op|'('
string|"'AUTH_1234'"
op|','
name|'None'
op|')'
newline|'\n'
name|'env'
op|'='
op|'{'
string|"'PATH_INFO'"
op|':'
string|"'/v1/AUTH_1234'"
op|','
nl|'\n'
name|'info_key'
op|':'
name|'info'
op|'}'
newline|'\n'
nl|'\n'
comment|'# account does not exist'
nl|'\n'
name|'info'
op|'['
string|"'status'"
op|']'
op|'='
number|'404'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'_get_project_domain_id'
op|'('
name|'env'
op|')'
op|','
nl|'\n'
op|'('
name|'False'
op|','
name|'None'
op|')'
op|')'
newline|'\n'
name|'info'
op|'['
string|"'status'"
op|']'
op|'='
number|'0'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'_get_project_domain_id'
op|'('
name|'env'
op|')'
op|','
nl|'\n'
op|'('
name|'False'
op|','
name|'None'
op|')'
op|')'
newline|'\n'
nl|'\n'
comment|'# account exists, no project domain id in sysmeta'
nl|'\n'
name|'info'
op|'['
string|"'status'"
op|']'
op|'='
number|'200'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'_get_project_domain_id'
op|'('
name|'env'
op|')'
op|','
nl|'\n'
op|'('
name|'True'
op|','
name|'None'
op|')'
op|')'
newline|'\n'
nl|'\n'
comment|'# account exists with project domain id in sysmeta'
nl|'\n'
name|'sysmeta'
op|'['
string|"'project-domain-id'"
op|']'
op|'='
string|"'default'"
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'_get_project_domain_id'
op|'('
name|'env'
op|')'
op|','
nl|'\n'
op|'('
name|'True'
op|','
string|"'default'"
op|')'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|TestIsNameAllowedInACL
dedent|''
dedent|''
name|'class'
name|'TestIsNameAllowedInACL'
op|'('
name|'BaseTestAuthorize'
op|')'
op|':'
newline|'\n'
DECL|member|setUp
indent|'    '
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'super'
op|'('
name|'TestIsNameAllowedInACL'
op|','
name|'self'
op|')'
op|'.'
name|'setUp'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'default_id'
op|'='
string|"'default'"
newline|'\n'
nl|'\n'
DECL|member|_assert_names_allowed
dedent|''
name|'def'
name|'_assert_names_allowed'
op|'('
name|'self'
op|','
name|'expected'
op|','
name|'user_domain_id'
op|'='
name|'None'
op|','
nl|'\n'
name|'req_project_domain_id'
op|'='
name|'None'
op|','
nl|'\n'
name|'sysmeta_project_domain_id'
op|'='
name|'None'
op|','
nl|'\n'
name|'scoped'
op|'='
string|"'account'"
op|')'
op|':'
newline|'\n'
indent|'        '
name|'project_name'
op|'='
string|"'foo'"
newline|'\n'
name|'account_id'
op|'='
string|"'12345678'"
newline|'\n'
name|'account'
op|'='
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'_get_account_for_tenant'
op|'('
name|'account_id'
op|')'
newline|'\n'
name|'parts'
op|'='
op|'('
string|"'v1'"
op|','
name|'account'
op|','
name|'None'
op|','
name|'None'
op|')'
newline|'\n'
name|'path'
op|'='
string|"'/%s/%s'"
op|'%'
name|'parts'
op|'['
number|'0'
op|':'
number|'2'
op|']'
newline|'\n'
nl|'\n'
name|'sysmeta'
op|'='
op|'{'
op|'}'
newline|'\n'
name|'if'
name|'sysmeta_project_domain_id'
op|':'
newline|'\n'
indent|'            '
name|'sysmeta'
op|'='
op|'{'
string|"'project-domain-id'"
op|':'
name|'sysmeta_project_domain_id'
op|'}'
newline|'\n'
nl|'\n'
comment|'# pretend account exists'
nl|'\n'
dedent|''
name|'info'
op|'='
op|'{'
string|"'status'"
op|':'
number|'200'
op|','
string|"'sysmeta'"
op|':'
name|'sysmeta'
op|'}'
newline|'\n'
name|'_'
op|','
name|'info_key'
op|'='
name|'_get_cache_key'
op|'('
name|'account'
op|','
name|'None'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
name|'path'
op|','
name|'environ'
op|'='
op|'{'
name|'info_key'
op|':'
name|'info'
op|'}'
op|')'
newline|'\n'
nl|'\n'
name|'if'
name|'scoped'
op|'=='
string|"'account'"
op|':'
newline|'\n'
indent|'            '
name|'project_name'
op|'='
string|"'account_name'"
newline|'\n'
name|'project_id'
op|'='
name|'account_id'
newline|'\n'
dedent|''
name|'elif'
name|'scoped'
op|'=='
string|"'other'"
op|':'
newline|'\n'
indent|'            '
name|'project_name'
op|'='
string|"'other_name'"
newline|'\n'
name|'project_id'
op|'='
string|"'87654321'"
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
comment|'# unscoped token'
nl|'\n'
indent|'            '
name|'project_name'
op|','
name|'project_id'
op|','
name|'req_project_domain_id'
op|'='
name|'None'
op|','
name|'None'
op|','
name|'None'
newline|'\n'
nl|'\n'
dedent|''
name|'if'
name|'user_domain_id'
op|':'
newline|'\n'
indent|'            '
name|'id'
op|'='
name|'self'
op|'.'
name|'_get_env_id'
op|'('
name|'tenant_name'
op|'='
name|'project_name'
op|','
nl|'\n'
name|'tenant_id'
op|'='
name|'project_id'
op|','
nl|'\n'
name|'user_domain_id'
op|'='
name|'user_domain_id'
op|','
nl|'\n'
name|'project_domain_id'
op|'='
name|'req_project_domain_id'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
comment|'# must be v2 token info'
nl|'\n'
indent|'            '
name|'id'
op|'='
name|'self'
op|'.'
name|'_get_env_id'
op|'('
name|'tenant_name'
op|'='
name|'project_name'
op|','
nl|'\n'
name|'tenant_id'
op|'='
name|'project_id'
op|','
nl|'\n'
name|'auth_version'
op|'='
string|"'2'"
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'actual'
op|'='
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'_is_name_allowed_in_acl'
op|'('
name|'req'
op|','
name|'parts'
op|','
name|'id'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'actual'
op|','
name|'expected'
op|','
string|"'%s, %s, %s, %s'"
nl|'\n'
op|'%'
op|'('
name|'user_domain_id'
op|','
name|'req_project_domain_id'
op|','
nl|'\n'
name|'sysmeta_project_domain_id'
op|','
name|'scoped'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_is_name_allowed_in_acl_with_token_scoped_to_tenant
dedent|''
name|'def'
name|'test_is_name_allowed_in_acl_with_token_scoped_to_tenant'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# no user or project domain ids in request token so must be v2,'
nl|'\n'
comment|'# user and project should be assumed to be in default domain'
nl|'\n'
indent|'        '
name|'self'
op|'.'
name|'_assert_names_allowed'
op|'('
name|'True'
op|','
name|'user_domain_id'
op|'='
name|'None'
op|','
nl|'\n'
name|'req_project_domain_id'
op|'='
name|'None'
op|','
nl|'\n'
name|'sysmeta_project_domain_id'
op|'='
name|'None'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_assert_names_allowed'
op|'('
name|'True'
op|','
name|'user_domain_id'
op|'='
name|'None'
op|','
nl|'\n'
name|'req_project_domain_id'
op|'='
name|'None'
op|','
nl|'\n'
name|'sysmeta_project_domain_id'
op|'='
name|'self'
op|'.'
name|'default_id'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_assert_names_allowed'
op|'('
name|'True'
op|','
name|'user_domain_id'
op|'='
name|'None'
op|','
nl|'\n'
name|'req_project_domain_id'
op|'='
name|'None'
op|','
nl|'\n'
name|'sysmeta_project_domain_id'
op|'='
name|'UNKNOWN_ID'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_assert_names_allowed'
op|'('
name|'True'
op|','
name|'user_domain_id'
op|'='
name|'None'
op|','
nl|'\n'
name|'req_project_domain_id'
op|'='
name|'None'
op|','
nl|'\n'
name|'sysmeta_project_domain_id'
op|'='
string|"'foo'"
op|')'
newline|'\n'
nl|'\n'
comment|'# user in default domain, project domain in token info takes precedence'
nl|'\n'
name|'self'
op|'.'
name|'_assert_names_allowed'
op|'('
name|'True'
op|','
name|'user_domain_id'
op|'='
name|'self'
op|'.'
name|'default_id'
op|','
nl|'\n'
name|'req_project_domain_id'
op|'='
name|'self'
op|'.'
name|'default_id'
op|','
nl|'\n'
name|'sysmeta_project_domain_id'
op|'='
name|'None'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_assert_names_allowed'
op|'('
name|'True'
op|','
name|'user_domain_id'
op|'='
name|'self'
op|'.'
name|'default_id'
op|','
nl|'\n'
name|'req_project_domain_id'
op|'='
name|'self'
op|'.'
name|'default_id'
op|','
nl|'\n'
name|'sysmeta_project_domain_id'
op|'='
name|'UNKNOWN_ID'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_assert_names_allowed'
op|'('
name|'True'
op|','
name|'user_domain_id'
op|'='
name|'self'
op|'.'
name|'default_id'
op|','
nl|'\n'
name|'req_project_domain_id'
op|'='
name|'self'
op|'.'
name|'default_id'
op|','
nl|'\n'
name|'sysmeta_project_domain_id'
op|'='
string|"'bar'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_assert_names_allowed'
op|'('
name|'False'
op|','
name|'user_domain_id'
op|'='
name|'self'
op|'.'
name|'default_id'
op|','
nl|'\n'
name|'req_project_domain_id'
op|'='
string|"'foo'"
op|','
nl|'\n'
name|'sysmeta_project_domain_id'
op|'='
name|'None'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_assert_names_allowed'
op|'('
name|'False'
op|','
name|'user_domain_id'
op|'='
name|'self'
op|'.'
name|'default_id'
op|','
nl|'\n'
name|'req_project_domain_id'
op|'='
string|"'foo'"
op|','
nl|'\n'
name|'sysmeta_project_domain_id'
op|'='
name|'self'
op|'.'
name|'default_id'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_assert_names_allowed'
op|'('
name|'False'
op|','
name|'user_domain_id'
op|'='
name|'self'
op|'.'
name|'default_id'
op|','
nl|'\n'
name|'req_project_domain_id'
op|'='
string|"'foo'"
op|','
nl|'\n'
name|'sysmeta_project_domain_id'
op|'='
string|"'foo'"
op|')'
newline|'\n'
nl|'\n'
comment|'# user in non-default domain so names should never be allowed'
nl|'\n'
name|'self'
op|'.'
name|'_assert_names_allowed'
op|'('
name|'False'
op|','
name|'user_domain_id'
op|'='
string|"'foo'"
op|','
nl|'\n'
name|'req_project_domain_id'
op|'='
name|'self'
op|'.'
name|'default_id'
op|','
nl|'\n'
name|'sysmeta_project_domain_id'
op|'='
name|'None'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_assert_names_allowed'
op|'('
name|'False'
op|','
name|'user_domain_id'
op|'='
string|"'foo'"
op|','
nl|'\n'
name|'req_project_domain_id'
op|'='
name|'self'
op|'.'
name|'default_id'
op|','
nl|'\n'
name|'sysmeta_project_domain_id'
op|'='
name|'self'
op|'.'
name|'default_id'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_assert_names_allowed'
op|'('
name|'False'
op|','
name|'user_domain_id'
op|'='
string|"'foo'"
op|','
nl|'\n'
name|'req_project_domain_id'
op|'='
name|'self'
op|'.'
name|'default_id'
op|','
nl|'\n'
name|'sysmeta_project_domain_id'
op|'='
name|'UNKNOWN_ID'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_assert_names_allowed'
op|'('
name|'False'
op|','
name|'user_domain_id'
op|'='
string|"'foo'"
op|','
nl|'\n'
name|'req_project_domain_id'
op|'='
name|'self'
op|'.'
name|'default_id'
op|','
nl|'\n'
name|'sysmeta_project_domain_id'
op|'='
string|"'foo'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_is_name_allowed_in_acl_with_unscoped_token
dedent|''
name|'def'
name|'test_is_name_allowed_in_acl_with_unscoped_token'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# user in default domain'
nl|'\n'
indent|'        '
name|'self'
op|'.'
name|'_assert_names_allowed'
op|'('
name|'True'
op|','
name|'user_domain_id'
op|'='
name|'self'
op|'.'
name|'default_id'
op|','
nl|'\n'
name|'sysmeta_project_domain_id'
op|'='
name|'None'
op|','
nl|'\n'
name|'scoped'
op|'='
name|'False'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_assert_names_allowed'
op|'('
name|'True'
op|','
name|'user_domain_id'
op|'='
name|'self'
op|'.'
name|'default_id'
op|','
nl|'\n'
name|'sysmeta_project_domain_id'
op|'='
name|'self'
op|'.'
name|'default_id'
op|','
nl|'\n'
name|'scoped'
op|'='
name|'False'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_assert_names_allowed'
op|'('
name|'False'
op|','
name|'user_domain_id'
op|'='
name|'self'
op|'.'
name|'default_id'
op|','
nl|'\n'
name|'sysmeta_project_domain_id'
op|'='
name|'UNKNOWN_ID'
op|','
nl|'\n'
name|'scoped'
op|'='
name|'False'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_assert_names_allowed'
op|'('
name|'False'
op|','
name|'user_domain_id'
op|'='
name|'self'
op|'.'
name|'default_id'
op|','
nl|'\n'
name|'sysmeta_project_domain_id'
op|'='
string|"'foo'"
op|','
nl|'\n'
name|'scoped'
op|'='
name|'False'
op|')'
newline|'\n'
nl|'\n'
comment|'# user in non-default domain so names should never be allowed'
nl|'\n'
name|'self'
op|'.'
name|'_assert_names_allowed'
op|'('
name|'False'
op|','
name|'user_domain_id'
op|'='
string|"'foo'"
op|','
nl|'\n'
name|'sysmeta_project_domain_id'
op|'='
name|'None'
op|','
nl|'\n'
name|'scoped'
op|'='
name|'False'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_assert_names_allowed'
op|'('
name|'False'
op|','
name|'user_domain_id'
op|'='
string|"'foo'"
op|','
nl|'\n'
name|'sysmeta_project_domain_id'
op|'='
name|'self'
op|'.'
name|'default_id'
op|','
nl|'\n'
name|'scoped'
op|'='
name|'False'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_assert_names_allowed'
op|'('
name|'False'
op|','
name|'user_domain_id'
op|'='
string|"'foo'"
op|','
nl|'\n'
name|'sysmeta_project_domain_id'
op|'='
name|'UNKNOWN_ID'
op|','
nl|'\n'
name|'scoped'
op|'='
name|'False'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_assert_names_allowed'
op|'('
name|'False'
op|','
name|'user_domain_id'
op|'='
string|"'foo'"
op|','
nl|'\n'
name|'sysmeta_project_domain_id'
op|'='
string|"'foo'"
op|','
nl|'\n'
name|'scoped'
op|'='
name|'False'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_is_name_allowed_in_acl_with_token_scoped_to_other_tenant
dedent|''
name|'def'
name|'test_is_name_allowed_in_acl_with_token_scoped_to_other_tenant'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# user and scoped tenant in default domain'
nl|'\n'
indent|'        '
name|'self'
op|'.'
name|'_assert_names_allowed'
op|'('
name|'True'
op|','
name|'user_domain_id'
op|'='
name|'self'
op|'.'
name|'default_id'
op|','
nl|'\n'
name|'req_project_domain_id'
op|'='
name|'self'
op|'.'
name|'default_id'
op|','
nl|'\n'
name|'sysmeta_project_domain_id'
op|'='
name|'None'
op|','
nl|'\n'
name|'scoped'
op|'='
string|"'other'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_assert_names_allowed'
op|'('
name|'True'
op|','
name|'user_domain_id'
op|'='
name|'self'
op|'.'
name|'default_id'
op|','
nl|'\n'
name|'req_project_domain_id'
op|'='
name|'self'
op|'.'
name|'default_id'
op|','
nl|'\n'
name|'sysmeta_project_domain_id'
op|'='
name|'self'
op|'.'
name|'default_id'
op|','
nl|'\n'
name|'scoped'
op|'='
string|"'other'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_assert_names_allowed'
op|'('
name|'False'
op|','
name|'user_domain_id'
op|'='
name|'self'
op|'.'
name|'default_id'
op|','
nl|'\n'
name|'req_project_domain_id'
op|'='
name|'self'
op|'.'
name|'default_id'
op|','
nl|'\n'
name|'sysmeta_project_domain_id'
op|'='
name|'UNKNOWN_ID'
op|','
nl|'\n'
name|'scoped'
op|'='
string|"'other'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_assert_names_allowed'
op|'('
name|'False'
op|','
name|'user_domain_id'
op|'='
name|'self'
op|'.'
name|'default_id'
op|','
nl|'\n'
name|'req_project_domain_id'
op|'='
name|'self'
op|'.'
name|'default_id'
op|','
nl|'\n'
name|'sysmeta_project_domain_id'
op|'='
string|"'foo'"
op|','
nl|'\n'
name|'scoped'
op|'='
string|"'other'"
op|')'
newline|'\n'
nl|'\n'
comment|'# user in default domain, but scoped tenant in non-default domain'
nl|'\n'
name|'self'
op|'.'
name|'_assert_names_allowed'
op|'('
name|'False'
op|','
name|'user_domain_id'
op|'='
name|'self'
op|'.'
name|'default_id'
op|','
nl|'\n'
name|'req_project_domain_id'
op|'='
string|"'foo'"
op|','
nl|'\n'
name|'sysmeta_project_domain_id'
op|'='
name|'None'
op|','
nl|'\n'
name|'scoped'
op|'='
string|"'other'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_assert_names_allowed'
op|'('
name|'False'
op|','
name|'user_domain_id'
op|'='
name|'self'
op|'.'
name|'default_id'
op|','
nl|'\n'
name|'req_project_domain_id'
op|'='
string|"'foo'"
op|','
nl|'\n'
name|'sysmeta_project_domain_id'
op|'='
name|'self'
op|'.'
name|'default_id'
op|','
nl|'\n'
name|'scoped'
op|'='
string|"'other'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_assert_names_allowed'
op|'('
name|'False'
op|','
name|'user_domain_id'
op|'='
name|'self'
op|'.'
name|'default_id'
op|','
nl|'\n'
name|'req_project_domain_id'
op|'='
string|"'foo'"
op|','
nl|'\n'
name|'sysmeta_project_domain_id'
op|'='
name|'UNKNOWN_ID'
op|','
nl|'\n'
name|'scoped'
op|'='
string|"'other'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_assert_names_allowed'
op|'('
name|'False'
op|','
name|'user_domain_id'
op|'='
name|'self'
op|'.'
name|'default_id'
op|','
nl|'\n'
name|'req_project_domain_id'
op|'='
string|"'foo'"
op|','
nl|'\n'
name|'sysmeta_project_domain_id'
op|'='
string|"'foo'"
op|','
nl|'\n'
name|'scoped'
op|'='
string|"'other'"
op|')'
newline|'\n'
nl|'\n'
comment|'# user in non-default domain, scoped tenant in default domain'
nl|'\n'
name|'self'
op|'.'
name|'_assert_names_allowed'
op|'('
name|'False'
op|','
name|'user_domain_id'
op|'='
string|"'foo'"
op|','
nl|'\n'
name|'req_project_domain_id'
op|'='
name|'self'
op|'.'
name|'default_id'
op|','
nl|'\n'
name|'sysmeta_project_domain_id'
op|'='
name|'None'
op|','
nl|'\n'
name|'scoped'
op|'='
string|"'other'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_assert_names_allowed'
op|'('
name|'False'
op|','
name|'user_domain_id'
op|'='
string|"'foo'"
op|','
nl|'\n'
name|'req_project_domain_id'
op|'='
name|'self'
op|'.'
name|'default_id'
op|','
nl|'\n'
name|'sysmeta_project_domain_id'
op|'='
name|'self'
op|'.'
name|'default_id'
op|','
nl|'\n'
name|'scoped'
op|'='
string|"'other'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_assert_names_allowed'
op|'('
name|'False'
op|','
name|'user_domain_id'
op|'='
string|"'foo'"
op|','
nl|'\n'
name|'req_project_domain_id'
op|'='
name|'self'
op|'.'
name|'default_id'
op|','
nl|'\n'
name|'sysmeta_project_domain_id'
op|'='
name|'UNKNOWN_ID'
op|','
nl|'\n'
name|'scoped'
op|'='
string|"'other'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_assert_names_allowed'
op|'('
name|'False'
op|','
name|'user_domain_id'
op|'='
string|"'foo'"
op|','
nl|'\n'
name|'req_project_domain_id'
op|'='
name|'self'
op|'.'
name|'default_id'
op|','
nl|'\n'
name|'sysmeta_project_domain_id'
op|'='
string|"'foo'"
op|','
nl|'\n'
name|'scoped'
op|'='
string|"'other'"
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|TestIsNameAllowedInACLWithConfiguredDomain
dedent|''
dedent|''
name|'class'
name|'TestIsNameAllowedInACLWithConfiguredDomain'
op|'('
name|'TestIsNameAllowedInACL'
op|')'
op|':'
newline|'\n'
DECL|member|setUp
indent|'    '
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'super'
op|'('
name|'TestIsNameAllowedInACLWithConfiguredDomain'
op|','
name|'self'
op|')'
op|'.'
name|'setUp'
op|'('
op|')'
newline|'\n'
name|'conf'
op|'='
op|'{'
string|"'default_domain_id'"
op|':'
string|"'mydefault'"
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'test_auth'
op|'='
name|'keystoneauth'
op|'.'
name|'filter_factory'
op|'('
name|'conf'
op|')'
op|'('
name|'FakeApp'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'logger'
op|'='
name|'FakeLogger'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'default_id'
op|'='
string|"'mydefault'"
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|TestSetProjectDomain
dedent|''
dedent|''
name|'class'
name|'TestSetProjectDomain'
op|'('
name|'BaseTestAuthorize'
op|')'
op|':'
newline|'\n'
DECL|member|_assert_set_project_domain
indent|'    '
name|'def'
name|'_assert_set_project_domain'
op|'('
name|'self'
op|','
name|'expected'
op|','
name|'account'
op|','
name|'req_project_id'
op|','
nl|'\n'
name|'req_project_domain_id'
op|','
nl|'\n'
name|'sysmeta_project_domain_id'
op|','
nl|'\n'
name|'warning'
op|'='
name|'False'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'hdr'
op|'='
string|"'X-Account-Sysmeta-Project-Domain-Id'"
newline|'\n'
nl|'\n'
comment|'# set up fake account info in req env'
nl|'\n'
name|'status'
op|'='
number|'0'
name|'if'
name|'sysmeta_project_domain_id'
name|'is'
name|'None'
name|'else'
number|'200'
newline|'\n'
name|'sysmeta'
op|'='
op|'{'
op|'}'
newline|'\n'
name|'if'
name|'sysmeta_project_domain_id'
op|':'
newline|'\n'
indent|'            '
name|'sysmeta'
op|'['
string|"'project-domain-id'"
op|']'
op|'='
name|'sysmeta_project_domain_id'
newline|'\n'
dedent|''
name|'info'
op|'='
op|'{'
string|"'status'"
op|':'
name|'status'
op|','
string|"'sysmeta'"
op|':'
name|'sysmeta'
op|'}'
newline|'\n'
name|'_'
op|','
name|'info_key'
op|'='
name|'_get_cache_key'
op|'('
name|'account'
op|','
name|'None'
op|')'
newline|'\n'
name|'env'
op|'='
op|'{'
name|'info_key'
op|':'
name|'info'
op|'}'
newline|'\n'
nl|'\n'
comment|'# create fake env identity'
nl|'\n'
name|'env_id'
op|'='
name|'self'
op|'.'
name|'_get_env_id'
op|'('
name|'tenant_id'
op|'='
name|'req_project_id'
op|','
nl|'\n'
name|'project_domain_id'
op|'='
name|'req_project_domain_id'
op|')'
newline|'\n'
nl|'\n'
comment|'# reset fake logger'
nl|'\n'
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'logger'
op|'='
name|'FakeLogger'
op|'('
op|')'
newline|'\n'
name|'num_warnings'
op|'='
number|'0'
newline|'\n'
nl|'\n'
comment|'# check account requests'
nl|'\n'
name|'path'
op|'='
string|"'/v1/%s'"
op|'%'
name|'account'
newline|'\n'
name|'for'
name|'method'
name|'in'
op|'['
string|"'PUT'"
op|','
string|"'POST'"
op|']'
op|':'
newline|'\n'
indent|'            '
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
name|'path'
op|','
name|'environ'
op|'='
name|'env'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'method'
op|'='
name|'method'
newline|'\n'
name|'path_parts'
op|'='
name|'req'
op|'.'
name|'split_path'
op|'('
number|'1'
op|','
number|'4'
op|','
name|'True'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'_set_project_domain_id'
op|'('
name|'req'
op|','
name|'path_parts'
op|','
name|'env_id'
op|')'
newline|'\n'
name|'if'
name|'warning'
op|':'
newline|'\n'
indent|'                '
name|'num_warnings'
op|'+='
number|'1'
newline|'\n'
name|'warnings'
op|'='
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'logger'
op|'.'
name|'get_lines_for_level'
op|'('
string|"'warning'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'len'
op|'('
name|'warnings'
op|')'
op|','
name|'num_warnings'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'warnings'
op|'['
op|'-'
number|'1'
op|']'
op|'.'
name|'startswith'
op|'('
string|"'Inconsistent proj'"
op|')'
op|')'
newline|'\n'
dedent|''
name|'if'
name|'expected'
name|'is'
name|'not'
name|'None'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'hdr'
name|'in'
name|'req'
op|'.'
name|'headers'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'req'
op|'.'
name|'headers'
op|'['
name|'hdr'
op|']'
op|','
name|'expected'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'hdr'
name|'in'
name|'req'
op|'.'
name|'headers'
op|','
name|'req'
op|'.'
name|'headers'
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'for'
name|'method'
name|'in'
op|'['
string|"'GET'"
op|','
string|"'HEAD'"
op|','
string|"'DELETE'"
op|','
string|"'OPTIONS'"
op|']'
op|':'
newline|'\n'
indent|'            '
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
name|'path'
op|','
name|'environ'
op|'='
name|'env'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'method'
op|'='
name|'method'
newline|'\n'
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'_set_project_domain_id'
op|'('
name|'req'
op|','
name|'path_parts'
op|','
name|'env_id'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'hdr'
name|'in'
name|'req'
op|'.'
name|'headers'
op|')'
newline|'\n'
nl|'\n'
comment|'# check container requests'
nl|'\n'
dedent|''
name|'path'
op|'='
string|"'/v1/%s/c'"
op|'%'
name|'account'
newline|'\n'
name|'for'
name|'method'
name|'in'
op|'['
string|"'PUT'"
op|']'
op|':'
newline|'\n'
indent|'            '
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
name|'path'
op|','
name|'environ'
op|'='
name|'env'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'method'
op|'='
name|'method'
newline|'\n'
name|'path_parts'
op|'='
name|'req'
op|'.'
name|'split_path'
op|'('
number|'1'
op|','
number|'4'
op|','
name|'True'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'_set_project_domain_id'
op|'('
name|'req'
op|','
name|'path_parts'
op|','
name|'env_id'
op|')'
newline|'\n'
name|'if'
name|'warning'
op|':'
newline|'\n'
indent|'                '
name|'num_warnings'
op|'+='
number|'1'
newline|'\n'
name|'warnings'
op|'='
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'logger'
op|'.'
name|'get_lines_for_level'
op|'('
string|"'warning'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'len'
op|'('
name|'warnings'
op|')'
op|','
name|'num_warnings'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'warnings'
op|'['
op|'-'
number|'1'
op|']'
op|'.'
name|'startswith'
op|'('
string|"'Inconsistent proj'"
op|')'
op|')'
newline|'\n'
dedent|''
name|'if'
name|'expected'
name|'is'
name|'not'
name|'None'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'hdr'
name|'in'
name|'req'
op|'.'
name|'headers'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'req'
op|'.'
name|'headers'
op|'['
name|'hdr'
op|']'
op|','
name|'expected'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'hdr'
name|'in'
name|'req'
op|'.'
name|'headers'
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'for'
name|'method'
name|'in'
op|'['
string|"'POST'"
op|','
string|"'GET'"
op|','
string|"'HEAD'"
op|','
string|"'DELETE'"
op|','
string|"'OPTIONS'"
op|']'
op|':'
newline|'\n'
indent|'            '
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
name|'path'
op|','
name|'environ'
op|'='
name|'env'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'method'
op|'='
name|'method'
newline|'\n'
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'_set_project_domain_id'
op|'('
name|'req'
op|','
name|'path_parts'
op|','
name|'env_id'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'hdr'
name|'in'
name|'req'
op|'.'
name|'headers'
op|')'
newline|'\n'
nl|'\n'
comment|'# never set for object requests'
nl|'\n'
dedent|''
name|'path'
op|'='
string|"'/v1/%s/c/o'"
op|'%'
name|'account'
newline|'\n'
name|'for'
name|'method'
name|'in'
op|'['
string|"'PUT'"
op|','
string|"'COPY'"
op|','
string|"'POST'"
op|','
string|"'GET'"
op|','
string|"'HEAD'"
op|','
string|"'DELETE'"
op|','
nl|'\n'
string|"'OPTIONS'"
op|']'
op|':'
newline|'\n'
indent|'            '
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
name|'path'
op|','
name|'environ'
op|'='
name|'env'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'method'
op|'='
name|'method'
newline|'\n'
name|'path_parts'
op|'='
name|'req'
op|'.'
name|'split_path'
op|'('
number|'1'
op|','
number|'4'
op|','
name|'True'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'_set_project_domain_id'
op|'('
name|'req'
op|','
name|'path_parts'
op|','
name|'env_id'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'hdr'
name|'in'
name|'req'
op|'.'
name|'headers'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_set_project_domain_id_new_account
dedent|''
dedent|''
name|'def'
name|'test_set_project_domain_id_new_account'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# scoped token with project domain info'
nl|'\n'
indent|'        '
name|'self'
op|'.'
name|'_assert_set_project_domain'
op|'('
string|"'test_id'"
op|','
nl|'\n'
name|'account'
op|'='
string|"'AUTH_1234'"
op|','
nl|'\n'
name|'req_project_id'
op|'='
string|"'1234'"
op|','
nl|'\n'
name|'req_project_domain_id'
op|'='
string|"'test_id'"
op|','
nl|'\n'
name|'sysmeta_project_domain_id'
op|'='
name|'None'
op|')'
newline|'\n'
nl|'\n'
comment|'# scoped v2 token without project domain id'
nl|'\n'
name|'self'
op|'.'
name|'_assert_set_project_domain'
op|'('
name|'None'
op|','
nl|'\n'
name|'account'
op|'='
string|"'AUTH_1234'"
op|','
nl|'\n'
name|'req_project_id'
op|'='
string|"'1234'"
op|','
nl|'\n'
name|'req_project_domain_id'
op|'='
name|'None'
op|','
nl|'\n'
name|'sysmeta_project_domain_id'
op|'='
name|'None'
op|')'
newline|'\n'
nl|'\n'
comment|'# unscoped v2 token without project domain id'
nl|'\n'
name|'self'
op|'.'
name|'_assert_set_project_domain'
op|'('
name|'UNKNOWN_ID'
op|','
nl|'\n'
name|'account'
op|'='
string|"'AUTH_1234'"
op|','
nl|'\n'
name|'req_project_id'
op|'='
name|'None'
op|','
nl|'\n'
name|'req_project_domain_id'
op|'='
name|'None'
op|','
nl|'\n'
name|'sysmeta_project_domain_id'
op|'='
name|'None'
op|')'
newline|'\n'
nl|'\n'
comment|'# token scoped on another project'
nl|'\n'
name|'self'
op|'.'
name|'_assert_set_project_domain'
op|'('
name|'UNKNOWN_ID'
op|','
nl|'\n'
name|'account'
op|'='
string|"'AUTH_1234'"
op|','
nl|'\n'
name|'req_project_id'
op|'='
string|"'4321'"
op|','
nl|'\n'
name|'req_project_domain_id'
op|'='
string|"'default'"
op|','
nl|'\n'
name|'sysmeta_project_domain_id'
op|'='
name|'None'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_set_project_domain_id_existing_v2_account
dedent|''
name|'def'
name|'test_set_project_domain_id_existing_v2_account'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# project domain id provided in scoped request token,'
nl|'\n'
comment|'# update empty value'
nl|'\n'
indent|'        '
name|'self'
op|'.'
name|'_assert_set_project_domain'
op|'('
string|"'default'"
op|','
nl|'\n'
name|'account'
op|'='
string|"'AUTH_1234'"
op|','
nl|'\n'
name|'req_project_id'
op|'='
string|"'1234'"
op|','
nl|'\n'
name|'req_project_domain_id'
op|'='
string|"'default'"
op|','
nl|'\n'
name|'sysmeta_project_domain_id'
op|'='
string|"''"
op|')'
newline|'\n'
nl|'\n'
comment|'# inconsistent project domain id provided in scoped request token,'
nl|'\n'
comment|'# leave known value'
nl|'\n'
name|'self'
op|'.'
name|'_assert_set_project_domain'
op|'('
name|'None'
op|','
nl|'\n'
name|'account'
op|'='
string|"'AUTH_1234'"
op|','
nl|'\n'
name|'req_project_id'
op|'='
string|"'1234'"
op|','
nl|'\n'
name|'req_project_domain_id'
op|'='
string|"'unexpected_id'"
op|','
nl|'\n'
name|'sysmeta_project_domain_id'
op|'='
string|"''"
op|','
nl|'\n'
name|'warning'
op|'='
name|'True'
op|')'
newline|'\n'
nl|'\n'
comment|'# project domain id not provided, scoped request token,'
nl|'\n'
comment|'# no change to empty value'
nl|'\n'
name|'self'
op|'.'
name|'_assert_set_project_domain'
op|'('
name|'None'
op|','
nl|'\n'
name|'account'
op|'='
string|"'AUTH_1234'"
op|','
nl|'\n'
name|'req_project_id'
op|'='
string|"'1234'"
op|','
nl|'\n'
name|'req_project_domain_id'
op|'='
name|'None'
op|','
nl|'\n'
name|'sysmeta_project_domain_id'
op|'='
string|"''"
op|')'
newline|'\n'
nl|'\n'
comment|'# unscoped request token, no change to empty value'
nl|'\n'
name|'self'
op|'.'
name|'_assert_set_project_domain'
op|'('
name|'None'
op|','
nl|'\n'
name|'account'
op|'='
string|"'AUTH_1234'"
op|','
nl|'\n'
name|'req_project_id'
op|'='
name|'None'
op|','
nl|'\n'
name|'req_project_domain_id'
op|'='
name|'None'
op|','
nl|'\n'
name|'sysmeta_project_domain_id'
op|'='
string|"''"
op|')'
newline|'\n'
nl|'\n'
comment|'# token scoped on another project,'
nl|'\n'
comment|'# update empty value'
nl|'\n'
name|'self'
op|'.'
name|'_assert_set_project_domain'
op|'('
name|'None'
op|','
nl|'\n'
name|'account'
op|'='
string|"'AUTH_1234'"
op|','
nl|'\n'
name|'req_project_id'
op|'='
string|"'4321'"
op|','
nl|'\n'
name|'req_project_domain_id'
op|'='
name|'None'
op|','
nl|'\n'
name|'sysmeta_project_domain_id'
op|'='
string|"''"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_set_project_domain_id_existing_account_unknown_domain
dedent|''
name|'def'
name|'test_set_project_domain_id_existing_account_unknown_domain'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
nl|'\n'
comment|'# project domain id provided in scoped request token,'
nl|'\n'
comment|'# set known value'
nl|'\n'
indent|'        '
name|'self'
op|'.'
name|'_assert_set_project_domain'
op|'('
string|"'test_id'"
op|','
nl|'\n'
name|'account'
op|'='
string|"'AUTH_1234'"
op|','
nl|'\n'
name|'req_project_id'
op|'='
string|"'1234'"
op|','
nl|'\n'
name|'req_project_domain_id'
op|'='
string|"'test_id'"
op|','
nl|'\n'
name|'sysmeta_project_domain_id'
op|'='
name|'UNKNOWN_ID'
op|')'
newline|'\n'
nl|'\n'
comment|'# project domain id not provided, scoped request token,'
nl|'\n'
comment|'# set empty value'
nl|'\n'
name|'self'
op|'.'
name|'_assert_set_project_domain'
op|'('
string|"''"
op|','
nl|'\n'
name|'account'
op|'='
string|"'AUTH_1234'"
op|','
nl|'\n'
name|'req_project_id'
op|'='
string|"'1234'"
op|','
nl|'\n'
name|'req_project_domain_id'
op|'='
name|'None'
op|','
nl|'\n'
name|'sysmeta_project_domain_id'
op|'='
name|'UNKNOWN_ID'
op|')'
newline|'\n'
nl|'\n'
comment|'# project domain id not provided, unscoped request token,'
nl|'\n'
comment|'# leave unknown value'
nl|'\n'
name|'self'
op|'.'
name|'_assert_set_project_domain'
op|'('
name|'None'
op|','
nl|'\n'
name|'account'
op|'='
string|"'AUTH_1234'"
op|','
nl|'\n'
name|'req_project_id'
op|'='
name|'None'
op|','
nl|'\n'
name|'req_project_domain_id'
op|'='
name|'None'
op|','
nl|'\n'
name|'sysmeta_project_domain_id'
op|'='
name|'UNKNOWN_ID'
op|')'
newline|'\n'
nl|'\n'
comment|'# token scoped on another project, leave unknown value'
nl|'\n'
name|'self'
op|'.'
name|'_assert_set_project_domain'
op|'('
name|'None'
op|','
nl|'\n'
name|'account'
op|'='
string|"'AUTH_1234'"
op|','
nl|'\n'
name|'req_project_id'
op|'='
string|"'4321'"
op|','
nl|'\n'
name|'req_project_domain_id'
op|'='
string|"'default'"
op|','
nl|'\n'
name|'sysmeta_project_domain_id'
op|'='
name|'UNKNOWN_ID'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_set_project_domain_id_existing_known_domain
dedent|''
name|'def'
name|'test_set_project_domain_id_existing_known_domain'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# project domain id provided in scoped request token,'
nl|'\n'
comment|'# leave known value'
nl|'\n'
indent|'        '
name|'self'
op|'.'
name|'_assert_set_project_domain'
op|'('
name|'None'
op|','
nl|'\n'
name|'account'
op|'='
string|"'AUTH_1234'"
op|','
nl|'\n'
name|'req_project_id'
op|'='
string|"'1234'"
op|','
nl|'\n'
name|'req_project_domain_id'
op|'='
string|"'test_id'"
op|','
nl|'\n'
name|'sysmeta_project_domain_id'
op|'='
string|"'test_id'"
op|')'
newline|'\n'
nl|'\n'
comment|'# inconsistent project domain id provided in scoped request token,'
nl|'\n'
comment|'# leave known value'
nl|'\n'
name|'self'
op|'.'
name|'_assert_set_project_domain'
op|'('
name|'None'
op|','
nl|'\n'
name|'account'
op|'='
string|"'AUTH_1234'"
op|','
nl|'\n'
name|'req_project_id'
op|'='
string|"'1234'"
op|','
nl|'\n'
name|'req_project_domain_id'
op|'='
string|"'unexpected_id'"
op|','
nl|'\n'
name|'sysmeta_project_domain_id'
op|'='
string|"'test_id'"
op|','
nl|'\n'
name|'warning'
op|'='
name|'True'
op|')'
newline|'\n'
nl|'\n'
comment|'# project domain id not provided, scoped request token,'
nl|'\n'
comment|'# leave known value'
nl|'\n'
name|'self'
op|'.'
name|'_assert_set_project_domain'
op|'('
name|'None'
op|','
nl|'\n'
name|'account'
op|'='
string|"'AUTH_1234'"
op|','
nl|'\n'
name|'req_project_id'
op|'='
string|"'1234'"
op|','
nl|'\n'
name|'req_project_domain_id'
op|'='
name|'None'
op|','
nl|'\n'
name|'sysmeta_project_domain_id'
op|'='
string|"'test_id'"
op|')'
newline|'\n'
nl|'\n'
comment|'# project domain id not provided, unscoped request token,'
nl|'\n'
comment|'# leave known value'
nl|'\n'
name|'self'
op|'.'
name|'_assert_set_project_domain'
op|'('
name|'None'
op|','
nl|'\n'
name|'account'
op|'='
string|"'AUTH_1234'"
op|','
nl|'\n'
name|'req_project_id'
op|'='
name|'None'
op|','
nl|'\n'
name|'req_project_domain_id'
op|'='
name|'None'
op|','
nl|'\n'
name|'sysmeta_project_domain_id'
op|'='
string|"'test_id'"
op|')'
newline|'\n'
nl|'\n'
comment|'# project domain id not provided, token scoped on another project,'
nl|'\n'
comment|'# leave known value'
nl|'\n'
name|'self'
op|'.'
name|'_assert_set_project_domain'
op|'('
name|'None'
op|','
nl|'\n'
name|'account'
op|'='
string|"'AUTH_1234'"
op|','
nl|'\n'
name|'req_project_id'
op|'='
string|"'4321'"
op|','
nl|'\n'
name|'req_project_domain_id'
op|'='
string|"'default'"
op|','
nl|'\n'
name|'sysmeta_project_domain_id'
op|'='
string|"'test_id'"
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
dedent|''
dedent|''
name|'if'
name|'__name__'
op|'=='
string|"'__main__'"
op|':'
newline|'\n'
indent|'    '
name|'unittest'
op|'.'
name|'main'
op|'('
op|')'
newline|'\n'
dedent|''
endmarker|''
end_unit
