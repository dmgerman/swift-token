begin_unit
comment|'# Copyright (c) 2010-2011 OpenStack, LLC.'
nl|'\n'
comment|'#'
nl|'\n'
comment|'# Licensed under the Apache License, Version 2.0 (the "License");'
nl|'\n'
comment|'# you may not use this file except in compliance with the License.'
nl|'\n'
comment|'# You may obtain a copy of the License at'
nl|'\n'
comment|'#'
nl|'\n'
comment|'#    http://www.apache.org/licenses/LICENSE-2.0'
nl|'\n'
comment|'#'
nl|'\n'
comment|'# Unless required by applicable law or agreed to in writing, software'
nl|'\n'
comment|'# distributed under the License is distributed on an "AS IS" BASIS,'
nl|'\n'
comment|'# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or'
nl|'\n'
comment|'# implied.'
nl|'\n'
comment|'# See the License for the specific language governing permissions and'
nl|'\n'
comment|'# limitations under the License.'
nl|'\n'
nl|'\n'
nl|'\n'
name|'import'
name|'unittest'
newline|'\n'
name|'import'
name|'os'
newline|'\n'
name|'import'
name|'time'
newline|'\n'
name|'import'
name|'uuid'
newline|'\n'
name|'from'
name|'shutil'
name|'import'
name|'rmtree'
newline|'\n'
name|'from'
name|'swift'
op|'.'
name|'stats'
name|'import'
name|'db_stats_collector'
newline|'\n'
name|'from'
name|'tempfile'
name|'import'
name|'mkdtemp'
newline|'\n'
name|'from'
name|'test'
op|'.'
name|'unit'
name|'import'
name|'FakeLogger'
newline|'\n'
name|'from'
name|'swift'
op|'.'
name|'common'
op|'.'
name|'db'
name|'import'
name|'AccountBroker'
op|','
name|'ContainerBroker'
newline|'\n'
name|'from'
name|'swift'
op|'.'
name|'common'
op|'.'
name|'utils'
name|'import'
name|'mkdirs'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|TestDbStats
name|'class'
name|'TestDbStats'
op|'('
name|'unittest'
op|'.'
name|'TestCase'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|member|setUp
indent|'    '
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_was_logger'
op|'='
name|'db_stats_collector'
op|'.'
name|'get_logger'
newline|'\n'
name|'db_stats_collector'
op|'.'
name|'get_logger'
op|'='
name|'FakeLogger'
newline|'\n'
name|'self'
op|'.'
name|'testdir'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'mkdtemp'
op|'('
op|')'
op|','
string|"'tmp_test_db_stats'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'devices'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'self'
op|'.'
name|'testdir'
op|','
string|"'node'"
op|')'
newline|'\n'
name|'rmtree'
op|'('
name|'self'
op|'.'
name|'testdir'
op|','
name|'ignore_errors'
op|'='
number|'1'
op|')'
newline|'\n'
name|'mkdirs'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'self'
op|'.'
name|'devices'
op|','
string|"'sda'"
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'accounts'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'self'
op|'.'
name|'devices'
op|','
string|"'sda'"
op|','
string|"'accounts'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'containers'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'self'
op|'.'
name|'devices'
op|','
string|"'sda'"
op|','
string|"'containers'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'log_dir'
op|'='
string|"'%s/log'"
op|'%'
name|'self'
op|'.'
name|'testdir'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'conf'
op|'='
name|'dict'
op|'('
name|'devices'
op|'='
name|'self'
op|'.'
name|'devices'
op|','
nl|'\n'
name|'log_dir'
op|'='
name|'self'
op|'.'
name|'log_dir'
op|','
nl|'\n'
name|'mount_check'
op|'='
string|"'false'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|tearDown
dedent|''
name|'def'
name|'tearDown'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'db_stats_collector'
op|'.'
name|'get_logger'
op|'='
name|'self'
op|'.'
name|'_was_logger'
newline|'\n'
name|'rmtree'
op|'('
name|'self'
op|'.'
name|'testdir'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_account_stat_get_data
dedent|''
name|'def'
name|'test_account_stat_get_data'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'stat'
op|'='
name|'db_stats_collector'
op|'.'
name|'AccountStatsCollector'
op|'('
name|'self'
op|'.'
name|'conf'
op|')'
newline|'\n'
name|'account_db'
op|'='
name|'AccountBroker'
op|'('
string|'"%s/acc.db"'
op|'%'
name|'self'
op|'.'
name|'accounts'
op|','
nl|'\n'
name|'account'
op|'='
string|"'test_acc'"
op|')'
newline|'\n'
name|'account_db'
op|'.'
name|'initialize'
op|'('
op|')'
newline|'\n'
name|'account_db'
op|'.'
name|'put_container'
op|'('
string|"'test_container'"
op|','
name|'time'
op|'.'
name|'time'
op|'('
op|')'
op|','
nl|'\n'
name|'None'
op|','
number|'10'
op|','
number|'1000'
op|')'
newline|'\n'
name|'info'
op|'='
name|'stat'
op|'.'
name|'get_data'
op|'('
string|'"%s/acc.db"'
op|'%'
name|'self'
op|'.'
name|'accounts'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
string|'\'\'\'"test_acc",1,10,1000\\n\'\'\''
op|','
name|'info'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_container_stat_get_data
dedent|''
name|'def'
name|'test_container_stat_get_data'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'stat'
op|'='
name|'db_stats_collector'
op|'.'
name|'ContainerStatsCollector'
op|'('
name|'self'
op|'.'
name|'conf'
op|')'
newline|'\n'
name|'container_db'
op|'='
name|'ContainerBroker'
op|'('
string|'"%s/con.db"'
op|'%'
name|'self'
op|'.'
name|'containers'
op|','
nl|'\n'
name|'account'
op|'='
string|"'test_acc'"
op|','
name|'container'
op|'='
string|"'test_con'"
op|')'
newline|'\n'
name|'container_db'
op|'.'
name|'initialize'
op|'('
op|')'
newline|'\n'
name|'container_db'
op|'.'
name|'put_object'
op|'('
string|"'test_obj'"
op|','
name|'time'
op|'.'
name|'time'
op|'('
op|')'
op|','
number|'10'
op|','
string|"'text'"
op|','
string|"'faketag'"
op|')'
newline|'\n'
name|'info'
op|'='
name|'stat'
op|'.'
name|'get_data'
op|'('
string|'"%s/con.db"'
op|'%'
name|'self'
op|'.'
name|'containers'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
string|'\'\'\'"test_acc","test_con",1,10\\n\'\'\''
op|','
name|'info'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_container_stat_get_metadata
dedent|''
name|'def'
name|'test_container_stat_get_metadata'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'stat'
op|'='
name|'db_stats_collector'
op|'.'
name|'ContainerStatsCollector'
op|'('
name|'self'
op|'.'
name|'conf'
op|')'
newline|'\n'
name|'container_db'
op|'='
name|'ContainerBroker'
op|'('
string|'"%s/con.db"'
op|'%'
name|'self'
op|'.'
name|'containers'
op|','
nl|'\n'
name|'account'
op|'='
string|"'test_acc'"
op|','
name|'container'
op|'='
string|"'test_con'"
op|')'
newline|'\n'
name|'container_db'
op|'.'
name|'initialize'
op|'('
op|')'
newline|'\n'
name|'container_db'
op|'.'
name|'put_object'
op|'('
string|"'test_obj'"
op|','
name|'time'
op|'.'
name|'time'
op|'('
op|')'
op|','
number|'10'
op|','
string|"'text'"
op|','
string|"'faketag'"
op|')'
newline|'\n'
name|'info'
op|'='
name|'stat'
op|'.'
name|'get_data'
op|'('
string|'"%s/con.db"'
op|'%'
name|'self'
op|'.'
name|'containers'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
string|'\'\'\'"test_acc","test_con",1,10\\n\'\'\''
op|','
name|'info'
op|')'
newline|'\n'
name|'container_db'
op|'.'
name|'update_metadata'
op|'('
op|'{'
string|"'test1'"
op|':'
op|'('
string|"'val'"
op|','
number|'1000'
op|')'
op|'}'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_gen_account_stat
dedent|''
name|'def'
name|'_gen_account_stat'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'stat'
op|'='
name|'db_stats_collector'
op|'.'
name|'AccountStatsCollector'
op|'('
name|'self'
op|'.'
name|'conf'
op|')'
newline|'\n'
name|'output_data'
op|'='
name|'set'
op|'('
op|')'
newline|'\n'
name|'for'
name|'i'
name|'in'
name|'range'
op|'('
number|'10'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'account_db'
op|'='
name|'AccountBroker'
op|'('
string|'"%s/stats-201001010%s-%s.db"'
op|'%'
nl|'\n'
op|'('
name|'self'
op|'.'
name|'accounts'
op|','
name|'i'
op|','
name|'uuid'
op|'.'
name|'uuid4'
op|'('
op|')'
op|'.'
name|'hex'
op|')'
op|','
nl|'\n'
name|'account'
op|'='
string|"'test_acc_%s'"
op|'%'
name|'i'
op|')'
newline|'\n'
name|'account_db'
op|'.'
name|'initialize'
op|'('
op|')'
newline|'\n'
name|'account_db'
op|'.'
name|'put_container'
op|'('
string|"'test_container'"
op|','
name|'time'
op|'.'
name|'time'
op|'('
op|')'
op|','
nl|'\n'
name|'None'
op|','
number|'10'
op|','
number|'1000'
op|')'
newline|'\n'
comment|'# this will "commit" the data'
nl|'\n'
name|'account_db'
op|'.'
name|'get_info'
op|'('
op|')'
newline|'\n'
name|'output_data'
op|'.'
name|'add'
op|'('
string|'\'\'\'"test_acc_%s",1,10,1000\'\'\''
op|'%'
name|'i'
op|')'
op|','
newline|'\n'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'len'
op|'('
name|'output_data'
op|')'
op|','
number|'10'
op|')'
newline|'\n'
name|'return'
name|'stat'
op|','
name|'output_data'
newline|'\n'
nl|'\n'
DECL|member|_drop_metadata_col
dedent|''
name|'def'
name|'_drop_metadata_col'
op|'('
name|'self'
op|','
name|'broker'
op|','
name|'acc_name'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'broker'
op|'.'
name|'conn'
op|'.'
name|'execute'
op|'('
string|"'''drop table container_stat'''"
op|')'
newline|'\n'
name|'broker'
op|'.'
name|'conn'
op|'.'
name|'executescript'
op|'('
string|'"""\n            CREATE TABLE container_stat (\n                account TEXT DEFAULT \'%s\',\n                container TEXT DEFAULT \'test_con\',\n                created_at TEXT,\n                put_timestamp TEXT DEFAULT \'0\',\n                delete_timestamp TEXT DEFAULT \'0\',\n                object_count INTEGER,\n                bytes_used INTEGER,\n                reported_put_timestamp TEXT DEFAULT \'0\',\n                reported_delete_timestamp TEXT DEFAULT \'0\',\n                reported_object_count INTEGER DEFAULT 0,\n                reported_bytes_used INTEGER DEFAULT 0,\n                hash TEXT default \'00000000000000000000000000000000\',\n                id TEXT,\n                status TEXT DEFAULT \'\',\n                status_changed_at TEXT DEFAULT \'0\'\n            );\n\n            INSERT INTO container_stat (object_count, bytes_used)\n                VALUES (1, 10);\n        """'
op|'%'
name|'acc_name'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_gen_container_stat
dedent|''
name|'def'
name|'_gen_container_stat'
op|'('
name|'self'
op|','
name|'set_metadata'
op|'='
name|'False'
op|','
name|'drop_metadata'
op|'='
name|'False'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'set_metadata'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'conf'
op|'['
string|"'metadata_keys'"
op|']'
op|'='
string|"'test1,test2'"
newline|'\n'
comment|'# webob runs title on all headers'
nl|'\n'
dedent|''
name|'stat'
op|'='
name|'db_stats_collector'
op|'.'
name|'ContainerStatsCollector'
op|'('
name|'self'
op|'.'
name|'conf'
op|')'
newline|'\n'
name|'output_data'
op|'='
name|'set'
op|'('
op|')'
newline|'\n'
name|'for'
name|'i'
name|'in'
name|'range'
op|'('
number|'10'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'cont_db'
op|'='
name|'ContainerBroker'
op|'('
nl|'\n'
string|'"%s/container-stats-201001010%s-%s.db"'
op|'%'
op|'('
name|'self'
op|'.'
name|'containers'
op|','
name|'i'
op|','
nl|'\n'
name|'uuid'
op|'.'
name|'uuid4'
op|'('
op|')'
op|'.'
name|'hex'
op|')'
op|','
nl|'\n'
name|'account'
op|'='
string|"'test_acc_%s'"
op|'%'
name|'i'
op|','
name|'container'
op|'='
string|"'test_con'"
op|')'
newline|'\n'
name|'cont_db'
op|'.'
name|'initialize'
op|'('
op|')'
newline|'\n'
name|'cont_db'
op|'.'
name|'put_object'
op|'('
string|"'test_obj'"
op|','
name|'time'
op|'.'
name|'time'
op|'('
op|')'
op|','
number|'10'
op|','
string|"'text'"
op|','
string|"'faketag'"
op|')'
newline|'\n'
name|'metadata_output'
op|'='
string|"''"
newline|'\n'
name|'if'
name|'set_metadata'
op|':'
newline|'\n'
indent|'                '
name|'if'
name|'i'
op|'%'
number|'2'
op|':'
newline|'\n'
indent|'                    '
name|'cont_db'
op|'.'
name|'update_metadata'
op|'('
op|'{'
string|"'X-Container-Meta-Test1'"
op|':'
op|'('
number|'5'
op|','
number|'1'
op|')'
op|'}'
op|')'
newline|'\n'
name|'metadata_output'
op|'='
string|"',1,'"
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                    '
name|'cont_db'
op|'.'
name|'update_metadata'
op|'('
op|'{'
string|"'X-Container-Meta-Test2'"
op|':'
op|'('
number|'7'
op|','
number|'2'
op|')'
op|'}'
op|')'
newline|'\n'
name|'metadata_output'
op|'='
string|"',,1'"
newline|'\n'
comment|'# this will "commit" the data'
nl|'\n'
dedent|''
dedent|''
name|'cont_db'
op|'.'
name|'get_info'
op|'('
op|')'
newline|'\n'
name|'if'
name|'drop_metadata'
op|':'
newline|'\n'
indent|'                '
name|'output_data'
op|'.'
name|'add'
op|'('
string|'\'\'\'"test_acc_%s","test_con",1,10,,\'\'\''
op|'%'
name|'i'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                '
name|'output_data'
op|'.'
name|'add'
op|'('
string|'\'\'\'"test_acc_%s","test_con",1,10%s\'\'\''
op|'%'
nl|'\n'
op|'('
name|'i'
op|','
name|'metadata_output'
op|')'
op|')'
newline|'\n'
dedent|''
name|'if'
name|'drop_metadata'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'_drop_metadata_col'
op|'('
name|'cont_db'
op|','
string|"'test_acc_%s'"
op|'%'
name|'i'
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'len'
op|'('
name|'output_data'
op|')'
op|','
number|'10'
op|')'
newline|'\n'
name|'return'
name|'stat'
op|','
name|'output_data'
newline|'\n'
nl|'\n'
DECL|member|test_account_stat_run_once_account
dedent|''
name|'def'
name|'test_account_stat_run_once_account'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'stat'
op|','
name|'output_data'
op|'='
name|'self'
op|'.'
name|'_gen_account_stat'
op|'('
op|')'
newline|'\n'
name|'stat'
op|'.'
name|'run_once'
op|'('
op|')'
newline|'\n'
name|'stat_file'
op|'='
name|'os'
op|'.'
name|'listdir'
op|'('
name|'self'
op|'.'
name|'log_dir'
op|')'
op|'['
number|'0'
op|']'
newline|'\n'
name|'with'
name|'open'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'self'
op|'.'
name|'log_dir'
op|','
name|'stat_file'
op|')'
op|')'
name|'as'
name|'stat_handle'
op|':'
newline|'\n'
indent|'            '
name|'for'
name|'i'
name|'in'
name|'range'
op|'('
number|'10'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'data'
op|'='
name|'stat_handle'
op|'.'
name|'readline'
op|'('
op|')'
newline|'\n'
name|'output_data'
op|'.'
name|'discard'
op|'('
name|'data'
op|'.'
name|'strip'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'len'
op|'('
name|'output_data'
op|')'
op|','
number|'0'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_account_stat_run_once_container_metadata
dedent|''
name|'def'
name|'test_account_stat_run_once_container_metadata'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
nl|'\n'
indent|'        '
name|'stat'
op|','
name|'output_data'
op|'='
name|'self'
op|'.'
name|'_gen_container_stat'
op|'('
name|'set_metadata'
op|'='
name|'True'
op|')'
newline|'\n'
name|'stat'
op|'.'
name|'run_once'
op|'('
op|')'
newline|'\n'
name|'stat_file'
op|'='
name|'os'
op|'.'
name|'listdir'
op|'('
name|'self'
op|'.'
name|'log_dir'
op|')'
op|'['
number|'0'
op|']'
newline|'\n'
name|'with'
name|'open'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'self'
op|'.'
name|'log_dir'
op|','
name|'stat_file'
op|')'
op|')'
name|'as'
name|'stat_handle'
op|':'
newline|'\n'
indent|'            '
name|'headers'
op|'='
name|'stat_handle'
op|'.'
name|'readline'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_'
op|'('
name|'headers'
op|'.'
name|'startswith'
op|'('
string|"'Account Hash,Container Name,'"
op|')'
op|')'
newline|'\n'
name|'for'
name|'i'
name|'in'
name|'range'
op|'('
number|'10'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'data'
op|'='
name|'stat_handle'
op|'.'
name|'readline'
op|'('
op|')'
newline|'\n'
name|'output_data'
op|'.'
name|'discard'
op|'('
name|'data'
op|'.'
name|'strip'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'len'
op|'('
name|'output_data'
op|')'
op|','
number|'0'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_account_stat_run_once_container_no_metadata
dedent|''
name|'def'
name|'test_account_stat_run_once_container_no_metadata'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
nl|'\n'
indent|'        '
name|'stat'
op|','
name|'output_data'
op|'='
name|'self'
op|'.'
name|'_gen_container_stat'
op|'('
name|'set_metadata'
op|'='
name|'True'
op|','
nl|'\n'
name|'drop_metadata'
op|'='
name|'True'
op|')'
newline|'\n'
name|'stat'
op|'.'
name|'run_once'
op|'('
op|')'
newline|'\n'
name|'stat_file'
op|'='
name|'os'
op|'.'
name|'listdir'
op|'('
name|'self'
op|'.'
name|'log_dir'
op|')'
op|'['
number|'0'
op|']'
newline|'\n'
name|'with'
name|'open'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'self'
op|'.'
name|'log_dir'
op|','
name|'stat_file'
op|')'
op|')'
name|'as'
name|'stat_handle'
op|':'
newline|'\n'
indent|'            '
name|'headers'
op|'='
name|'stat_handle'
op|'.'
name|'readline'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_'
op|'('
name|'headers'
op|'.'
name|'startswith'
op|'('
string|"'Account Hash,Container Name,'"
op|')'
op|')'
newline|'\n'
name|'for'
name|'i'
name|'in'
name|'range'
op|'('
number|'10'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'data'
op|'='
name|'stat_handle'
op|'.'
name|'readline'
op|'('
op|')'
newline|'\n'
name|'output_data'
op|'.'
name|'discard'
op|'('
name|'data'
op|'.'
name|'strip'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'len'
op|'('
name|'output_data'
op|')'
op|','
number|'0'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_account_stat_run_once_both
dedent|''
name|'def'
name|'test_account_stat_run_once_both'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'acc_stat'
op|','
name|'acc_output_data'
op|'='
name|'self'
op|'.'
name|'_gen_account_stat'
op|'('
op|')'
newline|'\n'
name|'con_stat'
op|','
name|'con_output_data'
op|'='
name|'self'
op|'.'
name|'_gen_container_stat'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'acc_stat'
op|'.'
name|'run_once'
op|'('
op|')'
newline|'\n'
name|'stat_file'
op|'='
name|'os'
op|'.'
name|'listdir'
op|'('
name|'self'
op|'.'
name|'log_dir'
op|')'
op|'['
number|'0'
op|']'
newline|'\n'
name|'with'
name|'open'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'self'
op|'.'
name|'log_dir'
op|','
name|'stat_file'
op|')'
op|')'
name|'as'
name|'stat_handle'
op|':'
newline|'\n'
indent|'            '
name|'for'
name|'i'
name|'in'
name|'range'
op|'('
number|'10'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'data'
op|'='
name|'stat_handle'
op|'.'
name|'readline'
op|'('
op|')'
newline|'\n'
name|'acc_output_data'
op|'.'
name|'discard'
op|'('
name|'data'
op|'.'
name|'strip'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'len'
op|'('
name|'acc_output_data'
op|')'
op|','
number|'0'
op|')'
newline|'\n'
nl|'\n'
name|'con_stat'
op|'.'
name|'run_once'
op|'('
op|')'
newline|'\n'
name|'stat_file'
op|'='
op|'['
name|'f'
name|'for'
name|'f'
name|'in'
name|'os'
op|'.'
name|'listdir'
op|'('
name|'self'
op|'.'
name|'log_dir'
op|')'
name|'if'
name|'f'
op|'!='
name|'stat_file'
op|']'
op|'['
number|'0'
op|']'
newline|'\n'
name|'with'
name|'open'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'self'
op|'.'
name|'log_dir'
op|','
name|'stat_file'
op|')'
op|')'
name|'as'
name|'stat_handle'
op|':'
newline|'\n'
indent|'            '
name|'headers'
op|'='
name|'stat_handle'
op|'.'
name|'readline'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_'
op|'('
name|'headers'
op|'.'
name|'startswith'
op|'('
string|"'Account Hash,Container Name,'"
op|')'
op|')'
newline|'\n'
name|'for'
name|'i'
name|'in'
name|'range'
op|'('
number|'10'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'data'
op|'='
name|'stat_handle'
op|'.'
name|'readline'
op|'('
op|')'
newline|'\n'
name|'con_output_data'
op|'.'
name|'discard'
op|'('
name|'data'
op|'.'
name|'strip'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'len'
op|'('
name|'con_output_data'
op|')'
op|','
number|'0'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_account_stat_run_once_fail
dedent|''
name|'def'
name|'test_account_stat_run_once_fail'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'stat'
op|','
name|'output_data'
op|'='
name|'self'
op|'.'
name|'_gen_account_stat'
op|'('
op|')'
newline|'\n'
name|'rmtree'
op|'('
name|'self'
op|'.'
name|'accounts'
op|')'
newline|'\n'
name|'stat'
op|'.'
name|'run_once'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'len'
op|'('
name|'stat'
op|'.'
name|'logger'
op|'.'
name|'log_dict'
op|'['
string|"'debug'"
op|']'
op|')'
op|','
number|'1'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_not_implemented
dedent|''
name|'def'
name|'test_not_implemented'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'db_stat'
op|'='
name|'db_stats_collector'
op|'.'
name|'DatabaseStatsCollector'
op|'('
name|'self'
op|'.'
name|'conf'
op|','
nl|'\n'
string|"'account'"
op|','
string|"'test_dir'"
op|','
string|"'stats-%Y%m%d%H_'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'NotImplementedError'
op|','
name|'db_stat'
op|'.'
name|'get_data'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'NotImplementedError'
op|','
name|'db_stat'
op|'.'
name|'get_header'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_not_not_mounted
dedent|''
name|'def'
name|'test_not_not_mounted'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'conf'
op|'['
string|"'mount_check'"
op|']'
op|'='
string|"'true'"
newline|'\n'
name|'stat'
op|','
name|'output_data'
op|'='
name|'self'
op|'.'
name|'_gen_account_stat'
op|'('
op|')'
newline|'\n'
name|'stat'
op|'.'
name|'run_once'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'len'
op|'('
name|'stat'
op|'.'
name|'logger'
op|'.'
name|'log_dict'
op|'['
string|"'error'"
op|']'
op|')'
op|','
number|'1'
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'if'
name|'__name__'
op|'=='
string|"'__main__'"
op|':'
newline|'\n'
indent|'    '
name|'unittest'
op|'.'
name|'main'
op|'('
op|')'
newline|'\n'
dedent|''
endmarker|''
end_unit
