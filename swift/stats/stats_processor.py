begin_unit
comment|'# Copyright (c) 2010 OpenStack, LLC.'
nl|'\n'
comment|'#'
nl|'\n'
comment|'# Licensed under the Apache License, Version 2.0 (the "License");'
nl|'\n'
comment|'# you may not use this file except in compliance with the License.'
nl|'\n'
comment|'# You may obtain a copy of the License at'
nl|'\n'
comment|'#'
nl|'\n'
comment|'#    http://www.apache.org/licenses/LICENSE-2.0'
nl|'\n'
comment|'#'
nl|'\n'
comment|'# Unless required by applicable law or agreed to in writing, software'
nl|'\n'
comment|'# distributed under the License is distributed on an "AS IS" BASIS,'
nl|'\n'
comment|'# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or'
nl|'\n'
comment|'# implied.'
nl|'\n'
comment|'# See the License for the specific language governing permissions and'
nl|'\n'
comment|'# limitations under the License.'
nl|'\n'
nl|'\n'
DECL|class|StatsLogProcessor
name|'class'
name|'StatsLogProcessor'
op|'('
name|'object'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|member|__init__
indent|'    '
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'conf'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'pass'
newline|'\n'
nl|'\n'
DECL|member|process
dedent|''
name|'def'
name|'process'
op|'('
name|'self'
op|','
name|'obj_stream'
op|')'
op|':'
newline|'\n'
indent|'        '
string|"'''generate hourly groupings of data from one stats log file'''"
newline|'\n'
name|'account_totals'
op|'='
op|'{'
op|'}'
newline|'\n'
name|'year'
op|','
name|'month'
op|','
name|'day'
op|','
name|'hour'
op|','
name|'_'
op|'='
name|'item'
op|'.'
name|'split'
op|'('
string|"'/'"
op|')'
newline|'\n'
name|'for'
name|'line'
name|'in'
name|'obj_stream'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'not'
name|'line'
op|':'
newline|'\n'
indent|'                '
name|'continue'
newline|'\n'
dedent|''
name|'try'
op|':'
newline|'\n'
indent|'                '
op|'('
name|'account'
op|','
nl|'\n'
name|'container_count'
op|','
nl|'\n'
name|'object_count'
op|','
nl|'\n'
name|'bytes_used'
op|','
nl|'\n'
name|'created_at'
op|')'
op|'='
name|'line'
op|'.'
name|'split'
op|'('
string|"','"
op|')'
newline|'\n'
name|'account'
op|'='
name|'account'
op|'.'
name|'strip'
op|'('
string|'\'"\''
op|')'
newline|'\n'
name|'if'
name|'account_name'
name|'and'
name|'account_name'
op|'!='
name|'account'
op|':'
newline|'\n'
indent|'                    '
name|'continue'
newline|'\n'
dedent|''
name|'container_count'
op|'='
name|'int'
op|'('
name|'container_count'
op|'.'
name|'strip'
op|'('
string|'\'"\''
op|')'
op|')'
newline|'\n'
name|'object_count'
op|'='
name|'int'
op|'('
name|'object_count'
op|'.'
name|'strip'
op|'('
string|'\'"\''
op|')'
op|')'
newline|'\n'
name|'bytes_used'
op|'='
name|'int'
op|'('
name|'bytes_used'
op|'.'
name|'strip'
op|'('
string|'\'"\''
op|')'
op|')'
newline|'\n'
name|'aggr_key'
op|'='
op|'('
name|'account'
op|','
name|'year'
op|','
name|'month'
op|','
name|'day'
op|','
name|'hour'
op|')'
newline|'\n'
name|'d'
op|'='
name|'account_totals'
op|'.'
name|'get'
op|'('
name|'aggr_key'
op|','
op|'{'
op|'}'
op|')'
newline|'\n'
name|'d'
op|'['
string|"'count'"
op|']'
op|'='
name|'d'
op|'.'
name|'setdefault'
op|'('
string|"'count'"
op|','
number|'0'
op|')'
op|'+'
number|'1'
newline|'\n'
name|'d'
op|'['
string|"'container_count'"
op|']'
op|'='
name|'d'
op|'.'
name|'setdefault'
op|'('
string|"'container_count'"
op|','
number|'0'
op|')'
op|'+'
name|'container_count'
newline|'\n'
name|'d'
op|'['
string|"'object_count'"
op|']'
op|'='
name|'d'
op|'.'
name|'setdefault'
op|'('
string|"'object_count'"
op|','
number|'0'
op|')'
op|'+'
name|'object_count'
newline|'\n'
name|'d'
op|'['
string|"'bytes_used'"
op|']'
op|'='
name|'d'
op|'.'
name|'setdefault'
op|'('
string|"'bytes_used'"
op|','
number|'0'
op|')'
op|'+'
name|'bytes_used'
newline|'\n'
name|'d'
op|'['
string|"'created_at'"
op|']'
op|'='
name|'created_at'
newline|'\n'
name|'account_totals'
op|'['
name|'aggr_key'
op|']'
op|'='
name|'d'
newline|'\n'
dedent|''
name|'except'
op|'('
name|'IndexError'
op|','
name|'ValueError'
op|')'
op|':'
newline|'\n'
comment|'# bad line data'
nl|'\n'
indent|'                '
name|'pass'
newline|'\n'
dedent|''
dedent|''
name|'return'
name|'account_totals'
op|','
name|'item'
newline|'\n'
dedent|''
dedent|''
endmarker|''
end_unit
