begin_unit
comment|'#!/usr/bin/python'
nl|'\n'
comment|'# Copyright (c) 2010 OpenStack, LLC.'
nl|'\n'
comment|'#'
nl|'\n'
comment|'# Licensed under the Apache License, Version 2.0 (the "License");'
nl|'\n'
comment|'# you may not use this file except in compliance with the License.'
nl|'\n'
comment|'# You may obtain a copy of the License at'
nl|'\n'
comment|'#'
nl|'\n'
comment|'#    http://www.apache.org/licenses/LICENSE-2.0'
nl|'\n'
comment|'#'
nl|'\n'
comment|'# Unless required by applicable law or agreed to in writing, software'
nl|'\n'
comment|'# distributed under the License is distributed on an "AS IS" BASIS,'
nl|'\n'
comment|'# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or'
nl|'\n'
comment|'# implied.'
nl|'\n'
comment|'# See the License for the specific language governing permissions and'
nl|'\n'
comment|'# limitations under the License.'
nl|'\n'
nl|'\n'
name|'import'
name|'sys'
newline|'\n'
name|'import'
name|'urllib'
newline|'\n'
nl|'\n'
name|'from'
name|'swift'
op|'.'
name|'common'
op|'.'
name|'ring'
name|'import'
name|'Ring'
newline|'\n'
name|'from'
name|'swift'
op|'.'
name|'common'
op|'.'
name|'utils'
name|'import'
name|'hash_path'
newline|'\n'
nl|'\n'
nl|'\n'
name|'if'
name|'len'
op|'('
name|'sys'
op|'.'
name|'argv'
op|')'
op|'<'
number|'3'
name|'or'
name|'len'
op|'('
name|'sys'
op|'.'
name|'argv'
op|')'
op|'>'
number|'5'
op|':'
newline|'\n'
indent|'    '
name|'print'
string|"'Usage: %s <ring.gz> <account> [<container>] [<object>]'"
op|'%'
name|'sys'
op|'.'
name|'argv'
op|'['
number|'0'
op|']'
newline|'\n'
name|'print'
string|"'Shows the nodes responsible for the item specified.'"
newline|'\n'
name|'print'
string|"'Example:'"
newline|'\n'
name|'print'
string|"'    $ %s /etc/swift/account.ring.gz MyAccount'"
op|'%'
name|'sys'
op|'.'
name|'argv'
op|'['
number|'0'
op|']'
newline|'\n'
name|'print'
string|"'    Partition 5743883'"
newline|'\n'
name|'print'
string|"'    Hash 96ae332a60b58910784e4417a03e1ad0'"
newline|'\n'
name|'print'
string|"'    10.1.1.7:8000 sdd1'"
newline|'\n'
name|'print'
string|"'    10.1.9.2:8000 sdb1'"
newline|'\n'
name|'print'
string|"'    10.1.5.5:8000 sdf1'"
newline|'\n'
name|'sys'
op|'.'
name|'exit'
op|'('
number|'1'
op|')'
newline|'\n'
nl|'\n'
DECL|variable|ringloc
dedent|''
name|'ringloc'
op|'='
name|'None'
newline|'\n'
DECL|variable|account
name|'account'
op|'='
name|'None'
newline|'\n'
DECL|variable|container
name|'container'
op|'='
name|'None'
newline|'\n'
DECL|variable|obj
name|'obj'
op|'='
name|'None'
newline|'\n'
nl|'\n'
name|'if'
name|'len'
op|'('
name|'sys'
op|'.'
name|'argv'
op|')'
op|'>'
number|'4'
op|':'
name|'ring'
op|','
name|'account'
op|','
name|'container'
op|','
name|'obj'
op|'='
name|'sys'
op|'.'
name|'argv'
op|'['
number|'1'
op|':'
number|'5'
op|']'
newline|'\n'
name|'elif'
name|'len'
op|'('
name|'sys'
op|'.'
name|'argv'
op|')'
op|'>'
number|'3'
op|':'
name|'ring'
op|','
name|'account'
op|','
name|'container'
op|'='
name|'sys'
op|'.'
name|'argv'
op|'['
number|'1'
op|':'
number|'4'
op|']'
newline|'\n'
name|'elif'
name|'len'
op|'('
name|'sys'
op|'.'
name|'argv'
op|')'
op|'>'
number|'2'
op|':'
name|'ring'
op|','
name|'account'
op|'='
name|'sys'
op|'.'
name|'argv'
op|'['
number|'1'
op|':'
number|'3'
op|']'
newline|'\n'
nl|'\n'
name|'print'
string|"'\\nAccount \\t%s'"
op|'%'
name|'account'
newline|'\n'
name|'print'
string|"'Container\\t%s'"
op|'%'
name|'container'
newline|'\n'
name|'print'
string|"'Object   \\t%s\\n'"
op|'%'
name|'obj'
newline|'\n'
nl|'\n'
name|'if'
name|'obj'
op|':'
newline|'\n'
DECL|variable|hash_str
indent|'    '
name|'hash_str'
op|'='
name|'hash_path'
op|'('
name|'account'
op|','
name|'container'
op|','
name|'obj'
op|')'
newline|'\n'
name|'part'
op|','
name|'nodes'
op|'='
name|'Ring'
op|'('
name|'ring'
op|')'
op|'.'
name|'get_nodes'
op|'('
name|'account'
op|','
name|'container'
op|','
name|'obj'
op|')'
newline|'\n'
name|'for'
name|'node'
name|'in'
name|'nodes'
op|':'
newline|'\n'
indent|'        '
name|'print'
string|"'Server:Port Device\\t%s:%s %s'"
op|'%'
op|'('
name|'node'
op|'['
string|"'ip'"
op|']'
op|','
name|'node'
op|'['
string|"'port'"
op|']'
op|','
name|'node'
op|'['
string|"'device'"
op|']'
op|')'
newline|'\n'
dedent|''
name|'print'
string|"'\\nPartition\\t%s'"
op|'%'
name|'part'
newline|'\n'
name|'print'
string|"'Hash        \\t%s\\n'"
op|'%'
name|'hash_str'
newline|'\n'
name|'for'
name|'node'
name|'in'
name|'nodes'
op|':'
newline|'\n'
DECL|variable|acct_cont_obj
indent|'      '
name|'acct_cont_obj'
op|'='
string|'"%s/%s/%s"'
op|'%'
op|'('
name|'account'
op|','
name|'container'
op|','
name|'obj'
op|')'
newline|'\n'
name|'print'
string|'\'curl -I -XHEAD "http://%s:%s/%s/%s/%s"\''
op|'%'
op|'('
name|'node'
op|'['
string|"'ip'"
op|']'
op|','
name|'node'
op|'['
string|"'port'"
op|']'
op|','
name|'node'
op|'['
string|"'device'"
op|']'
op|','
name|'part'
op|','
name|'urllib'
op|'.'
name|'quote'
op|'('
name|'acct_cont_obj'
op|')'
op|')'
newline|'\n'
dedent|''
name|'print'
string|'"\\n"'
newline|'\n'
name|'for'
name|'node'
name|'in'
name|'nodes'
op|':'
newline|'\n'
indent|'      '
name|'print'
string|'\'ssh %s "ls -lah /srv/node/%s/objects/%s/%s/%s/"\''
op|'%'
op|'('
name|'node'
op|'['
string|"'ip'"
op|']'
op|','
name|'node'
op|'['
string|"'device'"
op|']'
op|','
name|'part'
op|','
name|'hash_str'
op|'['
op|'-'
number|'3'
op|':'
op|']'
op|','
name|'hash_str'
op|')'
newline|'\n'
dedent|''
dedent|''
name|'elif'
name|'container'
op|':'
newline|'\n'
DECL|variable|hash_str
indent|'    '
name|'hash_str'
op|'='
name|'hash_path'
op|'('
name|'account'
op|','
name|'container'
op|')'
newline|'\n'
name|'part'
op|','
name|'nodes'
op|'='
name|'Ring'
op|'('
name|'ring'
op|')'
op|'.'
name|'get_nodes'
op|'('
name|'account'
op|','
name|'container'
op|')'
newline|'\n'
name|'for'
name|'node'
name|'in'
name|'nodes'
op|':'
newline|'\n'
indent|'        '
name|'print'
string|"'Server:Port Device\\t%s:%s %s'"
op|'%'
op|'('
name|'node'
op|'['
string|"'ip'"
op|']'
op|','
name|'node'
op|'['
string|"'port'"
op|']'
op|','
name|'node'
op|'['
string|"'device'"
op|']'
op|')'
newline|'\n'
dedent|''
name|'print'
string|"'\\nPartition %s'"
op|'%'
name|'part'
newline|'\n'
name|'print'
string|"'Hash %s\\n'"
op|'%'
name|'hash_str'
newline|'\n'
name|'for'
name|'node'
name|'in'
name|'nodes'
op|':'
newline|'\n'
DECL|variable|acct_cont
indent|'      '
name|'acct_cont'
op|'='
string|'"%s/%s"'
op|'%'
op|'('
name|'account'
op|','
name|'container'
op|')'
newline|'\n'
name|'print'
string|'\'curl -I -XHEAD "http://%s:%s/%s/%s/%s"\''
op|'%'
op|'('
name|'node'
op|'['
string|"'ip'"
op|']'
op|','
name|'node'
op|'['
string|"'port'"
op|']'
op|','
name|'node'
op|'['
string|"'device'"
op|']'
op|','
name|'part'
op|','
name|'urllib'
op|'.'
name|'quote'
op|'('
name|'acct_cont'
op|')'
op|')'
newline|'\n'
dedent|''
name|'print'
string|'"\\n"'
newline|'\n'
name|'for'
name|'node'
name|'in'
name|'nodes'
op|':'
newline|'\n'
indent|'      '
name|'print'
string|'\'ssh %s "ls -lah /srv/node/%s/containers/%s/%s/%s/%s.db"\''
op|'%'
op|'('
name|'node'
op|'['
string|"'ip'"
op|']'
op|','
name|'node'
op|'['
string|"'device'"
op|']'
op|','
name|'part'
op|','
name|'hash_str'
op|'['
op|'-'
number|'3'
op|':'
op|']'
op|','
name|'hash_str'
op|','
name|'hash_str'
op|')'
newline|'\n'
dedent|''
dedent|''
name|'elif'
name|'account'
op|':'
newline|'\n'
DECL|variable|hash_str
indent|'    '
name|'hash_str'
op|'='
name|'hash_path'
op|'('
name|'account'
op|')'
newline|'\n'
name|'part'
op|','
name|'nodes'
op|'='
name|'Ring'
op|'('
name|'ring'
op|')'
op|'.'
name|'get_nodes'
op|'('
name|'account'
op|')'
newline|'\n'
name|'for'
name|'node'
name|'in'
name|'nodes'
op|':'
newline|'\n'
indent|'        '
name|'print'
string|"'Server:Port Device\\t%s:%s %s'"
op|'%'
op|'('
name|'node'
op|'['
string|"'ip'"
op|']'
op|','
name|'node'
op|'['
string|"'port'"
op|']'
op|','
name|'node'
op|'['
string|"'device'"
op|']'
op|')'
newline|'\n'
dedent|''
name|'print'
string|"'\\nPartition %s'"
op|'%'
name|'part'
newline|'\n'
name|'print'
string|"'Hash %s\\n'"
op|'%'
name|'hash_str'
newline|'\n'
name|'for'
name|'node'
name|'in'
name|'nodes'
op|':'
newline|'\n'
indent|'      '
name|'print'
string|'\'curl -I -XHEAD "http://%s:%s/%s/%s/%s"\''
op|'%'
op|'('
name|'node'
op|'['
string|"'ip'"
op|']'
op|','
name|'node'
op|'['
string|"'port'"
op|']'
op|','
name|'node'
op|'['
string|"'device'"
op|']'
op|','
name|'part'
op|','
name|'urllib'
op|'.'
name|'quote'
op|'('
name|'account'
op|')'
op|')'
newline|'\n'
dedent|''
name|'print'
string|'"\\n"'
newline|'\n'
name|'for'
name|'node'
name|'in'
name|'nodes'
op|':'
newline|'\n'
indent|'      '
name|'print'
string|'\'ssh %s "ls -lah /srv/node/%s/accounts/%s/%s/%s/%s.db"\''
op|'%'
op|'('
name|'node'
op|'['
string|"'ip'"
op|']'
op|','
name|'node'
op|'['
string|"'device'"
op|']'
op|','
name|'part'
op|','
name|'hash_str'
op|'['
op|'-'
number|'3'
op|':'
op|']'
op|','
name|'hash_str'
op|','
name|'hash_str'
op|')'
newline|'\n'
dedent|''
name|'print'
string|'"\\n\\n"'
newline|'\n'
dedent|''
endmarker|''
end_unit
