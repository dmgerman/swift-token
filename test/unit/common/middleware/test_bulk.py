begin_unit
comment|'# -*- coding: utf-8 -*-'
nl|'\n'
comment|'# Copyright (c) 2012 OpenStack Foundation'
nl|'\n'
comment|'#'
nl|'\n'
comment|'# Licensed under the Apache License, Version 2.0 (the "License");'
nl|'\n'
comment|'# you may not use this file except in compliance with the License.'
nl|'\n'
comment|'# You may obtain a copy of the License at'
nl|'\n'
comment|'#'
nl|'\n'
comment|'#    http://www.apache.org/licenses/LICENSE-2.0'
nl|'\n'
comment|'#'
nl|'\n'
comment|'# Unless required by applicable law or agreed to in writing, software'
nl|'\n'
comment|'# distributed under the License is distributed on an "AS IS" BASIS,'
nl|'\n'
comment|'# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or'
nl|'\n'
comment|'# implied.'
nl|'\n'
comment|'# See the License for the specific language governing permissions and'
nl|'\n'
comment|'# limitations under the License.'
nl|'\n'
nl|'\n'
name|'import'
name|'numbers'
newline|'\n'
name|'from'
name|'six'
op|'.'
name|'moves'
name|'import'
name|'urllib'
newline|'\n'
name|'import'
name|'unittest'
newline|'\n'
name|'import'
name|'os'
newline|'\n'
name|'import'
name|'tarfile'
newline|'\n'
name|'import'
name|'zlib'
newline|'\n'
name|'import'
name|'mock'
newline|'\n'
name|'import'
name|'six'
newline|'\n'
name|'from'
name|'six'
name|'import'
name|'BytesIO'
newline|'\n'
name|'from'
name|'shutil'
name|'import'
name|'rmtree'
newline|'\n'
name|'from'
name|'tempfile'
name|'import'
name|'mkdtemp'
newline|'\n'
name|'from'
name|'eventlet'
name|'import'
name|'sleep'
newline|'\n'
name|'from'
name|'mock'
name|'import'
name|'patch'
op|','
name|'call'
newline|'\n'
name|'from'
name|'test'
op|'.'
name|'unit'
op|'.'
name|'common'
op|'.'
name|'middleware'
op|'.'
name|'helpers'
name|'import'
name|'FakeSwift'
newline|'\n'
name|'from'
name|'swift'
op|'.'
name|'common'
name|'import'
name|'utils'
op|','
name|'constraints'
newline|'\n'
name|'from'
name|'swift'
op|'.'
name|'common'
op|'.'
name|'header_key_dict'
name|'import'
name|'HeaderKeyDict'
newline|'\n'
name|'from'
name|'swift'
op|'.'
name|'common'
op|'.'
name|'middleware'
name|'import'
name|'bulk'
newline|'\n'
name|'from'
name|'swift'
op|'.'
name|'common'
op|'.'
name|'swob'
name|'import'
name|'Request'
op|','
name|'Response'
op|','
name|'HTTPException'
op|','
name|'HTTPNoContent'
op|','
name|'HTTPCreated'
newline|'\n'
name|'from'
name|'swift'
op|'.'
name|'common'
op|'.'
name|'http'
name|'import'
name|'HTTP_NOT_FOUND'
op|','
name|'HTTP_UNAUTHORIZED'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|FakeApp
name|'class'
name|'FakeApp'
op|'('
name|'object'
op|')'
op|':'
newline|'\n'
DECL|member|__init__
indent|'    '
name|'def'
name|'__init__'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'calls'
op|'='
number|'0'
newline|'\n'
name|'self'
op|'.'
name|'delete_paths'
op|'='
op|'['
op|']'
newline|'\n'
name|'self'
op|'.'
name|'max_pathlen'
op|'='
number|'100'
newline|'\n'
name|'self'
op|'.'
name|'del_cont_total_calls'
op|'='
number|'2'
newline|'\n'
name|'self'
op|'.'
name|'del_cont_cur_call'
op|'='
number|'0'
newline|'\n'
nl|'\n'
DECL|member|__call__
dedent|''
name|'def'
name|'__call__'
op|'('
name|'self'
op|','
name|'env'
op|','
name|'start_response'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'calls'
op|'+='
number|'1'
newline|'\n'
name|'if'
name|'env'
op|'['
string|"'PATH_INFO'"
op|']'
op|'.'
name|'startswith'
op|'('
string|"'/unauth/'"
op|')'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'env'
op|'['
string|"'PATH_INFO'"
op|']'
op|'.'
name|'endswith'
op|'('
string|"'/c/f_ok'"
op|')'
op|':'
newline|'\n'
indent|'                '
name|'return'
name|'Response'
op|'('
name|'status'
op|'='
string|"'204 No Content'"
op|')'
op|'('
name|'env'
op|','
name|'start_response'
op|')'
newline|'\n'
dedent|''
name|'return'
name|'Response'
op|'('
name|'status'
op|'='
number|'401'
op|')'
op|'('
name|'env'
op|','
name|'start_response'
op|')'
newline|'\n'
dedent|''
name|'if'
name|'env'
op|'['
string|"'PATH_INFO'"
op|']'
op|'.'
name|'startswith'
op|'('
string|"'/create_cont/'"
op|')'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'env'
op|'['
string|"'REQUEST_METHOD'"
op|']'
op|'=='
string|"'HEAD'"
op|':'
newline|'\n'
indent|'                '
name|'return'
name|'Response'
op|'('
name|'status'
op|'='
string|"'404 Not Found'"
op|')'
op|'('
name|'env'
op|','
name|'start_response'
op|')'
newline|'\n'
dedent|''
name|'return'
name|'Response'
op|'('
name|'status'
op|'='
string|"'201 Created'"
op|')'
op|'('
name|'env'
op|','
name|'start_response'
op|')'
newline|'\n'
dedent|''
name|'if'
name|'env'
op|'['
string|"'PATH_INFO'"
op|']'
op|'.'
name|'startswith'
op|'('
string|"'/create_cont_fail/'"
op|')'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'env'
op|'['
string|"'REQUEST_METHOD'"
op|']'
op|'=='
string|"'HEAD'"
op|':'
newline|'\n'
indent|'                '
name|'return'
name|'Response'
op|'('
name|'status'
op|'='
string|"'403 Forbidden'"
op|')'
op|'('
name|'env'
op|','
name|'start_response'
op|')'
newline|'\n'
dedent|''
name|'return'
name|'Response'
op|'('
name|'status'
op|'='
string|"'404 Not Found'"
op|')'
op|'('
name|'env'
op|','
name|'start_response'
op|')'
newline|'\n'
dedent|''
name|'if'
name|'env'
op|'['
string|"'PATH_INFO'"
op|']'
op|'.'
name|'startswith'
op|'('
string|"'/create_obj_unauth/'"
op|')'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'env'
op|'['
string|"'PATH_INFO'"
op|']'
op|'.'
name|'endswith'
op|'('
string|"'/cont'"
op|')'
op|':'
newline|'\n'
indent|'                '
name|'return'
name|'Response'
op|'('
name|'status'
op|'='
string|"'201 Created'"
op|')'
op|'('
name|'env'
op|','
name|'start_response'
op|')'
newline|'\n'
dedent|''
name|'return'
name|'Response'
op|'('
name|'status'
op|'='
number|'401'
op|')'
op|'('
name|'env'
op|','
name|'start_response'
op|')'
newline|'\n'
dedent|''
name|'if'
name|'env'
op|'['
string|"'PATH_INFO'"
op|']'
op|'.'
name|'startswith'
op|'('
string|"'/tar_works/'"
op|')'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'len'
op|'('
name|'env'
op|'['
string|"'PATH_INFO'"
op|']'
op|')'
op|'>'
name|'self'
op|'.'
name|'max_pathlen'
op|':'
newline|'\n'
indent|'                '
name|'return'
name|'Response'
op|'('
name|'status'
op|'='
string|"'400 Bad Request'"
op|')'
op|'('
name|'env'
op|','
name|'start_response'
op|')'
newline|'\n'
dedent|''
name|'return'
name|'Response'
op|'('
name|'status'
op|'='
string|"'201 Created'"
op|')'
op|'('
name|'env'
op|','
name|'start_response'
op|')'
newline|'\n'
dedent|''
name|'if'
name|'env'
op|'['
string|"'PATH_INFO'"
op|']'
op|'.'
name|'startswith'
op|'('
string|"'/tar_works_cont_head_fail/'"
op|')'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'env'
op|'['
string|"'REQUEST_METHOD'"
op|']'
op|'=='
string|"'HEAD'"
op|':'
newline|'\n'
indent|'                '
name|'return'
name|'Response'
op|'('
name|'status'
op|'='
string|"'404 Not Found'"
op|')'
op|'('
name|'env'
op|','
name|'start_response'
op|')'
newline|'\n'
dedent|''
name|'if'
name|'len'
op|'('
name|'env'
op|'['
string|"'PATH_INFO'"
op|']'
op|')'
op|'>'
number|'100'
op|':'
newline|'\n'
indent|'                '
name|'return'
name|'Response'
op|'('
name|'status'
op|'='
string|"'400 Bad Request'"
op|')'
op|'('
name|'env'
op|','
name|'start_response'
op|')'
newline|'\n'
dedent|''
name|'return'
name|'Response'
op|'('
name|'status'
op|'='
string|"'201 Created'"
op|')'
op|'('
name|'env'
op|','
name|'start_response'
op|')'
newline|'\n'
dedent|''
name|'if'
op|'('
name|'env'
op|'['
string|"'PATH_INFO'"
op|']'
op|'.'
name|'startswith'
op|'('
string|"'/delete_works/'"
op|')'
nl|'\n'
name|'and'
name|'env'
op|'['
string|"'REQUEST_METHOD'"
op|']'
op|'=='
string|"'DELETE'"
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'delete_paths'
op|'.'
name|'append'
op|'('
name|'env'
op|'['
string|"'PATH_INFO'"
op|']'
op|')'
newline|'\n'
name|'if'
name|'len'
op|'('
name|'env'
op|'['
string|"'PATH_INFO'"
op|']'
op|')'
op|'>'
name|'self'
op|'.'
name|'max_pathlen'
op|':'
newline|'\n'
indent|'                '
name|'return'
name|'Response'
op|'('
name|'status'
op|'='
string|"'400 Bad Request'"
op|')'
op|'('
name|'env'
op|','
name|'start_response'
op|')'
newline|'\n'
dedent|''
name|'if'
name|'env'
op|'['
string|"'PATH_INFO'"
op|']'
op|'.'
name|'endswith'
op|'('
string|"'404'"
op|')'
op|':'
newline|'\n'
indent|'                '
name|'return'
name|'Response'
op|'('
name|'status'
op|'='
string|"'404 Not Found'"
op|')'
op|'('
name|'env'
op|','
name|'start_response'
op|')'
newline|'\n'
dedent|''
name|'if'
name|'env'
op|'['
string|"'PATH_INFO'"
op|']'
op|'.'
name|'endswith'
op|'('
string|"'badutf8'"
op|')'
op|':'
newline|'\n'
indent|'                '
name|'return'
name|'Response'
op|'('
nl|'\n'
name|'status'
op|'='
string|"'412 Precondition Failed'"
op|')'
op|'('
name|'env'
op|','
name|'start_response'
op|')'
newline|'\n'
dedent|''
name|'return'
name|'Response'
op|'('
name|'status'
op|'='
string|"'204 No Content'"
op|')'
op|'('
name|'env'
op|','
name|'start_response'
op|')'
newline|'\n'
dedent|''
name|'if'
name|'env'
op|'['
string|"'PATH_INFO'"
op|']'
op|'.'
name|'startswith'
op|'('
string|"'/delete_cont_fail/'"
op|')'
op|':'
newline|'\n'
indent|'            '
name|'return'
name|'Response'
op|'('
name|'status'
op|'='
string|"'409 Conflict'"
op|')'
op|'('
name|'env'
op|','
name|'start_response'
op|')'
newline|'\n'
dedent|''
name|'if'
name|'env'
op|'['
string|"'PATH_INFO'"
op|']'
op|'.'
name|'startswith'
op|'('
string|"'/broke/'"
op|')'
op|':'
newline|'\n'
indent|'            '
name|'return'
name|'Response'
op|'('
name|'status'
op|'='
string|"'500 Internal Error'"
op|')'
op|'('
name|'env'
op|','
name|'start_response'
op|')'
newline|'\n'
dedent|''
name|'if'
name|'env'
op|'['
string|"'PATH_INFO'"
op|']'
op|'.'
name|'startswith'
op|'('
string|"'/delete_cont_success_after_attempts/'"
op|')'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'self'
op|'.'
name|'del_cont_cur_call'
op|'<'
name|'self'
op|'.'
name|'del_cont_total_calls'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'del_cont_cur_call'
op|'+='
number|'1'
newline|'\n'
name|'return'
name|'Response'
op|'('
name|'status'
op|'='
string|"'409 Conflict'"
op|')'
op|'('
name|'env'
op|','
name|'start_response'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                '
name|'return'
name|'Response'
op|'('
name|'status'
op|'='
string|"'204 No Content'"
op|')'
op|'('
name|'env'
op|','
name|'start_response'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|function|build_dir_tree
dedent|''
dedent|''
dedent|''
dedent|''
name|'def'
name|'build_dir_tree'
op|'('
name|'start_path'
op|','
name|'tree_obj'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'if'
name|'isinstance'
op|'('
name|'tree_obj'
op|','
name|'list'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'for'
name|'obj'
name|'in'
name|'tree_obj'
op|':'
newline|'\n'
indent|'            '
name|'build_dir_tree'
op|'('
name|'start_path'
op|','
name|'obj'
op|')'
newline|'\n'
dedent|''
dedent|''
name|'if'
name|'isinstance'
op|'('
name|'tree_obj'
op|','
name|'dict'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'for'
name|'dir_name'
op|','
name|'obj'
name|'in'
name|'tree_obj'
op|'.'
name|'items'
op|'('
op|')'
op|':'
newline|'\n'
indent|'            '
name|'dir_path'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'start_path'
op|','
name|'dir_name'
op|')'
newline|'\n'
name|'os'
op|'.'
name|'mkdir'
op|'('
name|'dir_path'
op|')'
newline|'\n'
name|'build_dir_tree'
op|'('
name|'dir_path'
op|','
name|'obj'
op|')'
newline|'\n'
dedent|''
dedent|''
name|'if'
name|'isinstance'
op|'('
name|'tree_obj'
op|','
name|'six'
op|'.'
name|'text_type'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'tree_obj'
op|'='
name|'tree_obj'
op|'.'
name|'encode'
op|'('
string|"'utf8'"
op|')'
newline|'\n'
dedent|''
name|'if'
name|'isinstance'
op|'('
name|'tree_obj'
op|','
name|'str'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'obj_path'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'start_path'
op|','
name|'tree_obj'
op|')'
newline|'\n'
name|'with'
name|'open'
op|'('
name|'obj_path'
op|','
string|"'w+'"
op|')'
name|'as'
name|'tree_file'
op|':'
newline|'\n'
indent|'            '
name|'tree_file'
op|'.'
name|'write'
op|'('
string|"'testing'"
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|function|build_tar_tree
dedent|''
dedent|''
dedent|''
name|'def'
name|'build_tar_tree'
op|'('
name|'tar'
op|','
name|'start_path'
op|','
name|'tree_obj'
op|','
name|'base_path'
op|'='
string|"''"
op|')'
op|':'
newline|'\n'
indent|'    '
name|'if'
name|'isinstance'
op|'('
name|'tree_obj'
op|','
name|'list'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'for'
name|'obj'
name|'in'
name|'tree_obj'
op|':'
newline|'\n'
indent|'            '
name|'build_tar_tree'
op|'('
name|'tar'
op|','
name|'start_path'
op|','
name|'obj'
op|','
name|'base_path'
op|'='
name|'base_path'
op|')'
newline|'\n'
dedent|''
dedent|''
name|'if'
name|'isinstance'
op|'('
name|'tree_obj'
op|','
name|'dict'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'for'
name|'dir_name'
op|','
name|'obj'
name|'in'
name|'tree_obj'
op|'.'
name|'items'
op|'('
op|')'
op|':'
newline|'\n'
indent|'            '
name|'dir_path'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'start_path'
op|','
name|'dir_name'
op|')'
newline|'\n'
name|'tar_info'
op|'='
name|'tarfile'
op|'.'
name|'TarInfo'
op|'('
name|'dir_path'
op|'['
name|'len'
op|'('
name|'base_path'
op|')'
op|':'
op|']'
op|')'
newline|'\n'
name|'tar_info'
op|'.'
name|'type'
op|'='
name|'tarfile'
op|'.'
name|'DIRTYPE'
newline|'\n'
name|'tar'
op|'.'
name|'addfile'
op|'('
name|'tar_info'
op|')'
newline|'\n'
name|'build_tar_tree'
op|'('
name|'tar'
op|','
name|'dir_path'
op|','
name|'obj'
op|','
name|'base_path'
op|'='
name|'base_path'
op|')'
newline|'\n'
dedent|''
dedent|''
name|'if'
name|'isinstance'
op|'('
name|'tree_obj'
op|','
name|'six'
op|'.'
name|'text_type'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'tree_obj'
op|'='
name|'tree_obj'
op|'.'
name|'encode'
op|'('
string|"'utf8'"
op|')'
newline|'\n'
dedent|''
name|'if'
name|'isinstance'
op|'('
name|'tree_obj'
op|','
name|'str'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'obj_path'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'start_path'
op|','
name|'tree_obj'
op|')'
newline|'\n'
name|'tar_info'
op|'='
name|'tarfile'
op|'.'
name|'TarInfo'
op|'('
string|"'./'"
op|'+'
name|'obj_path'
op|'['
name|'len'
op|'('
name|'base_path'
op|')'
op|':'
op|']'
op|')'
newline|'\n'
name|'tar'
op|'.'
name|'addfile'
op|'('
name|'tar_info'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|TestUntarMetadata
dedent|''
dedent|''
name|'class'
name|'TestUntarMetadata'
op|'('
name|'unittest'
op|'.'
name|'TestCase'
op|')'
op|':'
newline|'\n'
DECL|member|setUp
indent|'    '
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'app'
op|'='
name|'FakeSwift'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'bulk'
op|'='
name|'bulk'
op|'.'
name|'filter_factory'
op|'('
op|'{'
op|'}'
op|')'
op|'('
name|'self'
op|'.'
name|'app'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'testdir'
op|'='
name|'mkdtemp'
op|'('
name|'suffix'
op|'='
string|"'tmp_test_bulk'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|tearDown
dedent|''
name|'def'
name|'tearDown'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'rmtree'
op|'('
name|'self'
op|'.'
name|'testdir'
op|','
name|'ignore_errors'
op|'='
number|'1'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_extract_metadata
dedent|''
name|'def'
name|'test_extract_metadata'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'app'
op|'.'
name|'register'
op|'('
string|"'HEAD'"
op|','
string|"'/v1/a/c?extract-archive=tar'"
op|','
nl|'\n'
name|'HTTPNoContent'
op|','
op|'{'
op|'}'
op|','
name|'None'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'app'
op|'.'
name|'register'
op|'('
string|"'PUT'"
op|','
string|"'/v1/a/c/obj1?extract-archive=tar'"
op|','
nl|'\n'
name|'HTTPCreated'
op|','
op|'{'
op|'}'
op|','
name|'None'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'app'
op|'.'
name|'register'
op|'('
string|"'PUT'"
op|','
string|"'/v1/a/c/obj2?extract-archive=tar'"
op|','
nl|'\n'
name|'HTTPCreated'
op|','
op|'{'
op|'}'
op|','
name|'None'
op|')'
newline|'\n'
nl|'\n'
comment|"# It's a real pain to instantiate TarInfo objects directly; they"
nl|'\n'
comment|'# really want to come from a file on disk or a tarball. So, we write'
nl|'\n'
comment|'# out some files and add pax headers to them as they get placed into'
nl|'\n'
comment|'# the tarball.'
nl|'\n'
name|'with'
name|'open'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'self'
op|'.'
name|'testdir'
op|','
string|'"obj1"'
op|')'
op|','
string|'"w"'
op|')'
name|'as'
name|'fh1'
op|':'
newline|'\n'
indent|'            '
name|'fh1'
op|'.'
name|'write'
op|'('
string|'"obj1 contents\\n"'
op|')'
newline|'\n'
dedent|''
name|'with'
name|'open'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'self'
op|'.'
name|'testdir'
op|','
string|'"obj2"'
op|')'
op|','
string|'"w"'
op|')'
name|'as'
name|'fh2'
op|':'
newline|'\n'
indent|'            '
name|'fh2'
op|'.'
name|'write'
op|'('
string|'"obj2 contents\\n"'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'tar_ball'
op|'='
name|'BytesIO'
op|'('
op|')'
newline|'\n'
name|'tar_file'
op|'='
name|'tarfile'
op|'.'
name|'TarFile'
op|'.'
name|'open'
op|'('
name|'fileobj'
op|'='
name|'tar_ball'
op|','
name|'mode'
op|'='
string|'"w"'
op|','
nl|'\n'
name|'format'
op|'='
name|'tarfile'
op|'.'
name|'PAX_FORMAT'
op|')'
newline|'\n'
nl|'\n'
comment|'# With GNU tar 1.27.1 or later (possibly 1.27 as well), a file with'
nl|'\n'
comment|'# extended attribute user.thingy = dingy gets put into the tarfile'
nl|'\n'
comment|'# with pax_headers containing key/value pair'
nl|'\n'
comment|'# (SCHILY.xattr.user.thingy, dingy), both unicode strings (py2: type'
nl|'\n'
comment|'# unicode, not type str).'
nl|'\n'
comment|'#'
nl|'\n'
comment|'# With BSD tar (libarchive), you get key/value pair'
nl|'\n'
comment|'# (LIBARCHIVE.xattr.user.thingy, dingy), which strikes me as'
nl|'\n'
comment|'# gratuitous incompatibility.'
nl|'\n'
comment|'#'
nl|'\n'
comment|"# Still, we'll support uploads with both. Just heap more code on the"
nl|'\n'
comment|"# problem until you can forget it's under there."
nl|'\n'
name|'with'
name|'open'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'self'
op|'.'
name|'testdir'
op|','
string|'"obj1"'
op|')'
op|')'
name|'as'
name|'fh1'
op|':'
newline|'\n'
indent|'            '
name|'tar_info1'
op|'='
name|'tar_file'
op|'.'
name|'gettarinfo'
op|'('
name|'fileobj'
op|'='
name|'fh1'
op|','
nl|'\n'
name|'arcname'
op|'='
string|'"obj1"'
op|')'
newline|'\n'
name|'tar_info1'
op|'.'
name|'pax_headers'
op|'['
string|"u'SCHILY.xattr.user.mime_type'"
op|']'
op|'='
string|"u'application/food-diary'"
newline|'\n'
name|'tar_info1'
op|'.'
name|'pax_headers'
op|'['
string|"u'SCHILY.xattr.user.meta.lunch'"
op|']'
op|'='
string|"u'sopa de alb\xc3\xb3ndigas'"
newline|'\n'
name|'tar_info1'
op|'.'
name|'pax_headers'
op|'['
nl|'\n'
string|"u'SCHILY.xattr.user.meta.afternoon-snack'"
op|']'
op|'='
string|"u'gigantic bucket of coffee'"
newline|'\n'
name|'tar_file'
op|'.'
name|'addfile'
op|'('
name|'tar_info1'
op|','
name|'fh1'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'with'
name|'open'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'self'
op|'.'
name|'testdir'
op|','
string|'"obj2"'
op|')'
op|')'
name|'as'
name|'fh2'
op|':'
newline|'\n'
indent|'            '
name|'tar_info2'
op|'='
name|'tar_file'
op|'.'
name|'gettarinfo'
op|'('
name|'fileobj'
op|'='
name|'fh2'
op|','
nl|'\n'
name|'arcname'
op|'='
string|'"obj2"'
op|')'
newline|'\n'
name|'tar_info2'
op|'.'
name|'pax_headers'
op|'['
nl|'\n'
string|"u'LIBARCHIVE.xattr.user.meta.muppet'"
op|']'
op|'='
string|"u'bert'"
newline|'\n'
name|'tar_info2'
op|'.'
name|'pax_headers'
op|'['
nl|'\n'
string|"u'LIBARCHIVE.xattr.user.meta.cat'"
op|']'
op|'='
string|"u'fluffy'"
newline|'\n'
name|'tar_info2'
op|'.'
name|'pax_headers'
op|'['
nl|'\n'
string|"u'LIBARCHIVE.xattr.user.notmeta'"
op|']'
op|'='
string|"u'skipped'"
newline|'\n'
name|'tar_file'
op|'.'
name|'addfile'
op|'('
name|'tar_info2'
op|','
name|'fh2'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'tar_ball'
op|'.'
name|'seek'
op|'('
number|'0'
op|')'
newline|'\n'
nl|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/v1/a/c?extract-archive=tar'"
op|')'
newline|'\n'
name|'req'
op|'.'
name|'environ'
op|'['
string|"'REQUEST_METHOD'"
op|']'
op|'='
string|"'PUT'"
newline|'\n'
name|'req'
op|'.'
name|'environ'
op|'['
string|"'wsgi.input'"
op|']'
op|'='
name|'tar_ball'
newline|'\n'
name|'req'
op|'.'
name|'headers'
op|'['
string|"'transfer-encoding'"
op|']'
op|'='
string|"'chunked'"
newline|'\n'
name|'req'
op|'.'
name|'headers'
op|'['
string|"'accept'"
op|']'
op|'='
string|"'application/json;q=1.0'"
newline|'\n'
nl|'\n'
name|'resp'
op|'='
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'bulk'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'200'
op|')'
newline|'\n'
nl|'\n'
comment|'# sanity check to make sure the upload worked'
nl|'\n'
name|'upload_status'
op|'='
name|'utils'
op|'.'
name|'json'
op|'.'
name|'loads'
op|'('
name|'resp'
op|'.'
name|'body'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'upload_status'
op|'['
string|"'Number Files Created'"
op|']'
op|','
number|'2'
op|')'
newline|'\n'
nl|'\n'
name|'put1_headers'
op|'='
name|'HeaderKeyDict'
op|'('
name|'self'
op|'.'
name|'app'
op|'.'
name|'calls_with_headers'
op|'['
number|'1'
op|']'
op|'['
number|'2'
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
nl|'\n'
name|'put1_headers'
op|'.'
name|'get'
op|'('
string|"'Content-Type'"
op|')'
op|','
nl|'\n'
string|"'application/food-diary'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
nl|'\n'
name|'put1_headers'
op|'.'
name|'get'
op|'('
string|"'X-Object-Meta-Lunch'"
op|')'
op|','
nl|'\n'
string|"'sopa de alb\\xc3\\xb3ndigas'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
nl|'\n'
name|'put1_headers'
op|'.'
name|'get'
op|'('
string|"'X-Object-Meta-Afternoon-Snack'"
op|')'
op|','
nl|'\n'
string|"'gigantic bucket of coffee'"
op|')'
newline|'\n'
nl|'\n'
name|'put2_headers'
op|'='
name|'HeaderKeyDict'
op|'('
name|'self'
op|'.'
name|'app'
op|'.'
name|'calls_with_headers'
op|'['
number|'2'
op|']'
op|'['
number|'2'
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'put2_headers'
op|'.'
name|'get'
op|'('
string|"'X-Object-Meta-Muppet'"
op|')'
op|','
string|"'bert'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'put2_headers'
op|'.'
name|'get'
op|'('
string|"'X-Object-Meta-Cat'"
op|')'
op|','
string|"'fluffy'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'put2_headers'
op|'.'
name|'get'
op|'('
string|"'Content-Type'"
op|')'
op|','
name|'None'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'put2_headers'
op|'.'
name|'get'
op|'('
string|"'X-Object-Meta-Blah'"
op|')'
op|','
name|'None'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|TestUntar
dedent|''
dedent|''
name|'class'
name|'TestUntar'
op|'('
name|'unittest'
op|'.'
name|'TestCase'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|member|setUp
indent|'    '
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'app'
op|'='
name|'FakeApp'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'bulk'
op|'='
name|'bulk'
op|'.'
name|'filter_factory'
op|'('
op|'{'
op|'}'
op|')'
op|'('
name|'self'
op|'.'
name|'app'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'testdir'
op|'='
name|'mkdtemp'
op|'('
name|'suffix'
op|'='
string|"'tmp_test_bulk'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|tearDown
dedent|''
name|'def'
name|'tearDown'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'app'
op|'.'
name|'calls'
op|'='
number|'0'
newline|'\n'
name|'rmtree'
op|'('
name|'self'
op|'.'
name|'testdir'
op|','
name|'ignore_errors'
op|'='
number|'1'
op|')'
newline|'\n'
nl|'\n'
DECL|member|handle_extract_and_iter
dedent|''
name|'def'
name|'handle_extract_and_iter'
op|'('
name|'self'
op|','
name|'req'
op|','
name|'compress_format'
op|','
nl|'\n'
name|'out_content_type'
op|'='
string|"'application/json'"
op|')'
op|':'
newline|'\n'
indent|'        '
name|'resp_body'
op|'='
string|"''"
op|'.'
name|'join'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'bulk'
op|'.'
name|'handle_extract_iter'
op|'('
name|'req'
op|','
name|'compress_format'
op|','
nl|'\n'
name|'out_content_type'
op|'='
name|'out_content_type'
op|')'
op|')'
newline|'\n'
name|'return'
name|'resp_body'
newline|'\n'
nl|'\n'
DECL|member|test_create_container_for_path
dedent|''
name|'def'
name|'test_create_container_for_path'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'bulk'
op|'.'
name|'create_container'
op|'('
name|'req'
op|','
string|"'/create_cont/acc/cont'"
op|')'
op|','
nl|'\n'
name|'True'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'self'
op|'.'
name|'app'
op|'.'
name|'calls'
op|','
number|'2'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
nl|'\n'
name|'bulk'
op|'.'
name|'CreateContainerError'
op|','
nl|'\n'
name|'self'
op|'.'
name|'bulk'
op|'.'
name|'create_container'
op|','
nl|'\n'
name|'req'
op|','
string|"'/create_cont_fail/acc/cont'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'self'
op|'.'
name|'app'
op|'.'
name|'calls'
op|','
number|'3'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_extract_tar_works
dedent|''
name|'def'
name|'test_extract_tar_works'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# On systems where $TMPDIR is long (like OS X), we need to do this'
nl|'\n'
comment|'# or else every upload will fail due to the path being too long.'
nl|'\n'
indent|'        '
name|'self'
op|'.'
name|'app'
op|'.'
name|'max_pathlen'
op|'+='
name|'len'
op|'('
name|'self'
op|'.'
name|'testdir'
op|')'
newline|'\n'
name|'for'
name|'compress_format'
name|'in'
op|'['
string|"''"
op|','
string|"'gz'"
op|','
string|"'bz2'"
op|']'
op|':'
newline|'\n'
indent|'            '
name|'base_name'
op|'='
string|"'base_works_%s'"
op|'%'
name|'compress_format'
newline|'\n'
name|'dir_tree'
op|'='
op|'['
nl|'\n'
op|'{'
name|'base_name'
op|':'
op|'['
op|'{'
string|"'sub_dir1'"
op|':'
op|'['
string|"'sub1_file1'"
op|','
string|"'sub1_file2'"
op|']'
op|'}'
op|','
nl|'\n'
op|'{'
string|"'sub_dir2'"
op|':'
op|'['
string|"'sub2_file1'"
op|','
string|"u'test obj \\u2661'"
op|']'
op|'}'
op|','
nl|'\n'
string|"'sub_file1'"
op|','
nl|'\n'
op|'{'
string|"'sub_dir3'"
op|':'
op|'['
op|'{'
string|"'sub4_dir1'"
op|':'
string|"'../sub4 file1'"
op|'}'
op|']'
op|'}'
op|','
nl|'\n'
op|'{'
string|"'sub_dir4'"
op|':'
name|'None'
op|'}'
op|','
nl|'\n'
op|']'
op|'}'
op|']'
newline|'\n'
nl|'\n'
name|'build_dir_tree'
op|'('
name|'self'
op|'.'
name|'testdir'
op|','
name|'dir_tree'
op|')'
newline|'\n'
name|'mode'
op|'='
string|"'w'"
newline|'\n'
name|'extension'
op|'='
string|"''"
newline|'\n'
name|'if'
name|'compress_format'
op|':'
newline|'\n'
indent|'                '
name|'mode'
op|'+='
string|"':'"
op|'+'
name|'compress_format'
newline|'\n'
name|'extension'
op|'+='
string|"'.'"
op|'+'
name|'compress_format'
newline|'\n'
dedent|''
name|'tar'
op|'='
name|'tarfile'
op|'.'
name|'open'
op|'('
name|'name'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'self'
op|'.'
name|'testdir'
op|','
nl|'\n'
string|"'tar_works.tar'"
op|'+'
name|'extension'
op|')'
op|','
nl|'\n'
name|'mode'
op|'='
name|'mode'
op|')'
newline|'\n'
name|'tar'
op|'.'
name|'add'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'self'
op|'.'
name|'testdir'
op|','
name|'base_name'
op|')'
op|')'
newline|'\n'
name|'tar'
op|'.'
name|'close'
op|'('
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/tar_works/acc/cont/'"
op|')'
newline|'\n'
name|'req'
op|'.'
name|'environ'
op|'['
string|"'wsgi.input'"
op|']'
op|'='
name|'open'
op|'('
nl|'\n'
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'self'
op|'.'
name|'testdir'
op|','
string|"'tar_works.tar'"
op|'+'
name|'extension'
op|')'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'headers'
op|'['
string|"'transfer-encoding'"
op|']'
op|'='
string|"'chunked'"
newline|'\n'
name|'resp_body'
op|'='
name|'self'
op|'.'
name|'handle_extract_and_iter'
op|'('
name|'req'
op|','
name|'compress_format'
op|')'
newline|'\n'
name|'resp_data'
op|'='
name|'utils'
op|'.'
name|'json'
op|'.'
name|'loads'
op|'('
name|'resp_body'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp_data'
op|'['
string|"'Number Files Created'"
op|']'
op|','
number|'6'
op|')'
newline|'\n'
nl|'\n'
comment|'# test out xml'
nl|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/tar_works/acc/cont/'"
op|')'
newline|'\n'
name|'req'
op|'.'
name|'environ'
op|'['
string|"'wsgi.input'"
op|']'
op|'='
name|'open'
op|'('
nl|'\n'
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'self'
op|'.'
name|'testdir'
op|','
string|"'tar_works.tar'"
op|'+'
name|'extension'
op|')'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'headers'
op|'['
string|"'transfer-encoding'"
op|']'
op|'='
string|"'chunked'"
newline|'\n'
name|'resp_body'
op|'='
name|'self'
op|'.'
name|'handle_extract_and_iter'
op|'('
nl|'\n'
name|'req'
op|','
name|'compress_format'
op|','
string|"'application/xml'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
nl|'\n'
string|"'<response_status>201 Created</response_status>'"
name|'in'
nl|'\n'
name|'resp_body'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
nl|'\n'
string|"'<number_files_created>6</number_files_created>'"
name|'in'
nl|'\n'
name|'resp_body'
op|')'
newline|'\n'
nl|'\n'
comment|'# test out nonexistent format'
nl|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/tar_works/acc/cont/?extract-archive=tar'"
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'Accept'"
op|':'
string|"'good_xml'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'environ'
op|'['
string|"'REQUEST_METHOD'"
op|']'
op|'='
string|"'PUT'"
newline|'\n'
name|'req'
op|'.'
name|'environ'
op|'['
string|"'wsgi.input'"
op|']'
op|'='
name|'open'
op|'('
nl|'\n'
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'self'
op|'.'
name|'testdir'
op|','
string|"'tar_works.tar'"
op|'+'
name|'extension'
op|')'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'headers'
op|'['
string|"'transfer-encoding'"
op|']'
op|'='
string|"'chunked'"
newline|'\n'
nl|'\n'
DECL|function|fake_start_response
name|'def'
name|'fake_start_response'
op|'('
op|'*'
name|'args'
op|','
op|'**'
name|'kwargs'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'pass'
newline|'\n'
nl|'\n'
dedent|''
name|'app_iter'
op|'='
name|'self'
op|'.'
name|'bulk'
op|'('
name|'req'
op|'.'
name|'environ'
op|','
name|'fake_start_response'
op|')'
newline|'\n'
name|'resp_body'
op|'='
string|"''"
op|'.'
name|'join'
op|'('
op|'['
name|'i'
name|'for'
name|'i'
name|'in'
name|'app_iter'
op|']'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
string|"'Response Status: 406'"
name|'in'
name|'resp_body'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_extract_call
dedent|''
dedent|''
name|'def'
name|'test_extract_call'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'base_name'
op|'='
string|"'base_works_gz'"
newline|'\n'
name|'dir_tree'
op|'='
op|'['
nl|'\n'
op|'{'
name|'base_name'
op|':'
op|'['
op|'{'
string|"'sub_dir1'"
op|':'
op|'['
string|"'sub1_file1'"
op|','
string|"'sub1_file2'"
op|']'
op|'}'
op|','
nl|'\n'
op|'{'
string|"'sub_dir2'"
op|':'
op|'['
string|"'sub2_file1'"
op|','
string|"'sub2_file2'"
op|']'
op|'}'
op|','
nl|'\n'
string|"'sub_file1'"
op|','
nl|'\n'
op|'{'
string|"'sub_dir3'"
op|':'
op|'['
op|'{'
string|"'sub4_dir1'"
op|':'
string|"'sub4_file1'"
op|'}'
op|']'
op|'}'
op|']'
op|'}'
op|']'
newline|'\n'
name|'build_dir_tree'
op|'('
name|'self'
op|'.'
name|'testdir'
op|','
name|'dir_tree'
op|')'
newline|'\n'
name|'tar'
op|'='
name|'tarfile'
op|'.'
name|'open'
op|'('
name|'name'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'self'
op|'.'
name|'testdir'
op|','
nl|'\n'
string|"'tar_works.tar.gz'"
op|')'
op|','
nl|'\n'
name|'mode'
op|'='
string|"'w:gz'"
op|')'
newline|'\n'
name|'tar'
op|'.'
name|'add'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'self'
op|'.'
name|'testdir'
op|','
name|'base_name'
op|')'
op|')'
newline|'\n'
name|'tar'
op|'.'
name|'close'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|function|fake_start_response
name|'def'
name|'fake_start_response'
op|'('
op|'*'
name|'args'
op|','
op|'**'
name|'kwargs'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'pass'
newline|'\n'
nl|'\n'
dedent|''
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/tar_works/acc/cont/?extract-archive=tar.gz'"
op|')'
newline|'\n'
name|'req'
op|'.'
name|'environ'
op|'['
string|"'wsgi.input'"
op|']'
op|'='
name|'open'
op|'('
nl|'\n'
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'self'
op|'.'
name|'testdir'
op|','
string|"'tar_works.tar.gz'"
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'bulk'
op|'('
name|'req'
op|'.'
name|'environ'
op|','
name|'fake_start_response'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'self'
op|'.'
name|'app'
op|'.'
name|'calls'
op|','
number|'1'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'app'
op|'.'
name|'calls'
op|'='
number|'0'
newline|'\n'
name|'req'
op|'.'
name|'environ'
op|'['
string|"'wsgi.input'"
op|']'
op|'='
name|'open'
op|'('
nl|'\n'
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'self'
op|'.'
name|'testdir'
op|','
string|"'tar_works.tar.gz'"
op|')'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'headers'
op|'['
string|"'transfer-encoding'"
op|']'
op|'='
string|"'Chunked'"
newline|'\n'
name|'req'
op|'.'
name|'method'
op|'='
string|"'PUT'"
newline|'\n'
name|'app_iter'
op|'='
name|'self'
op|'.'
name|'bulk'
op|'('
name|'req'
op|'.'
name|'environ'
op|','
name|'fake_start_response'
op|')'
newline|'\n'
name|'list'
op|'('
name|'app_iter'
op|')'
comment|'# iter over resp'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'self'
op|'.'
name|'app'
op|'.'
name|'calls'
op|','
number|'7'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'app'
op|'.'
name|'calls'
op|'='
number|'0'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/tar_works/acc/cont/?extract-archive=bad'"
op|')'
newline|'\n'
name|'req'
op|'.'
name|'method'
op|'='
string|"'PUT'"
newline|'\n'
name|'req'
op|'.'
name|'headers'
op|'['
string|"'transfer-encoding'"
op|']'
op|'='
string|"'Chunked'"
newline|'\n'
name|'req'
op|'.'
name|'environ'
op|'['
string|"'wsgi.input'"
op|']'
op|'='
name|'open'
op|'('
nl|'\n'
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'self'
op|'.'
name|'testdir'
op|','
string|"'tar_works.tar.gz'"
op|')'
op|')'
newline|'\n'
name|'t'
op|'='
name|'self'
op|'.'
name|'bulk'
op|'('
name|'req'
op|'.'
name|'environ'
op|','
name|'fake_start_response'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'t'
op|'['
number|'0'
op|']'
op|','
string|'"Unsupported archive format"'
op|')'
newline|'\n'
nl|'\n'
name|'tar'
op|'='
name|'tarfile'
op|'.'
name|'open'
op|'('
name|'name'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'self'
op|'.'
name|'testdir'
op|','
nl|'\n'
string|"'tar_works.tar'"
op|')'
op|','
nl|'\n'
name|'mode'
op|'='
string|"'w'"
op|')'
newline|'\n'
name|'tar'
op|'.'
name|'add'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'self'
op|'.'
name|'testdir'
op|','
name|'base_name'
op|')'
op|')'
newline|'\n'
name|'tar'
op|'.'
name|'close'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'app'
op|'.'
name|'calls'
op|'='
number|'0'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/tar_works/acc/cont/?extract-archive=tar'"
op|')'
newline|'\n'
name|'req'
op|'.'
name|'method'
op|'='
string|"'PUT'"
newline|'\n'
name|'req'
op|'.'
name|'headers'
op|'['
string|"'transfer-encoding'"
op|']'
op|'='
string|"'Chunked'"
newline|'\n'
name|'req'
op|'.'
name|'environ'
op|'['
string|"'wsgi.input'"
op|']'
op|'='
name|'open'
op|'('
nl|'\n'
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'self'
op|'.'
name|'testdir'
op|','
string|"'tar_works.tar'"
op|')'
op|')'
newline|'\n'
name|'app_iter'
op|'='
name|'self'
op|'.'
name|'bulk'
op|'('
name|'req'
op|'.'
name|'environ'
op|','
name|'fake_start_response'
op|')'
newline|'\n'
name|'list'
op|'('
name|'app_iter'
op|')'
comment|'# iter over resp'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'self'
op|'.'
name|'app'
op|'.'
name|'calls'
op|','
number|'7'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_bad_container
dedent|''
name|'def'
name|'test_bad_container'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/invalid/'"
op|','
name|'body'
op|'='
string|"''"
op|')'
newline|'\n'
name|'resp_body'
op|'='
name|'self'
op|'.'
name|'handle_extract_and_iter'
op|'('
name|'req'
op|','
string|"''"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
string|"'404 Not Found'"
name|'in'
name|'resp_body'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_content_length_required
dedent|''
name|'def'
name|'test_content_length_required'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/create_cont_fail/acc/cont'"
op|')'
newline|'\n'
name|'resp_body'
op|'='
name|'self'
op|'.'
name|'handle_extract_and_iter'
op|'('
name|'req'
op|','
string|"''"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
string|"'411 Length Required'"
name|'in'
name|'resp_body'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_bad_tar
dedent|''
name|'def'
name|'test_bad_tar'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/create_cont_fail/acc/cont'"
op|','
name|'body'
op|'='
string|"''"
op|')'
newline|'\n'
nl|'\n'
DECL|function|bad_open
name|'def'
name|'bad_open'
op|'('
op|'*'
name|'args'
op|','
op|'**'
name|'kwargs'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'zlib'
op|'.'
name|'error'
op|'('
string|"'bad tar'"
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'with'
name|'patch'
op|'.'
name|'object'
op|'('
name|'tarfile'
op|','
string|"'open'"
op|','
name|'bad_open'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'resp_body'
op|'='
name|'self'
op|'.'
name|'handle_extract_and_iter'
op|'('
name|'req'
op|','
string|"''"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
string|"'400 Bad Request'"
name|'in'
name|'resp_body'
op|')'
newline|'\n'
nl|'\n'
DECL|member|build_tar
dedent|''
dedent|''
name|'def'
name|'build_tar'
op|'('
name|'self'
op|','
name|'dir_tree'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'not'
name|'dir_tree'
op|':'
newline|'\n'
indent|'            '
name|'dir_tree'
op|'='
op|'['
nl|'\n'
op|'{'
string|"'base_fails1'"
op|':'
op|'['
op|'{'
string|"'sub_dir1'"
op|':'
op|'['
string|"'sub1_file1'"
op|']'
op|'}'
op|','
nl|'\n'
op|'{'
string|"'sub_dir2'"
op|':'
op|'['
string|"'sub2_file1'"
op|','
string|"'sub2_file2'"
op|']'
op|'}'
op|','
nl|'\n'
string|"'f'"
op|'*'
number|'101'
op|','
nl|'\n'
op|'{'
string|"'sub_dir3'"
op|':'
op|'['
op|'{'
string|"'sub4_dir1'"
op|':'
string|"'sub4_file1'"
op|'}'
op|']'
op|'}'
op|']'
op|'}'
op|']'
newline|'\n'
dedent|''
name|'tar'
op|'='
name|'tarfile'
op|'.'
name|'open'
op|'('
name|'name'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'self'
op|'.'
name|'testdir'
op|','
string|"'tar_fails.tar'"
op|')'
op|','
nl|'\n'
name|'mode'
op|'='
string|"'w'"
op|')'
newline|'\n'
name|'build_tar_tree'
op|'('
name|'tar'
op|','
name|'self'
op|'.'
name|'testdir'
op|','
name|'dir_tree'
op|','
nl|'\n'
name|'base_path'
op|'='
name|'self'
op|'.'
name|'testdir'
op|'+'
string|"'/'"
op|')'
newline|'\n'
name|'tar'
op|'.'
name|'close'
op|'('
op|')'
newline|'\n'
name|'return'
name|'tar'
newline|'\n'
nl|'\n'
DECL|member|test_extract_tar_with_basefile
dedent|''
name|'def'
name|'test_extract_tar_with_basefile'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'dir_tree'
op|'='
op|'['
nl|'\n'
string|"'base_lvl_file'"
op|','
string|"'another_base_file'"
op|','
nl|'\n'
op|'{'
string|"'base_fails1'"
op|':'
op|'['
op|'{'
string|"'sub_dir1'"
op|':'
op|'['
string|"'sub1_file1'"
op|']'
op|'}'
op|','
nl|'\n'
op|'{'
string|"'sub_dir2'"
op|':'
op|'['
string|"'sub2_file1'"
op|','
string|"'sub2_file2'"
op|']'
op|'}'
op|','
nl|'\n'
op|'{'
string|"'sub_dir3'"
op|':'
op|'['
op|'{'
string|"'sub4_dir1'"
op|':'
string|"'sub4_file1'"
op|'}'
op|']'
op|'}'
op|']'
op|'}'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'build_tar'
op|'('
name|'dir_tree'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/tar_works/acc/'"
op|')'
newline|'\n'
name|'req'
op|'.'
name|'environ'
op|'['
string|"'wsgi.input'"
op|']'
op|'='
name|'open'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'self'
op|'.'
name|'testdir'
op|','
nl|'\n'
string|"'tar_fails.tar'"
op|')'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'headers'
op|'['
string|"'transfer-encoding'"
op|']'
op|'='
string|"'chunked'"
newline|'\n'
name|'resp_body'
op|'='
name|'self'
op|'.'
name|'handle_extract_and_iter'
op|'('
name|'req'
op|','
string|"''"
op|')'
newline|'\n'
name|'resp_data'
op|'='
name|'utils'
op|'.'
name|'json'
op|'.'
name|'loads'
op|'('
name|'resp_body'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp_data'
op|'['
string|"'Number Files Created'"
op|']'
op|','
number|'4'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_extract_tar_fail_cont_401
dedent|''
name|'def'
name|'test_extract_tar_fail_cont_401'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'build_tar'
op|'('
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/unauth/acc/'"
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'Accept'"
op|':'
string|"'application/json'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'environ'
op|'['
string|"'wsgi.input'"
op|']'
op|'='
name|'open'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'self'
op|'.'
name|'testdir'
op|','
nl|'\n'
string|"'tar_fails.tar'"
op|')'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'headers'
op|'['
string|"'transfer-encoding'"
op|']'
op|'='
string|"'chunked'"
newline|'\n'
name|'resp_body'
op|'='
name|'self'
op|'.'
name|'handle_extract_and_iter'
op|'('
name|'req'
op|','
string|"''"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'self'
op|'.'
name|'app'
op|'.'
name|'calls'
op|','
number|'1'
op|')'
newline|'\n'
name|'resp_data'
op|'='
name|'utils'
op|'.'
name|'json'
op|'.'
name|'loads'
op|'('
name|'resp_body'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp_data'
op|'['
string|"'Response Status'"
op|']'
op|','
string|"'401 Unauthorized'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp_data'
op|'['
string|"'Errors'"
op|']'
op|','
op|'['
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_extract_tar_fail_obj_401
dedent|''
name|'def'
name|'test_extract_tar_fail_obj_401'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'build_tar'
op|'('
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/create_obj_unauth/acc/cont/'"
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'Accept'"
op|':'
string|"'application/json'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'environ'
op|'['
string|"'wsgi.input'"
op|']'
op|'='
name|'open'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'self'
op|'.'
name|'testdir'
op|','
nl|'\n'
string|"'tar_fails.tar'"
op|')'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'headers'
op|'['
string|"'transfer-encoding'"
op|']'
op|'='
string|"'chunked'"
newline|'\n'
name|'resp_body'
op|'='
name|'self'
op|'.'
name|'handle_extract_and_iter'
op|'('
name|'req'
op|','
string|"''"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'self'
op|'.'
name|'app'
op|'.'
name|'calls'
op|','
number|'2'
op|')'
newline|'\n'
name|'resp_data'
op|'='
name|'utils'
op|'.'
name|'json'
op|'.'
name|'loads'
op|'('
name|'resp_body'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp_data'
op|'['
string|"'Response Status'"
op|']'
op|','
string|"'401 Unauthorized'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
nl|'\n'
name|'resp_data'
op|'['
string|"'Errors'"
op|']'
op|','
nl|'\n'
op|'['
op|'['
string|"'cont/base_fails1/sub_dir1/sub1_file1'"
op|','
string|"'401 Unauthorized'"
op|']'
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_extract_tar_fail_obj_name_len
dedent|''
name|'def'
name|'test_extract_tar_fail_obj_name_len'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'build_tar'
op|'('
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/tar_works/acc/cont/'"
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'Accept'"
op|':'
string|"'application/json'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'environ'
op|'['
string|"'wsgi.input'"
op|']'
op|'='
name|'open'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'self'
op|'.'
name|'testdir'
op|','
nl|'\n'
string|"'tar_fails.tar'"
op|')'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'headers'
op|'['
string|"'transfer-encoding'"
op|']'
op|'='
string|"'chunked'"
newline|'\n'
name|'resp_body'
op|'='
name|'self'
op|'.'
name|'handle_extract_and_iter'
op|'('
name|'req'
op|','
string|"''"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'self'
op|'.'
name|'app'
op|'.'
name|'calls'
op|','
number|'6'
op|')'
newline|'\n'
name|'resp_data'
op|'='
name|'utils'
op|'.'
name|'json'
op|'.'
name|'loads'
op|'('
name|'resp_body'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp_data'
op|'['
string|"'Number Files Created'"
op|']'
op|','
number|'4'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
nl|'\n'
name|'resp_data'
op|'['
string|"'Errors'"
op|']'
op|','
nl|'\n'
op|'['
op|'['
string|"'cont/base_fails1/'"
op|'+'
op|'('
string|"'f'"
op|'*'
number|'101'
op|')'
op|','
string|"'400 Bad Request'"
op|']'
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_extract_tar_fail_compress_type
dedent|''
name|'def'
name|'test_extract_tar_fail_compress_type'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'build_tar'
op|'('
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/tar_works/acc/cont/'"
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'Accept'"
op|':'
string|"'application/json'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'environ'
op|'['
string|"'wsgi.input'"
op|']'
op|'='
name|'open'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'self'
op|'.'
name|'testdir'
op|','
nl|'\n'
string|"'tar_fails.tar'"
op|')'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'headers'
op|'['
string|"'transfer-encoding'"
op|']'
op|'='
string|"'chunked'"
newline|'\n'
name|'resp_body'
op|'='
name|'self'
op|'.'
name|'handle_extract_and_iter'
op|'('
name|'req'
op|','
string|"'gz'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'self'
op|'.'
name|'app'
op|'.'
name|'calls'
op|','
number|'0'
op|')'
newline|'\n'
name|'resp_data'
op|'='
name|'utils'
op|'.'
name|'json'
op|'.'
name|'loads'
op|'('
name|'resp_body'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp_data'
op|'['
string|"'Response Status'"
op|']'
op|','
string|"'400 Bad Request'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
nl|'\n'
name|'resp_data'
op|'['
string|"'Response Body'"
op|']'
op|'.'
name|'lower'
op|'('
op|')'
op|','
nl|'\n'
string|"'invalid tar file: not a gzip file'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_extract_tar_fail_max_failed_extractions
dedent|''
name|'def'
name|'test_extract_tar_fail_max_failed_extractions'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'build_tar'
op|'('
op|')'
newline|'\n'
name|'with'
name|'patch'
op|'.'
name|'object'
op|'('
name|'self'
op|'.'
name|'bulk'
op|','
string|"'max_failed_extractions'"
op|','
number|'1'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'app'
op|'.'
name|'calls'
op|'='
number|'0'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/tar_works/acc/cont/'"
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'Accept'"
op|':'
string|"'application/json'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'environ'
op|'['
string|"'wsgi.input'"
op|']'
op|'='
name|'open'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'self'
op|'.'
name|'testdir'
op|','
nl|'\n'
string|"'tar_fails.tar'"
op|')'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'headers'
op|'['
string|"'transfer-encoding'"
op|']'
op|'='
string|"'chunked'"
newline|'\n'
name|'resp_body'
op|'='
name|'self'
op|'.'
name|'handle_extract_and_iter'
op|'('
name|'req'
op|','
string|"''"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'self'
op|'.'
name|'app'
op|'.'
name|'calls'
op|','
number|'5'
op|')'
newline|'\n'
name|'resp_data'
op|'='
name|'utils'
op|'.'
name|'json'
op|'.'
name|'loads'
op|'('
name|'resp_body'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp_data'
op|'['
string|"'Number Files Created'"
op|']'
op|','
number|'3'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
nl|'\n'
name|'resp_data'
op|'['
string|"'Errors'"
op|']'
op|','
nl|'\n'
op|'['
op|'['
string|"'cont/base_fails1/'"
op|'+'
op|'('
string|"'f'"
op|'*'
number|'101'
op|')'
op|','
string|"'400 Bad Request'"
op|']'
op|']'
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
op|'@'
name|'patch'
op|'.'
name|'object'
op|'('
name|'constraints'
op|','
string|"'MAX_FILE_SIZE'"
op|','
number|'4'
op|')'
newline|'\n'
DECL|member|test_extract_tar_fail_max_file_size
name|'def'
name|'test_extract_tar_fail_max_file_size'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'tar'
op|'='
name|'self'
op|'.'
name|'build_tar'
op|'('
op|')'
newline|'\n'
name|'dir_tree'
op|'='
op|'['
op|'{'
string|"'test'"
op|':'
op|'['
op|'{'
string|"'sub_dir1'"
op|':'
op|'['
string|"'sub1_file1'"
op|']'
op|'}'
op|']'
op|'}'
op|']'
newline|'\n'
name|'build_dir_tree'
op|'('
name|'self'
op|'.'
name|'testdir'
op|','
name|'dir_tree'
op|')'
newline|'\n'
name|'tar'
op|'='
name|'tarfile'
op|'.'
name|'open'
op|'('
name|'name'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'self'
op|'.'
name|'testdir'
op|','
nl|'\n'
string|"'tar_works.tar'"
op|')'
op|','
nl|'\n'
name|'mode'
op|'='
string|"'w'"
op|')'
newline|'\n'
name|'tar'
op|'.'
name|'add'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'self'
op|'.'
name|'testdir'
op|','
string|"'test'"
op|')'
op|')'
newline|'\n'
name|'tar'
op|'.'
name|'close'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'app'
op|'.'
name|'calls'
op|'='
number|'0'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/tar_works/acc/cont/'"
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'Accept'"
op|':'
string|"'application/json'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'environ'
op|'['
string|"'wsgi.input'"
op|']'
op|'='
name|'open'
op|'('
nl|'\n'
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'self'
op|'.'
name|'testdir'
op|','
string|"'tar_works.tar'"
op|')'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'headers'
op|'['
string|"'transfer-encoding'"
op|']'
op|'='
string|"'chunked'"
newline|'\n'
name|'resp_body'
op|'='
name|'self'
op|'.'
name|'handle_extract_and_iter'
op|'('
name|'req'
op|','
string|"''"
op|')'
newline|'\n'
name|'resp_data'
op|'='
name|'utils'
op|'.'
name|'json'
op|'.'
name|'loads'
op|'('
name|'resp_body'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
nl|'\n'
name|'resp_data'
op|'['
string|"'Errors'"
op|']'
op|','
nl|'\n'
op|'['
op|'['
string|"'cont'"
op|'+'
name|'self'
op|'.'
name|'testdir'
op|'+'
string|"'/test/sub_dir1/sub1_file1'"
op|','
nl|'\n'
string|"'413 Request Entity Too Large'"
op|']'
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_extract_tar_fail_max_cont
dedent|''
name|'def'
name|'test_extract_tar_fail_max_cont'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'dir_tree'
op|'='
op|'['
op|'{'
string|"'sub_dir1'"
op|':'
op|'['
string|"'sub1_file1'"
op|']'
op|'}'
op|','
nl|'\n'
op|'{'
string|"'sub_dir2'"
op|':'
op|'['
string|"'sub2_file1'"
op|','
string|"'sub2_file2'"
op|']'
op|'}'
op|','
nl|'\n'
string|"'f'"
op|'*'
number|'101'
op|','
nl|'\n'
op|'{'
string|"'sub_dir3'"
op|':'
op|'['
op|'{'
string|"'sub4_dir1'"
op|':'
string|"'sub4_file1'"
op|'}'
op|']'
op|'}'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'build_tar'
op|'('
name|'dir_tree'
op|')'
newline|'\n'
name|'with'
name|'patch'
op|'.'
name|'object'
op|'('
name|'self'
op|'.'
name|'bulk'
op|','
string|"'max_containers'"
op|','
number|'1'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'app'
op|'.'
name|'calls'
op|'='
number|'0'
newline|'\n'
name|'body'
op|'='
name|'open'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'self'
op|'.'
name|'testdir'
op|','
string|"'tar_fails.tar'"
op|')'
op|')'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/tar_works_cont_head_fail/acc/'"
op|','
name|'body'
op|'='
name|'body'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'Accept'"
op|':'
string|"'application/json'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'headers'
op|'['
string|"'transfer-encoding'"
op|']'
op|'='
string|"'chunked'"
newline|'\n'
name|'resp_body'
op|'='
name|'self'
op|'.'
name|'handle_extract_and_iter'
op|'('
name|'req'
op|','
string|"''"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'self'
op|'.'
name|'app'
op|'.'
name|'calls'
op|','
number|'5'
op|')'
newline|'\n'
name|'resp_data'
op|'='
name|'utils'
op|'.'
name|'json'
op|'.'
name|'loads'
op|'('
name|'resp_body'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp_data'
op|'['
string|"'Response Status'"
op|']'
op|','
string|"'400 Bad Request'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
nl|'\n'
name|'resp_data'
op|'['
string|"'Response Body'"
op|']'
op|','
nl|'\n'
string|"'More than 1 containers to create from tar.'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_extract_tar_fail_create_cont
dedent|''
dedent|''
name|'def'
name|'test_extract_tar_fail_create_cont'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'dir_tree'
op|'='
op|'['
op|'{'
string|"'base_fails1'"
op|':'
op|'['
nl|'\n'
op|'{'
string|"'sub_dir1'"
op|':'
op|'['
string|"'sub1_file1'"
op|']'
op|'}'
op|','
nl|'\n'
op|'{'
string|"'sub_dir2'"
op|':'
op|'['
string|"'sub2_file1'"
op|','
string|"'sub2_file2'"
op|']'
op|'}'
op|','
nl|'\n'
op|'{'
string|"'./sub_dir3'"
op|':'
op|'['
op|'{'
string|"'sub4_dir1'"
op|':'
string|"'sub4_file1'"
op|'}'
op|']'
op|'}'
op|']'
op|'}'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'build_tar'
op|'('
name|'dir_tree'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/create_cont_fail/acc/cont/'"
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'Accept'"
op|':'
string|"'application/json'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'environ'
op|'['
string|"'wsgi.input'"
op|']'
op|'='
name|'open'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'self'
op|'.'
name|'testdir'
op|','
nl|'\n'
string|"'tar_fails.tar'"
op|')'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'headers'
op|'['
string|"'transfer-encoding'"
op|']'
op|'='
string|"'chunked'"
newline|'\n'
name|'resp_body'
op|'='
name|'self'
op|'.'
name|'handle_extract_and_iter'
op|'('
name|'req'
op|','
string|"''"
op|')'
newline|'\n'
name|'resp_data'
op|'='
name|'utils'
op|'.'
name|'json'
op|'.'
name|'loads'
op|'('
name|'resp_body'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'self'
op|'.'
name|'app'
op|'.'
name|'calls'
op|','
number|'5'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'len'
op|'('
name|'resp_data'
op|'['
string|"'Errors'"
op|']'
op|')'
op|','
number|'5'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_extract_tar_fail_create_cont_value_err
dedent|''
name|'def'
name|'test_extract_tar_fail_create_cont_value_err'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'build_tar'
op|'('
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/create_cont_fail/acc/cont/'"
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'Accept'"
op|':'
string|"'application/json'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'environ'
op|'['
string|"'wsgi.input'"
op|']'
op|'='
name|'open'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'self'
op|'.'
name|'testdir'
op|','
nl|'\n'
string|"'tar_fails.tar'"
op|')'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'headers'
op|'['
string|"'transfer-encoding'"
op|']'
op|'='
string|"'chunked'"
newline|'\n'
nl|'\n'
DECL|function|bad_create
name|'def'
name|'bad_create'
op|'('
name|'req'
op|','
name|'path'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'ValueError'
op|'('
string|"'Test'"
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'with'
name|'patch'
op|'.'
name|'object'
op|'('
name|'self'
op|'.'
name|'bulk'
op|','
string|"'create_container'"
op|','
name|'bad_create'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'resp_body'
op|'='
name|'self'
op|'.'
name|'handle_extract_and_iter'
op|'('
name|'req'
op|','
string|"''"
op|')'
newline|'\n'
name|'resp_data'
op|'='
name|'utils'
op|'.'
name|'json'
op|'.'
name|'loads'
op|'('
name|'resp_body'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'self'
op|'.'
name|'app'
op|'.'
name|'calls'
op|','
number|'0'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'len'
op|'('
name|'resp_data'
op|'['
string|"'Errors'"
op|']'
op|')'
op|','
number|'5'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
nl|'\n'
name|'resp_data'
op|'['
string|"'Errors'"
op|']'
op|'['
number|'0'
op|']'
op|','
nl|'\n'
op|'['
string|"'cont/base_fails1/sub_dir1/sub1_file1'"
op|','
string|"'400 Bad Request'"
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_extract_tar_fail_unicode
dedent|''
dedent|''
name|'def'
name|'test_extract_tar_fail_unicode'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'dir_tree'
op|'='
op|'['
op|'{'
string|"'sub_dir1'"
op|':'
op|'['
string|"'sub1_file1'"
op|']'
op|'}'
op|','
nl|'\n'
op|'{'
string|"'sub_dir2'"
op|':'
op|'['
string|"'sub2\\xdefile1'"
op|','
string|"'sub2_file2'"
op|']'
op|'}'
op|','
nl|'\n'
op|'{'
string|"'sub_\\xdedir3'"
op|':'
op|'['
op|'{'
string|"'sub4_dir1'"
op|':'
string|"'sub4_file1'"
op|'}'
op|']'
op|'}'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'build_tar'
op|'('
name|'dir_tree'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/tar_works/acc/'"
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'Accept'"
op|':'
string|"'application/json'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'environ'
op|'['
string|"'wsgi.input'"
op|']'
op|'='
name|'open'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'self'
op|'.'
name|'testdir'
op|','
nl|'\n'
string|"'tar_fails.tar'"
op|')'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'headers'
op|'['
string|"'transfer-encoding'"
op|']'
op|'='
string|"'chunked'"
newline|'\n'
name|'resp_body'
op|'='
name|'self'
op|'.'
name|'handle_extract_and_iter'
op|'('
name|'req'
op|','
string|"''"
op|')'
newline|'\n'
name|'resp_data'
op|'='
name|'utils'
op|'.'
name|'json'
op|'.'
name|'loads'
op|'('
name|'resp_body'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'self'
op|'.'
name|'app'
op|'.'
name|'calls'
op|','
number|'4'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp_data'
op|'['
string|"'Number Files Created'"
op|']'
op|','
number|'2'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp_data'
op|'['
string|"'Response Status'"
op|']'
op|','
string|"'400 Bad Request'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
nl|'\n'
name|'resp_data'
op|'['
string|"'Errors'"
op|']'
op|','
nl|'\n'
op|'['
op|'['
string|"'sub_dir2/sub2%DEfile1'"
op|','
string|"'412 Precondition Failed'"
op|']'
op|','
nl|'\n'
op|'['
string|"'sub_%DEdir3/sub4_dir1/sub4_file1'"
op|','
string|"'412 Precondition Failed'"
op|']'
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_response_body
dedent|''
name|'def'
name|'test_get_response_body'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'txt_body'
op|'='
name|'bulk'
op|'.'
name|'get_response_body'
op|'('
nl|'\n'
string|"'bad_formay'"
op|','
op|'{'
string|"'hey'"
op|':'
string|"'there'"
op|'}'
op|','
op|'['
op|'['
string|"'json > xml'"
op|','
string|"'202 Accepted'"
op|']'
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
string|"'hey: there'"
name|'in'
name|'txt_body'
op|')'
newline|'\n'
name|'xml_body'
op|'='
name|'bulk'
op|'.'
name|'get_response_body'
op|'('
nl|'\n'
string|"'text/xml'"
op|','
op|'{'
string|"'hey'"
op|':'
string|"'there'"
op|'}'
op|','
op|'['
op|'['
string|"'json > xml'"
op|','
string|"'202 Accepted'"
op|']'
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
string|"'&gt'"
name|'in'
name|'xml_body'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|TestDelete
dedent|''
dedent|''
name|'class'
name|'TestDelete'
op|'('
name|'unittest'
op|'.'
name|'TestCase'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|member|setUp
indent|'    '
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'app'
op|'='
name|'FakeApp'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'bulk'
op|'='
name|'bulk'
op|'.'
name|'filter_factory'
op|'('
op|'{'
op|'}'
op|')'
op|'('
name|'self'
op|'.'
name|'app'
op|')'
newline|'\n'
nl|'\n'
DECL|member|tearDown
dedent|''
name|'def'
name|'tearDown'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'app'
op|'.'
name|'calls'
op|'='
number|'0'
newline|'\n'
name|'self'
op|'.'
name|'app'
op|'.'
name|'delete_paths'
op|'='
op|'['
op|']'
newline|'\n'
nl|'\n'
DECL|member|handle_delete_and_iter
dedent|''
name|'def'
name|'handle_delete_and_iter'
op|'('
name|'self'
op|','
name|'req'
op|','
name|'out_content_type'
op|'='
string|"'application/json'"
op|')'
op|':'
newline|'\n'
indent|'        '
name|'resp_body'
op|'='
string|"''"
op|'.'
name|'join'
op|'('
name|'self'
op|'.'
name|'bulk'
op|'.'
name|'handle_delete_iter'
op|'('
nl|'\n'
name|'req'
op|','
name|'out_content_type'
op|'='
name|'out_content_type'
op|')'
op|')'
newline|'\n'
name|'return'
name|'resp_body'
newline|'\n'
nl|'\n'
DECL|member|test_bulk_delete_uses_predefined_object_errors
dedent|''
name|'def'
name|'test_bulk_delete_uses_predefined_object_errors'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/delete_works/AUTH_Acc'"
op|')'
newline|'\n'
name|'objs_to_delete'
op|'='
op|'['
nl|'\n'
op|'{'
string|"'name'"
op|':'
string|"'/c/file_a'"
op|'}'
op|','
nl|'\n'
op|'{'
string|"'name'"
op|':'
string|"'/c/file_b'"
op|','
string|"'error'"
op|':'
op|'{'
string|"'code'"
op|':'
name|'HTTP_NOT_FOUND'
op|','
nl|'\n'
string|"'message'"
op|':'
string|"'not found'"
op|'}'
op|'}'
op|','
nl|'\n'
op|'{'
string|"'name'"
op|':'
string|"'/c/file_c'"
op|','
string|"'error'"
op|':'
op|'{'
string|"'code'"
op|':'
name|'HTTP_UNAUTHORIZED'
op|','
nl|'\n'
string|"'message'"
op|':'
string|"'unauthorized'"
op|'}'
op|'}'
op|','
nl|'\n'
op|'{'
string|"'name'"
op|':'
string|"'/c/file_d'"
op|'}'
op|']'
newline|'\n'
name|'resp_body'
op|'='
string|"''"
op|'.'
name|'join'
op|'('
name|'self'
op|'.'
name|'bulk'
op|'.'
name|'handle_delete_iter'
op|'('
nl|'\n'
name|'req'
op|','
name|'objs_to_delete'
op|'='
name|'objs_to_delete'
op|','
nl|'\n'
name|'out_content_type'
op|'='
string|"'application/json'"
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'app'
op|'.'
name|'delete_paths'
op|','
op|'['
string|"'/delete_works/AUTH_Acc/c/file_a'"
op|','
nl|'\n'
string|"'/delete_works/AUTH_Acc/c/file_d'"
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'self'
op|'.'
name|'app'
op|'.'
name|'calls'
op|','
number|'2'
op|')'
newline|'\n'
name|'resp_data'
op|'='
name|'utils'
op|'.'
name|'json'
op|'.'
name|'loads'
op|'('
name|'resp_body'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp_data'
op|'['
string|"'Response Status'"
op|']'
op|','
string|"'400 Bad Request'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp_data'
op|'['
string|"'Number Deleted'"
op|']'
op|','
number|'2'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp_data'
op|'['
string|"'Number Not Found'"
op|']'
op|','
number|'1'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp_data'
op|'['
string|"'Errors'"
op|']'
op|','
nl|'\n'
op|'['
op|'['
string|"'/c/file_c'"
op|','
string|"'unauthorized'"
op|']'
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_bulk_delete_works_with_POST_verb
dedent|''
name|'def'
name|'test_bulk_delete_works_with_POST_verb'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/delete_works/AUTH_Acc'"
op|','
name|'body'
op|'='
string|"'/c/f\\n/c/f404'"
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'Accept'"
op|':'
string|"'application/json'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'method'
op|'='
string|"'POST'"
newline|'\n'
name|'resp_body'
op|'='
name|'self'
op|'.'
name|'handle_delete_and_iter'
op|'('
name|'req'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'app'
op|'.'
name|'delete_paths'
op|','
nl|'\n'
op|'['
string|"'/delete_works/AUTH_Acc/c/f'"
op|','
string|"'/delete_works/AUTH_Acc/c/f404'"
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'self'
op|'.'
name|'app'
op|'.'
name|'calls'
op|','
number|'2'
op|')'
newline|'\n'
name|'resp_data'
op|'='
name|'utils'
op|'.'
name|'json'
op|'.'
name|'loads'
op|'('
name|'resp_body'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp_data'
op|'['
string|"'Number Deleted'"
op|']'
op|','
number|'1'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp_data'
op|'['
string|"'Number Not Found'"
op|']'
op|','
number|'1'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_bulk_delete_works_with_DELETE_verb
dedent|''
name|'def'
name|'test_bulk_delete_works_with_DELETE_verb'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/delete_works/AUTH_Acc'"
op|','
name|'body'
op|'='
string|"'/c/f\\n/c/f404'"
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'Accept'"
op|':'
string|"'application/json'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'method'
op|'='
string|"'DELETE'"
newline|'\n'
name|'resp_body'
op|'='
name|'self'
op|'.'
name|'handle_delete_and_iter'
op|'('
name|'req'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'app'
op|'.'
name|'delete_paths'
op|','
nl|'\n'
op|'['
string|"'/delete_works/AUTH_Acc/c/f'"
op|','
string|"'/delete_works/AUTH_Acc/c/f404'"
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'self'
op|'.'
name|'app'
op|'.'
name|'calls'
op|','
number|'2'
op|')'
newline|'\n'
name|'resp_data'
op|'='
name|'utils'
op|'.'
name|'json'
op|'.'
name|'loads'
op|'('
name|'resp_body'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp_data'
op|'['
string|"'Number Deleted'"
op|']'
op|','
number|'1'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp_data'
op|'['
string|"'Number Not Found'"
op|']'
op|','
number|'1'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_bulk_delete_bad_content_type
dedent|''
name|'def'
name|'test_bulk_delete_bad_content_type'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/delete_works/AUTH_Acc'"
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'Accept'"
op|':'
string|"'badformat'"
op|'}'
op|')'
newline|'\n'
nl|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/delete_works/AUTH_Acc'"
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'Accept'"
op|':'
string|"'application/json'"
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'text/xml'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'method'
op|'='
string|"'POST'"
newline|'\n'
name|'req'
op|'.'
name|'environ'
op|'['
string|"'wsgi.input'"
op|']'
op|'='
name|'BytesIO'
op|'('
string|"b'/c/f\\n/c/f404'"
op|')'
newline|'\n'
name|'resp_body'
op|'='
name|'self'
op|'.'
name|'handle_delete_and_iter'
op|'('
name|'req'
op|')'
newline|'\n'
name|'resp_data'
op|'='
name|'utils'
op|'.'
name|'json'
op|'.'
name|'loads'
op|'('
name|'resp_body'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp_data'
op|'['
string|"'Response Status'"
op|']'
op|','
string|"'406 Not Acceptable'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_bulk_delete_call_and_content_type
dedent|''
name|'def'
name|'test_bulk_delete_call_and_content_type'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
DECL|function|fake_start_response
indent|'        '
name|'def'
name|'fake_start_response'
op|'('
op|'*'
name|'args'
op|','
op|'**'
name|'kwargs'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'args'
op|'['
number|'1'
op|']'
op|'['
number|'0'
op|']'
op|','
op|'('
string|"'Content-Type'"
op|','
string|"'application/json'"
op|')'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/delete_works/AUTH_Acc?bulk-delete'"
op|')'
newline|'\n'
name|'req'
op|'.'
name|'method'
op|'='
string|"'POST'"
newline|'\n'
name|'req'
op|'.'
name|'headers'
op|'['
string|"'Transfer-Encoding'"
op|']'
op|'='
string|"'chunked'"
newline|'\n'
name|'req'
op|'.'
name|'headers'
op|'['
string|"'Accept'"
op|']'
op|'='
string|"'application/json'"
newline|'\n'
name|'req'
op|'.'
name|'environ'
op|'['
string|"'wsgi.input'"
op|']'
op|'='
name|'BytesIO'
op|'('
string|"b'/c/f%20'"
op|')'
newline|'\n'
name|'list'
op|'('
name|'self'
op|'.'
name|'bulk'
op|'('
name|'req'
op|'.'
name|'environ'
op|','
name|'fake_start_response'
op|')'
op|')'
comment|'# iterate over resp'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'app'
op|'.'
name|'delete_paths'
op|','
op|'['
string|"'/delete_works/AUTH_Acc/c/f '"
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'self'
op|'.'
name|'app'
op|'.'
name|'calls'
op|','
number|'1'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_bulk_delete_get_objs
dedent|''
name|'def'
name|'test_bulk_delete_get_objs'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/delete_works/AUTH_Acc'"
op|','
name|'body'
op|'='
string|"'1%20\\r\\n2\\r\\n'"
op|')'
newline|'\n'
name|'req'
op|'.'
name|'method'
op|'='
string|"'POST'"
newline|'\n'
name|'with'
name|'patch'
op|'.'
name|'object'
op|'('
name|'self'
op|'.'
name|'bulk'
op|','
string|"'max_deletes_per_request'"
op|','
number|'2'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'results'
op|'='
name|'self'
op|'.'
name|'bulk'
op|'.'
name|'get_objs_to_delete'
op|'('
name|'req'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'results'
op|','
op|'['
op|'{'
string|"'name'"
op|':'
string|"'1 '"
op|'}'
op|','
op|'{'
string|"'name'"
op|':'
string|"'2'"
op|'}'
op|']'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'with'
name|'patch'
op|'.'
name|'object'
op|'('
name|'self'
op|'.'
name|'bulk'
op|','
string|"'max_path_length'"
op|','
number|'2'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'results'
op|'='
op|'['
op|']'
newline|'\n'
name|'req'
op|'.'
name|'environ'
op|'['
string|"'wsgi.input'"
op|']'
op|'='
name|'BytesIO'
op|'('
string|"b'1\\n2\\n3'"
op|')'
newline|'\n'
name|'results'
op|'='
name|'self'
op|'.'
name|'bulk'
op|'.'
name|'get_objs_to_delete'
op|'('
name|'req'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'results'
op|','
nl|'\n'
op|'['
op|'{'
string|"'name'"
op|':'
string|"'1'"
op|'}'
op|','
op|'{'
string|"'name'"
op|':'
string|"'2'"
op|'}'
op|','
op|'{'
string|"'name'"
op|':'
string|"'3'"
op|'}'
op|']'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'with'
name|'patch'
op|'.'
name|'object'
op|'('
name|'self'
op|'.'
name|'bulk'
op|','
string|"'max_deletes_per_request'"
op|','
number|'9'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'with'
name|'patch'
op|'.'
name|'object'
op|'('
name|'self'
op|'.'
name|'bulk'
op|','
string|"'max_path_length'"
op|','
number|'1'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'req_body'
op|'='
string|"'\\n'"
op|'.'
name|'join'
op|'('
op|'['
name|'str'
op|'('
name|'i'
op|')'
name|'for'
name|'i'
name|'in'
name|'range'
op|'('
number|'10'
op|')'
op|']'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/delete_works/AUTH_Acc'"
op|','
name|'body'
op|'='
name|'req_body'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
nl|'\n'
name|'HTTPException'
op|','
name|'self'
op|'.'
name|'bulk'
op|'.'
name|'get_objs_to_delete'
op|','
name|'req'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_bulk_delete_works_extra_newlines_extra_quoting
dedent|''
dedent|''
dedent|''
name|'def'
name|'test_bulk_delete_works_extra_newlines_extra_quoting'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/delete_works/AUTH_Acc'"
op|','
nl|'\n'
name|'body'
op|'='
string|"'/c/f\\n\\n\\n/c/f404\\n\\n\\n/c/%2525'"
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'Accept'"
op|':'
string|"'application/json'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'method'
op|'='
string|"'POST'"
newline|'\n'
name|'resp_body'
op|'='
name|'self'
op|'.'
name|'handle_delete_and_iter'
op|'('
name|'req'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'app'
op|'.'
name|'delete_paths'
op|','
nl|'\n'
op|'['
string|"'/delete_works/AUTH_Acc/c/f'"
op|','
nl|'\n'
string|"'/delete_works/AUTH_Acc/c/f404'"
op|','
nl|'\n'
string|"'/delete_works/AUTH_Acc/c/%25'"
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'self'
op|'.'
name|'app'
op|'.'
name|'calls'
op|','
number|'3'
op|')'
newline|'\n'
name|'resp_data'
op|'='
name|'utils'
op|'.'
name|'json'
op|'.'
name|'loads'
op|'('
name|'resp_body'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp_data'
op|'['
string|"'Number Deleted'"
op|']'
op|','
number|'2'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp_data'
op|'['
string|"'Number Not Found'"
op|']'
op|','
number|'1'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_bulk_delete_too_many_newlines
dedent|''
name|'def'
name|'test_bulk_delete_too_many_newlines'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/delete_works/AUTH_Acc'"
op|')'
newline|'\n'
name|'req'
op|'.'
name|'method'
op|'='
string|"'POST'"
newline|'\n'
name|'data'
op|'='
string|"b'\\n\\n'"
op|'*'
name|'self'
op|'.'
name|'bulk'
op|'.'
name|'max_deletes_per_request'
newline|'\n'
name|'req'
op|'.'
name|'environ'
op|'['
string|"'wsgi.input'"
op|']'
op|'='
name|'BytesIO'
op|'('
name|'data'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'content_length'
op|'='
name|'len'
op|'('
name|'data'
op|')'
newline|'\n'
name|'resp_body'
op|'='
name|'self'
op|'.'
name|'handle_delete_and_iter'
op|'('
name|'req'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
string|"'413 Request Entity Too Large'"
name|'in'
name|'resp_body'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_bulk_delete_works_unicode
dedent|''
name|'def'
name|'test_bulk_delete_works_unicode'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'body'
op|'='
op|'('
string|"u'/c/ obj \\u2661\\r\\n'"
op|'.'
name|'encode'
op|'('
string|"'utf8'"
op|')'
op|'+'
nl|'\n'
string|"'c/ objbadutf8\\r\\n'"
op|'+'
nl|'\n'
string|"'/c/f\\xdebadutf8\\n'"
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/delete_works/AUTH_Acc'"
op|','
name|'body'
op|'='
name|'body'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'Accept'"
op|':'
string|"'application/json'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'method'
op|'='
string|"'POST'"
newline|'\n'
name|'resp_body'
op|'='
name|'self'
op|'.'
name|'handle_delete_and_iter'
op|'('
name|'req'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'app'
op|'.'
name|'delete_paths'
op|','
nl|'\n'
op|'['
string|"'/delete_works/AUTH_Acc/c/ obj \\xe2\\x99\\xa1'"
op|','
nl|'\n'
string|"'/delete_works/AUTH_Acc/c/ objbadutf8'"
op|']'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'self'
op|'.'
name|'app'
op|'.'
name|'calls'
op|','
number|'2'
op|')'
newline|'\n'
name|'resp_data'
op|'='
name|'utils'
op|'.'
name|'json'
op|'.'
name|'loads'
op|'('
name|'resp_body'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp_data'
op|'['
string|"'Number Deleted'"
op|']'
op|','
number|'1'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'len'
op|'('
name|'resp_data'
op|'['
string|"'Errors'"
op|']'
op|')'
op|','
number|'2'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp_data'
op|'['
string|"'Errors'"
op|']'
op|','
nl|'\n'
op|'['
op|'['
name|'urllib'
op|'.'
name|'parse'
op|'.'
name|'quote'
op|'('
string|"'c/ objbadutf8'"
op|')'
op|','
nl|'\n'
string|"'412 Precondition Failed'"
op|']'
op|','
nl|'\n'
op|'['
name|'urllib'
op|'.'
name|'parse'
op|'.'
name|'quote'
op|'('
string|"'/c/f\\xdebadutf8'"
op|')'
op|','
nl|'\n'
string|"'412 Precondition Failed'"
op|']'
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_bulk_delete_no_body
dedent|''
name|'def'
name|'test_bulk_delete_no_body'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/unauth/AUTH_acc/'"
op|')'
newline|'\n'
name|'resp_body'
op|'='
name|'self'
op|'.'
name|'handle_delete_and_iter'
op|'('
name|'req'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
string|"'411 Length Required'"
name|'in'
name|'resp_body'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_bulk_delete_no_files_in_body
dedent|''
name|'def'
name|'test_bulk_delete_no_files_in_body'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/unauth/AUTH_acc/'"
op|','
name|'body'
op|'='
string|"' '"
op|')'
newline|'\n'
name|'resp_body'
op|'='
name|'self'
op|'.'
name|'handle_delete_and_iter'
op|'('
name|'req'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
string|"'400 Bad Request'"
name|'in'
name|'resp_body'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_bulk_delete_unauth
dedent|''
name|'def'
name|'test_bulk_delete_unauth'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/unauth/AUTH_acc/'"
op|','
name|'body'
op|'='
string|"'/c/f\\n/c/f_ok\\n'"
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'Accept'"
op|':'
string|"'application/json'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'method'
op|'='
string|"'POST'"
newline|'\n'
name|'resp_body'
op|'='
name|'self'
op|'.'
name|'handle_delete_and_iter'
op|'('
name|'req'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'self'
op|'.'
name|'app'
op|'.'
name|'calls'
op|','
number|'2'
op|')'
newline|'\n'
name|'resp_data'
op|'='
name|'utils'
op|'.'
name|'json'
op|'.'
name|'loads'
op|'('
name|'resp_body'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp_data'
op|'['
string|"'Errors'"
op|']'
op|','
op|'['
op|'['
string|"'/c/f'"
op|','
string|"'401 Unauthorized'"
op|']'
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp_data'
op|'['
string|"'Response Status'"
op|']'
op|','
string|"'400 Bad Request'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp_data'
op|'['
string|"'Number Deleted'"
op|']'
op|','
number|'1'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_bulk_delete_500_resp
dedent|''
name|'def'
name|'test_bulk_delete_500_resp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/broke/AUTH_acc/'"
op|','
name|'body'
op|'='
string|"'/c/f\\nc/f2\\n'"
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'Accept'"
op|':'
string|"'application/json'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'method'
op|'='
string|"'POST'"
newline|'\n'
name|'resp_body'
op|'='
name|'self'
op|'.'
name|'handle_delete_and_iter'
op|'('
name|'req'
op|')'
newline|'\n'
name|'resp_data'
op|'='
name|'utils'
op|'.'
name|'json'
op|'.'
name|'loads'
op|'('
name|'resp_body'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
nl|'\n'
name|'resp_data'
op|'['
string|"'Errors'"
op|']'
op|','
nl|'\n'
op|'['
op|'['
string|"'/c/f'"
op|','
string|"'500 Internal Error'"
op|']'
op|','
op|'['
string|"'c/f2'"
op|','
string|"'500 Internal Error'"
op|']'
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp_data'
op|'['
string|"'Response Status'"
op|']'
op|','
string|"'502 Bad Gateway'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_bulk_delete_bad_path
dedent|''
name|'def'
name|'test_bulk_delete_bad_path'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/delete_cont_fail/'"
op|')'
newline|'\n'
name|'resp_body'
op|'='
name|'self'
op|'.'
name|'handle_delete_and_iter'
op|'('
name|'req'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
string|"'404 Not Found'"
name|'in'
name|'resp_body'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_bulk_delete_container_delete
dedent|''
name|'def'
name|'test_bulk_delete_container_delete'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/delete_cont_fail/AUTH_Acc'"
op|','
name|'body'
op|'='
string|"'c\\n'"
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'Accept'"
op|':'
string|"'application/json'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'method'
op|'='
string|"'POST'"
newline|'\n'
name|'with'
name|'patch'
op|'('
string|"'swift.common.middleware.bulk.sleep'"
op|','
nl|'\n'
name|'new'
op|'='
name|'mock'
op|'.'
name|'MagicMock'
op|'('
name|'wraps'
op|'='
name|'sleep'
op|','
nl|'\n'
name|'return_value'
op|'='
name|'None'
op|')'
op|')'
name|'as'
name|'mock_sleep'
op|':'
newline|'\n'
indent|'            '
name|'resp_body'
op|'='
name|'self'
op|'.'
name|'handle_delete_and_iter'
op|'('
name|'req'
op|')'
newline|'\n'
name|'resp_data'
op|'='
name|'utils'
op|'.'
name|'json'
op|'.'
name|'loads'
op|'('
name|'resp_body'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp_data'
op|'['
string|"'Number Deleted'"
op|']'
op|','
number|'0'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp_data'
op|'['
string|"'Errors'"
op|']'
op|','
op|'['
op|'['
string|"'c'"
op|','
string|"'409 Conflict'"
op|']'
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp_data'
op|'['
string|"'Response Status'"
op|']'
op|','
string|"'400 Bad Request'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
op|'['
op|']'
op|','
name|'mock_sleep'
op|'.'
name|'call_args_list'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_bulk_delete_container_delete_retry_and_fails
dedent|''
dedent|''
name|'def'
name|'test_bulk_delete_container_delete_retry_and_fails'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'bulk'
op|'.'
name|'retry_count'
op|'='
number|'3'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/delete_cont_fail/AUTH_Acc'"
op|','
name|'body'
op|'='
string|"'c\\n'"
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'Accept'"
op|':'
string|"'application/json'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'method'
op|'='
string|"'POST'"
newline|'\n'
name|'with'
name|'patch'
op|'('
string|"'swift.common.middleware.bulk.sleep'"
op|','
nl|'\n'
name|'new'
op|'='
name|'mock'
op|'.'
name|'MagicMock'
op|'('
name|'wraps'
op|'='
name|'sleep'
op|','
nl|'\n'
name|'return_value'
op|'='
name|'None'
op|')'
op|')'
name|'as'
name|'mock_sleep'
op|':'
newline|'\n'
indent|'            '
name|'resp_body'
op|'='
name|'self'
op|'.'
name|'handle_delete_and_iter'
op|'('
name|'req'
op|')'
newline|'\n'
name|'resp_data'
op|'='
name|'utils'
op|'.'
name|'json'
op|'.'
name|'loads'
op|'('
name|'resp_body'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp_data'
op|'['
string|"'Number Deleted'"
op|']'
op|','
number|'0'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp_data'
op|'['
string|"'Errors'"
op|']'
op|','
op|'['
op|'['
string|"'c'"
op|','
string|"'409 Conflict'"
op|']'
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp_data'
op|'['
string|"'Response Status'"
op|']'
op|','
string|"'400 Bad Request'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
op|'['
name|'call'
op|'('
name|'self'
op|'.'
name|'bulk'
op|'.'
name|'retry_interval'
op|')'
op|','
nl|'\n'
name|'call'
op|'('
name|'self'
op|'.'
name|'bulk'
op|'.'
name|'retry_interval'
op|'**'
number|'2'
op|')'
op|','
nl|'\n'
name|'call'
op|'('
name|'self'
op|'.'
name|'bulk'
op|'.'
name|'retry_interval'
op|'**'
number|'3'
op|')'
op|']'
op|','
nl|'\n'
name|'mock_sleep'
op|'.'
name|'call_args_list'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_bulk_delete_container_delete_retry_and_success
dedent|''
dedent|''
name|'def'
name|'test_bulk_delete_container_delete_retry_and_success'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'bulk'
op|'.'
name|'retry_count'
op|'='
number|'3'
newline|'\n'
name|'self'
op|'.'
name|'app'
op|'.'
name|'del_container_total'
op|'='
number|'2'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/delete_cont_success_after_attempts/AUTH_Acc'"
op|','
nl|'\n'
name|'body'
op|'='
string|"'c\\n'"
op|','
name|'headers'
op|'='
op|'{'
string|"'Accept'"
op|':'
string|"'application/json'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'method'
op|'='
string|"'DELETE'"
newline|'\n'
name|'with'
name|'patch'
op|'('
string|"'swift.common.middleware.bulk.sleep'"
op|','
nl|'\n'
name|'new'
op|'='
name|'mock'
op|'.'
name|'MagicMock'
op|'('
name|'wraps'
op|'='
name|'sleep'
op|','
nl|'\n'
name|'return_value'
op|'='
name|'None'
op|')'
op|')'
name|'as'
name|'mock_sleep'
op|':'
newline|'\n'
indent|'            '
name|'resp_body'
op|'='
name|'self'
op|'.'
name|'handle_delete_and_iter'
op|'('
name|'req'
op|')'
newline|'\n'
name|'resp_data'
op|'='
name|'utils'
op|'.'
name|'json'
op|'.'
name|'loads'
op|'('
name|'resp_body'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp_data'
op|'['
string|"'Number Deleted'"
op|']'
op|','
number|'1'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp_data'
op|'['
string|"'Errors'"
op|']'
op|','
op|'['
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp_data'
op|'['
string|"'Response Status'"
op|']'
op|','
string|"'200 OK'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
op|'['
name|'call'
op|'('
name|'self'
op|'.'
name|'bulk'
op|'.'
name|'retry_interval'
op|')'
op|','
nl|'\n'
name|'call'
op|'('
name|'self'
op|'.'
name|'bulk'
op|'.'
name|'retry_interval'
op|'**'
number|'2'
op|')'
op|']'
op|','
nl|'\n'
name|'mock_sleep'
op|'.'
name|'call_args_list'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_bulk_delete_bad_file_too_long
dedent|''
dedent|''
name|'def'
name|'test_bulk_delete_bad_file_too_long'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/delete_works/AUTH_Acc'"
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'Accept'"
op|':'
string|"'application/json'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'method'
op|'='
string|"'POST'"
newline|'\n'
name|'bad_file'
op|'='
string|"'c/'"
op|'+'
op|'('
string|"'1'"
op|'*'
name|'self'
op|'.'
name|'bulk'
op|'.'
name|'max_path_length'
op|')'
newline|'\n'
name|'data'
op|'='
string|"b'/c/f\\n'"
op|'+'
name|'bad_file'
op|'.'
name|'encode'
op|'('
string|"'ascii'"
op|')'
op|'+'
string|"b'\\n/c/f'"
newline|'\n'
name|'req'
op|'.'
name|'environ'
op|'['
string|"'wsgi.input'"
op|']'
op|'='
name|'BytesIO'
op|'('
name|'data'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'headers'
op|'['
string|"'Transfer-Encoding'"
op|']'
op|'='
string|"'chunked'"
newline|'\n'
name|'resp_body'
op|'='
name|'self'
op|'.'
name|'handle_delete_and_iter'
op|'('
name|'req'
op|')'
newline|'\n'
name|'resp_data'
op|'='
name|'utils'
op|'.'
name|'json'
op|'.'
name|'loads'
op|'('
name|'resp_body'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp_data'
op|'['
string|"'Number Deleted'"
op|']'
op|','
number|'2'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp_data'
op|'['
string|"'Errors'"
op|']'
op|','
op|'['
op|'['
name|'bad_file'
op|','
string|"'400 Bad Request'"
op|']'
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp_data'
op|'['
string|"'Response Status'"
op|']'
op|','
string|"'400 Bad Request'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_bulk_delete_bad_file_over_twice_max_length
dedent|''
name|'def'
name|'test_bulk_delete_bad_file_over_twice_max_length'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'body'
op|'='
string|"'/c/f\\nc/'"
op|'+'
op|'('
string|"'123456'"
op|'*'
name|'self'
op|'.'
name|'bulk'
op|'.'
name|'max_path_length'
op|')'
op|'+'
string|"'\\n'"
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/delete_works/AUTH_Acc'"
op|','
name|'body'
op|'='
name|'body'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'method'
op|'='
string|"'POST'"
newline|'\n'
name|'resp_body'
op|'='
name|'self'
op|'.'
name|'handle_delete_and_iter'
op|'('
name|'req'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
string|"'400 Bad Request'"
name|'in'
name|'resp_body'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_bulk_delete_max_failures
dedent|''
name|'def'
name|'test_bulk_delete_max_failures'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/unauth/AUTH_Acc'"
op|','
name|'body'
op|'='
string|"'/c/f1\\n/c/f2\\n/c/f3'"
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'Accept'"
op|':'
string|"'application/json'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'method'
op|'='
string|"'POST'"
newline|'\n'
name|'with'
name|'patch'
op|'.'
name|'object'
op|'('
name|'self'
op|'.'
name|'bulk'
op|','
string|"'max_failed_deletes'"
op|','
number|'2'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'resp_body'
op|'='
name|'self'
op|'.'
name|'handle_delete_and_iter'
op|'('
name|'req'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'self'
op|'.'
name|'app'
op|'.'
name|'calls'
op|','
number|'2'
op|')'
newline|'\n'
name|'resp_data'
op|'='
name|'utils'
op|'.'
name|'json'
op|'.'
name|'loads'
op|'('
name|'resp_body'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp_data'
op|'['
string|"'Response Status'"
op|']'
op|','
string|"'400 Bad Request'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp_data'
op|'['
string|"'Response Body'"
op|']'
op|','
nl|'\n'
string|"'Max delete failures exceeded'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp_data'
op|'['
string|"'Errors'"
op|']'
op|','
nl|'\n'
op|'['
op|'['
string|"'/c/f1'"
op|','
string|"'401 Unauthorized'"
op|']'
op|','
nl|'\n'
op|'['
string|"'/c/f2'"
op|','
string|"'401 Unauthorized'"
op|']'
op|']'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|TestSwiftInfo
dedent|''
dedent|''
dedent|''
name|'class'
name|'TestSwiftInfo'
op|'('
name|'unittest'
op|'.'
name|'TestCase'
op|')'
op|':'
newline|'\n'
DECL|member|setUp
indent|'    '
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'utils'
op|'.'
name|'_swift_info'
op|'='
op|'{'
op|'}'
newline|'\n'
name|'utils'
op|'.'
name|'_swift_admin_info'
op|'='
op|'{'
op|'}'
newline|'\n'
nl|'\n'
DECL|member|test_registered_defaults
dedent|''
name|'def'
name|'test_registered_defaults'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'bulk'
op|'.'
name|'filter_factory'
op|'('
op|'{'
op|'}'
op|')'
newline|'\n'
name|'swift_info'
op|'='
name|'utils'
op|'.'
name|'get_swift_info'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
string|"'bulk_upload'"
name|'in'
name|'swift_info'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'isinstance'
op|'('
nl|'\n'
name|'swift_info'
op|'['
string|"'bulk_upload'"
op|']'
op|'.'
name|'get'
op|'('
string|"'max_containers_per_extraction'"
op|')'
op|','
nl|'\n'
name|'numbers'
op|'.'
name|'Integral'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'isinstance'
op|'('
nl|'\n'
name|'swift_info'
op|'['
string|"'bulk_upload'"
op|']'
op|'.'
name|'get'
op|'('
string|"'max_failed_extractions'"
op|')'
op|','
nl|'\n'
name|'numbers'
op|'.'
name|'Integral'
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
string|"'bulk_delete'"
name|'in'
name|'swift_info'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'isinstance'
op|'('
nl|'\n'
name|'swift_info'
op|'['
string|"'bulk_delete'"
op|']'
op|'.'
name|'get'
op|'('
string|"'max_deletes_per_request'"
op|')'
op|','
nl|'\n'
name|'numbers'
op|'.'
name|'Integral'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'isinstance'
op|'('
nl|'\n'
name|'swift_info'
op|'['
string|"'bulk_delete'"
op|']'
op|'.'
name|'get'
op|'('
string|"'max_failed_deletes'"
op|')'
op|','
nl|'\n'
name|'numbers'
op|'.'
name|'Integral'
op|')'
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'if'
name|'__name__'
op|'=='
string|"'__main__'"
op|':'
newline|'\n'
indent|'    '
name|'unittest'
op|'.'
name|'main'
op|'('
op|')'
newline|'\n'
dedent|''
endmarker|''
end_unit
