begin_unit
comment|'# Copyright (c) 2010-2012 OpenStack, LLC.'
nl|'\n'
comment|'#'
nl|'\n'
comment|'# Licensed under the Apache License, Version 2.0 (the "License");'
nl|'\n'
comment|'# you may not use this file except in compliance with the License.'
nl|'\n'
comment|'# You may obtain a copy of the License at'
nl|'\n'
comment|'#'
nl|'\n'
comment|'#    http://www.apache.org/licenses/LICENSE-2.0'
nl|'\n'
comment|'#'
nl|'\n'
comment|'# Unless required by applicable law or agreed to in writing, software'
nl|'\n'
comment|'# distributed under the License is distributed on an "AS IS" BASIS,'
nl|'\n'
comment|'# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or'
nl|'\n'
comment|'# implied.'
nl|'\n'
comment|'# See the License for the specific language governing permissions and'
nl|'\n'
comment|'# limitations under the License.'
nl|'\n'
nl|'\n'
name|'import'
name|'glob'
newline|'\n'
name|'import'
name|'json'
newline|'\n'
name|'import'
name|'os'
newline|'\n'
name|'import'
name|'pstats'
newline|'\n'
name|'import'
name|'tempfile'
newline|'\n'
name|'import'
name|'time'
newline|'\n'
nl|'\n'
name|'from'
name|'swift'
name|'import'
name|'gettext_'
name|'as'
name|'_'
newline|'\n'
name|'from'
name|'swift'
op|'.'
name|'common'
op|'.'
name|'middleware'
op|'.'
name|'x_profile'
op|'.'
name|'exceptions'
name|'import'
name|'ODFLIBNotInstalled'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|variable|ODFLIB_INSTALLED
name|'ODFLIB_INSTALLED'
op|'='
name|'True'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'    '
name|'from'
name|'odf'
op|'.'
name|'opendocument'
name|'import'
name|'OpenDocumentSpreadsheet'
newline|'\n'
name|'from'
name|'odf'
op|'.'
name|'table'
name|'import'
name|'Table'
op|','
name|'TableRow'
op|','
name|'TableCell'
newline|'\n'
name|'from'
name|'odf'
op|'.'
name|'text'
name|'import'
name|'P'
newline|'\n'
dedent|''
name|'except'
name|'ImportError'
op|':'
newline|'\n'
DECL|variable|ODFLIB_INSTALLED
indent|'    '
name|'ODFLIB_INSTALLED'
op|'='
name|'False'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|Stats2
dedent|''
name|'class'
name|'Stats2'
op|'('
name|'pstats'
op|'.'
name|'Stats'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|member|__init__
indent|'    '
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
op|'*'
name|'args'
op|','
op|'**'
name|'kwds'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'pstats'
op|'.'
name|'Stats'
op|'.'
name|'__init__'
op|'('
name|'self'
op|','
op|'*'
name|'args'
op|','
op|'**'
name|'kwds'
op|')'
newline|'\n'
nl|'\n'
DECL|member|func_to_dict
dedent|''
name|'def'
name|'func_to_dict'
op|'('
name|'self'
op|','
name|'func'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
op|'{'
string|"'module'"
op|':'
name|'func'
op|'['
number|'0'
op|']'
op|','
string|"'line'"
op|':'
name|'func'
op|'['
number|'1'
op|']'
op|','
string|"'function'"
op|':'
name|'func'
op|'['
number|'2'
op|']'
op|'}'
newline|'\n'
nl|'\n'
DECL|member|func_std_string
dedent|''
name|'def'
name|'func_std_string'
op|'('
name|'self'
op|','
name|'func'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'pstats'
op|'.'
name|'func_std_string'
op|'('
name|'func'
op|')'
newline|'\n'
nl|'\n'
DECL|member|to_json
dedent|''
name|'def'
name|'to_json'
op|'('
name|'self'
op|','
op|'*'
name|'selection'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'d'
op|'='
name|'dict'
op|'('
op|')'
newline|'\n'
name|'d'
op|'['
string|"'files'"
op|']'
op|'='
op|'['
name|'f'
name|'for'
name|'f'
name|'in'
name|'self'
op|'.'
name|'files'
op|']'
newline|'\n'
name|'d'
op|'['
string|"'prim_calls'"
op|']'
op|'='
op|'('
name|'self'
op|'.'
name|'prim_calls'
op|')'
newline|'\n'
name|'d'
op|'['
string|"'total_calls'"
op|']'
op|'='
op|'('
name|'self'
op|'.'
name|'total_calls'
op|')'
newline|'\n'
name|'if'
name|'hasattr'
op|'('
name|'self'
op|','
string|"'sort_type'"
op|')'
op|':'
newline|'\n'
indent|'            '
name|'d'
op|'['
string|"'sort_type'"
op|']'
op|'='
name|'self'
op|'.'
name|'sort_type'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'d'
op|'['
string|"'sort_type'"
op|']'
op|'='
string|"'random'"
newline|'\n'
dedent|''
name|'d'
op|'['
string|"'total_tt'"
op|']'
op|'='
op|'('
name|'self'
op|'.'
name|'total_tt'
op|')'
newline|'\n'
name|'if'
name|'self'
op|'.'
name|'fcn_list'
op|':'
newline|'\n'
indent|'            '
name|'stat_list'
op|'='
name|'self'
op|'.'
name|'fcn_list'
op|'['
op|':'
op|']'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'stat_list'
op|'='
name|'self'
op|'.'
name|'stats'
op|'.'
name|'keys'
op|'('
op|')'
newline|'\n'
dedent|''
name|'for'
name|'s'
name|'in'
name|'selection'
op|':'
newline|'\n'
indent|'            '
name|'stat_list'
op|','
name|'__'
op|'='
name|'self'
op|'.'
name|'eval_print_amount'
op|'('
name|'s'
op|','
name|'stat_list'
op|','
string|"''"
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'calc_callees'
op|'('
op|')'
newline|'\n'
name|'function_calls'
op|'='
op|'['
op|']'
newline|'\n'
name|'for'
name|'func'
name|'in'
name|'stat_list'
op|':'
newline|'\n'
indent|'            '
name|'cc'
op|','
name|'nc'
op|','
name|'tt'
op|','
name|'ct'
op|','
name|'callers'
op|'='
name|'self'
op|'.'
name|'stats'
op|'['
name|'func'
op|']'
newline|'\n'
name|'fdict'
op|'='
name|'dict'
op|'('
op|')'
newline|'\n'
name|'fdict'
op|'.'
name|'update'
op|'('
name|'self'
op|'.'
name|'func_to_dict'
op|'('
name|'func'
op|')'
op|')'
newline|'\n'
name|'fdict'
op|'.'
name|'update'
op|'('
op|'{'
string|"'cc'"
op|':'
op|'('
name|'cc'
op|')'
op|','
string|"'nc'"
op|':'
op|'('
name|'nc'
op|')'
op|','
string|"'tt'"
op|':'
op|'('
name|'tt'
op|')'
op|','
nl|'\n'
string|"'ct'"
op|':'
op|'('
name|'ct'
op|')'
op|'}'
op|')'
newline|'\n'
name|'if'
name|'self'
op|'.'
name|'all_callees'
op|':'
newline|'\n'
indent|'                '
name|'fdict'
op|'.'
name|'update'
op|'('
op|'{'
string|"'callees'"
op|':'
op|'['
op|']'
op|'}'
op|')'
newline|'\n'
name|'for'
name|'key'
name|'in'
name|'self'
op|'.'
name|'all_callees'
op|'['
name|'func'
op|']'
op|':'
newline|'\n'
indent|'                    '
name|'cee'
op|'='
name|'self'
op|'.'
name|'func_to_dict'
op|'('
name|'key'
op|')'
newline|'\n'
name|'metric'
op|'='
name|'self'
op|'.'
name|'all_callees'
op|'['
name|'func'
op|']'
op|'['
name|'key'
op|']'
newline|'\n'
comment|"# FIXME: eventlet profiler don't provide full list of"
nl|'\n'
comment|'# the metrics'
nl|'\n'
name|'if'
name|'type'
op|'('
name|'metric'
op|')'
name|'is'
name|'tuple'
op|':'
newline|'\n'
indent|'                        '
name|'cc1'
op|','
name|'nc1'
op|','
name|'tt1'
op|','
name|'ct1'
op|'='
name|'metric'
newline|'\n'
name|'cee'
op|'.'
name|'update'
op|'('
op|'{'
string|"'cc'"
op|':'
name|'cc1'
op|','
string|"'nc'"
op|':'
name|'nc1'
op|','
string|"'tt'"
op|':'
name|'tt1'
op|','
nl|'\n'
string|"'ct'"
op|':'
name|'ct1'
op|'}'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                        '
name|'cee'
op|'['
string|"'nc'"
op|']'
op|'='
name|'metric'
newline|'\n'
dedent|''
name|'fdict'
op|'['
string|"'callees'"
op|']'
op|'.'
name|'append'
op|'('
name|'cee'
op|')'
newline|'\n'
dedent|''
dedent|''
name|'cer'
op|'='
op|'['
op|']'
newline|'\n'
name|'for'
name|'caller'
name|'in'
name|'callers'
op|':'
newline|'\n'
indent|'                '
name|'fd'
op|'='
name|'self'
op|'.'
name|'func_to_dict'
op|'('
name|'caller'
op|')'
newline|'\n'
name|'metric2'
op|'='
name|'callers'
op|'['
name|'caller'
op|']'
newline|'\n'
name|'if'
name|'isinstance'
op|'('
name|'metric2'
op|','
name|'tuple'
op|')'
op|':'
newline|'\n'
indent|'                    '
name|'cc2'
op|','
name|'nc2'
op|','
name|'tt2'
op|','
name|'ct2'
op|'='
name|'metric2'
newline|'\n'
name|'fd'
op|'.'
name|'update'
op|'('
op|'{'
string|"'cc'"
op|':'
name|'cc2'
op|','
string|"'nc'"
op|':'
name|'nc2'
op|','
string|"'tt'"
op|':'
name|'tt2'
op|','
string|"'ct'"
op|':'
name|'ct2'
op|'}'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                    '
name|'fd'
op|'.'
name|'update'
op|'('
op|'{'
string|"'nc'"
op|':'
name|'metric2'
op|'}'
op|')'
newline|'\n'
dedent|''
name|'cer'
op|'.'
name|'append'
op|'('
name|'fd'
op|')'
newline|'\n'
dedent|''
name|'fdict'
op|'.'
name|'update'
op|'('
op|'{'
string|"'callers'"
op|':'
name|'cer'
op|'}'
op|')'
newline|'\n'
name|'function_calls'
op|'.'
name|'append'
op|'('
name|'fdict'
op|')'
newline|'\n'
dedent|''
name|'d'
op|'['
string|"'stats'"
op|']'
op|'='
name|'function_calls'
newline|'\n'
name|'return'
name|'json'
op|'.'
name|'dumps'
op|'('
name|'d'
op|','
name|'indent'
op|'='
number|'2'
op|')'
newline|'\n'
nl|'\n'
DECL|member|to_csv
dedent|''
name|'def'
name|'to_csv'
op|'('
name|'self'
op|','
op|'*'
name|'selection'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'self'
op|'.'
name|'fcn_list'
op|':'
newline|'\n'
indent|'            '
name|'stat_list'
op|'='
name|'self'
op|'.'
name|'fcn_list'
op|'['
op|':'
op|']'
newline|'\n'
name|'order_text'
op|'='
string|'"Ordered by: "'
op|'+'
name|'self'
op|'.'
name|'sort_type'
op|'+'
string|"'\\r\\n'"
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'stat_list'
op|'='
name|'self'
op|'.'
name|'stats'
op|'.'
name|'keys'
op|'('
op|')'
newline|'\n'
name|'order_text'
op|'='
string|'"Random listing order was used\\r\\n"'
newline|'\n'
dedent|''
name|'for'
name|'s'
name|'in'
name|'selection'
op|':'
newline|'\n'
indent|'            '
name|'stat_list'
op|','
name|'__'
op|'='
name|'self'
op|'.'
name|'eval_print_amount'
op|'('
name|'s'
op|','
name|'stat_list'
op|','
string|"''"
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'csv'
op|'='
string|"'%d function calls (%d primitive calls) in %.6f seconds.'"
op|'%'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'total_calls'
op|','
name|'self'
op|'.'
name|'prim_calls'
op|','
name|'self'
op|'.'
name|'total_tt'
op|')'
newline|'\n'
name|'csv'
op|'='
name|'csv'
op|'+'
name|'order_text'
op|'+'
string|"'call count(nc), primitive call count(cc), \\\n                                  total time(tt), time per call, \\\n                                  cumulative time(ct), time per call, \\\n                                  function\\r\\n'"
newline|'\n'
name|'for'
name|'func'
name|'in'
name|'stat_list'
op|':'
newline|'\n'
indent|'            '
name|'cc'
op|','
name|'nc'
op|','
name|'tt'
op|','
name|'ct'
op|','
name|'__'
op|'='
name|'self'
op|'.'
name|'stats'
op|'['
name|'func'
op|']'
newline|'\n'
name|'tpc'
op|'='
string|"''"
name|'if'
name|'nc'
op|'=='
number|'0'
name|'else'
string|"'%3f'"
op|'%'
op|'('
name|'tt'
op|'/'
name|'nc'
op|')'
newline|'\n'
name|'cpc'
op|'='
string|"''"
name|'if'
name|'cc'
op|'=='
number|'0'
name|'else'
string|"'%3f'"
op|'%'
op|'('
name|'ct'
op|'/'
name|'cc'
op|')'
newline|'\n'
name|'fn'
op|'='
string|"'%s:%d(%s)'"
op|'%'
op|'('
name|'func'
op|'['
number|'0'
op|']'
op|','
name|'func'
op|'['
number|'1'
op|']'
op|','
name|'func'
op|'['
number|'2'
op|']'
op|')'
newline|'\n'
name|'csv'
op|'='
name|'csv'
op|'+'
string|"'%d,%d,%3f,%s,%3f,%s,%s\\r\\n'"
op|'%'
op|'('
nl|'\n'
name|'nc'
op|','
name|'cc'
op|','
name|'tt'
op|','
name|'tpc'
op|','
name|'ct'
op|','
name|'cpc'
op|','
name|'fn'
op|')'
newline|'\n'
dedent|''
name|'return'
name|'csv'
newline|'\n'
nl|'\n'
DECL|member|to_ods
dedent|''
name|'def'
name|'to_ods'
op|'('
name|'self'
op|','
op|'*'
name|'selection'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'not'
name|'ODFLIB_INSTALLED'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'ODFLIBNotInstalled'
op|'('
name|'_'
op|'('
string|"'odfpy not installed.'"
op|')'
op|')'
newline|'\n'
dedent|''
name|'if'
name|'self'
op|'.'
name|'fcn_list'
op|':'
newline|'\n'
indent|'            '
name|'stat_list'
op|'='
name|'self'
op|'.'
name|'fcn_list'
op|'['
op|':'
op|']'
newline|'\n'
name|'order_text'
op|'='
string|'"   Ordered by: "'
op|'+'
name|'self'
op|'.'
name|'sort_type'
op|'+'
string|"'\\n'"
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'stat_list'
op|'='
name|'self'
op|'.'
name|'stats'
op|'.'
name|'keys'
op|'('
op|')'
newline|'\n'
name|'order_text'
op|'='
string|'"   Random listing order was used\\n"'
newline|'\n'
dedent|''
name|'for'
name|'s'
name|'in'
name|'selection'
op|':'
newline|'\n'
indent|'            '
name|'stat_list'
op|','
name|'__'
op|'='
name|'self'
op|'.'
name|'eval_print_amount'
op|'('
name|'s'
op|','
name|'stat_list'
op|','
string|"''"
op|')'
newline|'\n'
dedent|''
name|'spreadsheet'
op|'='
name|'OpenDocumentSpreadsheet'
op|'('
op|')'
newline|'\n'
name|'table'
op|'='
name|'Table'
op|'('
name|'name'
op|'='
string|'"Profile"'
op|')'
newline|'\n'
name|'for'
name|'fn'
name|'in'
name|'self'
op|'.'
name|'files'
op|':'
newline|'\n'
indent|'            '
name|'tcf'
op|'='
name|'TableCell'
op|'('
op|')'
newline|'\n'
name|'tcf'
op|'.'
name|'addElement'
op|'('
name|'P'
op|'('
name|'text'
op|'='
name|'fn'
op|')'
op|')'
newline|'\n'
name|'trf'
op|'='
name|'TableRow'
op|'('
op|')'
newline|'\n'
name|'trf'
op|'.'
name|'addElement'
op|'('
name|'tcf'
op|')'
newline|'\n'
name|'table'
op|'.'
name|'addElement'
op|'('
name|'trf'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'tc_summary'
op|'='
name|'TableCell'
op|'('
op|')'
newline|'\n'
name|'summary_text'
op|'='
string|"'%d function calls (%d primitive calls) in %.6f \\\n                        seconds'"
op|'%'
op|'('
name|'self'
op|'.'
name|'total_calls'
op|','
name|'self'
op|'.'
name|'prim_calls'
op|','
nl|'\n'
name|'self'
op|'.'
name|'total_tt'
op|')'
newline|'\n'
name|'tc_summary'
op|'.'
name|'addElement'
op|'('
name|'P'
op|'('
name|'text'
op|'='
name|'summary_text'
op|')'
op|')'
newline|'\n'
name|'tr_summary'
op|'='
name|'TableRow'
op|'('
op|')'
newline|'\n'
name|'tr_summary'
op|'.'
name|'addElement'
op|'('
name|'tc_summary'
op|')'
newline|'\n'
name|'table'
op|'.'
name|'addElement'
op|'('
name|'tr_summary'
op|')'
newline|'\n'
nl|'\n'
name|'tc_order'
op|'='
name|'TableCell'
op|'('
op|')'
newline|'\n'
name|'tc_order'
op|'.'
name|'addElement'
op|'('
name|'P'
op|'('
name|'text'
op|'='
name|'order_text'
op|')'
op|')'
newline|'\n'
name|'tr_order'
op|'='
name|'TableRow'
op|'('
op|')'
newline|'\n'
name|'tr_order'
op|'.'
name|'addElement'
op|'('
name|'tc_order'
op|')'
newline|'\n'
name|'table'
op|'.'
name|'addElement'
op|'('
name|'tr_order'
op|')'
newline|'\n'
nl|'\n'
name|'tr_header'
op|'='
name|'TableRow'
op|'('
op|')'
newline|'\n'
name|'tc_cc'
op|'='
name|'TableCell'
op|'('
op|')'
newline|'\n'
name|'tc_cc'
op|'.'
name|'addElement'
op|'('
name|'P'
op|'('
name|'text'
op|'='
string|"'Total Call Count'"
op|')'
op|')'
newline|'\n'
name|'tr_header'
op|'.'
name|'addElement'
op|'('
name|'tc_cc'
op|')'
newline|'\n'
nl|'\n'
name|'tc_pc'
op|'='
name|'TableCell'
op|'('
op|')'
newline|'\n'
name|'tc_pc'
op|'.'
name|'addElement'
op|'('
name|'P'
op|'('
name|'text'
op|'='
string|"'Primitive Call Count'"
op|')'
op|')'
newline|'\n'
name|'tr_header'
op|'.'
name|'addElement'
op|'('
name|'tc_pc'
op|')'
newline|'\n'
nl|'\n'
name|'tc_tt'
op|'='
name|'TableCell'
op|'('
op|')'
newline|'\n'
name|'tc_tt'
op|'.'
name|'addElement'
op|'('
name|'P'
op|'('
name|'text'
op|'='
string|"'Total Time(seconds)'"
op|')'
op|')'
newline|'\n'
name|'tr_header'
op|'.'
name|'addElement'
op|'('
name|'tc_tt'
op|')'
newline|'\n'
nl|'\n'
name|'tc_pc'
op|'='
name|'TableCell'
op|'('
op|')'
newline|'\n'
name|'tc_pc'
op|'.'
name|'addElement'
op|'('
name|'P'
op|'('
name|'text'
op|'='
string|"'Time Per call(seconds)'"
op|')'
op|')'
newline|'\n'
name|'tr_header'
op|'.'
name|'addElement'
op|'('
name|'tc_pc'
op|')'
newline|'\n'
nl|'\n'
name|'tc_ct'
op|'='
name|'TableCell'
op|'('
op|')'
newline|'\n'
name|'tc_ct'
op|'.'
name|'addElement'
op|'('
name|'P'
op|'('
name|'text'
op|'='
string|"'Cumulative Time(seconds)'"
op|')'
op|')'
newline|'\n'
name|'tr_header'
op|'.'
name|'addElement'
op|'('
name|'tc_ct'
op|')'
newline|'\n'
nl|'\n'
name|'tc_pt'
op|'='
name|'TableCell'
op|'('
op|')'
newline|'\n'
name|'tc_pt'
op|'.'
name|'addElement'
op|'('
name|'P'
op|'('
name|'text'
op|'='
string|"'Cumulative Time per call(seconds)'"
op|')'
op|')'
newline|'\n'
name|'tr_header'
op|'.'
name|'addElement'
op|'('
name|'tc_pt'
op|')'
newline|'\n'
nl|'\n'
name|'tc_nfl'
op|'='
name|'TableCell'
op|'('
op|')'
newline|'\n'
name|'tc_nfl'
op|'.'
name|'addElement'
op|'('
name|'P'
op|'('
name|'text'
op|'='
string|"'filename:lineno(function)'"
op|')'
op|')'
newline|'\n'
name|'tr_header'
op|'.'
name|'addElement'
op|'('
name|'tc_nfl'
op|')'
newline|'\n'
nl|'\n'
name|'table'
op|'.'
name|'addElement'
op|'('
name|'tr_header'
op|')'
newline|'\n'
nl|'\n'
name|'for'
name|'func'
name|'in'
name|'stat_list'
op|':'
newline|'\n'
indent|'            '
name|'cc'
op|','
name|'nc'
op|','
name|'tt'
op|','
name|'ct'
op|','
name|'__'
op|'='
name|'self'
op|'.'
name|'stats'
op|'['
name|'func'
op|']'
newline|'\n'
name|'tr_header'
op|'='
name|'TableRow'
op|'('
op|')'
newline|'\n'
name|'tc_nc'
op|'='
name|'TableCell'
op|'('
op|')'
newline|'\n'
name|'tc_nc'
op|'.'
name|'addElement'
op|'('
name|'P'
op|'('
name|'text'
op|'='
name|'nc'
op|')'
op|')'
newline|'\n'
name|'tr_header'
op|'.'
name|'addElement'
op|'('
name|'tc_nc'
op|')'
newline|'\n'
nl|'\n'
name|'tc_pc'
op|'='
name|'TableCell'
op|'('
op|')'
newline|'\n'
name|'tc_pc'
op|'.'
name|'addElement'
op|'('
name|'P'
op|'('
name|'text'
op|'='
name|'cc'
op|')'
op|')'
newline|'\n'
name|'tr_header'
op|'.'
name|'addElement'
op|'('
name|'tc_pc'
op|')'
newline|'\n'
nl|'\n'
name|'tc_tt'
op|'='
name|'TableCell'
op|'('
op|')'
newline|'\n'
name|'tc_tt'
op|'.'
name|'addElement'
op|'('
name|'P'
op|'('
name|'text'
op|'='
name|'tt'
op|')'
op|')'
newline|'\n'
name|'tr_header'
op|'.'
name|'addElement'
op|'('
name|'tc_tt'
op|')'
newline|'\n'
nl|'\n'
name|'tc_tpc'
op|'='
name|'TableCell'
op|'('
op|')'
newline|'\n'
name|'tc_tpc'
op|'.'
name|'addElement'
op|'('
name|'P'
op|'('
name|'text'
op|'='
op|'('
name|'None'
name|'if'
name|'nc'
op|'=='
number|'0'
name|'else'
name|'float'
op|'('
name|'tt'
op|')'
op|'/'
name|'nc'
op|')'
op|')'
op|')'
newline|'\n'
name|'tr_header'
op|'.'
name|'addElement'
op|'('
name|'tc_tpc'
op|')'
newline|'\n'
nl|'\n'
name|'tc_ct'
op|'='
name|'TableCell'
op|'('
op|')'
newline|'\n'
name|'tc_ct'
op|'.'
name|'addElement'
op|'('
name|'P'
op|'('
name|'text'
op|'='
name|'ct'
op|')'
op|')'
newline|'\n'
name|'tr_header'
op|'.'
name|'addElement'
op|'('
name|'tc_ct'
op|')'
newline|'\n'
nl|'\n'
name|'tc_tpt'
op|'='
name|'TableCell'
op|'('
op|')'
newline|'\n'
name|'tc_tpt'
op|'.'
name|'addElement'
op|'('
name|'P'
op|'('
name|'text'
op|'='
op|'('
name|'None'
name|'if'
name|'cc'
op|'=='
number|'0'
name|'else'
name|'float'
op|'('
name|'ct'
op|')'
op|'/'
name|'cc'
op|')'
op|')'
op|')'
newline|'\n'
name|'tr_header'
op|'.'
name|'addElement'
op|'('
name|'tc_tpt'
op|')'
newline|'\n'
nl|'\n'
name|'tc_nfl'
op|'='
name|'TableCell'
op|'('
op|')'
newline|'\n'
name|'tc_nfl'
op|'.'
name|'addElement'
op|'('
name|'P'
op|'('
name|'text'
op|'='
name|'func'
op|')'
op|')'
newline|'\n'
name|'tr_header'
op|'.'
name|'addElement'
op|'('
name|'tc_nfl'
op|')'
newline|'\n'
name|'table'
op|'.'
name|'addElement'
op|'('
name|'tr_header'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'spreadsheet'
op|'.'
name|'spreadsheet'
op|'.'
name|'addElement'
op|'('
name|'table'
op|')'
newline|'\n'
name|'tmp_ods'
op|'='
name|'tempfile'
op|'.'
name|'TemporaryFile'
op|'('
op|')'
newline|'\n'
name|'spreadsheet'
op|'.'
name|'write'
op|'('
name|'tmp_ods'
op|')'
newline|'\n'
name|'tmp_ods'
op|'.'
name|'seek'
op|'('
number|'0'
op|')'
newline|'\n'
name|'data'
op|'='
name|'tmp_ods'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'os'
op|'.'
name|'close'
op|'('
name|'tmp_ods'
op|')'
newline|'\n'
name|'return'
name|'data'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|ProfileLog
dedent|''
dedent|''
name|'class'
name|'ProfileLog'
op|'('
name|'object'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|member|__init__
indent|'    '
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'log_filename_prefix'
op|','
name|'dump_timestamp'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'log_filename_prefix'
op|'='
name|'log_filename_prefix'
newline|'\n'
name|'self'
op|'.'
name|'dump_timestamp'
op|'='
name|'dump_timestamp'
newline|'\n'
nl|'\n'
DECL|member|get_all_pids
dedent|''
name|'def'
name|'get_all_pids'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'profile_ids'
op|'='
op|'['
name|'l'
op|'.'
name|'replace'
op|'('
name|'self'
op|'.'
name|'log_filename_prefix'
op|','
string|"''"
op|')'
name|'for'
name|'l'
nl|'\n'
name|'in'
name|'glob'
op|'.'
name|'glob'
op|'('
name|'self'
op|'.'
name|'log_filename_prefix'
op|'+'
string|"'*'"
op|')'
nl|'\n'
name|'if'
name|'not'
name|'l'
op|'.'
name|'endswith'
op|'('
string|"'.tmp'"
op|')'
op|']'
newline|'\n'
name|'return'
name|'sorted'
op|'('
name|'profile_ids'
op|','
name|'reverse'
op|'='
name|'True'
op|')'
newline|'\n'
nl|'\n'
DECL|member|get_logfiles
dedent|''
name|'def'
name|'get_logfiles'
op|'('
name|'self'
op|','
name|'id_or_name'
op|')'
op|':'
newline|'\n'
comment|'# The first file with timestamp in the sorted log_files'
nl|'\n'
comment|'# (PREFIX)(PROCESS_ID)-(TIMESTAMP)'
nl|'\n'
indent|'        '
name|'if'
name|'id_or_name'
name|'in'
op|'['
string|"'all'"
op|']'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'self'
op|'.'
name|'dump_timestamp'
op|':'
newline|'\n'
indent|'                '
name|'latest_dict'
op|'='
op|'{'
op|'}'
newline|'\n'
name|'for'
name|'pid'
name|'in'
name|'self'
op|'.'
name|'get_all_pids'
op|'('
op|')'
op|':'
newline|'\n'
indent|'                    '
op|'['
name|'process_id'
op|','
name|'__'
op|']'
op|'='
name|'pid'
op|'.'
name|'split'
op|'('
string|"'-'"
op|')'
newline|'\n'
name|'if'
name|'process_id'
name|'not'
name|'in'
name|'latest_dict'
op|'.'
name|'keys'
op|'('
op|')'
op|':'
newline|'\n'
indent|'                        '
name|'latest_dict'
op|'['
name|'process_id'
op|']'
op|'='
name|'self'
op|'.'
name|'log_filename_prefix'
op|'+'
name|'pid'
newline|'\n'
dedent|''
dedent|''
name|'log_files'
op|'='
name|'latest_dict'
op|'.'
name|'values'
op|'('
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                '
name|'log_files'
op|'='
op|'['
name|'l'
name|'for'
name|'l'
name|'in'
name|'glob'
op|'.'
name|'glob'
op|'('
name|'self'
op|'.'
name|'log_filename_prefix'
nl|'\n'
op|'+'
string|"'*'"
op|')'
name|'if'
name|'not'
name|'l'
op|'.'
name|'endswith'
op|'('
string|"'.tmp'"
op|')'
op|']'
newline|'\n'
dedent|''
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'pid'
op|'='
name|'str'
op|'('
name|'os'
op|'.'
name|'getpid'
op|'('
op|')'
op|')'
name|'if'
name|'id_or_name'
name|'in'
op|'['
name|'None'
op|','
string|"''"
op|','
string|"'current'"
op|']'
name|'else'
name|'id_or_name'
newline|'\n'
name|'log_files'
op|'='
op|'['
name|'l'
name|'for'
name|'l'
name|'in'
name|'glob'
op|'.'
name|'glob'
op|'('
name|'self'
op|'.'
name|'log_filename_prefix'
op|'+'
nl|'\n'
name|'pid'
op|'+'
string|"'*'"
op|')'
name|'if'
name|'not'
name|'l'
op|'.'
name|'endswith'
op|'('
string|"'.tmp'"
op|')'
op|']'
newline|'\n'
name|'if'
name|'len'
op|'('
name|'log_files'
op|')'
op|'>'
number|'0'
op|':'
newline|'\n'
indent|'                '
name|'log_files'
op|'='
name|'sorted'
op|'('
name|'log_files'
op|','
name|'reverse'
op|'='
name|'True'
op|')'
op|'['
number|'0'
op|':'
number|'1'
op|']'
newline|'\n'
dedent|''
dedent|''
name|'return'
name|'log_files'
newline|'\n'
nl|'\n'
DECL|member|dump_profile
dedent|''
name|'def'
name|'dump_profile'
op|'('
name|'self'
op|','
name|'profiler'
op|','
name|'pid'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'self'
op|'.'
name|'log_filename_prefix'
op|':'
newline|'\n'
indent|'            '
name|'pfn'
op|'='
name|'self'
op|'.'
name|'log_filename_prefix'
op|'+'
name|'str'
op|'('
name|'pid'
op|')'
newline|'\n'
name|'if'
name|'self'
op|'.'
name|'dump_timestamp'
op|':'
newline|'\n'
indent|'                '
name|'pfn'
op|'='
name|'pfn'
op|'+'
string|'"-"'
op|'+'
name|'str'
op|'('
name|'time'
op|'.'
name|'time'
op|'('
op|')'
op|')'
newline|'\n'
dedent|''
name|'tmpfn'
op|'='
name|'pfn'
op|'+'
string|'".tmp"'
newline|'\n'
name|'profiler'
op|'.'
name|'dump_stats'
op|'('
name|'tmpfn'
op|')'
newline|'\n'
name|'os'
op|'.'
name|'rename'
op|'('
name|'tmpfn'
op|','
name|'pfn'
op|')'
newline|'\n'
name|'return'
name|'pfn'
newline|'\n'
nl|'\n'
DECL|member|clear
dedent|''
dedent|''
name|'def'
name|'clear'
op|'('
name|'self'
op|','
name|'id_or_name'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'log_files'
op|'='
name|'self'
op|'.'
name|'get_logfiles'
op|'('
name|'id_or_name'
op|')'
newline|'\n'
name|'for'
name|'l'
name|'in'
name|'log_files'
op|':'
newline|'\n'
indent|'            '
name|'os'
op|'.'
name|'path'
op|'.'
name|'exists'
op|'('
name|'l'
op|')'
name|'and'
name|'os'
op|'.'
name|'remove'
op|'('
name|'l'
op|')'
newline|'\n'
dedent|''
dedent|''
dedent|''
endmarker|''
end_unit
