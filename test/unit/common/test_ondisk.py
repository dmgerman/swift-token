begin_unit
comment|'# Copyright (c) 2010-2013 OpenStack, LLC.'
nl|'\n'
comment|'#'
nl|'\n'
comment|'# Licensed under the Apache License, Version 2.0 (the "License");'
nl|'\n'
comment|'# you may not use this file except in compliance with the License.'
nl|'\n'
comment|'# You may obtain a copy of the License at'
nl|'\n'
comment|'#'
nl|'\n'
comment|'#    http://www.apache.org/licenses/LICENSE-2.0'
nl|'\n'
comment|'#'
nl|'\n'
comment|'# Unless required by applicable law or agreed to in writing, software'
nl|'\n'
comment|'# distributed under the License is distributed on an "AS IS" BASIS,'
nl|'\n'
comment|'# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or'
nl|'\n'
comment|'# implied.'
nl|'\n'
comment|'# See the License for the specific language governing permissions and'
nl|'\n'
comment|'# limitations under the License.'
nl|'\n'
nl|'\n'
string|'"""Tests for swift.common.ondisk"""'
newline|'\n'
nl|'\n'
name|'from'
name|'__future__'
name|'import'
name|'with_statement'
newline|'\n'
name|'from'
name|'test'
op|'.'
name|'unit'
name|'import'
name|'temptree'
newline|'\n'
nl|'\n'
name|'import'
name|'os'
newline|'\n'
nl|'\n'
name|'import'
name|'unittest'
newline|'\n'
nl|'\n'
name|'from'
name|'swift'
op|'.'
name|'common'
name|'import'
name|'ondisk'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|TestOndisk
name|'class'
name|'TestOndisk'
op|'('
name|'unittest'
op|'.'
name|'TestCase'
op|')'
op|':'
newline|'\n'
indent|'    '
string|'"""Tests for swift.common.ondisk"""'
newline|'\n'
nl|'\n'
DECL|member|setUp
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'ondisk'
op|'.'
name|'HASH_PATH_SUFFIX'
op|'='
string|"'endcap'"
newline|'\n'
name|'ondisk'
op|'.'
name|'HASH_PATH_PREFIX'
op|'='
string|"'startcap'"
newline|'\n'
nl|'\n'
DECL|member|test_normalize_timestamp
dedent|''
name|'def'
name|'test_normalize_timestamp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# Test swift.common.ondisk.normalize_timestamp'
nl|'\n'
indent|'        '
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'ondisk'
op|'.'
name|'normalize_timestamp'
op|'('
string|"'1253327593.48174'"
op|')'
op|','
nl|'\n'
string|'"1253327593.48174"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'ondisk'
op|'.'
name|'normalize_timestamp'
op|'('
number|'1253327593.48174'
op|')'
op|','
nl|'\n'
string|'"1253327593.48174"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'ondisk'
op|'.'
name|'normalize_timestamp'
op|'('
string|"'1253327593.48'"
op|')'
op|','
nl|'\n'
string|'"1253327593.48000"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'ondisk'
op|'.'
name|'normalize_timestamp'
op|'('
number|'1253327593.48'
op|')'
op|','
nl|'\n'
string|'"1253327593.48000"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'ondisk'
op|'.'
name|'normalize_timestamp'
op|'('
string|"'253327593.48'"
op|')'
op|','
nl|'\n'
string|'"0253327593.48000"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'ondisk'
op|'.'
name|'normalize_timestamp'
op|'('
number|'253327593.48'
op|')'
op|','
nl|'\n'
string|'"0253327593.48000"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'ondisk'
op|'.'
name|'normalize_timestamp'
op|'('
string|"'1253327593'"
op|')'
op|','
nl|'\n'
string|'"1253327593.00000"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'ondisk'
op|'.'
name|'normalize_timestamp'
op|'('
number|'1253327593'
op|')'
op|','
nl|'\n'
string|'"1253327593.00000"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ValueError'
op|','
name|'ondisk'
op|'.'
name|'normalize_timestamp'
op|','
string|"''"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ValueError'
op|','
name|'ondisk'
op|'.'
name|'normalize_timestamp'
op|','
string|"'abc'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_validate_device_partition
dedent|''
name|'def'
name|'test_validate_device_partition'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# Test swift.common.ondisk.validate_device_partition'
nl|'\n'
indent|'        '
name|'ondisk'
op|'.'
name|'validate_device_partition'
op|'('
string|"'foo'"
op|','
string|"'bar'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ValueError'
op|','
nl|'\n'
name|'ondisk'
op|'.'
name|'validate_device_partition'
op|','
string|"''"
op|','
string|"''"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ValueError'
op|','
nl|'\n'
name|'ondisk'
op|'.'
name|'validate_device_partition'
op|','
string|"''"
op|','
string|"'foo'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ValueError'
op|','
nl|'\n'
name|'ondisk'
op|'.'
name|'validate_device_partition'
op|','
string|"'foo'"
op|','
string|"''"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ValueError'
op|','
nl|'\n'
name|'ondisk'
op|'.'
name|'validate_device_partition'
op|','
string|"'foo/bar'"
op|','
string|"'foo'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ValueError'
op|','
nl|'\n'
name|'ondisk'
op|'.'
name|'validate_device_partition'
op|','
string|"'foo'"
op|','
string|"'foo/bar'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ValueError'
op|','
nl|'\n'
name|'ondisk'
op|'.'
name|'validate_device_partition'
op|','
string|"'.'"
op|','
string|"'foo'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ValueError'
op|','
nl|'\n'
name|'ondisk'
op|'.'
name|'validate_device_partition'
op|','
string|"'..'"
op|','
string|"'foo'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ValueError'
op|','
nl|'\n'
name|'ondisk'
op|'.'
name|'validate_device_partition'
op|','
string|"'foo'"
op|','
string|"'.'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ValueError'
op|','
nl|'\n'
name|'ondisk'
op|'.'
name|'validate_device_partition'
op|','
string|"'foo'"
op|','
string|"'..'"
op|')'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'ondisk'
op|'.'
name|'validate_device_partition'
op|'('
string|"'o\\nn e'"
op|','
string|"'foo'"
op|')'
newline|'\n'
dedent|''
name|'except'
name|'ValueError'
name|'as'
name|'err'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'str'
op|'('
name|'err'
op|')'
op|','
string|"'Invalid device: o%0An%20e'"
op|')'
newline|'\n'
dedent|''
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'ondisk'
op|'.'
name|'validate_device_partition'
op|'('
string|"'foo'"
op|','
string|"'o\\nn e'"
op|')'
newline|'\n'
dedent|''
name|'except'
name|'ValueError'
name|'as'
name|'err'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'str'
op|'('
name|'err'
op|')'
op|','
string|"'Invalid partition: o%0An%20e'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_storage_directory
dedent|''
dedent|''
name|'def'
name|'test_storage_directory'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'ondisk'
op|'.'
name|'storage_directory'
op|'('
string|"'objects'"
op|','
string|"'1'"
op|','
string|"'ABCDEF'"
op|')'
op|','
nl|'\n'
string|"'objects/1/DEF/ABCDEF'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_hash_path
dedent|''
name|'def'
name|'test_hash_path'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'_prefix'
op|'='
name|'ondisk'
op|'.'
name|'HASH_PATH_PREFIX'
newline|'\n'
name|'ondisk'
op|'.'
name|'HASH_PATH_PREFIX'
op|'='
string|"''"
newline|'\n'
comment|'# Yes, these tests are deliberately very fragile. We want to make sure'
nl|'\n'
comment|'# that if someones changes the results hash_path produces, they know it'
nl|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'ondisk'
op|'.'
name|'hash_path'
op|'('
string|"'a'"
op|')'
op|','
nl|'\n'
string|"'1c84525acb02107ea475dcd3d09c2c58'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'ondisk'
op|'.'
name|'hash_path'
op|'('
string|"'a'"
op|','
string|"'c'"
op|')'
op|','
nl|'\n'
string|"'33379ecb053aa5c9e356c68997cbb59e'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'ondisk'
op|'.'
name|'hash_path'
op|'('
string|"'a'"
op|','
string|"'c'"
op|','
string|"'o'"
op|')'
op|','
nl|'\n'
string|"'06fbf0b514e5199dfc4e00f42eb5ea83'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
nl|'\n'
name|'ondisk'
op|'.'
name|'hash_path'
op|'('
string|"'a'"
op|','
string|"'c'"
op|','
string|"'o'"
op|','
name|'raw_digest'
op|'='
name|'False'
op|')'
op|','
nl|'\n'
string|"'06fbf0b514e5199dfc4e00f42eb5ea83'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'ondisk'
op|'.'
name|'hash_path'
op|'('
string|"'a'"
op|','
string|"'c'"
op|','
string|"'o'"
op|','
name|'raw_digest'
op|'='
name|'True'
op|')'
op|','
nl|'\n'
string|"'\\x06\\xfb\\xf0\\xb5\\x14\\xe5\\x19\\x9d\\xfcN'"
nl|'\n'
string|"'\\x00\\xf4.\\xb5\\xea\\x83'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ValueError'
op|','
name|'ondisk'
op|'.'
name|'hash_path'
op|','
string|"'a'"
op|','
name|'object'
op|'='
string|"'o'"
op|')'
newline|'\n'
name|'ondisk'
op|'.'
name|'HASH_PATH_PREFIX'
op|'='
string|"'abcdef'"
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
nl|'\n'
name|'ondisk'
op|'.'
name|'hash_path'
op|'('
string|"'a'"
op|','
string|"'c'"
op|','
string|"'o'"
op|','
name|'raw_digest'
op|'='
name|'False'
op|')'
op|','
nl|'\n'
string|"'363f9b535bfb7d17a43a46a358afca0e'"
op|')'
newline|'\n'
dedent|''
name|'finally'
op|':'
newline|'\n'
indent|'            '
name|'ondisk'
op|'.'
name|'HASH_PATH_PREFIX'
op|'='
name|'_prefix'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|TestAuditLocationGenerator
dedent|''
dedent|''
dedent|''
name|'class'
name|'TestAuditLocationGenerator'
op|'('
name|'unittest'
op|'.'
name|'TestCase'
op|')'
op|':'
newline|'\n'
DECL|member|test_non_dir_contents
indent|'    '
name|'def'
name|'test_non_dir_contents'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'with'
name|'temptree'
op|'('
op|'['
op|']'
op|')'
name|'as'
name|'tmpdir'
op|':'
newline|'\n'
indent|'            '
name|'data'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'tmpdir'
op|','
string|'"drive"'
op|','
string|'"data"'
op|')'
newline|'\n'
name|'os'
op|'.'
name|'makedirs'
op|'('
name|'data'
op|')'
newline|'\n'
name|'with'
name|'open'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'data'
op|','
string|'"partition1"'
op|')'
op|','
string|'"w"'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'pass'
newline|'\n'
dedent|''
name|'partition'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'data'
op|','
string|'"partition2"'
op|')'
newline|'\n'
name|'os'
op|'.'
name|'makedirs'
op|'('
name|'partition'
op|')'
newline|'\n'
name|'with'
name|'open'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'partition'
op|','
string|'"suffix1"'
op|')'
op|','
string|'"w"'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'pass'
newline|'\n'
dedent|''
name|'suffix'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'partition'
op|','
string|'"suffix2"'
op|')'
newline|'\n'
name|'os'
op|'.'
name|'makedirs'
op|'('
name|'suffix'
op|')'
newline|'\n'
name|'with'
name|'open'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'suffix'
op|','
string|'"hash1"'
op|')'
op|','
string|'"w"'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'pass'
newline|'\n'
dedent|''
name|'locations'
op|'='
name|'ondisk'
op|'.'
name|'audit_location_generator'
op|'('
nl|'\n'
name|'tmpdir'
op|','
string|'"data"'
op|','
name|'mount_check'
op|'='
name|'False'
nl|'\n'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'list'
op|'('
name|'locations'
op|')'
op|','
op|'['
op|']'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
dedent|''
dedent|''
dedent|''
name|'if'
name|'__name__'
op|'=='
string|"'__main__'"
op|':'
newline|'\n'
indent|'    '
name|'unittest'
op|'.'
name|'main'
op|'('
op|')'
newline|'\n'
dedent|''
endmarker|''
end_unit
