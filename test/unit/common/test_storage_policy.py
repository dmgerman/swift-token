begin_unit
comment|'# Licensed under the Apache License, Version 2.0 (the "License");'
nl|'\n'
comment|'# you may not use this file except in compliance with the License.'
nl|'\n'
comment|'# You may obtain a copy of the License at'
nl|'\n'
comment|'#'
nl|'\n'
comment|'#    http://www.apache.org/licenses/LICENSE-2.0'
nl|'\n'
comment|'#'
nl|'\n'
comment|'# Unless required by applicable law or agreed to in writing, software'
nl|'\n'
comment|'# distributed under the License is distributed on an "AS IS" BASIS,'
nl|'\n'
comment|'# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or'
nl|'\n'
comment|'# implied.'
nl|'\n'
comment|'# See the License for the specific language governing permissions and'
nl|'\n'
comment|'# limitations under the License.'
nl|'\n'
nl|'\n'
string|'""" Tests for swift.common.storage_policies """'
newline|'\n'
name|'import'
name|'unittest'
newline|'\n'
name|'import'
name|'StringIO'
newline|'\n'
name|'from'
name|'ConfigParser'
name|'import'
name|'ConfigParser'
newline|'\n'
name|'import'
name|'mock'
newline|'\n'
name|'from'
name|'tempfile'
name|'import'
name|'NamedTemporaryFile'
newline|'\n'
name|'from'
name|'test'
op|'.'
name|'unit'
name|'import'
name|'patch_policies'
op|','
name|'FakeRing'
newline|'\n'
name|'from'
name|'swift'
op|'.'
name|'common'
op|'.'
name|'storage_policy'
name|'import'
op|'('
nl|'\n'
name|'StoragePolicy'
op|','
name|'StoragePolicyCollection'
op|','
name|'POLICIES'
op|','
name|'PolicyError'
op|','
nl|'\n'
name|'parse_storage_policies'
op|','
name|'reload_storage_policies'
op|','
name|'get_policy_string'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|TestStoragePolicies
name|'class'
name|'TestStoragePolicies'
op|'('
name|'unittest'
op|'.'
name|'TestCase'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|member|_conf
indent|'    '
name|'def'
name|'_conf'
op|'('
name|'self'
op|','
name|'conf_str'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'conf_str'
op|'='
string|'"\\n"'
op|'.'
name|'join'
op|'('
name|'line'
op|'.'
name|'strip'
op|'('
op|')'
name|'for'
name|'line'
name|'in'
name|'conf_str'
op|'.'
name|'split'
op|'('
string|'"\\n"'
op|')'
op|')'
newline|'\n'
name|'conf'
op|'='
name|'ConfigParser'
op|'('
op|')'
newline|'\n'
name|'conf'
op|'.'
name|'readfp'
op|'('
name|'StringIO'
op|'.'
name|'StringIO'
op|'('
name|'conf_str'
op|')'
op|')'
newline|'\n'
name|'return'
name|'conf'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'patch_policies'
op|'('
op|'['
name|'StoragePolicy'
op|'('
number|'0'
op|','
string|"'zero'"
op|','
name|'True'
op|')'
op|','
nl|'\n'
name|'StoragePolicy'
op|'('
number|'1'
op|','
string|"'one'"
op|','
name|'False'
op|')'
op|','
nl|'\n'
name|'StoragePolicy'
op|'('
number|'2'
op|','
string|"'two'"
op|','
name|'False'
op|')'
op|','
nl|'\n'
name|'StoragePolicy'
op|'('
number|'3'
op|','
string|"'three'"
op|','
name|'False'
op|','
name|'is_deprecated'
op|'='
name|'True'
op|')'
op|']'
op|')'
newline|'\n'
DECL|member|test_swift_info
name|'def'
name|'test_swift_info'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|"# the deprecated 'three' should not exist in expect"
nl|'\n'
indent|'        '
name|'expect'
op|'='
op|'['
op|'{'
string|"'default'"
op|':'
name|'True'
op|','
string|"'name'"
op|':'
string|"'zero'"
op|'}'
op|','
nl|'\n'
op|'{'
string|"'name'"
op|':'
string|"'two'"
op|'}'
op|','
nl|'\n'
op|'{'
string|"'name'"
op|':'
string|"'one'"
op|'}'
op|']'
newline|'\n'
name|'swift_info'
op|'='
name|'POLICIES'
op|'.'
name|'get_policy_info'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'sorted'
op|'('
name|'expect'
op|','
name|'key'
op|'='
name|'lambda'
name|'k'
op|':'
name|'k'
op|'['
string|"'name'"
op|']'
op|')'
op|','
nl|'\n'
name|'sorted'
op|'('
name|'swift_info'
op|','
name|'key'
op|'='
name|'lambda'
name|'k'
op|':'
name|'k'
op|'['
string|"'name'"
op|']'
op|')'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'patch_policies'
newline|'\n'
DECL|member|test_get_policy_string
name|'def'
name|'test_get_policy_string'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'get_policy_string'
op|'('
string|"'something'"
op|','
number|'0'
op|')'
op|','
string|"'something'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'get_policy_string'
op|'('
string|"'something'"
op|','
name|'None'
op|')'
op|','
string|"'something'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'get_policy_string'
op|'('
string|"'something'"
op|','
number|'1'
op|')'
op|','
nl|'\n'
string|"'something'"
op|'+'
string|"'-1'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'PolicyError'
op|','
name|'get_policy_string'
op|','
string|"'something'"
op|','
number|'99'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_defaults
dedent|''
name|'def'
name|'test_defaults'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'len'
op|'('
name|'POLICIES'
op|')'
op|'>'
number|'0'
op|')'
newline|'\n'
nl|'\n'
comment|'# test class functions'
nl|'\n'
name|'default_policy'
op|'='
name|'POLICIES'
op|'.'
name|'default'
newline|'\n'
name|'self'
op|'.'
name|'assert_'
op|'('
name|'default_policy'
op|'.'
name|'is_default'
op|')'
newline|'\n'
name|'zero_policy'
op|'='
name|'POLICIES'
op|'.'
name|'get_by_index'
op|'('
number|'0'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_'
op|'('
name|'zero_policy'
op|'.'
name|'idx'
op|'=='
number|'0'
op|')'
newline|'\n'
name|'zero_policy_by_name'
op|'='
name|'POLICIES'
op|'.'
name|'get_by_name'
op|'('
name|'zero_policy'
op|'.'
name|'name'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_'
op|'('
name|'zero_policy_by_name'
op|'.'
name|'idx'
op|'=='
number|'0'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_storage_policy_repr
dedent|''
name|'def'
name|'test_storage_policy_repr'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'test_policies'
op|'='
op|'['
name|'StoragePolicy'
op|'('
number|'0'
op|','
string|"'aay'"
op|','
name|'True'
op|')'
op|','
nl|'\n'
name|'StoragePolicy'
op|'('
number|'1'
op|','
string|"'bee'"
op|','
name|'False'
op|')'
op|','
nl|'\n'
name|'StoragePolicy'
op|'('
number|'2'
op|','
string|"'cee'"
op|','
name|'False'
op|')'
op|']'
newline|'\n'
name|'policies'
op|'='
name|'StoragePolicyCollection'
op|'('
name|'test_policies'
op|')'
newline|'\n'
name|'for'
name|'policy'
name|'in'
name|'policies'
op|':'
newline|'\n'
indent|'            '
name|'policy_repr'
op|'='
name|'repr'
op|'('
name|'policy'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_'
op|'('
name|'policy'
op|'.'
name|'__class__'
op|'.'
name|'__name__'
name|'in'
name|'policy_repr'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_'
op|'('
string|"'is_default=%s'"
op|'%'
name|'policy'
op|'.'
name|'is_default'
name|'in'
name|'policy_repr'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_'
op|'('
string|"'is_deprecated=%s'"
op|'%'
name|'policy'
op|'.'
name|'is_deprecated'
name|'in'
nl|'\n'
name|'policy_repr'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_'
op|'('
name|'policy'
op|'.'
name|'name'
name|'in'
name|'policy_repr'
op|')'
newline|'\n'
dedent|''
name|'collection_repr'
op|'='
name|'repr'
op|'('
name|'policies'
op|')'
newline|'\n'
name|'collection_repr_lines'
op|'='
name|'collection_repr'
op|'.'
name|'splitlines'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_'
op|'('
name|'policies'
op|'.'
name|'__class__'
op|'.'
name|'__name__'
name|'in'
name|'collection_repr_lines'
op|'['
number|'0'
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'len'
op|'('
name|'policies'
op|')'
op|','
name|'len'
op|'('
name|'collection_repr_lines'
op|'['
number|'1'
op|':'
op|'-'
number|'1'
op|']'
op|')'
op|')'
newline|'\n'
name|'for'
name|'policy'
op|','
name|'line'
name|'in'
name|'zip'
op|'('
name|'policies'
op|','
name|'collection_repr_lines'
op|'['
number|'1'
op|':'
op|'-'
number|'1'
op|']'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assert_'
op|'('
name|'repr'
op|'('
name|'policy'
op|')'
name|'in'
name|'line'
op|')'
newline|'\n'
dedent|''
name|'with'
name|'patch_policies'
op|'('
name|'policies'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'repr'
op|'('
name|'POLICIES'
op|')'
op|','
name|'collection_repr'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_validate_policies_defaults
dedent|''
dedent|''
name|'def'
name|'test_validate_policies_defaults'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# 0 explicit default'
nl|'\n'
indent|'        '
name|'test_policies'
op|'='
op|'['
name|'StoragePolicy'
op|'('
number|'0'
op|','
string|"'zero'"
op|','
name|'True'
op|')'
op|','
nl|'\n'
name|'StoragePolicy'
op|'('
number|'1'
op|','
string|"'one'"
op|','
name|'False'
op|')'
op|','
nl|'\n'
name|'StoragePolicy'
op|'('
number|'2'
op|','
string|"'two'"
op|','
name|'False'
op|')'
op|']'
newline|'\n'
name|'policies'
op|'='
name|'StoragePolicyCollection'
op|'('
name|'test_policies'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'policies'
op|'.'
name|'default'
op|','
name|'test_policies'
op|'['
number|'0'
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'policies'
op|'.'
name|'default'
op|'.'
name|'name'
op|','
string|"'zero'"
op|')'
newline|'\n'
nl|'\n'
comment|'# non-zero explicit default'
nl|'\n'
name|'test_policies'
op|'='
op|'['
name|'StoragePolicy'
op|'('
number|'0'
op|','
string|"'zero'"
op|','
name|'False'
op|')'
op|','
nl|'\n'
name|'StoragePolicy'
op|'('
number|'1'
op|','
string|"'one'"
op|','
name|'False'
op|')'
op|','
nl|'\n'
name|'StoragePolicy'
op|'('
number|'2'
op|','
string|"'two'"
op|','
name|'True'
op|')'
op|']'
newline|'\n'
name|'policies'
op|'='
name|'StoragePolicyCollection'
op|'('
name|'test_policies'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'policies'
op|'.'
name|'default'
op|','
name|'test_policies'
op|'['
number|'2'
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'policies'
op|'.'
name|'default'
op|'.'
name|'name'
op|','
string|"'two'"
op|')'
newline|'\n'
nl|'\n'
comment|'# multiple defaults'
nl|'\n'
name|'test_policies'
op|'='
op|'['
name|'StoragePolicy'
op|'('
number|'0'
op|','
string|"'zero'"
op|','
name|'False'
op|')'
op|','
nl|'\n'
name|'StoragePolicy'
op|'('
number|'1'
op|','
string|"'one'"
op|','
name|'True'
op|')'
op|','
nl|'\n'
name|'StoragePolicy'
op|'('
number|'2'
op|','
string|"'two'"
op|','
name|'True'
op|')'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertRaisesWithMessage'
op|'('
nl|'\n'
name|'PolicyError'
op|','
string|"'Duplicate default'"
op|','
name|'StoragePolicyCollection'
op|','
nl|'\n'
name|'test_policies'
op|')'
newline|'\n'
nl|'\n'
comment|'# nothing specified'
nl|'\n'
name|'test_policies'
op|'='
op|'['
op|']'
newline|'\n'
name|'policies'
op|'='
name|'StoragePolicyCollection'
op|'('
name|'test_policies'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'policies'
op|'.'
name|'default'
op|','
name|'policies'
op|'['
number|'0'
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'policies'
op|'.'
name|'default'
op|'.'
name|'name'
op|','
string|"'Policy-0'"
op|')'
newline|'\n'
nl|'\n'
comment|'# no default specified with only policy index 0'
nl|'\n'
name|'test_policies'
op|'='
op|'['
name|'StoragePolicy'
op|'('
number|'0'
op|','
string|"'zero'"
op|')'
op|']'
newline|'\n'
name|'policies'
op|'='
name|'StoragePolicyCollection'
op|'('
name|'test_policies'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'policies'
op|'.'
name|'default'
op|','
name|'policies'
op|'['
number|'0'
op|']'
op|')'
newline|'\n'
nl|'\n'
comment|'# no default specified with multiple policies'
nl|'\n'
name|'test_policies'
op|'='
op|'['
name|'StoragePolicy'
op|'('
number|'0'
op|','
string|"'zero'"
op|','
name|'False'
op|')'
op|','
nl|'\n'
name|'StoragePolicy'
op|'('
number|'1'
op|','
string|"'one'"
op|','
name|'False'
op|')'
op|','
nl|'\n'
name|'StoragePolicy'
op|'('
number|'2'
op|','
string|"'two'"
op|','
name|'False'
op|')'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertRaisesWithMessage'
op|'('
nl|'\n'
name|'PolicyError'
op|','
string|"'Unable to find default policy'"
op|','
nl|'\n'
name|'StoragePolicyCollection'
op|','
name|'test_policies'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_deprecate_policies
dedent|''
name|'def'
name|'test_deprecate_policies'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# deprecation specified'
nl|'\n'
indent|'        '
name|'test_policies'
op|'='
op|'['
name|'StoragePolicy'
op|'('
number|'0'
op|','
string|"'zero'"
op|','
name|'True'
op|')'
op|','
nl|'\n'
name|'StoragePolicy'
op|'('
number|'1'
op|','
string|"'one'"
op|','
name|'False'
op|')'
op|','
nl|'\n'
name|'StoragePolicy'
op|'('
number|'2'
op|','
string|"'two'"
op|','
name|'False'
op|','
name|'is_deprecated'
op|'='
name|'True'
op|')'
op|']'
newline|'\n'
name|'policies'
op|'='
name|'StoragePolicyCollection'
op|'('
name|'test_policies'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'policies'
op|'.'
name|'default'
op|','
name|'test_policies'
op|'['
number|'0'
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'policies'
op|'.'
name|'default'
op|'.'
name|'name'
op|','
string|"'zero'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'len'
op|'('
name|'policies'
op|')'
op|','
number|'3'
op|')'
newline|'\n'
nl|'\n'
comment|'# multiple policies requires default'
nl|'\n'
name|'test_policies'
op|'='
op|'['
name|'StoragePolicy'
op|'('
number|'0'
op|','
string|"'zero'"
op|','
name|'False'
op|')'
op|','
nl|'\n'
name|'StoragePolicy'
op|'('
number|'1'
op|','
string|"'one'"
op|','
name|'False'
op|','
name|'is_deprecated'
op|'='
name|'True'
op|')'
op|','
nl|'\n'
name|'StoragePolicy'
op|'('
number|'2'
op|','
string|"'two'"
op|','
name|'False'
op|')'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertRaisesWithMessage'
op|'('
nl|'\n'
name|'PolicyError'
op|','
string|"'Unable to find default policy'"
op|','
nl|'\n'
name|'StoragePolicyCollection'
op|','
name|'test_policies'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_validate_policies_indexes
dedent|''
name|'def'
name|'test_validate_policies_indexes'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# duplicate indexes'
nl|'\n'
indent|'        '
name|'test_policies'
op|'='
op|'['
name|'StoragePolicy'
op|'('
number|'0'
op|','
string|"'zero'"
op|','
name|'True'
op|')'
op|','
nl|'\n'
name|'StoragePolicy'
op|'('
number|'1'
op|','
string|"'one'"
op|','
name|'False'
op|')'
op|','
nl|'\n'
name|'StoragePolicy'
op|'('
number|'1'
op|','
string|"'two'"
op|','
name|'False'
op|')'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'PolicyError'
op|','
name|'StoragePolicyCollection'
op|','
nl|'\n'
name|'test_policies'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_validate_policy_params
dedent|''
name|'def'
name|'test_validate_policy_params'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'StoragePolicy'
op|'('
number|'0'
op|','
string|"'name'"
op|')'
comment|'# sanity'
newline|'\n'
comment|'# bogus indexes'
nl|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'PolicyError'
op|','
name|'StoragePolicy'
op|','
string|"'x'"
op|','
string|"'name'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'PolicyError'
op|','
name|'StoragePolicy'
op|','
op|'-'
number|'1'
op|','
string|"'name'"
op|')'
newline|'\n'
comment|'# non-zero Policy-0'
nl|'\n'
name|'self'
op|'.'
name|'assertRaisesWithMessage'
op|'('
name|'PolicyError'
op|','
string|"'reserved'"
op|','
name|'StoragePolicy'
op|','
nl|'\n'
number|'1'
op|','
string|"'policy-0'"
op|')'
newline|'\n'
comment|'# deprecate default'
nl|'\n'
name|'self'
op|'.'
name|'assertRaisesWithMessage'
op|'('
nl|'\n'
name|'PolicyError'
op|','
string|"'Deprecated policy can not be default'"
op|','
nl|'\n'
name|'StoragePolicy'
op|','
number|'1'
op|','
string|"'Policy-1'"
op|','
name|'is_default'
op|'='
name|'True'
op|','
nl|'\n'
name|'is_deprecated'
op|'='
name|'True'
op|')'
newline|'\n'
comment|'# weird names'
nl|'\n'
name|'names'
op|'='
op|'('
nl|'\n'
string|"''"
op|','
nl|'\n'
string|"'name_foo'"
op|','
nl|'\n'
string|"'name\\nfoo'"
op|','
nl|'\n'
string|"'name foo'"
op|','
nl|'\n'
string|"u'name \\u062a'"
op|','
nl|'\n'
string|"'name \\xd8\\xaa'"
op|','
nl|'\n'
op|')'
newline|'\n'
name|'for'
name|'name'
name|'in'
name|'names'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertRaisesWithMessage'
op|'('
name|'PolicyError'
op|','
string|"'Invalid name'"
op|','
nl|'\n'
name|'StoragePolicy'
op|','
number|'1'
op|','
name|'name'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_validate_policies_names
dedent|''
dedent|''
name|'def'
name|'test_validate_policies_names'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# duplicate names'
nl|'\n'
indent|'        '
name|'test_policies'
op|'='
op|'['
name|'StoragePolicy'
op|'('
number|'0'
op|','
string|"'zero'"
op|','
name|'True'
op|')'
op|','
nl|'\n'
name|'StoragePolicy'
op|'('
number|'1'
op|','
string|"'zero'"
op|','
name|'False'
op|')'
op|','
nl|'\n'
name|'StoragePolicy'
op|'('
number|'2'
op|','
string|"'two'"
op|','
name|'False'
op|')'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'PolicyError'
op|','
name|'StoragePolicyCollection'
op|','
nl|'\n'
name|'test_policies'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_names_are_normalized
dedent|''
name|'def'
name|'test_names_are_normalized'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'test_policies'
op|'='
op|'['
name|'StoragePolicy'
op|'('
number|'0'
op|','
string|"'zero'"
op|','
name|'True'
op|')'
op|','
nl|'\n'
name|'StoragePolicy'
op|'('
number|'1'
op|','
string|"'ZERO'"
op|','
name|'False'
op|')'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'PolicyError'
op|','
name|'StoragePolicyCollection'
op|','
nl|'\n'
name|'test_policies'
op|')'
newline|'\n'
nl|'\n'
name|'policies'
op|'='
name|'StoragePolicyCollection'
op|'('
op|'['
name|'StoragePolicy'
op|'('
number|'0'
op|','
string|"'zEro'"
op|','
name|'True'
op|')'
op|','
nl|'\n'
name|'StoragePolicy'
op|'('
number|'1'
op|','
string|"'One'"
op|','
name|'False'
op|')'
op|']'
op|')'
newline|'\n'
nl|'\n'
name|'pol0'
op|'='
name|'policies'
op|'['
number|'0'
op|']'
newline|'\n'
name|'pol1'
op|'='
name|'policies'
op|'['
number|'1'
op|']'
newline|'\n'
nl|'\n'
name|'for'
name|'name'
name|'in'
op|'('
string|"'zero'"
op|','
string|"'ZERO'"
op|','
string|"'zErO'"
op|','
string|"'ZeRo'"
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'pol0'
op|','
name|'policies'
op|'.'
name|'get_by_name'
op|'('
name|'name'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'policies'
op|'.'
name|'get_by_name'
op|'('
name|'name'
op|')'
op|'.'
name|'name'
op|','
string|"'zEro'"
op|')'
newline|'\n'
dedent|''
name|'for'
name|'name'
name|'in'
op|'('
string|"'one'"
op|','
string|"'ONE'"
op|','
string|"'oNe'"
op|','
string|"'OnE'"
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'pol1'
op|','
name|'policies'
op|'.'
name|'get_by_name'
op|'('
name|'name'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'policies'
op|'.'
name|'get_by_name'
op|'('
name|'name'
op|')'
op|'.'
name|'name'
op|','
string|"'One'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|assertRaisesWithMessage
dedent|''
dedent|''
name|'def'
name|'assertRaisesWithMessage'
op|'('
name|'self'
op|','
name|'exc_class'
op|','
name|'message'
op|','
name|'f'
op|','
op|'*'
name|'args'
op|','
op|'**'
name|'kwargs'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'f'
op|'('
op|'*'
name|'args'
op|','
op|'**'
name|'kwargs'
op|')'
newline|'\n'
dedent|''
name|'except'
name|'exc_class'
name|'as'
name|'err'
op|':'
newline|'\n'
indent|'            '
name|'err_msg'
op|'='
name|'str'
op|'('
name|'err'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_'
op|'('
name|'message'
name|'in'
name|'err_msg'
op|','
string|"'Error message %r did not '"
nl|'\n'
string|"'have expected substring %r'"
op|'%'
op|'('
name|'err_msg'
op|','
name|'message'
op|')'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'fail'
op|'('
string|"'%r did not raise %s'"
op|'%'
op|'('
name|'message'
op|','
name|'exc_class'
op|'.'
name|'__name__'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_deprecated_default
dedent|''
dedent|''
name|'def'
name|'test_deprecated_default'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'bad_conf'
op|'='
name|'self'
op|'.'
name|'_conf'
op|'('
string|'"""\n        [storage-policy:1]\n        name = one\n        deprecated = yes\n        default = yes\n        """'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertRaisesWithMessage'
op|'('
nl|'\n'
name|'PolicyError'
op|','
string|'"Deprecated policy can not be default"'
op|','
nl|'\n'
name|'parse_storage_policies'
op|','
name|'bad_conf'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_multiple_policies_with_no_policy_index_zero
dedent|''
name|'def'
name|'test_multiple_policies_with_no_policy_index_zero'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'bad_conf'
op|'='
name|'self'
op|'.'
name|'_conf'
op|'('
string|'"""\n        [storage-policy:1]\n        name = one\n        default = yes\n        """'
op|')'
newline|'\n'
nl|'\n'
comment|'# Policy-0 will not be implicitly added if other policies are defined'
nl|'\n'
name|'self'
op|'.'
name|'assertRaisesWithMessage'
op|'('
nl|'\n'
name|'PolicyError'
op|','
string|'"must specify a storage policy section "'
nl|'\n'
string|'"for policy index 0"'
op|','
name|'parse_storage_policies'
op|','
name|'bad_conf'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_no_default
dedent|''
name|'def'
name|'test_no_default'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'orig_conf'
op|'='
name|'self'
op|'.'
name|'_conf'
op|'('
string|'"""\n        [storage-policy:0]\n        name = zero\n        [storage-policy:1]\n        name = one\n        default = yes\n        """'
op|')'
newline|'\n'
nl|'\n'
name|'policies'
op|'='
name|'parse_storage_policies'
op|'('
name|'orig_conf'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'policies'
op|'.'
name|'default'
op|','
name|'policies'
op|'['
number|'1'
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_'
op|'('
name|'policies'
op|'['
number|'0'
op|']'
op|'.'
name|'name'
op|','
string|"'Policy-0'"
op|')'
newline|'\n'
nl|'\n'
name|'bad_conf'
op|'='
name|'self'
op|'.'
name|'_conf'
op|'('
string|'"""\n        [storage-policy:0]\n        name = zero\n        [storage-policy:1]\n        name = one\n        deprecated = yes\n        """'
op|')'
newline|'\n'
nl|'\n'
comment|'# multiple polices and no explicit default'
nl|'\n'
name|'self'
op|'.'
name|'assertRaisesWithMessage'
op|'('
nl|'\n'
name|'PolicyError'
op|','
string|'"Unable to find default"'
op|','
nl|'\n'
name|'parse_storage_policies'
op|','
name|'bad_conf'
op|')'
newline|'\n'
nl|'\n'
name|'good_conf'
op|'='
name|'self'
op|'.'
name|'_conf'
op|'('
string|'"""\n        [storage-policy:0]\n        name = Policy-0\n        default = yes\n        [storage-policy:1]\n        name = one\n        deprecated = yes\n        """'
op|')'
newline|'\n'
nl|'\n'
name|'policies'
op|'='
name|'parse_storage_policies'
op|'('
name|'good_conf'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'policies'
op|'.'
name|'default'
op|','
name|'policies'
op|'['
number|'0'
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_'
op|'('
name|'policies'
op|'['
number|'1'
op|']'
op|'.'
name|'is_deprecated'
op|','
name|'True'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_parse_storage_policies
dedent|''
name|'def'
name|'test_parse_storage_policies'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# ValueError when deprecating policy 0'
nl|'\n'
indent|'        '
name|'bad_conf'
op|'='
name|'self'
op|'.'
name|'_conf'
op|'('
string|'"""\n        [storage-policy:0]\n        name = zero\n        deprecated = yes\n\n        [storage-policy:1]\n        name = one\n        deprecated = yes\n        """'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertRaisesWithMessage'
op|'('
nl|'\n'
name|'PolicyError'
op|','
string|'"Unable to find policy that\'s not deprecated"'
op|','
nl|'\n'
name|'parse_storage_policies'
op|','
name|'bad_conf'
op|')'
newline|'\n'
nl|'\n'
name|'bad_conf'
op|'='
name|'self'
op|'.'
name|'_conf'
op|'('
string|'"""\n        [storage-policy:]\n        name = zero\n        """'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertRaisesWithMessage'
op|'('
name|'PolicyError'
op|','
string|"'Invalid index'"
op|','
nl|'\n'
name|'parse_storage_policies'
op|','
name|'bad_conf'
op|')'
newline|'\n'
nl|'\n'
name|'bad_conf'
op|'='
name|'self'
op|'.'
name|'_conf'
op|'('
string|'"""\n        [storage-policy:-1]\n        name = zero\n        """'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertRaisesWithMessage'
op|'('
name|'PolicyError'
op|','
string|"'Invalid index'"
op|','
nl|'\n'
name|'parse_storage_policies'
op|','
name|'bad_conf'
op|')'
newline|'\n'
nl|'\n'
name|'bad_conf'
op|'='
name|'self'
op|'.'
name|'_conf'
op|'('
string|'"""\n        [storage-policy:x]\n        name = zero\n        """'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertRaisesWithMessage'
op|'('
name|'PolicyError'
op|','
string|"'Invalid index'"
op|','
nl|'\n'
name|'parse_storage_policies'
op|','
name|'bad_conf'
op|')'
newline|'\n'
nl|'\n'
name|'bad_conf'
op|'='
name|'self'
op|'.'
name|'_conf'
op|'('
string|'"""\n        [storage-policy:x-1]\n        name = zero\n        """'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertRaisesWithMessage'
op|'('
name|'PolicyError'
op|','
string|"'Invalid index'"
op|','
nl|'\n'
name|'parse_storage_policies'
op|','
name|'bad_conf'
op|')'
newline|'\n'
nl|'\n'
name|'bad_conf'
op|'='
name|'self'
op|'.'
name|'_conf'
op|'('
string|'"""\n        [storage-policy:x]\n        name = zero\n        """'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertRaisesWithMessage'
op|'('
name|'PolicyError'
op|','
string|"'Invalid index'"
op|','
nl|'\n'
name|'parse_storage_policies'
op|','
name|'bad_conf'
op|')'
newline|'\n'
nl|'\n'
name|'bad_conf'
op|'='
name|'self'
op|'.'
name|'_conf'
op|'('
string|'"""\n        [storage-policy:x:1]\n        name = zero\n        """'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertRaisesWithMessage'
op|'('
name|'PolicyError'
op|','
string|"'Invalid index'"
op|','
nl|'\n'
name|'parse_storage_policies'
op|','
name|'bad_conf'
op|')'
newline|'\n'
nl|'\n'
name|'bad_conf'
op|'='
name|'self'
op|'.'
name|'_conf'
op|'('
string|'"""\n        [storage-policy:1]\n        name = zero\n        boo = berries\n        """'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertRaisesWithMessage'
op|'('
name|'PolicyError'
op|','
string|"'Invalid option'"
op|','
nl|'\n'
name|'parse_storage_policies'
op|','
name|'bad_conf'
op|')'
newline|'\n'
nl|'\n'
name|'bad_conf'
op|'='
name|'self'
op|'.'
name|'_conf'
op|'('
string|'"""\n        [storage-policy:0]\n        name =\n        """'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertRaisesWithMessage'
op|'('
name|'PolicyError'
op|','
string|"'Invalid name'"
op|','
nl|'\n'
name|'parse_storage_policies'
op|','
name|'bad_conf'
op|')'
newline|'\n'
nl|'\n'
name|'bad_conf'
op|'='
name|'self'
op|'.'
name|'_conf'
op|'('
string|'"""\n        [storage-policy:3]\n        name = Policy-0\n        """'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertRaisesWithMessage'
op|'('
name|'PolicyError'
op|','
string|"'Invalid name'"
op|','
nl|'\n'
name|'parse_storage_policies'
op|','
name|'bad_conf'
op|')'
newline|'\n'
nl|'\n'
name|'bad_conf'
op|'='
name|'self'
op|'.'
name|'_conf'
op|'('
string|'"""\n        [storage-policy:1]\n        name = policY-0\n        """'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertRaisesWithMessage'
op|'('
name|'PolicyError'
op|','
string|"'Invalid name'"
op|','
nl|'\n'
name|'parse_storage_policies'
op|','
name|'bad_conf'
op|')'
newline|'\n'
nl|'\n'
name|'bad_conf'
op|'='
name|'self'
op|'.'
name|'_conf'
op|'('
string|'"""\n        [storage-policy:0]\n        name = one\n        [storage-policy:1]\n        name = ONE\n        """'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertRaisesWithMessage'
op|'('
name|'PolicyError'
op|','
string|"'Duplicate name'"
op|','
nl|'\n'
name|'parse_storage_policies'
op|','
name|'bad_conf'
op|')'
newline|'\n'
nl|'\n'
name|'bad_conf'
op|'='
name|'self'
op|'.'
name|'_conf'
op|'('
string|'"""\n        [storage-policy:0]\n        name = good_stuff\n        """'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertRaisesWithMessage'
op|'('
name|'PolicyError'
op|','
string|"'Invalid name'"
op|','
nl|'\n'
name|'parse_storage_policies'
op|','
name|'bad_conf'
op|')'
newline|'\n'
nl|'\n'
comment|'# Additional section added to ensure parser ignores other sections'
nl|'\n'
name|'conf'
op|'='
name|'self'
op|'.'
name|'_conf'
op|'('
string|'"""\n        [some-other-section]\n        foo = bar\n        [storage-policy:0]\n        name = zero\n        [storage-policy:5]\n        name = one\n        default = yes\n        [storage-policy:6]\n        name = duplicate-sections-are-ignored\n        [storage-policy:6]\n        name = apple\n        """'
op|')'
newline|'\n'
name|'policies'
op|'='
name|'parse_storage_policies'
op|'('
name|'conf'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'True'
op|','
name|'policies'
op|'.'
name|'get_by_index'
op|'('
number|'5'
op|')'
op|'.'
name|'is_default'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'False'
op|','
name|'policies'
op|'.'
name|'get_by_index'
op|'('
number|'0'
op|')'
op|'.'
name|'is_default'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'False'
op|','
name|'policies'
op|'.'
name|'get_by_index'
op|'('
number|'6'
op|')'
op|'.'
name|'is_default'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
string|'"object"'
op|','
name|'policies'
op|'.'
name|'get_by_name'
op|'('
string|'"zero"'
op|')'
op|'.'
name|'ring_name'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
string|'"object-5"'
op|','
name|'policies'
op|'.'
name|'get_by_name'
op|'('
string|'"one"'
op|')'
op|'.'
name|'ring_name'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
string|'"object-6"'
op|','
name|'policies'
op|'.'
name|'get_by_name'
op|'('
string|'"apple"'
op|')'
op|'.'
name|'ring_name'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'0'
op|','
name|'int'
op|'('
name|'policies'
op|'.'
name|'get_by_name'
op|'('
string|"'zero'"
op|')'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'5'
op|','
name|'int'
op|'('
name|'policies'
op|'.'
name|'get_by_name'
op|'('
string|"'one'"
op|')'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'6'
op|','
name|'int'
op|'('
name|'policies'
op|'.'
name|'get_by_name'
op|'('
string|"'apple'"
op|')'
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
string|'"zero"'
op|','
name|'policies'
op|'.'
name|'get_by_index'
op|'('
number|'0'
op|')'
op|'.'
name|'name'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
string|'"zero"'
op|','
name|'policies'
op|'.'
name|'get_by_index'
op|'('
string|'"0"'
op|')'
op|'.'
name|'name'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
string|'"one"'
op|','
name|'policies'
op|'.'
name|'get_by_index'
op|'('
number|'5'
op|')'
op|'.'
name|'name'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
string|'"apple"'
op|','
name|'policies'
op|'.'
name|'get_by_index'
op|'('
number|'6'
op|')'
op|'.'
name|'name'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
string|'"zero"'
op|','
name|'policies'
op|'.'
name|'get_by_index'
op|'('
name|'None'
op|')'
op|'.'
name|'name'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
string|'"zero"'
op|','
name|'policies'
op|'.'
name|'get_by_index'
op|'('
string|"''"
op|')'
op|'.'
name|'name'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_reload_invalid_storage_policies
dedent|''
name|'def'
name|'test_reload_invalid_storage_policies'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'conf'
op|'='
name|'self'
op|'.'
name|'_conf'
op|'('
string|'"""\n        [storage-policy:0]\n        name = zero\n        [storage-policy:00]\n        name = double-zero\n        """'
op|')'
newline|'\n'
name|'with'
name|'NamedTemporaryFile'
op|'('
op|')'
name|'as'
name|'f'
op|':'
newline|'\n'
indent|'            '
name|'conf'
op|'.'
name|'write'
op|'('
name|'f'
op|')'
newline|'\n'
name|'f'
op|'.'
name|'flush'
op|'('
op|')'
newline|'\n'
name|'with'
name|'mock'
op|'.'
name|'patch'
op|'('
string|"'swift.common.storage_policy.SWIFT_CONF_FILE'"
op|','
nl|'\n'
name|'new'
op|'='
name|'f'
op|'.'
name|'name'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'try'
op|':'
newline|'\n'
indent|'                    '
name|'reload_storage_policies'
op|'('
op|')'
newline|'\n'
dedent|''
name|'except'
name|'SystemExit'
name|'as'
name|'e'
op|':'
newline|'\n'
indent|'                    '
name|'err_msg'
op|'='
name|'str'
op|'('
name|'e'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                    '
name|'self'
op|'.'
name|'fail'
op|'('
string|"'SystemExit not raised'"
op|')'
newline|'\n'
dedent|''
dedent|''
dedent|''
name|'parts'
op|'='
op|'['
nl|'\n'
string|"'Invalid Storage Policy Configuration'"
op|','
nl|'\n'
string|"'Duplicate index'"
op|','
nl|'\n'
op|']'
newline|'\n'
name|'for'
name|'expected'
name|'in'
name|'parts'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assert_'
op|'('
name|'expected'
name|'in'
name|'err_msg'
op|','
string|"'%s was not in %s'"
op|'%'
op|'('
name|'expected'
op|','
nl|'\n'
name|'err_msg'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_storage_policy_ordering
dedent|''
dedent|''
name|'def'
name|'test_storage_policy_ordering'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'test_policies'
op|'='
name|'StoragePolicyCollection'
op|'('
op|'['
nl|'\n'
name|'StoragePolicy'
op|'('
number|'0'
op|','
string|"'zero'"
op|','
name|'is_default'
op|'='
name|'True'
op|')'
op|','
nl|'\n'
name|'StoragePolicy'
op|'('
number|'503'
op|','
string|"'error'"
op|')'
op|','
nl|'\n'
name|'StoragePolicy'
op|'('
number|'204'
op|','
string|"'empty'"
op|')'
op|','
nl|'\n'
name|'StoragePolicy'
op|'('
number|'404'
op|','
string|"'missing'"
op|')'
op|','
nl|'\n'
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
op|'['
number|'0'
op|','
number|'204'
op|','
number|'404'
op|','
number|'503'
op|']'
op|','
op|'['
name|'int'
op|'('
name|'p'
op|')'
name|'for'
name|'p'
name|'in'
nl|'\n'
name|'sorted'
op|'('
name|'list'
op|'('
name|'test_policies'
op|')'
op|')'
op|']'
op|')'
newline|'\n'
nl|'\n'
name|'p503'
op|'='
name|'test_policies'
op|'['
number|'503'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
number|'501'
op|'<'
name|'p503'
op|'<'
number|'507'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_object_ring
dedent|''
name|'def'
name|'test_get_object_ring'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'test_policies'
op|'='
op|'['
name|'StoragePolicy'
op|'('
number|'0'
op|','
string|"'aay'"
op|','
name|'True'
op|')'
op|','
nl|'\n'
name|'StoragePolicy'
op|'('
number|'1'
op|','
string|"'bee'"
op|','
name|'False'
op|')'
op|','
nl|'\n'
name|'StoragePolicy'
op|'('
number|'2'
op|','
string|"'cee'"
op|','
name|'False'
op|')'
op|']'
newline|'\n'
name|'policies'
op|'='
name|'StoragePolicyCollection'
op|'('
name|'test_policies'
op|')'
newline|'\n'
nl|'\n'
DECL|class|NamedFakeRing
name|'class'
name|'NamedFakeRing'
op|'('
name|'FakeRing'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|member|__init__
indent|'            '
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'swift_dir'
op|','
name|'ring_name'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'ring_name'
op|'='
name|'ring_name'
newline|'\n'
name|'super'
op|'('
name|'NamedFakeRing'
op|','
name|'self'
op|')'
op|'.'
name|'__init__'
op|'('
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'with'
name|'mock'
op|'.'
name|'patch'
op|'('
string|"'swift.common.storage_policy.Ring'"
op|','
nl|'\n'
name|'new'
op|'='
name|'NamedFakeRing'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'for'
name|'policy'
name|'in'
name|'policies'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'policy'
op|'.'
name|'object_ring'
op|')'
newline|'\n'
name|'ring'
op|'='
name|'policies'
op|'.'
name|'get_object_ring'
op|'('
name|'int'
op|'('
name|'policy'
op|')'
op|','
string|"'/path/not/used'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'ring'
op|'.'
name|'ring_name'
op|','
name|'policy'
op|'.'
name|'ring_name'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'policy'
op|'.'
name|'object_ring'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_'
op|'('
name|'isinstance'
op|'('
name|'policy'
op|'.'
name|'object_ring'
op|','
name|'NamedFakeRing'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|function|blow_up
dedent|''
dedent|''
name|'def'
name|'blow_up'
op|'('
op|'*'
name|'args'
op|','
op|'**'
name|'kwargs'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'Exception'
op|'('
string|"'kaboom!'"
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'with'
name|'mock'
op|'.'
name|'patch'
op|'('
string|"'swift.common.storage_policy.Ring'"
op|','
name|'new'
op|'='
name|'blow_up'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'for'
name|'policy'
name|'in'
name|'policies'
op|':'
newline|'\n'
indent|'                '
name|'policy'
op|'.'
name|'load_ring'
op|'('
string|"'/path/not/used'"
op|')'
newline|'\n'
name|'expected'
op|'='
name|'policies'
op|'.'
name|'get_object_ring'
op|'('
name|'int'
op|'('
name|'policy'
op|')'
op|','
nl|'\n'
string|"'/path/not/used'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'policy'
op|'.'
name|'object_ring'
op|','
name|'expected'
op|')'
newline|'\n'
nl|'\n'
comment|'# bad policy index'
nl|'\n'
dedent|''
dedent|''
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'PolicyError'
op|','
name|'policies'
op|'.'
name|'get_object_ring'
op|','
number|'99'
op|','
nl|'\n'
string|"'/path/not/used'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_singleton_passthrough
dedent|''
name|'def'
name|'test_singleton_passthrough'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'test_policies'
op|'='
op|'['
name|'StoragePolicy'
op|'('
number|'0'
op|','
string|"'aay'"
op|','
name|'True'
op|')'
op|','
nl|'\n'
name|'StoragePolicy'
op|'('
number|'1'
op|','
string|"'bee'"
op|','
name|'False'
op|')'
op|','
nl|'\n'
name|'StoragePolicy'
op|'('
number|'2'
op|','
string|"'cee'"
op|','
name|'False'
op|')'
op|']'
newline|'\n'
name|'with'
name|'patch_policies'
op|'('
name|'test_policies'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'for'
name|'policy'
name|'in'
name|'POLICIES'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'POLICIES'
op|'['
name|'int'
op|'('
name|'policy'
op|')'
op|']'
op|','
name|'policy'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_storage_policy_get_options
dedent|''
dedent|''
dedent|''
name|'def'
name|'test_storage_policy_get_options'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'policy'
op|'='
name|'StoragePolicy'
op|'('
number|'1'
op|','
string|"'gold'"
op|','
name|'True'
op|','
name|'False'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
op|'{'
string|"'name'"
op|':'
string|"'gold'"
op|','
nl|'\n'
string|"'default'"
op|':'
name|'True'
op|','
nl|'\n'
string|"'deprecated'"
op|':'
name|'False'
op|'}'
op|','
nl|'\n'
name|'policy'
op|'.'
name|'get_options'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'policy'
op|'='
name|'StoragePolicy'
op|'('
number|'1'
op|','
string|"'gold'"
op|','
name|'False'
op|','
name|'True'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
op|'{'
string|"'name'"
op|':'
string|"'gold'"
op|','
nl|'\n'
string|"'default'"
op|':'
name|'False'
op|','
nl|'\n'
string|"'deprecated'"
op|':'
name|'True'
op|'}'
op|','
nl|'\n'
name|'policy'
op|'.'
name|'get_options'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
dedent|''
dedent|''
name|'if'
name|'__name__'
op|'=='
string|"'__main__'"
op|':'
newline|'\n'
indent|'    '
name|'unittest'
op|'.'
name|'main'
op|'('
op|')'
newline|'\n'
dedent|''
endmarker|''
end_unit
