begin_unit
comment|'# Copyright (c) 2010 OpenStack, LLC.'
nl|'\n'
comment|'#'
nl|'\n'
comment|'# Licensed under the Apache License, Version 2.0 (the "License");'
nl|'\n'
comment|'# you may not use this file except in compliance with the License.'
nl|'\n'
comment|'# You may obtain a copy of the License at'
nl|'\n'
comment|'#'
nl|'\n'
comment|'#    http://www.apache.org/licenses/LICENSE-2.0'
nl|'\n'
comment|'#'
nl|'\n'
comment|'# Unless required by applicable law or agreed to in writing, software'
nl|'\n'
comment|'# distributed under the License is distributed on an "AS IS" BASIS,'
nl|'\n'
comment|'# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or'
nl|'\n'
comment|'# implied.'
nl|'\n'
comment|'# See the License for the specific language governing permissions and'
nl|'\n'
comment|'# limitations under the License.'
nl|'\n'
nl|'\n'
name|'try'
op|':'
newline|'\n'
indent|'    '
name|'import'
name|'simplejson'
name|'as'
name|'json'
newline|'\n'
dedent|''
name|'except'
name|'ImportError'
op|':'
newline|'\n'
indent|'    '
name|'import'
name|'json'
newline|'\n'
dedent|''
name|'import'
name|'unittest'
newline|'\n'
name|'from'
name|'contextlib'
name|'import'
name|'contextmanager'
newline|'\n'
name|'from'
name|'time'
name|'import'
name|'time'
newline|'\n'
nl|'\n'
name|'from'
name|'webob'
name|'import'
name|'Request'
op|','
name|'Response'
newline|'\n'
nl|'\n'
name|'from'
name|'swift'
op|'.'
name|'common'
op|'.'
name|'middleware'
name|'import'
name|'swauth'
name|'as'
name|'auth'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|FakeMemcache
name|'class'
name|'FakeMemcache'
op|'('
name|'object'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|member|__init__
indent|'    '
name|'def'
name|'__init__'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'store'
op|'='
op|'{'
op|'}'
newline|'\n'
nl|'\n'
DECL|member|get
dedent|''
name|'def'
name|'get'
op|'('
name|'self'
op|','
name|'key'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'self'
op|'.'
name|'store'
op|'.'
name|'get'
op|'('
name|'key'
op|')'
newline|'\n'
nl|'\n'
DECL|member|set
dedent|''
name|'def'
name|'set'
op|'('
name|'self'
op|','
name|'key'
op|','
name|'value'
op|','
name|'timeout'
op|'='
number|'0'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'store'
op|'['
name|'key'
op|']'
op|'='
name|'value'
newline|'\n'
name|'return'
name|'True'
newline|'\n'
nl|'\n'
DECL|member|incr
dedent|''
name|'def'
name|'incr'
op|'('
name|'self'
op|','
name|'key'
op|','
name|'timeout'
op|'='
number|'0'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'store'
op|'['
name|'key'
op|']'
op|'='
name|'self'
op|'.'
name|'store'
op|'.'
name|'setdefault'
op|'('
name|'key'
op|','
number|'0'
op|')'
op|'+'
number|'1'
newline|'\n'
name|'return'
name|'self'
op|'.'
name|'store'
op|'['
name|'key'
op|']'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'contextmanager'
newline|'\n'
DECL|member|soft_lock
name|'def'
name|'soft_lock'
op|'('
name|'self'
op|','
name|'key'
op|','
name|'timeout'
op|'='
number|'0'
op|','
name|'retries'
op|'='
number|'5'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'yield'
name|'True'
newline|'\n'
nl|'\n'
DECL|member|delete
dedent|''
name|'def'
name|'delete'
op|'('
name|'self'
op|','
name|'key'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'del'
name|'self'
op|'.'
name|'store'
op|'['
name|'key'
op|']'
newline|'\n'
dedent|''
name|'except'
op|':'
newline|'\n'
indent|'            '
name|'pass'
newline|'\n'
dedent|''
name|'return'
name|'True'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|FakeApp
dedent|''
dedent|''
name|'class'
name|'FakeApp'
op|'('
name|'object'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|member|__init__
indent|'    '
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'status_headers_body_iter'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'calls'
op|'='
number|'0'
newline|'\n'
name|'self'
op|'.'
name|'status_headers_body_iter'
op|'='
name|'status_headers_body_iter'
newline|'\n'
name|'if'
name|'not'
name|'self'
op|'.'
name|'status_headers_body_iter'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'status_headers_body_iter'
op|'='
name|'iter'
op|'('
op|'['
op|'('
string|"'404 Not Found'"
op|','
op|'{'
op|'}'
op|','
string|"''"
op|')'
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|__call__
dedent|''
dedent|''
name|'def'
name|'__call__'
op|'('
name|'self'
op|','
name|'env'
op|','
name|'start_response'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'calls'
op|'+='
number|'1'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"''"
op|','
name|'environ'
op|'='
name|'env'
op|')'
newline|'\n'
name|'if'
string|"'swift.authorize'"
name|'in'
name|'env'
op|':'
newline|'\n'
indent|'            '
name|'resp'
op|'='
name|'env'
op|'['
string|"'swift.authorize'"
op|']'
op|'('
name|'req'
op|')'
newline|'\n'
name|'if'
name|'resp'
op|':'
newline|'\n'
indent|'                '
name|'return'
name|'resp'
op|'('
name|'env'
op|','
name|'start_response'
op|')'
newline|'\n'
dedent|''
dedent|''
name|'status'
op|','
name|'headers'
op|','
name|'body'
op|'='
name|'self'
op|'.'
name|'status_headers_body_iter'
op|'.'
name|'next'
op|'('
op|')'
newline|'\n'
name|'return'
name|'Response'
op|'('
name|'status'
op|'='
name|'status'
op|','
name|'headers'
op|'='
name|'headers'
op|','
nl|'\n'
name|'body'
op|'='
name|'body'
op|')'
op|'('
name|'env'
op|','
name|'start_response'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|TestAuth
dedent|''
dedent|''
name|'class'
name|'TestAuth'
op|'('
name|'unittest'
op|'.'
name|'TestCase'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|member|setUp
indent|'    '
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'test_auth'
op|'='
name|'auth'
op|'.'
name|'filter_factory'
op|'('
op|'{'
string|"'super_admin_key'"
op|':'
string|"'supertest'"
op|'}'
op|')'
op|'('
name|'FakeApp'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_super_admin_key_required
dedent|''
name|'def'
name|'test_super_admin_key_required'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'app'
op|'='
name|'FakeApp'
op|'('
op|')'
newline|'\n'
name|'exc'
op|'='
name|'None'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'auth'
op|'.'
name|'filter_factory'
op|'('
op|'{'
op|'}'
op|')'
op|'('
name|'app'
op|')'
newline|'\n'
dedent|''
name|'except'
name|'ValueError'
op|','
name|'err'
op|':'
newline|'\n'
indent|'            '
name|'exc'
op|'='
name|'err'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'str'
op|'('
name|'exc'
op|')'
op|','
nl|'\n'
string|"'No super_admin_key set in conf file! Exiting.'"
op|')'
newline|'\n'
name|'auth'
op|'.'
name|'filter_factory'
op|'('
op|'{'
string|"'super_admin_key'"
op|':'
string|"'supertest'"
op|'}'
op|')'
op|'('
name|'app'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_reseller_prefix_init
dedent|''
name|'def'
name|'test_reseller_prefix_init'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'app'
op|'='
name|'FakeApp'
op|'('
op|')'
newline|'\n'
name|'ath'
op|'='
name|'auth'
op|'.'
name|'filter_factory'
op|'('
op|'{'
string|"'super_admin_key'"
op|':'
string|"'supertest'"
op|'}'
op|')'
op|'('
name|'app'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'ath'
op|'.'
name|'reseller_prefix'
op|','
string|"'AUTH_'"
op|')'
newline|'\n'
name|'ath'
op|'='
name|'auth'
op|'.'
name|'filter_factory'
op|'('
op|'{'
string|"'super_admin_key'"
op|':'
string|"'supertest'"
op|','
nl|'\n'
string|"'reseller_prefix'"
op|':'
string|"'TEST'"
op|'}'
op|')'
op|'('
name|'app'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'ath'
op|'.'
name|'reseller_prefix'
op|','
string|"'TEST_'"
op|')'
newline|'\n'
name|'ath'
op|'='
name|'auth'
op|'.'
name|'filter_factory'
op|'('
op|'{'
string|"'super_admin_key'"
op|':'
string|"'supertest'"
op|','
nl|'\n'
string|"'reseller_prefix'"
op|':'
string|"'TEST_'"
op|'}'
op|')'
op|'('
name|'app'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'ath'
op|'.'
name|'reseller_prefix'
op|','
string|"'TEST_'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_auth_prefix_init
dedent|''
name|'def'
name|'test_auth_prefix_init'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'app'
op|'='
name|'FakeApp'
op|'('
op|')'
newline|'\n'
name|'ath'
op|'='
name|'auth'
op|'.'
name|'filter_factory'
op|'('
op|'{'
string|"'super_admin_key'"
op|':'
string|"'supertest'"
op|'}'
op|')'
op|'('
name|'app'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'ath'
op|'.'
name|'auth_prefix'
op|','
string|"'/auth/'"
op|')'
newline|'\n'
name|'ath'
op|'='
name|'auth'
op|'.'
name|'filter_factory'
op|'('
op|'{'
string|"'super_admin_key'"
op|':'
string|"'supertest'"
op|','
nl|'\n'
string|"'auth_prefix'"
op|':'
string|"''"
op|'}'
op|')'
op|'('
name|'app'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'ath'
op|'.'
name|'auth_prefix'
op|','
string|"'/auth/'"
op|')'
newline|'\n'
name|'ath'
op|'='
name|'auth'
op|'.'
name|'filter_factory'
op|'('
op|'{'
string|"'super_admin_key'"
op|':'
string|"'supertest'"
op|','
nl|'\n'
string|"'auth_prefix'"
op|':'
string|"'/test/'"
op|'}'
op|')'
op|'('
name|'app'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'ath'
op|'.'
name|'auth_prefix'
op|','
string|"'/test/'"
op|')'
newline|'\n'
name|'ath'
op|'='
name|'auth'
op|'.'
name|'filter_factory'
op|'('
op|'{'
string|"'super_admin_key'"
op|':'
string|"'supertest'"
op|','
nl|'\n'
string|"'auth_prefix'"
op|':'
string|"'/test'"
op|'}'
op|')'
op|'('
name|'app'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'ath'
op|'.'
name|'auth_prefix'
op|','
string|"'/test/'"
op|')'
newline|'\n'
name|'ath'
op|'='
name|'auth'
op|'.'
name|'filter_factory'
op|'('
op|'{'
string|"'super_admin_key'"
op|':'
string|"'supertest'"
op|','
nl|'\n'
string|"'auth_prefix'"
op|':'
string|"'test/'"
op|'}'
op|')'
op|'('
name|'app'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'ath'
op|'.'
name|'auth_prefix'
op|','
string|"'/test/'"
op|')'
newline|'\n'
name|'ath'
op|'='
name|'auth'
op|'.'
name|'filter_factory'
op|'('
op|'{'
string|"'super_admin_key'"
op|':'
string|"'supertest'"
op|','
nl|'\n'
string|"'auth_prefix'"
op|':'
string|"'test'"
op|'}'
op|')'
op|'('
name|'app'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'ath'
op|'.'
name|'auth_prefix'
op|','
string|"'/test/'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_default_swift_cluster_init
dedent|''
name|'def'
name|'test_default_swift_cluster_init'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'app'
op|'='
name|'FakeApp'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'Exception'
op|','
name|'auth'
op|'.'
name|'filter_factory'
op|'('
op|'{'
nl|'\n'
string|"'super_admin_key'"
op|':'
string|"'supertest'"
op|','
nl|'\n'
string|"'default_swift_cluster'"
op|':'
string|"'local:badscheme://host/path'"
op|'}'
op|')'
op|','
name|'app'
op|')'
newline|'\n'
name|'ath'
op|'='
name|'auth'
op|'.'
name|'filter_factory'
op|'('
op|'{'
string|"'super_admin_key'"
op|':'
string|"'supertest'"
op|'}'
op|')'
op|'('
name|'app'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'ath'
op|'.'
name|'default_swift_cluster'
op|','
nl|'\n'
string|"'local:http://127.0.0.1:8080/v1'"
op|')'
newline|'\n'
name|'ath'
op|'='
name|'auth'
op|'.'
name|'filter_factory'
op|'('
op|'{'
string|"'super_admin_key'"
op|':'
string|"'supertest'"
op|','
nl|'\n'
string|"'default_swift_cluster'"
op|':'
string|"'local:http://host/path'"
op|'}'
op|')'
op|'('
name|'app'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'ath'
op|'.'
name|'default_swift_cluster'
op|','
nl|'\n'
string|"'local:http://host/path'"
op|')'
newline|'\n'
name|'ath'
op|'='
name|'auth'
op|'.'
name|'filter_factory'
op|'('
op|'{'
string|"'super_admin_key'"
op|':'
string|"'supertest'"
op|','
nl|'\n'
string|"'default_swift_cluster'"
op|':'
string|"'local:http://host/path/'"
op|'}'
op|')'
op|'('
name|'app'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'ath'
op|'.'
name|'default_swift_cluster'
op|','
nl|'\n'
string|"'local:http://host/path'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_auth_deny_non_reseller_prefix
dedent|''
name|'def'
name|'test_auth_deny_non_reseller_prefix'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'resp'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/v1/BLAH_account'"
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Auth-Token'"
op|':'
string|"'BLAH_t'"
op|'}'
op|')'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'401'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'environ'
op|'['
string|"'swift.authorize'"
op|']'
op|','
nl|'\n'
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'denied_response'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_auth_deny_non_reseller_prefix_no_override
dedent|''
name|'def'
name|'test_auth_deny_non_reseller_prefix_no_override'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'fake_authorize'
op|'='
name|'lambda'
name|'x'
op|':'
name|'Response'
op|'('
name|'status'
op|'='
string|"'500 Fake'"
op|')'
newline|'\n'
name|'resp'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/v1/BLAH_account'"
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Auth-Token'"
op|':'
string|"'BLAH_t'"
op|'}'
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'swift.authorize'"
op|':'
name|'fake_authorize'
op|'}'
nl|'\n'
op|')'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'500'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'environ'
op|'['
string|"'swift.authorize'"
op|']'
op|','
name|'fake_authorize'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_auth_no_reseller_prefix_deny
dedent|''
name|'def'
name|'test_auth_no_reseller_prefix_deny'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|"# Ensures that when we have no reseller prefix, we don't deny a request"
nl|'\n'
comment|'# outright but set up a denial swift.authorize and pass the request on'
nl|'\n'
comment|'# down the chain.'
nl|'\n'
indent|'        '
name|'local_app'
op|'='
name|'FakeApp'
op|'('
op|')'
newline|'\n'
name|'local_auth'
op|'='
name|'auth'
op|'.'
name|'filter_factory'
op|'('
op|'{'
string|"'super_admin_key'"
op|':'
string|"'supertest'"
op|','
nl|'\n'
string|"'reseller_prefix'"
op|':'
string|"''"
op|'}'
op|')'
op|'('
name|'local_app'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/v1/account'"
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Auth-Token'"
op|':'
string|"'t'"
op|'}'
op|')'
op|'.'
name|'get_response'
op|'('
name|'local_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'401'
op|')'
newline|'\n'
comment|'# one for checking auth, two for request passed along'
nl|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'local_app'
op|'.'
name|'calls'
op|','
number|'2'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'environ'
op|'['
string|"'swift.authorize'"
op|']'
op|','
nl|'\n'
name|'local_auth'
op|'.'
name|'denied_response'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_auth_no_reseller_prefix_allow
dedent|''
name|'def'
name|'test_auth_no_reseller_prefix_allow'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# Ensures that when we have no reseller prefix, we can still allow'
nl|'\n'
comment|'# access if our auth server accepts requests'
nl|'\n'
indent|'        '
name|'local_app'
op|'='
name|'FakeApp'
op|'('
name|'iter'
op|'('
op|'['
nl|'\n'
op|'('
string|"'200 Ok'"
op|','
op|'{'
op|'}'
op|','
nl|'\n'
name|'json'
op|'.'
name|'dumps'
op|'('
op|'{'
string|"'account'"
op|':'
string|"'act'"
op|','
string|"'user'"
op|':'
string|"'act:usr'"
op|','
nl|'\n'
string|"'account_id'"
op|':'
string|"'AUTH_cfa'"
op|','
nl|'\n'
string|"'groups'"
op|':'
op|'['
op|'{'
string|"'name'"
op|':'
string|"'act:usr'"
op|'}'
op|','
op|'{'
string|"'name'"
op|':'
string|"'act'"
op|'}'
op|','
nl|'\n'
op|'{'
string|"'name'"
op|':'
string|"'.admin'"
op|'}'
op|']'
op|','
nl|'\n'
string|"'expires'"
op|':'
name|'time'
op|'('
op|')'
op|'+'
number|'60'
op|'}'
op|')'
op|')'
op|','
nl|'\n'
op|'('
string|"'204 No Content'"
op|','
op|'{'
op|'}'
op|','
string|"''"
op|')'
op|']'
op|')'
op|')'
newline|'\n'
name|'local_auth'
op|'='
name|'auth'
op|'.'
name|'filter_factory'
op|'('
op|'{'
string|"'super_admin_key'"
op|':'
string|"'supertest'"
op|','
nl|'\n'
string|"'reseller_prefix'"
op|':'
string|"''"
op|'}'
op|')'
op|'('
name|'local_app'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/v1/act'"
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Auth-Token'"
op|':'
string|"'t'"
op|'}'
op|')'
op|'.'
name|'get_response'
op|'('
name|'local_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'204'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'local_app'
op|'.'
name|'calls'
op|','
number|'2'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'environ'
op|'['
string|"'swift.authorize'"
op|']'
op|','
nl|'\n'
name|'local_auth'
op|'.'
name|'authorize'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_auth_no_reseller_prefix_no_token
dedent|''
name|'def'
name|'test_auth_no_reseller_prefix_no_token'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# Check that normally we set up a call back to our authorize.'
nl|'\n'
indent|'        '
name|'local_auth'
op|'='
name|'auth'
op|'.'
name|'filter_factory'
op|'('
op|'{'
string|"'super_admin_key'"
op|':'
string|"'supertest'"
op|','
nl|'\n'
string|"'reseller_prefix'"
op|':'
string|"''"
op|'}'
op|')'
op|'('
name|'FakeApp'
op|'('
name|'iter'
op|'('
op|'['
op|']'
op|')'
op|')'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/v1/account'"
op|')'
op|'.'
name|'get_response'
op|'('
name|'local_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'401'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'environ'
op|'['
string|"'swift.authorize'"
op|']'
op|','
nl|'\n'
name|'local_auth'
op|'.'
name|'authorize'
op|')'
newline|'\n'
comment|"# Now make sure we don't override an existing swift.authorize when we"
nl|'\n'
comment|'# have no reseller prefix.'
nl|'\n'
name|'local_auth'
op|'='
name|'auth'
op|'.'
name|'filter_factory'
op|'('
op|'{'
string|"'super_admin_key'"
op|':'
string|"'supertest'"
op|','
nl|'\n'
string|"'reseller_prefix'"
op|':'
string|"''"
op|'}'
op|')'
op|'('
name|'FakeApp'
op|'('
op|')'
op|')'
newline|'\n'
name|'local_authorize'
op|'='
name|'lambda'
name|'req'
op|':'
name|'Response'
op|'('
string|"'test'"
op|')'
newline|'\n'
name|'resp'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/v1/account'"
op|','
name|'environ'
op|'='
op|'{'
string|"'swift.authorize'"
op|':'
nl|'\n'
name|'local_authorize'
op|'}'
op|')'
op|'.'
name|'get_response'
op|'('
name|'local_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'200'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'environ'
op|'['
string|"'swift.authorize'"
op|']'
op|','
name|'local_authorize'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_auth_fail
dedent|''
name|'def'
name|'test_auth_fail'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'resp'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/v1/AUTH_cfa'"
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Auth-Token'"
op|':'
string|"'AUTH_t'"
op|'}'
op|')'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'401'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_auth_success
dedent|''
name|'def'
name|'test_auth_success'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'app'
op|'='
name|'FakeApp'
op|'('
name|'iter'
op|'('
op|'['
nl|'\n'
op|'('
string|"'200 Ok'"
op|','
op|'{'
op|'}'
op|','
nl|'\n'
name|'json'
op|'.'
name|'dumps'
op|'('
op|'{'
string|"'account'"
op|':'
string|"'act'"
op|','
string|"'user'"
op|':'
string|"'act:usr'"
op|','
nl|'\n'
string|"'account_id'"
op|':'
string|"'AUTH_cfa'"
op|','
nl|'\n'
string|"'groups'"
op|':'
op|'['
op|'{'
string|"'name'"
op|':'
string|"'act:usr'"
op|'}'
op|','
op|'{'
string|"'name'"
op|':'
string|"'act'"
op|'}'
op|','
nl|'\n'
op|'{'
string|"'name'"
op|':'
string|"'.admin'"
op|'}'
op|']'
op|','
nl|'\n'
string|"'expires'"
op|':'
name|'time'
op|'('
op|')'
op|'+'
number|'60'
op|'}'
op|')'
op|')'
op|','
nl|'\n'
op|'('
string|"'204 No Content'"
op|','
op|'{'
op|'}'
op|','
string|"''"
op|')'
op|']'
op|')'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/v1/AUTH_cfa'"
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Auth-Token'"
op|':'
string|"'AUTH_t'"
op|'}'
op|')'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'204'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_auth_memcache
dedent|''
name|'def'
name|'test_auth_memcache'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# First run our test without memcache, showing we need to return the'
nl|'\n'
comment|'# token contents twice.'
nl|'\n'
indent|'        '
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'app'
op|'='
name|'FakeApp'
op|'('
name|'iter'
op|'('
op|'['
nl|'\n'
op|'('
string|"'200 Ok'"
op|','
op|'{'
op|'}'
op|','
nl|'\n'
name|'json'
op|'.'
name|'dumps'
op|'('
op|'{'
string|"'account'"
op|':'
string|"'act'"
op|','
string|"'user'"
op|':'
string|"'act:usr'"
op|','
nl|'\n'
string|"'account_id'"
op|':'
string|"'AUTH_cfa'"
op|','
nl|'\n'
string|"'groups'"
op|':'
op|'['
op|'{'
string|"'name'"
op|':'
string|"'act:usr'"
op|'}'
op|','
op|'{'
string|"'name'"
op|':'
string|"'act'"
op|'}'
op|','
nl|'\n'
op|'{'
string|"'name'"
op|':'
string|"'.admin'"
op|'}'
op|']'
op|','
nl|'\n'
string|"'expires'"
op|':'
name|'time'
op|'('
op|')'
op|'+'
number|'60'
op|'}'
op|')'
op|')'
op|','
nl|'\n'
op|'('
string|"'204 No Content'"
op|','
op|'{'
op|'}'
op|','
string|"''"
op|')'
op|','
nl|'\n'
op|'('
string|"'200 Ok'"
op|','
op|'{'
op|'}'
op|','
nl|'\n'
name|'json'
op|'.'
name|'dumps'
op|'('
op|'{'
string|"'account'"
op|':'
string|"'act'"
op|','
string|"'user'"
op|':'
string|"'act:usr'"
op|','
nl|'\n'
string|"'account_id'"
op|':'
string|"'AUTH_cfa'"
op|','
nl|'\n'
string|"'groups'"
op|':'
op|'['
op|'{'
string|"'name'"
op|':'
string|"'act:usr'"
op|'}'
op|','
op|'{'
string|"'name'"
op|':'
string|"'act'"
op|'}'
op|','
nl|'\n'
op|'{'
string|"'name'"
op|':'
string|"'.admin'"
op|'}'
op|']'
op|','
nl|'\n'
string|"'expires'"
op|':'
name|'time'
op|'('
op|')'
op|'+'
number|'60'
op|'}'
op|')'
op|')'
op|','
nl|'\n'
op|'('
string|"'204 No Content'"
op|','
op|'{'
op|'}'
op|','
string|"''"
op|')'
op|']'
op|')'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/v1/AUTH_cfa'"
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Auth-Token'"
op|':'
string|"'AUTH_t'"
op|'}'
op|')'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'204'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/v1/AUTH_cfa'"
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Auth-Token'"
op|':'
string|"'AUTH_t'"
op|'}'
op|')'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'204'
op|')'
newline|'\n'
comment|'# Now run our test with memcache, showing we no longer need to return'
nl|'\n'
comment|'# the token contents twice.'
nl|'\n'
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'app'
op|'='
name|'FakeApp'
op|'('
name|'iter'
op|'('
op|'['
nl|'\n'
op|'('
string|"'200 Ok'"
op|','
op|'{'
op|'}'
op|','
nl|'\n'
name|'json'
op|'.'
name|'dumps'
op|'('
op|'{'
string|"'account'"
op|':'
string|"'act'"
op|','
string|"'user'"
op|':'
string|"'act:usr'"
op|','
nl|'\n'
string|"'account_id'"
op|':'
string|"'AUTH_cfa'"
op|','
nl|'\n'
string|"'groups'"
op|':'
op|'['
op|'{'
string|"'name'"
op|':'
string|"'act:usr'"
op|'}'
op|','
op|'{'
string|"'name'"
op|':'
string|"'act'"
op|'}'
op|','
nl|'\n'
op|'{'
string|"'name'"
op|':'
string|"'.admin'"
op|'}'
op|']'
op|','
nl|'\n'
string|"'expires'"
op|':'
name|'time'
op|'('
op|')'
op|'+'
number|'60'
op|'}'
op|')'
op|')'
op|','
nl|'\n'
op|'('
string|"'204 No Content'"
op|','
op|'{'
op|'}'
op|','
string|"''"
op|')'
op|','
nl|'\n'
comment|"# Don't need a second token object returned if memcache is used"
nl|'\n'
op|'('
string|"'204 No Content'"
op|','
op|'{'
op|'}'
op|','
string|"''"
op|')'
op|']'
op|')'
op|')'
newline|'\n'
name|'fake_memcache'
op|'='
name|'FakeMemcache'
op|'('
op|')'
newline|'\n'
name|'resp'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/v1/AUTH_cfa'"
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Auth-Token'"
op|':'
string|"'AUTH_t'"
op|'}'
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'swift.cache'"
op|':'
name|'fake_memcache'
op|'}'
nl|'\n'
op|')'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'204'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/v1/AUTH_cfa'"
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Auth-Token'"
op|':'
string|"'AUTH_t'"
op|'}'
op|','
nl|'\n'
name|'environ'
op|'='
op|'{'
string|"'swift.cache'"
op|':'
name|'fake_memcache'
op|'}'
nl|'\n'
op|')'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'204'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_auth_just_expired
dedent|''
name|'def'
name|'test_auth_just_expired'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'app'
op|'='
name|'FakeApp'
op|'('
name|'iter'
op|'('
op|'['
nl|'\n'
comment|'# Request for token (which will have expired)'
nl|'\n'
op|'('
string|"'200 Ok'"
op|','
op|'{'
op|'}'
op|','
nl|'\n'
name|'json'
op|'.'
name|'dumps'
op|'('
op|'{'
string|"'account'"
op|':'
string|"'act'"
op|','
string|"'user'"
op|':'
string|"'act:usr'"
op|','
nl|'\n'
string|"'account_id'"
op|':'
string|"'AUTH_cfa'"
op|','
nl|'\n'
string|"'groups'"
op|':'
op|'['
op|'{'
string|"'name'"
op|':'
string|"'act:usr'"
op|'}'
op|','
op|'{'
string|"'name'"
op|':'
string|"'act'"
op|'}'
op|','
nl|'\n'
op|'{'
string|"'name'"
op|':'
string|"'.admin'"
op|'}'
op|']'
op|','
nl|'\n'
string|"'expires'"
op|':'
name|'time'
op|'('
op|')'
op|'-'
number|'1'
op|'}'
op|')'
op|')'
op|','
nl|'\n'
comment|'# Request to delete token'
nl|'\n'
op|'('
string|"'204 No Content'"
op|','
op|'{'
op|'}'
op|','
string|"''"
op|')'
op|']'
op|')'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/v1/AUTH_cfa'"
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Auth-Token'"
op|':'
string|"'AUTH_t'"
op|'}'
op|')'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'401'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'app'
op|'.'
name|'calls'
op|','
number|'2'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_middleware_storage_token
dedent|''
name|'def'
name|'test_middleware_storage_token'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'app'
op|'='
name|'FakeApp'
op|'('
name|'iter'
op|'('
op|'['
nl|'\n'
op|'('
string|"'200 Ok'"
op|','
op|'{'
op|'}'
op|','
nl|'\n'
name|'json'
op|'.'
name|'dumps'
op|'('
op|'{'
string|"'account'"
op|':'
string|"'act'"
op|','
string|"'user'"
op|':'
string|"'act:usr'"
op|','
nl|'\n'
string|"'account_id'"
op|':'
string|"'AUTH_cfa'"
op|','
nl|'\n'
string|"'groups'"
op|':'
op|'['
op|'{'
string|"'name'"
op|':'
string|"'act:usr'"
op|'}'
op|','
op|'{'
string|"'name'"
op|':'
string|"'act'"
op|'}'
op|','
nl|'\n'
op|'{'
string|"'name'"
op|':'
string|"'.admin'"
op|'}'
op|']'
op|','
nl|'\n'
string|"'expires'"
op|':'
name|'time'
op|'('
op|')'
op|'+'
number|'60'
op|'}'
op|')'
op|')'
op|','
nl|'\n'
op|'('
string|"'204 No Content'"
op|','
op|'{'
op|'}'
op|','
string|"''"
op|')'
op|']'
op|')'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/v1/AUTH_cfa'"
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Storage-Token'"
op|':'
string|"'AUTH_t'"
op|'}'
op|')'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'204'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_authorize_bad_path
dedent|''
name|'def'
name|'test_authorize_bad_path'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/badpath'"
op|')'
newline|'\n'
name|'resp'
op|'='
name|'str'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'authorize'
op|'('
name|'req'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_'
op|'('
name|'resp'
op|'.'
name|'startswith'
op|'('
string|"'401'"
op|')'
op|','
name|'resp'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/badpath'"
op|')'
newline|'\n'
name|'req'
op|'.'
name|'remote_user'
op|'='
string|"'act:usr,act,AUTH_cfa'"
newline|'\n'
name|'resp'
op|'='
name|'str'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'authorize'
op|'('
name|'req'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_'
op|'('
name|'resp'
op|'.'
name|'startswith'
op|'('
string|"'403'"
op|')'
op|','
name|'resp'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_authorize_account_access
dedent|''
name|'def'
name|'test_authorize_account_access'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/v1/AUTH_cfa'"
op|')'
newline|'\n'
name|'req'
op|'.'
name|'remote_user'
op|'='
string|"'act:usr,act,AUTH_cfa'"
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'authorize'
op|'('
name|'req'
op|')'
op|','
name|'None'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/v1/AUTH_cfa'"
op|')'
newline|'\n'
name|'req'
op|'.'
name|'remote_user'
op|'='
string|"'act:usr,act'"
newline|'\n'
name|'resp'
op|'='
name|'str'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'authorize'
op|'('
name|'req'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_'
op|'('
name|'resp'
op|'.'
name|'startswith'
op|'('
string|"'403'"
op|')'
op|','
name|'resp'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_authorize_acl_group_access
dedent|''
name|'def'
name|'test_authorize_acl_group_access'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/v1/AUTH_cfa'"
op|')'
newline|'\n'
name|'req'
op|'.'
name|'remote_user'
op|'='
string|"'act:usr,act'"
newline|'\n'
name|'resp'
op|'='
name|'str'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'authorize'
op|'('
name|'req'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_'
op|'('
name|'resp'
op|'.'
name|'startswith'
op|'('
string|"'403'"
op|')'
op|','
name|'resp'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/v1/AUTH_cfa'"
op|')'
newline|'\n'
name|'req'
op|'.'
name|'remote_user'
op|'='
string|"'act:usr,act'"
newline|'\n'
name|'req'
op|'.'
name|'acl'
op|'='
string|"'act'"
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'authorize'
op|'('
name|'req'
op|')'
op|','
name|'None'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/v1/AUTH_cfa'"
op|')'
newline|'\n'
name|'req'
op|'.'
name|'remote_user'
op|'='
string|"'act:usr,act'"
newline|'\n'
name|'req'
op|'.'
name|'acl'
op|'='
string|"'act:usr'"
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'authorize'
op|'('
name|'req'
op|')'
op|','
name|'None'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/v1/AUTH_cfa'"
op|')'
newline|'\n'
name|'req'
op|'.'
name|'remote_user'
op|'='
string|"'act:usr,act'"
newline|'\n'
name|'req'
op|'.'
name|'acl'
op|'='
string|"'act2'"
newline|'\n'
name|'resp'
op|'='
name|'str'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'authorize'
op|'('
name|'req'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_'
op|'('
name|'resp'
op|'.'
name|'startswith'
op|'('
string|"'403'"
op|')'
op|','
name|'resp'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/v1/AUTH_cfa'"
op|')'
newline|'\n'
name|'req'
op|'.'
name|'remote_user'
op|'='
string|"'act:usr,act'"
newline|'\n'
name|'req'
op|'.'
name|'acl'
op|'='
string|"'act:usr2'"
newline|'\n'
name|'resp'
op|'='
name|'str'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'authorize'
op|'('
name|'req'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_'
op|'('
name|'resp'
op|'.'
name|'startswith'
op|'('
string|"'403'"
op|')'
op|','
name|'resp'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_deny_cross_reseller
dedent|''
name|'def'
name|'test_deny_cross_reseller'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# Tests that cross-reseller is denied, even if ACLs/group names match'
nl|'\n'
indent|'        '
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/v1/OTHER_cfa'"
op|')'
newline|'\n'
name|'req'
op|'.'
name|'remote_user'
op|'='
string|"'act:usr,act,AUTH_cfa'"
newline|'\n'
name|'req'
op|'.'
name|'acl'
op|'='
string|"'act'"
newline|'\n'
name|'resp'
op|'='
name|'str'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'authorize'
op|'('
name|'req'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_'
op|'('
name|'resp'
op|'.'
name|'startswith'
op|'('
string|"'403'"
op|')'
op|','
name|'resp'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_authorize_acl_referrer_access
dedent|''
name|'def'
name|'test_authorize_acl_referrer_access'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/v1/AUTH_cfa'"
op|')'
newline|'\n'
name|'req'
op|'.'
name|'remote_user'
op|'='
string|"'act:usr,act'"
newline|'\n'
name|'resp'
op|'='
name|'str'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'authorize'
op|'('
name|'req'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_'
op|'('
name|'resp'
op|'.'
name|'startswith'
op|'('
string|"'403'"
op|')'
op|','
name|'resp'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/v1/AUTH_cfa'"
op|')'
newline|'\n'
name|'req'
op|'.'
name|'remote_user'
op|'='
string|"'act:usr,act'"
newline|'\n'
name|'req'
op|'.'
name|'acl'
op|'='
string|"'.r:*'"
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'authorize'
op|'('
name|'req'
op|')'
op|','
name|'None'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/v1/AUTH_cfa'"
op|')'
newline|'\n'
name|'req'
op|'.'
name|'remote_user'
op|'='
string|"'act:usr,act'"
newline|'\n'
name|'req'
op|'.'
name|'acl'
op|'='
string|"'.r:.example.com'"
newline|'\n'
name|'resp'
op|'='
name|'str'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'authorize'
op|'('
name|'req'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_'
op|'('
name|'resp'
op|'.'
name|'startswith'
op|'('
string|"'403'"
op|')'
op|','
name|'resp'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/v1/AUTH_cfa'"
op|')'
newline|'\n'
name|'req'
op|'.'
name|'remote_user'
op|'='
string|"'act:usr,act'"
newline|'\n'
name|'req'
op|'.'
name|'referer'
op|'='
string|"'http://www.example.com/index.html'"
newline|'\n'
name|'req'
op|'.'
name|'acl'
op|'='
string|"'.r:.example.com'"
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'authorize'
op|'('
name|'req'
op|')'
op|','
name|'None'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/v1/AUTH_cfa'"
op|')'
newline|'\n'
name|'resp'
op|'='
name|'str'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'authorize'
op|'('
name|'req'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_'
op|'('
name|'resp'
op|'.'
name|'startswith'
op|'('
string|"'401'"
op|')'
op|','
name|'resp'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/v1/AUTH_cfa'"
op|')'
newline|'\n'
name|'req'
op|'.'
name|'acl'
op|'='
string|"'.r:*'"
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'authorize'
op|'('
name|'req'
op|')'
op|','
name|'None'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/v1/AUTH_cfa'"
op|')'
newline|'\n'
name|'req'
op|'.'
name|'acl'
op|'='
string|"'.r:.example.com'"
newline|'\n'
name|'resp'
op|'='
name|'str'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'authorize'
op|'('
name|'req'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_'
op|'('
name|'resp'
op|'.'
name|'startswith'
op|'('
string|"'401'"
op|')'
op|','
name|'resp'
op|')'
newline|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/v1/AUTH_cfa'"
op|')'
newline|'\n'
name|'req'
op|'.'
name|'referer'
op|'='
string|"'http://www.example.com/index.html'"
newline|'\n'
name|'req'
op|'.'
name|'acl'
op|'='
string|"'.r:.example.com'"
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'authorize'
op|'('
name|'req'
op|')'
op|','
name|'None'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_account_put_permissions
dedent|''
name|'def'
name|'test_account_put_permissions'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/v1/AUTH_new'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'remote_user'
op|'='
string|"'act:usr,act'"
newline|'\n'
name|'resp'
op|'='
name|'str'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'authorize'
op|'('
name|'req'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_'
op|'('
name|'resp'
op|'.'
name|'startswith'
op|'('
string|"'403'"
op|')'
op|','
name|'resp'
op|')'
newline|'\n'
nl|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/v1/AUTH_new'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'remote_user'
op|'='
string|"'act:usr,act,AUTH_other'"
newline|'\n'
name|'resp'
op|'='
name|'str'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'authorize'
op|'('
name|'req'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_'
op|'('
name|'resp'
op|'.'
name|'startswith'
op|'('
string|"'403'"
op|')'
op|','
name|'resp'
op|')'
newline|'\n'
nl|'\n'
comment|'# Even PUTs to your own account as account admin should fail'
nl|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/v1/AUTH_old'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'remote_user'
op|'='
string|"'act:usr,act,AUTH_old'"
newline|'\n'
name|'resp'
op|'='
name|'str'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'authorize'
op|'('
name|'req'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_'
op|'('
name|'resp'
op|'.'
name|'startswith'
op|'('
string|"'403'"
op|')'
op|','
name|'resp'
op|')'
newline|'\n'
nl|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/v1/AUTH_new'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'remote_user'
op|'='
string|"'act:usr,act,.reseller_admin'"
newline|'\n'
name|'resp'
op|'='
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'authorize'
op|'('
name|'req'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|','
name|'None'
op|')'
newline|'\n'
nl|'\n'
comment|'# .super_admin is not something the middleware should ever see or care'
nl|'\n'
comment|'# about'
nl|'\n'
name|'req'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/v1/AUTH_new'"
op|','
name|'environ'
op|'='
op|'{'
string|"'REQUEST_METHOD'"
op|':'
string|"'PUT'"
op|'}'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'remote_user'
op|'='
string|"'act:usr,act,.super_admin'"
newline|'\n'
name|'resp'
op|'='
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'authorize'
op|'('
name|'req'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'str'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'authorize'
op|'('
name|'req'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_'
op|'('
name|'resp'
op|'.'
name|'startswith'
op|'('
string|"'403'"
op|')'
op|','
name|'resp'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_token_fail
dedent|''
name|'def'
name|'test_get_token_fail'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'resp'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/auth/v1.0'"
op|')'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'401'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/auth/v1.0'"
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Auth-User'"
op|':'
string|"'act:usr'"
op|','
nl|'\n'
string|"'X-Auth-Key'"
op|':'
string|"'key'"
op|'}'
op|')'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'401'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_token_fail_invalid_key
dedent|''
name|'def'
name|'test_get_token_fail_invalid_key'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'app'
op|'='
name|'FakeApp'
op|'('
name|'iter'
op|'('
op|'['
nl|'\n'
comment|'# GET of user object'
nl|'\n'
op|'('
string|"'200 Ok'"
op|','
op|'{'
op|'}'
op|','
nl|'\n'
name|'json'
op|'.'
name|'dumps'
op|'('
op|'{'
string|'"auth"'
op|':'
string|'"plaintext:key"'
op|','
nl|'\n'
string|'"groups"'
op|':'
op|'['
op|'{'
string|"'name'"
op|':'
string|'"act:usr"'
op|'}'
op|','
op|'{'
string|"'name'"
op|':'
string|'"act"'
op|'}'
op|','
nl|'\n'
op|'{'
string|"'name'"
op|':'
string|'".admin"'
op|'}'
op|']'
op|'}'
op|')'
op|')'
op|','
nl|'\n'
comment|'# GET of account'
nl|'\n'
op|'('
string|"'204 Ok'"
op|','
op|'{'
string|"'X-Container-Meta-Account-Id'"
op|':'
string|"'AUTH_cfa'"
op|'}'
op|','
string|"''"
op|')'
op|','
nl|'\n'
comment|'# PUT of new token'
nl|'\n'
op|'('
string|"'201 Created'"
op|','
op|'{'
op|'}'
op|','
string|"''"
op|')'
op|','
nl|'\n'
comment|'# POST of token to user object'
nl|'\n'
op|'('
string|"'204 No Content'"
op|','
op|'{'
op|'}'
op|','
string|"''"
op|')'
op|','
nl|'\n'
comment|'# GET of services object'
nl|'\n'
op|'('
string|"'200 Ok'"
op|','
op|'{'
op|'}'
op|','
name|'json'
op|'.'
name|'dumps'
op|'('
op|'{'
string|'"storage"'
op|':'
op|'{'
string|'"default"'
op|':'
string|'"local"'
op|','
nl|'\n'
string|'"local"'
op|':'
string|'"http://127.0.0.1:8080/v1/AUTH_cfa"'
op|'}'
op|'}'
op|')'
op|')'
op|']'
op|')'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/auth/v1.0'"
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Auth-User'"
op|':'
string|"'act:usr'"
op|','
nl|'\n'
string|"'X-Auth-Key'"
op|':'
string|"'invalid'"
op|'}'
op|')'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'401'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_token_fail_invalid_x_auth_user_format
dedent|''
name|'def'
name|'test_get_token_fail_invalid_x_auth_user_format'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'resp'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/auth/v1/act/auth'"
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Auth-User'"
op|':'
string|"'usr'"
op|','
nl|'\n'
string|"'X-Auth-Key'"
op|':'
string|"'key'"
op|'}'
op|')'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'401'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_token_fail_non_matching_account_in_request
dedent|''
name|'def'
name|'test_get_token_fail_non_matching_account_in_request'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'resp'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/auth/v1/act/auth'"
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Auth-User'"
op|':'
string|"'act2:usr'"
op|','
nl|'\n'
string|"'X-Auth-Key'"
op|':'
string|"'key'"
op|'}'
op|')'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'401'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_token_fail_bad_path
dedent|''
name|'def'
name|'test_get_token_fail_bad_path'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'resp'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/auth/v1/act/auth/invalid'"
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Auth-User'"
op|':'
string|"'act:usr'"
op|','
nl|'\n'
string|"'X-Auth-Key'"
op|':'
string|"'key'"
op|'}'
op|')'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'400'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_token_fail_missing_key
dedent|''
name|'def'
name|'test_get_token_fail_missing_key'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'resp'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/auth/v1/act/auth'"
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Auth-User'"
op|':'
string|"'act:usr'"
op|'}'
op|')'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'401'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_token_fail_get_user_details
dedent|''
name|'def'
name|'test_get_token_fail_get_user_details'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'app'
op|'='
name|'FakeApp'
op|'('
name|'iter'
op|'('
op|'['
nl|'\n'
op|'('
string|"'503 Service Unavailable'"
op|','
op|'{'
op|'}'
op|','
string|"''"
op|')'
op|']'
op|')'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/auth/v1.0'"
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Auth-User'"
op|':'
string|"'act:usr'"
op|','
nl|'\n'
string|"'X-Auth-Key'"
op|':'
string|"'key'"
op|'}'
op|')'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'500'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_token_fail_get_account
dedent|''
name|'def'
name|'test_get_token_fail_get_account'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'app'
op|'='
name|'FakeApp'
op|'('
name|'iter'
op|'('
op|'['
nl|'\n'
comment|'# GET of user object'
nl|'\n'
op|'('
string|"'200 Ok'"
op|','
op|'{'
op|'}'
op|','
nl|'\n'
name|'json'
op|'.'
name|'dumps'
op|'('
op|'{'
string|'"auth"'
op|':'
string|'"plaintext:key"'
op|','
nl|'\n'
string|'"groups"'
op|':'
op|'['
op|'{'
string|"'name'"
op|':'
string|'"act:usr"'
op|'}'
op|','
op|'{'
string|"'name'"
op|':'
string|'"act"'
op|'}'
op|','
nl|'\n'
op|'{'
string|"'name'"
op|':'
string|'".admin"'
op|'}'
op|']'
op|'}'
op|')'
op|')'
op|','
nl|'\n'
comment|'# GET of account'
nl|'\n'
op|'('
string|"'503 Service Unavailable'"
op|','
op|'{'
op|'}'
op|','
string|"''"
op|')'
op|']'
op|')'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/auth/v1.0'"
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Auth-User'"
op|':'
string|"'act:usr'"
op|','
nl|'\n'
string|"'X-Auth-Key'"
op|':'
string|"'key'"
op|'}'
op|')'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'500'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_token_fail_put_new_token
dedent|''
name|'def'
name|'test_get_token_fail_put_new_token'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'app'
op|'='
name|'FakeApp'
op|'('
name|'iter'
op|'('
op|'['
nl|'\n'
comment|'# GET of user object'
nl|'\n'
op|'('
string|"'200 Ok'"
op|','
op|'{'
op|'}'
op|','
nl|'\n'
name|'json'
op|'.'
name|'dumps'
op|'('
op|'{'
string|'"auth"'
op|':'
string|'"plaintext:key"'
op|','
nl|'\n'
string|'"groups"'
op|':'
op|'['
op|'{'
string|"'name'"
op|':'
string|'"act:usr"'
op|'}'
op|','
op|'{'
string|"'name'"
op|':'
string|'"act"'
op|'}'
op|','
nl|'\n'
op|'{'
string|"'name'"
op|':'
string|'".admin"'
op|'}'
op|']'
op|'}'
op|')'
op|')'
op|','
nl|'\n'
comment|'# GET of account'
nl|'\n'
op|'('
string|"'204 Ok'"
op|','
op|'{'
string|"'X-Container-Meta-Account-Id'"
op|':'
string|"'AUTH_cfa'"
op|'}'
op|','
string|"''"
op|')'
op|','
nl|'\n'
comment|'# PUT of new token'
nl|'\n'
op|'('
string|"'503 Service Unavailable'"
op|','
op|'{'
op|'}'
op|','
string|"''"
op|')'
op|']'
op|')'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/auth/v1.0'"
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Auth-User'"
op|':'
string|"'act:usr'"
op|','
nl|'\n'
string|"'X-Auth-Key'"
op|':'
string|"'key'"
op|'}'
op|')'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'500'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_token_fail_post_to_user
dedent|''
name|'def'
name|'test_get_token_fail_post_to_user'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'app'
op|'='
name|'FakeApp'
op|'('
name|'iter'
op|'('
op|'['
nl|'\n'
comment|'# GET of user object'
nl|'\n'
op|'('
string|"'200 Ok'"
op|','
op|'{'
op|'}'
op|','
nl|'\n'
name|'json'
op|'.'
name|'dumps'
op|'('
op|'{'
string|'"auth"'
op|':'
string|'"plaintext:key"'
op|','
nl|'\n'
string|'"groups"'
op|':'
op|'['
op|'{'
string|"'name'"
op|':'
string|'"act:usr"'
op|'}'
op|','
op|'{'
string|"'name'"
op|':'
string|'"act"'
op|'}'
op|','
nl|'\n'
op|'{'
string|"'name'"
op|':'
string|'".admin"'
op|'}'
op|']'
op|'}'
op|')'
op|')'
op|','
nl|'\n'
comment|'# GET of account'
nl|'\n'
op|'('
string|"'204 Ok'"
op|','
op|'{'
string|"'X-Container-Meta-Account-Id'"
op|':'
string|"'AUTH_cfa'"
op|'}'
op|','
string|"''"
op|')'
op|','
nl|'\n'
comment|'# PUT of new token'
nl|'\n'
op|'('
string|"'201 Created'"
op|','
op|'{'
op|'}'
op|','
string|"''"
op|')'
op|','
nl|'\n'
comment|'# POST of token to user object'
nl|'\n'
op|'('
string|"'503 Service Unavailable'"
op|','
op|'{'
op|'}'
op|','
string|"''"
op|')'
op|']'
op|')'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/auth/v1.0'"
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Auth-User'"
op|':'
string|"'act:usr'"
op|','
nl|'\n'
string|"'X-Auth-Key'"
op|':'
string|"'key'"
op|'}'
op|')'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'500'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_token_fail_get_services
dedent|''
name|'def'
name|'test_get_token_fail_get_services'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'app'
op|'='
name|'FakeApp'
op|'('
name|'iter'
op|'('
op|'['
nl|'\n'
comment|'# GET of user object'
nl|'\n'
op|'('
string|"'200 Ok'"
op|','
op|'{'
op|'}'
op|','
nl|'\n'
name|'json'
op|'.'
name|'dumps'
op|'('
op|'{'
string|'"auth"'
op|':'
string|'"plaintext:key"'
op|','
nl|'\n'
string|'"groups"'
op|':'
op|'['
op|'{'
string|"'name'"
op|':'
string|'"act:usr"'
op|'}'
op|','
op|'{'
string|"'name'"
op|':'
string|'"act"'
op|'}'
op|','
nl|'\n'
op|'{'
string|"'name'"
op|':'
string|'".admin"'
op|'}'
op|']'
op|'}'
op|')'
op|')'
op|','
nl|'\n'
comment|'# GET of account'
nl|'\n'
op|'('
string|"'204 Ok'"
op|','
op|'{'
string|"'X-Container-Meta-Account-Id'"
op|':'
string|"'AUTH_cfa'"
op|'}'
op|','
string|"''"
op|')'
op|','
nl|'\n'
comment|'# PUT of new token'
nl|'\n'
op|'('
string|"'201 Created'"
op|','
op|'{'
op|'}'
op|','
string|"''"
op|')'
op|','
nl|'\n'
comment|'# POST of token to user object'
nl|'\n'
op|'('
string|"'204 No Content'"
op|','
op|'{'
op|'}'
op|','
string|"''"
op|')'
op|','
nl|'\n'
comment|'# GET of services object'
nl|'\n'
op|'('
string|"'503 Service Unavailable'"
op|','
op|'{'
op|'}'
op|','
string|"''"
op|')'
op|']'
op|')'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/auth/v1.0'"
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Auth-User'"
op|':'
string|"'act:usr'"
op|','
nl|'\n'
string|"'X-Auth-Key'"
op|':'
string|"'key'"
op|'}'
op|')'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'500'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_token_fail_get_existing_token
dedent|''
name|'def'
name|'test_get_token_fail_get_existing_token'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'app'
op|'='
name|'FakeApp'
op|'('
name|'iter'
op|'('
op|'['
nl|'\n'
comment|'# GET of user object'
nl|'\n'
op|'('
string|"'200 Ok'"
op|','
op|'{'
string|"'X-Object-Meta-Auth-Token'"
op|':'
string|"'AUTH_tktest'"
op|'}'
op|','
nl|'\n'
name|'json'
op|'.'
name|'dumps'
op|'('
op|'{'
string|'"auth"'
op|':'
string|'"plaintext:key"'
op|','
nl|'\n'
string|'"groups"'
op|':'
op|'['
op|'{'
string|"'name'"
op|':'
string|'"act:usr"'
op|'}'
op|','
op|'{'
string|"'name'"
op|':'
string|'"act"'
op|'}'
op|','
nl|'\n'
op|'{'
string|"'name'"
op|':'
string|'".admin"'
op|'}'
op|']'
op|'}'
op|')'
op|')'
op|','
nl|'\n'
comment|'# GET of token'
nl|'\n'
op|'('
string|"'503 Service Unavailable'"
op|','
op|'{'
op|'}'
op|','
string|"''"
op|')'
op|']'
op|')'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/auth/v1.0'"
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Auth-User'"
op|':'
string|"'act:usr'"
op|','
nl|'\n'
string|"'X-Auth-Key'"
op|':'
string|"'key'"
op|'}'
op|')'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'500'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_token_success_v1_0
dedent|''
name|'def'
name|'test_get_token_success_v1_0'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'app'
op|'='
name|'FakeApp'
op|'('
name|'iter'
op|'('
op|'['
nl|'\n'
comment|'# GET of user object'
nl|'\n'
op|'('
string|"'200 Ok'"
op|','
op|'{'
op|'}'
op|','
nl|'\n'
name|'json'
op|'.'
name|'dumps'
op|'('
op|'{'
string|'"auth"'
op|':'
string|'"plaintext:key"'
op|','
nl|'\n'
string|'"groups"'
op|':'
op|'['
op|'{'
string|"'name'"
op|':'
string|'"act:usr"'
op|'}'
op|','
op|'{'
string|"'name'"
op|':'
string|'"act"'
op|'}'
op|','
nl|'\n'
op|'{'
string|"'name'"
op|':'
string|'".admin"'
op|'}'
op|']'
op|'}'
op|')'
op|')'
op|','
nl|'\n'
comment|'# GET of account'
nl|'\n'
op|'('
string|"'204 Ok'"
op|','
op|'{'
string|"'X-Container-Meta-Account-Id'"
op|':'
string|"'AUTH_cfa'"
op|'}'
op|','
string|"''"
op|')'
op|','
nl|'\n'
comment|'# PUT of new token'
nl|'\n'
op|'('
string|"'201 Created'"
op|','
op|'{'
op|'}'
op|','
string|"''"
op|')'
op|','
nl|'\n'
comment|'# POST of token to user object'
nl|'\n'
op|'('
string|"'204 No Content'"
op|','
op|'{'
op|'}'
op|','
string|"''"
op|')'
op|','
nl|'\n'
comment|'# GET of services object'
nl|'\n'
op|'('
string|"'200 Ok'"
op|','
op|'{'
op|'}'
op|','
name|'json'
op|'.'
name|'dumps'
op|'('
op|'{'
string|'"storage"'
op|':'
op|'{'
string|'"default"'
op|':'
string|'"local"'
op|','
nl|'\n'
string|'"local"'
op|':'
string|'"http://127.0.0.1:8080/v1/AUTH_cfa"'
op|'}'
op|'}'
op|')'
op|')'
op|']'
op|')'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/auth/v1.0'"
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Auth-User'"
op|':'
string|"'act:usr'"
op|','
nl|'\n'
string|"'X-Auth-Key'"
op|':'
string|"'key'"
op|'}'
op|')'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'200'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'.'
name|'get'
op|'('
string|"'x-auth-token'"
op|','
nl|'\n'
string|"''"
op|')'
op|'.'
name|'startswith'
op|'('
string|"'AUTH_tk'"
op|')'
op|','
name|'resp'
op|'.'
name|'headers'
op|'.'
name|'get'
op|'('
string|"'x-auth-token'"
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'.'
name|'get'
op|'('
string|"'x-auth-token'"
op|')'
op|','
nl|'\n'
name|'resp'
op|'.'
name|'headers'
op|'.'
name|'get'
op|'('
string|"'x-storage-token'"
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'.'
name|'get'
op|'('
string|"'x-storage-url'"
op|')'
op|','
nl|'\n'
string|"'http://127.0.0.1:8080/v1/AUTH_cfa'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'json'
op|'.'
name|'loads'
op|'('
name|'resp'
op|'.'
name|'body'
op|')'
op|','
nl|'\n'
op|'{'
string|'"storage"'
op|':'
op|'{'
string|'"default"'
op|':'
string|'"local"'
op|','
nl|'\n'
string|'"local"'
op|':'
string|'"http://127.0.0.1:8080/v1/AUTH_cfa"'
op|'}'
op|'}'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_token_success_v1_act_auth
dedent|''
name|'def'
name|'test_get_token_success_v1_act_auth'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'app'
op|'='
name|'FakeApp'
op|'('
name|'iter'
op|'('
op|'['
nl|'\n'
comment|'# GET of user object'
nl|'\n'
op|'('
string|"'200 Ok'"
op|','
op|'{'
op|'}'
op|','
nl|'\n'
name|'json'
op|'.'
name|'dumps'
op|'('
op|'{'
string|'"auth"'
op|':'
string|'"plaintext:key"'
op|','
nl|'\n'
string|'"groups"'
op|':'
op|'['
op|'{'
string|"'name'"
op|':'
string|'"act:usr"'
op|'}'
op|','
op|'{'
string|"'name'"
op|':'
string|'"act"'
op|'}'
op|','
nl|'\n'
op|'{'
string|"'name'"
op|':'
string|'".admin"'
op|'}'
op|']'
op|'}'
op|')'
op|')'
op|','
nl|'\n'
comment|'# GET of account'
nl|'\n'
op|'('
string|"'204 Ok'"
op|','
op|'{'
string|"'X-Container-Meta-Account-Id'"
op|':'
string|"'AUTH_cfa'"
op|'}'
op|','
string|"''"
op|')'
op|','
nl|'\n'
comment|'# PUT of new token'
nl|'\n'
op|'('
string|"'201 Created'"
op|','
op|'{'
op|'}'
op|','
string|"''"
op|')'
op|','
nl|'\n'
comment|'# POST of token to user object'
nl|'\n'
op|'('
string|"'204 No Content'"
op|','
op|'{'
op|'}'
op|','
string|"''"
op|')'
op|','
nl|'\n'
comment|'# GET of services object'
nl|'\n'
op|'('
string|"'200 Ok'"
op|','
op|'{'
op|'}'
op|','
name|'json'
op|'.'
name|'dumps'
op|'('
op|'{'
string|'"storage"'
op|':'
op|'{'
string|'"default"'
op|':'
string|'"local"'
op|','
nl|'\n'
string|'"local"'
op|':'
string|'"http://127.0.0.1:8080/v1/AUTH_cfa"'
op|'}'
op|'}'
op|')'
op|')'
op|']'
op|')'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/auth/v1/act/auth'"
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Storage-User'"
op|':'
string|"'usr'"
op|','
nl|'\n'
string|"'X-Storage-Pass'"
op|':'
string|"'key'"
op|'}'
op|')'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'200'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'.'
name|'get'
op|'('
string|"'x-auth-token'"
op|','
nl|'\n'
string|"''"
op|')'
op|'.'
name|'startswith'
op|'('
string|"'AUTH_tk'"
op|')'
op|','
name|'resp'
op|'.'
name|'headers'
op|'.'
name|'get'
op|'('
string|"'x-auth-token'"
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'.'
name|'get'
op|'('
string|"'x-auth-token'"
op|')'
op|','
nl|'\n'
name|'resp'
op|'.'
name|'headers'
op|'.'
name|'get'
op|'('
string|"'x-storage-token'"
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'.'
name|'get'
op|'('
string|"'x-storage-url'"
op|')'
op|','
nl|'\n'
string|"'http://127.0.0.1:8080/v1/AUTH_cfa'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'json'
op|'.'
name|'loads'
op|'('
name|'resp'
op|'.'
name|'body'
op|')'
op|','
nl|'\n'
op|'{'
string|'"storage"'
op|':'
op|'{'
string|'"default"'
op|':'
string|'"local"'
op|','
nl|'\n'
string|'"local"'
op|':'
string|'"http://127.0.0.1:8080/v1/AUTH_cfa"'
op|'}'
op|'}'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_token_success_storage_instead_of_auth
dedent|''
name|'def'
name|'test_get_token_success_storage_instead_of_auth'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'app'
op|'='
name|'FakeApp'
op|'('
name|'iter'
op|'('
op|'['
nl|'\n'
comment|'# GET of user object'
nl|'\n'
op|'('
string|"'200 Ok'"
op|','
op|'{'
op|'}'
op|','
nl|'\n'
name|'json'
op|'.'
name|'dumps'
op|'('
op|'{'
string|'"auth"'
op|':'
string|'"plaintext:key"'
op|','
nl|'\n'
string|'"groups"'
op|':'
op|'['
op|'{'
string|"'name'"
op|':'
string|'"act:usr"'
op|'}'
op|','
op|'{'
string|"'name'"
op|':'
string|'"act"'
op|'}'
op|','
nl|'\n'
op|'{'
string|"'name'"
op|':'
string|'".admin"'
op|'}'
op|']'
op|'}'
op|')'
op|')'
op|','
nl|'\n'
comment|'# GET of account'
nl|'\n'
op|'('
string|"'204 Ok'"
op|','
op|'{'
string|"'X-Container-Meta-Account-Id'"
op|':'
string|"'AUTH_cfa'"
op|'}'
op|','
string|"''"
op|')'
op|','
nl|'\n'
comment|'# PUT of new token'
nl|'\n'
op|'('
string|"'201 Created'"
op|','
op|'{'
op|'}'
op|','
string|"''"
op|')'
op|','
nl|'\n'
comment|'# POST of token to user object'
nl|'\n'
op|'('
string|"'204 No Content'"
op|','
op|'{'
op|'}'
op|','
string|"''"
op|')'
op|','
nl|'\n'
comment|'# GET of services object'
nl|'\n'
op|'('
string|"'200 Ok'"
op|','
op|'{'
op|'}'
op|','
name|'json'
op|'.'
name|'dumps'
op|'('
op|'{'
string|'"storage"'
op|':'
op|'{'
string|'"default"'
op|':'
string|'"local"'
op|','
nl|'\n'
string|'"local"'
op|':'
string|'"http://127.0.0.1:8080/v1/AUTH_cfa"'
op|'}'
op|'}'
op|')'
op|')'
op|']'
op|')'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/auth/v1.0'"
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Storage-User'"
op|':'
string|"'act:usr'"
op|','
nl|'\n'
string|"'X-Storage-Pass'"
op|':'
string|"'key'"
op|'}'
op|')'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'200'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'.'
name|'get'
op|'('
string|"'x-auth-token'"
op|','
nl|'\n'
string|"''"
op|')'
op|'.'
name|'startswith'
op|'('
string|"'AUTH_tk'"
op|')'
op|','
name|'resp'
op|'.'
name|'headers'
op|'.'
name|'get'
op|'('
string|"'x-auth-token'"
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'.'
name|'get'
op|'('
string|"'x-auth-token'"
op|')'
op|','
nl|'\n'
name|'resp'
op|'.'
name|'headers'
op|'.'
name|'get'
op|'('
string|"'x-storage-token'"
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'.'
name|'get'
op|'('
string|"'x-storage-url'"
op|')'
op|','
nl|'\n'
string|"'http://127.0.0.1:8080/v1/AUTH_cfa'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'json'
op|'.'
name|'loads'
op|'('
name|'resp'
op|'.'
name|'body'
op|')'
op|','
nl|'\n'
op|'{'
string|'"storage"'
op|':'
op|'{'
string|'"default"'
op|':'
string|'"local"'
op|','
nl|'\n'
string|'"local"'
op|':'
string|'"http://127.0.0.1:8080/v1/AUTH_cfa"'
op|'}'
op|'}'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_token_success_v1_act_auth_auth_instead_of_storage
dedent|''
name|'def'
name|'test_get_token_success_v1_act_auth_auth_instead_of_storage'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'app'
op|'='
name|'FakeApp'
op|'('
name|'iter'
op|'('
op|'['
nl|'\n'
comment|'# GET of user object'
nl|'\n'
op|'('
string|"'200 Ok'"
op|','
op|'{'
op|'}'
op|','
nl|'\n'
name|'json'
op|'.'
name|'dumps'
op|'('
op|'{'
string|'"auth"'
op|':'
string|'"plaintext:key"'
op|','
nl|'\n'
string|'"groups"'
op|':'
op|'['
op|'{'
string|"'name'"
op|':'
string|'"act:usr"'
op|'}'
op|','
op|'{'
string|"'name'"
op|':'
string|'"act"'
op|'}'
op|','
nl|'\n'
op|'{'
string|"'name'"
op|':'
string|'".admin"'
op|'}'
op|']'
op|'}'
op|')'
op|')'
op|','
nl|'\n'
comment|'# GET of account'
nl|'\n'
op|'('
string|"'204 Ok'"
op|','
op|'{'
string|"'X-Container-Meta-Account-Id'"
op|':'
string|"'AUTH_cfa'"
op|'}'
op|','
string|"''"
op|')'
op|','
nl|'\n'
comment|'# PUT of new token'
nl|'\n'
op|'('
string|"'201 Created'"
op|','
op|'{'
op|'}'
op|','
string|"''"
op|')'
op|','
nl|'\n'
comment|'# POST of token to user object'
nl|'\n'
op|'('
string|"'204 No Content'"
op|','
op|'{'
op|'}'
op|','
string|"''"
op|')'
op|','
nl|'\n'
comment|'# GET of services object'
nl|'\n'
op|'('
string|"'200 Ok'"
op|','
op|'{'
op|'}'
op|','
name|'json'
op|'.'
name|'dumps'
op|'('
op|'{'
string|'"storage"'
op|':'
op|'{'
string|'"default"'
op|':'
string|'"local"'
op|','
nl|'\n'
string|'"local"'
op|':'
string|'"http://127.0.0.1:8080/v1/AUTH_cfa"'
op|'}'
op|'}'
op|')'
op|')'
op|']'
op|')'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/auth/v1/act/auth'"
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Auth-User'"
op|':'
string|"'act:usr'"
op|','
nl|'\n'
string|"'X-Auth-Key'"
op|':'
string|"'key'"
op|'}'
op|')'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'200'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'.'
name|'get'
op|'('
string|"'x-auth-token'"
op|','
nl|'\n'
string|"''"
op|')'
op|'.'
name|'startswith'
op|'('
string|"'AUTH_tk'"
op|')'
op|','
name|'resp'
op|'.'
name|'headers'
op|'.'
name|'get'
op|'('
string|"'x-auth-token'"
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'.'
name|'get'
op|'('
string|"'x-auth-token'"
op|')'
op|','
nl|'\n'
name|'resp'
op|'.'
name|'headers'
op|'.'
name|'get'
op|'('
string|"'x-storage-token'"
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'.'
name|'get'
op|'('
string|"'x-storage-url'"
op|')'
op|','
nl|'\n'
string|"'http://127.0.0.1:8080/v1/AUTH_cfa'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'json'
op|'.'
name|'loads'
op|'('
name|'resp'
op|'.'
name|'body'
op|')'
op|','
nl|'\n'
op|'{'
string|'"storage"'
op|':'
op|'{'
string|'"default"'
op|':'
string|'"local"'
op|','
nl|'\n'
string|'"local"'
op|':'
string|'"http://127.0.0.1:8080/v1/AUTH_cfa"'
op|'}'
op|'}'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_token_success_existing_token
dedent|''
name|'def'
name|'test_get_token_success_existing_token'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'test_auth'
op|'.'
name|'app'
op|'='
name|'FakeApp'
op|'('
name|'iter'
op|'('
op|'['
nl|'\n'
comment|'# GET of user object'
nl|'\n'
op|'('
string|"'200 Ok'"
op|','
op|'{'
string|"'X-Object-Meta-Auth-Token'"
op|':'
string|"'AUTH_tktest'"
op|'}'
op|','
nl|'\n'
name|'json'
op|'.'
name|'dumps'
op|'('
op|'{'
string|'"auth"'
op|':'
string|'"plaintext:key"'
op|','
nl|'\n'
string|'"groups"'
op|':'
op|'['
op|'{'
string|"'name'"
op|':'
string|'"act:usr"'
op|'}'
op|','
op|'{'
string|"'name'"
op|':'
string|'"act"'
op|'}'
op|','
nl|'\n'
op|'{'
string|"'name'"
op|':'
string|'".admin"'
op|'}'
op|']'
op|'}'
op|')'
op|')'
op|','
nl|'\n'
comment|'# GET of token'
nl|'\n'
op|'('
string|"'200 Ok'"
op|','
op|'{'
op|'}'
op|','
name|'json'
op|'.'
name|'dumps'
op|'('
op|'{'
string|'"account"'
op|':'
string|'"act"'
op|','
string|'"user"'
op|':'
string|'"usr"'
op|','
nl|'\n'
string|'"account_id"'
op|':'
string|'"AUTH_cfa"'
op|','
string|'"groups"'
op|':'
op|'['
op|'{'
string|"'name'"
op|':'
string|'"act:usr"'
op|'}'
op|','
nl|'\n'
op|'{'
string|"'name'"
op|':'
string|'"key"'
op|'}'
op|','
op|'{'
string|"'name'"
op|':'
string|'".admin"'
op|'}'
op|']'
op|','
nl|'\n'
string|'"expires"'
op|':'
number|'9999999999.9999999'
op|'}'
op|')'
op|')'
op|','
nl|'\n'
comment|'# GET of services object'
nl|'\n'
op|'('
string|"'200 Ok'"
op|','
op|'{'
op|'}'
op|','
name|'json'
op|'.'
name|'dumps'
op|'('
op|'{'
string|'"storage"'
op|':'
op|'{'
string|'"default"'
op|':'
string|'"local"'
op|','
nl|'\n'
string|'"local"'
op|':'
string|'"http://127.0.0.1:8080/v1/AUTH_cfa"'
op|'}'
op|'}'
op|')'
op|')'
op|']'
op|')'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'Request'
op|'.'
name|'blank'
op|'('
string|"'/auth/v1.0'"
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Auth-User'"
op|':'
string|"'act:usr'"
op|','
nl|'\n'
string|"'X-Auth-Key'"
op|':'
string|"'key'"
op|'}'
op|')'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'test_auth'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'200'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'.'
name|'get'
op|'('
string|"'x-auth-token'"
op|')'
op|','
string|"'AUTH_tktest'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'.'
name|'get'
op|'('
string|"'x-auth-token'"
op|')'
op|','
nl|'\n'
name|'resp'
op|'.'
name|'headers'
op|'.'
name|'get'
op|'('
string|"'x-storage-token'"
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'resp'
op|'.'
name|'headers'
op|'.'
name|'get'
op|'('
string|"'x-storage-url'"
op|')'
op|','
nl|'\n'
string|"'http://127.0.0.1:8080/v1/AUTH_cfa'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'json'
op|'.'
name|'loads'
op|'('
name|'resp'
op|'.'
name|'body'
op|')'
op|','
nl|'\n'
op|'{'
string|'"storage"'
op|':'
op|'{'
string|'"default"'
op|':'
string|'"local"'
op|','
nl|'\n'
string|'"local"'
op|':'
string|'"http://127.0.0.1:8080/v1/AUTH_cfa"'
op|'}'
op|'}'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
dedent|''
dedent|''
name|'if'
name|'__name__'
op|'=='
string|"'__main__'"
op|':'
newline|'\n'
indent|'    '
name|'unittest'
op|'.'
name|'main'
op|'('
op|')'
newline|'\n'
dedent|''
endmarker|''
end_unit
