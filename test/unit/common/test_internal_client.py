begin_unit
comment|'# Copyright (c) 2010-2012 OpenStack Foundation'
nl|'\n'
comment|'#'
nl|'\n'
comment|'# Licensed under the Apache License, Version 2.0 (the "License");'
nl|'\n'
comment|'# you may not use this file except in compliance with the License.'
nl|'\n'
comment|'# You may obtain a copy of the License at'
nl|'\n'
comment|'#'
nl|'\n'
comment|'#    http://www.apache.org/licenses/LICENSE-2.0'
nl|'\n'
comment|'#'
nl|'\n'
comment|'# Unless required by applicable law or agreed to in writing, software'
nl|'\n'
comment|'# distributed under the License is distributed on an "AS IS" BASIS,'
nl|'\n'
comment|'# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or'
nl|'\n'
comment|'# implied.'
nl|'\n'
comment|'# See the License for the specific language governing permissions and'
nl|'\n'
comment|'# limitations under the License.'
nl|'\n'
nl|'\n'
name|'import'
name|'json'
newline|'\n'
name|'import'
name|'mock'
newline|'\n'
name|'import'
name|'unittest'
newline|'\n'
name|'import'
name|'zlib'
newline|'\n'
name|'from'
name|'textwrap'
name|'import'
name|'dedent'
newline|'\n'
name|'import'
name|'os'
newline|'\n'
nl|'\n'
name|'import'
name|'six'
newline|'\n'
name|'from'
name|'six'
name|'import'
name|'StringIO'
newline|'\n'
name|'from'
name|'six'
op|'.'
name|'moves'
name|'import'
name|'range'
newline|'\n'
name|'from'
name|'six'
op|'.'
name|'moves'
op|'.'
name|'urllib'
op|'.'
name|'parse'
name|'import'
name|'quote'
newline|'\n'
name|'from'
name|'test'
op|'.'
name|'unit'
name|'import'
name|'FakeLogger'
newline|'\n'
name|'from'
name|'eventlet'
op|'.'
name|'green'
name|'import'
name|'urllib2'
newline|'\n'
name|'from'
name|'swift'
op|'.'
name|'common'
name|'import'
name|'exceptions'
op|','
name|'internal_client'
op|','
name|'swob'
newline|'\n'
name|'from'
name|'swift'
op|'.'
name|'common'
op|'.'
name|'header_key_dict'
name|'import'
name|'HeaderKeyDict'
newline|'\n'
name|'from'
name|'swift'
op|'.'
name|'common'
op|'.'
name|'storage_policy'
name|'import'
name|'StoragePolicy'
newline|'\n'
nl|'\n'
name|'from'
name|'test'
op|'.'
name|'unit'
name|'import'
name|'with_tempdir'
op|','
name|'write_fake_ring'
op|','
name|'patch_policies'
newline|'\n'
name|'from'
name|'test'
op|'.'
name|'unit'
op|'.'
name|'common'
op|'.'
name|'middleware'
op|'.'
name|'helpers'
name|'import'
name|'FakeSwift'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|FakeConn
name|'class'
name|'FakeConn'
op|'('
name|'object'
op|')'
op|':'
newline|'\n'
DECL|member|__init__
indent|'    '
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'body'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'body'
name|'is'
name|'None'
op|':'
newline|'\n'
indent|'            '
name|'body'
op|'='
op|'['
op|']'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'body'
op|'='
name|'body'
newline|'\n'
nl|'\n'
DECL|member|read
dedent|''
name|'def'
name|'read'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'json'
op|'.'
name|'dumps'
op|'('
name|'self'
op|'.'
name|'body'
op|')'
newline|'\n'
nl|'\n'
DECL|member|info
dedent|''
name|'def'
name|'info'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
op|'{'
op|'}'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|function|not_sleep
dedent|''
dedent|''
name|'def'
name|'not_sleep'
op|'('
name|'seconds'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'pass'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|function|unicode_string
dedent|''
name|'def'
name|'unicode_string'
op|'('
name|'start'
op|','
name|'length'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'return'
string|"u''"
op|'.'
name|'join'
op|'('
op|'['
name|'six'
op|'.'
name|'unichr'
op|'('
name|'x'
op|')'
name|'for'
name|'x'
name|'in'
name|'range'
op|'('
name|'start'
op|','
name|'start'
op|'+'
name|'length'
op|')'
op|']'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|function|path_parts
dedent|''
name|'def'
name|'path_parts'
op|'('
op|')'
op|':'
newline|'\n'
indent|'    '
name|'account'
op|'='
name|'unicode_string'
op|'('
number|'1000'
op|','
number|'4'
op|')'
op|'+'
string|"' '"
op|'+'
name|'unicode_string'
op|'('
number|'1100'
op|','
number|'4'
op|')'
newline|'\n'
name|'container'
op|'='
name|'unicode_string'
op|'('
number|'2000'
op|','
number|'4'
op|')'
op|'+'
string|"' '"
op|'+'
name|'unicode_string'
op|'('
number|'2100'
op|','
number|'4'
op|')'
newline|'\n'
name|'obj'
op|'='
name|'unicode_string'
op|'('
number|'3000'
op|','
number|'4'
op|')'
op|'+'
string|"' '"
op|'+'
name|'unicode_string'
op|'('
number|'3100'
op|','
number|'4'
op|')'
newline|'\n'
name|'return'
name|'account'
op|','
name|'container'
op|','
name|'obj'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|function|make_path
dedent|''
name|'def'
name|'make_path'
op|'('
name|'account'
op|','
name|'container'
op|'='
name|'None'
op|','
name|'obj'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'path'
op|'='
string|"'/v1/%s'"
op|'%'
name|'quote'
op|'('
name|'account'
op|'.'
name|'encode'
op|'('
string|"'utf-8'"
op|')'
op|')'
newline|'\n'
name|'if'
name|'container'
op|':'
newline|'\n'
indent|'        '
name|'path'
op|'+='
string|"'/%s'"
op|'%'
name|'quote'
op|'('
name|'container'
op|'.'
name|'encode'
op|'('
string|"'utf-8'"
op|')'
op|')'
newline|'\n'
dedent|''
name|'if'
name|'obj'
op|':'
newline|'\n'
indent|'        '
name|'path'
op|'+='
string|"'/%s'"
op|'%'
name|'quote'
op|'('
name|'obj'
op|'.'
name|'encode'
op|'('
string|"'utf-8'"
op|')'
op|')'
newline|'\n'
dedent|''
name|'return'
name|'path'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|function|make_path_info
dedent|''
name|'def'
name|'make_path_info'
op|'('
name|'account'
op|','
name|'container'
op|'='
name|'None'
op|','
name|'obj'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
comment|'# FakeSwift keys on PATH_INFO - which is *encoded* but unquoted'
nl|'\n'
indent|'    '
name|'path'
op|'='
string|"'/v1/%s'"
op|'%'
string|"'/'"
op|'.'
name|'join'
op|'('
nl|'\n'
name|'p'
name|'for'
name|'p'
name|'in'
op|'('
name|'account'
op|','
name|'container'
op|','
name|'obj'
op|')'
name|'if'
name|'p'
op|')'
newline|'\n'
name|'return'
name|'path'
op|'.'
name|'encode'
op|'('
string|"'utf-8'"
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|function|get_client_app
dedent|''
name|'def'
name|'get_client_app'
op|'('
op|')'
op|':'
newline|'\n'
indent|'    '
name|'app'
op|'='
name|'FakeSwift'
op|'('
op|')'
newline|'\n'
name|'with'
name|'mock'
op|'.'
name|'patch'
op|'('
string|"'swift.common.internal_client.loadapp'"
op|','
nl|'\n'
name|'new'
op|'='
name|'lambda'
op|'*'
name|'args'
op|','
op|'**'
name|'kwargs'
op|':'
name|'app'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'client'
op|'='
name|'internal_client'
op|'.'
name|'InternalClient'
op|'('
op|'{'
op|'}'
op|','
string|"'test'"
op|','
number|'1'
op|')'
newline|'\n'
dedent|''
name|'return'
name|'client'
op|','
name|'app'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|InternalClient
dedent|''
name|'class'
name|'InternalClient'
op|'('
name|'internal_client'
op|'.'
name|'InternalClient'
op|')'
op|':'
newline|'\n'
DECL|member|__init__
indent|'    '
name|'def'
name|'__init__'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'pass'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|GetMetadataInternalClient
dedent|''
dedent|''
name|'class'
name|'GetMetadataInternalClient'
op|'('
name|'internal_client'
op|'.'
name|'InternalClient'
op|')'
op|':'
newline|'\n'
DECL|member|__init__
indent|'    '
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'test'
op|','
name|'path'
op|','
name|'metadata_prefix'
op|','
name|'acceptable_statuses'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'test'
op|'='
name|'test'
newline|'\n'
name|'self'
op|'.'
name|'path'
op|'='
name|'path'
newline|'\n'
name|'self'
op|'.'
name|'metadata_prefix'
op|'='
name|'metadata_prefix'
newline|'\n'
name|'self'
op|'.'
name|'acceptable_statuses'
op|'='
name|'acceptable_statuses'
newline|'\n'
name|'self'
op|'.'
name|'get_metadata_called'
op|'='
number|'0'
newline|'\n'
name|'self'
op|'.'
name|'metadata'
op|'='
string|"'some_metadata'"
newline|'\n'
nl|'\n'
DECL|member|_get_metadata
dedent|''
name|'def'
name|'_get_metadata'
op|'('
name|'self'
op|','
name|'path'
op|','
name|'metadata_prefix'
op|','
name|'acceptable_statuses'
op|'='
name|'None'
op|','
nl|'\n'
name|'headers'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'get_metadata_called'
op|'+='
number|'1'
newline|'\n'
name|'self'
op|'.'
name|'test'
op|'.'
name|'assertEqual'
op|'('
name|'self'
op|'.'
name|'path'
op|','
name|'path'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'test'
op|'.'
name|'assertEqual'
op|'('
name|'self'
op|'.'
name|'metadata_prefix'
op|','
name|'metadata_prefix'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'test'
op|'.'
name|'assertEqual'
op|'('
name|'self'
op|'.'
name|'acceptable_statuses'
op|','
name|'acceptable_statuses'
op|')'
newline|'\n'
name|'return'
name|'self'
op|'.'
name|'metadata'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|SetMetadataInternalClient
dedent|''
dedent|''
name|'class'
name|'SetMetadataInternalClient'
op|'('
name|'internal_client'
op|'.'
name|'InternalClient'
op|')'
op|':'
newline|'\n'
DECL|member|__init__
indent|'    '
name|'def'
name|'__init__'
op|'('
nl|'\n'
name|'self'
op|','
name|'test'
op|','
name|'path'
op|','
name|'metadata'
op|','
name|'metadata_prefix'
op|','
name|'acceptable_statuses'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'test'
op|'='
name|'test'
newline|'\n'
name|'self'
op|'.'
name|'path'
op|'='
name|'path'
newline|'\n'
name|'self'
op|'.'
name|'metadata'
op|'='
name|'metadata'
newline|'\n'
name|'self'
op|'.'
name|'metadata_prefix'
op|'='
name|'metadata_prefix'
newline|'\n'
name|'self'
op|'.'
name|'acceptable_statuses'
op|'='
name|'acceptable_statuses'
newline|'\n'
name|'self'
op|'.'
name|'set_metadata_called'
op|'='
number|'0'
newline|'\n'
name|'self'
op|'.'
name|'metadata'
op|'='
string|"'some_metadata'"
newline|'\n'
nl|'\n'
DECL|member|_set_metadata
dedent|''
name|'def'
name|'_set_metadata'
op|'('
nl|'\n'
name|'self'
op|','
name|'path'
op|','
name|'metadata'
op|','
name|'metadata_prefix'
op|'='
string|"''"
op|','
nl|'\n'
name|'acceptable_statuses'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'set_metadata_called'
op|'+='
number|'1'
newline|'\n'
name|'self'
op|'.'
name|'test'
op|'.'
name|'assertEqual'
op|'('
name|'self'
op|'.'
name|'path'
op|','
name|'path'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'test'
op|'.'
name|'assertEqual'
op|'('
name|'self'
op|'.'
name|'metadata_prefix'
op|','
name|'metadata_prefix'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'test'
op|'.'
name|'assertEqual'
op|'('
name|'self'
op|'.'
name|'metadata'
op|','
name|'metadata'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'test'
op|'.'
name|'assertEqual'
op|'('
name|'self'
op|'.'
name|'acceptable_statuses'
op|','
name|'acceptable_statuses'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|IterInternalClient
dedent|''
dedent|''
name|'class'
name|'IterInternalClient'
op|'('
name|'internal_client'
op|'.'
name|'InternalClient'
op|')'
op|':'
newline|'\n'
DECL|member|__init__
indent|'    '
name|'def'
name|'__init__'
op|'('
nl|'\n'
name|'self'
op|','
name|'test'
op|','
name|'path'
op|','
name|'marker'
op|','
name|'end_marker'
op|','
name|'acceptable_statuses'
op|','
name|'items'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'test'
op|'='
name|'test'
newline|'\n'
name|'self'
op|'.'
name|'path'
op|'='
name|'path'
newline|'\n'
name|'self'
op|'.'
name|'marker'
op|'='
name|'marker'
newline|'\n'
name|'self'
op|'.'
name|'end_marker'
op|'='
name|'end_marker'
newline|'\n'
name|'self'
op|'.'
name|'acceptable_statuses'
op|'='
name|'acceptable_statuses'
newline|'\n'
name|'self'
op|'.'
name|'items'
op|'='
name|'items'
newline|'\n'
nl|'\n'
DECL|member|_iter_items
dedent|''
name|'def'
name|'_iter_items'
op|'('
nl|'\n'
name|'self'
op|','
name|'path'
op|','
name|'marker'
op|'='
string|"''"
op|','
name|'end_marker'
op|'='
string|"''"
op|','
name|'acceptable_statuses'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'test'
op|'.'
name|'assertEqual'
op|'('
name|'self'
op|'.'
name|'path'
op|','
name|'path'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'test'
op|'.'
name|'assertEqual'
op|'('
name|'self'
op|'.'
name|'marker'
op|','
name|'marker'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'test'
op|'.'
name|'assertEqual'
op|'('
name|'self'
op|'.'
name|'end_marker'
op|','
name|'end_marker'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'test'
op|'.'
name|'assertEqual'
op|'('
name|'self'
op|'.'
name|'acceptable_statuses'
op|','
name|'acceptable_statuses'
op|')'
newline|'\n'
name|'for'
name|'item'
name|'in'
name|'self'
op|'.'
name|'items'
op|':'
newline|'\n'
indent|'            '
name|'yield'
name|'item'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|TestCompressingfileReader
dedent|''
dedent|''
dedent|''
name|'class'
name|'TestCompressingfileReader'
op|'('
name|'unittest'
op|'.'
name|'TestCase'
op|')'
op|':'
newline|'\n'
DECL|member|test_init
indent|'    '
name|'def'
name|'test_init'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
DECL|class|CompressObj
indent|'        '
name|'class'
name|'CompressObj'
op|'('
name|'object'
op|')'
op|':'
newline|'\n'
DECL|member|__init__
indent|'            '
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'test'
op|','
op|'*'
name|'args'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'test'
op|'='
name|'test'
newline|'\n'
name|'self'
op|'.'
name|'args'
op|'='
name|'args'
newline|'\n'
nl|'\n'
DECL|member|method
dedent|''
name|'def'
name|'method'
op|'('
name|'self'
op|','
op|'*'
name|'args'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'test'
op|'.'
name|'assertEqual'
op|'('
name|'self'
op|'.'
name|'args'
op|','
name|'args'
op|')'
newline|'\n'
name|'return'
name|'self'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'try'
op|':'
newline|'\n'
DECL|variable|compressobj
indent|'            '
name|'compressobj'
op|'='
name|'CompressObj'
op|'('
nl|'\n'
name|'self'
op|','
number|'9'
op|','
name|'zlib'
op|'.'
name|'DEFLATED'
op|','
op|'-'
name|'zlib'
op|'.'
name|'MAX_WBITS'
op|','
name|'zlib'
op|'.'
name|'DEF_MEM_LEVEL'
op|','
number|'0'
op|')'
newline|'\n'
nl|'\n'
DECL|variable|old_compressobj
name|'old_compressobj'
op|'='
name|'internal_client'
op|'.'
name|'compressobj'
newline|'\n'
name|'internal_client'
op|'.'
name|'compressobj'
op|'='
name|'compressobj'
op|'.'
name|'method'
newline|'\n'
nl|'\n'
DECL|variable|f
name|'f'
op|'='
name|'StringIO'
op|'('
string|"''"
op|')'
newline|'\n'
nl|'\n'
DECL|variable|fobj
name|'fobj'
op|'='
name|'internal_client'
op|'.'
name|'CompressingFileReader'
op|'('
name|'f'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'f'
op|','
name|'fobj'
op|'.'
name|'_f'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'compressobj'
op|','
name|'fobj'
op|'.'
name|'_compressor'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'False'
op|','
name|'fobj'
op|'.'
name|'done'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'True'
op|','
name|'fobj'
op|'.'
name|'first'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'0'
op|','
name|'fobj'
op|'.'
name|'crc32'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'0'
op|','
name|'fobj'
op|'.'
name|'total_size'
op|')'
newline|'\n'
dedent|''
name|'finally'
op|':'
newline|'\n'
indent|'            '
name|'internal_client'
op|'.'
name|'compressobj'
op|'='
name|'old_compressobj'
newline|'\n'
nl|'\n'
DECL|member|test_read
dedent|''
dedent|''
name|'def'
name|'test_read'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'exp_data'
op|'='
string|"'abcdefghijklmnopqrstuvwxyz'"
newline|'\n'
name|'fobj'
op|'='
name|'internal_client'
op|'.'
name|'CompressingFileReader'
op|'('
nl|'\n'
name|'StringIO'
op|'('
name|'exp_data'
op|')'
op|','
name|'chunk_size'
op|'='
number|'5'
op|')'
newline|'\n'
nl|'\n'
name|'data'
op|'='
string|"''"
newline|'\n'
name|'d'
op|'='
name|'zlib'
op|'.'
name|'decompressobj'
op|'('
number|'16'
op|'+'
name|'zlib'
op|'.'
name|'MAX_WBITS'
op|')'
newline|'\n'
name|'for'
name|'chunk'
name|'in'
name|'fobj'
op|'.'
name|'read'
op|'('
op|')'
op|':'
newline|'\n'
indent|'            '
name|'data'
op|'+='
name|'d'
op|'.'
name|'decompress'
op|'('
name|'chunk'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'exp_data'
op|','
name|'data'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_seek
dedent|''
name|'def'
name|'test_seek'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'exp_data'
op|'='
string|"'abcdefghijklmnopqrstuvwxyz'"
newline|'\n'
name|'fobj'
op|'='
name|'internal_client'
op|'.'
name|'CompressingFileReader'
op|'('
nl|'\n'
name|'StringIO'
op|'('
name|'exp_data'
op|')'
op|','
name|'chunk_size'
op|'='
number|'5'
op|')'
newline|'\n'
nl|'\n'
comment|'# read a couple of chunks only'
nl|'\n'
name|'for'
name|'_'
name|'in'
name|'range'
op|'('
number|'2'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'fobj'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
nl|'\n'
comment|'# read whole thing after seek and check data'
nl|'\n'
dedent|''
name|'fobj'
op|'.'
name|'seek'
op|'('
number|'0'
op|')'
newline|'\n'
name|'data'
op|'='
string|"''"
newline|'\n'
name|'d'
op|'='
name|'zlib'
op|'.'
name|'decompressobj'
op|'('
number|'16'
op|'+'
name|'zlib'
op|'.'
name|'MAX_WBITS'
op|')'
newline|'\n'
name|'for'
name|'chunk'
name|'in'
name|'fobj'
op|'.'
name|'read'
op|'('
op|')'
op|':'
newline|'\n'
indent|'            '
name|'data'
op|'+='
name|'d'
op|'.'
name|'decompress'
op|'('
name|'chunk'
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'exp_data'
op|','
name|'data'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_seek_not_implemented_exception
dedent|''
name|'def'
name|'test_seek_not_implemented_exception'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'fobj'
op|'='
name|'internal_client'
op|'.'
name|'CompressingFileReader'
op|'('
nl|'\n'
name|'StringIO'
op|'('
string|"''"
op|')'
op|','
name|'chunk_size'
op|'='
number|'5'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'NotImplementedError'
op|','
name|'fobj'
op|'.'
name|'seek'
op|','
number|'10'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'NotImplementedError'
op|','
name|'fobj'
op|'.'
name|'seek'
op|','
number|'0'
op|','
number|'10'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|TestInternalClient
dedent|''
dedent|''
name|'class'
name|'TestInternalClient'
op|'('
name|'unittest'
op|'.'
name|'TestCase'
op|')'
op|':'
newline|'\n'
nl|'\n'
indent|'    '
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'('
string|"'swift.common.utils.HASH_PATH_SUFFIX'"
op|','
name|'new'
op|'='
string|"'endcap'"
op|')'
newline|'\n'
op|'@'
name|'with_tempdir'
newline|'\n'
DECL|member|test_load_from_config
name|'def'
name|'test_load_from_config'
op|'('
name|'self'
op|','
name|'tempdir'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'conf_path'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'tempdir'
op|','
string|"'interal_client.conf'"
op|')'
newline|'\n'
name|'conf_body'
op|'='
string|'"""\n        [DEFAULT]\n        swift_dir = %s\n\n        [pipeline:main]\n        pipeline = catch_errors cache proxy-server\n\n        [app:proxy-server]\n        use = egg:swift#proxy\n        auto_create_account_prefix = -\n\n        [filter:cache]\n        use = egg:swift#memcache\n\n        [filter:catch_errors]\n        use = egg:swift#catch_errors\n        """'
op|'%'
name|'tempdir'
newline|'\n'
name|'with'
name|'open'
op|'('
name|'conf_path'
op|','
string|"'w'"
op|')'
name|'as'
name|'f'
op|':'
newline|'\n'
indent|'            '
name|'f'
op|'.'
name|'write'
op|'('
name|'dedent'
op|'('
name|'conf_body'
op|')'
op|')'
newline|'\n'
dedent|''
name|'account_ring_path'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'tempdir'
op|','
string|"'account.ring.gz'"
op|')'
newline|'\n'
name|'write_fake_ring'
op|'('
name|'account_ring_path'
op|')'
newline|'\n'
name|'container_ring_path'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'tempdir'
op|','
string|"'container.ring.gz'"
op|')'
newline|'\n'
name|'write_fake_ring'
op|'('
name|'container_ring_path'
op|')'
newline|'\n'
name|'object_ring_path'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'tempdir'
op|','
string|"'object.ring.gz'"
op|')'
newline|'\n'
name|'write_fake_ring'
op|'('
name|'object_ring_path'
op|')'
newline|'\n'
name|'with'
name|'patch_policies'
op|'('
op|'['
name|'StoragePolicy'
op|'('
number|'0'
op|','
string|"'legacy'"
op|','
name|'True'
op|')'
op|']'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'client'
op|'='
name|'internal_client'
op|'.'
name|'InternalClient'
op|'('
name|'conf_path'
op|','
string|"'test'"
op|','
number|'1'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'client'
op|'.'
name|'account_ring'
op|','
nl|'\n'
name|'client'
op|'.'
name|'app'
op|'.'
name|'app'
op|'.'
name|'app'
op|'.'
name|'account_ring'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'client'
op|'.'
name|'account_ring'
op|'.'
name|'serialized_path'
op|','
nl|'\n'
name|'account_ring_path'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'client'
op|'.'
name|'container_ring'
op|','
nl|'\n'
name|'client'
op|'.'
name|'app'
op|'.'
name|'app'
op|'.'
name|'app'
op|'.'
name|'container_ring'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'client'
op|'.'
name|'container_ring'
op|'.'
name|'serialized_path'
op|','
nl|'\n'
name|'container_ring_path'
op|')'
newline|'\n'
name|'object_ring'
op|'='
name|'client'
op|'.'
name|'app'
op|'.'
name|'app'
op|'.'
name|'app'
op|'.'
name|'get_object_ring'
op|'('
number|'0'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'client'
op|'.'
name|'get_object_ring'
op|'('
number|'0'
op|')'
op|','
nl|'\n'
name|'object_ring'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'object_ring'
op|'.'
name|'serialized_path'
op|','
nl|'\n'
name|'object_ring_path'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'client'
op|'.'
name|'auto_create_account_prefix'
op|','
string|"'-'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_init
dedent|''
dedent|''
name|'def'
name|'test_init'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
DECL|class|App
indent|'        '
name|'class'
name|'App'
op|'('
name|'object'
op|')'
op|':'
newline|'\n'
DECL|member|__init__
indent|'            '
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'test'
op|','
name|'conf_path'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'test'
op|'='
name|'test'
newline|'\n'
name|'self'
op|'.'
name|'conf_path'
op|'='
name|'conf_path'
newline|'\n'
name|'self'
op|'.'
name|'load_called'
op|'='
number|'0'
newline|'\n'
nl|'\n'
DECL|member|load
dedent|''
name|'def'
name|'load'
op|'('
name|'self'
op|','
name|'uri'
op|','
name|'allow_modify_pipeline'
op|'='
name|'True'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'load_called'
op|'+='
number|'1'
newline|'\n'
name|'self'
op|'.'
name|'test'
op|'.'
name|'assertEqual'
op|'('
name|'conf_path'
op|','
name|'uri'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'test'
op|'.'
name|'assertFalse'
op|'('
name|'allow_modify_pipeline'
op|')'
newline|'\n'
name|'return'
name|'self'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'conf_path'
op|'='
string|"'some_path'"
newline|'\n'
name|'app'
op|'='
name|'App'
op|'('
name|'self'
op|','
name|'conf_path'
op|')'
newline|'\n'
name|'old_loadapp'
op|'='
name|'internal_client'
op|'.'
name|'loadapp'
newline|'\n'
name|'internal_client'
op|'.'
name|'loadapp'
op|'='
name|'app'
op|'.'
name|'load'
newline|'\n'
nl|'\n'
name|'user_agent'
op|'='
string|"'some_user_agent'"
newline|'\n'
name|'request_tries'
op|'='
string|"'some_request_tries'"
newline|'\n'
nl|'\n'
name|'try'
op|':'
newline|'\n'
DECL|variable|client
indent|'            '
name|'client'
op|'='
name|'internal_client'
op|'.'
name|'InternalClient'
op|'('
nl|'\n'
name|'conf_path'
op|','
name|'user_agent'
op|','
name|'request_tries'
op|')'
newline|'\n'
dedent|''
name|'finally'
op|':'
newline|'\n'
indent|'            '
name|'internal_client'
op|'.'
name|'loadapp'
op|'='
name|'old_loadapp'
newline|'\n'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'1'
op|','
name|'app'
op|'.'
name|'load_called'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'app'
op|','
name|'client'
op|'.'
name|'app'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'user_agent'
op|','
name|'client'
op|'.'
name|'user_agent'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'request_tries'
op|','
name|'client'
op|'.'
name|'request_tries'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_make_request_sets_user_agent
dedent|''
name|'def'
name|'test_make_request_sets_user_agent'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
DECL|class|InternalClient
indent|'        '
name|'class'
name|'InternalClient'
op|'('
name|'internal_client'
op|'.'
name|'InternalClient'
op|')'
op|':'
newline|'\n'
DECL|member|__init__
indent|'            '
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'test'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'test'
op|'='
name|'test'
newline|'\n'
name|'self'
op|'.'
name|'app'
op|'='
name|'self'
op|'.'
name|'fake_app'
newline|'\n'
name|'self'
op|'.'
name|'user_agent'
op|'='
string|"'some_agent'"
newline|'\n'
name|'self'
op|'.'
name|'request_tries'
op|'='
number|'1'
newline|'\n'
nl|'\n'
DECL|member|fake_app
dedent|''
name|'def'
name|'fake_app'
op|'('
name|'self'
op|','
name|'env'
op|','
name|'start_response'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'test'
op|'.'
name|'assertEqual'
op|'('
name|'self'
op|'.'
name|'user_agent'
op|','
name|'env'
op|'['
string|"'HTTP_USER_AGENT'"
op|']'
op|')'
newline|'\n'
name|'start_response'
op|'('
string|"'200 Ok'"
op|','
op|'['
op|'('
string|"'Content-Length'"
op|','
string|"'0'"
op|')'
op|']'
op|')'
newline|'\n'
name|'return'
op|'['
op|']'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'client'
op|'='
name|'InternalClient'
op|'('
name|'self'
op|')'
newline|'\n'
name|'client'
op|'.'
name|'make_request'
op|'('
string|"'GET'"
op|','
string|"'/'"
op|','
op|'{'
op|'}'
op|','
op|'('
number|'200'
op|','
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_make_request_retries
dedent|''
name|'def'
name|'test_make_request_retries'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
DECL|class|InternalClient
indent|'        '
name|'class'
name|'InternalClient'
op|'('
name|'internal_client'
op|'.'
name|'InternalClient'
op|')'
op|':'
newline|'\n'
DECL|member|__init__
indent|'            '
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'test'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'test'
op|'='
name|'test'
newline|'\n'
name|'self'
op|'.'
name|'app'
op|'='
name|'self'
op|'.'
name|'fake_app'
newline|'\n'
name|'self'
op|'.'
name|'user_agent'
op|'='
string|"'some_agent'"
newline|'\n'
name|'self'
op|'.'
name|'request_tries'
op|'='
number|'4'
newline|'\n'
name|'self'
op|'.'
name|'tries'
op|'='
number|'0'
newline|'\n'
name|'self'
op|'.'
name|'sleep_called'
op|'='
number|'0'
newline|'\n'
nl|'\n'
DECL|member|fake_app
dedent|''
name|'def'
name|'fake_app'
op|'('
name|'self'
op|','
name|'env'
op|','
name|'start_response'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'tries'
op|'+='
number|'1'
newline|'\n'
name|'if'
name|'self'
op|'.'
name|'tries'
op|'<'
name|'self'
op|'.'
name|'request_tries'
op|':'
newline|'\n'
indent|'                    '
name|'start_response'
op|'('
nl|'\n'
string|"'500 Internal Server Error'"
op|','
op|'['
op|'('
string|"'Content-Length'"
op|','
string|"'0'"
op|')'
op|']'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                    '
name|'start_response'
op|'('
string|"'200 Ok'"
op|','
op|'['
op|'('
string|"'Content-Length'"
op|','
string|"'0'"
op|')'
op|']'
op|')'
newline|'\n'
dedent|''
name|'return'
op|'['
op|']'
newline|'\n'
nl|'\n'
DECL|member|sleep
dedent|''
name|'def'
name|'sleep'
op|'('
name|'self'
op|','
name|'seconds'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'sleep_called'
op|'+='
number|'1'
newline|'\n'
name|'self'
op|'.'
name|'test'
op|'.'
name|'assertEqual'
op|'('
number|'2'
op|'**'
op|'('
name|'self'
op|'.'
name|'sleep_called'
op|')'
op|','
name|'seconds'
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'client'
op|'='
name|'InternalClient'
op|'('
name|'self'
op|')'
newline|'\n'
nl|'\n'
name|'old_sleep'
op|'='
name|'internal_client'
op|'.'
name|'sleep'
newline|'\n'
name|'internal_client'
op|'.'
name|'sleep'
op|'='
name|'client'
op|'.'
name|'sleep'
newline|'\n'
nl|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'client'
op|'.'
name|'make_request'
op|'('
string|"'GET'"
op|','
string|"'/'"
op|','
op|'{'
op|'}'
op|','
op|'('
number|'200'
op|','
op|')'
op|')'
newline|'\n'
dedent|''
name|'finally'
op|':'
newline|'\n'
indent|'            '
name|'internal_client'
op|'.'
name|'sleep'
op|'='
name|'old_sleep'
newline|'\n'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'3'
op|','
name|'client'
op|'.'
name|'sleep_called'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'4'
op|','
name|'client'
op|'.'
name|'tries'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_base_request_timeout
dedent|''
name|'def'
name|'test_base_request_timeout'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# verify that base_request passes timeout arg on to urlopen'
nl|'\n'
indent|'        '
name|'body'
op|'='
op|'{'
string|'"some"'
op|':'
string|'"content"'
op|'}'
newline|'\n'
nl|'\n'
name|'for'
name|'timeout'
name|'in'
op|'('
number|'0.0'
op|','
number|'42.0'
op|','
name|'None'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'mocked_func'
op|'='
string|"'swift.common.internal_client.urllib2.urlopen'"
newline|'\n'
name|'with'
name|'mock'
op|'.'
name|'patch'
op|'('
name|'mocked_func'
op|')'
name|'as'
name|'mock_urlopen'
op|':'
newline|'\n'
indent|'                '
name|'mock_urlopen'
op|'.'
name|'side_effect'
op|'='
op|'['
name|'FakeConn'
op|'('
name|'body'
op|')'
op|']'
newline|'\n'
name|'sc'
op|'='
name|'internal_client'
op|'.'
name|'SimpleClient'
op|'('
string|"'http://0.0.0.0/'"
op|')'
newline|'\n'
name|'_'
op|','
name|'resp_body'
op|'='
name|'sc'
op|'.'
name|'base_request'
op|'('
string|"'GET'"
op|','
name|'timeout'
op|'='
name|'timeout'
op|')'
newline|'\n'
name|'mock_urlopen'
op|'.'
name|'assert_called_once_with'
op|'('
name|'mock'
op|'.'
name|'ANY'
op|','
name|'timeout'
op|'='
name|'timeout'
op|')'
newline|'\n'
comment|'# sanity check'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'body'
op|','
name|'resp_body'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_base_full_listing
dedent|''
dedent|''
dedent|''
name|'def'
name|'test_base_full_listing'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'body1'
op|'='
op|'['
op|'{'
string|"'name'"
op|':'
string|"'a'"
op|'}'
op|','
op|'{'
string|"'name'"
op|':'
string|'"b"'
op|'}'
op|','
op|'{'
string|"'name'"
op|':'
string|'"c"'
op|'}'
op|']'
newline|'\n'
name|'body2'
op|'='
op|'['
op|'{'
string|"'name'"
op|':'
string|"'d'"
op|'}'
op|']'
newline|'\n'
name|'body3'
op|'='
op|'['
op|']'
newline|'\n'
nl|'\n'
name|'mocked_func'
op|'='
string|"'swift.common.internal_client.urllib2.urlopen'"
newline|'\n'
name|'with'
name|'mock'
op|'.'
name|'patch'
op|'('
name|'mocked_func'
op|')'
name|'as'
name|'mock_urlopen'
op|':'
newline|'\n'
indent|'            '
name|'mock_urlopen'
op|'.'
name|'side_effect'
op|'='
op|'['
nl|'\n'
name|'FakeConn'
op|'('
name|'body1'
op|')'
op|','
name|'FakeConn'
op|'('
name|'body2'
op|')'
op|','
name|'FakeConn'
op|'('
name|'body3'
op|')'
op|']'
newline|'\n'
name|'sc'
op|'='
name|'internal_client'
op|'.'
name|'SimpleClient'
op|'('
string|"'http://0.0.0.0/'"
op|')'
newline|'\n'
name|'_'
op|','
name|'resp_body'
op|'='
name|'sc'
op|'.'
name|'base_request'
op|'('
string|"'GET'"
op|','
name|'full_listing'
op|'='
name|'True'
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'body1'
op|'+'
name|'body2'
op|','
name|'resp_body'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'3'
op|','
name|'mock_urlopen'
op|'.'
name|'call_count'
op|')'
newline|'\n'
name|'actual_requests'
op|'='
name|'map'
op|'('
nl|'\n'
name|'lambda'
name|'call'
op|':'
name|'call'
op|'['
number|'0'
op|']'
op|'['
number|'0'
op|']'
op|','
name|'mock_urlopen'
op|'.'
name|'call_args_list'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'/?format=json'"
op|','
name|'actual_requests'
op|'['
number|'0'
op|']'
op|'.'
name|'get_selector'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
nl|'\n'
string|"'/?format=json&marker=c'"
op|','
name|'actual_requests'
op|'['
number|'1'
op|']'
op|'.'
name|'get_selector'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
nl|'\n'
string|"'/?format=json&marker=d'"
op|','
name|'actual_requests'
op|'['
number|'2'
op|']'
op|'.'
name|'get_selector'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_make_request_method_path_headers
dedent|''
name|'def'
name|'test_make_request_method_path_headers'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
DECL|class|InternalClient
indent|'        '
name|'class'
name|'InternalClient'
op|'('
name|'internal_client'
op|'.'
name|'InternalClient'
op|')'
op|':'
newline|'\n'
DECL|member|__init__
indent|'            '
name|'def'
name|'__init__'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'app'
op|'='
name|'self'
op|'.'
name|'fake_app'
newline|'\n'
name|'self'
op|'.'
name|'user_agent'
op|'='
string|"'some_agent'"
newline|'\n'
name|'self'
op|'.'
name|'request_tries'
op|'='
number|'3'
newline|'\n'
name|'self'
op|'.'
name|'env'
op|'='
name|'None'
newline|'\n'
nl|'\n'
DECL|member|fake_app
dedent|''
name|'def'
name|'fake_app'
op|'('
name|'self'
op|','
name|'env'
op|','
name|'start_response'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'env'
op|'='
name|'env'
newline|'\n'
name|'start_response'
op|'('
string|"'200 Ok'"
op|','
op|'['
op|'('
string|"'Content-Length'"
op|','
string|"'0'"
op|')'
op|']'
op|')'
newline|'\n'
name|'return'
op|'['
op|']'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'client'
op|'='
name|'InternalClient'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'for'
name|'method'
name|'in'
string|"'GET PUT HEAD'"
op|'.'
name|'split'
op|'('
op|')'
op|':'
newline|'\n'
indent|'            '
name|'client'
op|'.'
name|'make_request'
op|'('
name|'method'
op|','
string|"'/'"
op|','
op|'{'
op|'}'
op|','
op|'('
number|'200'
op|','
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'client'
op|'.'
name|'env'
op|'['
string|"'REQUEST_METHOD'"
op|']'
op|','
name|'method'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'for'
name|'path'
name|'in'
string|"'/one /two/three'"
op|'.'
name|'split'
op|'('
op|')'
op|':'
newline|'\n'
indent|'            '
name|'client'
op|'.'
name|'make_request'
op|'('
string|"'GET'"
op|','
name|'path'
op|','
op|'{'
string|"'X-Test'"
op|':'
name|'path'
op|'}'
op|','
op|'('
number|'200'
op|','
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'client'
op|'.'
name|'env'
op|'['
string|"'PATH_INFO'"
op|']'
op|','
name|'path'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'client'
op|'.'
name|'env'
op|'['
string|"'HTTP_X_TEST'"
op|']'
op|','
name|'path'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_make_request_codes
dedent|''
dedent|''
name|'def'
name|'test_make_request_codes'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
DECL|class|InternalClient
indent|'        '
name|'class'
name|'InternalClient'
op|'('
name|'internal_client'
op|'.'
name|'InternalClient'
op|')'
op|':'
newline|'\n'
DECL|member|__init__
indent|'            '
name|'def'
name|'__init__'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'app'
op|'='
name|'self'
op|'.'
name|'fake_app'
newline|'\n'
name|'self'
op|'.'
name|'user_agent'
op|'='
string|"'some_agent'"
newline|'\n'
name|'self'
op|'.'
name|'request_tries'
op|'='
number|'3'
newline|'\n'
nl|'\n'
DECL|member|fake_app
dedent|''
name|'def'
name|'fake_app'
op|'('
name|'self'
op|','
name|'env'
op|','
name|'start_response'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'start_response'
op|'('
string|"'200 Ok'"
op|','
op|'['
op|'('
string|"'Content-Length'"
op|','
string|"'0'"
op|')'
op|']'
op|')'
newline|'\n'
name|'return'
op|'['
op|']'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'client'
op|'='
name|'InternalClient'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'try'
op|':'
newline|'\n'
DECL|variable|old_sleep
indent|'            '
name|'old_sleep'
op|'='
name|'internal_client'
op|'.'
name|'sleep'
newline|'\n'
name|'internal_client'
op|'.'
name|'sleep'
op|'='
name|'not_sleep'
newline|'\n'
nl|'\n'
name|'client'
op|'.'
name|'make_request'
op|'('
string|"'GET'"
op|','
string|"'/'"
op|','
op|'{'
op|'}'
op|','
op|'('
number|'200'
op|','
op|')'
op|')'
newline|'\n'
name|'client'
op|'.'
name|'make_request'
op|'('
string|"'GET'"
op|','
string|"'/'"
op|','
op|'{'
op|'}'
op|','
op|'('
number|'2'
op|','
op|')'
op|')'
newline|'\n'
name|'client'
op|'.'
name|'make_request'
op|'('
string|"'GET'"
op|','
string|"'/'"
op|','
op|'{'
op|'}'
op|','
op|'('
number|'400'
op|','
number|'200'
op|')'
op|')'
newline|'\n'
name|'client'
op|'.'
name|'make_request'
op|'('
string|"'GET'"
op|','
string|"'/'"
op|','
op|'{'
op|'}'
op|','
op|'('
number|'400'
op|','
number|'2'
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'try'
op|':'
newline|'\n'
indent|'                '
name|'client'
op|'.'
name|'make_request'
op|'('
string|"'GET'"
op|','
string|"'/'"
op|','
op|'{'
op|'}'
op|','
op|'('
number|'400'
op|','
op|')'
op|')'
newline|'\n'
dedent|''
name|'except'
name|'Exception'
name|'as'
name|'err'
op|':'
newline|'\n'
indent|'                '
name|'pass'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'200'
op|','
name|'err'
op|'.'
name|'resp'
op|'.'
name|'status_int'
op|')'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'                '
name|'client'
op|'.'
name|'make_request'
op|'('
string|"'GET'"
op|','
string|"'/'"
op|','
op|'{'
op|'}'
op|','
op|'('
number|'201'
op|','
op|')'
op|')'
newline|'\n'
dedent|''
name|'except'
name|'Exception'
name|'as'
name|'err'
op|':'
newline|'\n'
indent|'                '
name|'pass'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'200'
op|','
name|'err'
op|'.'
name|'resp'
op|'.'
name|'status_int'
op|')'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'                '
name|'client'
op|'.'
name|'make_request'
op|'('
string|"'GET'"
op|','
string|"'/'"
op|','
op|'{'
op|'}'
op|','
op|'('
number|'111'
op|','
op|')'
op|')'
newline|'\n'
dedent|''
name|'except'
name|'Exception'
name|'as'
name|'err'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'str'
op|'('
name|'err'
op|')'
op|'.'
name|'startswith'
op|'('
string|"'Unexpected response'"
op|')'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'fail'
op|'('
string|'"Expected the UnexpectedResponse"'
op|')'
newline|'\n'
dedent|''
dedent|''
name|'finally'
op|':'
newline|'\n'
indent|'            '
name|'internal_client'
op|'.'
name|'sleep'
op|'='
name|'old_sleep'
newline|'\n'
nl|'\n'
DECL|member|test_make_request_calls_fobj_seek_each_try
dedent|''
dedent|''
name|'def'
name|'test_make_request_calls_fobj_seek_each_try'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
DECL|class|FileObject
indent|'        '
name|'class'
name|'FileObject'
op|'('
name|'object'
op|')'
op|':'
newline|'\n'
DECL|member|__init__
indent|'            '
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'test'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'test'
op|'='
name|'test'
newline|'\n'
name|'self'
op|'.'
name|'seek_called'
op|'='
number|'0'
newline|'\n'
nl|'\n'
DECL|member|seek
dedent|''
name|'def'
name|'seek'
op|'('
name|'self'
op|','
name|'offset'
op|','
name|'whence'
op|'='
number|'0'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'seek_called'
op|'+='
number|'1'
newline|'\n'
name|'self'
op|'.'
name|'test'
op|'.'
name|'assertEqual'
op|'('
number|'0'
op|','
name|'offset'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'test'
op|'.'
name|'assertEqual'
op|'('
number|'0'
op|','
name|'whence'
op|')'
newline|'\n'
nl|'\n'
DECL|class|InternalClient
dedent|''
dedent|''
name|'class'
name|'InternalClient'
op|'('
name|'internal_client'
op|'.'
name|'InternalClient'
op|')'
op|':'
newline|'\n'
DECL|member|__init__
indent|'            '
name|'def'
name|'__init__'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'app'
op|'='
name|'self'
op|'.'
name|'fake_app'
newline|'\n'
name|'self'
op|'.'
name|'user_agent'
op|'='
string|"'some_agent'"
newline|'\n'
name|'self'
op|'.'
name|'request_tries'
op|'='
number|'3'
newline|'\n'
nl|'\n'
DECL|member|fake_app
dedent|''
name|'def'
name|'fake_app'
op|'('
name|'self'
op|','
name|'env'
op|','
name|'start_response'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'start_response'
op|'('
string|"'404 Not Found'"
op|','
op|'['
op|'('
string|"'Content-Length'"
op|','
string|"'0'"
op|')'
op|']'
op|')'
newline|'\n'
name|'return'
op|'['
op|']'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'fobj'
op|'='
name|'FileObject'
op|'('
name|'self'
op|')'
newline|'\n'
name|'client'
op|'='
name|'InternalClient'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'try'
op|':'
newline|'\n'
DECL|variable|old_sleep
indent|'            '
name|'old_sleep'
op|'='
name|'internal_client'
op|'.'
name|'sleep'
newline|'\n'
name|'internal_client'
op|'.'
name|'sleep'
op|'='
name|'not_sleep'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'                '
name|'client'
op|'.'
name|'make_request'
op|'('
string|"'PUT'"
op|','
string|"'/'"
op|','
op|'{'
op|'}'
op|','
op|'('
number|'2'
op|','
op|')'
op|','
name|'fobj'
op|')'
newline|'\n'
dedent|''
name|'except'
name|'Exception'
name|'as'
name|'err'
op|':'
newline|'\n'
indent|'                '
name|'pass'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'404'
op|','
name|'err'
op|'.'
name|'resp'
op|'.'
name|'status_int'
op|')'
newline|'\n'
dedent|''
name|'finally'
op|':'
newline|'\n'
indent|'            '
name|'internal_client'
op|'.'
name|'sleep'
op|'='
name|'old_sleep'
newline|'\n'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'client'
op|'.'
name|'request_tries'
op|','
name|'fobj'
op|'.'
name|'seek_called'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_make_request_request_exception
dedent|''
name|'def'
name|'test_make_request_request_exception'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
DECL|class|InternalClient
indent|'        '
name|'class'
name|'InternalClient'
op|'('
name|'internal_client'
op|'.'
name|'InternalClient'
op|')'
op|':'
newline|'\n'
DECL|member|__init__
indent|'            '
name|'def'
name|'__init__'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'app'
op|'='
name|'self'
op|'.'
name|'fake_app'
newline|'\n'
name|'self'
op|'.'
name|'user_agent'
op|'='
string|"'some_agent'"
newline|'\n'
name|'self'
op|'.'
name|'request_tries'
op|'='
number|'3'
newline|'\n'
nl|'\n'
DECL|member|fake_app
dedent|''
name|'def'
name|'fake_app'
op|'('
name|'self'
op|','
name|'env'
op|','
name|'start_response'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'raise'
name|'Exception'
op|'('
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'client'
op|'='
name|'InternalClient'
op|'('
op|')'
newline|'\n'
name|'try'
op|':'
newline|'\n'
DECL|variable|old_sleep
indent|'            '
name|'old_sleep'
op|'='
name|'internal_client'
op|'.'
name|'sleep'
newline|'\n'
name|'internal_client'
op|'.'
name|'sleep'
op|'='
name|'not_sleep'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
nl|'\n'
name|'Exception'
op|','
name|'client'
op|'.'
name|'make_request'
op|','
string|"'GET'"
op|','
string|"'/'"
op|','
op|'{'
op|'}'
op|','
op|'('
number|'2'
op|','
op|')'
op|')'
newline|'\n'
dedent|''
name|'finally'
op|':'
newline|'\n'
indent|'            '
name|'internal_client'
op|'.'
name|'sleep'
op|'='
name|'old_sleep'
newline|'\n'
nl|'\n'
DECL|member|test_get_metadata
dedent|''
dedent|''
name|'def'
name|'test_get_metadata'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
DECL|class|Response
indent|'        '
name|'class'
name|'Response'
op|'('
name|'object'
op|')'
op|':'
newline|'\n'
DECL|member|__init__
indent|'            '
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'headers'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'headers'
op|'='
name|'headers'
newline|'\n'
name|'self'
op|'.'
name|'status_int'
op|'='
number|'200'
newline|'\n'
nl|'\n'
DECL|class|InternalClient
dedent|''
dedent|''
name|'class'
name|'InternalClient'
op|'('
name|'internal_client'
op|'.'
name|'InternalClient'
op|')'
op|':'
newline|'\n'
DECL|member|__init__
indent|'            '
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'test'
op|','
name|'path'
op|','
name|'resp_headers'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'test'
op|'='
name|'test'
newline|'\n'
name|'self'
op|'.'
name|'path'
op|'='
name|'path'
newline|'\n'
name|'self'
op|'.'
name|'resp_headers'
op|'='
name|'resp_headers'
newline|'\n'
name|'self'
op|'.'
name|'make_request_called'
op|'='
number|'0'
newline|'\n'
nl|'\n'
DECL|member|make_request
dedent|''
name|'def'
name|'make_request'
op|'('
nl|'\n'
name|'self'
op|','
name|'method'
op|','
name|'path'
op|','
name|'headers'
op|','
name|'acceptable_statuses'
op|','
nl|'\n'
name|'body_file'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'make_request_called'
op|'+='
number|'1'
newline|'\n'
name|'self'
op|'.'
name|'test'
op|'.'
name|'assertEqual'
op|'('
string|"'HEAD'"
op|','
name|'method'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'test'
op|'.'
name|'assertEqual'
op|'('
name|'self'
op|'.'
name|'path'
op|','
name|'path'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'test'
op|'.'
name|'assertEqual'
op|'('
op|'('
number|'2'
op|','
op|')'
op|','
name|'acceptable_statuses'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'test'
op|'.'
name|'assertIsNone'
op|'('
name|'body_file'
op|')'
newline|'\n'
name|'return'
name|'Response'
op|'('
name|'self'
op|'.'
name|'resp_headers'
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'path'
op|'='
string|"'some_path'"
newline|'\n'
name|'metadata_prefix'
op|'='
string|"'some_key-'"
newline|'\n'
name|'resp_headers'
op|'='
op|'{'
nl|'\n'
string|"'%sone'"
op|'%'
op|'('
name|'metadata_prefix'
op|')'
op|':'
string|"'1'"
op|','
nl|'\n'
string|"'%sTwo'"
op|'%'
op|'('
name|'metadata_prefix'
op|')'
op|':'
string|"'2'"
op|','
nl|'\n'
string|"'%sThree'"
op|'%'
op|'('
name|'metadata_prefix'
op|')'
op|':'
string|"'3'"
op|','
nl|'\n'
string|"'some_header-four'"
op|':'
string|"'4'"
op|','
nl|'\n'
string|"'Some_header-five'"
op|':'
string|"'5'"
op|','
nl|'\n'
op|'}'
newline|'\n'
name|'exp_metadata'
op|'='
op|'{'
nl|'\n'
string|"'one'"
op|':'
string|"'1'"
op|','
nl|'\n'
string|"'two'"
op|':'
string|"'2'"
op|','
nl|'\n'
string|"'three'"
op|':'
string|"'3'"
op|','
nl|'\n'
op|'}'
newline|'\n'
nl|'\n'
name|'client'
op|'='
name|'InternalClient'
op|'('
name|'self'
op|','
name|'path'
op|','
name|'resp_headers'
op|')'
newline|'\n'
name|'metadata'
op|'='
name|'client'
op|'.'
name|'_get_metadata'
op|'('
name|'path'
op|','
name|'metadata_prefix'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'exp_metadata'
op|','
name|'metadata'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'1'
op|','
name|'client'
op|'.'
name|'make_request_called'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_metadata_invalid_status
dedent|''
name|'def'
name|'test_get_metadata_invalid_status'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
DECL|class|FakeApp
indent|'        '
name|'class'
name|'FakeApp'
op|'('
name|'object'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|member|__call__
indent|'            '
name|'def'
name|'__call__'
op|'('
name|'self'
op|','
name|'environ'
op|','
name|'start_response'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'start_response'
op|'('
string|"'404 Not Found'"
op|','
op|'['
op|'('
string|"'x-foo'"
op|','
string|"'bar'"
op|')'
op|']'
op|')'
newline|'\n'
name|'return'
op|'['
string|"'nope'"
op|']'
newline|'\n'
nl|'\n'
DECL|class|InternalClient
dedent|''
dedent|''
name|'class'
name|'InternalClient'
op|'('
name|'internal_client'
op|'.'
name|'InternalClient'
op|')'
op|':'
newline|'\n'
DECL|member|__init__
indent|'            '
name|'def'
name|'__init__'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'user_agent'
op|'='
string|"'test'"
newline|'\n'
name|'self'
op|'.'
name|'request_tries'
op|'='
number|'1'
newline|'\n'
name|'self'
op|'.'
name|'app'
op|'='
name|'FakeApp'
op|'('
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'client'
op|'='
name|'InternalClient'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'internal_client'
op|'.'
name|'UnexpectedResponse'
op|','
nl|'\n'
name|'client'
op|'.'
name|'_get_metadata'
op|','
string|"'path'"
op|')'
newline|'\n'
name|'metadata'
op|'='
name|'client'
op|'.'
name|'_get_metadata'
op|'('
string|"'path'"
op|','
name|'metadata_prefix'
op|'='
string|"'x-'"
op|','
nl|'\n'
name|'acceptable_statuses'
op|'='
op|'('
number|'4'
op|','
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'metadata'
op|','
op|'{'
string|"'foo'"
op|':'
string|"'bar'"
op|'}'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_make_path
dedent|''
name|'def'
name|'test_make_path'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'account'
op|','
name|'container'
op|','
name|'obj'
op|'='
name|'path_parts'
op|'('
op|')'
newline|'\n'
name|'path'
op|'='
name|'make_path'
op|'('
name|'account'
op|','
name|'container'
op|','
name|'obj'
op|')'
newline|'\n'
nl|'\n'
name|'c'
op|'='
name|'InternalClient'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'path'
op|','
name|'c'
op|'.'
name|'make_path'
op|'('
name|'account'
op|','
name|'container'
op|','
name|'obj'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_make_path_exception
dedent|''
name|'def'
name|'test_make_path_exception'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'c'
op|'='
name|'InternalClient'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ValueError'
op|','
name|'c'
op|'.'
name|'make_path'
op|','
string|"'account'"
op|','
name|'None'
op|','
string|"'obj'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_iter_items
dedent|''
name|'def'
name|'test_iter_items'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
DECL|class|Response
indent|'        '
name|'class'
name|'Response'
op|'('
name|'object'
op|')'
op|':'
newline|'\n'
DECL|member|__init__
indent|'            '
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'status_int'
op|','
name|'body'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'status_int'
op|'='
name|'status_int'
newline|'\n'
name|'self'
op|'.'
name|'body'
op|'='
name|'body'
newline|'\n'
nl|'\n'
DECL|class|InternalClient
dedent|''
dedent|''
name|'class'
name|'InternalClient'
op|'('
name|'internal_client'
op|'.'
name|'InternalClient'
op|')'
op|':'
newline|'\n'
DECL|member|__init__
indent|'            '
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'test'
op|','
name|'responses'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'test'
op|'='
name|'test'
newline|'\n'
name|'self'
op|'.'
name|'responses'
op|'='
name|'responses'
newline|'\n'
name|'self'
op|'.'
name|'make_request_called'
op|'='
number|'0'
newline|'\n'
nl|'\n'
DECL|member|make_request
dedent|''
name|'def'
name|'make_request'
op|'('
nl|'\n'
name|'self'
op|','
name|'method'
op|','
name|'path'
op|','
name|'headers'
op|','
name|'acceptable_statuses'
op|','
nl|'\n'
name|'body_file'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'make_request_called'
op|'+='
number|'1'
newline|'\n'
name|'return'
name|'self'
op|'.'
name|'responses'
op|'.'
name|'pop'
op|'('
number|'0'
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'exp_items'
op|'='
op|'['
op|']'
newline|'\n'
name|'responses'
op|'='
op|'['
name|'Response'
op|'('
number|'200'
op|','
name|'json'
op|'.'
name|'dumps'
op|'('
op|'['
op|']'
op|')'
op|')'
op|','
op|']'
newline|'\n'
name|'items'
op|'='
op|'['
op|']'
newline|'\n'
name|'client'
op|'='
name|'InternalClient'
op|'('
name|'self'
op|','
name|'responses'
op|')'
newline|'\n'
name|'for'
name|'item'
name|'in'
name|'client'
op|'.'
name|'_iter_items'
op|'('
string|"'/'"
op|')'
op|':'
newline|'\n'
indent|'            '
name|'items'
op|'.'
name|'append'
op|'('
name|'item'
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'exp_items'
op|','
name|'items'
op|')'
newline|'\n'
nl|'\n'
name|'exp_items'
op|'='
op|'['
op|']'
newline|'\n'
name|'responses'
op|'='
op|'['
op|']'
newline|'\n'
name|'for'
name|'i'
name|'in'
name|'range'
op|'('
number|'3'
op|')'
op|':'
newline|'\n'
DECL|variable|data
indent|'            '
name|'data'
op|'='
op|'['
nl|'\n'
op|'{'
string|"'name'"
op|':'
string|"'item%02d'"
op|'%'
op|'('
number|'2'
op|'*'
name|'i'
op|')'
op|'}'
op|','
nl|'\n'
op|'{'
string|"'name'"
op|':'
string|"'item%02d'"
op|'%'
op|'('
number|'2'
op|'*'
name|'i'
op|'+'
number|'1'
op|')'
op|'}'
op|']'
newline|'\n'
name|'responses'
op|'.'
name|'append'
op|'('
name|'Response'
op|'('
number|'200'
op|','
name|'json'
op|'.'
name|'dumps'
op|'('
name|'data'
op|')'
op|')'
op|')'
newline|'\n'
name|'exp_items'
op|'.'
name|'extend'
op|'('
name|'data'
op|')'
newline|'\n'
dedent|''
name|'responses'
op|'.'
name|'append'
op|'('
name|'Response'
op|'('
number|'204'
op|','
string|"''"
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'items'
op|'='
op|'['
op|']'
newline|'\n'
name|'client'
op|'='
name|'InternalClient'
op|'('
name|'self'
op|','
name|'responses'
op|')'
newline|'\n'
name|'for'
name|'item'
name|'in'
name|'client'
op|'.'
name|'_iter_items'
op|'('
string|"'/'"
op|')'
op|':'
newline|'\n'
indent|'            '
name|'items'
op|'.'
name|'append'
op|'('
name|'item'
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'exp_items'
op|','
name|'items'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_iter_items_with_markers
dedent|''
name|'def'
name|'test_iter_items_with_markers'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
DECL|class|Response
indent|'        '
name|'class'
name|'Response'
op|'('
name|'object'
op|')'
op|':'
newline|'\n'
DECL|member|__init__
indent|'            '
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'status_int'
op|','
name|'body'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'status_int'
op|'='
name|'status_int'
newline|'\n'
name|'self'
op|'.'
name|'body'
op|'='
name|'body'
newline|'\n'
nl|'\n'
DECL|class|InternalClient
dedent|''
dedent|''
name|'class'
name|'InternalClient'
op|'('
name|'internal_client'
op|'.'
name|'InternalClient'
op|')'
op|':'
newline|'\n'
DECL|member|__init__
indent|'            '
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'test'
op|','
name|'paths'
op|','
name|'responses'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'test'
op|'='
name|'test'
newline|'\n'
name|'self'
op|'.'
name|'paths'
op|'='
name|'paths'
newline|'\n'
name|'self'
op|'.'
name|'responses'
op|'='
name|'responses'
newline|'\n'
nl|'\n'
DECL|member|make_request
dedent|''
name|'def'
name|'make_request'
op|'('
nl|'\n'
name|'self'
op|','
name|'method'
op|','
name|'path'
op|','
name|'headers'
op|','
name|'acceptable_statuses'
op|','
nl|'\n'
name|'body_file'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'exp_path'
op|'='
name|'self'
op|'.'
name|'paths'
op|'.'
name|'pop'
op|'('
number|'0'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'test'
op|'.'
name|'assertEqual'
op|'('
name|'exp_path'
op|','
name|'path'
op|')'
newline|'\n'
name|'return'
name|'self'
op|'.'
name|'responses'
op|'.'
name|'pop'
op|'('
number|'0'
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'paths'
op|'='
op|'['
nl|'\n'
string|"'/?format=json&marker=start&end_marker=end'"
op|','
nl|'\n'
string|"'/?format=json&marker=one%C3%A9&end_marker=end'"
op|','
nl|'\n'
string|"'/?format=json&marker=two&end_marker=end'"
op|','
nl|'\n'
op|']'
newline|'\n'
nl|'\n'
name|'responses'
op|'='
op|'['
nl|'\n'
name|'Response'
op|'('
number|'200'
op|','
name|'json'
op|'.'
name|'dumps'
op|'('
op|'['
op|'{'
string|"'name'"
op|':'
string|"'one\\xc3\\xa9'"
op|'}'
op|','
op|']'
op|')'
op|')'
op|','
nl|'\n'
name|'Response'
op|'('
number|'200'
op|','
name|'json'
op|'.'
name|'dumps'
op|'('
op|'['
op|'{'
string|"'name'"
op|':'
string|"'two'"
op|'}'
op|','
op|']'
op|')'
op|')'
op|','
nl|'\n'
name|'Response'
op|'('
number|'204'
op|','
string|"''"
op|')'
op|','
nl|'\n'
op|']'
newline|'\n'
nl|'\n'
name|'items'
op|'='
op|'['
op|']'
newline|'\n'
name|'client'
op|'='
name|'InternalClient'
op|'('
name|'self'
op|','
name|'paths'
op|','
name|'responses'
op|')'
newline|'\n'
name|'for'
name|'item'
name|'in'
name|'client'
op|'.'
name|'_iter_items'
op|'('
string|"'/'"
op|','
name|'marker'
op|'='
string|"'start'"
op|','
name|'end_marker'
op|'='
string|"'end'"
op|')'
op|':'
newline|'\n'
indent|'            '
name|'items'
op|'.'
name|'append'
op|'('
name|'item'
op|'['
string|"'name'"
op|']'
op|'.'
name|'encode'
op|'('
string|"'utf8'"
op|')'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'one\\xc3\\xa9 two'"
op|'.'
name|'split'
op|'('
op|')'
op|','
name|'items'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_iter_item_read_response_if_status_is_acceptable
dedent|''
name|'def'
name|'test_iter_item_read_response_if_status_is_acceptable'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
DECL|class|Response
indent|'        '
name|'class'
name|'Response'
op|'('
name|'object'
op|')'
op|':'
newline|'\n'
DECL|member|__init__
indent|'            '
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'status_int'
op|','
name|'body'
op|','
name|'app_iter'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'status_int'
op|'='
name|'status_int'
newline|'\n'
name|'self'
op|'.'
name|'body'
op|'='
name|'body'
newline|'\n'
name|'self'
op|'.'
name|'app_iter'
op|'='
name|'app_iter'
newline|'\n'
nl|'\n'
DECL|class|InternalClient
dedent|''
dedent|''
name|'class'
name|'InternalClient'
op|'('
name|'internal_client'
op|'.'
name|'InternalClient'
op|')'
op|':'
newline|'\n'
DECL|member|__init__
indent|'            '
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'test'
op|','
name|'responses'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'test'
op|'='
name|'test'
newline|'\n'
name|'self'
op|'.'
name|'responses'
op|'='
name|'responses'
newline|'\n'
nl|'\n'
DECL|member|make_request
dedent|''
name|'def'
name|'make_request'
op|'('
nl|'\n'
name|'self'
op|','
name|'method'
op|','
name|'path'
op|','
name|'headers'
op|','
name|'acceptable_statuses'
op|','
nl|'\n'
name|'body_file'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'resp'
op|'='
name|'self'
op|'.'
name|'responses'
op|'.'
name|'pop'
op|'('
number|'0'
op|')'
newline|'\n'
name|'if'
name|'resp'
op|'.'
name|'status_int'
name|'in'
name|'acceptable_statuses'
name|'or'
name|'resp'
op|'.'
name|'status_int'
op|'//'
number|'100'
name|'in'
name|'acceptable_statuses'
op|':'
newline|'\n'
indent|'                    '
name|'return'
name|'resp'
newline|'\n'
dedent|''
name|'if'
name|'resp'
op|':'
newline|'\n'
indent|'                    '
name|'raise'
name|'internal_client'
op|'.'
name|'UnexpectedResponse'
op|'('
nl|'\n'
string|"'Unexpected response: %s'"
op|'%'
name|'resp'
op|'.'
name|'status_int'
op|','
name|'resp'
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
dedent|''
name|'num_list'
op|'='
op|'['
op|']'
newline|'\n'
nl|'\n'
DECL|function|generate_resp_body
name|'def'
name|'generate_resp_body'
op|'('
op|')'
op|':'
newline|'\n'
indent|'            '
name|'for'
name|'i'
name|'in'
name|'range'
op|'('
number|'1'
op|','
number|'5'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'yield'
name|'str'
op|'('
name|'i'
op|')'
newline|'\n'
name|'num_list'
op|'.'
name|'append'
op|'('
name|'i'
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'exp_items'
op|'='
op|'['
op|']'
newline|'\n'
name|'responses'
op|'='
op|'['
name|'Response'
op|'('
number|'204'
op|','
name|'json'
op|'.'
name|'dumps'
op|'('
op|'['
op|']'
op|')'
op|','
name|'generate_resp_body'
op|'('
op|')'
op|')'
op|']'
newline|'\n'
name|'items'
op|'='
op|'['
op|']'
newline|'\n'
name|'client'
op|'='
name|'InternalClient'
op|'('
name|'self'
op|','
name|'responses'
op|')'
newline|'\n'
name|'for'
name|'item'
name|'in'
name|'client'
op|'.'
name|'_iter_items'
op|'('
string|"'/'"
op|')'
op|':'
newline|'\n'
indent|'            '
name|'items'
op|'.'
name|'append'
op|'('
name|'item'
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'exp_items'
op|','
name|'items'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'len'
op|'('
name|'num_list'
op|')'
op|','
number|'0'
op|')'
newline|'\n'
nl|'\n'
name|'responses'
op|'='
op|'['
name|'Response'
op|'('
number|'300'
op|','
name|'json'
op|'.'
name|'dumps'
op|'('
op|'['
op|']'
op|')'
op|','
name|'generate_resp_body'
op|'('
op|')'
op|')'
op|']'
newline|'\n'
name|'client'
op|'='
name|'InternalClient'
op|'('
name|'self'
op|','
name|'responses'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'internal_client'
op|'.'
name|'UnexpectedResponse'
op|','
nl|'\n'
name|'next'
op|','
name|'client'
op|'.'
name|'_iter_items'
op|'('
string|"'/'"
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'exp_items'
op|'='
op|'['
op|']'
newline|'\n'
name|'responses'
op|'='
op|'['
name|'Response'
op|'('
number|'404'
op|','
name|'json'
op|'.'
name|'dumps'
op|'('
op|'['
op|']'
op|')'
op|','
name|'generate_resp_body'
op|'('
op|')'
op|')'
op|']'
newline|'\n'
name|'items'
op|'='
op|'['
op|']'
newline|'\n'
name|'client'
op|'='
name|'InternalClient'
op|'('
name|'self'
op|','
name|'responses'
op|')'
newline|'\n'
name|'for'
name|'item'
name|'in'
name|'client'
op|'.'
name|'_iter_items'
op|'('
string|"'/'"
op|')'
op|':'
newline|'\n'
indent|'            '
name|'items'
op|'.'
name|'append'
op|'('
name|'item'
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'exp_items'
op|','
name|'items'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'len'
op|'('
name|'num_list'
op|')'
op|','
number|'4'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_set_metadata
dedent|''
name|'def'
name|'test_set_metadata'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
DECL|class|InternalClient
indent|'        '
name|'class'
name|'InternalClient'
op|'('
name|'internal_client'
op|'.'
name|'InternalClient'
op|')'
op|':'
newline|'\n'
DECL|member|__init__
indent|'            '
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'test'
op|','
name|'path'
op|','
name|'exp_headers'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'test'
op|'='
name|'test'
newline|'\n'
name|'self'
op|'.'
name|'path'
op|'='
name|'path'
newline|'\n'
name|'self'
op|'.'
name|'exp_headers'
op|'='
name|'exp_headers'
newline|'\n'
name|'self'
op|'.'
name|'make_request_called'
op|'='
number|'0'
newline|'\n'
nl|'\n'
DECL|member|make_request
dedent|''
name|'def'
name|'make_request'
op|'('
nl|'\n'
name|'self'
op|','
name|'method'
op|','
name|'path'
op|','
name|'headers'
op|','
name|'acceptable_statuses'
op|','
nl|'\n'
name|'body_file'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'make_request_called'
op|'+='
number|'1'
newline|'\n'
name|'self'
op|'.'
name|'test'
op|'.'
name|'assertEqual'
op|'('
string|"'POST'"
op|','
name|'method'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'test'
op|'.'
name|'assertEqual'
op|'('
name|'self'
op|'.'
name|'path'
op|','
name|'path'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'test'
op|'.'
name|'assertEqual'
op|'('
name|'self'
op|'.'
name|'exp_headers'
op|','
name|'headers'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'test'
op|'.'
name|'assertEqual'
op|'('
op|'('
number|'2'
op|','
op|')'
op|','
name|'acceptable_statuses'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'test'
op|'.'
name|'assertIsNone'
op|'('
name|'body_file'
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'path'
op|'='
string|"'some_path'"
newline|'\n'
name|'metadata_prefix'
op|'='
string|"'some_key-'"
newline|'\n'
name|'metadata'
op|'='
op|'{'
nl|'\n'
string|"'%sone'"
op|'%'
op|'('
name|'metadata_prefix'
op|')'
op|':'
string|"'1'"
op|','
nl|'\n'
string|"'%stwo'"
op|'%'
op|'('
name|'metadata_prefix'
op|')'
op|':'
string|"'2'"
op|','
nl|'\n'
string|"'three'"
op|':'
string|"'3'"
op|','
nl|'\n'
op|'}'
newline|'\n'
name|'exp_headers'
op|'='
op|'{'
nl|'\n'
string|"'%sone'"
op|'%'
op|'('
name|'metadata_prefix'
op|')'
op|':'
string|"'1'"
op|','
nl|'\n'
string|"'%stwo'"
op|'%'
op|'('
name|'metadata_prefix'
op|')'
op|':'
string|"'2'"
op|','
nl|'\n'
string|"'%sthree'"
op|'%'
op|'('
name|'metadata_prefix'
op|')'
op|':'
string|"'3'"
op|','
nl|'\n'
op|'}'
newline|'\n'
nl|'\n'
name|'client'
op|'='
name|'InternalClient'
op|'('
name|'self'
op|','
name|'path'
op|','
name|'exp_headers'
op|')'
newline|'\n'
name|'client'
op|'.'
name|'_set_metadata'
op|'('
name|'path'
op|','
name|'metadata'
op|','
name|'metadata_prefix'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'1'
op|','
name|'client'
op|'.'
name|'make_request_called'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_iter_containers
dedent|''
name|'def'
name|'test_iter_containers'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'account'
op|','
name|'container'
op|','
name|'obj'
op|'='
name|'path_parts'
op|'('
op|')'
newline|'\n'
name|'path'
op|'='
name|'make_path'
op|'('
name|'account'
op|')'
newline|'\n'
name|'items'
op|'='
string|"'0 1 2'"
op|'.'
name|'split'
op|'('
op|')'
newline|'\n'
name|'marker'
op|'='
string|"'some_marker'"
newline|'\n'
name|'end_marker'
op|'='
string|"'some_end_marker'"
newline|'\n'
name|'acceptable_statuses'
op|'='
string|"'some_status_list'"
newline|'\n'
name|'client'
op|'='
name|'IterInternalClient'
op|'('
nl|'\n'
name|'self'
op|','
name|'path'
op|','
name|'marker'
op|','
name|'end_marker'
op|','
name|'acceptable_statuses'
op|','
name|'items'
op|')'
newline|'\n'
name|'ret_items'
op|'='
op|'['
op|']'
newline|'\n'
name|'for'
name|'container'
name|'in'
name|'client'
op|'.'
name|'iter_containers'
op|'('
nl|'\n'
name|'account'
op|','
name|'marker'
op|','
name|'end_marker'
op|','
nl|'\n'
name|'acceptable_statuses'
op|'='
name|'acceptable_statuses'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'ret_items'
op|'.'
name|'append'
op|'('
name|'container'
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'items'
op|','
name|'ret_items'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_account_info
dedent|''
name|'def'
name|'test_get_account_info'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
DECL|class|Response
indent|'        '
name|'class'
name|'Response'
op|'('
name|'object'
op|')'
op|':'
newline|'\n'
DECL|member|__init__
indent|'            '
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'containers'
op|','
name|'objects'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'headers'
op|'='
op|'{'
nl|'\n'
string|"'x-account-container-count'"
op|':'
name|'containers'
op|','
nl|'\n'
string|"'x-account-object-count'"
op|':'
name|'objects'
op|','
nl|'\n'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'status_int'
op|'='
number|'200'
newline|'\n'
nl|'\n'
DECL|class|InternalClient
dedent|''
dedent|''
name|'class'
name|'InternalClient'
op|'('
name|'internal_client'
op|'.'
name|'InternalClient'
op|')'
op|':'
newline|'\n'
DECL|member|__init__
indent|'            '
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'test'
op|','
name|'path'
op|','
name|'resp'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'test'
op|'='
name|'test'
newline|'\n'
name|'self'
op|'.'
name|'path'
op|'='
name|'path'
newline|'\n'
name|'self'
op|'.'
name|'resp'
op|'='
name|'resp'
newline|'\n'
nl|'\n'
DECL|member|make_request
dedent|''
name|'def'
name|'make_request'
op|'('
nl|'\n'
name|'self'
op|','
name|'method'
op|','
name|'path'
op|','
name|'headers'
op|','
name|'acceptable_statuses'
op|','
nl|'\n'
name|'body_file'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'test'
op|'.'
name|'assertEqual'
op|'('
string|"'HEAD'"
op|','
name|'method'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'test'
op|'.'
name|'assertEqual'
op|'('
name|'self'
op|'.'
name|'path'
op|','
name|'path'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'test'
op|'.'
name|'assertEqual'
op|'('
op|'{'
op|'}'
op|','
name|'headers'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'test'
op|'.'
name|'assertEqual'
op|'('
op|'('
number|'2'
op|','
number|'404'
op|')'
op|','
name|'acceptable_statuses'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'test'
op|'.'
name|'assertIsNone'
op|'('
name|'body_file'
op|')'
newline|'\n'
name|'return'
name|'self'
op|'.'
name|'resp'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'account'
op|','
name|'container'
op|','
name|'obj'
op|'='
name|'path_parts'
op|'('
op|')'
newline|'\n'
name|'path'
op|'='
name|'make_path'
op|'('
name|'account'
op|')'
newline|'\n'
name|'containers'
op|','
name|'objects'
op|'='
number|'10'
op|','
number|'100'
newline|'\n'
name|'client'
op|'='
name|'InternalClient'
op|'('
name|'self'
op|','
name|'path'
op|','
name|'Response'
op|'('
name|'containers'
op|','
name|'objects'
op|')'
op|')'
newline|'\n'
name|'info'
op|'='
name|'client'
op|'.'
name|'get_account_info'
op|'('
name|'account'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
op|'('
name|'containers'
op|','
name|'objects'
op|')'
op|','
name|'info'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_account_info_404
dedent|''
name|'def'
name|'test_get_account_info_404'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
DECL|class|Response
indent|'        '
name|'class'
name|'Response'
op|'('
name|'object'
op|')'
op|':'
newline|'\n'
DECL|member|__init__
indent|'            '
name|'def'
name|'__init__'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'headers'
op|'='
op|'{'
nl|'\n'
string|"'x-account-container-count'"
op|':'
number|'10'
op|','
nl|'\n'
string|"'x-account-object-count'"
op|':'
number|'100'
op|','
nl|'\n'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'status_int'
op|'='
number|'404'
newline|'\n'
nl|'\n'
DECL|class|InternalClient
dedent|''
dedent|''
name|'class'
name|'InternalClient'
op|'('
name|'internal_client'
op|'.'
name|'InternalClient'
op|')'
op|':'
newline|'\n'
DECL|member|__init__
indent|'            '
name|'def'
name|'__init__'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'pass'
newline|'\n'
nl|'\n'
DECL|member|make_path
dedent|''
name|'def'
name|'make_path'
op|'('
name|'self'
op|','
op|'*'
name|'a'
op|','
op|'**'
name|'kw'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'return'
string|"'some_path'"
newline|'\n'
nl|'\n'
DECL|member|make_request
dedent|''
name|'def'
name|'make_request'
op|'('
name|'self'
op|','
op|'*'
name|'a'
op|','
op|'**'
name|'kw'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'return'
name|'Response'
op|'('
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'client'
op|'='
name|'InternalClient'
op|'('
op|')'
newline|'\n'
name|'info'
op|'='
name|'client'
op|'.'
name|'get_account_info'
op|'('
string|"'some_account'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
op|'('
number|'0'
op|','
number|'0'
op|')'
op|','
name|'info'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_account_metadata
dedent|''
name|'def'
name|'test_get_account_metadata'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'account'
op|','
name|'container'
op|','
name|'obj'
op|'='
name|'path_parts'
op|'('
op|')'
newline|'\n'
name|'path'
op|'='
name|'make_path'
op|'('
name|'account'
op|')'
newline|'\n'
name|'acceptable_statuses'
op|'='
string|"'some_status_list'"
newline|'\n'
name|'metadata_prefix'
op|'='
string|"'some_metadata_prefix'"
newline|'\n'
name|'client'
op|'='
name|'GetMetadataInternalClient'
op|'('
nl|'\n'
name|'self'
op|','
name|'path'
op|','
name|'metadata_prefix'
op|','
name|'acceptable_statuses'
op|')'
newline|'\n'
name|'metadata'
op|'='
name|'client'
op|'.'
name|'get_account_metadata'
op|'('
nl|'\n'
name|'account'
op|','
name|'metadata_prefix'
op|','
name|'acceptable_statuses'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'client'
op|'.'
name|'metadata'
op|','
name|'metadata'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'1'
op|','
name|'client'
op|'.'
name|'get_metadata_called'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_metadadata_with_acceptable_status
dedent|''
name|'def'
name|'test_get_metadadata_with_acceptable_status'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'account'
op|','
name|'container'
op|','
name|'obj'
op|'='
name|'path_parts'
op|'('
op|')'
newline|'\n'
name|'path'
op|'='
name|'make_path_info'
op|'('
name|'account'
op|')'
newline|'\n'
name|'client'
op|','
name|'app'
op|'='
name|'get_client_app'
op|'('
op|')'
newline|'\n'
name|'resp_headers'
op|'='
op|'{'
string|"'some-important-header'"
op|':'
string|"'some value'"
op|'}'
newline|'\n'
name|'app'
op|'.'
name|'register'
op|'('
string|"'GET'"
op|','
name|'path'
op|','
name|'swob'
op|'.'
name|'HTTPOk'
op|','
name|'resp_headers'
op|')'
newline|'\n'
name|'metadata'
op|'='
name|'client'
op|'.'
name|'get_account_metadata'
op|'('
nl|'\n'
name|'account'
op|','
name|'acceptable_statuses'
op|'='
op|'('
number|'2'
op|','
number|'4'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'metadata'
op|'['
string|"'some-important-header'"
op|']'
op|','
nl|'\n'
string|"'some value'"
op|')'
newline|'\n'
name|'app'
op|'.'
name|'register'
op|'('
string|"'GET'"
op|','
name|'path'
op|','
name|'swob'
op|'.'
name|'HTTPNotFound'
op|','
name|'resp_headers'
op|')'
newline|'\n'
name|'metadata'
op|'='
name|'client'
op|'.'
name|'get_account_metadata'
op|'('
nl|'\n'
name|'account'
op|','
name|'acceptable_statuses'
op|'='
op|'('
number|'2'
op|','
number|'4'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'metadata'
op|'['
string|"'some-important-header'"
op|']'
op|','
nl|'\n'
string|"'some value'"
op|')'
newline|'\n'
name|'app'
op|'.'
name|'register'
op|'('
string|"'GET'"
op|','
name|'path'
op|','
name|'swob'
op|'.'
name|'HTTPServerError'
op|','
name|'resp_headers'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'internal_client'
op|'.'
name|'UnexpectedResponse'
op|','
nl|'\n'
name|'client'
op|'.'
name|'get_account_metadata'
op|','
name|'account'
op|','
nl|'\n'
name|'acceptable_statuses'
op|'='
op|'('
number|'2'
op|','
number|'4'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_set_account_metadata
dedent|''
name|'def'
name|'test_set_account_metadata'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'account'
op|','
name|'container'
op|','
name|'obj'
op|'='
name|'path_parts'
op|'('
op|')'
newline|'\n'
name|'path'
op|'='
name|'make_path'
op|'('
name|'account'
op|')'
newline|'\n'
name|'metadata'
op|'='
string|"'some_metadata'"
newline|'\n'
name|'metadata_prefix'
op|'='
string|"'some_metadata_prefix'"
newline|'\n'
name|'acceptable_statuses'
op|'='
string|"'some_status_list'"
newline|'\n'
name|'client'
op|'='
name|'SetMetadataInternalClient'
op|'('
nl|'\n'
name|'self'
op|','
name|'path'
op|','
name|'metadata'
op|','
name|'metadata_prefix'
op|','
name|'acceptable_statuses'
op|')'
newline|'\n'
name|'client'
op|'.'
name|'set_account_metadata'
op|'('
nl|'\n'
name|'account'
op|','
name|'metadata'
op|','
name|'metadata_prefix'
op|','
name|'acceptable_statuses'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'1'
op|','
name|'client'
op|'.'
name|'set_metadata_called'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_container_exists
dedent|''
name|'def'
name|'test_container_exists'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
DECL|class|Response
indent|'        '
name|'class'
name|'Response'
op|'('
name|'object'
op|')'
op|':'
newline|'\n'
DECL|member|__init__
indent|'            '
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'status_int'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'status_int'
op|'='
name|'status_int'
newline|'\n'
nl|'\n'
DECL|class|InternalClient
dedent|''
dedent|''
name|'class'
name|'InternalClient'
op|'('
name|'internal_client'
op|'.'
name|'InternalClient'
op|')'
op|':'
newline|'\n'
DECL|member|__init__
indent|'            '
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'test'
op|','
name|'path'
op|','
name|'resp'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'test'
op|'='
name|'test'
newline|'\n'
name|'self'
op|'.'
name|'path'
op|'='
name|'path'
newline|'\n'
name|'self'
op|'.'
name|'make_request_called'
op|'='
number|'0'
newline|'\n'
name|'self'
op|'.'
name|'resp'
op|'='
name|'resp'
newline|'\n'
nl|'\n'
DECL|member|make_request
dedent|''
name|'def'
name|'make_request'
op|'('
nl|'\n'
name|'self'
op|','
name|'method'
op|','
name|'path'
op|','
name|'headers'
op|','
name|'acceptable_statuses'
op|','
nl|'\n'
name|'body_file'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'make_request_called'
op|'+='
number|'1'
newline|'\n'
name|'self'
op|'.'
name|'test'
op|'.'
name|'assertEqual'
op|'('
string|"'HEAD'"
op|','
name|'method'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'test'
op|'.'
name|'assertEqual'
op|'('
name|'self'
op|'.'
name|'path'
op|','
name|'path'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'test'
op|'.'
name|'assertEqual'
op|'('
op|'{'
op|'}'
op|','
name|'headers'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'test'
op|'.'
name|'assertEqual'
op|'('
op|'('
number|'2'
op|','
number|'404'
op|')'
op|','
name|'acceptable_statuses'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'test'
op|'.'
name|'assertIsNone'
op|'('
name|'body_file'
op|')'
newline|'\n'
name|'return'
name|'self'
op|'.'
name|'resp'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'account'
op|','
name|'container'
op|','
name|'obj'
op|'='
name|'path_parts'
op|'('
op|')'
newline|'\n'
name|'path'
op|'='
name|'make_path'
op|'('
name|'account'
op|','
name|'container'
op|')'
newline|'\n'
nl|'\n'
name|'client'
op|'='
name|'InternalClient'
op|'('
name|'self'
op|','
name|'path'
op|','
name|'Response'
op|'('
number|'200'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'True'
op|','
name|'client'
op|'.'
name|'container_exists'
op|'('
name|'account'
op|','
name|'container'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'1'
op|','
name|'client'
op|'.'
name|'make_request_called'
op|')'
newline|'\n'
nl|'\n'
name|'client'
op|'='
name|'InternalClient'
op|'('
name|'self'
op|','
name|'path'
op|','
name|'Response'
op|'('
number|'404'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'False'
op|','
name|'client'
op|'.'
name|'container_exists'
op|'('
name|'account'
op|','
name|'container'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'1'
op|','
name|'client'
op|'.'
name|'make_request_called'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_create_container
dedent|''
name|'def'
name|'test_create_container'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
DECL|class|InternalClient
indent|'        '
name|'class'
name|'InternalClient'
op|'('
name|'internal_client'
op|'.'
name|'InternalClient'
op|')'
op|':'
newline|'\n'
DECL|member|__init__
indent|'            '
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'test'
op|','
name|'path'
op|','
name|'headers'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'test'
op|'='
name|'test'
newline|'\n'
name|'self'
op|'.'
name|'path'
op|'='
name|'path'
newline|'\n'
name|'self'
op|'.'
name|'headers'
op|'='
name|'headers'
newline|'\n'
name|'self'
op|'.'
name|'make_request_called'
op|'='
number|'0'
newline|'\n'
nl|'\n'
DECL|member|make_request
dedent|''
name|'def'
name|'make_request'
op|'('
nl|'\n'
name|'self'
op|','
name|'method'
op|','
name|'path'
op|','
name|'headers'
op|','
name|'acceptable_statuses'
op|','
nl|'\n'
name|'body_file'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'make_request_called'
op|'+='
number|'1'
newline|'\n'
name|'self'
op|'.'
name|'test'
op|'.'
name|'assertEqual'
op|'('
string|"'PUT'"
op|','
name|'method'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'test'
op|'.'
name|'assertEqual'
op|'('
name|'self'
op|'.'
name|'path'
op|','
name|'path'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'test'
op|'.'
name|'assertEqual'
op|'('
name|'self'
op|'.'
name|'headers'
op|','
name|'headers'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'test'
op|'.'
name|'assertEqual'
op|'('
op|'('
number|'2'
op|','
op|')'
op|','
name|'acceptable_statuses'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'test'
op|'.'
name|'assertIsNone'
op|'('
name|'body_file'
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'account'
op|','
name|'container'
op|','
name|'obj'
op|'='
name|'path_parts'
op|'('
op|')'
newline|'\n'
name|'path'
op|'='
name|'make_path'
op|'('
name|'account'
op|','
name|'container'
op|')'
newline|'\n'
name|'headers'
op|'='
string|"'some_headers'"
newline|'\n'
name|'client'
op|'='
name|'InternalClient'
op|'('
name|'self'
op|','
name|'path'
op|','
name|'headers'
op|')'
newline|'\n'
name|'client'
op|'.'
name|'create_container'
op|'('
name|'account'
op|','
name|'container'
op|','
name|'headers'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'1'
op|','
name|'client'
op|'.'
name|'make_request_called'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_delete_container
dedent|''
name|'def'
name|'test_delete_container'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
DECL|class|InternalClient
indent|'        '
name|'class'
name|'InternalClient'
op|'('
name|'internal_client'
op|'.'
name|'InternalClient'
op|')'
op|':'
newline|'\n'
DECL|member|__init__
indent|'            '
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'test'
op|','
name|'path'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'test'
op|'='
name|'test'
newline|'\n'
name|'self'
op|'.'
name|'path'
op|'='
name|'path'
newline|'\n'
name|'self'
op|'.'
name|'make_request_called'
op|'='
number|'0'
newline|'\n'
nl|'\n'
DECL|member|make_request
dedent|''
name|'def'
name|'make_request'
op|'('
nl|'\n'
name|'self'
op|','
name|'method'
op|','
name|'path'
op|','
name|'headers'
op|','
name|'acceptable_statuses'
op|','
nl|'\n'
name|'body_file'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'make_request_called'
op|'+='
number|'1'
newline|'\n'
name|'self'
op|'.'
name|'test'
op|'.'
name|'assertEqual'
op|'('
string|"'DELETE'"
op|','
name|'method'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'test'
op|'.'
name|'assertEqual'
op|'('
name|'self'
op|'.'
name|'path'
op|','
name|'path'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'test'
op|'.'
name|'assertEqual'
op|'('
op|'{'
op|'}'
op|','
name|'headers'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'test'
op|'.'
name|'assertEqual'
op|'('
op|'('
number|'2'
op|','
number|'404'
op|')'
op|','
name|'acceptable_statuses'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'test'
op|'.'
name|'assertIsNone'
op|'('
name|'body_file'
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'account'
op|','
name|'container'
op|','
name|'obj'
op|'='
name|'path_parts'
op|'('
op|')'
newline|'\n'
name|'path'
op|'='
name|'make_path'
op|'('
name|'account'
op|','
name|'container'
op|')'
newline|'\n'
name|'client'
op|'='
name|'InternalClient'
op|'('
name|'self'
op|','
name|'path'
op|')'
newline|'\n'
name|'client'
op|'.'
name|'delete_container'
op|'('
name|'account'
op|','
name|'container'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'1'
op|','
name|'client'
op|'.'
name|'make_request_called'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_container_metadata
dedent|''
name|'def'
name|'test_get_container_metadata'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'account'
op|','
name|'container'
op|','
name|'obj'
op|'='
name|'path_parts'
op|'('
op|')'
newline|'\n'
name|'path'
op|'='
name|'make_path'
op|'('
name|'account'
op|','
name|'container'
op|')'
newline|'\n'
name|'metadata_prefix'
op|'='
string|"'some_metadata_prefix'"
newline|'\n'
name|'acceptable_statuses'
op|'='
string|"'some_status_list'"
newline|'\n'
name|'client'
op|'='
name|'GetMetadataInternalClient'
op|'('
nl|'\n'
name|'self'
op|','
name|'path'
op|','
name|'metadata_prefix'
op|','
name|'acceptable_statuses'
op|')'
newline|'\n'
name|'metadata'
op|'='
name|'client'
op|'.'
name|'get_container_metadata'
op|'('
nl|'\n'
name|'account'
op|','
name|'container'
op|','
name|'metadata_prefix'
op|','
name|'acceptable_statuses'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'client'
op|'.'
name|'metadata'
op|','
name|'metadata'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'1'
op|','
name|'client'
op|'.'
name|'get_metadata_called'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_iter_objects
dedent|''
name|'def'
name|'test_iter_objects'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'account'
op|','
name|'container'
op|','
name|'obj'
op|'='
name|'path_parts'
op|'('
op|')'
newline|'\n'
name|'path'
op|'='
name|'make_path'
op|'('
name|'account'
op|','
name|'container'
op|')'
newline|'\n'
name|'marker'
op|'='
string|"'some_maker'"
newline|'\n'
name|'end_marker'
op|'='
string|"'some_end_marker'"
newline|'\n'
name|'acceptable_statuses'
op|'='
string|"'some_status_list'"
newline|'\n'
name|'items'
op|'='
string|"'0 1 2'"
op|'.'
name|'split'
op|'('
op|')'
newline|'\n'
name|'client'
op|'='
name|'IterInternalClient'
op|'('
nl|'\n'
name|'self'
op|','
name|'path'
op|','
name|'marker'
op|','
name|'end_marker'
op|','
name|'acceptable_statuses'
op|','
name|'items'
op|')'
newline|'\n'
name|'ret_items'
op|'='
op|'['
op|']'
newline|'\n'
name|'for'
name|'obj'
name|'in'
name|'client'
op|'.'
name|'iter_objects'
op|'('
nl|'\n'
name|'account'
op|','
name|'container'
op|','
name|'marker'
op|','
name|'end_marker'
op|','
name|'acceptable_statuses'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'ret_items'
op|'.'
name|'append'
op|'('
name|'obj'
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'items'
op|','
name|'ret_items'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_set_container_metadata
dedent|''
name|'def'
name|'test_set_container_metadata'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'account'
op|','
name|'container'
op|','
name|'obj'
op|'='
name|'path_parts'
op|'('
op|')'
newline|'\n'
name|'path'
op|'='
name|'make_path'
op|'('
name|'account'
op|','
name|'container'
op|')'
newline|'\n'
name|'metadata'
op|'='
string|"'some_metadata'"
newline|'\n'
name|'metadata_prefix'
op|'='
string|"'some_metadata_prefix'"
newline|'\n'
name|'acceptable_statuses'
op|'='
string|"'some_status_list'"
newline|'\n'
name|'client'
op|'='
name|'SetMetadataInternalClient'
op|'('
nl|'\n'
name|'self'
op|','
name|'path'
op|','
name|'metadata'
op|','
name|'metadata_prefix'
op|','
name|'acceptable_statuses'
op|')'
newline|'\n'
name|'client'
op|'.'
name|'set_container_metadata'
op|'('
nl|'\n'
name|'account'
op|','
name|'container'
op|','
name|'metadata'
op|','
name|'metadata_prefix'
op|','
name|'acceptable_statuses'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'1'
op|','
name|'client'
op|'.'
name|'set_metadata_called'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_delete_object
dedent|''
name|'def'
name|'test_delete_object'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
DECL|class|InternalClient
indent|'        '
name|'class'
name|'InternalClient'
op|'('
name|'internal_client'
op|'.'
name|'InternalClient'
op|')'
op|':'
newline|'\n'
DECL|member|__init__
indent|'            '
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'test'
op|','
name|'path'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'test'
op|'='
name|'test'
newline|'\n'
name|'self'
op|'.'
name|'path'
op|'='
name|'path'
newline|'\n'
name|'self'
op|'.'
name|'make_request_called'
op|'='
number|'0'
newline|'\n'
nl|'\n'
DECL|member|make_request
dedent|''
name|'def'
name|'make_request'
op|'('
nl|'\n'
name|'self'
op|','
name|'method'
op|','
name|'path'
op|','
name|'headers'
op|','
name|'acceptable_statuses'
op|','
nl|'\n'
name|'body_file'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'make_request_called'
op|'+='
number|'1'
newline|'\n'
name|'self'
op|'.'
name|'test'
op|'.'
name|'assertEqual'
op|'('
string|"'DELETE'"
op|','
name|'method'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'test'
op|'.'
name|'assertEqual'
op|'('
name|'self'
op|'.'
name|'path'
op|','
name|'path'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'test'
op|'.'
name|'assertEqual'
op|'('
op|'{'
op|'}'
op|','
name|'headers'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'test'
op|'.'
name|'assertEqual'
op|'('
op|'('
number|'2'
op|','
number|'404'
op|')'
op|','
name|'acceptable_statuses'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'test'
op|'.'
name|'assertIsNone'
op|'('
name|'body_file'
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'account'
op|','
name|'container'
op|','
name|'obj'
op|'='
name|'path_parts'
op|'('
op|')'
newline|'\n'
name|'path'
op|'='
name|'make_path'
op|'('
name|'account'
op|','
name|'container'
op|','
name|'obj'
op|')'
newline|'\n'
nl|'\n'
name|'client'
op|'='
name|'InternalClient'
op|'('
name|'self'
op|','
name|'path'
op|')'
newline|'\n'
name|'client'
op|'.'
name|'delete_object'
op|'('
name|'account'
op|','
name|'container'
op|','
name|'obj'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'1'
op|','
name|'client'
op|'.'
name|'make_request_called'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_object_metadata
dedent|''
name|'def'
name|'test_get_object_metadata'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'account'
op|','
name|'container'
op|','
name|'obj'
op|'='
name|'path_parts'
op|'('
op|')'
newline|'\n'
name|'path'
op|'='
name|'make_path'
op|'('
name|'account'
op|','
name|'container'
op|','
name|'obj'
op|')'
newline|'\n'
name|'metadata_prefix'
op|'='
string|"'some_metadata_prefix'"
newline|'\n'
name|'acceptable_statuses'
op|'='
string|"'some_status_list'"
newline|'\n'
name|'client'
op|'='
name|'GetMetadataInternalClient'
op|'('
nl|'\n'
name|'self'
op|','
name|'path'
op|','
name|'metadata_prefix'
op|','
name|'acceptable_statuses'
op|')'
newline|'\n'
name|'metadata'
op|'='
name|'client'
op|'.'
name|'get_object_metadata'
op|'('
nl|'\n'
name|'account'
op|','
name|'container'
op|','
name|'obj'
op|','
name|'metadata_prefix'
op|','
nl|'\n'
name|'acceptable_statuses'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'client'
op|'.'
name|'metadata'
op|','
name|'metadata'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'1'
op|','
name|'client'
op|'.'
name|'get_metadata_called'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_metadata_extra_headers
dedent|''
name|'def'
name|'test_get_metadata_extra_headers'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
DECL|class|InternalClient
indent|'        '
name|'class'
name|'InternalClient'
op|'('
name|'internal_client'
op|'.'
name|'InternalClient'
op|')'
op|':'
newline|'\n'
DECL|member|__init__
indent|'            '
name|'def'
name|'__init__'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'app'
op|'='
name|'self'
op|'.'
name|'fake_app'
newline|'\n'
name|'self'
op|'.'
name|'user_agent'
op|'='
string|"'some_agent'"
newline|'\n'
name|'self'
op|'.'
name|'request_tries'
op|'='
number|'3'
newline|'\n'
nl|'\n'
DECL|member|fake_app
dedent|''
name|'def'
name|'fake_app'
op|'('
name|'self'
op|','
name|'env'
op|','
name|'start_response'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'req_env'
op|'='
name|'env'
newline|'\n'
name|'start_response'
op|'('
string|"'200 Ok'"
op|','
op|'['
op|'('
string|"'Content-Length'"
op|','
string|"'0'"
op|')'
op|']'
op|')'
newline|'\n'
name|'return'
op|'['
op|']'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'client'
op|'='
name|'InternalClient'
op|'('
op|')'
newline|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Foo'"
op|':'
string|"'bar'"
op|'}'
newline|'\n'
name|'client'
op|'.'
name|'get_object_metadata'
op|'('
string|"'account'"
op|','
string|"'container'"
op|','
string|"'obj'"
op|','
nl|'\n'
name|'headers'
op|'='
name|'headers'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'client'
op|'.'
name|'req_env'
op|'['
string|"'HTTP_X_FOO'"
op|']'
op|','
string|"'bar'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_object
dedent|''
name|'def'
name|'test_get_object'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'account'
op|','
name|'container'
op|','
name|'obj'
op|'='
name|'path_parts'
op|'('
op|')'
newline|'\n'
name|'path_info'
op|'='
name|'make_path_info'
op|'('
name|'account'
op|','
name|'container'
op|','
name|'obj'
op|')'
newline|'\n'
name|'client'
op|','
name|'app'
op|'='
name|'get_client_app'
op|'('
op|')'
newline|'\n'
name|'headers'
op|'='
op|'{'
string|"'foo'"
op|':'
string|"'bar'"
op|'}'
newline|'\n'
name|'body'
op|'='
string|"'some_object_body'"
newline|'\n'
name|'app'
op|'.'
name|'register'
op|'('
string|"'GET'"
op|','
name|'path_info'
op|','
name|'swob'
op|'.'
name|'HTTPOk'
op|','
name|'headers'
op|','
name|'body'
op|')'
newline|'\n'
name|'req_headers'
op|'='
op|'{'
string|"'x-important-header'"
op|':'
string|"'some_important_value'"
op|'}'
newline|'\n'
name|'status_int'
op|','
name|'resp_headers'
op|','
name|'obj_iter'
op|'='
name|'client'
op|'.'
name|'get_object'
op|'('
nl|'\n'
name|'account'
op|','
name|'container'
op|','
name|'obj'
op|','
name|'req_headers'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'status_int'
op|'//'
number|'100'
op|','
number|'2'
op|')'
newline|'\n'
name|'for'
name|'k'
op|','
name|'v'
name|'in'
name|'headers'
op|'.'
name|'items'
op|'('
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'v'
op|','
name|'resp_headers'
op|'['
name|'k'
op|']'
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"''"
op|'.'
name|'join'
op|'('
name|'obj_iter'
op|')'
op|','
name|'body'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp_headers'
op|'['
string|"'content-length'"
op|']'
op|','
name|'str'
op|'('
name|'len'
op|'('
name|'body'
op|')'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'app'
op|'.'
name|'call_count'
op|','
number|'1'
op|')'
newline|'\n'
name|'req_headers'
op|'.'
name|'update'
op|'('
op|'{'
nl|'\n'
string|"'host'"
op|':'
string|"'localhost:80'"
op|','
comment|'# from swob.Request.blank'
nl|'\n'
string|"'user-agent'"
op|':'
string|"'test'"
op|','
comment|'# from InternalClient.make_request'
nl|'\n'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'app'
op|'.'
name|'calls_with_headers'
op|','
op|'['
op|'('
nl|'\n'
string|"'GET'"
op|','
name|'path_info'
op|','
name|'HeaderKeyDict'
op|'('
name|'req_headers'
op|')'
op|')'
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_iter_object_lines
dedent|''
name|'def'
name|'test_iter_object_lines'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
DECL|class|InternalClient
indent|'        '
name|'class'
name|'InternalClient'
op|'('
name|'internal_client'
op|'.'
name|'InternalClient'
op|')'
op|':'
newline|'\n'
DECL|member|__init__
indent|'            '
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'lines'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'lines'
op|'='
name|'lines'
newline|'\n'
name|'self'
op|'.'
name|'app'
op|'='
name|'self'
op|'.'
name|'fake_app'
newline|'\n'
name|'self'
op|'.'
name|'user_agent'
op|'='
string|"'some_agent'"
newline|'\n'
name|'self'
op|'.'
name|'request_tries'
op|'='
number|'3'
newline|'\n'
nl|'\n'
DECL|member|fake_app
dedent|''
name|'def'
name|'fake_app'
op|'('
name|'self'
op|','
name|'env'
op|','
name|'start_response'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'start_response'
op|'('
string|"'200 Ok'"
op|','
op|'['
op|'('
string|"'Content-Length'"
op|','
string|"'0'"
op|')'
op|']'
op|')'
newline|'\n'
name|'return'
op|'['
string|"'%s\\n'"
op|'%'
name|'x'
name|'for'
name|'x'
name|'in'
name|'self'
op|'.'
name|'lines'
op|']'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'lines'
op|'='
string|"'line1 line2 line3'"
op|'.'
name|'split'
op|'('
op|')'
newline|'\n'
name|'client'
op|'='
name|'InternalClient'
op|'('
name|'lines'
op|')'
newline|'\n'
name|'ret_lines'
op|'='
op|'['
op|']'
newline|'\n'
name|'for'
name|'line'
name|'in'
name|'client'
op|'.'
name|'iter_object_lines'
op|'('
string|"'account'"
op|','
string|"'container'"
op|','
string|"'object'"
op|')'
op|':'
newline|'\n'
indent|'            '
name|'ret_lines'
op|'.'
name|'append'
op|'('
name|'line'
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'lines'
op|','
name|'ret_lines'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_iter_object_lines_compressed_object
dedent|''
name|'def'
name|'test_iter_object_lines_compressed_object'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
DECL|class|InternalClient
indent|'        '
name|'class'
name|'InternalClient'
op|'('
name|'internal_client'
op|'.'
name|'InternalClient'
op|')'
op|':'
newline|'\n'
DECL|member|__init__
indent|'            '
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'lines'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'lines'
op|'='
name|'lines'
newline|'\n'
name|'self'
op|'.'
name|'app'
op|'='
name|'self'
op|'.'
name|'fake_app'
newline|'\n'
name|'self'
op|'.'
name|'user_agent'
op|'='
string|"'some_agent'"
newline|'\n'
name|'self'
op|'.'
name|'request_tries'
op|'='
number|'3'
newline|'\n'
nl|'\n'
DECL|member|fake_app
dedent|''
name|'def'
name|'fake_app'
op|'('
name|'self'
op|','
name|'env'
op|','
name|'start_response'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'start_response'
op|'('
string|"'200 Ok'"
op|','
op|'['
op|'('
string|"'Content-Length'"
op|','
string|"'0'"
op|')'
op|']'
op|')'
newline|'\n'
name|'return'
name|'internal_client'
op|'.'
name|'CompressingFileReader'
op|'('
nl|'\n'
name|'StringIO'
op|'('
string|"'\\n'"
op|'.'
name|'join'
op|'('
name|'self'
op|'.'
name|'lines'
op|')'
op|')'
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'lines'
op|'='
string|"'line1 line2 line3'"
op|'.'
name|'split'
op|'('
op|')'
newline|'\n'
name|'client'
op|'='
name|'InternalClient'
op|'('
name|'lines'
op|')'
newline|'\n'
name|'ret_lines'
op|'='
op|'['
op|']'
newline|'\n'
name|'for'
name|'line'
name|'in'
name|'client'
op|'.'
name|'iter_object_lines'
op|'('
nl|'\n'
string|"'account'"
op|','
string|"'container'"
op|','
string|"'object.gz'"
op|')'
op|':'
newline|'\n'
indent|'            '
name|'ret_lines'
op|'.'
name|'append'
op|'('
name|'line'
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'lines'
op|','
name|'ret_lines'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_iter_object_lines_404
dedent|''
name|'def'
name|'test_iter_object_lines_404'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
DECL|class|InternalClient
indent|'        '
name|'class'
name|'InternalClient'
op|'('
name|'internal_client'
op|'.'
name|'InternalClient'
op|')'
op|':'
newline|'\n'
DECL|member|__init__
indent|'            '
name|'def'
name|'__init__'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'app'
op|'='
name|'self'
op|'.'
name|'fake_app'
newline|'\n'
name|'self'
op|'.'
name|'user_agent'
op|'='
string|"'some_agent'"
newline|'\n'
name|'self'
op|'.'
name|'request_tries'
op|'='
number|'3'
newline|'\n'
nl|'\n'
DECL|member|fake_app
dedent|''
name|'def'
name|'fake_app'
op|'('
name|'self'
op|','
name|'env'
op|','
name|'start_response'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'start_response'
op|'('
string|"'404 Not Found'"
op|','
op|'['
op|']'
op|')'
newline|'\n'
name|'return'
op|'['
string|"'one\\ntwo\\nthree'"
op|']'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'client'
op|'='
name|'InternalClient'
op|'('
op|')'
newline|'\n'
name|'lines'
op|'='
op|'['
op|']'
newline|'\n'
name|'for'
name|'line'
name|'in'
name|'client'
op|'.'
name|'iter_object_lines'
op|'('
nl|'\n'
string|"'some_account'"
op|','
string|"'some_container'"
op|','
string|"'some_object'"
op|','
nl|'\n'
name|'acceptable_statuses'
op|'='
op|'('
number|'2'
op|','
number|'404'
op|')'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'lines'
op|'.'
name|'append'
op|'('
name|'line'
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
op|'['
op|']'
op|','
name|'lines'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_set_object_metadata
dedent|''
name|'def'
name|'test_set_object_metadata'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'account'
op|','
name|'container'
op|','
name|'obj'
op|'='
name|'path_parts'
op|'('
op|')'
newline|'\n'
name|'path'
op|'='
name|'make_path'
op|'('
name|'account'
op|','
name|'container'
op|','
name|'obj'
op|')'
newline|'\n'
name|'metadata'
op|'='
string|"'some_metadata'"
newline|'\n'
name|'metadata_prefix'
op|'='
string|"'some_metadata_prefix'"
newline|'\n'
name|'acceptable_statuses'
op|'='
string|"'some_status_list'"
newline|'\n'
name|'client'
op|'='
name|'SetMetadataInternalClient'
op|'('
nl|'\n'
name|'self'
op|','
name|'path'
op|','
name|'metadata'
op|','
name|'metadata_prefix'
op|','
name|'acceptable_statuses'
op|')'
newline|'\n'
name|'client'
op|'.'
name|'set_object_metadata'
op|'('
nl|'\n'
name|'account'
op|','
name|'container'
op|','
name|'obj'
op|','
name|'metadata'
op|','
name|'metadata_prefix'
op|','
nl|'\n'
name|'acceptable_statuses'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'1'
op|','
name|'client'
op|'.'
name|'set_metadata_called'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_upload_object
dedent|''
name|'def'
name|'test_upload_object'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
DECL|class|InternalClient
indent|'        '
name|'class'
name|'InternalClient'
op|'('
name|'internal_client'
op|'.'
name|'InternalClient'
op|')'
op|':'
newline|'\n'
DECL|member|__init__
indent|'            '
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'test'
op|','
name|'path'
op|','
name|'headers'
op|','
name|'fobj'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'test'
op|'='
name|'test'
newline|'\n'
name|'self'
op|'.'
name|'path'
op|'='
name|'path'
newline|'\n'
name|'self'
op|'.'
name|'headers'
op|'='
name|'headers'
newline|'\n'
name|'self'
op|'.'
name|'fobj'
op|'='
name|'fobj'
newline|'\n'
name|'self'
op|'.'
name|'make_request_called'
op|'='
number|'0'
newline|'\n'
nl|'\n'
DECL|member|make_request
dedent|''
name|'def'
name|'make_request'
op|'('
nl|'\n'
name|'self'
op|','
name|'method'
op|','
name|'path'
op|','
name|'headers'
op|','
name|'acceptable_statuses'
op|','
nl|'\n'
name|'body_file'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'make_request_called'
op|'+='
number|'1'
newline|'\n'
name|'self'
op|'.'
name|'test'
op|'.'
name|'assertEqual'
op|'('
name|'self'
op|'.'
name|'path'
op|','
name|'path'
op|')'
newline|'\n'
name|'exp_headers'
op|'='
name|'dict'
op|'('
name|'self'
op|'.'
name|'headers'
op|')'
newline|'\n'
name|'exp_headers'
op|'['
string|"'Transfer-Encoding'"
op|']'
op|'='
string|"'chunked'"
newline|'\n'
name|'self'
op|'.'
name|'test'
op|'.'
name|'assertEqual'
op|'('
name|'exp_headers'
op|','
name|'headers'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'test'
op|'.'
name|'assertEqual'
op|'('
name|'self'
op|'.'
name|'fobj'
op|','
name|'fobj'
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'fobj'
op|'='
string|"'some_fobj'"
newline|'\n'
name|'account'
op|','
name|'container'
op|','
name|'obj'
op|'='
name|'path_parts'
op|'('
op|')'
newline|'\n'
name|'path'
op|'='
name|'make_path'
op|'('
name|'account'
op|','
name|'container'
op|','
name|'obj'
op|')'
newline|'\n'
name|'headers'
op|'='
op|'{'
string|"'key'"
op|':'
string|"'value'"
op|'}'
newline|'\n'
nl|'\n'
name|'client'
op|'='
name|'InternalClient'
op|'('
name|'self'
op|','
name|'path'
op|','
name|'headers'
op|','
name|'fobj'
op|')'
newline|'\n'
name|'client'
op|'.'
name|'upload_object'
op|'('
name|'fobj'
op|','
name|'account'
op|','
name|'container'
op|','
name|'obj'
op|','
name|'headers'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'1'
op|','
name|'client'
op|'.'
name|'make_request_called'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_upload_object_not_chunked
dedent|''
name|'def'
name|'test_upload_object_not_chunked'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
DECL|class|InternalClient
indent|'        '
name|'class'
name|'InternalClient'
op|'('
name|'internal_client'
op|'.'
name|'InternalClient'
op|')'
op|':'
newline|'\n'
DECL|member|__init__
indent|'            '
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'test'
op|','
name|'path'
op|','
name|'headers'
op|','
name|'fobj'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'test'
op|'='
name|'test'
newline|'\n'
name|'self'
op|'.'
name|'path'
op|'='
name|'path'
newline|'\n'
name|'self'
op|'.'
name|'headers'
op|'='
name|'headers'
newline|'\n'
name|'self'
op|'.'
name|'fobj'
op|'='
name|'fobj'
newline|'\n'
name|'self'
op|'.'
name|'make_request_called'
op|'='
number|'0'
newline|'\n'
nl|'\n'
DECL|member|make_request
dedent|''
name|'def'
name|'make_request'
op|'('
nl|'\n'
name|'self'
op|','
name|'method'
op|','
name|'path'
op|','
name|'headers'
op|','
name|'acceptable_statuses'
op|','
nl|'\n'
name|'body_file'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'make_request_called'
op|'+='
number|'1'
newline|'\n'
name|'self'
op|'.'
name|'test'
op|'.'
name|'assertEqual'
op|'('
name|'self'
op|'.'
name|'path'
op|','
name|'path'
op|')'
newline|'\n'
name|'exp_headers'
op|'='
name|'dict'
op|'('
name|'self'
op|'.'
name|'headers'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'test'
op|'.'
name|'assertEqual'
op|'('
name|'exp_headers'
op|','
name|'headers'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'test'
op|'.'
name|'assertEqual'
op|'('
name|'self'
op|'.'
name|'fobj'
op|','
name|'fobj'
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'fobj'
op|'='
string|"'some_fobj'"
newline|'\n'
name|'account'
op|','
name|'container'
op|','
name|'obj'
op|'='
name|'path_parts'
op|'('
op|')'
newline|'\n'
name|'path'
op|'='
name|'make_path'
op|'('
name|'account'
op|','
name|'container'
op|','
name|'obj'
op|')'
newline|'\n'
name|'headers'
op|'='
op|'{'
string|"'key'"
op|':'
string|"'value'"
op|','
string|"'Content-Length'"
op|':'
name|'len'
op|'('
name|'fobj'
op|')'
op|'}'
newline|'\n'
nl|'\n'
name|'client'
op|'='
name|'InternalClient'
op|'('
name|'self'
op|','
name|'path'
op|','
name|'headers'
op|','
name|'fobj'
op|')'
newline|'\n'
name|'client'
op|'.'
name|'upload_object'
op|'('
name|'fobj'
op|','
name|'account'
op|','
name|'container'
op|','
name|'obj'
op|','
name|'headers'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'1'
op|','
name|'client'
op|'.'
name|'make_request_called'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|TestGetAuth
dedent|''
dedent|''
name|'class'
name|'TestGetAuth'
op|'('
name|'unittest'
op|'.'
name|'TestCase'
op|')'
op|':'
newline|'\n'
indent|'    '
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'('
string|"'eventlet.green.urllib2.urlopen'"
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'('
string|"'eventlet.green.urllib2.Request'"
op|')'
newline|'\n'
DECL|member|test_ok
name|'def'
name|'test_ok'
op|'('
name|'self'
op|','
name|'request'
op|','
name|'urlopen'
op|')'
op|':'
newline|'\n'
DECL|function|getheader
indent|'        '
name|'def'
name|'getheader'
op|'('
name|'name'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'d'
op|'='
op|'{'
string|"'X-Storage-Url'"
op|':'
string|"'url'"
op|','
string|"'X-Auth-Token'"
op|':'
string|"'token'"
op|'}'
newline|'\n'
name|'return'
name|'d'
op|'.'
name|'get'
op|'('
name|'name'
op|')'
newline|'\n'
dedent|''
name|'urlopen'
op|'.'
name|'return_value'
op|'.'
name|'info'
op|'.'
name|'return_value'
op|'.'
name|'getheader'
op|'='
name|'getheader'
newline|'\n'
nl|'\n'
name|'url'
op|','
name|'token'
op|'='
name|'internal_client'
op|'.'
name|'get_auth'
op|'('
nl|'\n'
string|"'http://127.0.0.1'"
op|','
string|"'user'"
op|','
string|"'key'"
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'url'
op|','
string|'"url"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'token'
op|','
string|'"token"'
op|')'
newline|'\n'
name|'request'
op|'.'
name|'assert_called_with'
op|'('
string|"'http://127.0.0.1'"
op|')'
newline|'\n'
name|'request'
op|'.'
name|'return_value'
op|'.'
name|'add_header'
op|'.'
name|'assert_any_call'
op|'('
string|"'X-Auth-User'"
op|','
string|"'user'"
op|')'
newline|'\n'
name|'request'
op|'.'
name|'return_value'
op|'.'
name|'add_header'
op|'.'
name|'assert_any_call'
op|'('
string|"'X-Auth-Key'"
op|','
string|"'key'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_invalid_version
dedent|''
name|'def'
name|'test_invalid_version'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'SystemExit'
op|','
name|'internal_client'
op|'.'
name|'get_auth'
op|','
nl|'\n'
string|"'http://127.0.0.1'"
op|','
string|"'user'"
op|','
string|"'key'"
op|','
name|'auth_version'
op|'='
number|'2.0'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|TestSimpleClient
dedent|''
dedent|''
name|'class'
name|'TestSimpleClient'
op|'('
name|'unittest'
op|'.'
name|'TestCase'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|member|_test_get_head
indent|'    '
name|'def'
name|'_test_get_head'
op|'('
name|'self'
op|','
name|'request'
op|','
name|'urlopen'
op|','
name|'method'
op|')'
op|':'
newline|'\n'
nl|'\n'
indent|'        '
name|'mock_time_value'
op|'='
op|'['
number|'1401224049.98'
op|']'
newline|'\n'
nl|'\n'
DECL|function|mock_time
name|'def'
name|'mock_time'
op|'('
op|')'
op|':'
newline|'\n'
comment|'# global mock_time_value'
nl|'\n'
indent|'            '
name|'mock_time_value'
op|'['
number|'0'
op|']'
op|'+='
number|'1'
newline|'\n'
name|'return'
name|'mock_time_value'
op|'['
number|'0'
op|']'
newline|'\n'
nl|'\n'
dedent|''
name|'with'
name|'mock'
op|'.'
name|'patch'
op|'('
string|"'swift.common.internal_client.time'"
op|','
name|'mock_time'
op|')'
op|':'
newline|'\n'
comment|'# basic request, only url as kwarg'
nl|'\n'
indent|'            '
name|'request'
op|'.'
name|'return_value'
op|'.'
name|'get_type'
op|'.'
name|'return_value'
op|'='
string|'"http"'
newline|'\n'
name|'urlopen'
op|'.'
name|'return_value'
op|'.'
name|'read'
op|'.'
name|'return_value'
op|'='
string|"''"
newline|'\n'
name|'urlopen'
op|'.'
name|'return_value'
op|'.'
name|'getcode'
op|'.'
name|'return_value'
op|'='
number|'200'
newline|'\n'
name|'urlopen'
op|'.'
name|'return_value'
op|'.'
name|'info'
op|'.'
name|'return_value'
op|'='
op|'{'
string|"'content-length'"
op|':'
string|"'345'"
op|'}'
newline|'\n'
name|'sc'
op|'='
name|'internal_client'
op|'.'
name|'SimpleClient'
op|'('
name|'url'
op|'='
string|"'http://127.0.0.1'"
op|')'
newline|'\n'
name|'logger'
op|'='
name|'FakeLogger'
op|'('
op|')'
newline|'\n'
name|'retval'
op|'='
name|'sc'
op|'.'
name|'retry_request'
op|'('
nl|'\n'
name|'method'
op|','
name|'headers'
op|'='
op|'{'
string|"'content-length'"
op|':'
string|"'123'"
op|'}'
op|','
name|'logger'
op|'='
name|'logger'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'urlopen'
op|'.'
name|'call_count'
op|','
number|'1'
op|')'
newline|'\n'
name|'request'
op|'.'
name|'assert_called_with'
op|'('
string|"'http://127.0.0.1?format=json'"
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'content-length'"
op|':'
string|"'123'"
op|'}'
op|','
nl|'\n'
name|'data'
op|'='
name|'None'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
op|'['
op|'{'
string|"'content-length'"
op|':'
string|"'345'"
op|'}'
op|','
name|'None'
op|']'
op|','
name|'retval'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'method'
op|','
name|'request'
op|'.'
name|'return_value'
op|'.'
name|'get_method'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'logger'
op|'.'
name|'log_dict'
op|'['
string|"'debug'"
op|']'
op|','
op|'['
op|'('
nl|'\n'
op|'('
string|"'-> 2014-05-27T20:54:11 '"
op|'+'
name|'method'
op|'+'
nl|'\n'
string|"' http://127.0.0.1%3Fformat%3Djson 200 '"
nl|'\n'
string|"'123 345 1401224050.98 1401224051.98 1.0 -'"
op|','
op|')'
op|','
op|'{'
op|'}'
op|')'
op|']'
op|')'
newline|'\n'
nl|'\n'
comment|'# Check if JSON is decoded'
nl|'\n'
name|'urlopen'
op|'.'
name|'return_value'
op|'.'
name|'read'
op|'.'
name|'return_value'
op|'='
string|"'{}'"
newline|'\n'
name|'retval'
op|'='
name|'sc'
op|'.'
name|'retry_request'
op|'('
name|'method'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
op|'['
op|'{'
string|"'content-length'"
op|':'
string|"'345'"
op|'}'
op|','
op|'{'
op|'}'
op|']'
op|','
name|'retval'
op|')'
newline|'\n'
nl|'\n'
comment|'# same as above, now with token'
nl|'\n'
name|'sc'
op|'='
name|'internal_client'
op|'.'
name|'SimpleClient'
op|'('
name|'url'
op|'='
string|"'http://127.0.0.1'"
op|','
nl|'\n'
name|'token'
op|'='
string|"'token'"
op|')'
newline|'\n'
name|'retval'
op|'='
name|'sc'
op|'.'
name|'retry_request'
op|'('
name|'method'
op|')'
newline|'\n'
name|'request'
op|'.'
name|'assert_called_with'
op|'('
string|"'http://127.0.0.1?format=json'"
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Auth-Token'"
op|':'
string|"'token'"
op|'}'
op|','
nl|'\n'
name|'data'
op|'='
name|'None'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
op|'['
op|'{'
string|"'content-length'"
op|':'
string|"'345'"
op|'}'
op|','
op|'{'
op|'}'
op|']'
op|','
name|'retval'
op|')'
newline|'\n'
nl|'\n'
comment|'# same as above, now with prefix'
nl|'\n'
name|'sc'
op|'='
name|'internal_client'
op|'.'
name|'SimpleClient'
op|'('
name|'url'
op|'='
string|"'http://127.0.0.1'"
op|','
nl|'\n'
name|'token'
op|'='
string|"'token'"
op|')'
newline|'\n'
name|'retval'
op|'='
name|'sc'
op|'.'
name|'retry_request'
op|'('
name|'method'
op|','
name|'prefix'
op|'='
string|'"pre_"'
op|')'
newline|'\n'
name|'request'
op|'.'
name|'assert_called_with'
op|'('
nl|'\n'
string|"'http://127.0.0.1?format=json&prefix=pre_'"
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Auth-Token'"
op|':'
string|"'token'"
op|'}'
op|','
name|'data'
op|'='
name|'None'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
op|'['
op|'{'
string|"'content-length'"
op|':'
string|"'345'"
op|'}'
op|','
op|'{'
op|'}'
op|']'
op|','
name|'retval'
op|')'
newline|'\n'
nl|'\n'
comment|'# same as above, now with container name'
nl|'\n'
name|'retval'
op|'='
name|'sc'
op|'.'
name|'retry_request'
op|'('
name|'method'
op|','
name|'container'
op|'='
string|"'cont'"
op|')'
newline|'\n'
name|'request'
op|'.'
name|'assert_called_with'
op|'('
string|"'http://127.0.0.1/cont?format=json'"
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Auth-Token'"
op|':'
string|"'token'"
op|'}'
op|','
nl|'\n'
name|'data'
op|'='
name|'None'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
op|'['
op|'{'
string|"'content-length'"
op|':'
string|"'345'"
op|'}'
op|','
op|'{'
op|'}'
op|']'
op|','
name|'retval'
op|')'
newline|'\n'
nl|'\n'
comment|'# same as above, now with object name'
nl|'\n'
name|'retval'
op|'='
name|'sc'
op|'.'
name|'retry_request'
op|'('
name|'method'
op|','
name|'container'
op|'='
string|"'cont'"
op|','
name|'name'
op|'='
string|"'obj'"
op|')'
newline|'\n'
name|'request'
op|'.'
name|'assert_called_with'
op|'('
string|"'http://127.0.0.1/cont/obj'"
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Auth-Token'"
op|':'
string|"'token'"
op|'}'
op|','
nl|'\n'
name|'data'
op|'='
name|'None'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
op|'['
op|'{'
string|"'content-length'"
op|':'
string|"'345'"
op|'}'
op|','
op|'{'
op|'}'
op|']'
op|','
name|'retval'
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'('
string|"'eventlet.green.urllib2.urlopen'"
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'('
string|"'eventlet.green.urllib2.Request'"
op|')'
newline|'\n'
DECL|member|test_get
name|'def'
name|'test_get'
op|'('
name|'self'
op|','
name|'request'
op|','
name|'urlopen'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_test_get_head'
op|'('
name|'request'
op|','
name|'urlopen'
op|','
string|"'GET'"
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'('
string|"'eventlet.green.urllib2.urlopen'"
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'('
string|"'eventlet.green.urllib2.Request'"
op|')'
newline|'\n'
DECL|member|test_head
name|'def'
name|'test_head'
op|'('
name|'self'
op|','
name|'request'
op|','
name|'urlopen'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_test_get_head'
op|'('
name|'request'
op|','
name|'urlopen'
op|','
string|"'HEAD'"
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'('
string|"'eventlet.green.urllib2.urlopen'"
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'('
string|"'eventlet.green.urllib2.Request'"
op|')'
newline|'\n'
DECL|member|test_get_with_retries_all_failed
name|'def'
name|'test_get_with_retries_all_failed'
op|'('
name|'self'
op|','
name|'request'
op|','
name|'urlopen'
op|')'
op|':'
newline|'\n'
comment|'# Simulate a failing request, ensure retries done'
nl|'\n'
indent|'        '
name|'request'
op|'.'
name|'return_value'
op|'.'
name|'get_type'
op|'.'
name|'return_value'
op|'='
string|'"http"'
newline|'\n'
name|'urlopen'
op|'.'
name|'side_effect'
op|'='
name|'urllib2'
op|'.'
name|'URLError'
op|'('
string|"''"
op|')'
newline|'\n'
name|'sc'
op|'='
name|'internal_client'
op|'.'
name|'SimpleClient'
op|'('
name|'url'
op|'='
string|"'http://127.0.0.1'"
op|','
name|'retries'
op|'='
number|'1'
op|')'
newline|'\n'
name|'with'
name|'mock'
op|'.'
name|'patch'
op|'('
string|"'swift.common.internal_client.sleep'"
op|')'
name|'as'
name|'mock_sleep'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'urllib2'
op|'.'
name|'URLError'
op|','
name|'sc'
op|'.'
name|'retry_request'
op|','
string|"'GET'"
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'mock_sleep'
op|'.'
name|'call_count'
op|','
number|'1'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'request'
op|'.'
name|'call_count'
op|','
number|'2'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'urlopen'
op|'.'
name|'call_count'
op|','
number|'2'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'('
string|"'eventlet.green.urllib2.urlopen'"
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'('
string|"'eventlet.green.urllib2.Request'"
op|')'
newline|'\n'
DECL|member|test_get_with_retries
name|'def'
name|'test_get_with_retries'
op|'('
name|'self'
op|','
name|'request'
op|','
name|'urlopen'
op|')'
op|':'
newline|'\n'
comment|'# First request fails, retry successful'
nl|'\n'
indent|'        '
name|'request'
op|'.'
name|'return_value'
op|'.'
name|'get_type'
op|'.'
name|'return_value'
op|'='
string|'"http"'
newline|'\n'
name|'mock_resp'
op|'='
name|'mock'
op|'.'
name|'MagicMock'
op|'('
op|')'
newline|'\n'
name|'mock_resp'
op|'.'
name|'read'
op|'.'
name|'return_value'
op|'='
string|"''"
newline|'\n'
name|'mock_resp'
op|'.'
name|'info'
op|'.'
name|'return_value'
op|'='
op|'{'
op|'}'
newline|'\n'
name|'urlopen'
op|'.'
name|'side_effect'
op|'='
op|'['
name|'urllib2'
op|'.'
name|'URLError'
op|'('
string|"''"
op|')'
op|','
name|'mock_resp'
op|']'
newline|'\n'
name|'sc'
op|'='
name|'internal_client'
op|'.'
name|'SimpleClient'
op|'('
name|'url'
op|'='
string|"'http://127.0.0.1'"
op|','
name|'retries'
op|'='
number|'1'
op|','
nl|'\n'
name|'token'
op|'='
string|"'token'"
op|')'
newline|'\n'
nl|'\n'
name|'with'
name|'mock'
op|'.'
name|'patch'
op|'('
string|"'swift.common.internal_client.sleep'"
op|')'
name|'as'
name|'mock_sleep'
op|':'
newline|'\n'
indent|'            '
name|'retval'
op|'='
name|'sc'
op|'.'
name|'retry_request'
op|'('
string|"'GET'"
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'mock_sleep'
op|'.'
name|'call_count'
op|','
number|'1'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'request'
op|'.'
name|'call_count'
op|','
number|'2'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'urlopen'
op|'.'
name|'call_count'
op|','
number|'2'
op|')'
newline|'\n'
name|'request'
op|'.'
name|'assert_called_with'
op|'('
string|"'http://127.0.0.1?format=json'"
op|','
name|'data'
op|'='
name|'None'
op|','
nl|'\n'
name|'headers'
op|'='
op|'{'
string|"'X-Auth-Token'"
op|':'
string|"'token'"
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
op|'['
op|'{'
op|'}'
op|','
name|'None'
op|']'
op|','
name|'retval'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'sc'
op|'.'
name|'attempts'
op|','
number|'2'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'('
string|"'eventlet.green.urllib2.urlopen'"
op|')'
newline|'\n'
DECL|member|test_get_with_retries_param
name|'def'
name|'test_get_with_retries_param'
op|'('
name|'self'
op|','
name|'mock_urlopen'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'mock_response'
op|'='
name|'mock'
op|'.'
name|'MagicMock'
op|'('
op|')'
newline|'\n'
name|'mock_response'
op|'.'
name|'read'
op|'.'
name|'return_value'
op|'='
string|"''"
newline|'\n'
name|'mock_response'
op|'.'
name|'info'
op|'.'
name|'return_value'
op|'='
op|'{'
op|'}'
newline|'\n'
name|'mock_urlopen'
op|'.'
name|'side_effect'
op|'='
name|'internal_client'
op|'.'
name|'httplib'
op|'.'
name|'BadStatusLine'
op|'('
string|"''"
op|')'
newline|'\n'
name|'c'
op|'='
name|'internal_client'
op|'.'
name|'SimpleClient'
op|'('
name|'url'
op|'='
string|"'http://127.0.0.1'"
op|','
name|'token'
op|'='
string|"'token'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'c'
op|'.'
name|'retries'
op|','
number|'5'
op|')'
newline|'\n'
nl|'\n'
comment|'# first without retries param'
nl|'\n'
name|'with'
name|'mock'
op|'.'
name|'patch'
op|'('
string|"'swift.common.internal_client.sleep'"
op|')'
name|'as'
name|'mock_sleep'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'internal_client'
op|'.'
name|'httplib'
op|'.'
name|'BadStatusLine'
op|','
nl|'\n'
name|'c'
op|'.'
name|'retry_request'
op|','
string|"'GET'"
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'mock_sleep'
op|'.'
name|'call_count'
op|','
number|'5'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'mock_urlopen'
op|'.'
name|'call_count'
op|','
number|'6'
op|')'
newline|'\n'
comment|'# then with retries param'
nl|'\n'
name|'mock_urlopen'
op|'.'
name|'reset_mock'
op|'('
op|')'
newline|'\n'
name|'with'
name|'mock'
op|'.'
name|'patch'
op|'('
string|"'swift.common.internal_client.sleep'"
op|')'
name|'as'
name|'mock_sleep'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'internal_client'
op|'.'
name|'httplib'
op|'.'
name|'BadStatusLine'
op|','
nl|'\n'
name|'c'
op|'.'
name|'retry_request'
op|','
string|"'GET'"
op|','
name|'retries'
op|'='
number|'2'
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'mock_sleep'
op|'.'
name|'call_count'
op|','
number|'2'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'mock_urlopen'
op|'.'
name|'call_count'
op|','
number|'3'
op|')'
newline|'\n'
comment|'# and this time with a real response'
nl|'\n'
name|'mock_urlopen'
op|'.'
name|'reset_mock'
op|'('
op|')'
newline|'\n'
name|'mock_urlopen'
op|'.'
name|'side_effect'
op|'='
op|'['
name|'internal_client'
op|'.'
name|'httplib'
op|'.'
name|'BadStatusLine'
op|'('
string|"''"
op|')'
op|','
nl|'\n'
name|'mock_response'
op|']'
newline|'\n'
name|'with'
name|'mock'
op|'.'
name|'patch'
op|'('
string|"'swift.common.internal_client.sleep'"
op|')'
name|'as'
name|'mock_sleep'
op|':'
newline|'\n'
indent|'            '
name|'retval'
op|'='
name|'c'
op|'.'
name|'retry_request'
op|'('
string|"'GET'"
op|','
name|'retries'
op|'='
number|'1'
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'mock_sleep'
op|'.'
name|'call_count'
op|','
number|'1'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'mock_urlopen'
op|'.'
name|'call_count'
op|','
number|'2'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
op|'['
op|'{'
op|'}'
op|','
name|'None'
op|']'
op|','
name|'retval'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'('
string|"'eventlet.green.urllib2.urlopen'"
op|')'
newline|'\n'
DECL|member|test_request_with_retries_with_HTTPError
name|'def'
name|'test_request_with_retries_with_HTTPError'
op|'('
name|'self'
op|','
name|'mock_urlopen'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'mock_response'
op|'='
name|'mock'
op|'.'
name|'MagicMock'
op|'('
op|')'
newline|'\n'
name|'mock_response'
op|'.'
name|'read'
op|'.'
name|'return_value'
op|'='
string|"''"
newline|'\n'
name|'c'
op|'='
name|'internal_client'
op|'.'
name|'SimpleClient'
op|'('
name|'url'
op|'='
string|"'http://127.0.0.1'"
op|','
name|'token'
op|'='
string|"'token'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'c'
op|'.'
name|'retries'
op|','
number|'5'
op|')'
newline|'\n'
nl|'\n'
name|'for'
name|'request_method'
name|'in'
string|"'GET PUT POST DELETE HEAD COPY'"
op|'.'
name|'split'
op|'('
op|')'
op|':'
newline|'\n'
indent|'            '
name|'mock_urlopen'
op|'.'
name|'reset_mock'
op|'('
op|')'
newline|'\n'
name|'mock_urlopen'
op|'.'
name|'side_effect'
op|'='
name|'urllib2'
op|'.'
name|'HTTPError'
op|'('
op|'*'
op|'['
name|'None'
op|']'
op|'*'
number|'5'
op|')'
newline|'\n'
name|'with'
name|'mock'
op|'.'
name|'patch'
op|'('
string|"'swift.common.internal_client.sleep'"
op|')'
name|'as'
name|'mock_sleep'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'exceptions'
op|'.'
name|'ClientException'
op|','
nl|'\n'
name|'c'
op|'.'
name|'retry_request'
op|','
name|'request_method'
op|','
name|'retries'
op|'='
number|'1'
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'mock_sleep'
op|'.'
name|'call_count'
op|','
number|'1'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'mock_urlopen'
op|'.'
name|'call_count'
op|','
number|'2'
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'('
string|"'eventlet.green.urllib2.urlopen'"
op|')'
newline|'\n'
DECL|member|test_request_container_with_retries_with_HTTPError
name|'def'
name|'test_request_container_with_retries_with_HTTPError'
op|'('
name|'self'
op|','
nl|'\n'
name|'mock_urlopen'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'mock_response'
op|'='
name|'mock'
op|'.'
name|'MagicMock'
op|'('
op|')'
newline|'\n'
name|'mock_response'
op|'.'
name|'read'
op|'.'
name|'return_value'
op|'='
string|"''"
newline|'\n'
name|'c'
op|'='
name|'internal_client'
op|'.'
name|'SimpleClient'
op|'('
name|'url'
op|'='
string|"'http://127.0.0.1'"
op|','
name|'token'
op|'='
string|"'token'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'c'
op|'.'
name|'retries'
op|','
number|'5'
op|')'
newline|'\n'
nl|'\n'
name|'for'
name|'request_method'
name|'in'
string|"'GET PUT POST DELETE HEAD COPY'"
op|'.'
name|'split'
op|'('
op|')'
op|':'
newline|'\n'
indent|'            '
name|'mock_urlopen'
op|'.'
name|'reset_mock'
op|'('
op|')'
newline|'\n'
name|'mock_urlopen'
op|'.'
name|'side_effect'
op|'='
name|'urllib2'
op|'.'
name|'HTTPError'
op|'('
op|'*'
op|'['
name|'None'
op|']'
op|'*'
number|'5'
op|')'
newline|'\n'
name|'with'
name|'mock'
op|'.'
name|'patch'
op|'('
string|"'swift.common.internal_client.sleep'"
op|')'
name|'as'
name|'mock_sleep'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'exceptions'
op|'.'
name|'ClientException'
op|','
nl|'\n'
name|'c'
op|'.'
name|'retry_request'
op|','
name|'request_method'
op|','
nl|'\n'
name|'container'
op|'='
string|"'con'"
op|','
name|'retries'
op|'='
number|'1'
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'mock_sleep'
op|'.'
name|'call_count'
op|','
number|'1'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'mock_urlopen'
op|'.'
name|'call_count'
op|','
number|'2'
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'('
string|"'eventlet.green.urllib2.urlopen'"
op|')'
newline|'\n'
DECL|member|test_request_object_with_retries_with_HTTPError
name|'def'
name|'test_request_object_with_retries_with_HTTPError'
op|'('
name|'self'
op|','
nl|'\n'
name|'mock_urlopen'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'mock_response'
op|'='
name|'mock'
op|'.'
name|'MagicMock'
op|'('
op|')'
newline|'\n'
name|'mock_response'
op|'.'
name|'read'
op|'.'
name|'return_value'
op|'='
string|"''"
newline|'\n'
name|'c'
op|'='
name|'internal_client'
op|'.'
name|'SimpleClient'
op|'('
name|'url'
op|'='
string|"'http://127.0.0.1'"
op|','
name|'token'
op|'='
string|"'token'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'c'
op|'.'
name|'retries'
op|','
number|'5'
op|')'
newline|'\n'
nl|'\n'
name|'for'
name|'request_method'
name|'in'
string|"'GET PUT POST DELETE HEAD COPY'"
op|'.'
name|'split'
op|'('
op|')'
op|':'
newline|'\n'
indent|'            '
name|'mock_urlopen'
op|'.'
name|'reset_mock'
op|'('
op|')'
newline|'\n'
name|'mock_urlopen'
op|'.'
name|'side_effect'
op|'='
name|'urllib2'
op|'.'
name|'HTTPError'
op|'('
op|'*'
op|'['
name|'None'
op|']'
op|'*'
number|'5'
op|')'
newline|'\n'
name|'with'
name|'mock'
op|'.'
name|'patch'
op|'('
string|"'swift.common.internal_client.sleep'"
op|')'
name|'as'
name|'mock_sleep'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'exceptions'
op|'.'
name|'ClientException'
op|','
nl|'\n'
name|'c'
op|'.'
name|'retry_request'
op|','
name|'request_method'
op|','
nl|'\n'
name|'container'
op|'='
string|"'con'"
op|','
name|'name'
op|'='
string|"'obj'"
op|','
name|'retries'
op|'='
number|'1'
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'mock_sleep'
op|'.'
name|'call_count'
op|','
number|'1'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'mock_urlopen'
op|'.'
name|'call_count'
op|','
number|'2'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_proxy
dedent|''
dedent|''
name|'def'
name|'test_proxy'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# check that proxy arg is passed through to the urllib Request'
nl|'\n'
indent|'        '
name|'scheme'
op|'='
string|"'http'"
newline|'\n'
name|'proxy_host'
op|'='
string|"'127.0.0.1:80'"
newline|'\n'
name|'proxy'
op|'='
string|"'%s://%s'"
op|'%'
op|'('
name|'scheme'
op|','
name|'proxy_host'
op|')'
newline|'\n'
name|'url'
op|'='
string|"'https://127.0.0.1:1/a'"
newline|'\n'
nl|'\n'
name|'mocked'
op|'='
string|"'swift.common.internal_client.urllib2.urlopen'"
newline|'\n'
nl|'\n'
comment|'# module level methods'
nl|'\n'
name|'for'
name|'func'
name|'in'
op|'('
name|'internal_client'
op|'.'
name|'put_object'
op|','
nl|'\n'
name|'internal_client'
op|'.'
name|'delete_object'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'with'
name|'mock'
op|'.'
name|'patch'
op|'('
name|'mocked'
op|')'
name|'as'
name|'mock_urlopen'
op|':'
newline|'\n'
indent|'                '
name|'mock_urlopen'
op|'.'
name|'return_value'
op|'='
name|'FakeConn'
op|'('
op|')'
newline|'\n'
name|'func'
op|'('
name|'url'
op|','
name|'container'
op|'='
string|"'c'"
op|','
name|'name'
op|'='
string|"'o1'"
op|','
name|'contents'
op|'='
string|"''"
op|','
name|'proxy'
op|'='
name|'proxy'
op|','
nl|'\n'
name|'timeout'
op|'='
number|'0.1'
op|','
name|'retries'
op|'='
number|'0'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'1'
op|','
name|'mock_urlopen'
op|'.'
name|'call_count'
op|')'
newline|'\n'
name|'args'
op|','
name|'kwargs'
op|'='
name|'mock_urlopen'
op|'.'
name|'call_args'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'1'
op|','
name|'len'
op|'('
name|'args'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'1'
op|','
name|'len'
op|'('
name|'kwargs'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'0.1'
op|','
name|'kwargs'
op|'['
string|"'timeout'"
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'isinstance'
op|'('
name|'args'
op|'['
number|'0'
op|']'
op|','
name|'urllib2'
op|'.'
name|'Request'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'proxy_host'
op|','
name|'args'
op|'['
number|'0'
op|']'
op|'.'
name|'host'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'scheme'
op|','
name|'args'
op|'['
number|'0'
op|']'
op|'.'
name|'type'
op|')'
newline|'\n'
nl|'\n'
comment|'# class methods'
nl|'\n'
dedent|''
dedent|''
name|'content'
op|'='
name|'mock'
op|'.'
name|'MagicMock'
op|'('
op|')'
newline|'\n'
name|'cl'
op|'='
name|'internal_client'
op|'.'
name|'SimpleClient'
op|'('
name|'url'
op|')'
newline|'\n'
name|'scenarios'
op|'='
op|'('
op|'('
name|'cl'
op|'.'
name|'get_account'
op|','
op|'['
op|']'
op|')'
op|','
nl|'\n'
op|'('
name|'cl'
op|'.'
name|'get_container'
op|','
op|'['
string|"'c'"
op|']'
op|')'
op|','
nl|'\n'
op|'('
name|'cl'
op|'.'
name|'put_container'
op|','
op|'['
string|"'c'"
op|']'
op|')'
op|','
nl|'\n'
op|'('
name|'cl'
op|'.'
name|'put_object'
op|','
op|'['
string|"'c'"
op|','
string|"'o'"
op|','
name|'content'
op|']'
op|')'
op|')'
newline|'\n'
name|'for'
name|'scenario'
name|'in'
name|'scenarios'
op|':'
newline|'\n'
indent|'            '
name|'with'
name|'mock'
op|'.'
name|'patch'
op|'('
name|'mocked'
op|')'
name|'as'
name|'mock_urlopen'
op|':'
newline|'\n'
indent|'                '
name|'mock_urlopen'
op|'.'
name|'return_value'
op|'='
name|'FakeConn'
op|'('
op|')'
newline|'\n'
name|'scenario'
op|'['
number|'0'
op|']'
op|'('
op|'*'
name|'scenario'
op|'['
number|'1'
op|']'
op|','
name|'proxy'
op|'='
name|'proxy'
op|','
name|'timeout'
op|'='
number|'0.1'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'1'
op|','
name|'mock_urlopen'
op|'.'
name|'call_count'
op|')'
newline|'\n'
name|'args'
op|','
name|'kwargs'
op|'='
name|'mock_urlopen'
op|'.'
name|'call_args'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'1'
op|','
name|'len'
op|'('
name|'args'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'1'
op|','
name|'len'
op|'('
name|'kwargs'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'0.1'
op|','
name|'kwargs'
op|'['
string|"'timeout'"
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'isinstance'
op|'('
name|'args'
op|'['
number|'0'
op|']'
op|','
name|'urllib2'
op|'.'
name|'Request'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'proxy_host'
op|','
name|'args'
op|'['
number|'0'
op|']'
op|'.'
name|'host'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'scheme'
op|','
name|'args'
op|'['
number|'0'
op|']'
op|'.'
name|'type'
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
dedent|''
dedent|''
name|'if'
name|'__name__'
op|'=='
string|"'__main__'"
op|':'
newline|'\n'
indent|'    '
name|'unittest'
op|'.'
name|'main'
op|'('
op|')'
newline|'\n'
dedent|''
endmarker|''
end_unit
